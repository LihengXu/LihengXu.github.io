

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/bg/xiao.png">
  <link rel="icon" href="/img/bg/xiao.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  
    <meta name="description" content="">
  
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
  <title>JVMå­¦ä¹  - LihengXu&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.8","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"zTPGNcnnYmT218Av5iBL8nGh-gzGzoHsz","app_key":"Nk68rUDzBxauuv3b7ro1QdtD","server_url":"https://ztpgncnn.lc-cn-n1-shared.com"}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>LihengXu</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                Links
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                about
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/bg/example.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="JVMå­¦ä¹ ">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-04-17 21:32" pubdate>
        April 17, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      19k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      304
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- LeanCloud ç»Ÿè®¡æ–‡ç« PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">JVMå­¦ä¹ </h1>
            
            <div class="markdown-body">
              <h1 id="JVMå­¦ä¹ "><a href="#JVMå­¦ä¹ " class="headerlink" title="JVMå­¦ä¹ "></a>JVMå­¦ä¹ </h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1yE411Z7AP"><strong>è§£å¯†JVMã€é»‘é©¬ç¨‹åºå‘˜å‡ºå“ã€‘</strong></a>æ•™å­¦è§†é¢‘çš„ç¬”è®°ï¼ˆè½¬è½½<a target="_blank" rel="noopener" href="https://nyimac.gitee.io/2020/07/03/JVM%E5%AD%A6%E4%B9%A0/#2%E3%80%81%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95">nyimac</a>ï¼Œåšä¸€æ¡æ‡’ğŸ•ï¼Œè¿™ä¸ªäººåšçš„ä¸é”™ï¼‰</p>
<h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯JVM"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯JVM" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯JVM"></a>ä¸€ã€ä»€ä¹ˆæ˜¯JVM</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>Java Virtual Machineï¼ŒJAVAç¨‹åºçš„<strong>è¿è¡Œç¯å¢ƒ</strong>ï¼ˆJAVAäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼‰</p>
<h3 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h3><ul>
<li>ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ</li>
<li>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶</li>
<li>æ•°ç»„ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥</li>
</ul>
<h3 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h3><p>JVM JRE JDKçš„åŒºåˆ«</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="äºŒã€å†…å­˜ç»“æ„"><a href="#äºŒã€å†…å­˜ç»“æ„" class="headerlink" title="äºŒã€å†…å­˜ç»“æ„"></a>äºŒã€å†…å­˜ç»“æ„</h2><h3 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a><strong>æ•´ä½“æ¶æ„</strong></h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="1ã€ç¨‹åºè®¡æ•°å™¨"><a href="#1ã€ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1ã€ç¨‹åºè®¡æ•°å™¨"></a>1ã€ç¨‹åºè®¡æ•°å™¨</h3><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>ç”¨äºä¿å­˜JVMä¸­ä¸‹ä¸€æ¡æ‰€è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€</p>
<h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul>
<li>çº¿ç¨‹ç§æœ‰<ul>
<li>CPUä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡ï¼Œå½“å½“å‰çº¿ç¨‹çš„æ—¶é—´ç‰‡ä½¿ç”¨å®Œä»¥åï¼ŒCPUå°±ä¼šå»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­çš„ä»£ç </li>
<li>ç¨‹åºè®¡æ•°å™¨æ˜¯<strong>æ¯ä¸ªçº¿ç¨‹</strong>æ‰€<strong>ç§æœ‰</strong>çš„ï¼Œå½“å¦ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œåˆè¿”å›æ¥æ‰§è¡Œå½“å‰çº¿ç¨‹çš„ä»£ç æ—¶ï¼Œé€šè¿‡ç¨‹åºè®¡æ•°å™¨å¯ä»¥çŸ¥é“åº”è¯¥æ‰§è¡Œå“ªä¸€å¥æŒ‡ä»¤</li>
</ul>
</li>
<li>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º</li>
</ul>
<h3 id="2ã€è™šæ‹Ÿæœºæ ˆ"><a href="#2ã€è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2ã€è™šæ‹Ÿæœºæ ˆ"></a>2ã€è™šæ‹Ÿæœºæ ˆ</h3><h4 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><ul>
<li>æ¯ä¸ª<strong>çº¿ç¨‹</strong>è¿è¡Œéœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œç§°ä¸º<strong>è™šæ‹Ÿæœºæ ˆ</strong></li>
<li>æ¯ä¸ªæ ˆç”±å¤šä¸ª<strong>æ ˆå¸§</strong>ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶æ‰€å ç”¨çš„å†…å­˜</li>
<li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰<strong>ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§</strong>ï¼Œå¯¹åº”ç€<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•</strong></li>
</ul>
<h4 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h4><p>ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		method1();<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method1</span><span class="hljs-params">()</span> </span>&#123;<br>		method2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">method2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> c = a + b;<br>		<span class="hljs-keyword">return</span> c;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åœ¨æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»ç±»ä¸­çš„æ–¹æ³•åœ¨è¿›å…¥è™šæ‹Ÿæœºæ ˆçš„æ—¶å€™ï¼Œç¬¦åˆæ ˆçš„ç‰¹ç‚¹</p>
<h4 id="é—®é¢˜è¾¨æ"><a href="#é—®é¢˜è¾¨æ" class="headerlink" title="é—®é¢˜è¾¨æ"></a>é—®é¢˜è¾¨æ</h4><ul>
<li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ<ul>
<li><strong>ä¸éœ€è¦</strong>ã€‚å› ä¸ºè™šæ‹Ÿæœºæ ˆä¸­æ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆçš„ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå¯¹åº”çš„æ ˆå¸§å°±ä¼šè¢«å¼¹å‡ºæ ˆã€‚æ‰€ä»¥æ— éœ€é€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å»å›æ”¶å†…å­˜ã€‚</li>
</ul>
</li>
<li>æ ˆå†…å­˜çš„åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿ<ul>
<li>ä¸æ˜¯ã€‚å› ä¸º<strong>ç‰©ç†å†…å­˜æ˜¯ä¸€å®šçš„</strong>ï¼Œæ ˆå†…å­˜è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒæ›´å¤šçš„é€’å½’è°ƒç”¨ï¼Œä½†æ˜¯å¯æ‰§è¡Œçš„çº¿ç¨‹æ•°å°±ä¼šè¶Šå°‘ã€‚</li>
</ul>
</li>
<li>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ<ul>
<li>å¦‚æœæ–¹æ³•å†…<strong>å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</li>
<li>å¦‚æœå¦‚æœ<strong>å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡</strong>ï¼Œå¹¶<strong>é€ƒç¦»äº†æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
</ul>
</li>
</ul>
<h4 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><p><strong>Java.lang.stackOverflowError</strong> æ ˆå†…å­˜æº¢å‡º</p>
<p><strong>å‘ç”ŸåŸå› </strong></p>
<ul>
<li>è™šæ‹Ÿæœºæ ˆä¸­ï¼Œ<strong>æ ˆå¸§è¿‡å¤š</strong>ï¼ˆæ— é™é€’å½’ï¼‰</li>
<li>æ¯ä¸ªæ ˆå¸§<strong>æ‰€å ç”¨è¿‡å¤§</strong></li>
</ul>
<h4 id="çº¿ç¨‹è¿è¡Œè¯Šæ–­"><a href="#çº¿ç¨‹è¿è¡Œè¯Šæ–­" class="headerlink" title="çº¿ç¨‹è¿è¡Œè¯Šæ–­"></a>çº¿ç¨‹è¿è¡Œè¯Šæ–­</h4><p>CPUå ç”¨è¿‡é«˜</p>
<ul>
<li>Linuxç¯å¢ƒä¸‹è¿è¡ŒæŸäº›ç¨‹åºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´CPUçš„å ç”¨è¿‡é«˜ï¼Œè¿™æ—¶éœ€è¦å®šä½å ç”¨CPUè¿‡é«˜çš„çº¿ç¨‹<ul>
<li><strong>top</strong>å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å“ªä¸ª<strong>è¿›ç¨‹</strong>å ç”¨CPUè¿‡é«˜</li>
<li><strong>ps H -eo pid, tidï¼ˆçº¿ç¨‹idï¼‰, %cpu | grep åˆšæ‰é€šè¿‡topæŸ¥åˆ°çš„è¿›ç¨‹å·</strong> é€šè¿‡pså‘½ä»¤è¿›ä¸€æ­¥æŸ¥çœ‹æ˜¯å“ªä¸ªçº¿ç¨‹å ç”¨CPUè¿‡é«˜</li>
<li><strong>jstack è¿›ç¨‹id</strong> é€šè¿‡æŸ¥çœ‹è¿›ç¨‹ä¸­çš„çº¿ç¨‹çš„nidï¼Œåˆšæ‰é€šè¿‡pså‘½ä»¤çœ‹åˆ°çš„tidæ¥<strong>å¯¹æ¯”å®šä½</strong>ï¼Œæ³¨æ„jstackæŸ¥æ‰¾å‡ºçš„çº¿ç¨‹idæ˜¯<strong>16è¿›åˆ¶çš„</strong>ï¼Œ<strong>éœ€è¦è½¬æ¢</strong></li>
</ul>
</li>
</ul>
<h3 id="3ã€æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3ã€æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3ã€æœ¬åœ°æ–¹æ³•æ ˆ"></a>3ã€æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>ä¸€äº›å¸¦æœ‰<strong>nativeå…³é”®å­—</strong>çš„æ–¹æ³•å°±æ˜¯éœ€è¦JAVAå»è°ƒç”¨æœ¬åœ°çš„Cæˆ–è€…C++æ–¹æ³•ï¼Œå› ä¸ºJAVAæœ‰æ—¶å€™æ²¡æ³•ç›´æ¥å’Œæ“ä½œç³»ç»Ÿåº•å±‚äº¤äº’ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°æœ¬åœ°æ–¹æ³•</p>
<h3 id="4ã€å †"><a href="#4ã€å †" class="headerlink" title="4ã€å †"></a>4ã€å †</h3><h4 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>é€šè¿‡newå…³é”®å­—<strong>åˆ›å»ºçš„å¯¹è±¡</strong>éƒ½ä¼šè¢«æ”¾åœ¨å †å†…å­˜</p>
<h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul>
<li><strong>æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ï¼Œå †å†…å­˜ä¸­çš„å¯¹è±¡éƒ½éœ€è¦<strong>è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</strong></li>
<li>æœ‰åƒåœ¾å›æ”¶æœºåˆ¶</li>
</ul>
<h4 id="å †å†…å­˜æº¢å‡º"><a href="#å †å†…å­˜æº¢å‡º" class="headerlink" title="å †å†…å­˜æº¢å‡º"></a>å †å†…å­˜æº¢å‡º</h4><p><strong>java.lang.OutofMemoryError</strong> ï¼šjava heap space. å †å†…å­˜æº¢å‡º</p>
<h4 id="å †å†…å­˜è¯Šæ–­"><a href="#å †å†…å­˜è¯Šæ–­" class="headerlink" title="å †å†…å­˜è¯Šæ–­"></a>å †å†…å­˜è¯Šæ–­</h4><p><strong>jps</strong></p>
<p><strong>jmap</strong></p>
<p><strong>jconsole</strong></p>
<p><strong>jvirsalvm</strong></p>
<h3 id="5ã€æ–¹æ³•åŒº"><a href="#5ã€æ–¹æ³•åŒº" class="headerlink" title="5ã€æ–¹æ³•åŒº"></a>5ã€æ–¹æ³•åŒº</h3><h4 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="å†…å­˜æº¢å‡º-1"><a href="#å†…å­˜æº¢å‡º-1" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><ul>
<li>1.8ä»¥å‰ä¼šå¯¼è‡´<strong>æ°¸ä¹…ä»£</strong>å†…å­˜æº¢å‡º</li>
<li>1.8ä»¥åä¼šå¯¼è‡´<strong>å…ƒç©ºé—´</strong>å†…å­˜æº¢å‡º</li>
</ul>
<h4 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>äºŒè¿›åˆ¶å­—èŠ‚ç çš„ç»„æˆï¼šç±»çš„åŸºæœ¬ä¿¡æ¯ã€å¸¸é‡æ± ã€ç±»çš„æ–¹æ³•å®šä¹‰ï¼ˆåŒ…å«äº†è™šæ‹ŸæœºæŒ‡ä»¤ï¼‰</p>
<p><strong>é€šè¿‡åç¼–è¯‘æ¥æŸ¥çœ‹ç±»çš„ä¿¡æ¯</strong></p>
<ul>
<li><p>è·å¾—å¯¹åº”ç±»çš„.classæ–‡ä»¶</p>
<ul>
<li><p>åœ¨JDKå¯¹åº”çš„binç›®å½•ä¸‹è¿è¡Œcmdï¼Œ<strong>ä¹Ÿå¯ä»¥åœ¨IDEAæ§åˆ¶å°è¾“å…¥</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150602.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150602.png" srcset="/img/loading.gif" alt="img"></a></p>
</li>
<li><p>è¾“å…¥ <strong>javac å¯¹åº”ç±»çš„ç»å¯¹è·¯å¾„</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">F:\JAVA\JDK8.0\bin&gt;javac F:\Thread_study\src\com\nyima\JVM\day01\Main.java<br></code></pre></td></tr></table></figure>

<p>è¾“å…¥å®Œæˆåï¼Œå¯¹åº”çš„ç›®å½•ä¸‹å°±ä¼šå‡ºç°ç±»çš„.classæ–‡ä»¶</p>
</li>
</ul>
</li>
<li><p>åœ¨æ§åˆ¶å°è¾“å…¥ javap -v ç±»çš„ç»å¯¹è·¯å¾„</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">javap -v F:\Thread_study\src\com\nyima\JVM\day01\Main.class<br></code></pre></td></tr></table></figure></li>
<li><p>ç„¶åèƒ½åœ¨æ§åˆ¶å°çœ‹åˆ°åç¼–è¯‘ä»¥åç±»çš„ä¿¡æ¯äº†</p>
<ul>
<li><p>ç±»çš„åŸºæœ¬ä¿¡æ¯</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png" srcset="/img/loading.gif" alt="img"></a></p>
</li>
<li><p>å¸¸é‡æ± </p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png" srcset="/img/loading.gif" alt="img"></a></p>
</li>
<li><p>è™šæ‹Ÿæœºä¸­æ‰§è¡Œç¼–è¯‘çš„æ–¹æ³•ï¼ˆæ¡†å†…çš„æ˜¯çœŸæ­£ç¼–è¯‘æ‰§è¡Œçš„å†…å®¹ï¼Œ**#å·çš„å†…å®¹éœ€è¦åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾**ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png" srcset="/img/loading.gif" alt="img"></a></p>
</li>
</ul>
</li>
</ul>
<h4 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h4><ul>
<li>å¸¸é‡æ± <ul>
<li>å°±æ˜¯ä¸€å¼ è¡¨ï¼ˆå¦‚ä¸Šå›¾ä¸­çš„constant poolï¼‰ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ä¿¡æ¯</li>
</ul>
</li>
<li>è¿è¡Œæ—¶å¸¸é‡æ± <ul>
<li>å¸¸é‡æ± æ˜¯*.classæ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥<strong>ç±»è¢«åŠ è½½ä»¥å</strong>ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼š<strong>æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œå¹¶æŠŠé‡Œé¢çš„<strong>ç¬¦å·åœ°å€å˜ä¸ºçœŸå®åœ°å€</strong></li>
</ul>
</li>
</ul>
<h4 id="å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"><a href="#å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»" class="headerlink" title="å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"></a>å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»</h4><h5 id="ä¸²æ± StringTable"><a href="#ä¸²æ± StringTable" class="headerlink" title="ä¸²æ± StringTable"></a><strong>ä¸²æ± </strong>StringTable</h5><p><strong>ç‰¹å¾</strong></p>
<ul>
<li>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œåªæœ‰<strong>åœ¨è¢«ç”¨åˆ°æ—¶æ‰ä¼šè½¬åŒ–ä¸ºå¯¹è±¡</strong></li>
<li>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡</li>
<li>å­—ç¬¦ä¸²<strong>å˜é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>StringBuilder</strong></li>
<li>å­—ç¬¦ä¸²<strong>å¸¸é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>ç¼–è¯‘å™¨ä¼˜åŒ–</strong></li>
<li>å¯ä»¥ä½¿ç”¨<strong>internæ–¹æ³•</strong>ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± ä¸­</li>
<li><strong>æ³¨æ„</strong>ï¼šæ— è®ºæ˜¯ä¸²æ± è¿˜æ˜¯å †é‡Œé¢çš„å­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯å¯¹è±¡</li>
</ul>
<p>ç”¨æ¥æ”¾å­—ç¬¦ä¸²å¯¹è±¡ä¸”é‡Œé¢çš„<strong>å…ƒç´ ä¸é‡å¤</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		String a = <span class="hljs-string">&quot;a&quot;</span>; <br>		String b = <span class="hljs-string">&quot;b&quot;</span>;<br>		String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œéƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä½†è¿™æ˜¯a b ab ä»…æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œ<strong>è¿˜æ²¡æœ‰æˆä¸ºjavaå­—ç¬¦ä¸²</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">0: ldc           #2                  // String a<br>2: astore_1<br>3: ldc           #3                  // String b<br>5: astore_2<br>6: ldc           #4                  // String ab<br>8: astore_3<br>9: return<br></code></pre></td></tr></table></figure>

<p>å½“æ‰§è¡Œåˆ° ldc #2 æ—¶ï¼Œä¼šæŠŠç¬¦å· a å˜ä¸º â€œaâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œ<strong>å¹¶æ”¾å…¥ä¸²æ± ä¸­</strong>ï¼ˆhashtableç»“æ„ ä¸å¯æ‰©å®¹ï¼‰</p>
<p>å½“æ‰§è¡Œåˆ° ldc #3 æ—¶ï¼Œä¼šæŠŠç¬¦å· b å˜ä¸º â€œbâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p>
<p>å½“æ‰§è¡Œåˆ° ldc #4 æ—¶ï¼Œä¼šæŠŠç¬¦å· ab å˜ä¸º â€œabâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p>
<p>æœ€ç»ˆ<strong>StringTable [â€œaâ€, â€œbâ€, â€œabâ€]</strong></p>
<p><strong>æ³¨æ„</strong>ï¼šå­—ç¬¦ä¸²å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯<strong>æ‡’æƒ°çš„</strong>ï¼Œåªæœ‰å½“è¿è¡Œåˆ°é‚£ä¸€è¡Œå­—ç¬¦ä¸²ä¸”åœ¨ä¸²æ± ä¸­ä¸å­˜åœ¨çš„æ—¶å€™ï¼ˆå¦‚ ldc #2ï¼‰æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²æ‰ä¼šè¢«åˆ›å»ºå¹¶æ”¾å…¥ä¸²æ± ä¸­ã€‚</p>
<p>ä½¿ç”¨æ‹¼æ¥<strong>å­—ç¬¦ä¸²å˜é‡å¯¹è±¡</strong>åˆ›å»ºå­—ç¬¦ä¸²çš„è¿‡ç¨‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		String a = <span class="hljs-string">&quot;a&quot;</span>;<br>		String b = <span class="hljs-string">&quot;b&quot;</span>;<br>		String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>		<span class="hljs-comment">//æ‹¼æ¥å­—ç¬¦ä¸²å¯¹è±¡æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²</span><br>		String ab2 = a+b; <br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åç¼–è¯‘åçš„ç»“æœ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">	 Code:<br>      stack=2, locals=5, args_size=1<br>         0: ldc           #2                  // String a<br>         2: astore_1<br>         3: ldc           #3                  // String b<br>         5: astore_2<br>         6: ldc           #4                  // String ab<br>         8: astore_3<br>         9: new           #5                  // class java/lang/StringBuilder<br>        12: dup<br>        13: invokespecial #6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V<br>        16: aload_1<br>        17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String<br>;)Ljava/lang/StringBuilder;<br>        20: aload_2<br>        21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String<br>;)Ljava/lang/StringBuilder;<br>        24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/Str<br>ing;<br>        27: astore        4<br>        29: return<br></code></pre></td></tr></table></figure>

<p>é€šè¿‡æ‹¼æ¥çš„æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²çš„<strong>è¿‡ç¨‹</strong>æ˜¯ï¼šStringBuilder().append(â€œaâ€).append(â€œbâ€).toString()</p>
<p>æœ€åçš„toStringæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª<strong>æ–°çš„å­—ç¬¦ä¸²</strong>ï¼Œä½†å­—ç¬¦ä¸²çš„<strong>å€¼</strong>å’Œæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸€è‡´ï¼Œä½†æ˜¯ä¸¤ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œ<strong>ä¸€ä¸ªå­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œä¸€ä¸ªå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>String ab2 = a+b;<br><span class="hljs-comment">//ç»“æœä¸ºfalse,å› ä¸ºabæ˜¯å­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œab2æ˜¯ç”±StringBufferçš„toStringæ–¹æ³•æ‰€è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br>System.out.println(ab == ab2);<br></code></pre></td></tr></table></figure>

<p>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡å¯¹è±¡</strong>çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		String a = <span class="hljs-string">&quot;a&quot;</span>;<br>		String b = <span class="hljs-string">&quot;b&quot;</span>;<br>		String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>		String ab2 = a+b;<br>		<span class="hljs-comment">//ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</span><br>		String ab3 = <span class="hljs-string">&quot;a&quot;</span> + <span class="hljs-string">&quot;b&quot;</span>;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åç¼–è¯‘åçš„ç»“æœ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell"> 	  Code:<br>      stack=2, locals=6, args_size=1<br>         0: ldc           #2                  // String a<br>         2: astore_1<br>         3: ldc           #3                  // String b<br>         5: astore_2<br>         6: ldc           #4                  // String ab<br>         8: astore_3<br>         9: new           #5                  // class java/lang/StringBuilder<br>        12: dup<br>        13: invokespecial #6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V<br>        16: aload_1<br>        17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String<br>;)Ljava/lang/StringBuilder;<br>        20: aload_2<br>        21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String<br>;)Ljava/lang/StringBuilder;<br>        24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/Str<br>ing;<br>        27: astore        4<br>        //ab3åˆå§‹åŒ–æ—¶ç›´æ¥ä»ä¸²æ± ä¸­è·å–å­—ç¬¦ä¸²<br>        29: ldc           #4                  // String ab<br>        31: astore        5<br>        33: return<br></code></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸º<strong>å†…å®¹æ˜¯å¸¸é‡ï¼Œjavacåœ¨ç¼–è¯‘æœŸä¼šè¿›è¡Œä¼˜åŒ–ï¼Œç»“æœå·²åœ¨ç¼–è¯‘æœŸç¡®å®šä¸ºab</strong>ï¼Œè€Œåˆ›å»ºabçš„æ—¶å€™å·²ç»åœ¨ä¸²æ± ä¸­æ”¾å…¥äº†â€œabâ€ï¼Œæ‰€ä»¥ab3ç›´æ¥ä»ä¸²æ± ä¸­è·å–å€¼ï¼Œæ‰€ä»¥è¿›è¡Œçš„æ“ä½œå’Œ ab = â€œabâ€ ä¸€è‡´ã€‚</li>
<li>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å˜é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸ºå†…å®¹æ˜¯å˜é‡ï¼Œåªèƒ½<strong>åœ¨è¿è¡ŒæœŸç¡®å®šå®ƒçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨StringBuilderæ¥åˆ›å»º</strong></li>
</ul>
<h5 id="internæ–¹æ³•-1-8"><a href="#internæ–¹æ³•-1-8" class="headerlink" title="internæ–¹æ³• 1.8"></a>internæ–¹æ³• 1.8</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p>
<ul>
<li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥æˆåŠŸ</li>
<li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li>
</ul>
<p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p>
<p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶å¦‚æœè°ƒç”¨internæ–¹æ³•æˆåŠŸï¼Œå †å†…å­˜ä¸ä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</p>
<p><strong>ä¾‹1</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-comment">//&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­ï¼Œstråˆ™å­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br>		String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);<br>		<span class="hljs-comment">//è°ƒç”¨strçš„internæ–¹æ³•ï¼Œè¿™æ—¶ä¸²æ± ä¸­æ²¡æœ‰&quot;ab&quot;ï¼Œåˆ™ä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥åˆ°ä¸²æ± ä¸­ï¼Œæ­¤æ—¶å †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span><br>		String st2 = str.intern();<br>		<span class="hljs-comment">//ç»™str3èµ‹å€¼ï¼Œå› ä¸ºæ­¤æ—¶ä¸²æ± ä¸­å·²æœ‰&quot;ab&quot;ï¼Œåˆ™ç›´æ¥å°†ä¸²æ± ä¸­çš„å†…å®¹è¿”å›</span><br>		String str3 = <span class="hljs-string">&quot;ab&quot;</span>;<br>		<span class="hljs-comment">//å› ä¸ºå †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä»¥ä¸‹ä¸¤æ¡è¯­å¥æ‰“å°çš„éƒ½ä¸ºtrue</span><br>		System.out.println(str == st2);<br>		System.out.println(str == str3);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>ä¾‹2</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//æ­¤å¤„åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡&quot;ab&quot;ï¼Œå› ä¸ºä¸²æ± ä¸­è¿˜æ²¡æœ‰&quot;ab&quot;ï¼Œæ‰€ä»¥å°†å…¶æ”¾å…¥ä¸²æ± ä¸­</span><br>		String str3 = <span class="hljs-string">&quot;ab&quot;</span>;<br>        <span class="hljs-comment">//&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­ï¼Œstråˆ™å­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br>		String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);<br>        <span class="hljs-comment">//æ­¤æ—¶å› ä¸ºåœ¨åˆ›å»ºstr3æ—¶ï¼Œ&quot;ab&quot;å·²å­˜åœ¨ä¸ä¸²æ± ä¸­ï¼Œæ‰€ä»¥æ”¾å…¥å¤±è´¥ï¼Œä½†æ˜¯ä¼šè¿”å›ä¸²æ± ä¸­çš„&quot;ab&quot;</span><br>		String str2 = str.intern();<br>        <span class="hljs-comment">//false</span><br>		System.out.println(str == str2);<br>        <span class="hljs-comment">//false</span><br>		System.out.println(str == str3);<br>        <span class="hljs-comment">//true</span><br>		System.out.println(str2 == str3);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="internæ–¹æ³•-1-6"><a href="#internæ–¹æ³•-1-6" class="headerlink" title="internæ–¹æ³• 1.6"></a>internæ–¹æ³• 1.6</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p>
<ul>
<li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œå†æ”¾å…¥åˆ°ä¸²æ± ä¸­</li>
<li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li>
</ul>
<p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p>
<p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶æ— è®ºè°ƒç”¨internæ–¹æ³•æˆåŠŸä¸å¦ï¼Œä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡å’Œå †å†…å­˜ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡<strong>éƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</strong></p>
<h4 id="StringTable-åƒåœ¾å›æ”¶"><a href="#StringTable-åƒåœ¾å›æ”¶" class="headerlink" title="StringTable åƒåœ¾å›æ”¶"></a>StringTable åƒåœ¾å›æ”¶</h4><p>StringTableåœ¨å†…å­˜ç´§å¼ æ—¶ï¼Œä¼šå‘ç”Ÿåƒåœ¾å›æ”¶</p>
<h4 id="StringTableè°ƒä¼˜"><a href="#StringTableè°ƒä¼˜" class="headerlink" title="StringTableè°ƒä¼˜"></a>StringTableè°ƒä¼˜</h4><ul>
<li><p>å› ä¸ºStringTableæ˜¯ç”±HashTableå®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥<strong>é€‚å½“å¢åŠ HashTableæ¡¶çš„ä¸ªæ•°</strong>ï¼Œæ¥å‡å°‘å­—ç¬¦ä¸²æ”¾å…¥ä¸²æ± æ‰€éœ€è¦çš„æ—¶é—´</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-XX:StringTableSize=xxxx<br></code></pre></td></tr></table></figure></li>
<li><p>è€ƒè™‘æ˜¯å¦éœ€è¦å°†å­—ç¬¦ä¸²å¯¹è±¡å…¥æ± </p>
<p>å¯ä»¥é€šè¿‡<strong>internæ–¹æ³•å‡å°‘é‡å¤å…¥æ± </strong></p>
</li>
</ul>
<h3 id="6ã€ç›´æ¥å†…å­˜"><a href="#6ã€ç›´æ¥å†…å­˜" class="headerlink" title="6ã€ç›´æ¥å†…å­˜"></a>6ã€ç›´æ¥å†…å­˜</h3><ul>
<li>å±äºæ“ä½œç³»ç»Ÿï¼Œå¸¸è§äºNIOæ“ä½œæ—¶ï¼Œ<strong>ç”¨äºæ•°æ®ç¼“å†²åŒº</strong></li>
<li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜</li>
<li>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</li>
</ul>
<h4 id="æ–‡ä»¶è¯»å†™æµç¨‹"><a href="#æ–‡ä»¶è¯»å†™æµç¨‹" class="headerlink" title="æ–‡ä»¶è¯»å†™æµç¨‹"></a>æ–‡ä»¶è¯»å†™æµç¨‹</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>ä½¿ç”¨äº†DirectBuffer</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç›´æ¥å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿå’ŒJavaä»£ç <strong>éƒ½å¯ä»¥è®¿é—®çš„ä¸€å—åŒºåŸŸ</strong>ï¼Œæ— éœ€å°†ä»£ç ä»ç³»ç»Ÿå†…å­˜å¤åˆ¶åˆ°Javaå †å†…å­˜ï¼Œä»è€Œæé«˜äº†æ•ˆç‡</p>
<h4 id="é‡Šæ”¾åŸç†"><a href="#é‡Šæ”¾åŸç†" class="headerlink" title="é‡Šæ”¾åŸç†"></a>é‡Šæ”¾åŸç†</h4><p>ç›´æ¥å†…å­˜çš„å›æ”¶ä¸æ˜¯é€šè¿‡JVMçš„åƒåœ¾å›æ”¶æ¥é‡Šæ”¾çš„ï¼Œè€Œæ˜¯é€šè¿‡<strong>unsafe.freeMemory</strong>æ¥æ‰‹åŠ¨é‡Šæ”¾</p>
<p>é€šè¿‡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é€šè¿‡ByteBufferç”³è¯·1Mçš„ç›´æ¥å†…å­˜</span><br>ByteBuffer byteBuffer = ByteBuffer.allocateDirect(_1M);<br></code></pre></td></tr></table></figure>

<p>ç”³è¯·ç›´æ¥å†…å­˜ï¼Œä½†JVMå¹¶ä¸èƒ½å›æ”¶ç›´æ¥å†…å­˜ä¸­çš„å†…å®¹ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°å›æ”¶çš„å‘¢ï¼Ÿ</p>
<p><strong>allocateDirectçš„å®ç°</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteBuffer <span class="hljs-title">allocateDirect</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectByteBuffer(capacity);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>DirectByteBufferç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">DirectByteBuffer(<span class="hljs-keyword">int</span> cap) &#123;   <span class="hljs-comment">// package-private</span><br>   <br>    <span class="hljs-keyword">super</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, cap, cap);<br>    <span class="hljs-keyword">boolean</span> pa = VM.isDirectMemoryPageAligned();<br>    <span class="hljs-keyword">int</span> ps = Bits.pageSize();<br>    <span class="hljs-keyword">long</span> size = Math.max(<span class="hljs-number">1L</span>, (<span class="hljs-keyword">long</span>)cap + (pa ? ps : <span class="hljs-number">0</span>));<br>    Bits.reserveMemory(size, cap);<br><br>    <span class="hljs-keyword">long</span> base = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        base = unsafe.allocateMemory(size); <span class="hljs-comment">//ç”³è¯·å†…å­˜</span><br>    &#125; <span class="hljs-keyword">catch</span> (OutOfMemoryError x) &#123;<br>        Bits.unreserveMemory(size, cap);<br>        <span class="hljs-keyword">throw</span> x;<br>    &#125;<br>    unsafe.setMemory(base, size, (<span class="hljs-keyword">byte</span>) <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (pa &amp;&amp; (base % ps != <span class="hljs-number">0</span>)) &#123;<br>        <span class="hljs-comment">// Round up to page boundary</span><br>        address = base + ps - (base &amp; (ps - <span class="hljs-number">1</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        address = base;<br>    &#125;<br>    cleaner = Cleaner.create(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> Deallocator(base, size, cap)); <span class="hljs-comment">//é€šè¿‡è™šå¼•ç”¨ï¼Œæ¥å®ç°ç›´æ¥å†…å­˜çš„é‡Šæ”¾ï¼Œthisä¸ºè™šå¼•ç”¨çš„å®é™…å¯¹è±¡</span><br>    att = <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªCleanerçš„createæ–¹æ³•ï¼Œä¸”åå°çº¿ç¨‹è¿˜ä¼šå¯¹è™šå¼•ç”¨çš„å¯¹è±¡ç›‘æµ‹ï¼Œå¦‚æœè™šå¼•ç”¨çš„å®é™…å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯DirectByteBufferï¼‰è¢«å›æ”¶ä»¥åï¼Œå°±ä¼šè°ƒç”¨Cleanerçš„cleanæ–¹æ³•ï¼Œæ¥æ¸…é™¤ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clean</span><span class="hljs-params">()</span> </span>&#123;<br>       <span class="hljs-keyword">if</span> (remove(<span class="hljs-keyword">this</span>)) &#123;<br>           <span class="hljs-keyword">try</span> &#123;<br>               <span class="hljs-keyword">this</span>.thunk.run(); <span class="hljs-comment">//è°ƒç”¨runæ–¹æ³•</span><br>           &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">final</span> Throwable var2) &#123;<br>               AccessController.doPrivileged(<span class="hljs-keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;<br>                   <span class="hljs-function"><span class="hljs-keyword">public</span> Void <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                       <span class="hljs-keyword">if</span> (System.err != <span class="hljs-keyword">null</span>) &#123;<br>                           (<span class="hljs-keyword">new</span> Error(<span class="hljs-string">&quot;Cleaner terminated abnormally&quot;</span>, var2)).printStackTrace();<br>                       &#125;<br><br>                       System.exit(<span class="hljs-number">1</span>);<br>                       <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>                   &#125;<br>               &#125;);<br>           &#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”å¯¹è±¡çš„runæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (address == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// Paranoia</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    unsafe.freeMemory(address); <span class="hljs-comment">//é‡Šæ”¾ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</span><br>    address = <span class="hljs-number">0</span>;<br>    Bits.unreserveMemory(size, capacity);<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"><a href="#ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“" class="headerlink" title="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"></a>ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“</h5><ul>
<li>ä½¿ç”¨äº†Unsafeç±»æ¥å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•</li>
<li>ByteBufferçš„å®ç°å†…éƒ¨ä½¿ç”¨äº†Cleanerï¼ˆè™šå¼•ç”¨ï¼‰æ¥æ£€æµ‹ByteBufferã€‚ä¸€æ—¦ByteBufferè¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆä¼šç”±ReferenceHandleræ¥è°ƒç”¨Cleanerçš„cleanæ–¹æ³•è°ƒç”¨freeMemoryæ¥é‡Šæ”¾å†…å­˜</li>
</ul>
<h2 id="ä¸‰ã€åƒåœ¾å›æ”¶"><a href="#ä¸‰ã€åƒåœ¾å›æ”¶" class="headerlink" title="ä¸‰ã€åƒåœ¾å›æ”¶"></a>ä¸‰ã€åƒåœ¾å›æ”¶</h2><h3 id="1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"><a href="#1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶" class="headerlink" title="1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"></a>1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h3><h4 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h4><p>å¼Šç«¯ï¼šå¾ªç¯å¼•ç”¨æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„è®¡æ•°éƒ½ä¸º1ï¼Œå¯¼è‡´ä¸¤ä¸ªå¯¹è±¡éƒ½æ— æ³•è¢«é‡Šæ”¾</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150750.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150750.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h4><ul>
<li>JVMä¸­çš„åƒåœ¾å›æ”¶å™¨é€šè¿‡<strong>å¯è¾¾æ€§åˆ†æ</strong>æ¥æ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡</li>
<li>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹èƒ½å¦æ²¿ç€GC Rootå¯¹è±¡ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¦‚æœ<strong>æ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å›æ”¶</strong></li>
<li>å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡<ul>
<li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚ã€€</li>
<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li>
<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
</li>
</ul>
<h4 id="äº”ç§å¼•ç”¨"><a href="#äº”ç§å¼•ç”¨" class="headerlink" title="äº”ç§å¼•ç”¨"></a>äº”ç§å¼•ç”¨</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150800.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150800.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h5><p>åªæœ‰GC Root<strong>éƒ½ä¸å¼•ç”¨</strong>è¯¥å¯¹è±¡æ—¶ï¼Œæ‰ä¼šå›æ”¶<strong>å¼ºå¼•ç”¨</strong>å¯¹è±¡</p>
<ul>
<li>å¦‚ä¸Šå›¾Bã€Cå¯¹è±¡éƒ½ä¸å¼•ç”¨A1å¯¹è±¡æ—¶ï¼ŒA1å¯¹è±¡æ‰ä¼šè¢«å›æ”¶</li>
</ul>
<h5 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h5><p>å½“GC RootæŒ‡å‘è½¯å¼•ç”¨å¯¹è±¡æ—¶ï¼Œåœ¨<strong>å†…å­˜ä¸è¶³æ—¶</strong>ï¼Œä¼š<strong>å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A2å¯¹è±¡ä¸”å†…å­˜ä¸è¶³æ—¶ï¼Œè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„A2å¯¹è±¡å°±ä¼šè¢«å›æ”¶</li>
</ul>
<h6 id="è½¯å¼•ç”¨çš„ä½¿ç”¨"><a href="#è½¯å¼•ç”¨çš„ä½¿ç”¨" class="headerlink" title="è½¯å¼•ç”¨çš„ä½¿ç”¨"></a>è½¯å¼•ç”¨çš„ä½¿ç”¨</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> _4M = <span class="hljs-number">4</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>;<br>		<span class="hljs-comment">//ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span><br>		List&lt;SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>		SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt; ref= <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[_4M]);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœåœ¨åƒåœ¾å›æ”¶æ—¶å‘ç°å†…å­˜ä¸è¶³ï¼Œåœ¨å›æ”¶è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œ<strong>è½¯å¼•ç”¨æœ¬èº«ä¸ä¼šè¢«æ¸…ç†</strong></p>
<p>å¦‚æœæƒ³è¦<strong>æ¸…ç†è½¯å¼•ç”¨</strong>ï¼Œéœ€è¦ä½¿<strong>ç”¨å¼•ç”¨é˜Ÿåˆ—</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> _4M = <span class="hljs-number">4</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>;<br>		<span class="hljs-comment">//ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—ï¼Œç”¨äºç§»é™¤å¼•ç”¨ä¸ºç©ºçš„è½¯å¼•ç”¨å¯¹è±¡</span><br>		ReferenceQueue&lt;<span class="hljs-keyword">byte</span>[]&gt; queue = <span class="hljs-keyword">new</span> ReferenceQueue&lt;&gt;();<br>		<span class="hljs-comment">//ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span><br>		List&lt;SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>		SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt; ref= <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[_4M]);<br><br>		<span class="hljs-comment">//éå†å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å…ƒç´ ï¼Œåˆ™ç§»é™¤</span><br>		Reference&lt;? extends <span class="hljs-keyword">byte</span>[]&gt; poll = queue.poll();<br>		<span class="hljs-keyword">while</span>(poll != <span class="hljs-keyword">null</span>) &#123;<br>			<span class="hljs-comment">//å¼•ç”¨é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™ä»é›†åˆä¸­ç§»é™¤è¯¥å…ƒç´ </span><br>			list.remove(poll);<br>			<span class="hljs-comment">//ç§»åŠ¨åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>			poll = queue.poll();<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>å¤§æ¦‚æ€è·¯ä¸ºï¼š</strong>æŸ¥çœ‹å¼•ç”¨é˜Ÿåˆ—ä¸­æœ‰æ— è½¯å¼•ç”¨ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å°†è¯¥è½¯å¼•ç”¨ä»å­˜æ”¾å®ƒçš„é›†åˆä¸­ç§»é™¤ï¼ˆè¿™é‡Œä¸ºä¸€ä¸ªlisté›†åˆï¼‰</p>
<h5 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h5><p>åªæœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œ<strong>æ— è®ºå†…å­˜æ˜¯å¦å……è¶³</strong>ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</p>
<ul>
<li>å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A3å¯¹è±¡ï¼Œåˆ™A3å¯¹è±¡ä¼šè¢«å›æ”¶</li>
</ul>
<p><strong>å¼±å¼•ç”¨çš„ä½¿ç”¨å’Œè½¯å¼•ç”¨ç±»ä¼¼</strong>ï¼Œåªæ˜¯å°† <strong>SoftReference æ¢ä¸ºäº† WeakReference</strong></p>
<h5 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a><strong>è™šå¼•ç”¨</strong></h5><p>å½“è™šå¼•ç”¨å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œè°ƒç”¨è™šå¼•ç”¨çš„æ–¹æ³•</p>
<ul>
<li>è™šå¼•ç”¨çš„ä¸€ä¸ªä½“ç°æ˜¯<strong>é‡Šæ”¾ç›´æ¥å†…å­˜æ‰€åˆ†é…çš„å†…å­˜</strong>ï¼Œå½“å¼•ç”¨çš„å¯¹è±¡ByteBufferè¢«åƒåœ¾å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡Cleanerå°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨Cleanerçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li>
<li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨ByteBufferå¯¹è±¡ï¼ŒByteBufferå°±ä¼šè¢«å›æ”¶ã€‚ä½†æ˜¯ç›´æ¥å†…å­˜ä¸­çš„å†…å­˜è¿˜æœªè¢«å›æ”¶ã€‚è¿™æ—¶éœ€è¦å°†è™šå¼•ç”¨å¯¹è±¡Cleaneræ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨å®ƒçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li>
</ul>
<h5 id="ç»ˆç»“å™¨å¼•ç”¨"><a href="#ç»ˆç»“å™¨å¼•ç”¨" class="headerlink" title="ç»ˆç»“å™¨å¼•ç”¨"></a>ç»ˆç»“å™¨å¼•ç”¨</h5><p>æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿è‡ªObjectç±»ï¼ŒObjectç±»æœ‰ä¸€ä¸ªfinalizeæ–¹æ³•ã€‚å½“æŸä¸ªå¯¹è±¡ä¸å†è¢«å…¶ä»–çš„å¯¹è±¡æ‰€å¼•ç”¨æ—¶ï¼Œä¼šå…ˆå°†ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ”¾å…¥é¥®ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åæ ¹æ®ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</p>
<ul>
<li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨A4å¯¹è±¡ã€‚è¿™æ˜¯ç»ˆç»“å™¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œå¼•ç”¨é˜Ÿåˆ—ä¼šæ ¹æ®å®ƒï¼Œæ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åè°ƒç”¨è¢«å¼•ç”¨å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</li>
</ul>
<h5 id="å¼•ç”¨é˜Ÿåˆ—"><a href="#å¼•ç”¨é˜Ÿåˆ—" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ—"></a>å¼•ç”¨é˜Ÿåˆ—</h5><ul>
<li>è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨<strong>å¯ä»¥é…åˆ</strong>å¼•ç”¨é˜Ÿåˆ—<ul>
<li>åœ¨<strong>å¼±å¼•ç”¨</strong>å’Œ<strong>è™šå¼•ç”¨</strong>æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œä¼šå°†è¿™äº›å¼•ç”¨æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œæ–¹ä¾¿ä¸€èµ·å›æ”¶è¿™äº›è½¯/å¼±å¼•ç”¨å¯¹è±¡</li>
</ul>
</li>
<li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨<strong>å¿…é¡»é…åˆ</strong>å¼•ç”¨é˜Ÿåˆ—<ul>
<li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨åœ¨ä½¿ç”¨æ—¶ä¼šå…³è”ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—</li>
</ul>
</li>
</ul>
<h3 id="2ã€åƒåœ¾å›æ”¶ç®—æ³•"><a href="#2ã€åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="2ã€åƒåœ¾å›æ”¶ç®—æ³•"></a>2ã€åƒåœ¾å›æ”¶ç®—æ³•</h3><h4 id="æ ‡è®°-æ¸…é™¤"><a href="#æ ‡è®°-æ¸…é™¤" class="headerlink" title="æ ‡è®°-æ¸…é™¤"></a>æ ‡è®°-æ¸…é™¤</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150813.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150813.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>å®šä¹‰</strong>ï¼šæ ‡è®°æ¸…é™¤ç®—æ³•é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‡åœ¨è™šæ‹Ÿæœºæ‰§è¡Œåƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆé‡‡ç”¨æ ‡è®°ç®—æ³•ç¡®å®šå¯å›æ”¶å¯¹è±¡ï¼Œç„¶ååƒåœ¾æ”¶é›†å™¨æ ¹æ®æ ‡è¯†æ¸…é™¤ç›¸åº”çš„å†…å®¹ï¼Œç»™å †å†…å­˜è…¾å‡ºç›¸åº”çš„ç©ºé—´</p>
<ul>
<li>è¿™é‡Œçš„è…¾å‡ºå†…å­˜ç©ºé—´å¹¶ä¸æ˜¯å°†å†…å­˜ç©ºé—´çš„å­—èŠ‚æ¸…0ï¼Œè€Œæ˜¯è®°å½•ä¸‹è¿™æ®µå†…å­˜çš„èµ·å§‹ç»“æŸåœ°å€ï¼Œä¸‹æ¬¡åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œä¼šç›´æ¥<strong>è¦†ç›–</strong>è¿™æ®µå†…å­˜</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š<strong>å®¹æ˜“äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡</strong>ï¼Œå¯èƒ½æ— æ³•æ»¡è¶³å¤§å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œä¸€æ—¦å¯¼è‡´æ— æ³•åˆ†é…å¯¹è±¡ï¼Œé‚£å°±ä¼šå¯¼è‡´jvmå¯åŠ¨gcï¼Œä¸€æ—¦å¯åŠ¨gcï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±ä¼šæš‚åœï¼Œè¿™å°±å¯¼è‡´åº”ç”¨çš„å“åº”é€Ÿåº¦å˜æ…¢</p>
<h4 id="æ ‡è®°-æ•´ç†"><a href="#æ ‡è®°-æ•´ç†" class="headerlink" title="æ ‡è®°-æ•´ç†"></a>æ ‡è®°-æ•´ç†</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150827.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150827.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ ‡è®°-æ•´ç† ä¼šå°†ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡å›æ”¶ï¼Œæ¸…æ¥šå…¶å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç„¶åæ•´ç†å‰©ä½™çš„å¯¹è±¡ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å› å†…å­˜ç¢ç‰‡è€Œå¯¼è‡´çš„é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ•´ä½“éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥æ•ˆç‡è¾ƒä½</p>
<h4 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h4><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150842.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150842.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150856.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150856.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150907.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150907.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150919.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150919.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å°†å†…å­˜åˆ†ä¸ºç­‰å¤§å°çš„ä¸¤ä¸ªåŒºåŸŸï¼ŒFROMå’ŒTOï¼ˆTOä¸­ä¸ºç©ºï¼‰ã€‚å…ˆå°†è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ä»FROMæ”¾å…¥TOä¸­ï¼Œå†å›æ”¶ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åäº¤æ¢FROMå’ŒTOã€‚è¿™æ ·ä¹Ÿå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šå ç”¨åŒå€çš„å†…å­˜ç©ºé—´ã€‚</p>
<h3 id="3ã€åˆ†ä»£å›æ”¶"><a href="#3ã€åˆ†ä»£å›æ”¶" class="headerlink" title="3ã€åˆ†ä»£å›æ”¶"></a>3ã€åˆ†ä»£å›æ”¶</h3><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150931.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150931.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="å›æ”¶æµç¨‹"><a href="#å›æ”¶æµç¨‹" class="headerlink" title="å›æ”¶æµç¨‹"></a>å›æ”¶æµç¨‹</h4><p>æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½è¢«æ”¾åœ¨äº†<strong>æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­</strong>ä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150939.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150939.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å½“ä¼Šç”¸å›­ä¸­çš„å†…å­˜ä¸è¶³æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œè¿™æ—¶çš„å›æ”¶å«åš <strong>Minor GC</strong></p>
<p>Minor GC ä¼šå°†<strong>ä¼Šç”¸å›­å’Œå¹¸å­˜åŒºFROM</strong>å­˜æ´»çš„å¯¹è±¡<strong>å…ˆ</strong>å¤åˆ¶åˆ° <strong>å¹¸å­˜åŒº TO</strong>ä¸­ï¼Œ å¹¶è®©å…¶<strong>å¯¿å‘½åŠ 1</strong>ï¼Œå†<strong>äº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒº</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150946.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150946.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150955.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150955.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151002.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151002.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å†æ¬¡åˆ›å»ºå¯¹è±¡ï¼Œè‹¥æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­åˆæ»¡äº†ï¼Œåˆ™ä¼š<strong>å†æ¬¡è§¦å‘ Minor GC</strong>ï¼ˆä¼šè§¦å‘ <strong>stop the world</strong>ï¼Œ æš‚åœå…¶ä»–ç”¨æˆ·çº¿ç¨‹ï¼Œåªè®©åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œï¼‰ï¼Œè¿™æ—¶ä¸ä»…ä¼šå›æ”¶ä¼Šç”¸å›­ä¸­çš„åƒåœ¾ï¼Œ<strong>è¿˜ä¼šå›æ”¶å¹¸å­˜åŒºä¸­çš„åƒåœ¾</strong>ï¼Œå†å°†æ´»è·ƒå¯¹è±¡å¤åˆ¶åˆ°å¹¸å­˜åŒºTOä¸­ã€‚å›æ”¶ä»¥åä¼šäº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒºï¼Œå¹¶è®©å¹¸å­˜åŒºä¸­çš„å¯¹è±¡<strong>å¯¿å‘½åŠ 1</strong></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151010.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151010.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å¦‚æœå¹¸å­˜åŒºä¸­çš„å¯¹è±¡çš„<strong>å¯¿å‘½è¶…è¿‡æŸä¸ªé˜ˆå€¼</strong>ï¼ˆæœ€å¤§ä¸º15ï¼Œ4bitï¼‰ï¼Œå°±ä¼šè¢«<strong>æ”¾å…¥è€å¹´ä»£</strong>ä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151018.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151018.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å¦‚æœæ–°ç”Ÿä»£è€å¹´ä»£ä¸­çš„å†…å­˜éƒ½æ»¡äº†ï¼Œå°±ä¼šå…ˆå‡ºæ³•Minor Gcï¼Œå†è§¦å‘<strong>Full GC</strong>ï¼Œæ‰«æ<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸­</strong>æ‰€æœ‰ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¹¶å›æ”¶</p>
<h4 id="GC-åˆ†æ"><a href="#GC-åˆ†æ" class="headerlink" title="GC åˆ†æ"></a>GC åˆ†æ</h4><h5 id="å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"><a href="#å¤§å¯¹è±¡å¤„ç†ç­–ç•¥" class="headerlink" title="å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"></a>å¤§å¯¹è±¡å¤„ç†ç­–ç•¥</h5><p>å½“é‡åˆ°ä¸€ä¸ª<strong>è¾ƒå¤§çš„å¯¹è±¡</strong>æ—¶ï¼Œå°±ç®—æ–°ç”Ÿä»£çš„<strong>ä¼Šç”¸å›­</strong>ä¸ºç©ºï¼Œä¹Ÿ<strong>æ— æ³•å®¹çº³è¯¥å¯¹è±¡</strong>æ—¶ï¼Œä¼šå°†è¯¥å¯¹è±¡<strong>ç›´æ¥æ™‹å‡ä¸ºè€å¹´ä»£</strong></p>
<h5 id="çº¿ç¨‹å†…å­˜æº¢å‡º"><a href="#çº¿ç¨‹å†…å­˜æº¢å‡º" class="headerlink" title="çº¿ç¨‹å†…å­˜æº¢å‡º"></a>çº¿ç¨‹å†…å­˜æº¢å‡º</h5><p>æŸä¸ªçº¿ç¨‹çš„å†…å­˜æº¢å‡ºäº†è€ŒæŠ›å¼‚å¸¸ï¼ˆout of memoryï¼‰ï¼Œä¸ä¼šè®©å…¶ä»–çš„çº¿ç¨‹ç»“æŸè¿è¡Œ</p>
<p>è¿™æ˜¯å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹<strong>æŠ›å‡ºOOMå¼‚å¸¸å</strong>ï¼Œ<strong>å®ƒæ‰€å æ®çš„å†…å­˜èµ„æºä¼šå…¨éƒ¨è¢«é‡Šæ”¾æ‰</strong>ï¼Œä»è€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œï¼Œ<strong>è¿›ç¨‹ä¾ç„¶æ­£å¸¸</strong></p>
<h3 id="4ã€åƒåœ¾å›æ”¶å™¨"><a href="#4ã€åƒåœ¾å›æ”¶å™¨" class="headerlink" title="4ã€åƒåœ¾å›æ”¶å™¨"></a>4ã€åƒåœ¾å›æ”¶å™¨</h3><h4 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h4><p><strong>å¹¶è¡Œæ”¶é›†</strong>ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶<strong>ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€</strong>ã€‚</p>
<p><strong>å¹¶å‘æ”¶é›†</strong>ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹<strong>åŒæ—¶å·¥ä½œ</strong>ï¼ˆä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„å¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ã€‚<strong>ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œ</strong>ï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œåœ¨å¦ä¸€ä¸ªCPUä¸Š</p>
<p><strong>ååé‡</strong>ï¼šå³CPUç”¨äº<strong>è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´</strong>ä¸CPU<strong>æ€»æ¶ˆè€—æ—¶é—´</strong>çš„æ¯”å€¼ï¼ˆååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ( è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ )ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€‚ä¾‹å¦‚ï¼šè™šæ‹Ÿæœºå…±è¿è¡Œ100åˆ†é’Ÿï¼Œåƒåœ¾æ”¶é›†å™¨èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯99%</p>
<h4 id="ä¸²è¡Œ"><a href="#ä¸²è¡Œ" class="headerlink" title="ä¸²è¡Œ"></a>ä¸²è¡Œ</h4><ul>
<li>å•çº¿ç¨‹</li>
<li>å†…å­˜è¾ƒå°ï¼Œä¸ªäººç”µè„‘ï¼ˆCPUæ ¸æ•°è¾ƒå°‘ï¼‰</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151027.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151027.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>å®‰å…¨ç‚¹</strong>ï¼šè®©å…¶ä»–çº¿ç¨‹éƒ½åœ¨è¿™ä¸ªç‚¹åœä¸‹æ¥ï¼Œä»¥å…åƒåœ¾å›æ”¶æ—¶ç§»åŠ¨å¯¹è±¡åœ°å€ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ‰¾ä¸åˆ°è¢«ç§»åŠ¨çš„å¯¹è±¡</p>
<p>å› ä¸ºæ˜¯ä¸²è¡Œçš„ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ä¸”åœ¨è¯¥çº¿ç¨‹æ‰§è¡Œå›æ”¶å·¥ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥<strong>é˜»å¡</strong>çŠ¶æ€</p>
<h5 id="Serial-æ”¶é›†å™¨"><a href="#Serial-æ”¶é›†å™¨" class="headerlink" title="Serial æ”¶é›†å™¨"></a>Serial æ”¶é›†å™¨</h5><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬çš„ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong>å•çº¿ç¨‹ã€ç®€å•é«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œé‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚å¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ‰‹æœºæ•ˆç‡ã€‚æ”¶é›†å™¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒç»“æŸï¼ˆStop The Worldï¼‰</p>
<h5 id="ParNew-æ”¶é›†å™¨"><a href="#ParNew-æ”¶é›†å™¨" class="headerlink" title="ParNew æ”¶é›†å™¨"></a>ParNew æ”¶é›†å™¨</h5><p>ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ã€ParNewæ”¶é›†å™¨é»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨CPUéå¸¸å¤šçš„ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨-XX:ParallelGCThreadså‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ã€‚å’ŒSerialæ”¶é›†å™¨ä¸€æ ·å­˜åœ¨Stop The Worldé—®é¢˜</p>
<h5 id="Serial-Old-æ”¶é›†å™¨"><a href="#Serial-Old-æ”¶é›†å™¨" class="headerlink" title="Serial Old æ”¶é›†å™¨"></a>Serial Old æ”¶é›†å™¨</h5><p>Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šåŒæ ·æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong></p>
<h4 id="ååé‡ä¼˜å…ˆ"><a href="#ååé‡ä¼˜å…ˆ" class="headerlink" title="ååé‡ä¼˜å…ˆ"></a>ååé‡ä¼˜å…ˆ</h4><ul>
<li>å¤šçº¿ç¨‹</li>
<li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li>
<li>å•ä½æ—¶é—´å†…ï¼ŒSTWï¼ˆstop the worldï¼Œåœæ‰å…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼‰æ—¶é—´æœ€çŸ­</li>
<li><strong>JDK1.8é»˜è®¤ä½¿ç”¨</strong>çš„åƒåœ¾å›æ”¶å™¨</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151039.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151039.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨"></a>Parallel Scavenge æ”¶é›†å™¨</h5><p>ä¸ååé‡å…³ç³»å¯†åˆ‡ï¼Œæ•…ä¹Ÿç§°ä¸ºååé‡ä¼˜å…ˆæ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå±äºæ–°ç”Ÿä»£æ”¶é›†å™¨ä¹Ÿæ˜¯é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>çš„æ”¶é›†å™¨ï¼ˆç”¨åˆ°äº†æ–°ç”Ÿä»£çš„å¹¸å­˜åŒºï¼‰ï¼Œåˆæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼ˆä¸ParNewæ”¶é›†å™¨ç±»ä¼¼ï¼‰</p>
<p>è¯¥æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ã€‚è¿˜æœ‰ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ç‚¹æ˜¯ï¼š<strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼ˆä¸ParNewæ”¶é›†å™¨æœ€é‡è¦çš„ä¸€ä¸ªåŒºåˆ«ï¼‰</p>
<p><strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼šParallel Scavengeæ”¶é›†å™¨å¯è®¾ç½®-XX:+UseAdptiveSizePolicyå‚æ•°ã€‚å½“å¼€å…³æ‰“å¼€æ—¶<strong>ä¸éœ€è¦</strong>æ‰‹åŠ¨æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRationï¼‰ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è®¾ç½®è¿™äº›å‚æ•°ä»¥æä¾›æœ€ä¼˜çš„åœé¡¿æ—¶é—´å’Œæœ€é«˜çš„ååé‡ï¼Œè¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºGCçš„è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚</p>
<p>Parallel Scavengeæ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š</p>
<ul>
<li>XX:MaxGCPauseMillis æ§åˆ¶æœ€å¤§çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´</li>
<li>XX:GCRatio ç›´æ¥è®¾ç½®ååé‡çš„å¤§å°</li>
</ul>
<h5 id="Parallel-Old-æ”¶é›†å™¨"><a href="#Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="Parallel Old æ”¶é›†å™¨"></a><strong>Parallel Old æ”¶é›†å™¨</strong></h5><p>æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼ˆè€å¹´ä»£æ²¡æœ‰å¹¸å­˜åŒºï¼‰</p>
<h4 id="å“åº”æ—¶é—´ä¼˜å…ˆ"><a href="#å“åº”æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="å“åº”æ—¶é—´ä¼˜å…ˆ"></a>å“åº”æ—¶é—´ä¼˜å…ˆ</h4><ul>
<li>å¤šçº¿ç¨‹</li>
<li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li>
<li>å°½å¯èƒ½è®©å•æ¬¡STWæ—¶é—´å˜çŸ­ï¼ˆå°½é‡ä¸å½±å“å…¶ä»–çº¿ç¨‹è¿è¡Œï¼‰</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151052.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151052.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h5><p>Concurrent Mark Sweepï¼Œä¸€ç§ä»¥è·å–<strong>æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„<strong>è€å¹´ä»£</strong>æ”¶é›†å™¨</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼šåŸºäº<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>å®ç°ã€‚å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæ³¨é‡æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒç­‰åœºæ™¯ä¸‹ã€‚å¦‚webç¨‹åºã€b/sæœåŠ¡</p>
<p><strong>CMSæ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š</strong></p>
<p><strong>åˆå§‹æ ‡è®°</strong>ï¼šæ ‡è®°GC Rootsèƒ½ç›´æ¥åˆ°çš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆå¿«ä½†æ˜¯<strong>ä»å­˜åœ¨Stop The Worldé—®é¢˜</strong></p>
<p><strong>å¹¶å‘æ ‡è®°</strong>ï¼šè¿›è¡ŒGC Roots Tracing çš„è¿‡ç¨‹ï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ä¸”ç”¨æˆ·çº¿ç¨‹å¯å¹¶å‘æ‰§è¡Œ</p>
<p><strong>é‡æ–°æ ‡è®°</strong>ï¼šä¸ºäº†<strong>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´</strong>å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚ä»ç„¶å­˜åœ¨Stop The Worldé—®é¢˜</p>
<p><strong>å¹¶å‘æ¸…é™¤</strong>ï¼šå¯¹æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤å›æ”¶</p>
<p>CMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·<strong>å¹¶å‘æ‰§è¡Œ</strong>çš„</p>
<h4 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h4><h5 id="å®šä¹‰ï¼š"><a href="#å®šä¹‰ï¼š" class="headerlink" title="å®šä¹‰ï¼š"></a><strong>å®šä¹‰</strong>ï¼š</h5><p>Garbage First</p>
<p>JDK 9ä»¥åé»˜è®¤ä½¿ç”¨ï¼Œè€Œä¸”æ›¿ä»£äº†CMS æ”¶é›†å™¨</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200909201212.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200909201212.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><ul>
<li>åŒæ—¶æ³¨é‡ååé‡å’Œä½å»¶è¿Ÿï¼ˆå“åº”æ—¶é—´ï¼‰</li>
<li>è¶…å¤§å †å†…å­˜ï¼ˆå†…å­˜å¤§çš„ï¼‰ï¼Œä¼šå°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ª<strong>å¤§å°ç›¸ç­‰</strong>çš„åŒºåŸŸ</li>
<li>æ•´ä½“ä¸Šæ˜¯<strong>æ ‡è®°-æ•´ç†</strong>ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸä¹‹é—´æ˜¯<strong>å¤åˆ¶</strong>ç®—æ³•</li>
</ul>
<p><strong>ç›¸å…³å‚æ•°</strong>ï¼šJDK8 å¹¶ä¸æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€éœ€è¦å‚æ•°å¼€å¯</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151100.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151100.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="G1åƒåœ¾å›æ”¶é˜¶æ®µ"><a href="#G1åƒåœ¾å›æ”¶é˜¶æ®µ" class="headerlink" title="G1åƒåœ¾å›æ”¶é˜¶æ®µ"></a>G1åƒåœ¾å›æ”¶é˜¶æ®µ</h5><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶â€”â€“&gt;å†…å­˜ä¸è¶³ï¼Œæ–°ç”Ÿä»£å›æ”¶+å¹¶å‘æ ‡è®°â€”â€“&gt;å›æ”¶æ–°ç”Ÿä»£ä¼Šç”¸å›­ã€å¹¸å­˜åŒºã€è€å¹´ä»£å†…å­˜â€”â€”&gt;æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶(é‡æ–°å¼€å§‹)</p>
<h5 id="Young-Collection"><a href="#Young-Collection" class="headerlink" title="Young Collection"></a>Young Collection</h5><p><strong>åˆ†åŒºç®—æ³•region</strong></p>
<p>åˆ†ä»£æ˜¯æŒ‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼Œåˆ†åŒºåˆ™æ˜¯å°†å †ç©ºé—´åˆ’åˆ†è¿ç»­å‡ ä¸ªä¸åŒå°åŒºé—´ï¼Œæ¯ä¸€ä¸ªå°åŒºé—´ç‹¬ç«‹å›æ”¶ï¼Œå¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ï¼Œæ–¹ä¾¿æ§åˆ¶ GC äº§ç”Ÿçš„åœé¡¿æ—¶é—´</p>
<p>Eï¼šä¼Šç”¸å›­ Sï¼šå¹¸å­˜åŒº Oï¼šè€å¹´ä»£</p>
<ul>
<li>ä¼šSTW</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151119.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151129.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151129.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151140.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151140.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="Young-Collection-CM"><a href="#Young-Collection-CM" class="headerlink" title="Young Collection + CM"></a>Young Collection + CM</h5><p>CMï¼šå¹¶å‘æ ‡è®°</p>
<ul>
<li>åœ¨ Young GC æ—¶ä¼š<strong>å¯¹ GC Root è¿›è¡Œåˆå§‹æ ‡è®°</strong></li>
<li>åœ¨è€å¹´ä»£<strong>å ç”¨å †å†…å­˜çš„æ¯”ä¾‹</strong>è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå¯¹è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆä¸ä¼šSTWï¼‰ï¼Œé˜ˆå€¼å¯ä»¥æ ¹æ®ç”¨æˆ·æ¥è¿›è¡Œè®¾å®š</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151150.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151150.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="Mixed-Collection"><a href="#Mixed-Collection" class="headerlink" title="Mixed Collection"></a>Mixed Collection</h5><p>ä¼šå¯¹E S O è¿›è¡Œ<strong>å…¨é¢çš„å›æ”¶</strong></p>
<ul>
<li>æœ€ç»ˆæ ‡è®°</li>
<li><strong>æ‹·è´</strong>å­˜æ´»</li>
</ul>
<p>-XX:MaxGCPauseMills:xxx ç”¨äºæŒ‡å®šæœ€é•¿çš„åœé¡¿æ—¶é—´</p>
<p><strong>é—®</strong>ï¼šä¸ºä»€ä¹ˆæœ‰çš„è€å¹´ä»£è¢«æ‹·è´äº†ï¼Œæœ‰çš„æ²¡æ‹·è´ï¼Ÿ</p>
<p>å› ä¸ºæŒ‡å®šäº†æœ€å¤§åœé¡¿æ—¶é—´ï¼Œå¦‚æœå¯¹æ‰€æœ‰è€å¹´ä»£éƒ½è¿›è¡Œå›æ”¶ï¼Œè€—æ—¶å¯èƒ½è¿‡é«˜ã€‚ä¸ºäº†ä¿è¯æ—¶é—´ä¸è¶…è¿‡è®¾å®šçš„åœé¡¿æ—¶é—´ï¼Œä¼š<strong>å›æ”¶æœ€æœ‰ä»·å€¼çš„è€å¹´ä»£</strong>ï¼ˆå›æ”¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ›´å¤šå†…å­˜ï¼‰</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151201.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151201.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h5><p>G1åœ¨è€å¹´ä»£å†…å­˜ä¸è¶³æ—¶ï¼ˆè€å¹´ä»£æ‰€å å†…å­˜è¶…è¿‡é˜ˆå€¼ï¼‰</p>
<ul>
<li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦æ…¢äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¸ä¼šè§¦å‘Full GCï¼Œè¿˜æ˜¯å¹¶å‘åœ°è¿›è¡Œæ¸…ç†</li>
<li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦å¿«äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¾¿ä¼šè§¦å‘Full GC</li>
</ul>
<h5 id="Young-Collection-è·¨ä»£å¼•ç”¨"><a href="#Young-Collection-è·¨ä»£å¼•ç”¨" class="headerlink" title="Young Collection è·¨ä»£å¼•ç”¨"></a>Young Collection è·¨ä»£å¼•ç”¨</h5><ul>
<li>æ–°ç”Ÿä»£å›æ”¶çš„è·¨ä»£å¼•ç”¨ï¼ˆè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£ï¼‰é—®é¢˜</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151211.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151211.png" srcset="/img/loading.gif" alt="img"></a></p>
<ul>
<li>å¡è¡¨ä¸Remembered Set<ul>
<li>Remembered Set å­˜åœ¨äºEä¸­ï¼Œç”¨äºä¿å­˜æ–°ç”Ÿä»£å¯¹è±¡å¯¹åº”çš„è„å¡<ul>
<li>è„å¡ï¼šOè¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼ˆä¸€ä¸ªåŒºåŸŸ512Kï¼‰ï¼Œå¦‚æœè¯¥åŒºåŸŸå¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼Œåˆ™è¯¥åŒºåŸŸè¢«ç§°ä¸ºè„å¡</li>
</ul>
</li>
</ul>
</li>
<li>åœ¨å¼•ç”¨å˜æ›´æ—¶é€šè¿‡post-write barried + dirty card queue</li>
<li>concurrent refinement threads æ›´æ–° Remembered Set</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151222.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151222.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="Remark"><a href="#Remark" class="headerlink" title="Remark"></a>Remark</h5><p>é‡æ–°æ ‡è®°é˜¶æ®µ</p>
<p>åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ”¶é›†å™¨å¤„ç†å¯¹è±¡çš„è¿‡ç¨‹ä¸­</p>
<p>é»‘è‰²ï¼šå·²è¢«å¤„ç†ï¼Œéœ€è¦ä¿ç•™çš„ ç°è‰²ï¼šæ­£åœ¨å¤„ç†ä¸­çš„ ç™½è‰²ï¼šè¿˜æœªå¤„ç†çš„</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151229.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151229.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä½†æ˜¯åœ¨<strong>å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­</strong>ï¼Œæœ‰å¯èƒ½Aè¢«å¤„ç†äº†ä»¥åæœªå¼•ç”¨Cï¼Œä½†è¯¥å¤„ç†è¿‡ç¨‹è¿˜æœªç»“æŸï¼Œåœ¨å¤„ç†è¿‡ç¨‹ç»“æŸä¹‹å‰Aå¼•ç”¨äº†Cï¼Œè¿™æ—¶å°±ä¼šç”¨åˆ°remark</p>
<p>è¿‡ç¨‹å¦‚ä¸‹</p>
<ul>
<li>ä¹‹å‰Cæœªè¢«å¼•ç”¨ï¼Œè¿™æ—¶Aå¼•ç”¨äº†Cï¼Œå°±ä¼šç»™CåŠ ä¸€ä¸ªå†™å±éšœï¼Œå†™å±éšœçš„æŒ‡ä»¤ä¼šè¢«æ‰§è¡Œï¼Œå°†Cæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­ï¼Œå¹¶å°†Cå˜ä¸º å¤„ç†ä¸­ çŠ¶æ€</li>
<li>åœ¨<strong>å¹¶å‘æ ‡è®°</strong>é˜¶æ®µç»“æŸä»¥åï¼Œé‡æ–°æ ‡è®°é˜¶æ®µä¼šSTWï¼Œç„¶åå°†æ”¾åœ¨è¯¥é˜Ÿåˆ—ä¸­çš„å¯¹è±¡é‡æ–°å¤„ç†ï¼Œå‘ç°æœ‰å¼ºå¼•ç”¨å¼•ç”¨å®ƒï¼Œå°±ä¼šå¤„ç†å®ƒ</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151239.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151239.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="JDK-8u20-å­—ç¬¦ä¸²å»é‡"><a href="#JDK-8u20-å­—ç¬¦ä¸²å»é‡" class="headerlink" title="JDK 8u20 å­—ç¬¦ä¸²å»é‡"></a>JDK 8u20 å­—ç¬¦ä¸²å»é‡</h5><p>è¿‡ç¨‹</p>
<ul>
<li>å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²ï¼ˆåº•å±‚æ˜¯char[]ï¼‰æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—</li>
<li>å½“æ–°ç”Ÿä»£å›æ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„å­—ç¬¦ä¸²</li>
<li>å¦‚æœå­—ç¬¦ä¸²çš„å€¼ä¸€æ ·ï¼Œå°±è®©ä»–ä»¬<strong>å¼•ç”¨åŒä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</strong></li>
<li>æ³¨æ„ï¼Œå…¶ä¸String.internçš„åŒºåˆ«<ul>
<li>internå…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡</li>
<li>å­—ç¬¦ä¸²å»é‡å…³æ³¨çš„æ˜¯char[]</li>
<li>åœ¨JVMå†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²æ ‡</li>
</ul>
</li>
</ul>
<p>ä¼˜ç‚¹ä¸ç¼ºç‚¹</p>
<ul>
<li>èŠ‚çœäº†å¤§é‡å†…å­˜</li>
<li>æ–°ç”Ÿä»£å›æ”¶æ—¶é—´ç•¥å¾®å¢åŠ ï¼Œå¯¼è‡´ç•¥å¾®å¤šå ç”¨CPU</li>
</ul>
<h5 id="JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½"><a href="#JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½" class="headerlink" title="JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½"></a>JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½</h5><p>åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸä»¥åï¼Œå°±èƒ½çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸åœ¨ä½¿ç”¨ï¼Œåˆ™å¸è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±»</p>
<h5 id="JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡"><a href="#JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡" class="headerlink" title="JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡"></a>JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡</h5><ul>
<li>ä¸€ä¸ªå¯¹è±¡å¤§äºregionçš„ä¸€åŠæ—¶ï¼Œå°±ç§°ä¸ºå·¨å‹å¯¹è±¡</li>
<li>G1ä¸ä¼šå¯¹å·¨å‹å¯¹è±¡è¿›è¡Œæ‹·è´</li>
<li>å›æ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘</li>
<li>G1ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰incomingå¼•ç”¨ï¼Œå¦‚æœè€å¹´ä»£incomingå¼•ç”¨ä¸º0çš„å·¨å‹å¯¹è±¡å°±å¯ä»¥åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶å¤„ç†æ‰</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151249.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151249.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="5ã€GC-è°ƒä¼˜"><a href="#5ã€GC-è°ƒä¼˜" class="headerlink" title="5ã€GC è°ƒä¼˜"></a>5ã€GC è°ƒä¼˜</h3><p>æŸ¥çœ‹è™šæ‹Ÿæœºå‚æ•°å‘½ä»¤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">&quot;F:\JAVA\JDK8.0\bin\java&quot; -XX:+PrintFlagsFinal -version | findstr &quot;GC&quot;<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥æ ¹æ®å‚æ•°å»æŸ¥è¯¢å…·ä½“çš„ä¿¡æ¯</p>
<h4 id="è°ƒä¼˜é¢†åŸŸ"><a href="#è°ƒä¼˜é¢†åŸŸ" class="headerlink" title="è°ƒä¼˜é¢†åŸŸ"></a>è°ƒä¼˜é¢†åŸŸ</h4><ul>
<li>å†…å­˜</li>
<li>é”ç«äº‰</li>
<li>CPUå ç”¨</li>
<li>IO</li>
<li>GC</li>
</ul>
<h4 id="ç¡®å®šç›®æ ‡"><a href="#ç¡®å®šç›®æ ‡" class="headerlink" title="ç¡®å®šç›®æ ‡"></a>ç¡®å®šç›®æ ‡</h4><p>ä½å»¶è¿Ÿ/é«˜ååé‡ï¼Ÿ é€‰æ‹©åˆé€‚çš„GC</p>
<ul>
<li>CMS G1 ZGC</li>
<li>ParallelGC</li>
<li>Zing</li>
</ul>
<h4 id="æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"><a href="#æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC" class="headerlink" title="æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"></a>æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC</h4><p>é¦–å…ˆæ’é™¤å‡å°‘å› ä¸ºè‡ªèº«ç¼–å†™çš„ä»£ç è€Œå¼•å‘çš„å†…å­˜é—®é¢˜</p>
<ul>
<li>æŸ¥çœ‹Full GCå‰åçš„å†…å­˜å ç”¨ï¼Œè€ƒè™‘ä»¥ä¸‹å‡ ä¸ªé—®é¢˜<ul>
<li>æ•°æ®æ˜¯ä¸æ˜¯å¤ªå¤šï¼Ÿ</li>
<li>æ•°æ®è¡¨ç¤ºæ˜¯å¦å¤ªè‡ƒè‚¿<ul>
<li>å¯¹è±¡å›¾</li>
<li>å¯¹è±¡å¤§å°</li>
</ul>
</li>
<li>æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼</li>
</ul>
</li>
</ul>
<h4 id="æ–°ç”Ÿä»£è°ƒä¼˜"><a href="#æ–°ç”Ÿä»£è°ƒä¼˜" class="headerlink" title="æ–°ç”Ÿä»£è°ƒä¼˜"></a>æ–°ç”Ÿä»£è°ƒä¼˜</h4><ul>
<li>æ–°ç”Ÿä»£çš„ç‰¹ç‚¹<ul>
<li>æ‰€æœ‰çš„newæ“ä½œåˆ†é…å†…å­˜éƒ½æ˜¯éå¸¸å»‰ä»·çš„<ul>
<li>TLAB</li>
</ul>
</li>
<li>æ­»äº¡å¯¹è±¡å›æ”¶é›¶ä»£ä»·</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡ç”¨è¿‡å³æ­»ï¼ˆæœç”Ÿå¤•æ­»ï¼‰</li>
<li>MInor GC æ‰€ç”¨æ—¶é—´è¿œå°äºFull GC</li>
</ul>
</li>
<li>æ–°ç”Ÿä»£å†…å­˜è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ<ul>
<li>ä¸æ˜¯<ul>
<li>æ–°ç”Ÿä»£å†…å­˜å¤ªå°ï¼šé¢‘ç¹è§¦å‘Minor GCï¼Œä¼šSTWï¼Œä¼šä½¿å¾—ååé‡ä¸‹é™</li>
<li>æ–°ç”Ÿä»£å†…å­˜å¤ªå¤§ï¼šè€å¹´ä»£å†…å­˜å æ¯”æœ‰æ‰€é™ä½ï¼Œä¼šæ›´é¢‘ç¹åœ°è§¦å‘Full GCã€‚è€Œä¸”è§¦å‘Minor GCæ—¶ï¼Œæ¸…ç†æ–°ç”Ÿä»£æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ›´é•¿</li>
</ul>
</li>
<li>æ–°ç”Ÿä»£å†…å­˜è®¾ç½®ä¸ºå†…å®¹çº³[å¹¶å‘é‡*(è¯·æ±‚-å“åº”)]çš„æ•°æ®ä¸ºå®œ</li>
</ul>
</li>
</ul>
<h4 id="å¹¸å­˜åŒºè°ƒä¼˜"><a href="#å¹¸å­˜åŒºè°ƒä¼˜" class="headerlink" title="å¹¸å­˜åŒºè°ƒä¼˜"></a>å¹¸å­˜åŒºè°ƒä¼˜</h4><ul>
<li>å¹¸å­˜åŒºéœ€è¦èƒ½å¤Ÿä¿å­˜ <strong>å½“å‰æ´»è·ƒå¯¹è±¡</strong>+<strong>éœ€è¦æ™‹å‡çš„å¯¹è±¡</strong></li>
<li>æ™‹å‡é˜ˆå€¼é…ç½®å¾—å½“ï¼Œè®©é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡å°½å¿«æ™‹å‡</li>
</ul>
<h4 id="è€å¹´ä»£è°ƒä¼˜"><a href="#è€å¹´ä»£è°ƒä¼˜" class="headerlink" title="è€å¹´ä»£è°ƒä¼˜"></a>è€å¹´ä»£è°ƒä¼˜</h4><h2 id="å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯"><a href="#å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯" class="headerlink" title="å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯"></a>å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯</h2><p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151300.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151300.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="1ã€ç±»æ–‡ä»¶ç»“æ„"><a href="#1ã€ç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="1ã€ç±»æ–‡ä»¶ç»“æ„"></a>1ã€ç±»æ–‡ä»¶ç»“æ„</h3><p>é¦–å…ˆè·å¾—.classå­—èŠ‚ç æ–‡ä»¶</p>
<p>æ–¹æ³•ï¼š</p>
<ul>
<li>åœ¨æ–‡æœ¬æ–‡æ¡£é‡Œå†™å…¥javaä»£ç ï¼ˆæ–‡ä»¶åä¸ç±»åä¸€è‡´ï¼‰ï¼Œå°†æ–‡ä»¶ç±»å‹æ”¹ä¸º.java</li>
<li>javaç»ˆç«¯ä¸­ï¼Œæ‰§è¡Œjavac X:â€¦\XXX.java</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200910155135.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200910155135.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä»¥ä¸‹æ˜¯å­—èŠ‚ç æ–‡ä»¶</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0000000</span> ca fe ba be <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">34</span> <span class="hljs-number">00</span> <span class="hljs-number">23</span> <span class="hljs-number">0</span>a <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">15</span> <span class="hljs-number">09</span> <br><span class="hljs-attribute">0000020</span> <span class="hljs-number">00</span> <span class="hljs-number">16</span> <span class="hljs-number">00</span> <span class="hljs-number">17</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">18</span> <span class="hljs-number">0</span>a <span class="hljs-number">00</span> <span class="hljs-number">19</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>a <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>b <span class="hljs-number">07</span> <br><span class="hljs-attribute">0000040</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>c <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">3</span>c <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">69</span> <span class="hljs-number">74</span> <span class="hljs-number">3</span>e <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">03</span> <span class="hljs-number">28</span> <span class="hljs-number">29</span> <br><span class="hljs-attribute">0000060</span> <span class="hljs-number">56</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">43</span> <span class="hljs-number">6</span>f <span class="hljs-number">64</span> <span class="hljs-number">65</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>f <span class="hljs-number">4</span>c <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">65</span> <span class="hljs-number">4</span>e <br><span class="hljs-attribute">0000100</span> <span class="hljs-number">75</span> <span class="hljs-number">6</span>d <span class="hljs-number">62</span> <span class="hljs-number">65</span> <span class="hljs-number">72</span> <span class="hljs-number">54</span> <span class="hljs-number">61</span> <span class="hljs-number">62</span> <span class="hljs-number">6</span>c <span class="hljs-number">65</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">12</span> <span class="hljs-number">4</span>c <span class="hljs-number">6</span>f <span class="hljs-number">63</span> <br><span class="hljs-attribute">0000120</span> <span class="hljs-number">61</span> <span class="hljs-number">6</span>c <span class="hljs-number">56</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">61</span> <span class="hljs-number">62</span> <span class="hljs-number">6</span>c <span class="hljs-number">65</span> <span class="hljs-number">54</span> <span class="hljs-number">61</span> <span class="hljs-number">62</span> <span class="hljs-number">6</span>c <span class="hljs-number">65</span> <span class="hljs-number">01</span> <br><span class="hljs-attribute">0000140</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">74</span> <span class="hljs-number">68</span> <span class="hljs-number">69</span> <span class="hljs-number">73</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>d <span class="hljs-number">4</span>c <span class="hljs-number">63</span> <span class="hljs-number">6</span>e <span class="hljs-number">2</span>f <span class="hljs-number">69</span> <span class="hljs-number">74</span> <span class="hljs-number">63</span> <br><span class="hljs-attribute">0000160</span> <span class="hljs-number">61</span> <span class="hljs-number">73</span> <span class="hljs-number">74</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>a <span class="hljs-number">76</span> <span class="hljs-number">6</span>d <span class="hljs-number">2</span>f <span class="hljs-number">74</span> <span class="hljs-number">35</span> <span class="hljs-number">2</span>f <span class="hljs-number">48</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <span class="hljs-number">6</span>f <br><span class="hljs-attribute">0000200</span> <span class="hljs-number">57</span> <span class="hljs-number">6</span>f <span class="hljs-number">72</span> <span class="hljs-number">6</span>c <span class="hljs-number">64</span> <span class="hljs-number">3</span>b <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">6</span>d <span class="hljs-number">61</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">16</span> <br><span class="hljs-attribute">0000220</span> <span class="hljs-number">28</span> <span class="hljs-number">5</span>b <span class="hljs-number">4</span>c <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <br><span class="hljs-attribute">0000240</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">3</span>b <span class="hljs-number">29</span> <span class="hljs-number">56</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">67</span> <span class="hljs-number">73</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">13</span> <br><span class="hljs-attribute">0000260</span> <span class="hljs-number">5</span>b <span class="hljs-number">4</span>c <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <br><span class="hljs-attribute">0000300</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">3</span>b <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">4</span>d <span class="hljs-number">65</span> <span class="hljs-number">74</span> <span class="hljs-number">68</span> <span class="hljs-number">6</span>f <span class="hljs-number">64</span> <span class="hljs-number">50</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">61</span> <br><span class="hljs-attribute">0000320</span> <span class="hljs-number">6</span>d <span class="hljs-number">65</span> <span class="hljs-number">74</span> <span class="hljs-number">65</span> <span class="hljs-number">72</span> <span class="hljs-number">73</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>a <span class="hljs-number">53</span> <span class="hljs-number">6</span>f <span class="hljs-number">75</span> <span class="hljs-number">72</span> <span class="hljs-number">63</span> <span class="hljs-number">65</span> <span class="hljs-number">46</span> <br><span class="hljs-attribute">0000340</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>c <span class="hljs-number">65</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>f <span class="hljs-number">48</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <span class="hljs-number">6</span>f <span class="hljs-number">57</span> <span class="hljs-number">6</span>f <span class="hljs-number">72</span> <span class="hljs-number">6</span>c <span class="hljs-number">64</span><br><span class="hljs-attribute">0000360</span> <span class="hljs-number">2</span>e <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">08</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>d <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">1</span>e <br><span class="hljs-attribute">0000400</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>f <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>b <span class="hljs-number">68</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <span class="hljs-number">6</span>f <span class="hljs-number">20</span> <span class="hljs-number">77</span> <span class="hljs-number">6</span>f <span class="hljs-number">72</span> <span class="hljs-number">6</span>c <span class="hljs-number">64</span> <br><span class="hljs-attribute">0000420</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">20</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">21</span> <span class="hljs-number">00</span> <span class="hljs-number">22</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>b <span class="hljs-number">63</span> <span class="hljs-number">6</span>e <span class="hljs-number">2</span>f <span class="hljs-number">69</span> <span class="hljs-number">74</span> <br><span class="hljs-attribute">0000440</span> <span class="hljs-number">63</span> <span class="hljs-number">61</span> <span class="hljs-number">73</span> <span class="hljs-number">74</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>a <span class="hljs-number">76</span> <span class="hljs-number">6</span>d <span class="hljs-number">2</span>f <span class="hljs-number">74</span> <span class="hljs-number">35</span> <span class="hljs-number">2</span>f <span class="hljs-number">48</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <br><span class="hljs-attribute">0000460</span> <span class="hljs-number">6</span>f <span class="hljs-number">57</span> <span class="hljs-number">6</span>f <span class="hljs-number">72</span> <span class="hljs-number">6</span>c <span class="hljs-number">64</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <br><span class="hljs-attribute">0000500</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">4</span>f <span class="hljs-number">62</span> <span class="hljs-number">6</span>a <span class="hljs-number">65</span> <span class="hljs-number">63</span> <span class="hljs-number">74</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <br><span class="hljs-attribute">0000520</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">79</span> <span class="hljs-number">73</span> <span class="hljs-number">74</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>d <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">03</span> <span class="hljs-number">6</span>f <br><span class="hljs-attribute">0000540</span> <span class="hljs-number">75</span> <span class="hljs-number">74</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">15</span> <span class="hljs-number">4</span>c <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">69</span> <span class="hljs-number">6</span>f <span class="hljs-number">2</span>f <span class="hljs-number">50</span> <span class="hljs-number">72</span> <br><span class="hljs-attribute">0000560</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">74</span> <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">65</span> <span class="hljs-number">61</span> <span class="hljs-number">6</span>d <span class="hljs-number">3</span>b <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">13</span> <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <br><span class="hljs-attribute">0000600</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">69</span> <span class="hljs-number">6</span>f <span class="hljs-number">2</span>f <span class="hljs-number">50</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">74</span> <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">65</span> <span class="hljs-number">61</span> <span class="hljs-number">6</span>d <br><span class="hljs-attribute">0000620</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">07</span> <span class="hljs-number">70</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">74</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>e <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">15</span> <span class="hljs-number">28</span> <span class="hljs-number">4</span>c <span class="hljs-number">6</span>a <br><span class="hljs-attribute">0000640</span> <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">3</span>b <br><span class="hljs-attribute">0000660</span> <span class="hljs-number">29</span> <span class="hljs-number">56</span> <span class="hljs-number">00</span> <span class="hljs-number">21</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <br><span class="hljs-attribute">0000700</span> <span class="hljs-number">00</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">09</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">2</span>f <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <br><span class="hljs-attribute">0000720</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">2</span>a b<span class="hljs-number">7</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> b<span class="hljs-number">1</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>a <span class="hljs-number">00</span> <br><span class="hljs-attribute">0000740</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>b <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <br><span class="hljs-attribute">0000760</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">0</span>d <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">09</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>e <span class="hljs-number">00</span> <br><span class="hljs-attribute">0001000</span> <span class="hljs-number">0</span>f <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">09</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">37</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">0001020</span> <span class="hljs-number">09</span> b<span class="hljs-number">2</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">12</span> <span class="hljs-number">03</span> b<span class="hljs-number">6</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> b<span class="hljs-number">1</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>a <br><span class="hljs-attribute">0001040</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>a <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>b <br><span class="hljs-attribute">0001060</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">09</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">00</span> <span class="hljs-number">11</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">0001100</span> <span class="hljs-number">00</span> <span class="hljs-number">12</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">13</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">0001120</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">14</span> <br></code></pre></td></tr></table></figure>

<p>æ ¹æ® JVM è§„èŒƒï¼Œ<strong>ç±»æ–‡ä»¶ç»“æ„</strong>å¦‚ä¸‹</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs abnf">u4 			 magic<br>u2             minor_version<span class="hljs-comment">;    </span><br>u2             major_version<span class="hljs-comment">;    </span><br>u2             constant_pool_count<span class="hljs-comment">;    </span><br>cp_info        constant_pool[constant_pool_count-<span class="hljs-number">1</span>]<span class="hljs-comment">;    </span><br>u2             access_flags<span class="hljs-comment">;    </span><br>u2             this_class<span class="hljs-comment">;    </span><br>u2             super_class<span class="hljs-comment">;   </span><br>u2             interfaces_count<span class="hljs-comment">;    </span><br>u2             interfaces[interfaces_count]<span class="hljs-comment">;   </span><br>u2             fields_count<span class="hljs-comment">;    </span><br>field_info     fields[fields_count]<span class="hljs-comment">;   </span><br>u2             methods_count<span class="hljs-comment">;    </span><br>method_info    methods[methods_count]<span class="hljs-comment">;    </span><br>u2             attributes_count<span class="hljs-comment">;    </span><br>attribute_info attributes[attributes_count]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure>

<h4 id="é­”æ•°"><a href="#é­”æ•°" class="headerlink" title="é­”æ•°"></a>é­”æ•°</h4><p>u4 magic</p>
<p>å¯¹åº”å­—èŠ‚ç æ–‡ä»¶çš„0~3ä¸ªå­—èŠ‚</p>
<p>0000000 <strong>ca fe ba be</strong> 00 00 00 34 00 23 0a 00 06 00 15 09</p>
<h4 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h4><p>u2 minor_version;</p>
<p>u2 major_version;</p>
<p>0000000 ca fe ba be <strong>00 00 00 34</strong> 00 23 0a 00 06 00 15 09</p>
<p>34H = 52ï¼Œä»£è¡¨JDK8</p>
<h4 id="å¸¸é‡æ± -1"><a href="#å¸¸é‡æ± -1" class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>è§èµ„æ–™æ–‡ä»¶</p>
<p>â€¦ç•¥</p>
<h3 id="2ã€å­—èŠ‚ç æŒ‡ä»¤"><a href="#2ã€å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="2ã€å­—èŠ‚ç æŒ‡ä»¤"></a>2ã€å­—èŠ‚ç æŒ‡ä»¤</h3><p>å¯å‚è€ƒ</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5</a></p>
<h4 id="javapå·¥å…·"><a href="#javapå·¥å…·" class="headerlink" title="javapå·¥å…·"></a>javapå·¥å…·</h4><p>Oracle æä¾›äº† <strong>javap</strong> å·¥å…·æ¥åç¼–è¯‘ class æ–‡ä»¶</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs shell">javap -v F:\Thread_study\src\com\nyima\JVM\day01\Main.classCopy<br>F:\Thread_study&gt;javap -v F:\Thread_study\src\com\nyima\JVM\day5\Demo1.class<br>Classfile /F:/Thread_study/src/com/nyima/JVM/day5/Demo1.class<br>  Last modified 2020-6-6; size 434 bytes<br>  MD5 checksum df1dce65bf6fb0b4c1de318051f4a67e<br>  Compiled from &quot;Demo1.java&quot;<br>public class com.nyima.JVM.day5.Demo1<br>  minor version: 0<br>  major version: 52<br>  flags: ACC_PUBLIC, ACC_SUPER<br>Constant pool:<br><span class="hljs-meta">   #</span><span class="bash">1 = Methodref          <span class="hljs-comment">#6.#15         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="hljs-meta">   #</span><span class="bash">2 = Fieldref           <span class="hljs-comment">#16.#17        // java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="hljs-meta">   #</span><span class="bash">3 = String             <span class="hljs-comment">#18            // hello world</span></span><br><span class="hljs-meta">   #</span><span class="bash">4 = Methodref          <span class="hljs-comment">#19.#20        // java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="hljs-meta">   #</span><span class="bash">5 = Class              <span class="hljs-comment">#21            // com/nyima/JVM/day5/Demo1</span></span><br><span class="hljs-meta">   #</span><span class="bash">6 = Class              <span class="hljs-comment">#22            // java/lang/Object</span></span><br><span class="hljs-meta">   #</span><span class="bash">7 = Utf8               &lt;init&gt;</span><br><span class="hljs-meta">   #</span><span class="bash">8 = Utf8               ()V</span><br><span class="hljs-meta">   #</span><span class="bash">9 = Utf8               Code</span><br><span class="hljs-meta">  #</span><span class="bash">10 = Utf8               LineNumberTable</span><br><span class="hljs-meta">  #</span><span class="bash">11 = Utf8               main</span><br><span class="hljs-meta">  #</span><span class="bash">12 = Utf8               ([Ljava/lang/String;)V</span><br><span class="hljs-meta">  #</span><span class="bash">13 = Utf8               SourceFile</span><br><span class="hljs-meta">  #</span><span class="bash">14 = Utf8               Demo1.java</span><br><span class="hljs-meta">  #</span><span class="bash">15 = NameAndType        <span class="hljs-comment">#7:#8          // &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="hljs-meta">  #</span><span class="bash">16 = Class              <span class="hljs-comment">#23            // java/lang/System</span></span><br><span class="hljs-meta">  #</span><span class="bash">17 = NameAndType        <span class="hljs-comment">#24:#25        // out:Ljava/io/PrintStream;</span></span><br><span class="hljs-meta">  #</span><span class="bash">18 = Utf8               hello world</span><br><span class="hljs-meta">  #</span><span class="bash">19 = Class              <span class="hljs-comment">#26            // java/io/PrintStream</span></span><br><span class="hljs-meta">  #</span><span class="bash">20 = NameAndType        <span class="hljs-comment">#27:#28        // println:(Ljava/lang/String;)V</span></span><br><span class="hljs-meta">  #</span><span class="bash">21 = Utf8               com/nyima/JVM/day5/Demo1</span><br><span class="hljs-meta">  #</span><span class="bash">22 = Utf8               java/lang/Object</span><br><span class="hljs-meta">  #</span><span class="bash">23 = Utf8               java/lang/System</span><br><span class="hljs-meta">  #</span><span class="bash">24 = Utf8               out</span><br><span class="hljs-meta">  #</span><span class="bash">25 = Utf8               Ljava/io/PrintStream;</span><br><span class="hljs-meta">  #</span><span class="bash">26 = Utf8               java/io/PrintStream</span><br><span class="hljs-meta">  #</span><span class="bash">27 = Utf8               println</span><br><span class="hljs-meta">  #</span><span class="bash">28 = Utf8               (Ljava/lang/String;)V</span><br>&#123;<br>  public com.nyima.JVM.day5.Demo1();<br>    descriptor: ()V<br>    flags: ACC_PUBLIC<br>    Code:<br>      stack=1, locals=1, args_size=1<br>         0: aload_0<br>         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V<br>         4: return<br>      LineNumberTable:<br>        line 7: 0<br><br>  public static void main(java.lang.String[]);<br>    descriptor: ([Ljava/lang/String;)V<br>    flags: ACC_PUBLIC, ACC_STATIC<br>    Code:<br>      stack=2, locals=1, args_size=1<br>         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;<br>         3: ldc           #3                  // String hello world<br>         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V<br><br>         8: return<br>      LineNumberTable:<br>        line 9: 0<br>        line 10: 8<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"><a href="#å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹" class="headerlink" title="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"></a>å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹</h4><p>ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3_1</span> </span>&#123;    <br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <br>		<span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;        <br>		<span class="hljs-keyword">int</span> b = Short.MAX_VALUE + <span class="hljs-number">1</span>;        <br>		<span class="hljs-keyword">int</span> c = a + b;        <br>		System.out.println(c);   <br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong></p>
<p>å¸¸é‡æ± ä¹Ÿå±äºæ–¹æ³•åŒºï¼Œåªä¸è¿‡è¿™é‡Œå•ç‹¬æå‡ºæ¥äº†</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151317.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151317.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº</strong></p>
<p>ï¼ˆstack=2ï¼Œlocals=4ï¼‰ å¯¹åº”æ“ä½œæ•°æ ˆæœ‰2ä¸ªç©ºé—´ï¼ˆæ¯ä¸ªç©ºé—´4ä¸ªå­—èŠ‚ï¼‰ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­æœ‰4ä¸ªæ§½ä½</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151325.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151325.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç </strong></p>
<p><strong>bipush 10</strong></p>
<ul>
<li><p>å°†ä¸€ä¸ª byte å‹å…¥æ“ä½œæ•°æ ˆ</p>
<p>ï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰</p>
<ul>
<li>sipush å°†ä¸€ä¸ª short å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰</li>
<li>ldc å°†ä¸€ä¸ª int å‹å…¥æ“ä½œæ•°æ ˆ</li>
<li>ldc2_w å°†ä¸€ä¸ª long å‹å…¥æ“ä½œæ•°æ ˆï¼ˆ<strong>åˆ†ä¸¤æ¬¡å‹å…¥</strong>ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰</li>
<li>è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œ<strong>è¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± </strong></li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151336.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151336.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>istore 1</strong></p>
<p>å°†æ“ä½œæ•°æ ˆæ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„slot 1ä¸­</p>
<p>å¯¹åº”ä»£ç ä¸­çš„</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">a</span> = <span class="hljs-number">10</span> <br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151346.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151346.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151412.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151412.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>ldc #3</strong></p>
<p>è¯»å–è¿è¡Œæ—¶å¸¸é‡æ± ä¸­#3ï¼Œå³32768(è¶…è¿‡shortæœ€å¤§å€¼èŒƒå›´çš„æ•°ä¼šè¢«æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­)ï¼Œå°†å…¶åŠ è½½åˆ°æ“ä½œæ•°æ ˆä¸­</p>
<p>æ³¨æ„ Short.MAX_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 = Short.MAX_VALUE + 1 å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å¥½çš„</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151421.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151421.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>istore 2</strong></p>
<p>å°†æ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¼¹å‡ºï¼Œæ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151432.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151432.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151441.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151441.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>iload1 iload2</strong></p>
<p>å°†å±€éƒ¨å˜é‡è¡¨ä¸­1å·ä½ç½®å’Œ2å·ä½ç½®çš„å…ƒç´ æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</p>
<ul>
<li>å› ä¸ºåªèƒ½åœ¨æ“ä½œæ•°æ ˆä¸­æ‰§è¡Œè¿ç®—æ“ä½œ</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151450.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151450.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151459.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151459.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>iadd</strong></p>
<p>å°†æ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªå…ƒç´ <strong>å¼¹å‡ºæ ˆ</strong>å¹¶ç›¸åŠ ï¼Œç»“æœåœ¨å‹å…¥æ“ä½œæ•°æ ˆä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151508.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151508.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151523.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151523.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>istore 3</strong></p>
<p>å°†æ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„3å·ä½ç½®</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151547.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151555.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151555.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>getstatic #4</strong></p>
<p>åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ‰¾åˆ°#4ï¼Œå‘ç°æ˜¯ä¸€ä¸ªå¯¹è±¡</p>
<p>åœ¨å †å†…å­˜ä¸­æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¹¶å°†å…¶<strong>å¼•ç”¨</strong>æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151605.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151605.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151613.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151613.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>iload 3</strong></p>
<p>å°†å±€éƒ¨å˜é‡è¡¨ä¸­3å·ä½ç½®çš„å…ƒç´ å‹å…¥æ“ä½œæ•°æ ˆä¸­</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151624.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151624.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>invokevirtual 5</strong></p>
<p>æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹ï¼Œå®šä½åˆ°æ–¹æ³•åŒº java/io/PrintStream.println:(I)V æ–¹æ³•</p>
<p>ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰</p>
<p>ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç </p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151632.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151632.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ‰§è¡Œå®Œæ¯•ï¼Œå¼¹å‡ºæ ˆå¸§</p>
<p>æ¸…é™¤ main æ“ä½œæ•°æ ˆå†…å®¹</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151640.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151640.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>return</strong><br>å®Œæˆ main æ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡º main æ ˆå¸§ï¼Œç¨‹åºç»“æŸ</p>
<h4 id="é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜"><a href="#é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜" class="headerlink" title="é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜"></a>é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜</h4><p>ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">int</span> x=<span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">while</span>(i&lt;<span class="hljs-number">10</span>) &#123;<br>			x = x++;<br>			i++;<br>		&#125;<br>		System.out.println(x); <span class="hljs-comment">//æ¥è¿‡ä¸º0</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä¸ºä»€ä¹ˆæœ€ç»ˆçš„xç»“æœä¸º0å‘¢ï¼Ÿ é€šè¿‡åˆ†æå­—èŠ‚ç æŒ‡ä»¤å³å¯çŸ¥æ™“</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=2, locals=3, args_size=1	//æ“ä½œæ•°æ ˆåˆ†é…2ä¸ªç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨åˆ†é…3ä¸ªç©ºé—´<br>        0: iconst_0	//å‡†å¤‡ä¸€ä¸ªå¸¸æ•°0<br>        1: istore_1	//å°†å¸¸æ•°0æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„1å·æ§½ä½ i=0<br>        2: iconst_0	//å‡†å¤‡ä¸€ä¸ªå¸¸æ•°0<br>        3: istore_2	//å°†å¸¸æ•°0æ”¾å…¥å±€éƒ¨å˜é‡çš„2å·æ§½ä½ x=0	<br>        4: iload_1		//å°†å±€éƒ¨å˜é‡è¡¨1å·æ§½ä½çš„æ•°æ”¾å…¥æ“ä½œæ•°æ ˆä¸­<br>        5: bipush        10	//å°†æ•°å­—10æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ­¤æ—¶æ“ä½œæ•°æ ˆä¸­æœ‰2ä¸ªæ•°<br>        7: if_icmpge     21	//æ¯”è¾ƒæ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªæ•°ï¼Œå¦‚æœä¸‹é¢çš„æ•°å¤§äºä¸Šé¢çš„æ•°ï¼Œå°±è·³è½¬åˆ°21ã€‚è¿™é‡Œçš„æ¯”è¾ƒæ˜¯å°†ä¸¤ä¸ªæ•°åšå‡æ³•ã€‚å› ä¸ºæ¶‰åŠè¿ç®—æ“ä½œï¼Œæ‰€ä»¥ä¼šå°†ä¸¤ä¸ªæ•°å¼¹å‡ºæ“ä½œæ•°æ ˆæ¥è¿›è¡Œè¿ç®—ã€‚è¿ç®—ç»“æŸåæ“ä½œæ•°æ ˆä¸ºç©º<br>       10: iload_2		//å°†å±€éƒ¨å˜é‡2å·æ§½ä½çš„æ•°æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ”¾å…¥çš„å€¼æ˜¯0<br>       11: iinc          2, 1	//å°†å±€éƒ¨å˜é‡2å·æ§½ä½çš„æ•°åŠ 1ï¼Œè‡ªå¢åï¼Œæ§½ä½ä¸­çš„å€¼ä¸º1<br>       14: istore_2	//å°†æ“ä½œæ•°æ ˆä¸­çš„æ•°æ”¾å…¥åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·æ§½ä½ï¼Œ2å·æ§½ä½çš„å€¼åˆå˜ä¸ºäº†0<br>       15: iinc          1, 1 //1å·æ§½ä½çš„å€¼è‡ªå¢1<br>       18: goto          4 //è·³è½¬åˆ°ç¬¬4æ¡æŒ‡ä»¤<br>       21: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;<br>       24: iload_2<br>       25: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V<br>       28: return<br></code></pre></td></tr></table></figure>

<h4 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h4><h5 id="cinit-V"><a href="#cinit-V" class="headerlink" title="cinit()V"></a>cinit()V</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br>	<span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;<br><br>	<span class="hljs-keyword">static</span> &#123;<br>		i = <span class="hljs-number">20</span>;<br>	&#125;<br><br>	<span class="hljs-keyword">static</span> &#123;<br>		i = <span class="hljs-number">30</span>;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		System.out.println(i); <span class="hljs-comment">//ç»“æœä¸º30</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¼šæŒ‰<strong>ä»ä¸Šè‡³ä¸‹</strong>çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œ<strong>åˆå¹¶</strong>ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• cinit()V ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">stack=1, locals=0, args_size=0<br>         0: bipush        10<br>         2: putstatic     #3                  // Field i:I<br>         5: bipush        20<br>         7: putstatic     #3                  // Field i:I<br>        10: bipush        30<br>        12: putstatic     #3                  // Field i:I<br>        15: return<br></code></pre></td></tr></table></figure>

<h5 id="init-V"><a href="#init-V" class="headerlink" title="init()V"></a>init()V</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br>	<span class="hljs-keyword">private</span> String a = <span class="hljs-string">&quot;s1&quot;</span>;<br><br>	&#123;<br>		b = <span class="hljs-number">20</span>;<br>	&#125;<br><br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> b = <span class="hljs-number">10</span>;<br><br>	&#123;<br>		a = <span class="hljs-string">&quot;s2&quot;</span>;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo4</span><span class="hljs-params">(String a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br>		<span class="hljs-keyword">this</span>.a = a;<br>		<span class="hljs-keyword">this</span>.b = b;<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		Demo4 d = <span class="hljs-keyword">new</span> Demo4(<span class="hljs-string">&quot;s3&quot;</span>, <span class="hljs-number">30</span>);<br>		System.out.println(d.a);<br>		System.out.println(d.b);<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¼šæŒ‰<strong>ä»ä¸Šè‡³ä¸‹</strong>çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ {} ä»£ç å—å’Œæˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œ<strong>å½¢æˆæ–°çš„æ„é€ æ–¹æ³•</strong>ï¼Œä½†<strong>åŸå§‹æ„é€ æ–¹æ³•</strong>å†…çš„ä»£ç <strong>æ€»æ˜¯åœ¨å</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=2, locals=3, args_size=3<br>        0: aload_0<br>        1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V<br>        4: aload_0<br>        5: ldc           #2                  // String s1<br>        7: putfield      #3                  // Field a:Ljava/lang/String;<br>       10: aload_0<br>       11: bipush        20<br>       13: putfield      #4                  // Field b:I<br>       16: aload_0<br>       17: bipush        10<br>       19: putfield      #4                  // Field b:I<br>       22: aload_0<br>       23: ldc           #5                  // String s2<br>       25: putfield      #3                  // Field a:Ljava/lang/String;<br>       //åŸå§‹æ„é€ æ–¹æ³•åœ¨æœ€åæ‰§è¡Œ<br>       28: aload_0<br>       29: aload_1<br>       30: putfield      #3                  // Field a:Ljava/lang/String;<br>       33: aload_0<br>       34: iload_2<br>       35: putfield      #4                  // Field b:I<br>       38: return<br></code></pre></td></tr></table></figure>

<h4 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo5</span><span class="hljs-params">()</span> </span>&#123;<br><br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;<br><br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span> </span>&#123;<br><br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> </span>&#123;<br><br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test4</span><span class="hljs-params">()</span> </span>&#123;<br><br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		Demo5 demo5 = <span class="hljs-keyword">new</span> Demo5();<br>		demo5.test1();<br>		demo5.test2();<br>		demo5.test3();<br>		Demo5.test4();<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä¸åŒæ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œå¯¹åº”çš„è™šæ‹ŸæœºæŒ‡ä»¤æœ‰æ‰€åŒºåˆ«</p>
<ul>
<li>ç§æœ‰ã€æ„é€ ã€è¢«finalä¿®é¥°çš„æ–¹æ³•ï¼Œåœ¨è°ƒç”¨æ—¶éƒ½ä½¿ç”¨<strong>invokespecial</strong>æŒ‡ä»¤</li>
<li>æ™®é€šæˆå‘˜æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨invokespecialæŒ‡ä»¤ã€‚å› ä¸ºç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šè¯¥æ–¹æ³•çš„å†…å®¹ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®š</li>
<li>é™æ€æ–¹æ³•åœ¨è°ƒç”¨æ—¶ä½¿ç”¨invokestaticæŒ‡ä»¤</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>      stack=2, locals=2, args_size=1<br>         0: new           #2                  // class com/nyima/JVM/day5/Demo5 <br>         3: dup<br>         4: invokespecial #3                  // Method &quot;&lt;init&gt;&quot;:()V<br>         7: astore_1<br>         8: aload_1<br>         9: invokespecial #4                  // Method test1:()V<br>        12: aload_1<br>        13: invokespecial #5                  // Method test2:()V<br>        16: aload_1<br>        17: invokevirtual #6                  // Method test3:()V<br>        20: invokestatic  #7                  // Method test4:()V<br>        23: return<br></code></pre></td></tr></table></figure>

<ul>
<li>new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€<strong>å¯¹è±¡å¼•ç”¨</strong>ã€‘å‹å…¥æ“ä½œæ•°æ ˆ</li>
<li>dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€<strong>å¯¹è±¡å¼•ç”¨</strong>ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é…åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³• â€œinitâ€:()V ï¼ˆä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨ï¼‰ï¼Œå¦ä¸€ä¸ªè¦ é…åˆ astore_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡</li>
<li>ç»ˆæ–¹æ³•ï¼ˆï¬nalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™æ€ç»‘å®š</li>
<li>æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äº<strong>åŠ¨æ€ç»‘å®š</strong>ï¼Œå³æ”¯æŒå¤šæ€ æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘</li>
</ul>
<h4 id="å¤šæ€åŸç†"><a href="#å¤šæ€åŸç†" class="headerlink" title="å¤šæ€åŸç†"></a>å¤šæ€åŸç†</h4><p>å› ä¸ºæ™®é€šæˆå‘˜æ–¹æ³•éœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…·ä½“çš„å†…å®¹ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºéœ€è¦è°ƒç”¨<strong>invokevirtual</strong>æŒ‡ä»¤</p>
<p>åœ¨æ‰§è¡ŒinvokevirtualæŒ‡ä»¤æ—¶ï¼Œç»å†äº†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p>
<ul>
<li>å…ˆé€šè¿‡æ ˆå¸§ä¸­å¯¹è±¡çš„å¼•ç”¨æ‰¾åˆ°å¯¹è±¡</li>
<li>åˆ†æå¯¹è±¡å¤´ï¼Œæ‰¾åˆ°å¯¹è±¡å®é™…çš„Class</li>
<li>Classç»“æ„ä¸­æœ‰<strong>vtable</strong></li>
<li>æŸ¥è¯¢vtableæ‰¾åˆ°æ–¹æ³•çš„å…·ä½“åœ°å€</li>
<li>æ‰§è¡Œæ–¹æ³•çš„å­—èŠ‚ç </li>
</ul>
<h4 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h4><h5 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">try</span> &#123;<br>			i = <span class="hljs-number">10</span>;<br>		&#125;<span class="hljs-keyword">catch</span> (Exception e) &#123;<br>			i = <span class="hljs-number">20</span>;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç æŒ‡ä»¤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=3, args_size=1<br>        0: iconst_0<br>        1: istore_1<br>        2: bipush        10<br>        4: istore_1<br>        5: goto          12<br>        8: astore_2<br>        9: bipush        20<br>       11: istore_1<br>       12: return<br>     //å¤šå‡ºæ¥ä¸€ä¸ªå¼‚å¸¸è¡¨<br>     Exception table:<br>        from    to  target type<br>            2     5     8   Class java/lang/Exception<br></code></pre></td></tr></table></figure>

<ul>
<li>å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ª Exception table çš„ç»“æ„ï¼Œ[from, to) æ˜¯<strong>å‰é—­åå¼€</strong>ï¼ˆä¹Ÿå°±æ˜¯æ£€æµ‹2~4è¡Œï¼‰çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå·</li>
<li>8è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®ï¼ˆä¸ºeï¼‰</li>
</ul>
<h5 id="å¤šä¸ªsingle-catch"><a href="#å¤šä¸ªsingle-catch" class="headerlink" title="å¤šä¸ªsingle-catch"></a>å¤šä¸ªsingle-catch</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">try</span> &#123;<br>			i = <span class="hljs-number">10</span>;<br>		&#125;<span class="hljs-keyword">catch</span> (ArithmeticException e) &#123;<br>			i = <span class="hljs-number">20</span>;<br>		&#125;<span class="hljs-keyword">catch</span> (Exception e) &#123;<br>			i = <span class="hljs-number">30</span>;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”çš„å­—èŠ‚ç </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=3, args_size=1<br>        0: iconst_0<br>        1: istore_1<br>        2: bipush        10<br>        4: istore_1<br>        5: goto          19<br>        8: astore_2<br>        9: bipush        20<br>       11: istore_1<br>       12: goto          19<br>       15: astore_2<br>       16: bipush        30<br>       18: istore_1<br>       19: return<br>     Exception table:<br>        from    to  target type<br>            2     5     8   Class java/lang/ArithmeticException<br>            2     5    15   Class java/lang/Exception<br></code></pre></td></tr></table></figure>

<ul>
<li>å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œ<strong>åªèƒ½è¿›å…¥</strong> Exception table ä¸­<strong>ä¸€ä¸ªåˆ†æ”¯</strong>ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot 2 ä½ç½®<strong>è¢«å…±ç”¨</strong></li>
</ul>
<h5 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>		<span class="hljs-keyword">try</span> &#123;<br>			i = <span class="hljs-number">10</span>;<br>		&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>			i = <span class="hljs-number">20</span>;<br>		&#125; <span class="hljs-keyword">finally</span> &#123;<br>			i = <span class="hljs-number">30</span>;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=4, args_size=1<br>        0: iconst_0<br>        1: istore_1<br>        //tryå—<br>        2: bipush        10<br>        4: istore_1<br>        //tryå—æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡Œfinally    <br>        5: bipush        30<br>        7: istore_1<br>        8: goto          27<br>       //catchå—     <br>       11: astore_2 //å¼‚å¸¸ä¿¡æ¯æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·æ§½ä½<br>       12: bipush        20<br>       14: istore_1<br>       //catchå—æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡Œfinally        <br>       15: bipush        30<br>       17: istore_1<br>       18: goto          27<br>       //å‡ºç°å¼‚å¸¸ï¼Œä½†æœªè¢«Exceptionæ•è·ï¼Œä¼šæŠ›å‡ºå…¶ä»–å¼‚å¸¸ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦æ‰§è¡Œfinallyå—ä¸­çš„ä»£ç    <br>       21: astore_3<br>       22: bipush        30<br>       24: istore_1<br>       25: aload_3<br>       26: athrow  //æŠ›å‡ºå¼‚å¸¸<br>       27: return<br>     Exception table:<br>        from    to  target type<br>            2     5    11   Class java/lang/Exception<br>            2     5    21   any<br>           11    15    21   any<br></code></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ° ï¬nally ä¸­çš„ä»£ç è¢«<strong>å¤åˆ¶äº† 3 ä»½</strong>ï¼Œåˆ†åˆ«æ”¾å…¥ try æµç¨‹ï¼Œcatch æµç¨‹ä»¥åŠ catchå‰©ä½™çš„å¼‚å¸¸ç±»å‹æµç¨‹</p>
<p><strong>æ³¨æ„</strong>ï¼šè™½ç„¶ä»å­—èŠ‚ç æŒ‡ä»¤çœ‹æ¥ï¼Œæ¯ä¸ªå—ä¸­éƒ½æœ‰finallyå—ï¼Œä½†æ˜¯finallyå—ä¸­çš„ä»£ç <strong>åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡</strong></p>
<h5 id="finallyä¸­çš„return"><a href="#finallyä¸­çš„return" class="headerlink" title="finallyä¸­çš„return"></a>finallyä¸­çš„return</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i = Demo3.test();<br>        <span class="hljs-comment">//ç»“æœä¸º20</span><br>		System.out.println(i);<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i;<br>		<span class="hljs-keyword">try</span> &#123;<br>			i = <span class="hljs-number">10</span>;<br>			<span class="hljs-keyword">return</span> i;<br>		&#125; <span class="hljs-keyword">finally</span> &#123;<br>			i = <span class="hljs-number">20</span>;<br>			<span class="hljs-keyword">return</span> i;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=3, args_size=0<br>        0: bipush        10<br>        2: istore_0<br>        3: iload_0<br>        4: istore_1  //æš‚å­˜è¿”å›å€¼<br>        5: bipush        20<br>        7: istore_0<br>        8: iload_0<br>        9: ireturn	//ireturnä¼šè¿”å›æ“ä½œæ•°æ ˆé¡¶çš„æ•´å‹å€¼20<br>       //å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œè¿˜æ˜¯ä¼šæ‰§è¡Œfinallyå—ä¸­çš„å†…å®¹ï¼Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸<br>       10: astore_2<br>       11: bipush        20<br>       13: istore_0<br>       14: iload_0<br>       15: ireturn	//è¿™é‡Œæ²¡æœ‰athrowäº†ï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨finallyå—ä¸­å¦‚æœæœ‰è¿”å›æ“ä½œçš„è¯ï¼Œä¸”tryå—ä¸­å‡ºç°å¼‚å¸¸ï¼Œä¼šåæ‰å¼‚å¸¸ï¼<br>     Exception table:<br>        from    to  target type<br>            0     5    10   any<br></code></pre></td></tr></table></figure>

<ul>
<li>ç”±äº ï¬nally ä¸­çš„ <strong>ireturn</strong> è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›ç»“æœè‚¯å®šä»¥ï¬nallyçš„ä¸ºå‡†</li>
<li>è‡³äºå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹æ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­</li>
<li>è·Ÿä¸Šä¾‹ä¸­çš„ ï¬nally ç›¸æ¯”ï¼Œå‘ç°<strong>æ²¡æœ‰ athrow äº†</strong>ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœåœ¨ ï¬nally ä¸­å‡ºç°äº† returnï¼Œä¼š<strong>åæ‰å¼‚å¸¸</strong></li>
<li>æ‰€ä»¥<strong>ä¸è¦åœ¨finallyä¸­è¿›è¡Œè¿”å›æ“ä½œ</strong></li>
</ul>
<h5 id="è¢«åæ‰çš„å¼‚å¸¸"><a href="#è¢«åæ‰çš„å¼‚å¸¸" class="headerlink" title="è¢«åæ‰çš„å¼‚å¸¸"></a>è¢«åæ‰çš„å¼‚å¸¸</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> i = Demo3.test();<br>      <span class="hljs-comment">//æœ€ç»ˆç»“æœä¸º20</span><br>      System.out.println(i);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> i;<br>      <span class="hljs-keyword">try</span> &#123;<br>         i = <span class="hljs-number">10</span>;<br>         <span class="hljs-comment">//è¿™é‡Œåº”è¯¥ä¼šæŠ›å‡ºå¼‚å¸¸</span><br>         i = i/<span class="hljs-number">0</span>;<br>         <span class="hljs-keyword">return</span> i;<br>      &#125; <span class="hljs-keyword">finally</span> &#123;<br>         i = <span class="hljs-number">20</span>;<br>         <span class="hljs-keyword">return</span> i;<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ä¼šå‘ç°æ‰“å°ç»“æœä¸º20ï¼Œå¹¶æœªæŠ›å‡ºå¼‚å¸¸</p>
<h5 id="finallyä¸å¸¦return"><a href="#finallyä¸å¸¦return" class="headerlink" title="finallyä¸å¸¦return"></a>finallyä¸å¸¦return</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i = Demo4.test();<br>		System.out.println(i);<br>	&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-keyword">return</span> i;<br>		&#125; <span class="hljs-keyword">finally</span> &#123;<br>			i = <span class="hljs-number">20</span>;<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=3, args_size=0<br>        0: bipush        10<br>        2: istore_0 //èµ‹å€¼ç»™i 10<br>        3: iload_0	//åŠ è½½åˆ°æ“ä½œæ•°æ ˆé¡¶<br>        4: istore_1 //åŠ è½½åˆ°å±€éƒ¨å˜é‡è¡¨çš„1å·ä½ç½®<br>        5: bipush        20<br>        7: istore_0 //èµ‹å€¼ç»™i 20<br>        8: iload_1 //åŠ è½½å±€éƒ¨å˜é‡è¡¨1å·ä½ç½®çš„æ•°10åˆ°æ“ä½œæ•°æ ˆ<br>        9: ireturn //è¿”å›æ“ä½œæ•°æ ˆé¡¶å…ƒç´  10<br>       10: astore_2<br>       11: bipush        20<br>       13: istore_0<br>       14: aload_2 //åŠ è½½å¼‚å¸¸<br>       15: athrow //æŠ›å‡ºå¼‚å¸¸<br>     Exception table:<br>        from    to  target type<br>            3     5    10   any<br></code></pre></td></tr></table></figure>

<h4 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;<br>		Lock lock = <span class="hljs-keyword">new</span> Lock();<br>		<span class="hljs-keyword">synchronized</span> (lock) &#123;<br>			System.out.println(i);<br>		&#125;<br>	&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock</span></span>&#123;&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=2, locals=5, args_size=1<br>        0: bipush        10<br>        2: istore_1<br>        3: new           #2                  // class com/nyima/JVM/day06/Lock<br>        6: dup //å¤åˆ¶ä¸€ä»½ï¼Œæ”¾åˆ°æ“ä½œæ•°æ ˆé¡¶ï¼Œç”¨äºæ„é€ å‡½æ•°æ¶ˆè€—<br>        7: invokespecial #3                  // Method com/nyima/JVM/day06/Lock.&quot;&lt;init&gt;&quot;:()V<br>       10: astore_2 //å‰©ä¸‹çš„ä¸€ä»½æ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®<br>       11: aload_2 //åŠ è½½åˆ°æ“ä½œæ•°æ ˆ<br>       12: dup //å¤åˆ¶ä¸€ä»½ï¼Œæ”¾åˆ°æ“ä½œæ•°æ ˆï¼Œç”¨äºåŠ é”æ—¶æ¶ˆè€—<br>       13: astore_3 //å°†æ“ä½œæ•°æ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæš‚å­˜åˆ°å±€éƒ¨å˜é‡è¡¨çš„ä¸‰å·æ§½ä½ã€‚è¿™æ—¶æ“ä½œæ•°æ ˆä¸­æœ‰ä¸€ä»½å¯¹è±¡çš„å¼•ç”¨<br>       14: monitorenter //åŠ é”<br>       //é”ä½åä»£ç å—ä¸­çš„æ“ä½œ    <br>       15: getstatic     #4                  // Field java/lang/System.out:Ljava/io/PrintStream;<br>       18: iload_1<br>       19: invokevirtual #5                  // Method java/io/PrintStream.println:(I)V<br>       //åŠ è½½å±€éƒ¨å˜é‡è¡¨ä¸­ä¸‰å·æ§½ä½å¯¹è±¡çš„å¼•ç”¨ï¼Œç”¨äºè§£é”    <br>       22: aload_3    <br>       23: monitorexit //è§£é”<br>       24: goto          34<br>       //å¼‚å¸¸æ“ä½œ    <br>       27: astore        4<br>       29: aload_3<br>       30: monitorexit //è§£é”<br>       31: aload         4<br>       33: athrow<br>       34: return<br>     //å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºä½•æ—¶å‡ºç°å¼‚å¸¸ï¼Œéƒ½ä¼šè·³è½¬åˆ°27è¡Œï¼Œå°†å¼‚å¸¸æ”¾å…¥å±€éƒ¨å˜é‡ä¸­ï¼Œå¹¶è¿›è¡Œè§£é”æ“ä½œï¼Œç„¶ååŠ è½½å¼‚å¸¸å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚      <br>     Exception table:<br>        from    to  target type<br>           15    24    27   any<br>           27    31    27   any<br></code></pre></td></tr></table></figure>

<h3 id="3ã€ç¼–è¯‘æœŸå¤„ç†"><a href="#3ã€ç¼–è¯‘æœŸå¤„ç†" class="headerlink" title="3ã€ç¼–è¯‘æœŸå¤„ç†"></a>3ã€ç¼–è¯‘æœŸå¤„ç†</h3><p>æ‰€è°“çš„ <strong>è¯­æ³•ç³–</strong> ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ *.java æºç ç¼–è¯‘ä¸º *.class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>è‡ªåŠ¨ç”Ÿæˆ</strong>å’Œ<strong>è½¬æ¢</strong>çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©</p>
<p><strong>æ³¨æ„</strong>ï¼Œä»¥ä¸‹ä»£ç çš„åˆ†æï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚å¦å¤–ï¼Œ ç¼–è¯‘å™¨è½¬æ¢çš„<strong>ç»“æœç›´æ¥å°±æ˜¯ class å­—èŠ‚ç </strong>ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œç»™å‡ºäº† å‡ ä¹ç­‰ä»· çš„ java æºç æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ç¼–è¯‘å™¨è¿˜ä¼šè½¬æ¢å‡ºä¸­é—´çš„ java æºç ï¼Œåˆ‡è®°ã€‚</p>
<h4 id="é»˜è®¤æ„é€ å‡½æ•°"><a href="#é»˜è®¤æ„é€ å‡½æ•°" class="headerlink" title="é»˜è®¤æ„é€ å‡½æ•°"></a>é»˜è®¤æ„é€ å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Candy1</span> </span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç»è¿‡ç¼–è¯‘æœŸä¼˜åŒ–å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Candy1</span> </span>&#123;<br>   <span class="hljs-comment">//è¿™ä¸ªæ— å‚æ„é€ å™¨æ˜¯javaç¼–è¯‘å™¨å¸®æˆ‘ä»¬åŠ ä¸Šçš„</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Candy1</span><span class="hljs-params">()</span> </span>&#123;<br>      <span class="hljs-comment">//å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object.&quot; &lt;init&gt;&quot;:()V</span><br>      <span class="hljs-keyword">super</span>();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="è‡ªåŠ¨æ‹†è£…ç®±"><a href="#è‡ªåŠ¨æ‹†è£…ç®±" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±"></a>è‡ªåŠ¨æ‹†è£…ç®±</h4><p>åŸºæœ¬ç±»å‹å’Œå…¶åŒ…è£…ç±»å‹çš„ç›¸äº’è½¬æ¢è¿‡ç¨‹ï¼Œç§°ä¸ºæ‹†è£…ç®±</p>
<p>åœ¨JDK 5ä»¥åï¼Œå®ƒä»¬çš„è½¬æ¢å¯ä»¥åœ¨ç¼–è¯‘æœŸè‡ªåŠ¨å®Œæˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      Integer x = <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">int</span> y = x;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-comment">//åŸºæœ¬ç±»å‹èµ‹å€¼ç»™åŒ…è£…ç±»å‹ï¼Œç§°ä¸ºè£…ç®±</span><br>      Integer x = Integer.valueOf(<span class="hljs-number">1</span>);<br>      <span class="hljs-comment">//åŒ…è£…ç±»å‹èµ‹å€¼ç»™åŸºæœ¬ç±»å‹ï¼Œç§°è°“æ‹†ç®±</span><br>      <span class="hljs-keyword">int</span> y = x.intValue();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="æ³›å‹é›†åˆå–å€¼"><a href="#æ³›å‹é›†åˆå–å€¼" class="headerlink" title="æ³›å‹é›†åˆå–å€¼"></a>æ³›å‹é›†åˆå–å€¼</h4><p>æ³›å‹ä¹Ÿæ˜¯åœ¨ JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨<strong>ç¼–è¯‘æ³›å‹ä»£ç å</strong>ä¼šæ‰§è¡Œ <strong>æ³›å‹æ“¦é™¤</strong> çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±<strong>ä¸¢å¤±</strong>äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† <strong>Object</strong> ç±»å‹æ¥å¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>      list.add(<span class="hljs-number">10</span>);<br>      Integer x = list.get(<span class="hljs-number">0</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯¹åº”å­—èŠ‚ç </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>    stack=2, locals=3, args_size=1<br>       0: new           #2                  // class java/util/ArrayList<br>       3: dup<br>       4: invokespecial #3                  // Method java/util/ArrayList.&quot;&lt;init&gt;&quot;:()V<br>       7: astore_1<br>       8: aload_1<br>       9: bipush        10<br>      11: invokestatic  #4                  // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;<br>      //è¿™é‡Œè¿›è¡Œäº†æ³›å‹æ“¦é™¤ï¼Œå®é™…è°ƒç”¨çš„æ˜¯add(Objcet o)<br>      14: invokeinterface #5,  2            // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z<br><br>      19: pop<br>      20: aload_1<br>      21: iconst_0<br>      //è¿™é‡Œä¹Ÿè¿›è¡Œäº†æ³›å‹æ“¦é™¤ï¼Œå®é™…è°ƒç”¨çš„æ˜¯get(Object o)   <br>      22: invokeinterface #6,  2            // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;<br>//è¿™é‡Œè¿›è¡Œäº†ç±»å‹è½¬æ¢ï¼Œå°†Objectè½¬æ¢æˆäº†Integer<br>      27: checkcast     #7                  // class java/lang/Integer<br>      30: astore_2<br>      31: return<br></code></pre></td></tr></table></figure>

<p>æ‰€ä»¥è°ƒç”¨getå‡½æ•°å–å€¼æ—¶ï¼Œæœ‰ä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer x = (Integer) list.get(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure>

<p>å¦‚æœè¦å°†è¿”å›ç»“æœèµ‹å€¼ç»™ä¸€ä¸ªintç±»å‹çš„å˜é‡ï¼Œåˆ™è¿˜æœ‰<strong>è‡ªåŠ¨æ‹†ç®±</strong>çš„æ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> x = (Integer) list.get(<span class="hljs-number">0</span>).intValue();<br></code></pre></td></tr></table></figure>

<h4 id="å¯å˜å‚æ•°"><a href="#å¯å˜å‚æ•°" class="headerlink" title="å¯å˜å‚æ•°"></a>å¯å˜å‚æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(String... args)</span> </span>&#123;<br>      <span class="hljs-comment">//å°†argsèµ‹å€¼ç»™arrï¼Œå¯ä»¥çœ‹å‡ºString...å®é™…å°±æ˜¯String[] </span><br>      String[] arr = args;<br>      System.out.println(arr.length);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      foo(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¯å˜å‚æ•° <strong>Stringâ€¦</strong> args å…¶å®æ˜¯ä¸€ä¸ª <strong>String[]</strong> args ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ åŒ æ · java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸Šè¿°ä»£ç å˜æ¢ä¸ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br>   <span class="hljs-keyword">public</span> Demo4 &#123;&#125;<br><br>    <br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      String[] arr = args;<br>      System.out.println(arr.length);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      foo(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>&#125;);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯foo()ï¼Œå³æœªä¼ é€’å‚æ•°æ—¶ï¼Œç­‰ä»·ä»£ç ä¸ºfoo(new String[]{})ï¼Œ<strong>åˆ›å»ºäº†ä¸€ä¸ªç©ºæ•°ç»„</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’çš„null</p>
<h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚</span><br>		<span class="hljs-keyword">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> x : arr) &#123;<br>			System.out.println(x);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è½¬æ¢ä¸º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> Demo5 &#123;&#125;<br><br>	<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>		<span class="hljs-keyword">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br>		<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;arr.length; ++i) &#123;<br>			<span class="hljs-keyword">int</span> x = arr[i];<br>			System.out.println(x);<br>		&#125;<br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>å¦‚æœæ˜¯é›†åˆä½¿ç”¨foreach</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);<br>      <span class="hljs-keyword">for</span> (Integer x : list) &#123;<br>         System.out.println(x);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>é›†åˆè¦ä½¿ç”¨foreachï¼Œéœ€è¦è¯¥é›†åˆç±»å®ç°äº†<strong>Iterableæ¥å£</strong>ï¼Œå› ä¸ºé›†åˆçš„éå†éœ€è¦ç”¨åˆ°<strong>è¿­ä»£å™¨Iterator</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> Demo5 &#123;&#125;<br>    <br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);<br>      <span class="hljs-comment">//è·å¾—è¯¥é›†åˆçš„è¿­ä»£å™¨</span><br>      Iterator&lt;Integer&gt; iterator = list.iterator();<br>      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;<br>         Integer x = iterator.next();<br>         System.out.println(x);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="switchå­—ç¬¦ä¸²"><a href="#switchå­—ç¬¦ä¸²" class="headerlink" title="switchå­—ç¬¦ä¸²"></a>switchå­—ç¬¦ä¸²</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo6</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      String str = <span class="hljs-string">&quot;hello&quot;</span>;<br>      <span class="hljs-keyword">switch</span> (str) &#123;<br>         <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;hello&quot;</span> :<br>            System.out.println(<span class="hljs-string">&quot;h&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;world&quot;</span> :<br>            System.out.println(<span class="hljs-string">&quot;w&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>åœ¨ç¼–è¯‘å™¨ä¸­æ‰§è¡Œçš„æ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo6</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo6</span><span class="hljs-params">()</span> </span>&#123;<br>      <br>   &#125;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      String str = <span class="hljs-string">&quot;hello&quot;</span>;<br>      <span class="hljs-keyword">int</span> x = -<span class="hljs-number">1</span>;<br>      <span class="hljs-comment">//é€šè¿‡å­—ç¬¦ä¸²çš„hashCode+valueæ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…</span><br>      <span class="hljs-keyword">switch</span> (str.hashCode()) &#123;<br>         <span class="hljs-comment">//helloçš„hashCode</span><br>         <span class="hljs-keyword">case</span> <span class="hljs-number">99162322</span> :<br>            <span class="hljs-comment">//å†æ¬¡æ¯”è¾ƒï¼Œå› ä¸ºå­—ç¬¦ä¸²çš„hashCodeæœ‰å¯èƒ½ç›¸ç­‰</span><br>            <span class="hljs-keyword">if</span>(str.equals(<span class="hljs-string">&quot;hello&quot;</span>)) &#123;<br>               x = <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-comment">//worldçš„hashCode</span><br>         <span class="hljs-keyword">case</span> <span class="hljs-number">11331880</span> :<br>            <span class="hljs-keyword">if</span>(str.equals(<span class="hljs-string">&quot;world&quot;</span>)) &#123;<br>               x = <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br><br>      <span class="hljs-comment">//ç”¨ç¬¬äºŒä¸ªswitchåœ¨è¿›è¡Œè¾“å‡ºåˆ¤æ–­</span><br>      <span class="hljs-keyword">switch</span> (x) &#123;<br>         <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>            System.out.println(<span class="hljs-string">&quot;h&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            System.out.println(<span class="hljs-string">&quot;w&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è¿‡ç¨‹è¯´æ˜ï¼š</p>
<ul>
<li>åœ¨ç¼–è¯‘æœŸé—´ï¼Œå•ä¸ªçš„switchè¢«åˆ†ä¸ºäº†ä¸¤ä¸ª<ul>
<li>ç¬¬ä¸€ä¸ªç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²ï¼Œå¹¶ç»™xèµ‹å€¼<ul>
<li>å­—ç¬¦ä¸²çš„åŒ¹é…ç”¨åˆ°äº†å­—ç¬¦ä¸²çš„hashCodeï¼Œè¿˜ç”¨åˆ°äº†equalsæ–¹æ³•</li>
<li>ä½¿ç”¨hashCodeæ˜¯ä¸ºäº†æé«˜æ¯”è¾ƒæ•ˆç‡ï¼Œä½¿ç”¨equalsæ˜¯é˜²æ­¢æœ‰hashCodeå†²çªï¼ˆå¦‚BMå’ŒC.ï¼‰</li>
</ul>
</li>
<li>ç¬¬äºŒä¸ªç”¨æ¥æ ¹æ®xçš„å€¼æ¥å†³å®šè¾“å‡ºè¯­å¥</li>
</ul>
</li>
</ul>
<h4 id="switchæšä¸¾"><a href="#switchæšä¸¾" class="headerlink" title="switchæšä¸¾"></a>switchæšä¸¾</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo7</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      SEX sex = SEX.MALE;<br>      <span class="hljs-keyword">switch</span> (sex) &#123;<br>         <span class="hljs-keyword">case</span> MALE:<br>            System.out.println(<span class="hljs-string">&quot;man&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> FEMALE:<br>            System.out.println(<span class="hljs-string">&quot;woman&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;<br>   MALE, FEMALE;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¸­æ‰§è¡Œçš„ä»£ç å¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo7</span> </span>&#123;<br>   <span class="hljs-comment">/**     </span><br><span class="hljs-comment">    * å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰     </span><br><span class="hljs-comment">    * ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»     </span><br><span class="hljs-comment">    * æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹     </span><br><span class="hljs-comment">    * å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1     </span><br><span class="hljs-comment">    */</span> <br>   <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> $<span class="hljs-title">MAP</span> </span>&#123;<br>      <span class="hljs-comment">//æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜æ”¾äº†caseç”¨äºæ¯”è¾ƒçš„æ•°å­—</span><br>      <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] map = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">2</span>];<br>      <span class="hljs-keyword">static</span> &#123;<br>         <span class="hljs-comment">//ordinalå³æšä¸¾å…ƒç´ å¯¹åº”æ‰€åœ¨çš„ä½ç½®ï¼ŒMALEä¸º0ï¼ŒFEMALEä¸º1</span><br>         map[SEX.MALE.ordinal()] = <span class="hljs-number">1</span>;<br>         map[SEX.FEMALE.ordinal()] = <span class="hljs-number">2</span>;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      SEX sex = SEX.MALE;<br>      <span class="hljs-comment">//å°†å¯¹åº”ä½ç½®æšä¸¾å…ƒç´ çš„å€¼èµ‹ç»™xï¼Œç”¨äºcaseæ“ä½œ</span><br>      <span class="hljs-keyword">int</span> x = $MAP.map[sex.ordinal()];<br>      <span class="hljs-keyword">switch</span> (x) &#123;<br>         <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            System.out.println(<span class="hljs-string">&quot;man&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            System.out.println(<span class="hljs-string">&quot;woman&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;<br>   MALE, FEMALE;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="æšä¸¾ç±»"><a href="#æšä¸¾ç±»" class="headerlink" title="æšä¸¾ç±»"></a>æšä¸¾ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;<br>   MALE, FEMALE;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è½¬æ¢åçš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sex</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Enum</span>&lt;<span class="hljs-title">Sex</span>&gt; </span>&#123;   <br>   <span class="hljs-comment">//å¯¹åº”æšä¸¾ç±»ä¸­çš„å…ƒç´ </span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex MALE;    <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex FEMALE;    <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex[] $VALUES;<br>   <br>    <span class="hljs-keyword">static</span> &#123;       <br>    	<span class="hljs-comment">//è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¼ å…¥æšä¸¾å…ƒç´ çš„å€¼åŠordinal</span><br>    	MALE = <span class="hljs-keyword">new</span> Sex(<span class="hljs-string">&quot;MALE&quot;</span>, <span class="hljs-number">0</span>);    <br>        FEMALE = <span class="hljs-keyword">new</span> Sex(<span class="hljs-string">&quot;FEMALE&quot;</span>, <span class="hljs-number">1</span>);   <br>        $VALUES = <span class="hljs-keyword">new</span> Sex[]&#123;MALE, FEMALE&#125;; <br>   &#125;<br> 	<br>   <span class="hljs-comment">//è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Sex</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> ordinal)</span> </span>&#123;     <br>        <span class="hljs-keyword">super</span>(name, ordinal);    <br>    &#125;<br>   <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sex[] values() &#123;  <br>        <span class="hljs-keyword">return</span> $VALUES.clone();  <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sex <span class="hljs-title">valueOf</span><span class="hljs-params">(String name)</span> </span>&#123; <br>        <span class="hljs-keyword">return</span> Enum.valueOf(Sex.class, name);  <br>    &#125; <br>   <br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;running...&quot;</span>);<br>         &#125;<br>      &#125;;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è½¬æ¢åçš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-comment">//ç”¨é¢å¤–åˆ›å»ºçš„ç±»æ¥åˆ›å»ºåŒ¿åå†…éƒ¨ç±»å¯¹è±¡</span><br>      Runnable runnable = <span class="hljs-keyword">new</span> Demo8$<span class="hljs-number">1</span>();<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//åˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„ç±»ï¼Œå®ç°äº†Runnableæ¥å£</span><br><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span>$1 <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>   <span class="hljs-keyword">public</span> Demo8$<span class="hljs-number">1</span>() &#123;&#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;running...&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>å¦‚æœåŒ¿åå†…éƒ¨ç±»ä¸­å¼•ç”¨äº†<strong>å±€éƒ¨å˜é‡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> x = <span class="hljs-number">1</span>;<br>      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            System.out.println(x);<br>         &#125;<br>      &#125;;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>è½¬åŒ–åä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> x = <span class="hljs-number">1</span>;<br>      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            System.out.println(x);<br>         &#125;<br>      &#125;;<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span>$1 <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>   <span class="hljs-comment">//å¤šåˆ›å»ºäº†ä¸€ä¸ªå˜é‡</span><br>   <span class="hljs-keyword">int</span> val$x;<br>   <span class="hljs-comment">//å˜ä¸ºäº†æœ‰å‚æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> Demo8$<span class="hljs-number">1</span>(<span class="hljs-keyword">int</span> x) &#123;<br>      <span class="hljs-keyword">this</span>.val$x = x;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>      System.out.println(val$x);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="4ã€ç±»åŠ è½½é˜¶æ®µ"><a href="#4ã€ç±»åŠ è½½é˜¶æ®µ" class="headerlink" title="4ã€ç±»åŠ è½½é˜¶æ®µ"></a>4ã€ç±»åŠ è½½é˜¶æ®µ</h3><h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><ul>
<li><p>å°†ç±»çš„å­—èŠ‚ç è½½å…¥</p>
<p>æ–¹æ³•åŒº</p>
<p>ï¼ˆ1.8åä¸ºå…ƒç©ºé—´ï¼Œåœ¨æœ¬åœ°å†…å­˜ä¸­ï¼‰ä¸­ï¼Œå†…éƒ¨é‡‡ç”¨ C++ çš„ instanceKlass æè¿° java ç±»ï¼Œå®ƒçš„é‡è¦ ï¬eld æœ‰ï¼š</p>
<ul>
<li>_java_mirror å³ java çš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹ String æ¥è¯´ï¼Œå®ƒçš„é•œåƒç±»å°±æ˜¯ String.classï¼Œä½œç”¨æ˜¯æŠŠ klass æš´éœ²ç»™ java ä½¿ç”¨</li>
<li>_super å³çˆ¶ç±»</li>
<li>_ï¬elds å³æˆå‘˜å˜é‡</li>
<li>_methods å³æ–¹æ³•</li>
<li>_constants å³å¸¸é‡æ± </li>
<li>_class_loader å³ç±»åŠ è½½å™¨</li>
<li>_vtable è™šæ–¹æ³•è¡¨</li>
<li>_itable æ¥å£æ–¹æ³•</li>
</ul>
</li>
<li><p>å¦‚æœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œ<strong>å…ˆåŠ è½½çˆ¶ç±»</strong></p>
</li>
<li><p>åŠ è½½å’Œé“¾æ¥å¯èƒ½æ˜¯<strong>äº¤æ›¿è¿è¡Œ</strong>çš„</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611205050.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611205050.png" srcset="/img/loading.gif" alt="img"></a></p>
<ul>
<li>instanceKlassä¿å­˜åœ¨<strong>æ–¹æ³•åŒº</strong>ã€‚JDK 8ä»¥åï¼Œæ–¹æ³•åŒºä½äºå…ƒç©ºé—´ä¸­ï¼Œè€Œå…ƒç©ºé—´åˆä½äºæœ¬åœ°å†…å­˜ä¸­</li>
<li>_java_mirroråˆ™æ˜¯ä¿å­˜åœ¨<strong>å †å†…å­˜</strong>ä¸­</li>
<li>InstanceKlasså’Œ*.class(JAVAé•œåƒç±»)äº’ç›¸ä¿å­˜äº†å¯¹æ–¹çš„åœ°å€</li>
<li>ç±»çš„å¯¹è±¡åœ¨å¯¹è±¡å¤´ä¸­ä¿å­˜äº†*.classçš„åœ°å€ã€‚è®©å¯¹è±¡å¯ä»¥é€šè¿‡å…¶æ‰¾åˆ°æ–¹æ³•åŒºä¸­çš„instanceKlassï¼Œä»è€Œè·å–ç±»çš„å„ç§ä¿¡æ¯</li>
</ul>
<h4 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h4><h5 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h5><p>éªŒè¯ç±»æ˜¯å¦ç¬¦åˆ JVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥</p>
<h5 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h5><p>ä¸º static å˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼</p>
<ul>
<li>staticå˜é‡åœ¨JDK 7ä»¥å‰æ˜¯å­˜å‚¨ä¸instanceKlassæœ«å°¾ã€‚ä½†åœ¨JDK 7ä»¥åå°±å­˜å‚¨åœ¨_java_mirroræœ«å°¾äº†</li>
<li>staticå˜é‡åœ¨åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯åœ¨ä¸¤ä¸ªé˜¶æ®µå®Œæˆçš„ã€‚åˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</li>
<li>å¦‚æœ static å˜é‡æ˜¯ ï¬nal çš„<strong>åŸºæœ¬ç±»å‹</strong>ï¼Œä»¥åŠ<strong>å­—ç¬¦ä¸²å¸¸é‡</strong>ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œ<strong>èµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</strong></li>
<li>å¦‚æœ static å˜é‡æ˜¯ ï¬nal çš„ï¼Œä½†å±äº<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨<strong>åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</strong></li>
</ul>
<h5 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h5><p><strong>HSDBçš„ä½¿ç”¨</strong></p>
<ul>
<li>å…ˆè·å¾—è¦æŸ¥çœ‹çš„è¿›ç¨‹ID</li>
</ul>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">jps</span><br></code></pre></td></tr></table></figure>

<ul>
<li>æ‰“å¼€HSDB</li>
</ul>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">java -cp F:<span class="hljs-symbol">\J</span>AVA<span class="hljs-symbol">\J</span>DK8.0<span class="hljs-symbol">\l</span>ib<span class="hljs-symbol">\s</span>a-jdi.jar sun.jvm.hotspot.HSDB<br></code></pre></td></tr></table></figure>

<ul>
<li>è¿è¡Œæ—¶å¯èƒ½ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸º<strong>ç¼ºå°‘ä¸€ä¸ª.dllçš„æ–‡ä»¶</strong>ï¼Œæˆ‘ä»¬åœ¨JDKçš„å®‰è£…ç›®å½•ä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œå¤åˆ¶åˆ°ç¼ºå¤±çš„æ–‡ä»¶ä¸‹å³å¯</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221703.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221703.png" srcset="/img/loading.gif" alt="img"></a></p>
<ul>
<li>å®šä½éœ€è¦çš„è¿›ç¨‹</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221857.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221857.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611222029.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611222029.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>è§£æçš„å«ä¹‰</strong></p>
<p>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</p>
<ul>
<li>æœªè§£ææ—¶ï¼Œå¸¸é‡æ± ä¸­çš„çœ‹åˆ°çš„å¯¹è±¡ä»…æ˜¯ç¬¦å·ï¼ŒæœªçœŸæ­£çš„å­˜åœ¨äºå†…å­˜ä¸­</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException </span>&#123;<br>      ClassLoader loader = Demo1.class.getClassLoader();<br>      <span class="hljs-comment">//åªåŠ è½½ä¸è§£æ</span><br>      Class&lt;?&gt; c = loader.loadClass(<span class="hljs-string">&quot;com.nyima.JVM.day8.C&quot;</span>);<br>      <span class="hljs-comment">//ç”¨äºé˜»å¡ä¸»çº¿ç¨‹</span><br>      System.in.read();<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> </span>&#123;<br>   D d = <span class="hljs-keyword">new</span> D();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span> </span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>æ‰“å¼€HSDB<ul>
<li>å¯ä»¥çœ‹åˆ°æ­¤æ—¶åªåŠ è½½äº†ç±»C</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223153.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223153.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æŸ¥çœ‹ç±»Cçš„å¸¸é‡æ± ï¼Œå¯ä»¥çœ‹åˆ°ç±»D<strong>æœªè¢«è§£æ</strong>ï¼Œåªæ˜¯å­˜åœ¨äºå¸¸é‡æ± ä¸­çš„ç¬¦å·</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611230658.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611230658.png" srcset="/img/loading.gif" alt="img"></a></p>
<ul>
<li><p>è§£æä»¥åï¼Œä¼šå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</p>
<ul>
<li>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶å·²åŠ è½½å¹¶è§£æäº†ç±»Cå’Œç±»D</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223441.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223441.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200613104723.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200613104723.png" srcset="/img/loading.gif" alt="img"></a></p>
</li>
</ul>
<h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯<strong>æ‰§è¡Œç±»æ„é€ å™¨clinit()æ–¹æ³•çš„è¿‡ç¨‹</strong>ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯è¿™ä¸ªç±»çš„ã€æ„é€ æ–¹æ³•ã€çš„çº¿ç¨‹å®‰å…¨</p>
<ul>
<li>clinit()æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„<strong>èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—</strong>ï¼ˆstatic{}å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„</li>
</ul>
<p><strong>æ³¨æ„</strong></p>
<p>ç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­<strong>å‡ºç°çš„é¡ºåºå†³å®š</strong>çš„ï¼Œé™æ€è¯­å¥å—ä¸­åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒ<strong>ä¹‹å</strong>çš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—<strong>å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®</strong>ï¼Œå¦‚</p>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201118204542.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201118204542.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="å‘ç”Ÿæ—¶æœº"><a href="#å‘ç”Ÿæ—¶æœº" class="headerlink" title="å‘ç”Ÿæ—¶æœº"></a>å‘ç”Ÿæ—¶æœº</h5><p><strong>ç±»çš„åˆå§‹åŒ–çš„æ‡’æƒ°çš„</strong>ï¼Œä»¥ä¸‹æƒ…å†µä¼šåˆå§‹åŒ–</p>
<ul>
<li>main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ–</li>
<li>é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶</li>
<li>å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘</li>
<li>å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li>
<li>Class.forName</li>
<li>new ä¼šå¯¼è‡´åˆå§‹åŒ–</li>
</ul>
<p>ä»¥ä¸‹æƒ…å†µä¸ä¼šåˆå§‹åŒ–</p>
<ul>
<li>è®¿é—®ç±»çš„ static ï¬nal é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰</li>
<li>ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li>
<li>åˆ›å»ºè¯¥ç±»å¯¹è±¡çš„æ•°ç»„</li>
<li>ç±»åŠ è½½å™¨çš„.loadClassæ–¹æ³•</li>
<li>Class.forNamedçš„å‚æ•°2ä¸ºfalseæ—¶</li>
</ul>
<p><strong>éªŒè¯ç±»æ˜¯å¦è¢«åˆå§‹åŒ–ï¼Œå¯ä»¥çœ‹æ”¹ç±»çš„é™æ€ä»£ç å—æ˜¯å¦è¢«æ‰§è¡Œ</strong></p>
<h3 id="5ã€ç±»åŠ è½½å™¨"><a href="#5ã€ç±»åŠ è½½å™¨" class="headerlink" title="5ã€ç±»åŠ è½½å™¨"></a>5ã€ç±»åŠ è½½å™¨</h3><p>Javaè™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿæœ‰æ„æŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„<strong>â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€</strong>è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç è¢«ç§°ä¸º<strong>â€œç±»åŠ è½½å™¨â€</strong>ï¼ˆClassLoaderï¼‰</p>
<h4 id="ç±»ä¸ç±»åŠ è½½å™¨"><a href="#ç±»ä¸ç±»åŠ è½½å™¨" class="headerlink" title="ç±»ä¸ç±»åŠ è½½å™¨"></a>ç±»ä¸ç±»åŠ è½½å™¨</h4><p>ç±»åŠ è½½å™¨è™½ç„¶åªç”¨äºå®ç°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œä½†å®ƒåœ¨Javaç¨‹åºä¸­èµ·åˆ°çš„ä½œç”¨å´è¿œè¶…ç±»åŠ è½½é˜¶æ®µ</p>
<p>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½å¿…é¡»ç”±åŠ è½½å®ƒçš„<strong>ç±»åŠ è½½å™¨</strong>å’Œè¿™ä¸ª<strong>ç±»æœ¬èº«</strong>ä¸€èµ·å…±åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚è¿™å¥è¯å¯ä»¥è¡¨è¾¾å¾—æ›´é€šä¿—ä¸€äº›ï¼š<strong>æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰</strong>ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªJavaè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰</p>
<p>ä»¥JDK 8ä¸ºä¾‹</p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>åŠ è½½çš„ç±»</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Bootstrap ClassLoaderï¼ˆå¯åŠ¨ç±»åŠ è½½å™¨ï¼‰</td>
<td>JAVA_HOME/jre/lib</td>
<td>æ— æ³•ç›´æ¥è®¿é—®</td>
</tr>
<tr>
<td>Extension ClassLoader(æ‹“å±•ç±»åŠ è½½å™¨)</td>
<td>JAVA_HOME/jre/lib/ext</td>
<td>ä¸Šçº§ä¸ºBootstrapï¼Œ<strong>æ˜¾ç¤ºä¸ºnull</strong></td>
</tr>
<tr>
<td>Application ClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</td>
<td>classpath</td>
<td>ä¸Šçº§ä¸ºExtension</td>
</tr>
<tr>
<td>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</td>
<td>è‡ªå®šä¹‰</td>
<td>ä¸Šçº§ä¸ºApplication</td>
</tr>
</tbody></table>
<h4 id="å¯åŠ¨ç±»åŠ è½½å™¨"><a href="#å¯åŠ¨ç±»åŠ è½½å™¨" class="headerlink" title="å¯åŠ¨ç±»åŠ è½½å™¨"></a>å¯åŠ¨ç±»åŠ è½½å™¨</h4><p>å¯é€šè¿‡åœ¨æ§åˆ¶å°è¾“å…¥æŒ‡ä»¤ï¼Œä½¿å¾—ç±»è¢«å¯åŠ¨ç±»åŠ å™¨åŠ è½½</p>
<h4 id="æ‹“å±•ç±»åŠ è½½å™¨"><a href="#æ‹“å±•ç±»åŠ è½½å™¨" class="headerlink" title="æ‹“å±•ç±»åŠ è½½å™¨"></a>æ‹“å±•ç±»åŠ è½½å™¨</h4><p>å¦‚æœclasspathå’ŒJAVA_HOME/jre/lib/ext ä¸‹æœ‰åŒåç±»ï¼ŒåŠ è½½æ—¶ä¼šä½¿ç”¨<strong>æ‹“å±•ç±»åŠ è½½å™¨</strong>åŠ è½½ã€‚å½“åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å‘ç°æ‹“å±•ç±»åŠ è½½å™¨å·²å°†è¯¥åŒåç±»åŠ è½½è¿‡äº†ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŠ è½½</p>
<h4 id="åŒäº²å§”æ´¾æ¨¡å¼"><a href="#åŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å¼"></a>åŒäº²å§”æ´¾æ¨¡å¼</h4><p>åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³è°ƒç”¨ç±»åŠ è½½å™¨ClassLoader çš„ loadClass æ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™</p>
<p>loadClassæºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-keyword">boolean</span> resolve)<br>    <span class="hljs-keyword">throws</span> ClassNotFoundException<br>&#123;<br>    <span class="hljs-keyword">synchronized</span> (getClassLoadingLock(name)) &#123;<br>        <span class="hljs-comment">// é¦–å…ˆæŸ¥æ‰¾è¯¥ç±»æ˜¯å¦å·²ç»è¢«è¯¥ç±»åŠ è½½å™¨åŠ è½½è¿‡äº†</span><br>        Class&lt;?&gt; c = findLoadedClass(name);<br>        <span class="hljs-comment">//å¦‚æœæ²¡æœ‰è¢«åŠ è½½è¿‡</span><br>        <span class="hljs-keyword">if</span> (c == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">long</span> t0 = System.nanoTime();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//çœ‹æ˜¯å¦è¢«å®ƒçš„ä¸Šçº§åŠ è½½å™¨åŠ è½½è¿‡äº† Extensionçš„ä¸Šçº§æ˜¯Bootstarpï¼Œä½†å®ƒæ˜¾ç¤ºä¸ºnull</span><br>                <span class="hljs-keyword">if</span> (parent != <span class="hljs-keyword">null</span>) &#123;<br>                    c = parent.loadClass(name, <span class="hljs-keyword">false</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">//çœ‹æ˜¯å¦è¢«å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½è¿‡</span><br>                    c = findBootstrapClassOrNull(name);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>                <span class="hljs-comment">// ClassNotFoundException thrown if class not found</span><br>                <span class="hljs-comment">// from the non-null parent class loader</span><br>                <span class="hljs-comment">//æ•è·å¼‚å¸¸ï¼Œä½†ä¸åšä»»ä½•å¤„ç†</span><br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (c == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-comment">//å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œå…ˆè®©æ‹“å±•ç±»åŠ è½½å™¨è°ƒç”¨findClassæ–¹æ³•å»æ‰¾åˆ°è¯¥ç±»ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</span><br>                <span class="hljs-comment">//ç„¶åè®©åº”ç”¨ç±»åŠ è½½å™¨å»æ‰¾classpathä¸‹æ‰¾è¯¥ç±»</span><br>                <span class="hljs-keyword">long</span> t1 = System.nanoTime();<br>                c = findClass(name);<br><br>                <span class="hljs-comment">// è®°å½•æ—¶é—´</span><br>                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);<br>                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);<br>                sun.misc.PerfCounter.getFindClasses().increment();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (resolve) &#123;<br>            resolveClass(c);<br>        &#125;<br>        <span class="hljs-keyword">return</span> c;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><ul>
<li>æƒ³åŠ è½½é classpath éšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶</li>
<li>é€šè¿‡æ¥å£æ¥ä½¿ç”¨å®ç°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æ¶è®¾è®¡</li>
<li>è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äº tomcat å®¹å™¨</li>
</ul>
<h5 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h5><ul>
<li>ç»§æ‰¿ClassLoaderçˆ¶ç±»</li>
<li>è¦éµä»åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ ï¬ndClass æ–¹æ³•<ul>
<li>ä¸æ˜¯é‡å†™loadClassæ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶</li>
</ul>
</li>
<li>è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç </li>
<li>è°ƒç”¨çˆ¶ç±»çš„ deï¬neClass æ–¹æ³•æ¥åŠ è½½ç±»</li>
<li>ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•</li>
</ul>
<h4 id="ç ´ååŒäº²å§”æ´¾æ¨¡å¼"><a href="#ç ´ååŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="ç ´ååŒäº²å§”æ´¾æ¨¡å¼"></a>ç ´ååŒäº²å§”æ´¾æ¨¡å¼</h4><ul>
<li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸€æ¬¡â€œè¢«ç ´åâ€å…¶å®å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰â€”â€”å³JDK1.2é¢ä¸–ä»¥å‰çš„â€œè¿œå¤â€æ—¶ä»£<ul>
<li>å»ºè®®ç”¨æˆ·é‡å†™findClass()æ–¹æ³•ï¼Œåœ¨ç±»åŠ è½½å™¨ä¸­çš„loadClass()æ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•</li>
</ul>
</li>
<li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬äºŒæ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±è¿™ä¸ªæ¨¡å‹è‡ªèº«çš„ç¼ºé™·å¯¼è‡´çš„<ul>
<li>å¦‚æœæœ‰åŸºç¡€ç±»å‹åˆè¦è°ƒç”¨å›ç”¨æˆ·çš„ä»£ç ï¼Œæ­¤æ—¶ä¹Ÿä¼šç ´ååŒäº²å§”æ´¾æ¨¡å¼</li>
</ul>
</li>
<li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸‰æ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚è€Œå¯¼è‡´çš„<ul>
<li>è¿™é‡Œæ‰€è¯´çš„â€œåŠ¨æ€æ€§â€æŒ‡çš„æ˜¯ä¸€äº›éå¸¸â€œçƒ­â€é—¨çš„åè¯ï¼šä»£ç çƒ­æ›¿æ¢ï¼ˆHot Swapï¼‰ã€æ¨¡å—çƒ­éƒ¨ç½²ï¼ˆHot Deploymentï¼‰ç­‰</li>
</ul>
</li>
</ul>
<h3 id="6ã€è¿è¡ŒæœŸä¼˜åŒ–"><a href="#6ã€è¿è¡ŒæœŸä¼˜åŒ–" class="headerlink" title="6ã€è¿è¡ŒæœŸä¼˜åŒ–"></a>6ã€è¿è¡ŒæœŸä¼˜åŒ–</h3><h4 id="åˆ†å±‚ç¼–è¯‘"><a href="#åˆ†å±‚ç¼–è¯‘" class="headerlink" title="åˆ†å±‚ç¼–è¯‘"></a>åˆ†å±‚ç¼–è¯‘</h4><p>JVM å°†æ‰§è¡ŒçŠ¶æ€åˆ†æˆäº† 5 ä¸ªå±‚æ¬¡ï¼š</p>
<ul>
<li>0å±‚ï¼šè§£é‡Šæ‰§è¡Œï¼Œç”¨è§£é‡Šå™¨å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºæœºå™¨ç </li>
<li>1å±‚ï¼šä½¿ç”¨ C1 <strong>å³æ—¶ç¼–è¯‘å™¨</strong>ç¼–è¯‘æ‰§è¡Œï¼ˆä¸å¸¦ proï¬lingï¼‰</li>
<li>2å±‚ï¼šä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦åŸºæœ¬çš„profilingï¼‰</li>
<li>3å±‚ï¼šä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦å®Œå…¨çš„profilingï¼‰</li>
<li>4å±‚ï¼šä½¿ç”¨ C2 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ</li>
</ul>
<p>proï¬ling æ˜¯æŒ‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸€äº›ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„æ•°æ®ï¼Œä¾‹å¦‚ã€æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‘ï¼Œã€å¾ªç¯çš„ å›è¾¹æ¬¡æ•°ã€‘ç­‰</p>
<h5 id="å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«"><a href="#å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«" class="headerlink" title="å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«"></a>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«</h5><ul>
<li>è§£é‡Šå™¨<ul>
<li>å°†å­—èŠ‚ç <strong>è§£é‡Š</strong>ä¸ºæœºå™¨ç ï¼Œä¸‹æ¬¡å³ä½¿é‡åˆ°ç›¸åŒçš„å­—èŠ‚ç ï¼Œä»ä¼šæ‰§è¡Œé‡å¤çš„è§£é‡Š</li>
<li>æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºé’ˆå¯¹æ‰€æœ‰å¹³å°éƒ½é€šç”¨çš„æœºå™¨ç </li>
</ul>
</li>
<li>å³æ—¶ç¼–è¯‘å™¨<ul>
<li>å°†ä¸€äº›å­—èŠ‚ç <strong>ç¼–è¯‘</strong>ä¸ºæœºå™¨ç ï¼Œ<strong>å¹¶å­˜å…¥ Code Cache</strong>ï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒçš„ä»£ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ— éœ€å†ç¼–è¯‘</li>
<li>æ ¹æ®å¹³å°ç±»å‹ï¼Œç”Ÿæˆå¹³å°ç‰¹å®šçš„æœºå™¨ç </li>
</ul>
</li>
</ul>
<p>å¯¹äºå¤§éƒ¨åˆ†çš„ä¸å¸¸ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬æ— éœ€è€—è´¹æ—¶é—´å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€Œæ˜¯é‡‡å–è§£é‡Šæ‰§è¡Œçš„æ–¹å¼è¿è¡Œï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä»…å æ®å°éƒ¨åˆ†çš„çƒ­ç‚¹ä»£ç ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„è¿è¡Œé€Ÿåº¦ã€‚ æ‰§è¡Œæ•ˆç‡ä¸Šç®€å•æ¯”è¾ƒä¸€ä¸‹ Interpreter &lt; C1 &lt; C2ï¼Œæ€»çš„ç›®æ ‡æ˜¯å‘ç°çƒ­ç‚¹ä»£ç ï¼ˆhotspotåç§°çš„ç”± æ¥ï¼‰ï¼Œå¹¶ä¼˜åŒ–è¿™äº›çƒ­ç‚¹ä»£ç </p>
<h5 id="é€ƒé€¸åˆ†æ"><a href="#é€ƒé€¸åˆ†æ" class="headerlink" title="é€ƒé€¸åˆ†æ"></a>é€ƒé€¸åˆ†æ</h5><p>é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰ç®€å•æ¥è®²å°±æ˜¯ï¼ŒJava Hotspot è™šæ‹Ÿæœºå¯ä»¥åˆ†ææ–°åˆ›å»ºå¯¹è±¡çš„ä½¿ç”¨èŒƒå›´ï¼Œå¹¶å†³å®šæ˜¯å¦åœ¨ Java å †ä¸Šåˆ†é…å†…å­˜çš„ä¸€é¡¹æŠ€æœ¯</p>
<p>é€ƒé€¸åˆ†æçš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¼€å¯é€ƒé€¸åˆ†æï¼š-XX:+DoEscapeAnalysis</li>
<li>å…³é—­é€ƒé€¸åˆ†æï¼š-XX:-DoEscapeAnalysis</li>
<li>æ˜¾ç¤ºåˆ†æç»“æœï¼š-XX:+PrintEscapeAnalysis</li>
</ul>
<p>é€ƒé€¸åˆ†ææŠ€æœ¯åœ¨ Java SE 6u23+ å¼€å§‹æ”¯æŒï¼Œå¹¶é»˜è®¤è®¾ç½®ä¸ºå¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥ä¸ç”¨é¢å¤–åŠ è¿™ä¸ªå‚æ•°</p>
<p><strong>å¯¹è±¡é€ƒé€¸çŠ¶æ€</strong></p>
<p><strong>å…¨å±€é€ƒé€¸ï¼ˆGlobalEscapeï¼‰</strong></p>
<ul>
<li>å³ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨èŒƒå›´é€ƒå‡ºäº†å½“å‰æ–¹æ³•æˆ–è€…å½“å‰çº¿ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯ï¼š<ul>
<li>å¯¹è±¡æ˜¯ä¸€ä¸ªé™æ€å˜é‡</li>
<li>å¯¹è±¡æ˜¯ä¸€ä¸ªå·²ç»å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡</li>
<li>å¯¹è±¡ä½œä¸ºå½“å‰æ–¹æ³•çš„è¿”å›å€¼</li>
</ul>
</li>
</ul>
<p><strong>å‚æ•°é€ƒé€¸ï¼ˆArgEscapeï¼‰</strong></p>
<ul>
<li>å³ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’æˆ–è€…è¢«å‚æ•°å¼•ç”¨ï¼Œä½†åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå‘ç”Ÿå…¨å±€é€ƒé€¸ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯é€šè¿‡è¢«è°ƒæ–¹æ³•çš„å­—èŠ‚ç ç¡®å®šçš„</li>
</ul>
<p><strong>æ²¡æœ‰é€ƒé€¸</strong></p>
<ul>
<li>å³æ–¹æ³•ä¸­çš„å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸</li>
</ul>
<p><strong>é€ƒé€¸åˆ†æä¼˜åŒ–</strong></p>
<p>é’ˆå¯¹ä¸Šé¢ç¬¬ä¸‰ç‚¹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡<strong>æ²¡æœ‰é€ƒé€¸</strong>æ—¶ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ ä¸ªè™šæ‹Ÿæœºçš„ä¼˜åŒ–</p>
<p><strong>é”æ¶ˆé™¤</strong></p>
<p>æˆ‘ä»¬çŸ¥é“çº¿ç¨‹åŒæ­¥é”æ˜¯éå¸¸ç‰ºç‰²æ€§èƒ½çš„ï¼Œå½“ç¼–è¯‘å™¨ç¡®å®šå½“å‰å¯¹è±¡åªæœ‰å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šç§»é™¤è¯¥å¯¹è±¡çš„åŒæ­¥é”</p>
<p>ä¾‹å¦‚ï¼ŒStringBuffer å’Œ Vector éƒ½æ˜¯ç”¨ synchronized ä¿®é¥°çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½åªæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­ç”¨åˆ°ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¼šä¼˜åŒ–ç§»é™¤æ‰è¿™äº›é”æ“ä½œ</p>
<p>é”æ¶ˆé™¤çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¼€å¯é”æ¶ˆé™¤ï¼š-XX:+EliminateLocks</li>
<li>å…³é—­é”æ¶ˆé™¤ï¼š-XX:-EliminateLocks</li>
</ul>
<p>é”æ¶ˆé™¤åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”é”æ¶ˆé™¤éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š</p>
<p><strong>æ ‡é‡æ›¿æ¢</strong></p>
<p>é¦–å…ˆè¦æ˜ç™½æ ‡é‡å’Œèšåˆé‡ï¼Œ<strong>åŸºç¡€ç±»å‹</strong>å’Œ<strong>å¯¹è±¡çš„å¼•ç”¨</strong>å¯ä»¥ç†è§£ä¸º<strong>æ ‡é‡</strong>ï¼Œå®ƒä»¬ä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£ã€‚è€Œèƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡å°±æ˜¯èšåˆé‡ï¼Œæ¯”å¦‚ï¼šå¯¹è±¡</p>
<p>å¯¹è±¡æ˜¯èšåˆé‡ï¼Œå®ƒåˆå¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æˆæ ‡é‡ï¼Œå°†å…¶æˆå‘˜å˜é‡åˆ†è§£ä¸ºåˆ†æ•£çš„å˜é‡ï¼Œè¿™å°±å«åš<strong>æ ‡é‡æ›¿æ¢</strong>ã€‚</p>
<p>è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼Œé‚£å‹æ ¹å°±ä¸ç”¨åˆ›å»ºå®ƒï¼Œåªä¼šåœ¨æ ˆæˆ–è€…å¯„å­˜å™¨ä¸Šåˆ›å»ºå®ƒç”¨åˆ°çš„æˆå‘˜æ ‡é‡ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œä¹Ÿæå‡äº†åº”ç”¨ç¨‹åºæ€§èƒ½</p>
<p>æ ‡é‡æ›¿æ¢çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¼€å¯æ ‡é‡æ›¿æ¢ï¼š-XX:+EliminateAllocations</li>
<li>å…³é—­æ ‡é‡æ›¿æ¢ï¼š-XX:-EliminateAllocations</li>
<li>æ˜¾ç¤ºæ ‡é‡æ›¿æ¢è¯¦æƒ…ï¼š-XX:+PrintEliminateAllocations</li>
</ul>
<p>æ ‡é‡æ›¿æ¢åŒæ ·åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š</p>
<p><strong>æ ˆä¸Šåˆ†é…</strong></p>
<p>å½“å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸æ—¶ï¼Œè¯¥<strong>å¯¹è±¡</strong>å°±å¯ä»¥é€šè¿‡æ ‡é‡æ›¿æ¢åˆ†è§£æˆæˆå‘˜æ ‡é‡åˆ†é…åœ¨<strong>æ ˆå†…å­˜</strong>ä¸­ï¼Œå’Œæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œéšç€æ ˆå¸§å‡ºæ ˆæ—¶é”€æ¯ï¼Œå‡å°‘äº† GC å‹åŠ›ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºæ€§èƒ½</p>
<h4 id="æ–¹æ³•å†…è”"><a href="#æ–¹æ³•å†…è”" class="headerlink" title="æ–¹æ³•å†…è”"></a>æ–¹æ³•å†…è”</h4><h5 id="å†…è”å‡½æ•°"><a href="#å†…è”å‡½æ•°" class="headerlink" title="å†…è”å‡½æ•°"></a><strong>å†…è”å‡½æ•°</strong></h5><p>å†…è”å‡½æ•°å°±æ˜¯åœ¨ç¨‹åºç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å°†ç¨‹åºä¸­å‡ºç°çš„å†…è”å‡½æ•°çš„è°ƒç”¨è¡¨è¾¾å¼ç”¨å†…è”å‡½æ•°çš„å‡½æ•°ä½“æ¥ç›´æ¥è¿›è¡Œæ›¿æ¢</p>
<h5 id="JVMå†…è”å‡½æ•°"><a href="#JVMå†…è”å‡½æ•°" class="headerlink" title="JVMå†…è”å‡½æ•°"></a><strong>JVMå†…è”å‡½æ•°</strong></h5><p>C++æ˜¯å¦ä¸ºå†…è”å‡½æ•°ç”±è‡ªå·±å†³å®šï¼ŒJavaç”±<strong>ç¼–è¯‘å™¨å†³å®š</strong>ã€‚Javaä¸æ”¯æŒç›´æ¥å£°æ˜ä¸ºå†…è”å‡½æ•°çš„ï¼Œå¦‚æœæƒ³è®©ä»–å†…è”ï¼Œä½ åªèƒ½å¤Ÿå‘ç¼–è¯‘å™¨æå‡ºè¯·æ±‚: å…³é”®å­—<strong>finalä¿®é¥°</strong> ç”¨æ¥æŒ‡æ˜é‚£ä¸ªå‡½æ•°æ˜¯å¸Œæœ›è¢«JVMå†…è”çš„ï¼Œå¦‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>&#123;  <br>        <span class="hljs-comment">// to do something  </span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>æ€»çš„æ¥è¯´ï¼Œä¸€èˆ¬çš„å‡½æ•°éƒ½ä¸ä¼šè¢«å½“åšå†…è”å‡½æ•°ï¼Œåªæœ‰å£°æ˜äº†finalåï¼Œç¼–è¯‘å™¨æ‰ä¼šè€ƒè™‘æ˜¯ä¸æ˜¯è¦æŠŠä½ çš„å‡½æ•°å˜æˆå†…è”å‡½æ•°</p>
<p>JVMå†…å»ºæœ‰è®¸å¤šè¿è¡Œæ—¶ä¼˜åŒ–ã€‚é¦–å…ˆ<strong>çŸ­æ–¹æ³•</strong>æ›´åˆ©äºJVMæ¨æ–­ã€‚æµç¨‹æ›´æ˜æ˜¾ï¼Œä½œç”¨åŸŸæ›´çŸ­ï¼Œå‰¯ä½œç”¨ä¹Ÿæ›´æ˜æ˜¾ã€‚å¦‚æœæ˜¯é•¿æ–¹æ³•JVMå¯èƒ½ç›´æ¥å°±è·ªäº†ã€‚</p>
<p>ç¬¬äºŒä¸ªåŸå› åˆ™æ›´é‡è¦ï¼š<strong>æ–¹æ³•å†…è”</strong></p>
<p>å¦‚æœJVMç›‘æµ‹åˆ°ä¸€äº›<strong>å°æ–¹æ³•è¢«é¢‘ç¹çš„æ‰§è¡Œ</strong>ï¼Œå®ƒä¼šæŠŠæ–¹æ³•çš„è°ƒç”¨æ›¿æ¢æˆæ–¹æ³•ä½“æœ¬èº«ï¼Œå¦‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add4</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> x3, <span class="hljs-keyword">int</span> x4)</span> </span>&#123; <br>		<span class="hljs-comment">//è¿™é‡Œè°ƒç”¨äº†add2æ–¹æ³•</span><br>        <span class="hljs-keyword">return</span> add2(x1, x2) + add2(x3, x4);  <br>    &#125;  <br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2)</span> </span>&#123;  <br>        <span class="hljs-keyword">return</span> x1 + x2;  <br>    &#125;<br></code></pre></td></tr></table></figure>

<p>æ–¹æ³•è°ƒç”¨è¢«æ›¿æ¢å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add4</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> x3, <span class="hljs-keyword">int</span> x4)</span> </span>&#123;  <br>    	<span class="hljs-comment">//è¢«æ›¿æ¢ä¸ºäº†æ–¹æ³•æœ¬èº«</span><br>        <span class="hljs-keyword">return</span> x1 + x2 + x3 + x4;  <br>&#125;<br></code></pre></td></tr></table></figure>

<h4 id="åå°„ä¼˜åŒ–"><a href="#åå°„ä¼˜åŒ–" class="headerlink" title="åå°„ä¼˜åŒ–"></a>åå°„ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reflect1</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;foo...&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;<br>      Method foo = Demo3.class.getMethod(<span class="hljs-string">&quot;foo&quot;</span>);<br>      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i&lt;=<span class="hljs-number">16</span>; i++) &#123;<br>         foo.invoke(<span class="hljs-keyword">null</span>);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>foo.invoke å‰é¢ 0 ~ 15 æ¬¡è°ƒç”¨ä½¿ç”¨çš„æ˜¯ MethodAccessor çš„ NativeMethodAccessorImpl å®ç°</p>
<p>invokeæ–¹æ³•æºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CallerSensitive</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object obj, Object... args)</span></span><br><span class="hljs-function">    <span class="hljs-keyword">throws</span> IllegalAccessException, IllegalArgumentException,</span><br><span class="hljs-function">       InvocationTargetException</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!override) &#123;<br>        <span class="hljs-keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;<br>            Class&lt;?&gt; caller = Reflection.getCallerClass();<br>            checkAccess(caller, clazz, obj, modifiers);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//MethodAccessoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰3ä¸ªå®ç°ç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯æŠ½è±¡ç±»</span><br>    MethodAccessor ma = methodAccessor;             <span class="hljs-comment">// read volatile</span><br>    <span class="hljs-keyword">if</span> (ma == <span class="hljs-keyword">null</span>) &#123;<br>        ma = acquireMethodAccessor();<br>    &#125;<br>    <span class="hljs-keyword">return</span> ma.invoke(obj, args);<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614133554.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614133554.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¼šç”±DelegatingMehodAccessorImplå»è°ƒç”¨NativeMethodAccessorImpl</p>
<p>NativeMethodAccessorImplæºç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NativeMethodAccessorImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MethodAccessorImpl</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Method method;<br>    <span class="hljs-keyword">private</span> DelegatingMethodAccessorImpl parent;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> numInvocations;<br><br>    NativeMethodAccessorImpl(Method var1) &#123;<br>        <span class="hljs-keyword">this</span>.method = var1;<br>    &#125;<br>	<br>	<span class="hljs-comment">//æ¯æ¬¡è¿›è¡Œåå°„è°ƒç”¨ï¼Œä¼šè®©numInvocationä¸ReflectionFactory.inflationThresholdçš„å€¼ï¼ˆ15ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä½¿ä½¿å¾—numInvocationçš„å€¼åŠ ä¸€</span><br>	<span class="hljs-comment">//å¦‚æœnumInvocation&gt;ReflectionFactory.inflationThresholdï¼Œåˆ™ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object var1, Object[] var2)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException, InvocationTargetException </span>&#123;<br>        <span class="hljs-keyword">if</span> (++<span class="hljs-keyword">this</span>.numInvocations &gt; ReflectionFactory.inflationThreshold() &amp;&amp; !ReflectUtil.isVMAnonymousClass(<span class="hljs-keyword">this</span>.method.getDeclaringClass())) &#123;<br>            MethodAccessorImpl var3 = (MethodAccessorImpl)(<span class="hljs-keyword">new</span> MethodAccessorGenerator()).generateMethod(<span class="hljs-keyword">this</span>.method.getDeclaringClass(), <span class="hljs-keyword">this</span>.method.getName(), <span class="hljs-keyword">this</span>.method.getParameterTypes(), <span class="hljs-keyword">this</span>.method.getReturnType(), <span class="hljs-keyword">this</span>.method.getExceptionTypes(), <span class="hljs-keyword">this</span>.method.getModifiers());<br>            <span class="hljs-keyword">this</span>.parent.setDelegate(var3);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> invoke0(<span class="hljs-keyword">this</span>.method, var1, var2);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setParent</span><span class="hljs-params">(DelegatingMethodAccessorImpl var1)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.parent = var1;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> Object <span class="hljs-title">invoke0</span><span class="hljs-params">(Method var0, Object var1, Object[] var2)</span></span>;<br>&#125;<br><span class="hljs-comment">//ReflectionFactory.inflationThreshold()æ–¹æ³•çš„è¿”å›å€¼</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> inflationThreshold = <span class="hljs-number">15</span>;<br></code></pre></td></tr></table></figure>

<ul>
<li>ä¸€å¼€å§‹ifæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0</li>
<li>éšç€numInvocationçš„å¢å¤§ï¼Œå½“å®ƒå¤§äºReflectionFactory.inflationThresholdçš„å€¼16æ—¶ï¼Œå°±ä¼šæœ¬åœ°æ–¹æ³•è®¿é—®å™¨æ›¿æ¢ä¸ºä¸€ä¸ªè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„è®¿é—®å™¨ï¼Œæ¥æé«˜æ•ˆç‡<ul>
<li>è¿™æ—¶ä¼šä»åå°„è°ƒç”¨å˜ä¸º<strong>æ­£å¸¸è°ƒç”¨</strong>ï¼Œå³ç›´æ¥è°ƒç”¨ Reflect1.foo()</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614135011.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614135011.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="äº”ã€å†…å­˜æ¨¡å‹"><a href="#äº”ã€å†…å­˜æ¨¡å‹" class="headerlink" title="äº”ã€å†…å­˜æ¨¡å‹"></a>äº”ã€å†…å­˜æ¨¡å‹</h2><p>å†…å­˜æ¨¡å‹å†…å®¹è¯¦è§ <a target="_blank" rel="noopener" href="http://lihengxu.cn/2021/04/17/JUC/#%E5%9B%9B%E3%80%81%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E5%86%85%E5%AD%98">JAVAå¹¶å‘ ç¬¬å››ç« </a></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/categories/Java/JVM/">JVM</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Java/">Java</a>
                    
                      <a class="hover-with-bg" href="/tags/JVM/">JVM</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/04/22/%E9%9D%A2%E8%AF%95%E5%A4%8D%E7%9B%98%EF%BC%9A%E8%9A%82%E8%9A%81cro%E7%BA%BF%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E9%83%A8%E9%97%A8%E9%9D%A2%E7%BB%8F2+1/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">èš‚èšå¤§å®‰å…¨javaå¼€å‘å®ä¹ é¢ç»ï¼ˆ2+1ï¼‰</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/04/17/JUC/">
                        <span class="hidden-mobile">JUCå­¦ä¹ </span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                  
                
                
  <div id="vcomments"></div>
  <script type="text/javascript">
    Fluid.utils.waitElementVisible('vcomments', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', function () {
        new Valine({
          el: "#vcomments",
          app_id: "zTPGNcnnYmT218Av5iBL8nGh-gzGzoHsz",
          app_key: "Nk68rUDzBxauuv3b7ro1QdtD",
          placeholder: "åæ§½",
          path: window.location.pathname,
          avatar: "retro",
          meta: ["nick","mail","link"],
          pageSize: "10",
          lang: "zh-CN",
          highlight: false,
          recordIP: false,
          serverURLs: "https://ztpgncnn.lc-cn-n1-shared.com",
        });
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the
    <a target="_blank" href="https://valine.js.org" rel="nofollow noopener noopener">comments powered by Valine.</a>
  </noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud ç»Ÿè®¡PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="leancloud-site-pv"></span>
             æ¬¡
          </span>
      
      
        <!-- LeanCloud ç»Ÿè®¡UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="leancloud-site-uv"></span>
             äºº
          </span>
      

    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      $('#local-search-input').on('click', function() {
        searchFunc(path, 'local-search-input', 'local-search-result');
      });
      $('#modalSearch').on('shown.bs.modal', function() {
        $('#local-search-input').focus();
      });
    })()
  </script>












  

  

  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>



</body>
</html>

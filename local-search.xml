<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>SSMåŸºç¡€æ¡†æ¶å­¦ä¹ </title>
    <link href="/2021/06/27/SSM%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"/>
    <url>/2021/06/27/SSM%E5%9F%BA%E7%A1%80%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="SSMåŸºç¡€æ¡†æ¶å­¦ä¹ "><a href="#SSMåŸºç¡€æ¡†æ¶å­¦ä¹ " class="headerlink" title="SSMåŸºç¡€æ¡†æ¶å­¦ä¹ "></a>SSMåŸºç¡€æ¡†æ¶å­¦ä¹ </h1><blockquote><p>å‰è¨€ï¼šæœ€è¿‘ä¸€ç›´åœ¨å®ä¹ ï¼Œæ²¡æ€ä¹ˆæ›´æ–°ç¬”è®°äº†ï¼Œç”±äºèš‚èšçš„SOFAå’ŒSOFABootå°±æ˜¯åŸºäºSpringå’ŒSpringBootçš„ï¼Œæ‰€ä»¥è¿™é‡Œå¤ä¹ ä¸€ä¸‹SSMï¼ˆä¹‹å‰springå­¦äº†ä¸€ä¸ªåŠåŠå­ï¼Œè¿«äºæ— å¥ˆå¤ä¹ ğŸ•ï¼‰</p></blockquote><h2 id="1-Spring-ç®€ä»‹"><a href="#1-Spring-ç®€ä»‹" class="headerlink" title="1. Spring ç®€ä»‹"></a>1. Spring ç®€ä»‹</h2><h3 id="1-1-Spring-æ˜¯ä»€ä¹ˆ"><a href="#1-1-Spring-æ˜¯ä»€ä¹ˆ" class="headerlink" title="1.1 Spring æ˜¯ä»€ä¹ˆ"></a>1.1 Spring æ˜¯ä»€ä¹ˆ</h3><p>Springæ˜¯åˆ†å±‚çš„ Java SE/EEåº”ç”¨ full-stack è½»é‡çº§å¼€æºæ¡†æ¶ï¼Œä»¥ <font color=#FF0000><strong>IoC</strong></font>ï¼ˆInverse Of Controlï¼šåè½¬æ§åˆ¶ï¼‰å’Œ  <font color=#FF0000><strong>AOP</strong></font>ï¼ˆAspect Oriented Programmingï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ä¸ºå†…æ ¸ã€‚</p><p>æä¾›äº†<font color=#FF0000><strong>å±•ç°å±‚</strong> <strong>SpringMVC</strong></font> å’Œ<font color=#FF0000><strong>æŒä¹…å±‚</strong> <strong>Spring</strong> <strong>JDBCTemplate</strong> </font>ä»¥åŠ<font color=#FF0000><strong>ä¸šåŠ¡å±‚äº‹åŠ¡ç®¡ç†</strong></font>ç­‰ä¼—å¤šçš„ä¼ä¸šçº§åº”ç”¨æŠ€æœ¯ï¼Œè¿˜èƒ½æ•´åˆå¼€æºä¸–ç•Œä¼—å¤šè‘—åçš„ç¬¬ä¸‰æ–¹æ¡†æ¶å’Œç±»åº“ï¼Œé€æ¸æˆä¸ºä½¿ç”¨æœ€å¤šçš„Java EE ä¼ä¸šåº”ç”¨å¼€æºæ¡†æ¶ã€‚</p><h3 id="1-2-Spring-å‘å±•å†ç¨‹"><a href="#1-2-Spring-å‘å±•å†ç¨‹" class="headerlink" title="1.2 Spring å‘å±•å†ç¨‹"></a>1.2 Spring å‘å±•å†ç¨‹</h3><p>1997 å¹´ï¼Œ IBMæå‡ºäº†EJB çš„æ€æƒ³</p><p>1998 å¹´ï¼ŒSUNåˆ¶å®šå¼€å‘æ ‡å‡†è§„èŒƒ EJB1.0</p><p>1999 å¹´ï¼ŒEJB1.1 å‘å¸ƒ</p><p>2001 å¹´ï¼ŒEJB2.0 å‘å¸ƒ</p><p>2003 å¹´ï¼ŒEJB2.1 å‘å¸ƒ</p><p>2006 å¹´ï¼ŒEJB3.0 å‘å¸ƒ</p><p><strong>Rod Johnson</strong> <strong>ï¼ˆ</strong> <strong>Spring</strong> <strong>ä¹‹çˆ¶ï¼‰</strong></p><p>Expert One-to-One J2EE Design and Development(2002)</p><p>é˜è¿°äº† J2EE ä½¿ç”¨EJB å¼€å‘è®¾è®¡çš„ä¼˜ç‚¹åŠè§£å†³æ–¹æ¡ˆ</p><p>Expert One-to-One J2EE Development without EJB(2004)</p><p>é˜è¿°äº† J2EE å¼€å‘ä¸ä½¿ç”¨ EJBçš„è§£å†³æ–¹å¼ï¼ˆSpring é›å½¢ï¼‰</p><p><strong>2017</strong> <strong>å¹´</strong> <strong>9</strong> <strong>æœˆä»½å‘å¸ƒäº†</strong> <strong>Spring</strong> <strong>çš„æœ€æ–°ç‰ˆæœ¬</strong> <strong>Spring5.0</strong> <strong>é€šç”¨ç‰ˆï¼ˆGAï¼‰</strong></p><h3 id="1-3-Spring-ä¼˜åŠ¿"><a href="#1-3-Spring-ä¼˜åŠ¿" class="headerlink" title="1.3 Spring ä¼˜åŠ¿"></a>1.3 Spring ä¼˜åŠ¿</h3><ol><li>æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘ï¼ˆIOCå®¹å™¨ï¼‰</li><li>AOP ç¼–ç¨‹çš„æ”¯æŒï¼ˆAOPå¯ä»¥è½»æ¾è§£å†³ä¸€äº›OOPä¸å®¹æ˜“å®ç°çš„åŠŸèƒ½ï¼‰</li><li>å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ</li><li>æ–¹ä¾¿ç¨‹åºæµ‹è¯•</li><li>æ–¹ä¾¿ç»§æ‰¿å„ç§ä¼˜ç§€æ¡†æ¶</li><li>é™ä½JavaEE API çš„ä½¿ç”¨éš¾åº¦ï¼ˆå¯¹JDBCã€JavaMailã€è¿œç¨‹è°ƒç”¨ç­‰è¿›è¡Œäº†è–„å°è£…å‡ä½ä½¿ç”¨éš¾åº¦ï¼‰</li><li>Java æºç å¼ç»å…¸å­¦ä¹ èŒƒä¾‹ï¼ˆçµæ´»è¿ç”¨ Java è®¾è®¡æ¨¡å¼ï¼‰</li></ol><h3 id="1-4-Spring-ä½“ç³»ç»“æ„"><a href="#1-4-Spring-ä½“ç³»ç»“æ„" class="headerlink" title="1.4 Spring ä½“ç³»ç»“æ„"></a>1.4 Spring ä½“ç³»ç»“æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-1-20210627.png"></p><h3 id="1-5-SSM-ä¸‰å±‚æ¶æ„"><a href="#1-5-SSM-ä¸‰å±‚æ¶æ„" class="headerlink" title="1.5 SSM ä¸‰å±‚æ¶æ„"></a>1.5 SSM ä¸‰å±‚æ¶æ„</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-2-20210628.png"></p><p>è€Œå…¶ä¸­ MVC è®¾è®¡æ¨¡å‹ï¼š</p><ul><li>Mï¼šmodel æ¨¡å‹ JavaBean</li><li>Vï¼šView è§†å›¾ JSP</li><li>Cï¼šController æ§åˆ¶å™¨ Servlet</li></ul><h2 id="2-Spring-çš„IoCå’ŒDI"><a href="#2-Spring-çš„IoCå’ŒDI" class="headerlink" title="2. Spring çš„IoCå’ŒDI"></a>2. Spring çš„IoCå’ŒDI</h2><h3 id="2-1-å¿«é€Ÿå…¥é—¨"><a href="#2-1-å¿«é€Ÿå…¥é—¨" class="headerlink" title="2.1 å¿«é€Ÿå…¥é—¨"></a>2.1 å¿«é€Ÿå…¥é—¨</h3><p>é€šè¿‡å¿«é€Ÿå…¥é—¨ç®€å•ä½“ä¼š IoC ï¼ŒæŠŠå¯¹è±¡åˆ›å»ºæƒäº¤ç»™äº†Springæ¡†æ¶ï¼Œé€šè¿‡ IoC èƒ½é™ä½è€¦åˆä½†æ˜¯ä¸èƒ½æ¥è§¦è€¦åˆ</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-3-20210628.png"></p><p>â‘  æ–°å»ºMavenå·¥ç¨‹ï¼Œå¯¼å…¥ Spring å¼€å‘çš„åŸºæœ¬åŒ…åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">spring.version</span>&gt;</span>5.0.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">spring.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--å¯¼å…¥springçš„contextåæ ‡ï¼Œcontextä¾èµ–coreã€beansã€expression--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡ ç¼–å†™ Dao æ¥å£å’Œå®ç°ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;UserDao save method running....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¢ åœ¨ç±»è·¯å¾„ä¸‹ï¼ˆresourcesï¼‰åˆ›å»º Spring æ ¸å¿ƒé…ç½®æ–‡ä»¶ applicationContext.xml</p><p>â‘£ åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­é…ç½® UserDaoImpl</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans </span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¤ ä½¿ç”¨ Spring çš„ API åˆ›å»º ApplicationContext å¯¹è±¡ï¼Œä½¿ç”¨ getBean æ–¹æ³•è·å¾— Bean å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;<br>    ApplicationContext applicationContext = <span class="hljs-keyword">new</span>  <br>             ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>    UserDao userDao = (UserDao) applicationContext.getBean(<span class="hljs-string">&quot;userDao&quot;</span>);<br>    userDao.save();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-Spring-é…ç½®æ–‡ä»¶å¼€å‘"><a href="#2-2-Spring-é…ç½®æ–‡ä»¶å¼€å‘" class="headerlink" title="2.2 Spring é…ç½®æ–‡ä»¶å¼€å‘"></a>2.2 Spring é…ç½®æ–‡ä»¶å¼€å‘</h3><h4 id="2-2-1-Springçš„é‡ç‚¹é…ç½®"><a href="#2-2-1-Springçš„é‡ç‚¹é…ç½®" class="headerlink" title="2.2.1 Springçš„é‡ç‚¹é…ç½®"></a>2.2.1 Springçš„é‡ç‚¹é…ç½®</h4><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs delphi">&lt;bean&gt;æ ‡ç­¾<br>    idå±æ€§:åœ¨å®¹å™¨ä¸­Beanå®ä¾‹çš„å”¯ä¸€æ ‡è¯†ï¼Œä¸å…è®¸é‡å¤<br>    <span class="hljs-keyword">class</span>å±æ€§:è¦å®ä¾‹åŒ–çš„Beançš„å…¨é™å®šå<br>    scopeå±æ€§:Beançš„ä½œç”¨èŒƒå›´ï¼Œå¸¸ç”¨æ˜¯Singleton(é»˜è®¤)å’Œprototype<br>    &lt;<span class="hljs-keyword">property</span>&gt;æ ‡ç­¾ï¼šå±æ€§æ³¨å…¥<br>        <span class="hljs-keyword">name</span>å±æ€§ï¼šå±æ€§åç§°<br>        valueå±æ€§ï¼šæ³¨å…¥çš„æ™®é€šå±æ€§å€¼<br>        refå±æ€§ï¼šæ³¨å…¥çš„å¯¹è±¡å¼•ç”¨å€¼<br>        &lt;list&gt;æ ‡ç­¾<br>        &lt;map&gt;æ ‡ç­¾<br>        &lt;properties&gt;æ ‡ç­¾<br>    &lt;<span class="hljs-function"><span class="hljs-keyword">constructor</span>-<span class="hljs-title">arg</span>&gt;æ ‡ç­¾</span><br><span class="hljs-function">&lt;<span class="hljs-title">import</span>&gt;æ ‡ç­¾:</span>å¯¼å…¥å…¶ä»–çš„Springçš„åˆ†æ–‡ä»¶<br></code></pre></td></tr></table></figure><h4 id="2-2-2-Bean-æ ‡ç­¾åŸºæœ¬é…ç½®"><a href="#2-2-2-Bean-æ ‡ç­¾åŸºæœ¬é…ç½®" class="headerlink" title="2.2.2 Bean æ ‡ç­¾åŸºæœ¬é…ç½®"></a>2.2.2 Bean æ ‡ç­¾åŸºæœ¬é…ç½®</h4><p>ç”¨äºé…ç½®å¯¹è±¡äº¤ç”±<strong>Spring</strong> æ¥åˆ›å»ºã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹å®ƒè°ƒç”¨çš„æ˜¯ç±»ä¸­çš„<strong>æ— å‚æ„é€ å‡½æ•°</strong>ï¼Œå¦‚æœæ²¡æœ‰æ— å‚æ„é€ å‡½æ•°åˆ™ä¸èƒ½åˆ›å»ºæˆåŠŸã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;xxx&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.xxx.xxx&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åŸºæœ¬å±æ€§ï¼š</p><ul><li><p><strong>id</strong>ï¼šBeanå®ä¾‹åœ¨Springå®¹å™¨ä¸­çš„å”¯ä¸€æ ‡è¯†</p></li><li><p><strong>class</strong>ï¼šBeançš„å…¨é™å®šåç§°</p></li></ul><h4 id="2-2-3-Bean-æ ‡ç­¾èŒƒå›´é…ç½®"><a href="#2-2-3-Bean-æ ‡ç­¾èŒƒå›´é…ç½®" class="headerlink" title="2.2.3 Bean æ ‡ç­¾èŒƒå›´é…ç½®"></a>2.2.3 Bean æ ‡ç­¾èŒƒå›´é…ç½®</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-4-20210628.png"></p><ul><li><p>å½“ <strong>scope</strong> çš„å–å€¼ä¸º <strong>singleton</strong> æ—¶</p><p>Beançš„å®ä¾‹åŒ–ä¸ªæ•°ï¼š1ä¸ª</p><p>Beançš„å®ä¾‹åŒ–æ—¶æœºï¼š <font color=#FF0000><strong>å½“Springæ ¸å¿ƒæ–‡ä»¶è¢«åŠ è½½æ—¶ï¼Œå®ä¾‹åŒ–é…ç½®çš„Beanå®ä¾‹</strong></font></p><p>Beançš„ç”Ÿå‘½å‘¨æœŸï¼š</p><ul><li>å¯¹è±¡åˆ›å»ºï¼šå½“åº”ç”¨åŠ è½½ï¼Œåˆ›å»ºå®¹å™¨æ—¶ï¼Œå¯¹è±¡å°±è¢«åˆ›å»ºäº†</li><li>å¯¹è±¡è¿è¡Œï¼šåªè¦å®¹å™¨åœ¨ï¼Œå¯¹è±¡ä¸€ç›´æ´»ç€</li><li>å¯¹è±¡é”€æ¯ï¼šå½“åº”ç”¨å¸è½½ï¼Œé”€æ¯å®¹å™¨æ—¶ï¼Œå¯¹è±¡å°±è¢«é”€æ¯äº†</li></ul></li><li><p>å½“ <strong>scope</strong> çš„å–å€¼ä¸º prototype æ—¶</p><p>Beançš„å®ä¾‹åŒ–ä¸ªæ•°ï¼šå¤šä¸ª</p><p>Beançš„å®ä¾‹åŒ–æ—¶æœºï¼š <font color=#FF0000><strong>å½“è°ƒç”¨getBean()æ–¹æ³•æ—¶å®ä¾‹åŒ–Bean</strong></font></p><ul><li>å¯¹è±¡åˆ›å»ºï¼šå½“ä½¿ç”¨å¯¹è±¡æ—¶ï¼Œåˆ›å»ºæ–°çš„å¯¹è±¡å®ä¾‹</li><li>å¯¹è±¡è¿è¡Œï¼šåªè¦å¯¹è±¡åœ¨ä½¿ç”¨ä¸­ï¼Œå°±ä¸€ç›´æ´»ç€</li><li>å¯¹è±¡é”€æ¯ï¼šå½“å¯¹è±¡é•¿æ—¶é—´ä¸ç”¨æ—¶ï¼Œè¢« Java çš„åƒåœ¾å›æ”¶å™¨å›æ”¶äº†</li></ul></li></ul><h4 id="2-2-4-Bean-ç”Ÿå‘½å‘¨æœŸé…ç½®"><a href="#2-2-4-Bean-ç”Ÿå‘½å‘¨æœŸé…ç½®" class="headerlink" title="2.2.4 Bean ç”Ÿå‘½å‘¨æœŸé…ç½®"></a>2.2.4 Bean ç”Ÿå‘½å‘¨æœŸé…ç½®</h4><ul><li><p><strong>init-method</strong>ï¼šæŒ‡å®šç±»ä¸­çš„åˆå§‹åŒ–æ–¹æ³•åç§°</p></li><li><p><strong>destroy-method</strong>ï¼šæŒ‡å®šç±»ä¸­é”€æ¯æ–¹æ³•åç§°</p></li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span> <span class="hljs-attr">init-method</span>=<span class="hljs-string">&quot;init&quot;</span> <span class="hljs-attr">destroy-method</span>=<span class="hljs-string">&quot;destory&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="2-2-5-Bean-å®ä¾‹åŒ–ä¸‰ç§æ–¹æ³•"><a href="#2-2-5-Bean-å®ä¾‹åŒ–ä¸‰ç§æ–¹æ³•" class="headerlink" title="2.2.5 Bean å®ä¾‹åŒ–ä¸‰ç§æ–¹æ³•"></a>2.2.5 Bean å®ä¾‹åŒ–ä¸‰ç§æ–¹æ³•</h4><ul><li><p>æ— å‚<strong>æ„é€ </strong>æ–¹æ³•å®ä¾‹åŒ–ï¼ˆé»˜è®¤ï¼‰</p></li><li><p>å·¥å‚<strong>é™æ€</strong>æ–¹æ³•å®ä¾‹åŒ–</p></li><li><p>å·¥å‚<strong>å®ä¾‹</strong>æ–¹æ³•å®ä¾‹åŒ– </p></li></ul><ol><li><p><strong>ä½¿ç”¨æ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–</strong></p><p>å®ƒä¼šæ ¹æ®é»˜è®¤æ— å‚æ„é€ æ–¹æ³•æ¥åˆ›å»ºç±»å¯¹è±¡ï¼Œå¦‚æœbeanä¸­æ²¡æœ‰é»˜è®¤æ— å‚æ„é€ å‡½æ•°ï¼Œå°†ä¼šåˆ›å»ºå¤±è´¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>å·¥å‚é™æ€æ–¹æ³•å®ä¾‹åŒ–</strong></p><p>å·¥å‚çš„é™æ€æ–¹æ³•è¿”å›Beanå®ä¾‹</p><p>ç”±äºæ˜¯é™æ€æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä½¿ç”¨å·¥å‚ç±»çš„ class ç±»å¯¹è±¡ç›´æ¥ç›´æ¥è°ƒç”¨è¿”å›ç±»å¯¹è±¡ï¼Œä¸éœ€è¦è·å¾—å·¥å‚çš„bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StaticFactoryBean</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserDao <span class="hljs-title">createUserDao</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserDaoImpl();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.factory.StaticFactoryBean&quot;</span> </span><br><span class="hljs-tag">      <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;createUserDao&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></li><li><p> <strong>å·¥å‚å®ä¾‹æ–¹æ³•å®ä¾‹åŒ–</strong></p></li></ol><p>   å·¥å‚çš„éé™æ€æ–¹æ³•è¿”å›Beanå®ä¾‹</p><p>   éé™æ€æ–¹æ³•ï¼Œéœ€è¦å…ˆè·å¾—å·¥å‚ beanï¼Œå†é€šè¿‡å·¥å‚ bean è·å¾— userDao</p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DynamicFactoryBean</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> UserDao <span class="hljs-title">createUserDao</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UserDaoImpl();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>   <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;factoryBean&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.factory.DynamicFactoryBean&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">factory-bean</span>=<span class="hljs-string">&quot;factoryBean&quot;</span> <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;createUserDao&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h4 id="2-2-6-Bean-ä¾èµ–æ³¨å…¥â­"><a href="#2-2-6-Bean-ä¾èµ–æ³¨å…¥â­" class="headerlink" title="2.2.6 Bean ä¾èµ–æ³¨å…¥â­"></a>2.2.6 Bean ä¾èµ–æ³¨å…¥â­</h4><h5 id="2-2-6-1-åˆ†æ"><a href="#2-2-6-1-åˆ†æ" class="headerlink" title="2.2.6.1 åˆ†æ"></a>2.2.6.1 åˆ†æ</h5><p>UserServiceå®ä¾‹å’ŒUserDaoå®ä¾‹éƒ½å­˜åœ¨ä¸Springå®¹å™¨ä¸­ï¼Œä¸€ç§åšæ³•æ˜¯åœ¨å®¹å™¨å¤–éƒ¨è·å¾—UserServiceå®ä¾‹å’ŒUserDaoå®ä¾‹ï¼Œç„¶ååœ¨ç¨‹åºä¸­è¿›è¡Œç»“åˆã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-5-20210628.png"></p><p>å¦ä¸€ç§åšæ³•æ˜¯ï¼Œå› ä¸ºUserServiceå’ŒUserDaoéƒ½åœ¨Springå®¹å™¨ä¸­ï¼Œè€Œæœ€ç»ˆç¨‹åºç›´æ¥ä½¿ç”¨çš„æ˜¯UserServiceï¼Œæ‰€ä»¥å¯ä»¥åœ¨Springå®¹å™¨ä¸­ï¼Œå°†UserDaoè®¾ç½®åˆ°UserServiceå†…éƒ¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-6-20210628.png"></p><h5 id="2-2-6-2-æ¦‚å¿µ"><a href="#2-2-6-2-æ¦‚å¿µ" class="headerlink" title="2.2.6.2 æ¦‚å¿µ"></a>2.2.6.2 æ¦‚å¿µ</h5><p><font color=#FF0000>ä¾èµ–æ³¨å…¥ï¼ˆ<strong>Dependency Injection</strong>ï¼‰ï¼šå®ƒæ˜¯ Spring æ¡†æ¶æ ¸å¿ƒ IOC çš„å…·ä½“å®ç°ã€‚</font></p><p>åœ¨ç¼–å†™ç¨‹åºæ—¶ï¼Œé€šè¿‡æ§åˆ¶åè½¬ï¼ŒæŠŠå¯¹è±¡çš„åˆ›å»ºäº¤ç»™äº† Springï¼Œä½†æ˜¯ä»£ç ä¸­ä¸å¯èƒ½å‡ºç°æ²¡æœ‰ä¾èµ–çš„æƒ…å†µã€‚</p><p><font color=#FF0000><strong>IOC è§£è€¦åªæ˜¯é™ä½ä»–ä»¬çš„ä¾èµ–å…³ç³»ï¼Œä½†ä¸ä¼šæ¶ˆé™¤ã€‚</strong></font>ä¾‹å¦‚ï¼šä¸šåŠ¡å±‚ä»ä¼šè°ƒç”¨æŒä¹…å±‚çš„æ–¹æ³•ã€‚</p><p>é‚£è¿™ç§ä¸šåŠ¡å±‚å’ŒæŒä¹…å±‚çš„ä¾èµ–å…³ç³»ï¼Œåœ¨ä½¿ç”¨ Spring ä¹‹åï¼Œå°±è®© Spring æ¥ç»´æŠ¤äº†ã€‚</p><p>ç®€å•çš„è¯´ï¼Œå°±æ˜¯åç­‰æ¡†æ¶æŠŠæŒä¹…å±‚å¯¹è±¡ä¼ å…¥ä¸šåŠ¡å±‚ï¼Œè€Œä¸ç”¨æˆ‘ä»¬è‡ªå·±å»è·å–ã€‚</p><h5 id="2-2-6-3-ä¾èµ–æ³¨å…¥çš„æ–¹å¼"><a href="#2-2-6-3-ä¾èµ–æ³¨å…¥çš„æ–¹å¼" class="headerlink" title="2.2.6.3 ä¾èµ–æ³¨å…¥çš„æ–¹å¼"></a>2.2.6.3 ä¾èµ–æ³¨å…¥çš„æ–¹å¼</h5><ul><li><p><strong>setæ–¹æ³•</strong></p><ul><li><p>åœ¨UserServiceImplä¸­æ·»åŠ setUserDaoæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> UserDao userDao;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserDao</span><span class="hljs-params">(UserDao userDao)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.userDao = userDao;<br>    &#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        userDao.save();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>setteræ³¨å…¥æ–¹å¼1</strong>ï¼šé…ç½®Springå®¹å™¨è°ƒç”¨setæ–¹æ³•è¿›è¡Œæ³¨å…¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDao&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p><strong>setteræ³¨å…¥æ–¹å¼2</strong>ï¼šPå‘½åç©ºé—´æ³¨å…¥æœ¬è´¨ä¹Ÿæ˜¯setæ–¹æ³•æ³¨å…¥ï¼Œä½†æ¯”èµ·ä¸Šè¿°çš„setæ–¹æ³•æ³¨å…¥æ›´åŠ æ–¹ä¾¿ï¼Œä¸»è¦ä½“ç°åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><p>é¦–å…ˆï¼Œéœ€è¦å‘é…ç½®æ–‡ä»¶å¼•å…¥På‘½åç©ºé—´ï¼š</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">xmlns:</span>p=<span class="hljs-string">&quot;http://www.springframework.org/schema/p&quot;</span><br></code></pre></td></tr></table></figure><p>å…¶æ¬¡ï¼Œéœ€è¦ä¿®æ”¹æ³¨å…¥æ–¹å¼</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span> <span class="hljs-attr">p:userDao-ref</span>=<span class="hljs-string">&quot;userDao&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure></li></ul></li><li><p><strong>æ„é€ æ–¹æ³•</strong></p><ul><li><p>åˆ›å»ºæœ‰å‚æ„é€ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        ApplicationContext applicationContext = <span class="hljs-keyword">new</span> <br>                 ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>        UserDao userDao = (UserDao) applicationContext.getBean(<span class="hljs-string">&quot;userDao&quot;</span>);<br>        userDao.save();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>   é…ç½®Springå®¹å™¨è°ƒç”¨æœ‰å‚æ„é€ æ—¶è¿›è¡Œæ³¨å…¥</p></li></ul>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.service.impl.UserServiceImpl&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">constructor-arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDao&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">constructor-arg</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul><h5 id="2-2-6-4-ä¾èµ–æ³¨å…¥æ•°æ®ç±»å‹"><a href="#2-2-6-4-ä¾èµ–æ³¨å…¥æ•°æ®ç±»å‹" class="headerlink" title="2.2.6.4 ä¾èµ–æ³¨å…¥æ•°æ®ç±»å‹"></a>2.2.6.4 ä¾èµ–æ³¨å…¥æ•°æ®ç±»å‹</h5><p>ä¸Šé¢çš„æ“ä½œï¼Œéƒ½æ˜¯æ³¨å…¥çš„å¼•ç”¨Beanï¼Œé™¤äº†å¯¹è±¡çš„å¼•ç”¨å¯ä»¥æ³¨å…¥ï¼Œæ™®é€šæ•°æ®ç±»å‹ï¼Œé›†åˆç­‰éƒ½å¯ä»¥åœ¨å®¹å™¨ä¸­è¿›è¡Œæ³¨å…¥ã€‚</p><p>æ³¨å…¥æ•°æ®çš„ä¸‰ç§æ•°æ®ç±»å‹ </p><ul><li><p><strong>æ™®é€šæ•°æ®ç±»å‹</strong></p></li><li><p><strong>å¼•ç”¨æ•°æ®ç±»å‹</strong></p></li><li><p><strong>é›†åˆæ•°æ®ç±»å‹</strong></p></li></ul><p>å…¶ä¸­å¼•ç”¨æ•°æ®ç±»å‹ï¼Œæ­¤å¤„å°±ä¸å†èµ˜è¿°äº†ï¼Œä¹‹å‰çš„æ“ä½œéƒ½æ˜¯å¯¹UserDaoå¯¹è±¡çš„å¼•ç”¨è¿›è¡Œæ³¨å…¥çš„ï¼Œä¸‹é¢å°†ä»¥setæ–¹æ³•æ³¨å…¥ä¸ºä¾‹ï¼Œæ¼”ç¤ºæ™®é€šæ•°æ®ç±»å‹å’Œé›†åˆæ•°æ®ç±»å‹çš„æ³¨å…¥ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String company;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;<br>    <span class="hljs-keyword">private</span> List&lt;String&gt; strList;<br>    <span class="hljs-keyword">private</span> List&lt;User&gt; userList;<br>    <span class="hljs-keyword">private</span> Map&lt;String,User&gt; userMap;<br>    <span class="hljs-keyword">private</span> Properties properties;<br>    <br>    <span class="hljs-comment">// æ™®é€šæ•°æ®ç±»å‹</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCompany</span><span class="hljs-params">(String company)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.company = company;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(<span class="hljs-keyword">int</span> age)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br>    <br>    <span class="hljs-comment">// é›†åˆæ•°æ®ç±»å‹</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setStrList</span><span class="hljs-params">(List&lt;String&gt; strList)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.strList = strList;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserList</span><span class="hljs-params">(List&lt;User&gt; userList)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.userList = userList;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUserMap</span><span class="hljs-params">(Map&lt;String, User&gt; userMap)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.userMap = userMap;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setProperties</span><span class="hljs-params">(Properties properties)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.properties = properties;<br>    &#125;<br>    <br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(company+<span class="hljs-string">&quot;===&quot;</span>+age);<br>        System.out.println(strList);<br>        System.out.println(userList);<br>        System.out.println(userMap);<br>        System.out.println(properties);<br>        System.out.println(<span class="hljs-string">&quot;UserDao save method running....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.dao.impl.UserDaoImpl&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;company&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ä¼ æ™ºæ’­å®¢&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;age&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;15&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;strList&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>aaa<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>bbb<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>ccc<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userList&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.domain.User&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.domain.User&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;u1&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;u2&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userMap&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;user1&quot;</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">&quot;u1&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;user2&quot;</span> <span class="hljs-attr">value-ref</span>=<span class="hljs-string">&quot;u2&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;properties&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;p1&quot;</span>&gt;</span>aaa<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;p2&quot;</span>&gt;</span>bbb<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;p3&quot;</span>&gt;</span>ccc<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h5 id="2-2-6-5-å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼ˆåˆ†æ¨¡å—å¼€å‘ï¼‰"><a href="#2-2-6-5-å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼ˆåˆ†æ¨¡å—å¼€å‘ï¼‰" class="headerlink" title="2.2.6.5 å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼ˆåˆ†æ¨¡å—å¼€å‘ï¼‰"></a>2.2.6.5 å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼ˆåˆ†æ¨¡å—å¼€å‘ï¼‰</h5><p>å®é™…å¼€å‘ä¸­ï¼ŒSpringçš„é…ç½®å†…å®¹éå¸¸å¤šï¼Œè¿™å°±å¯¼è‡´Springé…ç½®å¾ˆç¹æ‚ä¸”ä½“ç§¯å¾ˆå¤§ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥å°†éƒ¨åˆ†é…ç½®æ‹†è§£åˆ°å…¶ä»–é…ç½®æ–‡ä»¶ä¸­ï¼Œè€Œåœ¨Springä¸»é…ç½®æ–‡ä»¶é€šè¿‡importæ ‡ç­¾è¿›è¡ŒåŠ è½½</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;applicationContext-xxx.xml&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2-3-Spring-ç›¸å…³-API"><a href="#2-3-Spring-ç›¸å…³-API" class="headerlink" title="2.3 Spring ç›¸å…³ API"></a>2.3 Spring ç›¸å…³ API</h3><h4 id="2-3-1-ApplicationContextçš„ç»§æ‰¿ä½“ç³»"><a href="#2-3-1-ApplicationContextçš„ç»§æ‰¿ä½“ç³»" class="headerlink" title="2.3.1 ApplicationContextçš„ç»§æ‰¿ä½“ç³»"></a>2.3.1 ApplicationContextçš„ç»§æ‰¿ä½“ç³»</h4><p><strong>applicationContext</strong>ï¼šæ¥å£ç±»å‹ï¼Œä»£è¡¨åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥é€šè¿‡å…¶å®ä¾‹è·å¾— Spring å®¹å™¨ä¸­çš„ Bean å¯¹è±¡</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-7-20210628.png"></p><p>ï¼ˆç´«è‰²ä¸ºæ¥å£ï¼Œæµ…ç»¿è‰²ä¸ºæŠ½è±¡ç±»ï¼Œç»¿è‰²ä¸ºå®ç°ç±»ï¼‰</p><h4 id="2-3-2-ApplicationContextçš„å®ç°ç±»"><a href="#2-3-2-ApplicationContextçš„å®ç°ç±»" class="headerlink" title="2.3.2 ApplicationContextçš„å®ç°ç±»"></a>2.3.2 ApplicationContextçš„å®ç°ç±»</h4><p>æˆ‘ä»¬ä¸»è¦å…³å¿ƒå…¶ä¸­ä¸‰ä¸ª</p><ol><li><p><strong>ClassPathXmlApplicationContext</strong> </p><p>å®ƒæ˜¯ä»ç±»çš„æ ¹è·¯å¾„ä¸‹åŠ è½½é…ç½®æ–‡ä»¶ æ¨èä½¿ç”¨è¿™ç§</p></li><li><p><strong>FileSystemXmlApplicationContext</strong></p><p>å®ƒæ˜¯ä»ç£ç›˜è·¯å¾„ä¸ŠåŠ è½½é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶å¯ä»¥åœ¨ç£ç›˜çš„ä»»æ„ä½ç½®</p></li><li><p><strong>AnnotationConfigApplicationContext</strong></p><p>å½“ä½¿ç”¨æ³¨è§£é…ç½®å®¹å™¨å¯¹è±¡æ—¶ï¼Œéœ€è¦ä½¿ç”¨æ­¤ç±»æ¥åˆ›å»º spring å®¹å™¨ã€‚å®ƒç”¨æ¥è¯»å–æ³¨è§£ã€‚</p></li></ol><h4 id="2-3-3-getBean-æ–¹æ³•ä½¿ç”¨"><a href="#2-3-3-getBean-æ–¹æ³•ä½¿ç”¨" class="headerlink" title="2.3.3 getBean() æ–¹æ³•ä½¿ç”¨"></a>2.3.3 getBean() æ–¹æ³•ä½¿ç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getBean</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>    assertBeanFactoryActive();<br>    <span class="hljs-keyword">return</span> getBeanFactory().getBean(name);<br>&#125;<br><br><span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T <span class="hljs-title">getBean</span><span class="hljs-params">(Class&lt;T&gt; requiredType)</span> <span class="hljs-keyword">throws</span> BeansException </span>&#123;<br>    assertBeanFactoryActive();<br>    <span class="hljs-keyword">return</span> getBeanFactory().getBean(requiredType);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>å½“å‚æ•°çš„æ•°æ®ç±»å‹æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œè¡¨ç¤ºæ ¹æ®Beançš„idä»å®¹å™¨ä¸­è·å¾—Beanå®ä¾‹ï¼Œè¿”å›æ˜¯Objectï¼Œéœ€è¦å¼ºè½¬ã€‚</p></li><li><p>å½“å‚æ•°çš„æ•°æ®ç±»å‹æ˜¯Classç±»å‹æ—¶ï¼Œè¡¨ç¤ºæ ¹æ®ç±»å‹ä»å®¹å™¨ä¸­åŒ¹é…Beanå®ä¾‹ï¼Œå½“å®¹å™¨ä¸­ç›¸åŒç±»å‹çš„Beanæœ‰å¤šä¸ªæ—¶ï¼Œåˆ™æ­¤æ–¹æ³•ä¼šæŠ¥é”™ã€‚</p></li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ApplicationContext applicationContext = <span class="hljs-keyword">new</span> <br>            ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>UserService userService1 = (UserService) applicationContext.getBean(<span class="hljs-string">&quot;userService&quot;</span>);<br>UserService userService2 = applicationContext.getBean(UserService.class);<br></code></pre></td></tr></table></figure><h4 id="2-3-4-è¦ç‚¹æ€»ç»“"><a href="#2-3-4-è¦ç‚¹æ€»ç»“" class="headerlink" title="2.3.4 è¦ç‚¹æ€»ç»“"></a>2.3.4 è¦ç‚¹æ€»ç»“</h4><p><font color=#FF0000><strong>Spring API ä½¿ç”¨</strong></font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">ApplicationContext app = <span class="hljs-keyword">new</span> ClasspathXmlApplicationContext(<span class="hljs-string">&quot;xmlæ–‡ä»¶&quot;</span>)<br>app.getBean(<span class="hljs-string">&quot;id&quot;</span>)<br>app.getBean(Class)<br></code></pre></td></tr></table></figure><h3 id="2-4-Spring-é…ç½®æ•°æ®æºï¼ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼‰"><a href="#2-4-Spring-é…ç½®æ•°æ®æºï¼ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼‰" class="headerlink" title="2.4 Spring é…ç½®æ•°æ®æºï¼ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼‰"></a>2.4 Spring é…ç½®æ•°æ®æºï¼ˆä½¿ç”¨é…ç½®æ–‡ä»¶ï¼‰</h3><h4 id="2-4-1-æ•°æ®æºçš„ä½œç”¨ï¼ˆå›é¡¾ï¼‰"><a href="#2-4-1-æ•°æ®æºçš„ä½œç”¨ï¼ˆå›é¡¾ï¼‰" class="headerlink" title="2.4.1 æ•°æ®æºçš„ä½œç”¨ï¼ˆå›é¡¾ï¼‰"></a>2.4.1 æ•°æ®æºçš„ä½œç”¨ï¼ˆå›é¡¾ï¼‰</h4><ul><li>æ•°æ®æº(è¿æ¥æ± )æ˜¯æé«˜ç¨‹åºæ€§èƒ½å¦‚å‡ºç°çš„</li><li>äº‹å…ˆå®ä¾‹åŒ–æ•°æ®æºï¼Œåˆå§‹åŒ–éƒ¨åˆ†è¿æ¥èµ„æº</li><li>ä½¿ç”¨è¿æ¥èµ„æºæ—¶ä»æ•°æ®æºä¸­è·å–</li><li>ä½¿ç”¨å®Œæ¯•åå°†è¿æ¥èµ„æºå½’è¿˜ç»™æ•°æ®æº</li></ul><p>å¸¸è§çš„æ•°æ®æº(è¿æ¥æ± )ï¼š<strong>DBCP</strong>ã€<strong>C3P0</strong>ã€<strong>BoneCP</strong>ã€<strong>Druid</strong>ç­‰</p><h4 id="2-4-2-æ•°æ®æºå¼€å‘æ­¥éª¤"><a href="#2-4-2-æ•°æ®æºå¼€å‘æ­¥éª¤" class="headerlink" title="2.4.2 æ•°æ®æºå¼€å‘æ­¥éª¤"></a>2.4.2 æ•°æ®æºå¼€å‘æ­¥éª¤</h4><p>ä»¥ä¸‹å…ˆçœ‹çœ‹<strong>æ‰‹åŠ¨åˆ›å»ºè¿‡ç¨‹</strong>ï¼Œä¸ä½¿ç”¨ Spring çš„ IoC å®¹å™¨</p><p>â‘ å¯¼å…¥æ•°æ®æºçš„åæ ‡å’Œæ•°æ®åº“é©±åŠ¨åæ ‡</p><ul><li>å¯¼å…¥c3p0å’Œdruidçš„åæ ‡</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- C3P0è¿æ¥æ±  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>c3p0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>c3p0<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.9.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- Druidè¿æ¥æ±  --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.1.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>å¯¼å…¥mysqlæ•°æ®åº“é©±åŠ¨åæ ‡</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- mysqlé©±åŠ¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.39<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡åˆ›å»ºæ•°æ®æºå¯¹è±¡ï¼Œè®¾ç½®æ•°æ®æºçš„åŸºæœ¬è¿æ¥æ•°æ®</p><ul><li>åˆ›å»ºC3P0è¿æ¥æ± </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testC3P0</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//åˆ›å»ºæ•°æ®æº</span><br>    ComboPooledDataSource dataSource = <span class="hljs-keyword">new</span> ComboPooledDataSource();<br>    <span class="hljs-comment">//è®¾ç½®æ•°æ®åº“è¿æ¥å‚æ•°</span><br>    dataSource.setDriverClass(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>    dataSource.setJdbcUrl(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);<br>    dataSource.setUser(<span class="hljs-string">&quot;root&quot;</span>);<br>    dataSource.setPassword(<span class="hljs-string">&quot;root&quot;</span>);<br>    <span class="hljs-comment">//è·å¾—è¿æ¥å¯¹è±¡</span><br>    Connection connection = dataSource.getConnection();<br>    System.out.println(connection);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åˆ›å»ºDruidè¿æ¥æ± </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDruid</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//åˆ›å»ºæ•°æ®æº</span><br>    DruidDataSource dataSource = <span class="hljs-keyword">new</span> DruidDataSource();<br>    <span class="hljs-comment">//è®¾ç½®æ•°æ®åº“è¿æ¥å‚æ•°</span><br>    dataSource.setDriverClassName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>    dataSource.setUrl(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);<br>    dataSource.setUsername(<span class="hljs-string">&quot;root&quot;</span>);<br>    dataSource.setPassword(<span class="hljs-string">&quot;root&quot;</span>);<br>    <span class="hljs-comment">//è·å¾—è¿æ¥å¯¹è±¡</span><br>    Connection connection = dataSource.getConnection();<br>    System.out.println(connection);<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¢å¯¹ä¸Šé¢çš„ç¡¬ç¼–ç è¿›è¡Œæ”¹è¿›ï¼Œæå–jdbc.propertiesé…ç½®æ–‡ä»¶ï¼Œè¯»å–jdbc.propertiesé…ç½®æ–‡ä»¶åˆ›å»ºè¿æ¥æ± </p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-meta">jdbc.driver</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span><br><span class="hljs-meta">jdbc.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/test</span><br><span class="hljs-meta">jdbc.username</span>=<span class="hljs-string">root</span><br><span class="hljs-meta">jdbc.password</span>=<span class="hljs-string">root</span><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testC3P0ByProperties</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    <span class="hljs-comment">//åŠ è½½ç±»è·¯å¾„ä¸‹çš„jdbc.properties</span><br>    ResourceBundle rb = ResourceBundle.getBundle(<span class="hljs-string">&quot;jdbc&quot;</span>);<br>    ComboPooledDataSource dataSource = <span class="hljs-keyword">new</span> ComboPooledDataSource();<br>    dataSource.setDriverClass(rb.getString(<span class="hljs-string">&quot;jdbc.driver&quot;</span>));<br>    dataSource.setJdbcUrl(rb.getString(<span class="hljs-string">&quot;jdbc.url&quot;</span>));<br>    dataSource.setUser(rb.getString(<span class="hljs-string">&quot;jdbc.username&quot;</span>));<br>    dataSource.setPassword(rb.getString(<span class="hljs-string">&quot;jdbc.password&quot;</span>));<br>    Connection connection = dataSource.getConnection();<br>    System.out.println(connection);<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘£ä½¿ç”¨æ•°æ®æºè·å–è¿æ¥èµ„æºå’Œå½’è¿˜è¿æ¥èµ„æº</p><h4 id="2-4-3-Spring-é…ç½®æ•°æ®æº"><a href="#2-4-3-Spring-é…ç½®æ•°æ®æº" class="headerlink" title="2.4.3 Spring é…ç½®æ•°æ®æº"></a>2.4.3 Spring é…ç½®æ•°æ®æº</h4><p><strong>åŸºäºä¸Šé¢æ‰‹åŠ¨åˆ›å»ºè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†DataSourceçš„åˆ›å»ºæƒäº¤ç”±Springå®¹å™¨å»å®Œæˆ</strong></p><ul><li><p>DataSourceæœ‰æ— å‚æ„é€ æ–¹æ³•ï¼Œè€ŒSpringé»˜è®¤å°±æ˜¯é€šè¿‡æ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡çš„</p></li><li><p>DataSourceè¦æƒ³ä½¿ç”¨éœ€è¦é€šè¿‡setæ–¹æ³•è®¾ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œè€ŒSpringå¯ä»¥é€šè¿‡setæ–¹æ³•è¿›è¡Œå­—ç¬¦ä¸²æ³¨å…¥</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbcUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä»å®¹å™¨å½“ä¸­è·å–æ•°æ®æº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">ApplicationContext applicationContext = <span class="hljs-keyword">new</span> <br>           ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>DataSource dataSource = (DataSource) applicationContext.getBean(<span class="hljs-string">&quot;dataSource&quot;</span>);<br>Connection connection = dataSource.getConnection();<br>System.out.println(connection);<br></code></pre></td></tr></table></figure><p><strong>æ”¹è¿›é…ç½®æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç ï¼ˆå…¶å®å¹¶æ²¡æœ‰ä¾èµ–ï¼Œä½†ä¸ä¼˜é›…ï¼‰ï¼ŒæŠ½å– jdbc é…ç½®æ–‡ä»¶</strong></p><p>applicationContext.xml åŠ è½½ jdbc.properties é…ç½®æ–‡ä»¶ï¼ˆå’Œæ‰‹åŠ¨åˆ›å»ºä¸€è‡´ï¼‰è·å¾—è¿æ¥ä¿¡æ¯</p><p>é¦–å…ˆï¼Œéœ€è¦å¼•å…¥contextå‘½åç©ºé—´å’Œçº¦æŸè·¯å¾„ï¼š</p><ul><li><p>å‘½åç©ºé—´ï¼šxmlns:context=â€<a href="http://www.springframework.org/schema/context&quot;">http://www.springframework.org/schema/context&quot;</a></p></li><li><p>çº¦æŸè·¯å¾„ï¼š<a href="http://www.springframework.org/schema/context">http://www.springframework.org/schema/context</a></p><pre><code>        http://www.springframework.org/schema/context/spring-context.xsd</code></pre></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbcUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="2-4-4-è¦ç‚¹æ€»ç»“"><a href="#2-4-4-è¦ç‚¹æ€»ç»“" class="headerlink" title="2.4.4 è¦ç‚¹æ€»ç»“"></a>2.4.4 è¦ç‚¹æ€»ç»“</h4><p><font color=#FF0000><strong>Spring å®¹å™¨åŠ è½½ properties æ–‡ä»¶</strong></font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;xx.properties&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;key&#125;&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2-5-Spring-æ³¨è§£å¼€å‘"><a href="#2-5-Spring-æ³¨è§£å¼€å‘" class="headerlink" title="2.5 Spring æ³¨è§£å¼€å‘"></a>2.5 Spring æ³¨è§£å¼€å‘</h3><h4 id="2-5-1-Spring-æ³¨è§£å¼€å‘ç®€ä»‹"><a href="#2-5-1-Spring-æ³¨è§£å¼€å‘ç®€ä»‹" class="headerlink" title="2.5.1 Spring æ³¨è§£å¼€å‘ç®€ä»‹"></a>2.5.1 Spring æ³¨è§£å¼€å‘ç®€ä»‹</h4><p>Springæ˜¯è½»ä»£ç è€Œé‡é…ç½®çš„æ¡†æ¶ï¼Œé…ç½®æ¯”è¾ƒç¹é‡ï¼Œå½±å“å¼€å‘æ•ˆç‡ï¼Œæ‰€ä»¥æ³¨è§£å¼€å‘æ˜¯ä¸€ç§è¶‹åŠ¿ï¼Œæ³¨è§£ä»£æ›¿xmlé…ç½®æ–‡ä»¶å¯ä»¥ç®€åŒ–é…ç½®ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ </p><h4 id="2-5-2-Spring-åŸå§‹æ³¨è§£"><a href="#2-5-2-Spring-åŸå§‹æ³¨è§£" class="headerlink" title="2.5.2 Spring åŸå§‹æ³¨è§£"></a>2.5.2 Spring åŸå§‹æ³¨è§£</h4><p>SpringåŸå§‹æ³¨è§£ä¸»è¦æ˜¯æ›¿ä»£ <Bean> çš„é…ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-8-20210628.png"></p><p><strong>æ³¨æ„ï¼š</strong></p><p>ä½¿ç”¨æ³¨è§£è¿›è¡Œå¼€å‘æ—¶ï¼Œéœ€è¦åœ¨applicationContext.xmlä¸­é…ç½®ç»„ä»¶æ‰«æï¼Œä½œç”¨æ˜¯æŒ‡å®šå“ªä¸ªåŒ…åŠå…¶å­åŒ…ä¸‹çš„Beanéœ€è¦è¿›è¡Œæ‰«æä»¥ä¾¿è¯†åˆ«ä½¿ç”¨æ³¨è§£é…ç½®çš„ç±»ã€å­—æ®µå’Œæ–¹æ³•ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ³¨è§£çš„ç»„ä»¶æ‰«æ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.itheima&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">context:component-scan</span>&gt;</span><br></code></pre></td></tr></table></figure><p>åŸå§‹æ³¨è§£ä½¿ç”¨çš„ç¤ºä¾‹ï¼š</p><ul><li><p>ç¤ºä¾‹ä¸€ï¼šä½¿ç”¨@Compontæˆ–@Repositoryæ ‡è¯†UserDaoImpléœ€è¦Springè¿›è¡Œå®ä¾‹åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//@Component(&quot;userDao&quot;)</span><br><span class="hljs-meta">@Repository(&quot;userDao&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;save running... ...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹äºŒï¼š</p><p>ä½¿ç”¨@Compontæˆ–@Serviceæ ‡è¯†UserServiceImpléœ€è¦Springè¿›è¡Œå®ä¾‹åŒ–</p><p>ä½¿ç”¨@Autowiredæˆ–è€…@Autowired+@Qulifieræˆ–è€…@Resourceè¿›è¡ŒuserDaoçš„æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//@Component(&quot;userService&quot;)</span><br><span class="hljs-meta">@Service(&quot;userService&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-comment">/*@Autowired</span><br><span class="hljs-comment">    @Qualifier(&quot;userDao&quot;)*/</span><br>    <span class="hljs-meta">@Resource(name=&quot;userDao&quot;)</span><br>    <span class="hljs-keyword">private</span> UserDao userDao;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        userDao.save();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹ä¸‰ï¼š</p><p>ä½¿ç”¨@Valueè¿›è¡Œå­—ç¬¦ä¸²çš„æ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository(&quot;userDao&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>    <span class="hljs-meta">@Value(&quot;æ³¨å…¥æ™®é€šæ•°æ®&quot;)</span><br>    <span class="hljs-keyword">private</span> String str;<br>    <br>    <span class="hljs-comment">// è¿™é‡Œä½“ç°äº†valueæ³¨è§£çš„å¿…è¦æ€§</span><br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String driver;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(str);<br>        System.out.println(driver);<br>        System.out.println(<span class="hljs-string">&quot;save running... ...&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹å››ï¼š</p><p>ä½¿ç”¨@Scopeæ ‡æ³¨Beançš„èŒƒå›´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//@Scope(&quot;prototype&quot;)</span><br><span class="hljs-meta">@Scope(&quot;singleton&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>   <span class="hljs-comment">//æ­¤å¤„çœç•¥ä»£ç </span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹äº”ï¼š</p><p>ä½¿ç”¨@PostConstructæ ‡æ³¨åˆå§‹åŒ–æ–¹æ³•ï¼Œä½¿ç”¨@PreDestroyæ ‡æ³¨é”€æ¯æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostConstruct</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;åˆå§‹åŒ–æ–¹æ³•....&quot;</span>);<br>&#125;<br><br><span class="hljs-meta">@PreDestroy</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">destroy</span><span class="hljs-params">()</span></span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;é”€æ¯æ–¹æ³•.....&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="2-5-3-Spring-æ–°æ³¨è§£"><a href="#2-5-3-Spring-æ–°æ³¨è§£" class="headerlink" title="2.5.3 Spring æ–°æ³¨è§£"></a>2.5.3 Spring æ–°æ³¨è§£</h4><p>ä½¿ç”¨ä¸Šé¢çš„æ³¨è§£è¿˜ä¸èƒ½å…¨éƒ¨æ›¿ä»£xmlé…ç½®æ–‡ä»¶ï¼Œè¿˜éœ€è¦ä½¿ç”¨æ³¨è§£æ›¿ä»£çš„é…ç½®å¦‚ä¸‹ï¼š</p><ul><li>éè‡ªå®šä¹‰çš„Beançš„é…ç½®ï¼š&lt; bean &gt;</li><li>åŠ è½½propertiesæ–‡ä»¶çš„é…ç½®ï¼š&lt; context:property-placeholder &gt;</li><li>ç»„ä»¶æ‰«æçš„é…ç½®ï¼š&lt; context:component-scan &gt;</li><li>å¼•å…¥å…¶ä»–æ–‡ä»¶ï¼š&lt; import &gt;</li></ul><p>å› æ­¤é€šè¿‡ä»¥ä¸‹æ–°æ³¨è§£å¯ä»¥æ›¿ä»£å¦‚ä¸Šé…ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-9-20210628.png"></p><p>æ–°æ³¨è§£ä½¿ç”¨çš„ç¤ºä¾‹ï¼ˆè¯¥ç¤ºä¾‹æ¼”ç¤ºäº†æ³¨è§£å¼€å‘é…ç½®æ•°æ®æºï¼‰ï¼š</p><ul><li><p>ç¤ºä¾‹ä¸€ï¼š</p><p>@Configuration</p><p>@ComponentScan</p><p>@Import</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(&quot;com.itheima&quot;)</span><br><span class="hljs-meta">@Import(&#123;DataSourceConfiguration.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringConfiguration</span> </span>&#123; <br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹äºŒï¼š</p><p>@PropertySource</p><p>@value</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataSourceConfiguration</span> </span>&#123;<br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String driver;<br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String url;<br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String password;<br><br></code></pre></td></tr></table></figure></li><li><p>ç¤ºä¾‹ä¸‰ï¼š</p><p>@Bean ï¼ˆæŠŠç¬¬ä¸‰æ–¹ jar åŒ…ä¸­å®šä¹‰çš„ç±»åŠ å…¥åˆ° Spring å®¹å™¨ä¸­ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean(name=&quot;dataSource&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">getDataSource</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> PropertyVetoException </span>&#123;<br>    ComboPooledDataSource dataSource = <span class="hljs-keyword">new</span> ComboPooledDataSource();<br>    dataSource.setDriverClass(driver);<br>    dataSource.setJdbcUrl(url);<br>    dataSource.setUser(username);<br>    dataSource.setPassword(password);<br>    <span class="hljs-keyword">return</span> dataSource;<br>&#125; <br></code></pre></td></tr></table></figure></li><li><p>æ³¨è§£å¼€å‘çš„ API ï¼šæµ‹è¯•åŠ è½½æ ¸å¿ƒé…ç½®ç±»åˆ›å»ºSpringå®¹å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAnnoConfiguration</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>    ApplicationContext applicationContext = <span class="hljs-keyword">new</span> <br>          AnnotationConfigApplicationContext(SpringConfiguration.class);<br>    UserService userService = (UserService)    <br>    applicationContext.getBean(<span class="hljs-string">&quot;userService&quot;</span>);<br>    userService.save();<br>    DataSource dataSource = (DataSource) <br>    applicationContext.getBean(<span class="hljs-string">&quot;dataSource&quot;</span>);<br>    Connection connection = dataSource.getConnection();<br>    System.out.println(connection);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-6-Spring-é›†æˆ-Junit"><a href="#2-6-Spring-é›†æˆ-Junit" class="headerlink" title="2.6 Spring é›†æˆ Junit"></a>2.6 Spring é›†æˆ Junit</h3><h4 id="2-6-1-é›†æˆçš„ç†ç”±"><a href="#2-6-1-é›†æˆçš„ç†ç”±" class="headerlink" title="2.6.1 é›†æˆçš„ç†ç”±"></a>2.6.1 é›†æˆçš„ç†ç”±</h4><p>å¯ä»¥åˆ©ç”¨ Spring æå‰ç»Ÿä¸€çš„åŠ è½½å®¹å™¨ï¼Œå¹¶åˆ©ç”¨ Spring å®Œæˆä¾èµ–æ³¨å…¥ï¼Œå†è¿›è¡Œæµ‹è¯•</p><p>ä¸éœ€è¦ç»™æ¯ä¸€ä¸ª @Test æµ‹è¯•æ–¹æ³•éƒ½è½½å…¥ä¸€æ¬¡é…ç½®æ–‡ä»¶ï¼ŒåŠ è½½ä¸€æ¬¡å®¹å™¨</p><h4 id="2-6-2-Spring-é›†æˆ-Junit-æ­¥éª¤"><a href="#2-6-2-Spring-é›†æˆ-Junit-æ­¥éª¤" class="headerlink" title="2.6.2 Spring é›†æˆ Junit æ­¥éª¤"></a>2.6.2 Spring é›†æˆ Junit æ­¥éª¤</h4><p>â‘  å¯¼å…¥springé›†æˆJunitçš„åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.2.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡ ä½¿ç”¨@Runwith æ³¨è§£æ›¿æ¢åŸæ¥çš„è¿è¡ŒæœŸ</p><p>ä»¥å‰æ˜¯ä½¿ç”¨ Junit å®Œæˆæµ‹è¯•ï¼Œç°åœ¨æ˜¯å‘å…ˆè¿è¡Œ Spring åŠ è½½å®¹å™¨ï¼ŒSpringå†å»æ‰¾ Junit è¿›è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringJunitTest</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¢ ä½¿ç”¨@ContextConfiguration æŒ‡å®šé…ç½®æ–‡ä»¶æˆ–é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-comment">//åŠ è½½springæ ¸å¿ƒé…ç½®æ–‡ä»¶</span><br><span class="hljs-comment">//@ContextConfiguration(value = &#123;&quot;classpath:applicationContext.xml&quot;&#125;)</span><br><span class="hljs-comment">//åŠ è½½springæ ¸å¿ƒé…ç½®ç±»</span><br><span class="hljs-meta">@ContextConfiguration(classes = &#123;SpringConfiguration.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringJunitTest</span> </span>&#123;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘£ ä½¿ç”¨@Autowired æ³¨å…¥éœ€è¦æµ‹è¯•çš„å¯¹è±¡</p><p>â‘¤ åˆ›å»ºæµ‹è¯•æ–¹æ³•è¿›è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@ContextConfiguration(classes = &#123;SpringConfiguration.class&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringJunitTest</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUserService</span><span class="hljs-params">()</span></span>&#123;<br>        userService.save();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-SpringMVC"><a href="#3-SpringMVC" class="headerlink" title="3. SpringMVC"></a>3. SpringMVC</h2><h3 id="3-1-Spring-é›†æˆ-web-ç¯å¢ƒ"><a href="#3-1-Spring-é›†æˆ-web-ç¯å¢ƒ" class="headerlink" title="3.1 Spring é›†æˆ web ç¯å¢ƒ"></a>3.1 Spring é›†æˆ web ç¯å¢ƒ</h3><h4 id="3-1-1-ApplicationContext-åº”ç”¨ä¸Šä¸‹æ–‡è·å–æ–¹å¼"><a href="#3-1-1-ApplicationContext-åº”ç”¨ä¸Šä¸‹æ–‡è·å–æ–¹å¼" class="headerlink" title="3.1.1  ApplicationContext åº”ç”¨ä¸Šä¸‹æ–‡è·å–æ–¹å¼"></a>3.1.1  ApplicationContext åº”ç”¨ä¸Šä¸‹æ–‡è·å–æ–¹å¼</h4><p>åº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯é€šè¿‡<strong>new</strong> <strong>ClasspathXmlApplicationContext</strong> (spring é…ç½®æ–‡ä»¶) æ–¹å¼è·å–çš„ï¼Œä½†æ˜¯æ¯æ¬¡ä»å®¹å™¨ä¸­è·å¾—Beanæ—¶éƒ½è¦ç¼–å†™<strong>new ClasspathXmlApplicationContext</strong> (springé…ç½®æ–‡ä»¶) ï¼Œè¿™æ ·çš„å¼Šç«¯æ˜¯é…ç½®æ–‡ä»¶åŠ è½½å¤šæ¬¡ï¼Œåº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡åˆ›å»ºå¤šæ¬¡ã€‚</p><p>åœ¨Webé¡¹ç›®ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <strong>ServletContextListener</strong> ç›‘å¬Webåº”ç”¨çš„å¯åŠ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Webåº”ç”¨å¯åŠ¨æ—¶ï¼Œå°±åŠ è½½Springçš„é…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡<strong>ApplicationContext</strong>ï¼Œåœ¨å°†å…¶å­˜å‚¨åˆ°æœ€å¤§çš„åŸŸ<strong>servletContext</strong>åŸŸä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä»»æ„ä½ç½®ä»åŸŸä¸­è·å¾—åº”ç”¨ä¸Šä¸‹æ–‡<strong>ApplicationContext</strong>å¯¹è±¡äº†ã€‚</p><h4 id="3-1-2-Spring-æä¾›è·å–åº”ç”¨ä¸Šä¸‹æ–‡çš„å·¥å…·"><a href="#3-1-2-Spring-æä¾›è·å–åº”ç”¨ä¸Šä¸‹æ–‡çš„å·¥å…·" class="headerlink" title="3.1.2 Spring æä¾›è·å–åº”ç”¨ä¸Šä¸‹æ–‡çš„å·¥å…·"></a>3.1.2 Spring æä¾›è·å–åº”ç”¨ä¸Šä¸‹æ–‡çš„å·¥å…·</h4><p>(å…³äºè¿™ä¸€æ®µå¦‚æœä¸èƒ½å¤ªç†è§£ï¼Œæˆ–è€…é—å¿˜äº†çœ‹<a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=39">è§†é¢‘p39 p40</a>å›é¡¾æ¯”è¾ƒå¿«)</p><p>ä¸Šé¢æåˆ°çš„ä½¿ç”¨ç›‘å¬å™¨ç›‘å¬Webåº”ç”¨å¯åŠ¨åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­åŠ è½½Springé…ç½®æ–‡ä»¶çš„åŠŸèƒ½ä¸éœ€è¦æ‰‹åŠ¨å®ç°ï¼ŒSpringæä¾›äº†ä¸€ä¸ªç›‘å¬å™¨<strong>ContextLoaderListener</strong>å°±æ˜¯å¯¹ä¸Šè¿°åŠŸèƒ½çš„å°è£…ï¼Œè¯¥ç›‘å¬å™¨å†…éƒ¨åŠ è½½Springé…ç½®æ–‡ä»¶ï¼Œåˆ›å»ºåº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¹¶å­˜å‚¨åˆ°<strong>ServletContext</strong>åŸŸä¸­ï¼Œæä¾›äº†ä¸€ä¸ªå®¢æˆ·ç«¯å·¥å…·<strong>WebApplicationContextUtils</strong>ä¾›ä½¿ç”¨è€…è·å¾—åº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„åªæœ‰ä¸¤ä»¶äº‹ï¼š</p><p>â‘ åœ¨<strong>web.xml</strong>ä¸­é…ç½®<strong>ContextLoaderListener</strong>ç›‘å¬å™¨ï¼ˆå¯¼å…¥spring-webåæ ‡ï¼‰</p><p>å¯¼å…¥åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®web.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å…¨å±€å‚æ•°--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br><span class="hljs-comment">&lt;!--Springçš„ç›‘å¬å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span><br>       org.springframework.web.context.ContextLoaderListener<br>   <span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡ä½¿ç”¨<strong>WebApplicationContextUtils</strong>è·å¾—åº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡<strong>ApplicationContext</strong></p><p>ä½¿ç”¨å·¥å…·ç±»å›å»ä¸Šä¸‹æ–‡å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">ApplicationContext applicationContext =    <br>    WebApplicationContextUtils.getWebApplicationContext(servletContext);<br>Object obj = applicationContext.getBean(<span class="hljs-string">&quot;id&quot;</span>);<br></code></pre></td></tr></table></figure><h3 id="3-2-SpringMVC-ç®€ä»‹"><a href="#3-2-SpringMVC-ç®€ä»‹" class="headerlink" title="3.2 SpringMVC ç®€ä»‹"></a>3.2 SpringMVC ç®€ä»‹</h3><h4 id="3-2-1-SpringMVC-æ¦‚è¿°"><a href="#3-2-1-SpringMVC-æ¦‚è¿°" class="headerlink" title="3.2.1 SpringMVC æ¦‚è¿°"></a>3.2.1 SpringMVC æ¦‚è¿°</h4><p><strong>SpringMVC</strong> æ˜¯ä¸€ç§åŸºäº Java çš„å®ç° <strong>MVC</strong> <strong>è®¾è®¡æ¨¡å‹</strong>çš„è¯·æ±‚é©±åŠ¨ç±»å‹çš„è½»é‡çº§ <strong>Web</strong> <strong>æ¡†æ¶</strong>ï¼Œå±äº<strong>SpringFrameWork</strong> çš„åç»­äº§å“ï¼Œå·²ç»èåˆåœ¨ Spring Web Flow ä¸­ã€‚</p><p>SpringMVC å·²ç»æˆä¸ºç›®å‰æœ€ä¸»æµçš„MVCæ¡†æ¶ä¹‹ä¸€ï¼Œå¹¶ä¸”éšç€Spring3.0 çš„å‘å¸ƒï¼Œå…¨é¢è¶…è¶Š Struts2ï¼Œæˆä¸ºæœ€ä¼˜ç§€çš„ MVC æ¡†æ¶ã€‚å®ƒé€šè¿‡ä¸€å¥—<strong>æ³¨è§£</strong>ï¼Œè®©ä¸€ä¸ªç®€å•çš„ Java ç±»æˆä¸ºå¤„ç†è¯·æ±‚çš„æ§åˆ¶å™¨ï¼Œè€Œæ— é¡»å®ç°ä»»ä½•æ¥å£ã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒ <strong>RESTful</strong> ç¼–ç¨‹é£æ ¼çš„è¯·æ±‚ã€‚</p><p><strong>SpringMVCé›å½¢åˆ†æï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-10-20210704.png"></p><ul><li>POJOï¼šå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaBean</li><li>å‰ç«¯æ§åˆ¶å™¨ï¼ˆwebæ¡†æ¶åŸºæœ¬éƒ½æœ‰ï¼‰ï¼šä¸åŒæ¡†æ¶å®ç°åŸç†ä¸ä¸€æ ·<ul><li>SpringMVC ä¸­ å‰ç«¯æ§åˆ¶å™¨æ˜¯ servlet</li><li>Struts2 ä¸­å‰ç«¯æ§åˆ¶å™¨æ˜¯ fliter</li></ul></li></ul><h4 id="3-2-2-SpringMVCå¿«é€Ÿå…¥é—¨"><a href="#3-2-2-SpringMVCå¿«é€Ÿå…¥é—¨" class="headerlink" title="3.2.2 SpringMVCå¿«é€Ÿå…¥é—¨"></a>3.2.2 SpringMVCå¿«é€Ÿå…¥é—¨</h4><p><strong>å¼€å‘æ­¥éª¤ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-11-20210704.png"></p><p>éœ€æ±‚ï¼šå®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨ç«¯æ¥æ”¶è¯·æ±‚ï¼Œæ‰§è¡Œé€»è¾‘å¹¶è¿›è¡Œè§†å›¾è·³è½¬ã€‚</p><p>å¼€å‘æ­¥éª¤ï¼š</p><p>â‘ å¯¼å…¥SpringMVCç›¸å…³åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--Springåæ ‡--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--SpringMVCåæ ‡--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--Servletåæ ‡--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>servlet-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--Jspåæ ‡--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.servlet.jsp<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jsp-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡<font color=#FF0000><strong>é…ç½®SpringMVCæ ¸å¿ƒæ§åˆ¶å™¨DispathcerServlet</strong></font></p><p>åœ¨web.xmlä¸­é…ç½®å‰ç«¯æ§åˆ¶å™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- é…ç½®å‰ç«¯æ§åˆ¶å™¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-class</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- å‘Šè¯‰å‰ç«¯æ§åˆ¶å™¨springmvcé…ç½®æ–‡ä»¶åœ¨å“ª --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- load-on-startupè¡¨ç¤ºæœåŠ¡å¯åŠ¨å°±åŠ è½½ï¼Œä¸é…å°±æ˜¯è®¿é—®æ—¶æ‰åˆ›å»º --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">load-on-startup</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">load-on-startup</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- é…ç½®æ˜ å°„åœ°å€ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">servlet-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">servlet-name</span>&gt;</span>DispatcherServlet<span class="hljs-tag">&lt;/<span class="hljs-name">servlet-name</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- è¡¨ç¤ºæ¯æ¬¡è®¿é—®ï¼Œä»»ä½•è¯·æ±‚éƒ½è¦èµ°è¿™ä¸ªservlet --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">servlet-mapping</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¢åˆ›å»ºControllerç±»å’Œè§†å›¾é¡µé¢</p><p>åˆ›å»ºControllerå’Œä¸šåŠ¡æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuickController</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">quickMethod</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;quickMethod running.....&quot;</span>);<br>        <span class="hljs-comment">// çœç•¥äº† .jsp, ä¸»è¦è§åé¢æåˆ°çš„è§†å›¾å‰åç¼€é…ç½®ï¼Œé…ç½®åä¼šè‡ªåŠ¨å‡­å€Ÿ.jspçš„åç¼€ </span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ›å»ºè§†å›¾é¡µé¢ index.jsp</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;html&gt;<br>    &lt;body&gt;<br>        &lt;h2&gt;Hello SpringMVC!&lt;/h2&gt;<br>    &lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>â‘£ä½¿ç”¨æ³¨è§£é…ç½®Controllerç±»ä¸­ä¸šåŠ¡æ–¹æ³•çš„æ˜ å°„åœ°å€</p><p>ä½¿ç”¨@Controller æ”¾å…¥å®¹å™¨</p><p>ä½¿ç”¨@RequestMapping ï¼Œé…ç½®è¯·æ±‚åœ°å€å’Œæ–¹æ³•çš„æ˜ å°„å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QuickController</span> </span>&#123;<br>    <span class="hljs-meta">@RequestMapping(&quot;/quick&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">quickMethod</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;quickMethod running.....&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¤é…ç½®SpringMVCæ ¸å¿ƒæ–‡ä»¶ spring-mvc.xml</p><p>åˆ›å»ºspring-mvc.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:mvc</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/mvc</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/context</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--é…ç½®æ³¨è§£æ‰«æ--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.itheima.controller&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">beans</span>&gt;</span><br><br></code></pre></td></tr></table></figure><p>â‘¥å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æµ‹è¯•</p><p>è®¿é—®æµ‹è¯•åœ°å€ï¼š<a href="http://localhost:8080/itheima_springmvc1/quick">http://localhost:8080/itheima_springmvc1/quick</a></p><p><strong>æµç¨‹å›¾ç¤ºæ€»ç»“ï¼š</strong></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-12-20210704.png"></p><h4 id="3-2-3-SpringMVC-ç»„ä»¶è§£æ"><a href="#3-2-3-SpringMVC-ç»„ä»¶è§£æ" class="headerlink" title="3.2.3 SpringMVC ç»„ä»¶è§£æ"></a>3.2.3 SpringMVC ç»„ä»¶è§£æ</h4><ul><li><strong>SpringMVC çš„æ‰§è¡Œæµç¨‹</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-13-20210704.png"></p><p>â‘ ç”¨æˆ·å‘é€è¯·æ±‚è‡³å‰ç«¯æ§åˆ¶å™¨DispatcherServletã€‚</p><p>â‘¡DispatcherServletæ”¶åˆ°è¯·æ±‚è°ƒç”¨HandlerMappingå¤„ç†å™¨æ˜ å°„å™¨ã€‚</p><p>â‘¢å¤„ç†å™¨æ˜ å°„å™¨æ‰¾åˆ°å…·ä½“çš„å¤„ç†å™¨(å¯ä»¥æ ¹æ®xmlé…ç½®ã€æ³¨è§£è¿›è¡ŒæŸ¥æ‰¾)ï¼Œç”Ÿæˆå¤„ç†å™¨å¯¹è±¡åŠå¤„ç†å™¨æ‹¦æˆªå™¨(å¦‚æœæœ‰åˆ™ç”Ÿæˆ)ä¸€å¹¶è¿”å›ç»™DispatcherServletã€‚</p><p>â‘£DispatcherServletè°ƒç”¨HandlerAdapterå¤„ç†å™¨é€‚é…å™¨ã€‚</p><p>â‘¤HandlerAdapterç»è¿‡é€‚é…è°ƒç”¨å…·ä½“çš„å¤„ç†å™¨(Controllerï¼Œä¹Ÿå«åç«¯æ§åˆ¶å™¨)ã€‚</p><p>â‘¥Controlleræ‰§è¡Œå®Œæˆè¿”å›ModelAndViewã€‚</p><p>â‘¦HandlerAdapterå°†controlleræ‰§è¡Œç»“æœModelAndViewè¿”å›ç»™DispatcherServletã€‚</p><p>â‘§DispatcherServletå°†ModelAndViewä¼ ç»™ViewResloverè§†å›¾è§£æå™¨ã€‚</p><p>â‘¨ViewResloverè§£æåè¿”å›å…·ä½“Viewã€‚</p><p>â‘©DispatcherServletæ ¹æ®Viewè¿›è¡Œæ¸²æŸ“è§†å›¾ï¼ˆå³å°†æ¨¡å‹æ•°æ®å¡«å……è‡³è§†å›¾ä¸­ï¼‰ï¼ŒDispatcherServletå“åº”ç”¨æˆ·ã€‚</p><ul><li><p><strong>å„ä¸ªç»„ä»¶è§£æ</strong></p><ul><li> å‰ç«¯æ§åˆ¶å™¨ï¼š<font color=#FF0000><strong>DispatcherServlet</strong></font></li></ul><p>  ç”¨æˆ·è¯·æ±‚åˆ°è¾¾å‰ç«¯æ§åˆ¶å™¨ï¼Œå®ƒå°±ç›¸å½“äº <strong>MVC</strong> æ¨¡å¼ä¸­çš„ <strong>C</strong>ï¼ŒDispatcherServlet æ˜¯æ•´ä¸ªæµç¨‹æ§åˆ¶çš„ä¸­å¿ƒï¼Œç”±å®ƒè°ƒç”¨å…¶å®ƒç»„ä»¶å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼ŒDispatcherServlet çš„å­˜åœ¨é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§ã€‚</p><ul><li><p>å¤„ç†å™¨æ˜ å°„å™¨ï¼š<strong>HandlerMapping</strong><br>HandlerMapping è´Ÿè´£æ ¹æ®ç”¨æˆ·è¯·æ±‚æ‰¾åˆ° Handler å³å¤„ç†å™¨ï¼ŒSpringMVC æä¾›äº†ä¸åŒçš„æ˜ å°„å™¨å®ç°ä¸åŒçš„æ˜ å°„æ–¹å¼ï¼Œä¾‹å¦‚ï¼šé…ç½®æ–‡ä»¶æ–¹å¼ï¼Œå®ç°æ¥å£æ–¹å¼ï¼Œæ³¨è§£æ–¹å¼ç­‰ã€‚</p></li><li><p>å¤„ç†å™¨é€‚é…å™¨ï¼š<strong>HandlerAdapter</strong><br>é€šè¿‡ HandlerAdapter å¯¹å¤„ç†å™¨è¿›è¡Œæ‰§è¡Œï¼Œè¿™æ˜¯<strong>é€‚é…å™¨æ¨¡å¼</strong>çš„åº”ç”¨ï¼Œé€šè¿‡æ‰©å±•é€‚é…å™¨å¯ä»¥å¯¹æ›´å¤šç±»å‹çš„å¤„ç†å™¨è¿›è¡Œæ‰§è¡Œ</p></li><li><p>å¤„ç†å™¨ï¼š<strong>Handler</strong></p><p>å®ƒå°±æ˜¯æˆ‘ä»¬å¼€å‘ä¸­è¦ç¼–å†™çš„å…·ä½“ä¸šåŠ¡æ§åˆ¶å™¨ã€‚ç”± DispatcherServlet æŠŠç”¨æˆ·è¯·æ±‚è½¬å‘åˆ° Handlerã€‚ç”±Handler å¯¹å…·ä½“çš„ç”¨æˆ·è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</p></li><li><p>è§†å›¾è§£æå™¨ï¼š <strong>View Resolver</strong> </p><p>View Resolver è´Ÿè´£å°†å¤„ç†ç»“æœç”Ÿæˆ View è§†å›¾ï¼ŒView Resolver é¦–å…ˆæ ¹æ®é€»è¾‘è§†å›¾åè§£ææˆç‰©ç†è§†å›¾åï¼Œå³å…·ä½“çš„é¡µé¢åœ°å€ï¼Œå†ç”Ÿæˆ View è§†å›¾å¯¹è±¡ï¼Œæœ€åå¯¹ View è¿›è¡Œæ¸²æŸ“å°†å¤„ç†ç»“æœé€šè¿‡é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ã€‚</p></li><li><p>è§†å›¾ï¼š<strong>View</strong> </p><p>SpringMVC æ¡†æ¶æä¾›äº†å¾ˆå¤šçš„ View è§†å›¾ç±»å‹çš„æ”¯æŒï¼ŒåŒ…æ‹¬ï¼šjstlViewã€freemarkerViewã€pdfViewç­‰ï¼Œæœ€å¸¸ç”¨çš„è§†å›¾å°±æ˜¯ jspã€‚ä¸€èˆ¬æƒ…å†µä¸‹éœ€è¦é€šè¿‡é¡µé¢æ ‡ç­¾æˆ–é¡µé¢æ¨¡ç‰ˆæŠ€æœ¯å°†æ¨¡å‹æ•°æ®é€šè¿‡é¡µé¢å±•ç¤ºç»™ç”¨æˆ·ï¼Œéœ€è¦ç”±ç¨‹åºå‘˜æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¼€å‘å…·ä½“çš„é¡µé¢</p></li></ul></li></ul><ul><li><p><strong>æ³¨è§£è§£æ</strong></p><ul><li><p>@Controller ï¼ˆå‰é¢å­¦è¿‡ï¼Œå°±æ˜¯å’Œ @Component ä½œç”¨ç›¸åŒï¼‰</p></li><li><p><font color=#FF0000><strong>@RequestMapping</strong></font> â­â­</p><p>ä½œç”¨ï¼šç”¨äºå»ºç«‹è¯·æ±‚ URL å’Œå¤„ç†è¯·æ±‚æ–¹æ³•ä¹‹é—´çš„å¯¹åº”å…³ç³»</p><p>ä½ç½®ï¼š</p><ul><li><p>ç±»ä¸Šï¼Œè¯·æ±‚URL çš„ç¬¬ä¸€çº§è®¿é—®ç›®å½•ã€‚æ­¤å¤„ä¸å†™çš„è¯ï¼Œå°±ç›¸å½“äºåº”ç”¨çš„æ ¹ç›®å½•</p></li><li><p>æ–¹æ³•ä¸Šï¼Œè¯·æ±‚ URL çš„ç¬¬äºŒçº§è®¿é—®ç›®å½•ï¼Œä¸ç±»ä¸Šçš„ä½¿ç”¨@ReqquestMappingæ ‡æ³¨çš„ä¸€çº§ç›®å½•ä¸€èµ·<strong>æ‹¼æ¥ç»„æˆ</strong>è®¿é—®è™šæ‹Ÿè·¯å¾„</p></li></ul><p>å±æ€§ï¼š</p><ul><li><p><strong>value</strong>ï¼šç”¨äºæŒ‡å®šè¯·æ±‚çš„URLã€‚å®ƒå’Œpathå±æ€§çš„ä½œç”¨æ˜¯ä¸€æ ·çš„</p></li><li><p><strong>method</strong>ï¼šç”¨äºæŒ‡å®šè¯·æ±‚çš„æ–¹å¼ï¼ˆRequestMethod.POSTï¼ŒRequestMethod.getç­‰ï¼‰</p></li><li><p><strong>params</strong>ï¼šç”¨äºæŒ‡å®šé™åˆ¶è¯·æ±‚å‚æ•°çš„æ¡ä»¶ã€‚å®ƒæ”¯æŒç®€å•çš„è¡¨è¾¾å¼ã€‚è¦æ±‚è¯·æ±‚å‚æ•°çš„keyå’Œvalueå¿…é¡»å’Œé…ç½®çš„ä¸€æ¨¡ä¸€æ ·</p></li></ul><p>ä¾‹å¦‚ï¼š</p><ul><li><p>**params = {â€œaccountNameâ€}**ï¼Œè¡¨ç¤ºè¯·æ±‚å‚æ•°å¿…é¡»æœ‰accountName</p></li><li><p>**params = {â€œmoeny!100â€}**ï¼Œè¡¨ç¤ºè¯·æ±‚å‚æ•°ä¸­moneyä¸èƒ½æ˜¯100</p></li></ul></li></ul></li></ul><ul><li><p><strong>XML é…ç½®è§£æ</strong></p><ul><li><p><strong>mvc å‘½åç©ºé—´å¼•å…¥</strong></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">å‘½åç©ºé—´ï¼š<br>xmlns:context=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span><br>xmlns:mvc=<span class="hljs-string">&quot;http://www.springframework.org/schema/mvc&quot;</span><br>çº¦æŸåœ°å€ï¼š<br>http:<span class="hljs-regexp">//</span>www.springframework.org<span class="hljs-regexp">/schema/</span>context<br>http:<span class="hljs-regexp">//</span>www.springframework.org<span class="hljs-regexp">/schema/</span>context/spring-context.xsd<br>http:<span class="hljs-regexp">//</span>www.springframework.org<span class="hljs-regexp">/schema/m</span>vc http:<span class="hljs-regexp">//</span>www.springframework.org<span class="hljs-regexp">/schema/m</span>vc/spring-mvc.xsd<br></code></pre></td></tr></table></figure></li><li><p><strong>ç»„ä»¶æ‰«æ</strong></p><p>SpringMVCåŸºäºSpringå®¹å™¨ï¼Œæ‰€ä»¥åœ¨è¿›è¡ŒSpringMVCæ“ä½œæ—¶ï¼Œéœ€è¦å°†Controllerå­˜å‚¨åˆ°Springå®¹å™¨ä¸­ï¼Œå¦‚æœä½¿ç”¨@Controlleræ³¨è§£æ ‡æ³¨çš„è¯ï¼Œå°±éœ€è¦ä½¿ç”¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">â€œcom.itheima.controller</span>&quot;/&gt;</span><br></code></pre></td></tr></table></figure><p>è¿›è¡Œç»„ä»¶æ‰«æã€‚</p></li><li><p><strong>è§†å›¾è§£æå™¨</strong></p><p>SpringMVCæœ‰é»˜è®¤ç»„ä»¶é…ç½®ï¼Œé»˜è®¤ç»„ä»¶éƒ½æ˜¯ <strong>DispatcherServlet.properties</strong> é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„ï¼Œè¯¥é…ç½®æ–‡ä»¶åœ°å€: <strong>org/springframework/web/servlet/DispatcherServlet.properties</strong>ï¼Œè¯¥æ–‡ä»¶ä¸­é…ç½®äº†é»˜è®¤çš„è§†å›¾è§£æå™¨ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.ViewResolver</span> = org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.view</span>.InternalResourceViewResolver<br></code></pre></td></tr></table></figure><p>ç¿»çœ‹è¯¥è§£æå™¨æºç ï¼Œå¯ä»¥çœ‹åˆ°è¯¥è§£æå™¨çš„é»˜è®¤è®¾ç½®ï¼Œå¦‚ä¸‹:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">REDIRECT_URL_PREFIX = &quot;redirect:&quot;  --é‡å®šå‘å‰ç¼€<br>FORWARD_URL_PREFIX = &quot;forward:&quot;    --è½¬å‘å‰ç¼€ï¼ˆé»˜è®¤å€¼ï¼‰<br>prefix = &quot;&quot;;     --è§†å›¾åç§°å‰ç¼€<br>suffix = &quot;&quot;;     --è§†å›¾åç§°åç¼€<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å±æ€§æ³¨å…¥çš„æ–¹å¼ä¿®æ”¹è§†å›¾çš„å‰åç¼€</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--é…ç½®å†…éƒ¨èµ„æºè§†å›¾è§£æå™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;prefix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;/WEB-INF/views/&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;suffix&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;.jsp&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="3-3-SpringMVC-çš„æ•°æ®å“åº”"><a href="#3-3-SpringMVC-çš„æ•°æ®å“åº”" class="headerlink" title="3.3 SpringMVC çš„æ•°æ®å“åº”"></a>3.3 SpringMVC çš„æ•°æ®å“åº”</h3><h4 id="3-3-1-SpringMVCçš„æ•°æ®å“åº”æ–¹å¼"><a href="#3-3-1-SpringMVCçš„æ•°æ®å“åº”æ–¹å¼" class="headerlink" title="3.3.1 SpringMVCçš„æ•°æ®å“åº”æ–¹å¼"></a>3.3.1 SpringMVCçš„æ•°æ®å“åº”æ–¹å¼</h4><ul><li><p>é¡µé¢è·³è½¬</p><ul><li>ç›´æ¥è¿”å›å­—ç¬¦ä¸²</li><li>é€šè¿‡ModelAndViewå¯¹è±¡è¿”å›</li></ul></li><li><p>å›å†™æ•°æ® </p><ul><li>ç›´æ¥è¿”å›å­—ç¬¦ä¸²</li><li>è¿”å›å¯¹è±¡æˆ–é›†åˆ  </li></ul></li></ul><h4 id="3-3-2-SpringMVC-é¡µé¢è·³è½¬"><a href="#3-3-2-SpringMVC-é¡µé¢è·³è½¬" class="headerlink" title="3.3.2 SpringMVC é¡µé¢è·³è½¬"></a>3.3.2 SpringMVC é¡µé¢è·³è½¬</h4><ol><li><p>è¿”å›å­—ç¬¦ä¸²å½¢å¼</p><p>ç›´æ¥è¿”å›å­—ç¬¦ä¸²ï¼šæ­¤ç§æ–¹å¼ä¼šå°†è¿”å›çš„å­—ç¬¦ä¸²ä¸è§†å›¾è§£æå™¨çš„å‰åç¼€æ‹¼æ¥åè·³è½¬ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-14-20210704.png"></p><p>è¿”å›å¸¦æœ‰å‰ç¼€çš„å­—ç¬¦ä¸²ï¼š</p><p>è½¬å‘ï¼š<strong>forward:/WEB-INF/views/index.jsp</strong></p><p>é‡å®šå‘ï¼š<strong>redirect:/index.jsp</strong> ï¼ˆé‡å®šå‘æ˜¯å®¢æˆ·ç«¯å†æ¬¡è®¿é—®ï¼Œå¦‚æœåœ¨WEB-INFæ˜¯å—ä¿æŠ¤æ–‡ä»¶å¤¹ï¼Œå¤–ç•Œä¸èƒ½ç›´æ¥è®¿é—®ï¼Œé‡å®šå‘åªèƒ½åœ¨è¢«è®¿é—®çš„è·¯å¾„ä¸‹ï¼‰</p></li><li><p>è¿”å› ModelAndView å¯¹è±¡</p><p>modelï¼šæ¨¡å‹ å°è£…æ•°æ®</p><p>viewï¼šè§†å›¾  å±•ç¤ºæ•°æ®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick2&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">quickMethod2</span><span class="hljs-params">()</span></span>&#123;<br>    ModelAndView modelAndView = <span class="hljs-keyword">new</span> ModelAndView();<br>    <span class="hljs-comment">// è®¾ç½®æ¨¡å‹æ•°æ®</span><br>    modelAndView.addObject(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;itcast&quot;</span>);<br>    <span class="hljs-comment">// è®¾ç½®è§†å›¾åç§°</span><br>    <span class="hljs-comment">// åœ¨ jsp ä¸­ç”¨ $&#123;username&#125; æ¥å±•ç¤º model æ•°æ®</span><br>    modelAndView.setViewName(<span class="hljs-string">&quot;redirect:index.jsp&quot;</span>);<br>    <span class="hljs-keyword">return</span> modelAndView;<br>&#125;<br><br><br><span class="hljs-meta">@RequestMapping(&quot;/quick2&quot;)</span><br><span class="hljs-comment">// SpringMVC è¿˜å¯ä»¥è‡ªåŠ¨æ³¨å…¥å…¥å‚çš„ModelAndViewï¼Œå°±ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºäº†</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">quickMethod2</span><span class="hljs-params">(ModelAndView modelAndView)</span></span>&#123;<br>    modelAndView.addObject(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;itcast&quot;</span>);<br>    <span class="hljs-comment">// åœ¨ jsp ä¸­ç”¨ $&#123;username&#125; æ¥å±•ç¤º model æ•°æ®</span><br>    modelAndView.setViewName(<span class="hljs-string">&quot;redirect:index.jsp&quot;</span>);<br>    <span class="hljs-keyword">return</span> modelAndView;<br>&#125;<br><br><span class="hljs-meta">@RequestMapping(&quot;/quick2&quot;)</span><br><span class="hljs-comment">// SpringMVC è¿˜å¯ä»¥è‡ªåŠ¨æ³¨å…¥å…¥å‚çš„Modelï¼Œå°±ä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºäº†</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">quickMethod2</span><span class="hljs-params">(Model model)</span></span>&#123;<br>    <span class="hljs-comment">// è®¾ç½®æ¨¡å‹æ•°æ®</span><br>    model.addAttribute(<span class="hljs-string">&quot;username&quot;</span>, <span class="hljs-string">&quot;itcast&quot;</span>);<br>    <span class="hljs-comment">// åœ¨ jsp ä¸­ç”¨ $&#123;username&#125; æ¥å±•ç¤º model æ•°æ®</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;redirect:index.jsp&quot;</span>;<br>&#125;<br><br><br><span class="hljs-meta">@RequestMapping(&quot;/quick3&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">quickMethod3</span><span class="hljs-params">()</span></span>&#123;<br>    ModelAndView modelAndView = <span class="hljs-keyword">new</span> ModelAndView();<br>    modelAndView.setViewName(<span class="hljs-string">&quot;forward:/WEB-INF/views/index.jsp&quot;</span>);<br>    <span class="hljs-keyword">return</span> modelAndView;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å‘requeståŸŸå­˜å‚¨æ•°æ®</p><p>åœ¨è¿›è¡Œè½¬å‘æ—¶ï¼Œå¾€å¾€è¦å‘requeståŸŸä¸­å­˜å‚¨æ•°æ®ï¼Œåœ¨jspé¡µé¢ä¸­æ˜¾ç¤ºï¼Œé‚£ä¹ˆControllerä¸­æ€æ ·å‘requeståŸŸä¸­å­˜å‚¨æ•°æ®å‘¢ï¼Ÿ</p><ul><li><p>é€šè¿‡SpringMVCæ¡†æ¶æ³¨å…¥çš„requestå¯¹è±¡setAttribute()æ–¹æ³•è®¾ç½®</p><p>(è¿™ä¸ªä¸å¸¸ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†SpringMVCå°±æœ€å¥½ä½¿ç”¨æ¡†æ¶æä¾›çš„å¯¹è±¡ï¼Œä¸è¦ä½¿ç”¨ Javaweb çš„å¯¹è±¡ï¼Œä¿è¯å’ŒåŸç”Ÿçš„APIå®ç°è§£è€¦)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick&quot;)</span><br><span class="hljs-comment">// SpringMVC è¿˜å¯ä»¥è‡ªåŠ¨æ³¨å…¥å…¥å‚çš„ request</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">quickMethod</span><span class="hljs-params">(HttpServletRequest request)</span></span>&#123;<br>    request.setAttribute(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>é€šè¿‡ModelAndViewçš„addObject()æ–¹æ³•è®¾ç½®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick3&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">quickMethod3</span><span class="hljs-params">()</span></span>&#123;<br>    ModelAndView modelAndView = <span class="hljs-keyword">new</span> ModelAndView();<br>    modelAndView.setViewName(<span class="hljs-string">&quot;forward:/WEB-INF/views/index.jsp&quot;</span>);<br>    modelAndView.addObject(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;lisi&quot;</span>);<br>    <span class="hljs-keyword">return</span> modelAndView;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ol><h4 id="3-3-3-SpringMVC-å›å†™æ•°æ®"><a href="#3-3-3-SpringMVC-å›å†™æ•°æ®" class="headerlink" title="3.3.3 SpringMVC å›å†™æ•°æ®"></a>3.3.3 SpringMVC å›å†™æ•°æ®</h4><ol><li><p>ç›´æ¥è¿”å›å­—ç¬¦ä¸²</p><p>WebåŸºç¡€é˜¶æ®µï¼Œå®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨ç«¯ï¼Œå¦‚æœæƒ³ç›´æ¥å›å†™å­—ç¬¦ä¸²ä½œä¸ºå“åº”ä½“è¿”å›çš„è¯ï¼Œåªéœ€è¦ä½¿ç”¨</p><p>response.getWriter().print(â€œhello worldâ€) å³å¯ï¼Œé‚£ä¹ˆåœ¨Controllerä¸­æƒ³ç›´æ¥å›å†™å­—ç¬¦ä¸²è¯¥æ€æ ·å‘¢ï¼Ÿ</p><ul><li><p>é€šè¿‡SpringMVCæ¡†æ¶æ³¨å…¥çš„responseå¯¹è±¡ï¼Œä½¿ç”¨response.getWriter().print(â€œhello worldâ€) å›å†™æ•°æ®ï¼Œæ­¤æ—¶ä¸éœ€è¦è§†å›¾è·³è½¬ï¼Œä¸šåŠ¡æ–¹æ³•è¿”å›å€¼ä¸ºvoid</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick4&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod4</span><span class="hljs-params">(HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    response.getWriter().print(<span class="hljs-string">&quot;hello world&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å°†éœ€è¦å›å†™çš„å­—ç¬¦ä¸²ç›´æ¥è¿”å›ï¼Œä½†æ­¤æ—¶éœ€è¦é€šè¿‡<font color=#FF0000><strong>@ResponseBody</strong></font> æ³¨è§£å‘ŠçŸ¥SpringMVCæ¡†æ¶ï¼Œæ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ä¸æ˜¯è·³è½¬æ˜¯ç›´æ¥åœ¨httpå“åº”ä½“ä¸­è¿”å› (ä¸ä½¿ç”¨åŸç”ŸAPIï¼Œæ›´åŠ è§£è€¦ï¼Œæ›´å¸¸ç”¨)â­â­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick5&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">quickMethod5</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello springMVC!!!&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨å¼‚æ­¥é¡¹ç›®ä¸­ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯å¾€å¾€è¦è¿›è¡Œjsonæ ¼å¼å­—ç¬¦ä¸²äº¤äº’ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ‹¼æ¥jsonå­—ç¬¦ä¸²è¿”å›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick6&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">quickMethod6</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&#123;\&quot;name\&quot;:\&quot;zhangsan\&quot;,\&quot;age\&quot;:18&#125;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹å¼æ‰‹åŠ¨æ‹¼æ¥jsonæ ¼å¼å­—ç¬¦ä¸²çš„æ–¹å¼å¾ˆéº»çƒ¦(ä¸ä¼˜é›…)ï¼Œå¼€å‘ä¸­å¾€å¾€è¦å°†å¤æ‚çš„javaå¯¹è±¡è½¬æ¢æˆjsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨webé˜¶æ®µå­¦ä¹ è¿‡çš„jsonè½¬æ¢å·¥å…·jacksonè¿›è¡Œè½¬æ¢ï¼Œå¯¼å…¥jacksonåæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--jackson--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-databind<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jackson-annotations<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.9.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡jacksonè½¬æ¢jsonæ ¼å¼å­—ç¬¦ä¸²ï¼Œå›å†™å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick7&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">quickMethod7</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    User user = <span class="hljs-keyword">new</span> User();<br>    user.setUsername(<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>    user.setAge(<span class="hljs-number">18</span>);<br>    ObjectMapper objectMapper = <span class="hljs-keyword">new</span> ObjectMapper();<br>    String s = objectMapper.writeValueAsString(user);<br>    <span class="hljs-keyword">return</span> s;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>è¿”å›å¯¹è±¡æˆ–é›†åˆ</p><p>ï¼ˆç›¸å½“äºæŠŠä¸Šé¢è½¬jsonçš„è¿‡ç¨‹äº¤ç»™äº†æ¡†æ¶å®Œæˆï¼‰</p><p>é€šè¿‡SpringMVCå¸®åŠ©æˆ‘ä»¬å¯¹å¯¹è±¡æˆ–é›†åˆè¿›è¡Œjsonå­—ç¬¦ä¸²çš„è½¬æ¢å¹¶å›å†™ï¼Œä¸ºå¤„ç†å™¨é€‚é…å™¨é…ç½®æ¶ˆæ¯è½¬æ¢å‚æ•°ï¼ŒæŒ‡å®šä½¿ç”¨jacksonè¿›è¡Œå¯¹è±¡æˆ–é›†åˆçš„è½¬æ¢ï¼Œå› æ­¤éœ€è¦åœ¨spring-mvc.xmlä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼Œå¯¹å‰ç«¯æ§åˆ¶å™¨çš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®è¦†ç›–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.servlet.mvc.method.annotation</span></span><br><span class="hljs-tag"><span class="hljs-string">             .RequestMappingHandlerAdapter&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;messageConverters&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.http.converter.json</span></span><br><span class="hljs-tag"><span class="hljs-string">                       .MappingJackson2HttpMessageConverter&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick8&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">quickMethod8</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    User user = <span class="hljs-keyword">new</span> User();<br>    user.setUsername(<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>    user.setAge(<span class="hljs-number">18</span>);<br>    <span class="hljs-keyword">return</span> user;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ–¹æ³•ä¸Šæ·»åŠ **@ResponseBody**å°±å¯ä»¥è¿”å›jsonæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä½†æ˜¯è¿™æ ·é…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œé…ç½®çš„ä»£ç æ¯”è¾ƒå¤šï¼Œå› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨springmvc.xmlé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨mvcçš„æ³¨è§£é©±åŠ¨ä»£æ›¿ä¸Šè¿°é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--mvcçš„æ³¨è§£é©±åŠ¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨ SpringMVC çš„å„ä¸ªç»„ä»¶ä¸­ï¼Œ<strong>å¤„ç†å™¨æ˜ å°„å™¨</strong>ã€<strong>å¤„ç†å™¨é€‚é…å™¨</strong>ã€<strong>è§†å›¾è§£æå™¨</strong>ç§°ä¸º SpringMVC çš„ä¸‰å¤§ç»„ä»¶ã€‚</p><p>ä½¿ç”¨&lt; mvc:annotation-driven &gt;è‡ªåŠ¨åŠ è½½ RequestMappingHandlerMappingï¼ˆå¤„ç†æ˜ å°„å™¨ï¼‰å’Œ</p><p>RequestMappingHandlerAdapterï¼ˆ å¤„ ç† é€‚ é… å™¨ ï¼‰ï¼Œå¯ç”¨åœ¨Spring-xml.xmlé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨</p><p>&lt; mvc:annotation-driven &gt;æ›¿ä»£æ³¨è§£å¤„ç†å™¨å’Œé€‚é…å™¨çš„é…ç½®ã€‚</p><p>åŒæ—¶ä½¿ç”¨&lt; mvc:annotation-driven &gt;é»˜è®¤åº•å±‚å°±ä¼šé›†æˆjacksonè¿›è¡Œå¯¹è±¡æˆ–é›†åˆçš„jsonæ ¼å¼å­—ç¬¦ä¸²çš„è½¬æ¢ã€‚</p></li></ol><h3 id="3-4-SpringMVC-è·å¾—è¯·æ±‚æ•°æ®"><a href="#3-4-SpringMVC-è·å¾—è¯·æ±‚æ•°æ®" class="headerlink" title="3.4 SpringMVC è·å¾—è¯·æ±‚æ•°æ®"></a>3.4 SpringMVC è·å¾—è¯·æ±‚æ•°æ®</h3><h4 id="3-4-1-è·å¾—è¯·æ±‚å‚æ•°"><a href="#3-4-1-è·å¾—è¯·æ±‚å‚æ•°" class="headerlink" title="3.4.1  è·å¾—è¯·æ±‚å‚æ•°"></a>3.4.1  è·å¾—è¯·æ±‚å‚æ•°</h4><p>å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°çš„æ ¼å¼æ˜¯ï¼š<strong>name=value&amp;name=value</strong></p><p>æœåŠ¡å™¨ç«¯è¦è·å¾—è¯·æ±‚çš„å‚æ•°ï¼Œæœ‰æ—¶è¿˜éœ€è¦è¿›è¡Œæ•°æ®çš„å°è£…ï¼ŒSpringMVCå¯ä»¥æ¥æ”¶å¦‚ä¸‹ç±»å‹çš„å‚æ•°ï¼š</p><ul><li><p>åŸºæœ¬ç±»å‹å‚æ•°</p></li><li><p>POJOç±»å‹å‚æ•°ï¼ˆç®€å•JavaBeanï¼‰</p></li><li><p>æ•°ç»„ç±»å‹å‚æ•°</p></li><li><p>é›†åˆç±»å‹å‚æ•°</p></li></ul><h4 id="3-4-2-è·å¾—åŸºæœ¬ç±»å‹å‚æ•°"><a href="#3-4-2-è·å¾—åŸºæœ¬ç±»å‹å‚æ•°" class="headerlink" title="3.4.2 è·å¾—åŸºæœ¬ç±»å‹å‚æ•°"></a>3.4.2 è·å¾—åŸºæœ¬ç±»å‹å‚æ•°</h4><p>Controllerä¸­çš„ä¸šåŠ¡æ–¹æ³•çš„å‚æ•°åç§°è¦ä¸è¯·æ±‚å‚æ•°çš„nameä¸€è‡´ï¼Œå‚æ•°å€¼ä¼šè‡ªåŠ¨æ˜ å°„åŒ¹é…</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-15-20210704.png"></p><h4 id="3-4-3-è·å¾—POJOç±»å‹å‚æ•°"><a href="#3-4-3-è·å¾—POJOç±»å‹å‚æ•°" class="headerlink" title="3.4.3 è·å¾—POJOç±»å‹å‚æ•°"></a>3.4.3 è·å¾—POJOç±»å‹å‚æ•°</h4><p>Controllerä¸­çš„ä¸šåŠ¡æ–¹æ³•çš„POJOå‚æ•°çš„å±æ€§åä¸è¯·æ±‚å‚æ•°çš„nameä¸€è‡´ï¼Œå‚æ•°å€¼ä¼šè‡ªåŠ¨æ˜ å°„åŒ¹é…</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-16-20210704.png"></p><h4 id="3-4-4-è·å¾—æ•°ç»„ç±»å‹å‚æ•°"><a href="#3-4-4-è·å¾—æ•°ç»„ç±»å‹å‚æ•°" class="headerlink" title="3.4.4 è·å¾—æ•°ç»„ç±»å‹å‚æ•°"></a>3.4.4 è·å¾—æ•°ç»„ç±»å‹å‚æ•°</h4><p>Controllerä¸­çš„ä¸šåŠ¡æ–¹æ³•æ•°ç»„åç§°ä¸è¯·æ±‚å‚æ•°çš„nameä¸€è‡´ï¼Œå‚æ•°å€¼ä¼šè‡ªåŠ¨æ˜ å°„åŒ¹é…</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-17-20210704.png"></p><h4 id="3-4-5-è·å¾—é›†åˆç±»å‹å‚æ•°"><a href="#3-4-5-è·å¾—é›†åˆç±»å‹å‚æ•°" class="headerlink" title="3.4.5 è·å¾—é›†åˆç±»å‹å‚æ•°"></a>3.4.5 è·å¾—é›†åˆç±»å‹å‚æ•°</h4><p>è·å¾—é›†åˆå‚æ•°æ—¶ï¼Œè¦å°†é›†åˆå‚æ•°åŒ…è£…åˆ°ä¸€ä¸ªPOJOä¸­æ‰å¯ä»¥</p><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªè¡¨å•jspï¼Œç”¨äºæäº¤æ•°æ®</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;form action=<span class="hljs-string">&quot;$&#123;pageContext.request.contextPath&#125;/quick12&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span>&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userList[0].username&quot;</span>&gt;&lt;br&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userList[0].age&quot;</span>&gt;&lt;br&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userList[1].username&quot;</span>&gt;&lt;br&gt;<br>    &lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;userList[1].age&quot;</span>&gt;&lt;br&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;&lt;br&gt;<br>&lt;/form&gt;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¯ä»¥å’ŒPOJOç±»å‹ç›¸ä¼¼äº†ï¼Œç›´æ¥è‡ªåŠ¨æ˜ å°„åŒ¹é…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick12&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod12</span><span class="hljs-params">(Vo vo)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    System.out.println(vo.getUserList());<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¦ä¸€ä¸ªåœºæ™¯ï¼ˆæ”¾è¡Œé™æ€èµ„æºï¼‰ï¼š</strong></p><p><font color=#FF0000>å½“ä½¿ç”¨ajaxæäº¤æ—¶ï¼Œå¯ä»¥æŒ‡å®šcontentTypeä¸ºjsonå½¢å¼ï¼Œé‚£ä¹ˆåœ¨æ–¹æ³•å‚æ•°ä½ç½®ä½¿ç”¨@RequestBodyå¯ä»¥ç›´æ¥æ¥æ”¶é›†åˆæ•°æ®è€Œæ— éœ€ä½¿ç”¨POJOè¿›è¡ŒåŒ…è£…</font></p><p>å…ˆåŠ è½½ jqurey-3.3.1.js ï¼Œåœ¨ç¼–å†™è‡ªå·±çš„è„šæœ¬</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;script&gt;<br>    <span class="hljs-comment">//æ¨¡æ‹Ÿæ•°æ®</span><br>    <span class="hljs-keyword">var</span> userList = <span class="hljs-keyword">new</span> Array();<br>    userList.push(&#123;username: <span class="hljs-string">&quot;zhangsan&quot;</span>,age: <span class="hljs-string">&quot;20&quot;</span>&#125;);<br>    userList.push(&#123;username: <span class="hljs-string">&quot;lisi&quot;</span>,age: <span class="hljs-string">&quot;20&quot;</span>&#125;);<br>    $.ajax(&#123;<br>        type: <span class="hljs-string">&quot;POST&quot;</span>,<br>        url: <span class="hljs-string">&quot;/itheima_springmvc1/quick13&quot;</span>,<br>        data: JSON.stringify(userList),<br>        contentType : <span class="hljs-string">&#x27;application/json;charset=utf-8&#x27;</span><br>    &#125;);<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick13&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod13</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> List&lt;User&gt; userList)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    System.out.println(userList);<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šé€šè¿‡è°·æ­Œå¼€å‘è€…å·¥å…·æŠ“åŒ…å‘ç°ï¼Œæ²¡æœ‰åŠ è½½åˆ°jqueryæ–‡ä»¶ï¼ŒåŸå› æ˜¯SpringMVCçš„å‰ç«¯æ§åˆ¶å™¨DispatcherServletçš„url-patterné…ç½®çš„æ˜¯/ï¼Œä»£è¡¨å¯¹æ‰€æœ‰çš„èµ„æºéƒ½è¿›è¡Œè¿‡æ»¤æ“ä½œï¼Œç„¶åå»@RequestMappingæ‰¾å¯¹åº”çš„è·¯å¾„ï¼Œæ‰¾ä¸åˆ°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æŒ‡å®šæ”¾è¡Œé™æ€èµ„æºï¼š</p><ul><li><p>åœ¨spring-mvc.xmlé…ç½®æ–‡ä»¶ä¸­æŒ‡å®šæ”¾è¡Œçš„èµ„æºï¼Œé€šå¸¸éƒ½æ˜¯é™æ€èµ„æº</p><p>mapping ä»£è¡¨è®¿é—®çš„åœ°å€ï¼Œlocationè¡¨ç¤ºè®¿é—®çš„ç›®å½•</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:resources</span> <span class="hljs-attr">mapping</span>=<span class="hljs-string">&quot;/js/**&quot;</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;/js/&quot;</span>/&gt;</span> <br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨&lt; mvc:default-servlet-handler/ &gt;æ ‡ç­¾ï¼Œä»£è¡¨å¦‚æœSpringMVCæ‰¾ä¸åˆ°é™æ€èµ„æºï¼Œå°±äº¤ç”±åŸå§‹å®¹å™¨TomcatæœåŠ¡å™¨å»å¯»æ‰¾èµ„æº</p></li></ul><h4 id="3-4-6-è¯·æ±‚æ•°æ®ä¹±ç é—®é¢˜"><a href="#3-4-6-è¯·æ±‚æ•°æ®ä¹±ç é—®é¢˜" class="headerlink" title="3.4.6 è¯·æ±‚æ•°æ®ä¹±ç é—®é¢˜"></a>3.4.6 è¯·æ±‚æ•°æ®ä¹±ç é—®é¢˜</h4><p>å½“postè¯·æ±‚æ—¶ï¼Œæ•°æ®ä¼šå‡ºç°ä¹±ç ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªè¿‡æ»¤å™¨æ¥è¿›è¡Œç¼–ç çš„è¿‡æ»¤</p><p>åœ¨web.xmlä¸­é…ç½®ä¸€ä¸ªå…¨å±€è¿‡æ»¤å™¨ï¼Œå¯¹æ‰€æœ‰è¯·æ±‚ç¼–ç è¿›è¡Œè¿‡æ»¤</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">filter</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-class</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">init-param</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>encoding<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">init-param</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">filter-mapping</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="hljs-tag">&lt;/<span class="hljs-name">filter-name</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">url-pattern</span>&gt;</span>/*<span class="hljs-tag">&lt;/<span class="hljs-name">url-pattern</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">filter-mapping</span>&gt;</span><br><br></code></pre></td></tr></table></figure><h4 id="3-4-7-å‚æ•°ç»‘å®šæ³¨è§£-RequestParam"><a href="#3-4-7-å‚æ•°ç»‘å®šæ³¨è§£-RequestParam" class="headerlink" title="3.4.7 å‚æ•°ç»‘å®šæ³¨è§£@RequestParam"></a>3.4.7 å‚æ•°ç»‘å®šæ³¨è§£<font color=#FF0000>@RequestParam</font></h4><p>å½“è¯·æ±‚çš„å‚æ•°åç§°ä¸Controllerçš„ä¸šåŠ¡æ–¹æ³•å‚æ•°åç§°ä¸ä¸€è‡´æ—¶ï¼Œå°±éœ€è¦é€šè¿‡@RequestParamæ³¨è§£æ˜¾ç¤ºçš„ç»‘å®š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-18-20210704.png"></p><p>æ³¨è§£@RequestParamè¿˜æœ‰å¦‚ä¸‹å‚æ•°å¯ä»¥ä½¿ç”¨ï¼š</p><ul><li><p><strong>value</strong>ï¼šä¸è¯·æ±‚å‚æ•°åç§°</p></li><li><p><strong>required</strong>ï¼šæ­¤åœ¨æŒ‡å®šçš„è¯·æ±‚å‚æ•°æ˜¯å¦å¿…é¡»åŒ…æ‹¬ï¼Œé»˜è®¤æ˜¯trueï¼Œæäº¤æ—¶å¦‚æœæ²¡æœ‰æ­¤å‚æ•°åˆ™æŠ¥é”™</p></li><li><p><strong>defaultValue</strong>ï¼šå½“æ²¡æœ‰æŒ‡å®šè¯·æ±‚å‚æ•°æ—¶ï¼Œåˆ™ä½¿ç”¨æŒ‡å®šçš„é»˜è®¤å€¼èµ‹å€¼</p></li></ul><h4 id="3-4-8-è·å¾—Restfulé£æ ¼çš„å‚æ•°"><a href="#3-4-8-è·å¾—Restfulé£æ ¼çš„å‚æ•°" class="headerlink" title="3.4.8 è·å¾—Restfulé£æ ¼çš„å‚æ•°"></a>3.4.8 è·å¾—Restfulé£æ ¼çš„å‚æ•°</h4><p><strong>Restful</strong>æ˜¯ä¸€ç§è½¯ä»¶<strong>æ¶æ„é£æ ¼</strong>ã€<strong>è®¾è®¡é£æ ¼</strong>ï¼Œè€Œä¸æ˜¯æ ‡å‡†ï¼Œåªæ˜¯æä¾›äº†ä¸€ç»„è®¾è®¡åŸåˆ™å’Œçº¦æŸæ¡ä»¶ã€‚ä¸»è¦ç”¨äºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨äº¤äº’ç±»çš„è½¯ä»¶ï¼ŒåŸºäºè¿™ä¸ªé£æ ¼è®¾è®¡çš„è½¯ä»¶å¯ä»¥æ›´ç®€æ´ï¼Œæ›´æœ‰å±‚æ¬¡ï¼Œæ›´æ˜“äºå®ç°ç¼“å­˜æœºåˆ¶ç­‰ã€‚</p><p><strong>Restful</strong>é£æ ¼çš„è¯·æ±‚æ˜¯ä½¿ç”¨<strong>â€œurl+è¯·æ±‚æ–¹å¼â€</strong>è¡¨ç¤ºä¸€æ¬¡è¯·æ±‚ç›®çš„çš„ï¼ŒHTTP åè®®é‡Œé¢å››ä¸ªè¡¨ç¤ºæ“ä½œæ–¹å¼çš„åŠ¨è¯å¦‚ä¸‹ï¼š</p><ul><li><p>GETï¼šç”¨äºè·å–èµ„æº</p></li><li><p>POSTï¼šç”¨äºæ–°å»ºèµ„æº</p></li><li><p>PUTï¼šç”¨äºæ›´æ–°èµ„æº</p></li><li><p>DELETEï¼šç”¨äºåˆ é™¤èµ„æº </p></li></ul><p>ä¾‹å¦‚ï¼š</p><ul><li><p>/user/1  GET ï¼š    å¾—åˆ° id = 1 çš„ user</p></li><li><p>/user/1  DELETEï¼š åˆ é™¤ id = 1 çš„ user</p></li><li><p>/user/1  PUTï¼š    æ›´æ–° id = 1 çš„ user</p></li><li><p>/user    POSTï¼š   æ–°å¢ user</p></li></ul><p>ä¸Šè¿°urlåœ°å€/user/1ä¸­çš„1å°±æ˜¯è¦è·å¾—çš„è¯·æ±‚å‚æ•°ï¼Œåœ¨SpringMVCä¸­å¯ä»¥ä½¿ç”¨å ä½ç¬¦è¿›è¡Œå‚æ•°ç»‘å®šã€‚åœ°å€/user/1å¯ä»¥å†™æˆ/user/{id}ï¼Œå ä½ç¬¦{id}å¯¹åº”çš„å°±æ˜¯1çš„å€¼ã€‚åœ¨ä¸šåŠ¡æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<font color=#FF0000><strong>@PathVariable</strong></font>æ³¨è§£è¿›è¡Œå ä½ç¬¦çš„åŒ¹é…è·å–å·¥ä½œã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-19-20210704.png"></p><h4 id="3-4-9-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨"><a href="#3-4-9-è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨" class="headerlink" title="3.4.9 è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨"></a>3.4.9 è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨</h4><ul><li><p>SpringMVC é»˜è®¤å·²ç»æä¾›äº†ä¸€äº›å¸¸ç”¨çš„ç±»å‹è½¬æ¢å™¨ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯æäº¤çš„å­—ç¬¦ä¸²è½¬æ¢æˆintå‹è¿›è¡Œå‚æ•°è®¾ç½®ã€‚</p></li><li><p>ä½†æ˜¯ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®ç±»å‹éƒ½æä¾›äº†è½¬æ¢å™¨ï¼Œæ²¡æœ‰æä¾›çš„å°±éœ€è¦è‡ªå®šä¹‰è½¬æ¢å™¨ï¼Œä¾‹å¦‚ï¼šæ—¥æœŸç±»å‹çš„æ•°æ®å°±éœ€è¦è‡ªå®šä¹‰è½¬æ¢å™¨ã€‚</p></li></ul><p>è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨çš„å¼€å‘æ­¥éª¤ï¼š</p><p>â‘ å®šä¹‰è½¬æ¢å™¨ç±»å®ç°Converteræ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DateConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Converter</span>&lt;<span class="hljs-title">String</span>,<span class="hljs-title">Date</span>&gt;</span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Date <span class="hljs-title">convert</span><span class="hljs-params">(String source)</span> </span>&#123;<br>        SimpleDateFormat format = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            Date date = format.parse(source);<br>            <span class="hljs-keyword">return</span> date;<br>        &#125; <span class="hljs-keyword">catch</span> (ParseException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¡åœ¨spring-mvc.xmlé…ç½®æ–‡ä»¶ä¸­å£°æ˜è½¬æ¢å™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;converterService&quot;</span>  </span><br><span class="hljs-tag">   <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;converters&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.converter.DateConverter&quot;</span>/&gt;</span><br>       <span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¢åœ¨&lt; annotation-driven &gt;ä¸­å¼•ç”¨è½¬æ¢å™¨(spring-mvc.xmlé…ç½®æ–‡ä»¶)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:annotation-driven</span> <span class="hljs-attr">conversion-service</span>=<span class="hljs-string">&quot;converterService&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h4 id="3-4-10-è·å–Servletç›¸å…³API"><a href="#3-4-10-è·å–Servletç›¸å…³API" class="headerlink" title="3.4.10 è·å–Servletç›¸å…³API"></a>3.4.10 è·å–Servletç›¸å…³API</h4><p>SpringMVCæ”¯æŒä½¿ç”¨åŸå§‹ServletAPIå¯¹è±¡ä½œä¸ºæ§åˆ¶å™¨æ–¹æ³•çš„å‚æ•°è¿›è¡Œ<strong>æ³¨å…¥</strong>ï¼Œå¸¸ç”¨çš„å¯¹è±¡å¦‚ä¸‹ï¼š</p><ul><li><p>HttpServletRequest</p></li><li><p>HttpServletResponse</p></li><li><p>HttpSession</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick16&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod16</span><span class="hljs-params">(HttpServletRequest request,HttpServletResponse response, HttpSession session)</span></span>&#123;<br>    System.out.println(request);<br>    System.out.println(response);<br>    System.out.println(session);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-4-11-è·å–è¯·æ±‚å¤´"><a href="#3-4-11-è·å–è¯·æ±‚å¤´" class="headerlink" title="3.4.11 è·å–è¯·æ±‚å¤´"></a>3.4.11 è·å–è¯·æ±‚å¤´</h4><ul><li><p><font color=#FF0000><strong>@RequestHeader</strong></font></p><p>ä½¿ç”¨@RequestHeaderå¯ä»¥è·å¾—è¯·æ±‚å¤´ä¿¡æ¯ï¼Œç›¸å½“äºwebé˜¶æ®µå­¦ä¹ çš„request.getHeader(name)</p><p>@RequestHeaderæ³¨è§£çš„å±æ€§å¦‚ä¸‹ï¼š</p><ul><li><p><strong>value</strong>ï¼šè¯·æ±‚å¤´çš„åç§°</p></li><li><p><strong>required</strong>ï¼šæ˜¯å¦å¿…é¡»æºå¸¦æ­¤è¯·æ±‚å¤´</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick17&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod17</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader(value = &quot;User-Agent&quot;, required = false)</span> String headerValue)</span></span>&#123;<br>    System.out.println(headerValue);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><font color=#FF0000><strong>@CookieValue</strong></font></p><p>ä½¿ç”¨@CookieValueå¯ä»¥è·å¾—æŒ‡å®šCookieçš„å€¼</p><p>@CookieValueæ³¨è§£çš„å±æ€§å¦‚ä¸‹ï¼š</p><ul><li><p><strong>value</strong>ï¼šæŒ‡å®šcookieçš„åç§°</p></li><li><p><strong>required</strong>ï¼šæ˜¯å¦å¿…é¡»æºå¸¦æ­¤cookie</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick18&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod18</span><span class="hljs-params">(</span></span><br><span class="hljs-function"><span class="hljs-params">    <span class="hljs-meta">@CookieValue(value = &quot;JSESSIONID&quot;,required = false)</span> String jsessionid)</span></span>&#123;<br>    System.out.println(jsessionid);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h4 id="3-4-12-æ–‡ä»¶ä¸Šä¼ "><a href="#3-4-12-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="3.4.12 æ–‡ä»¶ä¸Šä¼ "></a>3.4.12 æ–‡ä»¶ä¸Šä¼ </h4><p><strong>æ–‡ä»¶ä¸Šä¼ å®¢æˆ·ç«¯ä¸‰è¦ç´ </strong>ï¼š</p><ul><li><p>è¡¨å•é¡¹type=â€œfileâ€</p></li><li><p>è¡¨å•çš„æäº¤æ–¹å¼æ˜¯post</p></li><li><p>è¡¨å•çš„enctypeå±æ€§æ˜¯å¤šéƒ¨åˆ†è¡¨å•å½¢å¼ï¼ŒåŠenctype=â€œmultipart/form-dataâ€</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-20-20210705.png"></p><p><strong>æ–‡ä»¶ä¸Šä¼ åŸç†</strong></p><ul><li><p>å½“formè¡¨å•ä¿®æ”¹ä¸ºå¤šéƒ¨åˆ†è¡¨å•æ—¶ï¼Œrequest.getParameter()å°†å¤±æ•ˆã€‚</p></li><li><p>enctype=â€œapplication/x-www-form-urlencodedâ€ æ—¶ï¼Œformè¡¨å•çš„æ­£æ–‡å†…å®¹æ ¼å¼æ˜¯ï¼š<strong>key=value&amp;key=value&amp;key=value</strong></p></li><li><p>å½“ form è¡¨å•çš„ enctype å–å€¼ä¸º Mutilpart/form-data æ—¶ï¼Œè¯·æ±‚æ­£æ–‡å†…å®¹å°±å˜æˆå¤šéƒ¨åˆ†å½¢å¼ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-21-20210705.png"></p></li></ul><p><strong>å•æ–‡ä»¶ä¸Šä¼ çš„æ­¥éª¤</strong></p><p>â‘ å¯¼å…¥fileuploadå’Œioåæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡spring-mvc.xmlé…ç½®æ–‡ä»¶ä¸Šä¼ è§£æå™¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;multipartResolver&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--ä¸Šä¼ æ–‡ä»¶æ€»å¤§å°--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxUploadSize&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5242800&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--ä¸Šä¼ å•ä¸ªæ–‡ä»¶çš„å¤§å°--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;maxUploadSizePerFile&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;5242800&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--ä¸Šä¼ æ–‡ä»¶çš„ç¼–ç ç±»å‹--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;defaultEncoding&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¢ç¼–å†™æ–‡ä»¶ä¸Šä¼ ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick20&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-comment">// æ³¨æ„å…¥å‚çš„ uploadFile éœ€è¦å’Œè¡¨å•çš„æ–‡ä»¶åå¯¹åº”ï¼Œæ¡†æ¶æ‰èƒ½å®Œæˆæ˜ å°„åŒ¹é…</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod20</span><span class="hljs-params">(String name,MultipartFile uploadFile)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-comment">//è·å¾—æ–‡ä»¶åç§°</span><br>    String originalFilename = uploadFile.getOriginalFilename();<br>    <span class="hljs-comment">//ä¿å­˜æ–‡ä»¶</span><br>    uploadFile.transferTo(<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;C:\\upload\\&quot;</span>+originalFilename));<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¤šæ–‡ä»¶ä¸Šä¼ å®ç°</strong></p><p>å¤šæ–‡ä»¶ä¸Šä¼ ï¼Œåªéœ€è¦å°†é¡µé¢ä¿®æ”¹ä¸ºå¤šä¸ªæ–‡ä»¶ä¸Šä¼ é¡¹ï¼Œå°†æ–¹æ³•å‚æ•°MultipartFileç±»å‹ä¿®æ”¹ä¸ºMultipartFile[]å³å¯</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;h1&gt;å¤šæ–‡ä»¶ä¸Šä¼ æµ‹è¯•&lt;/h1&gt;<br>&lt;form action=<span class="hljs-string">&quot;$&#123;pageContext.request.contextPath&#125;/quick21&quot;</span> method=<span class="hljs-string">&quot;post&quot;</span> enctype=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;<br>    åç§°ï¼š&lt;input type=<span class="hljs-string">&quot;text&quot;</span> name=<span class="hljs-string">&quot;name&quot;</span>&gt;&lt;br&gt;<br>    æ–‡ä»¶<span class="hljs-number">1</span>ï¼š&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;uploadFiles&quot;</span>&gt;&lt;br&gt;<br>    æ–‡ä»¶<span class="hljs-number">2</span>ï¼š&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;uploadFiles&quot;</span>&gt;&lt;br&gt;<br>    æ–‡ä»¶<span class="hljs-number">3</span>ï¼š&lt;input type=<span class="hljs-string">&quot;file&quot;</span> name=<span class="hljs-string">&quot;uploadFiles&quot;</span>&gt;&lt;br&gt;<br>    &lt;input type=<span class="hljs-string">&quot;submit&quot;</span> value=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;&lt;br&gt;<br>&lt;/form&gt;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick21&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod21</span><span class="hljs-params">(String name,MultipartFile[] uploadFiles)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>    <span class="hljs-keyword">for</span> (MultipartFile uploadFile : uploadFiles)&#123;<br>        String originalFilename = uploadFile.getOriginalFilename();<br>        uploadFile.transferTo(<span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;C:\\upload\\&quot;</span>+originalFilename));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-4-13-è¦ç‚¹æ€»ç»“"><a href="#3-4-13-è¦ç‚¹æ€»ç»“" class="headerlink" title="3.4.13 è¦ç‚¹æ€»ç»“"></a>3.4.13 è¦ç‚¹æ€»ç»“</h4><p><strong>MVC å®ç°æ•°æ®è¯·æ±‚æ–¹å¼</strong></p><ul><li><p>åŸºæœ¬ç±»å‹å‚æ•°</p></li><li><p>POJOç±»å‹å‚æ•°</p></li><li><p>æ•°ç»„ç±»å‹å‚æ•°</p></li><li><p>é›†åˆç±»å‹å‚æ•°</p></li></ul><p><strong>MVCè·å–æ•°æ®ç»†èŠ‚</strong></p><ul><li>ä¸­æ–‡ä¹±ç é—®é¢˜</li><li>@RequestParam å’Œ @PathVariable </li><li>è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨</li><li>è·å¾—Servletç›¸å…³API</li><li>@RequestHeader å’Œ @CookieValue</li><li>æ–‡ä»¶ä¸Šä¼ </li></ul><h3 id="3-5-SpringMVC-æ‹¦æˆªå™¨"><a href="#3-5-SpringMVC-æ‹¦æˆªå™¨" class="headerlink" title="3.5 SpringMVC æ‹¦æˆªå™¨"></a>3.5 SpringMVC æ‹¦æˆªå™¨</h3><h4 id="3-5-1-æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰çš„ä½œç”¨"><a href="#3-5-1-æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰çš„ä½œç”¨" class="headerlink" title="3.5.1 æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰çš„ä½œç”¨"></a>3.5.1 æ‹¦æˆªå™¨ï¼ˆinterceptorï¼‰çš„ä½œç”¨</h4><p>Spring MVC çš„<strong>æ‹¦æˆªå™¨</strong>ç±»ä¼¼äº Servlet å¼€å‘ä¸­çš„è¿‡æ»¤å™¨ Filterï¼Œç”¨äºå¯¹å¤„ç†å™¨è¿›è¡Œ<strong>é¢„å¤„ç†</strong>å’Œ<strong>åå¤„ç†</strong>ã€‚</p><p>å°†æ‹¦æˆªå™¨æŒ‰ä¸€å®šçš„é¡ºåºè”ç»“æˆä¸€æ¡é“¾ï¼Œè¿™æ¡é“¾ç§°ä¸º<strong>æ‹¦æˆªå™¨é“¾ï¼ˆInterceptor Chainï¼‰</strong>ã€‚åœ¨è®¿é—®è¢«æ‹¦æˆªçš„æ–¹æ³•æˆ–å­—æ®µæ—¶ï¼Œæ‹¦æˆªå™¨é“¾ä¸­çš„æ‹¦æˆªå™¨å°±ä¼šæŒ‰å…¶ä¹‹å‰å®šä¹‰çš„é¡ºåºè¢«è°ƒç”¨ã€‚æ‹¦æˆªå™¨ä¹Ÿæ˜¯AOPæ€æƒ³çš„å…·ä½“å®ç°ã€‚</p><h4 id="3-5-2-æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨åŒºåˆ«"><a href="#3-5-2-æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨åŒºåˆ«" class="headerlink" title="3.5.2 æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨åŒºåˆ«"></a>3.5.2 æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨åŒºåˆ«</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-23-20210711.png"></p><h4 id="3-5-3-æ‹¦æˆªå™¨å¿«é€Ÿå…¥é—¨"><a href="#3-5-3-æ‹¦æˆªå™¨å¿«é€Ÿå…¥é—¨" class="headerlink" title="3.5.3 æ‹¦æˆªå™¨å¿«é€Ÿå…¥é—¨"></a>3.5.3 æ‹¦æˆªå™¨å¿«é€Ÿå…¥é—¨</h4><p>è‡ªå®šä¹‰æ‹¦æˆªå™¨å¾ˆç®€å•ï¼Œåªæœ‰å¦‚ä¸‹ä¸‰æ­¥ï¼š</p><p>â‘ åˆ›å»ºæ‹¦æˆªå™¨ç±»å®ç°HandlerInterceptoræ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHandlerInterceptor1</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerInterceptor</span> </span>&#123;<br>    <span class="hljs-comment">// ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹å‰ï¼Œæ‰§è¡Œ</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse </span></span><br><span class="hljs-function"><span class="hljs-params">        response, Object handler)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;preHandle running...&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>    &#125;<br>    <span class="hljs-comment">// åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œä¹‹åï¼Œè§†å›¾å¯¹è±¡è¿”å›ä¹‹å‰æ‰§è¡Œ</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse </span></span><br><span class="hljs-function"><span class="hljs-params">        response, Object handler, ModelAndView modelAndView)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;postHandle running...&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// åœ¨æµç¨‹éƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ‰§è¡Œ</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse </span></span><br><span class="hljs-function"><span class="hljs-params">        response, Object handler, Exception ex)</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;afterCompletion running...&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>â‘¡é…ç½®æ‹¦æˆªå™¨</p><p>åœ¨spring-mvc.xmlä¸­é…ç½®ï¼Œ<font color=#FF0000>å¤šä¸ªæ‹¦æˆªå™¨é…ç½®é¡ºåºå†³å®šäº†æ‰§è¡Œé¡ºåº</font></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--é…ç½®æ‹¦æˆªå™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptors</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptor</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- å¯¹å“ªäº›èµ„æºæ‰§è¡Œè¿›è¡Œæ‹¦æˆª --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/**&quot;</span>/&gt;</span><br>        <span class="hljs-comment">&lt;!-- å¯¹å“ªäº›èµ„æºæ‰§è¡Œæ’é™¤æ‹¦æˆª --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">mvv:exclude-mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;/user/login&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.interceptor.MyHandlerInterceptor1&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptor</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptors</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¢æµ‹è¯•æ‹¦æˆªå™¨çš„æ‹¦æˆªæ•ˆæœ</p><p>ç¼–å†™ç›®æ ‡æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick23&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">quickMethod23</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, ParseException </span>&#123;<br>    System.out.println(<span class="hljs-string">&quot;ç›®æ ‡æ–¹æ³•æ‰§è¡Œ....&quot;</span>);<br>    ModelAndView modelAndView = <span class="hljs-keyword">new</span> ModelAndView();<br>    modelAndView.addObject(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;itcast&quot;</span>);<br>    modelAndView.setViewName(<span class="hljs-string">&quot;index&quot;</span>);<br>    <span class="hljs-keyword">return</span> modelAndView;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="3-5-4-æ‹¦æˆªå™¨æ–¹æ³•è¯´æ˜"><a href="#3-5-4-æ‹¦æˆªå™¨æ–¹æ³•è¯´æ˜" class="headerlink" title="3.5.4 æ‹¦æˆªå™¨æ–¹æ³•è¯´æ˜"></a>3.5.4 æ‹¦æˆªå™¨æ–¹æ³•è¯´æ˜</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-24-20210711.png"></p><h3 id="3-6-SpringMVC-å¼‚å¸¸å¤„ç†æœºåˆ¶"><a href="#3-6-SpringMVC-å¼‚å¸¸å¤„ç†æœºåˆ¶" class="headerlink" title="3.6 SpringMVC å¼‚å¸¸å¤„ç†æœºåˆ¶"></a>3.6 SpringMVC å¼‚å¸¸å¤„ç†æœºåˆ¶</h3><h4 id="3-6-1-å¼‚å¸¸å¤„ç†çš„æ€è·¯"><a href="#3-6-1-å¼‚å¸¸å¤„ç†çš„æ€è·¯" class="headerlink" title="3.6.1 å¼‚å¸¸å¤„ç†çš„æ€è·¯"></a>3.6.1 å¼‚å¸¸å¤„ç†çš„æ€è·¯</h4><p>ç³»ç»Ÿä¸­å¼‚å¸¸åŒ…æ‹¬ä¸¤ç±»ï¼š<strong>é¢„æœŸå¼‚å¸¸</strong>å’Œ<strong>è¿è¡Œæ—¶å¼‚å¸¸ RuntimeException</strong>ï¼Œå‰è€…é€šè¿‡æ•è·å¼‚å¸¸ä»è€Œè·å–å¼‚å¸¸ä¿¡æ¯ï¼Œåè€…ä¸»è¦é€šè¿‡è§„èŒƒä»£ç å¼€å‘ã€æµ‹è¯•ç­‰æ‰‹æ®µå‡å°‘è¿è¡Œæ—¶å¼‚å¸¸çš„å‘ç”Ÿã€‚</p><p>ç³»ç»Ÿçš„<strong>Dao</strong>ã€<strong>Service</strong>ã€<strong>Controller</strong>å‡ºç°éƒ½é€šè¿‡throws Exceptionå‘ä¸ŠæŠ›å‡ºï¼Œæœ€åç”±SpringMVCå‰ç«¯æ§åˆ¶å™¨äº¤ç”±å¼‚å¸¸å¤„ç†å™¨è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-25-20210711.png"></p><h4 id="3-6-2-å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼"><a href="#3-6-2-å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼" class="headerlink" title="3.6.2 å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼"></a>3.6.2 å¼‚å¸¸å¤„ç†ä¸¤ç§æ–¹å¼</h4><ul><li><p>ä½¿ç”¨Spring MVCæä¾›çš„ç®€å•å¼‚å¸¸å¤„ç†å™¨SimpleMappingExceptionResolver</p></li><li><p>å®ç°Springçš„å¼‚å¸¸å¤„ç†æ¥å£HandlerExceptionResolver è‡ªå®šä¹‰è‡ªå·±çš„å¼‚å¸¸å¤„ç†å™¨</p></li></ul><h4 id="3-6-3-ç®€å•å¼‚å¸¸å¤„ç†å™¨-SimpleMappingExceptionResolver"><a href="#3-6-3-ç®€å•å¼‚å¸¸å¤„ç†å™¨-SimpleMappingExceptionResolver" class="headerlink" title="3.6.3 ç®€å•å¼‚å¸¸å¤„ç†å™¨ SimpleMappingExceptionResolver"></a>3.6.3 ç®€å•å¼‚å¸¸å¤„ç†å™¨ SimpleMappingExceptionResolver</h4><p>SpringMVCå·²ç»å®šä¹‰å¥½äº†è¯¥ç±»å‹è½¬æ¢å™¨ï¼Œåœ¨ä½¿ç”¨æ—¶å¯ä»¥æ ¹æ®é¡¹ç›®æƒ…å†µè¿›è¡Œç›¸åº”å¼‚å¸¸ä¸è§†å›¾çš„æ˜ å°„é…ç½®</p><p>spring-mvc.xmlä¸­é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--é…ç½®ç®€å•æ˜ å°„å¼‚å¸¸å¤„ç†å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">â€œorg.springframework.web.servlet.handler.SimpleMappingExceptionResolverâ€</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">â€œdefaultErrorViewâ€</span> <span class="hljs-attr">value</span>=<span class="hljs-string">â€œerrorâ€/</span>&gt;</span>   é»˜è®¤é”™è¯¯è§†å›¾<br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">â€œexceptionMappingsâ€</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span>               å¼‚å¸¸ç±»å‹                  é”™è¯¯è§†å›¾<br>            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;com.itheima.exception.MyException&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;error&quot;</span>/&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;java.lang.ClassCastException&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;error&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="3-6-4-è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†æ­¥éª¤"><a href="#3-6-4-è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†æ­¥éª¤" class="headerlink" title="3.6.4 è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†æ­¥éª¤"></a>3.6.4 è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†æ­¥éª¤</h4><p>â‘ åˆ›å»ºå¼‚å¸¸å¤„ç†å™¨ç±»å®ç°HandlerExceptionResolver</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyExceptionResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HandlerExceptionResolver</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> ModelAndView <span class="hljs-title">resolveException</span><span class="hljs-params">(HttpServletRequest request, </span></span><br><span class="hljs-function"><span class="hljs-params">    HttpServletResponse response, Object handler, Exception ex)</span> </span>&#123;<br>        <span class="hljs-comment">//å¤„ç†å¼‚å¸¸çš„ä»£ç å®ç°</span><br>        <span class="hljs-comment">//åˆ›å»ºModelAndViewå¯¹è±¡</span><br>        ModelAndView modelAndView = <span class="hljs-keyword">new</span> ModelAndView();<br>        modelAndView.setViewName(<span class="hljs-string">&quot;exceptionPage&quot;</span>);<br>        <span class="hljs-keyword">return</span> modelAndView;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¡é…ç½®å¼‚å¸¸å¤„ç†å™¨</p><p>spring-mvc.xmlä¸­é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;exceptionResolver&quot;</span>        </span><br><span class="hljs-tag">      <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.exception.MyExceptionResolver&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¢ç¼–å†™å¼‚å¸¸é¡µé¢</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;%@ page contentType=<span class="hljs-string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="hljs-string">&quot;java&quot;</span> %&gt;<br>&lt;html&gt;<br>    &lt;head&gt;<br>        &lt;title&gt;Title&lt;/title&gt;<br>    &lt;/head&gt;<br>    &lt;body&gt;<br>        è¿™æ˜¯ä¸€ä¸ªæœ€ç»ˆå¼‚å¸¸çš„æ˜¾ç¤ºé¡µé¢<br>    &lt;/body&gt;<br>&lt;/html&gt;<br></code></pre></td></tr></table></figure><p>â‘£æµ‹è¯•å¼‚å¸¸è·³è½¬</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping(&quot;/quick22&quot;)</span><br><span class="hljs-meta">@ResponseBody</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">quickMethod22</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, ParseException </span>&#123;<br>    <span class="hljs-comment">// è§£æå¼‚å¸¸æŠ›å‡º</span><br>    SimpleDateFormat simpleDateFormat = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>    simpleDateFormat.parse(<span class="hljs-string">&quot;abcde&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-Spring-JdbcTemplate"><a href="#4-Spring-JdbcTemplate" class="headerlink" title="4. Spring JdbcTemplate"></a>4. Spring JdbcTemplate</h2><p>ç”¨å¾—ä¸æ˜¯å¾ˆå¤šï¼Œä¸€èˆ¬è¿˜æ˜¯ç”¨ Mybatis/ibatis ç­‰ORMæ¡†æ¶å®ç°</p><h3 id="4-1-JdbcTemplate-æ¦‚è¿°"><a href="#4-1-JdbcTemplate-æ¦‚è¿°" class="headerlink" title="4.1 JdbcTemplate æ¦‚è¿°"></a>4.1 JdbcTemplate æ¦‚è¿°</h3><p>å®ƒæ˜¯springæ¡†æ¶ä¸­æä¾›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯å¯¹åŸå§‹ç¹ççš„Jdbc APIå¯¹è±¡çš„ç®€å•å°è£…ã€‚springæ¡†æ¶ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šçš„æ“ä½œæ¨¡æ¿ç±»ã€‚</p><p>ä¾‹å¦‚ï¼šæ“ä½œå…³ç³»å‹æ•°æ®çš„JdbcTemplateå’ŒHibernateTemplateï¼Œæ“ä½œnosqlæ•°æ®åº“çš„RedisTemplateï¼Œæ“ä½œæ¶ˆæ¯é˜Ÿåˆ—çš„JmsTemplateç­‰ç­‰ã€‚</p><h3 id="4-2-JdbcTemplate-å¼€å‘æ­¥éª¤"><a href="#4-2-JdbcTemplate-å¼€å‘æ­¥éª¤" class="headerlink" title="4.2 JdbcTemplate å¼€å‘æ­¥éª¤"></a>4.2 JdbcTemplate å¼€å‘æ­¥éª¤</h3><p>â‘ å¯¼å…¥spring-jdbcå’Œspring-txåæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¯¼å…¥springçš„jdbcåæ ‡--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--å¯¼å…¥springçš„txåæ ‡--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-tx<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡åˆ›å»ºæ•°æ®åº“è¡¨å’Œå®ä½“</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-22-20210710.png"></p><p>â‘¢åˆ›å»ºJdbcTemplateå¯¹è±¡</p><p>â‘£æ‰§è¡Œæ•°æ®åº“æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//1ã€åˆ›å»ºæ•°æ®æºå¯¹è±¡</span><br>ComboPooledDataSource dataSource = <span class="hljs-keyword">new</span> ComboPooledDataSource();<br>dataSource.setDriverClass(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>dataSource.setJdbcUrl(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>);<br>dataSource.setUser(<span class="hljs-string">&quot;root&quot;</span>);<br>dataSource.setPassword(<span class="hljs-string">&quot;root&quot;</span>);<br><span class="hljs-comment">//2ã€åˆ›å»ºJdbcTemplateå¯¹è±¡</span><br>JdbcTemplate jdbcTemplate = <span class="hljs-keyword">new</span> JdbcTemplate();<br><span class="hljs-comment">//3ã€è®¾ç½®æ•°æ®æºç»™JdbcTemplate</span><br>jdbcTemplate.setDataSource(dataSource);<br><span class="hljs-comment">//4ã€æ‰§è¡Œæ“ä½œ</span><br>jdbcTemplate.update(<span class="hljs-string">&quot;insert into account values(?,?)&quot;</span>,<span class="hljs-string">&quot;tom&quot;</span>,<span class="hljs-number">5000</span>);<br></code></pre></td></tr></table></figure><h3 id="4-3-Spring-äº§ç”Ÿ-JdbcTemplate-å¯¹è±¡"><a href="#4-3-Spring-äº§ç”Ÿ-JdbcTemplate-å¯¹è±¡" class="headerlink" title="4.3 Spring äº§ç”Ÿ JdbcTemplate å¯¹è±¡"></a>4.3 Spring äº§ç”Ÿ JdbcTemplate å¯¹è±¡</h3><p>æˆ‘ä»¬å¯ä»¥å°†JdbcTemplateçš„åˆ›å»ºæƒäº¤ç»™Springï¼Œå°†æ•°æ®æºDataSourceçš„åˆ›å»ºæƒä¹Ÿäº¤ç»™Springï¼Œåœ¨Springå®¹å™¨å†…éƒ¨å°†æ•°æ®æºDataSourceæ³¨å…¥åˆ°JdbcTemplateæ¨¡ç‰ˆå¯¹è±¡ä¸­ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--æ•°æ®æºDataSource--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClass&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;jdbcUrl&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;jdbc:mysql:///test&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;user&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!--JdbcTemplate--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;jdbcTemplate&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä»å®¹å™¨ä¸­è·å¾—JdbcTemplateè¿›è¡Œæ·»åŠ æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSpringJdbcTemplate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> PropertyVetoException </span>&#123;<br>    ApplicationContext applicationContext = <span class="hljs-keyword">new</span> ClassPathXmlApplicationContext(<span class="hljs-string">&quot;applicationContext.xml&quot;</span>);<br>    JdbcTemplate jdbcTemplate = applicationContext.getBean(JdbcTemplate.class);<br>    jdbcTemplate.update(<span class="hljs-string">&quot;insert into account values(?,?)&quot;</span>,<span class="hljs-string">&quot;lucy&quot;</span>,<span class="hljs-number">5000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-4-JdbcTemplateçš„å¸¸ç”¨æ“ä½œ"><a href="#4-4-JdbcTemplateçš„å¸¸ç”¨æ“ä½œ" class="headerlink" title="4.4 JdbcTemplateçš„å¸¸ç”¨æ“ä½œ"></a>4.4 JdbcTemplateçš„å¸¸ç”¨æ“ä½œ</h3><ul><li><p>æ’å…¥æ“ä½œï¼šè§ä¸Šé¢çš„æ ·ä¾‹</p></li><li><p>ä¿®æ”¹æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcTemplateCRUDTest</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-comment">//æµ‹è¯•ä¿®æ”¹æ“ä½œ</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpdate</span><span class="hljs-params">()</span></span>&#123;<br>        jdbcTemplate.update(<span class="hljs-string">&quot;update account set money=? where name=?&quot;</span>,<span class="hljs-number">1000</span>,<span class="hljs-string">&quot;tom&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelete</span><span class="hljs-params">()</span></span>&#123;<br>    jdbcTemplate.update(<span class="hljs-string">&quot;delete from account where name=?&quot;</span>,<span class="hljs-string">&quot;tom&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢å…¨éƒ¨æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testQueryAll</span><span class="hljs-params">()</span></span>&#123;<br>    List&lt;Account&gt; accounts = jdbcTemplate.query(<span class="hljs-string">&quot;select * from account&quot;</span>, <span class="hljs-keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class));<br>    <span class="hljs-keyword">for</span> (Account account : accounts) &#123;<br>        System.out.println(account.getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢å•ä¸ªæ•°æ®æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-comment">//æµ‹è¯•æŸ¥è¯¢å•ä¸ªå¯¹è±¡æ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testQueryOne</span><span class="hljs-params">()</span></span>&#123;<br>    Account account = jdbcTemplate.queryForObject(<span class="hljs-string">&quot;select * from account where name=?&quot;</span>, <span class="hljs-keyword">new</span> BeanPropertyRowMapper&lt;Account&gt;(Account.class), <span class="hljs-string">&quot;tom&quot;</span>);<br>    System.out.println(account.getName());<br>&#125;<br><span class="hljs-meta">@Test</span><br><span class="hljs-comment">//æµ‹è¯•æŸ¥è¯¢å•ä¸ªç®€å•æ•°æ®æ“ä½œ(èšåˆæŸ¥è¯¢)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testQueryCount</span><span class="hljs-params">()</span></span>&#123;<br>    Long aLong = jdbcTemplate.queryForObject(<span class="hljs-string">&quot;select count(*) from account&quot;</span>, Long.class);<br>    System.out.println(aLong);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><h3 id="4-5-è¦ç‚¹æ€»ç»“"><a href="#4-5-è¦ç‚¹æ€»ç»“" class="headerlink" title="4.5 è¦ç‚¹æ€»ç»“"></a>4.5 è¦ç‚¹æ€»ç»“</h3><p>â‘ å¯¼å…¥spring-jdbcå’Œspring-txåæ ‡</p><p>â‘¡åˆ›å»ºæ•°æ®åº“è¡¨å’Œå®ä½“</p><p>â‘¢åˆ›å»ºJdbcTemplateå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">JdbcTemplate jdbcTemplate = <span class="hljs-keyword">new</span> JdbcTemplate();<br><br>jdbcTemplate.setDataSource(dataSource);<br></code></pre></td></tr></table></figure><p>â‘£æ‰§è¡Œæ•°æ®åº“æ“ä½œ</p><p>  æ›´æ–°æ“ä½œï¼š</p><p>â€‹    jdbcTemplate.update (sql,params)</p><p>  æŸ¥è¯¢æ“ä½œï¼š</p><p>â€‹    jdbcTemplate.query (sql,Mapper,params)</p><p>â€‹    jdbcTemplate.queryForObject(sql,Mapper,params)</p><h2 id="5-Spring-çš„AOP"><a href="#5-Spring-çš„AOP" class="headerlink" title="5. Spring çš„AOP"></a>5. Spring çš„AOP</h2><h3 id="5-1-AOP-ç®€ä»‹"><a href="#5-1-AOP-ç®€ä»‹" class="headerlink" title="5.1 AOP ç®€ä»‹"></a>5.1 AOP ç®€ä»‹</h3><h4 id="5-1-1-AOP-æ˜¯ä»€ä¹ˆ"><a href="#5-1-1-AOP-æ˜¯ä»€ä¹ˆ" class="headerlink" title="5.1.1 AOP æ˜¯ä»€ä¹ˆ"></a>5.1.1 AOP æ˜¯ä»€ä¹ˆ</h4><p><strong>AOP</strong> ä¸º <strong>A</strong>spect <strong>O</strong>riented <strong>P</strong>rogramming çš„ç¼©å†™ï¼Œæ„æ€ä¸º<font color=#FF0000>é¢å‘åˆ‡é¢ç¼–ç¨‹</font>ï¼Œæ˜¯é€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§<font color=#FF0000>æŠ€æœ¯</font>ã€‚</p><p>AOP æ˜¯ OOP çš„å»¶ç»­ï¼Œæ˜¯è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªçƒ­ç‚¹ï¼Œä¹Ÿæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§è¡ç”ŸèŒƒå‹ã€‚åˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚</p><h4 id="5-1-2-AOP-çš„ä½œç”¨å’Œä¼˜åŠ¿"><a href="#5-1-2-AOP-çš„ä½œç”¨å’Œä¼˜åŠ¿" class="headerlink" title="5.1.2 AOP çš„ä½œç”¨å’Œä¼˜åŠ¿"></a>5.1.2 AOP çš„ä½œç”¨å’Œä¼˜åŠ¿</h4><ul><li><p>ä½œç”¨ï¼šåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œåœ¨ä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹å¯¹æ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¢å¼º</p></li><li><p>ä¼˜åŠ¿ï¼šå‡å°‘é‡å¤ä»£ç ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œå¹¶ä¸”ä¾¿äºç»´æŠ¤</p></li></ul><h4 id="5-1-3-AOP-çš„åº•å±‚å®ç°"><a href="#5-1-3-AOP-çš„åº•å±‚å®ç°" class="headerlink" title="5.1.3 AOP çš„åº•å±‚å®ç°"></a>5.1.3 AOP çš„åº•å±‚å®ç°</h4><p>å®é™…ä¸Šï¼ŒAOP çš„åº•å±‚æ˜¯é€šè¿‡ Spring æä¾›çš„çš„åŠ¨æ€ä»£ç†æŠ€æœ¯å®ç°çš„ã€‚åœ¨è¿è¡ŒæœŸé—´ï¼ŒSpringé€šè¿‡åŠ¨æ€ä»£ç†æŠ€æœ¯åŠ¨æ€çš„ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡æ–¹æ³•æ‰§è¡Œæ—¶è¿›è¡Œå¢å¼ºåŠŸèƒ½çš„ä»‹å…¥ï¼Œåœ¨å»è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼Œä»è€Œå®ŒæˆåŠŸèƒ½çš„å¢å¼ºã€‚</p><h4 id="5-1-4-AOP-çš„åŠ¨æ€ä»£ç†æŠ€æœ¯"><a href="#5-1-4-AOP-çš„åŠ¨æ€ä»£ç†æŠ€æœ¯" class="headerlink" title="5.1.4 AOP çš„åŠ¨æ€ä»£ç†æŠ€æœ¯"></a>5.1.4 AOP çš„åŠ¨æ€ä»£ç†æŠ€æœ¯</h4><p>å¸¸ç”¨çš„åŠ¨æ€ä»£ç†æŠ€æœ¯</p><ul><li><p>JDK ä»£ç† : åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†æŠ€æœ¯</p></li><li><p>cglib ä»£ç†ï¼šåŸºäºçˆ¶ç±»çš„åŠ¨æ€ä»£ç†æŠ€æœ¯</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-26-20210711.png"></p><h4 id="5-1-5-JDKçš„åŠ¨æ€ä»£ç†æŠ€æœ¯"><a href="#5-1-5-JDKçš„åŠ¨æ€ä»£ç†æŠ€æœ¯" class="headerlink" title="5.1.5 JDKçš„åŠ¨æ€ä»£ç†æŠ€æœ¯"></a>5.1.5 JDKçš„åŠ¨æ€ä»£ç†æŠ€æœ¯</h4><p>è¯¦ç»†çš„è§£é‡Šè¯·è§è¿™ä¸€ç¯‡blogï¼š<a href="http://lihengxu.cn/2021/04/03/JUnit%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E3%80%81%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E3%80%81JDK8%E6%96%B0%E7%89%B9%E6%80%A7/#%E7%AC%AC%E5%9B%9B%E7%AB%A0-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">åŠ¨æ€ä»£ç†</a></p><p>â‘ ç›®æ ‡ç±»æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¡ç›®æ ‡ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Target</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Target running....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¢åŠ¨æ€ä»£ç†ä»£ç </p><p>â‘£ è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">Target target = <span class="hljs-keyword">new</span> Target(); <span class="hljs-comment">//åˆ›å»ºç›®æ ‡å¯¹è±¡</span><br><span class="hljs-comment">//åˆ›å»ºä»£ç†å¯¹è±¡</span><br>TargetInterface proxy = (TargetInterface) Proxy.newProxyInstance(<br>    target.getClass().getClassLoader(),<br>    target.getClass().getInterfaces(),<br>    <span class="hljs-keyword">new</span> InvocationHandler() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> </span><br><span class="hljs-function">                <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;å‰ç½®å¢å¼ºä»£ç ...&quot;</span>);<br>            Object invoke = method.invoke(target, args);<br>            System.out.println(<span class="hljs-string">&quot;åç½®å¢å¼ºä»£ç ...&quot;</span>);<br>            <span class="hljs-keyword">return</span> invoke;<br>    &#125;<br>&#125;<br>);<br><span class="hljs-comment">// æµ‹è¯•,å½“è°ƒç”¨æ¥å£çš„ä»»ä½•æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡çš„ä»£ç éƒ½æ— åºä¿®æ”¹</span><br>proxy.method();<br></code></pre></td></tr></table></figure><h4 id="5-1-6-cglib-çš„åŠ¨æ€ä»£ç†"><a href="#5-1-6-cglib-çš„åŠ¨æ€ä»£ç†" class="headerlink" title="5.1.6 cglib çš„åŠ¨æ€ä»£ç†"></a>5.1.6 cglib çš„åŠ¨æ€ä»£ç†</h4><p>è¯¥åŒ…å·²ç»é›†æˆåˆ°spring-coreä¸­äº†ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨</p><p>â‘ ç›®æ ‡ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Target</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Target running....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¡åŠ¨æ€ä»£ç†ä»£ç </p><p>â‘¢è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//åˆ›å»ºç›®æ ‡å¯¹è±¡</span><br>Target target = <span class="hljs-keyword">new</span> Target(); <br><span class="hljs-comment">//1.åˆ›å»ºå¢å¼ºå™¨</span><br>Enhancer enhancer = <span class="hljs-keyword">new</span> Enhancer(); <br><span class="hljs-comment">//2.è®¾ç½®çˆ¶ç±»</span><br>enhancer.setSuperclass(Target.class); <br><span class="hljs-comment">//3.è®¾ç½®å›è°ƒ</span><br>enhancer.setCallback(<span class="hljs-keyword">new</span> MethodInterceptor() &#123; <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">intercept</span><span class="hljs-params">(Object proxy, Method method, Object[] objects, </span></span><br><span class="hljs-function"><span class="hljs-params">    MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable </span>&#123;<br>        <span class="hljs-comment">// æ‰§è¡Œå‰ç½®</span><br>        System.out.println(<span class="hljs-string">&quot;å‰ç½®ä»£ç å¢å¼º....&quot;</span>);<br>        Object invoke = method.invoke(target, objects);<br>        <span class="hljs-comment">// æ‰§è¡Œåç½®</span><br>        System.out.println(<span class="hljs-string">&quot;åç½®ä»£ç å¢å¼º....&quot;</span>);<br>        <span class="hljs-keyword">return</span> invoke;<br>    &#125;<br>&#125;);<br>Target proxy = (Target) enhancer.create(); <span class="hljs-comment">//åˆ›å»ºä»£ç†å¯¹è±¡</span><br><br></code></pre></td></tr></table></figure><p>â‘¢è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ–¹æ³•æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æµ‹è¯•,å½“è°ƒç”¨æ¥å£çš„ä»»ä½•æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡çš„ä»£ç éƒ½æ— åºä¿®æ”¹</span><br>proxy.method();<br></code></pre></td></tr></table></figure><h4 id="5-1-7-AOP-ç›¸å…³æ¦‚å¿µ"><a href="#5-1-7-AOP-ç›¸å…³æ¦‚å¿µ" class="headerlink" title="5.1.7 AOP ç›¸å…³æ¦‚å¿µ"></a>5.1.7 AOP ç›¸å…³æ¦‚å¿µ</h4><p>Spring çš„ AOP å®ç°åº•å±‚å°±æ˜¯å¯¹ä¸Šé¢çš„åŠ¨æ€ä»£ç†çš„ä»£ç è¿›è¡Œäº†å°è£…ï¼Œå°è£…åæˆ‘ä»¬åªéœ€è¦å¯¹éœ€è¦å…³æ³¨çš„éƒ¨åˆ†è¿›è¡Œä»£ç ç¼–å†™ï¼Œå¹¶é€šè¿‡é…ç½®çš„æ–¹å¼å®ŒæˆæŒ‡å®šç›®æ ‡çš„æ–¹æ³•å¢å¼ºã€‚</p><p>åœ¨æ­£å¼è®²è§£ AOP çš„æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»ç†è§£ AOP çš„ç›¸å…³æœ¯è¯­ï¼Œå¸¸ç”¨çš„æœ¯è¯­å¦‚ä¸‹ï¼š</p><ul><li><p>Targetï¼ˆç›®æ ‡å¯¹è±¡ï¼‰ï¼šä»£ç†çš„ç›®æ ‡å¯¹è±¡</p></li><li><p>Proxy ï¼ˆä»£ç†ï¼‰ï¼šä¸€ä¸ªç±»è¢« AOP ç»‡å…¥å¢å¼ºåï¼Œå°±äº§ç”Ÿä¸€ä¸ªç»“æœä»£ç†ç±»</p></li><li><p>Joinpointï¼ˆè¿æ¥ç‚¹ï¼‰ï¼šæ‰€è°“è¿æ¥ç‚¹æ˜¯æŒ‡é‚£äº›è¢«æ‹¦æˆªåˆ°çš„ç‚¹ã€‚åœ¨springä¸­,è¿™äº›ç‚¹æŒ‡çš„æ˜¯æ–¹æ³•ï¼Œå› ä¸ºspringåªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹</p></li><li><p>Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰ï¼šæ‰€è°“åˆ‡å…¥ç‚¹æ˜¯æŒ‡æˆ‘ä»¬è¦å¯¹å“ªäº› Joinpoint è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰</p></li><li><p>Adviceï¼ˆé€šçŸ¥/ å¢å¼ºï¼‰ï¼šæ‰€è°“é€šçŸ¥æ˜¯æŒ‡æ‹¦æˆªåˆ° Joinpoint ä¹‹åæ‰€è¦åšçš„äº‹æƒ…å°±æ˜¯é€šçŸ¥</p></li><li><p>Aspectï¼ˆåˆ‡é¢ï¼‰ï¼šæ˜¯åˆ‡å…¥ç‚¹å’Œé€šçŸ¥ï¼ˆå¼•ä»‹ï¼‰çš„ç»“åˆ</p></li><li><p>Weavingï¼ˆç»‡å…¥ï¼‰ï¼šæ˜¯æŒ‡æŠŠå¢å¼ºåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚springé‡‡ç”¨åŠ¨æ€ä»£ç†ç»‡å…¥ï¼Œè€ŒAspectJé‡‡ç”¨ç¼–è¯‘æœŸç»‡å…¥å’Œç±»è£…è½½æœŸç»‡å…¥</p></li></ul><h4 id="5-1-8-AOP-å¼€å‘æ˜ç¡®çš„äº‹é¡¹"><a href="#5-1-8-AOP-å¼€å‘æ˜ç¡®çš„äº‹é¡¹" class="headerlink" title="5.1.8 AOP å¼€å‘æ˜ç¡®çš„äº‹é¡¹"></a>5.1.8 AOP å¼€å‘æ˜ç¡®çš„äº‹é¡¹</h4><ol><li><p>éœ€è¦ç¼–å†™çš„å†…å®¹</p><ul><li><p>ç¼–å†™æ ¸å¿ƒä¸šåŠ¡ä»£ç ï¼ˆç›®æ ‡ç±»çš„ç›®æ ‡æ–¹æ³•ï¼‰</p></li><li><p>ç¼–å†™åˆ‡é¢ç±»ï¼Œåˆ‡é¢ç±»ä¸­æœ‰é€šçŸ¥(å¢å¼ºåŠŸèƒ½æ–¹æ³•)</p></li><li><p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®ç»‡å…¥å…³ç³»ï¼Œå³å°†å“ªäº›é€šçŸ¥ä¸å“ªäº›è¿æ¥ç‚¹è¿›è¡Œç»“åˆ</p></li></ul></li><li><p>AOP æŠ€æœ¯å®ç°çš„å†…å®¹</p><p>Spring æ¡†æ¶ç›‘æ§åˆ‡å…¥ç‚¹æ–¹æ³•çš„æ‰§è¡Œã€‚ä¸€æ—¦ç›‘æ§åˆ°åˆ‡å…¥ç‚¹æ–¹æ³•è¢«è¿è¡Œï¼Œä½¿ç”¨ä»£ç†æœºåˆ¶ï¼ŒåŠ¨æ€åˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œæ ¹æ®é€šçŸ¥ç±»åˆ«ï¼Œåœ¨ä»£ç†å¯¹è±¡çš„å¯¹åº”ä½ç½®ï¼Œå°†é€šçŸ¥å¯¹åº”çš„åŠŸèƒ½ç»‡å…¥ï¼Œå®Œæˆå®Œæ•´çš„ä»£ç é€»è¾‘è¿è¡Œã€‚</p></li><li><p>AOP åº•å±‚ä½¿ç”¨å“ªç§ä»£ç†æ–¹å¼</p><p>åœ¨ spring ä¸­ï¼Œæ¡†æ¶ä¼šæ ¹æ®ç›®æ ‡ç±»æ˜¯å¦å®ç°äº†æ¥å£æ¥å†³å®šé‡‡ç”¨å“ªç§åŠ¨æ€ä»£ç†çš„æ–¹å¼ã€‚</p><ul><li>æœ‰æ¥å£ï¼šJDK</li><li>æ— æ¥å£ï¼šcglib</li></ul></li></ol><h4 id="5-1-9-è¦ç‚¹æ€»ç»“"><a href="#5-1-9-è¦ç‚¹æ€»ç»“" class="headerlink" title="5.1.9 è¦ç‚¹æ€»ç»“"></a>5.1.9 è¦ç‚¹æ€»ç»“</h4><ul><li><p>aopï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹</p></li><li><p>aopåº•å±‚å®ç°ï¼šåŸºäºJDKçš„åŠ¨æ€ä»£ç† å’Œ åŸºäºCglibçš„åŠ¨æ€ä»£ç†</p></li><li><p>aopçš„é‡ç‚¹æ¦‚å¿µï¼š</p><ul><li>Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰ï¼šè¢«å¢å¼ºçš„æ–¹æ³•</li><li>Adviceï¼ˆé€šçŸ¥/ å¢å¼ºï¼‰ï¼šå°è£…å¢å¼ºä¸šåŠ¡é€»è¾‘çš„æ–¹æ³•</li><li>Aspectï¼ˆåˆ‡é¢ï¼‰ï¼šåˆ‡ç‚¹+é€šçŸ¥</li><li>Weavingï¼ˆç»‡å…¥ï¼‰ï¼šå°†åˆ‡ç‚¹ä¸é€šçŸ¥ç»“åˆçš„è¿‡ç¨‹</li></ul></li><li><p>å¼€å‘æ˜ç¡®äº‹é¡¹ï¼š</p></li></ul><p>â€‹    è°æ˜¯åˆ‡ç‚¹ï¼ˆåˆ‡ç‚¹è¡¨è¾¾å¼é…ç½®ï¼‰</p><p>â€‹    è°æ˜¯é€šçŸ¥ï¼ˆåˆ‡é¢ç±»ä¸­çš„å¢å¼ºæ–¹æ³•ï¼‰</p><p>â€‹    å°†åˆ‡ç‚¹å’Œé€šçŸ¥è¿›è¡Œç»‡å…¥é…ç½®</p><h3 id="5-2-åŸºäº-XML-çš„-AOP-å¼€å‘"><a href="#5-2-åŸºäº-XML-çš„-AOP-å¼€å‘" class="headerlink" title="5.2 åŸºäº XML çš„ AOP å¼€å‘"></a>5.2 åŸºäº XML çš„ AOP å¼€å‘</h3><h4 id="5-2-1-å¿«é€Ÿå…¥é—¨"><a href="#5-2-1-å¿«é€Ÿå…¥é—¨" class="headerlink" title="5.2.1 å¿«é€Ÿå…¥é—¨"></a>5.2.1 å¿«é€Ÿå…¥é—¨</h4><p>â‘ å¯¼å…¥ AOP ç›¸å…³åæ ‡</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¯¼å…¥springçš„contextåæ ‡ï¼Œcontextä¾èµ–aop--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.0.5.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!-- aspectjçš„ç»‡å…¥ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.aspectj<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aspectjweaver<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.8.13<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡åˆ›å»ºç›®æ ‡æ¥å£å’Œç›®æ ‡ç±»ï¼ˆå†…éƒ¨æœ‰åˆ‡ç‚¹ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Target</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Target running....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¢åˆ›å»ºåˆ‡é¢ç±»ï¼ˆå†…éƒ¨æœ‰å¢å¼ºæ–¹æ³•ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;<br>    <span class="hljs-comment">//å‰ç½®å¢å¼ºæ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å‰ç½®ä»£ç å¢å¼º.....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘£å°†ç›®æ ‡ç±»å’Œåˆ‡é¢ç±»çš„å¯¹è±¡åˆ›å»ºæƒäº¤ç»™ spring</p><p>applicationContext.xml ä¸­é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--é…ç½®ç›®æ ‡ç±»--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;target&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.aop.Target&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!--é…ç½®åˆ‡é¢ç±»--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAspect&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.itheima.aop.MyAspect&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¤åœ¨ applicationContext.xml ä¸­é…ç½®ç»‡å…¥å…³ç³»</p><p>å¯¼å…¥aopå‘½åç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/context</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/aop</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/aop/spring-aop.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>é…ç½®åˆ‡ç‚¹è¡¨è¾¾å¼å’Œå‰ç½®å¢å¼ºçš„ç»‡å…¥å…³ç³»</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--å¼•ç”¨myAspectçš„Beanä¸ºåˆ‡é¢å¯¹è±¡--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;myAspect&quot;</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- åˆ‡é¢ = åˆ‡ç‚¹ + é€šçŸ¥ --&gt;</span><br>        <span class="hljs-comment">&lt;!-- é…ç½®Targetçš„methodæ–¹æ³•æ‰§è¡Œæ—¶è¦è¿›è¡ŒmyAspectçš„beforeæ–¹æ³•å‰ç½®å¢å¼º --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:before</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;before&quot;</span> <span class="hljs-attr">pointcut</span>=<span class="hljs-string">&quot;execution(public void com.itheima.aop.Target.method())&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:before</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¥æµ‹è¯•ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AopTest</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TargetInterface target;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;<br>        target.method();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-2-2-AOP-é…ç½®è¯¦è§£"><a href="#5-2-2-AOP-é…ç½®è¯¦è§£" class="headerlink" title="5.2.2 AOP é…ç½®è¯¦è§£"></a>5.2.2 AOP é…ç½®è¯¦è§£</h4><h5 id="1-åˆ‡ç‚¹è¡¨è¾¾å¼çš„å†™æ³•"><a href="#1-åˆ‡ç‚¹è¡¨è¾¾å¼çš„å†™æ³•" class="headerlink" title="1. åˆ‡ç‚¹è¡¨è¾¾å¼çš„å†™æ³•"></a>1. åˆ‡ç‚¹è¡¨è¾¾å¼çš„å†™æ³•</h5><p>è¡¨è¾¾å¼è¯­æ³•ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">([ä¿®é¥°ç¬¦] è¿”å›å€¼ç±»å‹ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°)</span></span>)<br></code></pre></td></tr></table></figure><ul><li><p>è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥çœç•¥</p></li><li><p>è¿”å›å€¼ç±»å‹ã€åŒ…åã€ç±»åã€æ–¹æ³•åå¯ä»¥ä½¿ç”¨æ˜Ÿå·* ä»£è¡¨ä»»æ„</p></li><li><p>åŒ…åä¸ç±»åä¹‹é—´ä¸€ä¸ªç‚¹ . ä»£è¡¨å½“å‰åŒ…ä¸‹çš„ç±»ï¼Œä¸¤ä¸ªç‚¹ .. è¡¨ç¤ºå½“å‰åŒ…åŠå…¶å­åŒ…ä¸‹çš„ç±»</p></li><li><p>å‚æ•°åˆ—è¡¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç‚¹ .. è¡¨ç¤ºä»»æ„ä¸ªæ•°ï¼Œä»»æ„ç±»å‹çš„å‚æ•°åˆ—è¡¨</p></li></ul><p>ä¾‹å¦‚ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">(public void com.itheima.aop.Target.method()</span></span>)<br><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">(void com.itheima.aop.Target.*(..)</span></span>)<br><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">(* com.itheima.aop.*.*(..)</span></span>)<br><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">(* com.itheima.aop..*.*(..)</span></span>)<br><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">(* *..*.*(..)</span></span>)<br></code></pre></td></tr></table></figure><h5 id="2-é€šçŸ¥çš„ç±»å‹"><a href="#2-é€šçŸ¥çš„ç±»å‹" class="headerlink" title="2. é€šçŸ¥çš„ç±»å‹"></a>2. é€šçŸ¥çš„ç±»å‹</h5><p>é€šçŸ¥çš„é…ç½®è¯­æ³•ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;aop:é€šçŸ¥ç±»å‹ method=â€œåˆ‡é¢ç±»ä¸­æ–¹æ³•åâ€ pointcut=â€œåˆ‡ç‚¹è¡¨è¾¾å¼&quot;&gt;&lt;/aop:é€šçŸ¥ç±»å‹&gt;<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-27-20210711.png"></p><h5 id="3-åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–"><a href="#3-åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–" class="headerlink" title="3. åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–"></a>3. åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–</h5><p>å½“å¤šä¸ªå¢å¼ºçš„åˆ‡ç‚¹è¡¨è¾¾å¼ç›¸åŒæ—¶ï¼Œå¯ä»¥å°†åˆ‡ç‚¹è¡¨è¾¾å¼è¿›è¡ŒæŠ½å–ï¼Œåœ¨å¢å¼ºä¸­ä½¿ç”¨ pointcut-ref å±æ€§ä»£æ›¿ pointcut å±æ€§æ¥å¼•ç”¨æŠ½å–åçš„åˆ‡ç‚¹è¡¨è¾¾å¼ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--å¼•ç”¨myAspectçš„Beanä¸ºåˆ‡é¢å¯¹è±¡--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;myAspect&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myPointcut&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.itheima.aop.*.*(..))&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:before</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;before&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;myPointcut&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:before</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="5-2-3-è¦ç‚¹æ€»ç»“"><a href="#5-2-3-è¦ç‚¹æ€»ç»“" class="headerlink" title="5.2.3 è¦ç‚¹æ€»ç»“"></a>5.2.3 è¦ç‚¹æ€»ç»“</h4><ul><li><p>aopç»‡å…¥çš„é…ç½®</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:aspect</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;åˆ‡é¢ç±»&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">aop:before</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;é€šçŸ¥æ–¹æ³•åç§°&quot;</span> <span class="hljs-attr">pointcut</span>= <span class="hljs-string">&quot;åˆ‡ç‚¹è¡¨è¾¾å¼&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspect</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>é€šçŸ¥çš„ç±»å‹ï¼šå‰ç½®é€šçŸ¥ã€åç½®é€šçŸ¥ã€ç¯ç»•é€šçŸ¥ã€å¼‚å¸¸æŠ›å‡ºé€šçŸ¥ã€æœ€ç»ˆé€šçŸ¥</p></li><li><p>åˆ‡ç‚¹è¡¨è¾¾å¼çš„å†™æ³•ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">execution</span><span class="hljs-params">([ä¿®é¥°ç¬¦] è¿”å›å€¼ç±»å‹ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°)</span></span>)<br></code></pre></td></tr></table></figure></li></ul><h3 id="5-3-åŸºäºæ³¨è§£çš„-AOP-å¼€å‘"><a href="#5-3-åŸºäºæ³¨è§£çš„-AOP-å¼€å‘" class="headerlink" title="5.3 åŸºäºæ³¨è§£çš„ AOP å¼€å‘"></a>5.3 åŸºäºæ³¨è§£çš„ AOP å¼€å‘</h3><h4 id="5-3-1-å¿«é€Ÿå…¥é—¨"><a href="#5-3-1-å¿«é€Ÿå…¥é—¨" class="headerlink" title="5.3.1 å¿«é€Ÿå…¥é—¨"></a>5.3.1 å¿«é€Ÿå…¥é—¨</h4><p>åŸºäºæ³¨è§£çš„aopå¼€å‘æ­¥éª¤ï¼š</p><p>â‘ åˆ›å»ºç›®æ ‡æ¥å£å’Œç›®æ ‡ç±»ï¼ˆå†…éƒ¨æœ‰åˆ‡ç‚¹ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Target</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Target running....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¡åˆ›å»ºåˆ‡é¢ç±»ï¼ˆå†…éƒ¨æœ‰å¢å¼ºæ–¹æ³•ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;<br>    <span class="hljs-comment">//å‰ç½®å¢å¼ºæ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å‰ç½®ä»£ç å¢å¼º.....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¢å°†ç›®æ ‡ç±»å’Œåˆ‡é¢ç±»çš„å¯¹è±¡åˆ›å»ºæƒäº¤ç»™ spring</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component(&quot;target&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Target</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">TargetInterface</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;Target running....&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-meta">@Component(&quot;myAspect&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å‰ç½®ä»£ç å¢å¼º.....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘£åœ¨åˆ‡é¢ç±»ä¸­ä½¿ç”¨æ³¨è§£é…ç½®ç»‡å…¥å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component(&quot;myAspect&quot;)</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;<br>    <span class="hljs-meta">@Before(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å‰ç½®ä»£ç å¢å¼º.....&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â‘¤åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç»„ä»¶æ‰«æå’Œ AOP çš„è‡ªåŠ¨ä»£ç†</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--ç»„ä»¶æ‰«æ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.itheima.aop&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!--aopçš„è‡ªåŠ¨ä»£ç†--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:aspectj-autoproxy</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¥æµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="hljs-meta">@ContextConfiguration(&quot;classpath:applicationContext.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AopTest</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TargetInterface target;<br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;<br>        target.method();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-3-2-æ³¨è§£é…ç½®-AOP-è¯¦è§£"><a href="#5-3-2-æ³¨è§£é…ç½®-AOP-è¯¦è§£" class="headerlink" title="5.3.2 æ³¨è§£é…ç½® AOP è¯¦è§£"></a>5.3.2 æ³¨è§£é…ç½® AOP è¯¦è§£</h4><h5 id="1-æ³¨è§£é€šçŸ¥ç±»å‹"><a href="#1-æ³¨è§£é€šçŸ¥ç±»å‹" class="headerlink" title="1. æ³¨è§£é€šçŸ¥ç±»å‹"></a>1. æ³¨è§£é€šçŸ¥ç±»å‹</h5><p>é€šçŸ¥çš„é…ç½®è¯­æ³•ï¼š@é€šçŸ¥æ³¨è§£(<strong>â€œåˆ‡ç‚¹è¡¨è¾¾å¼â€</strong>)</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-28-20210712.png"></p><h5 id="2-åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–"><a href="#2-åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–" class="headerlink" title="2. åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–"></a>2. åˆ‡ç‚¹è¡¨è¾¾å¼çš„æŠ½å–</h5><p>åŒ xml é…ç½® aop ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ‡ç‚¹è¡¨è¾¾å¼æŠ½å–ã€‚æŠ½å–æ–¹å¼æ˜¯åœ¨åˆ‡é¢å†…å®šä¹‰æ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸Šä½¿ç”¨@Pointcutæ³¨è§£å®šä¹‰åˆ‡ç‚¹è¡¨è¾¾å¼ï¼Œç„¶ååœ¨åœ¨å¢å¼ºæ³¨è§£ä¸­è¿›è¡Œå¼•ç”¨ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">@<span class="hljs-meta">@Component(&quot;myAspect&quot;)</span><br><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAspect</span> </span>&#123;<br>    <span class="hljs-meta">@Before(&quot;MyAspect.myPoint()&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">before</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;å‰ç½®ä»£ç å¢å¼º.....&quot;</span>);<br>    &#125;<br>    <span class="hljs-meta">@Pointcut(&quot;execution(* com.itheima.aop.*.*(..))&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">myPoint</span><span class="hljs-params">()</span></span>&#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="5-3-3-è¦ç‚¹æ€»ç»“"><a href="#5-3-3-è¦ç‚¹æ€»ç»“" class="headerlink" title="5.3.3 è¦ç‚¹æ€»ç»“"></a>5.3.3 è¦ç‚¹æ€»ç»“</h4><ul><li>æ³¨è§£aopå¼€å‘æ­¥éª¤</li></ul><p>â‘ ä½¿ç”¨@Aspectæ ‡æ³¨åˆ‡é¢ç±»</p><p>â‘¡ä½¿ç”¨@é€šçŸ¥æ³¨è§£æ ‡æ³¨é€šçŸ¥æ–¹æ³•</p><p>â‘¢åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®aopè‡ªåŠ¨ä»£ç†&lt; aop:aspectj-autoproxy /&gt;</p><ul><li>é€šçŸ¥æ³¨è§£ç±»å‹ï¼šå‰ç½®é€šçŸ¥ã€åç½®é€šçŸ¥ã€ç¯ç»•é€šçŸ¥ã€å¼‚å¸¸æŠ›å‡ºé€šçŸ¥ã€æœ€ç»ˆé€šçŸ¥</li></ul><h2 id="6-Spring-å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"><a href="#6-Spring-å£°æ˜å¼äº‹åŠ¡æ§åˆ¶" class="headerlink" title="6. Spring å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"></a>6. Spring å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</h2><p>éœ€è¦ç†è§£ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶å’Œç”³æ˜å¼äº‹åŠ¡æ§åˆ¶çš„åŒºåˆ«</p><h3 id="6-1-ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶ç›¸å…³å¯¹è±¡"><a href="#6-1-ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶ç›¸å…³å¯¹è±¡" class="headerlink" title="6.1 ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶ç›¸å…³å¯¹è±¡"></a>6.1 ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶ç›¸å…³å¯¹è±¡</h3><h4 id="6-1-1-PlatformTransactionManagerï¼ˆäº†è§£ï¼‰"><a href="#6-1-1-PlatformTransactionManagerï¼ˆäº†è§£ï¼‰" class="headerlink" title="6.1.1 PlatformTransactionManagerï¼ˆäº†è§£ï¼‰"></a>6.1.1 PlatformTransactionManagerï¼ˆäº†è§£ï¼‰</h4><p>PlatformTransactionManager æ¥å£æ˜¯ spring çš„äº‹åŠ¡ç®¡ç†å™¨ï¼Œå®ƒé‡Œé¢æä¾›äº†æˆ‘ä»¬å¸¸ç”¨çš„æ“ä½œäº‹åŠ¡çš„æ–¹æ³•ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-29-20210713.png"></p><p><strong>æ³¨æ„ï¼š</strong></p><p>PlatformTransactionManager æ˜¯æ¥å£ç±»å‹ï¼Œä¸åŒçš„ Dao å±‚æŠ€æœ¯åˆ™æœ‰ä¸åŒçš„å®ç°ç±»ï¼Œä¾‹å¦‚ï¼šDao å±‚æŠ€æœ¯æ˜¯jdbc æˆ– mybatis æ—¶ï¼šorg.springframework.jdbc.datasource.DataSourceTransactionManager</p><p>Dao å±‚æŠ€æœ¯æ˜¯hibernateæ—¶ï¼šorg.springframework.orm.hibernate5.HibernateTransactionManager</p><h4 id="6-1-2-TransactionDefinition"><a href="#6-1-2-TransactionDefinition" class="headerlink" title="6.1.2 TransactionDefinition"></a>6.1.2 TransactionDefinition</h4><p>TransactionDefinition æ˜¯äº‹åŠ¡çš„å®šä¹‰ä¿¡æ¯å¯¹è±¡ï¼Œé‡Œé¢æœ‰å¦‚ä¸‹æ–¹æ³•ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-30-20210713.png"></p><ul><li>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«ï¼šè®¾ç½®éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥è§£å†³äº‹åŠ¡å¹¶å‘äº§ç”Ÿçš„é—®é¢˜ï¼Œå¦‚è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œè™šè¯»<ul><li>ISOLATION_DEFAULT</li><li>ISOLATION_READ_UNCOMMITTED</li><li>ISOLATION_READ_COMMITTED</li><li>ISOLATION_REPEATABLE_READ</li><li>ISOLATION_SERIALIZABLE</li></ul></li><li>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼šè§£å†³ä¸šåŠ¡æ–¹æ³•åœ¨è°ƒç”¨ä¸šåŠ¡æ–¹æ³•æ—¶ï¼Œä»–ä»¬ä¹‹é—´çš„äº‹åŠ¡ç»Ÿä¸€æ€§é—®é¢˜<ul><li><font color=#FF0000>REQUIREDï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŠ å…¥åˆ°è¿™ä¸ªäº‹åŠ¡ä¸­ã€‚ä¸€èˆ¬çš„é€‰æ‹©ï¼ˆé»˜è®¤å€¼ï¼‰</font></li><li><font color=#FF0000>SUPPORTSï¼šæ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œï¼ˆæ²¡æœ‰äº‹åŠ¡ï¼‰</font></li><li>MANDATORYï¼šä½¿ç”¨å½“å‰çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</li><li>REQUERS_NEWï¼šæ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰åœ¨äº‹åŠ¡ä¸­ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚</li><li>NOT_SUPPORTEDï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</li><li>NEVERï¼šä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠ›å‡ºå¼‚å¸¸</li><li>NESTEDï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œ REQUIRED ç±»ä¼¼çš„æ“ä½œ</li><li>è¶…æ—¶æ—¶é—´ï¼šé»˜è®¤å€¼æ˜¯-1ï¼Œæ²¡æœ‰è¶…æ—¶é™åˆ¶ã€‚å¦‚æœæœ‰ï¼Œä»¥ç§’ä¸ºå•ä½è¿›è¡Œè®¾ç½®</li><li>æ˜¯å¦åªè¯»ï¼šå»ºè®®æŸ¥è¯¢æ—¶è®¾ç½®ä¸ºåªè¯»</li></ul></li></ul><h4 id="6-1-3-TransactionStatus"><a href="#6-1-3-TransactionStatus" class="headerlink" title="6.1.3 TransactionStatus"></a>6.1.3 TransactionStatus</h4><p>TransactionStatus æ¥å£æä¾›çš„æ˜¯äº‹åŠ¡å…·ä½“çš„è¿è¡ŒçŠ¶æ€ï¼Œæ–¹æ³•ä»‹ç»å¦‚ä¸‹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSM-31-20210713.png"></p><h4 id="6-1-4-è¦ç‚¹æ€»ç»“"><a href="#6-1-4-è¦ç‚¹æ€»ç»“" class="headerlink" title="6.1.4 è¦ç‚¹æ€»ç»“"></a>6.1.4 è¦ç‚¹æ€»ç»“</h4><p>ç¼–ç¨‹å¼äº‹åŠ¡æ§åˆ¶ä¸‰å¤§å¯¹è±¡</p><ul><li><p>PlatformTransactionManagerï¼šæ¥å£ï¼ŒæŒ‡å®šäº‹åŠ¡æ§åˆ¶è¡Œä¸º</p></li><li><p>TransactionDefinitionï¼šå°è£…äº‹åŠ¡å‚æ•°ï¼Œéœ€è¦é…ç½®</p></li><li><p>TransactionStatusï¼šè¢«åŠ¨çš„å°è£…äº‹åŠ¡çŠ¶æ€ä¿¡æ¯çš„ï¼Œä¸éœ€è¦é…ç½®</p></li></ul><h3 id="6-2-åŸºäº-XML-çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"><a href="#6-2-åŸºäº-XML-çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶" class="headerlink" title="6.2 åŸºäº XML çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"></a>6.2 åŸºäº XML çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</h3><h4 id="6-2-1-ä»€ä¹ˆæ˜¯å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"><a href="#6-2-1-ä»€ä¹ˆæ˜¯å£°æ˜å¼äº‹åŠ¡æ§åˆ¶" class="headerlink" title="6.2.1 ä»€ä¹ˆæ˜¯å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"></a>6.2.1 ä»€ä¹ˆæ˜¯å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</h4><p>Spring çš„å£°æ˜å¼äº‹åŠ¡é¡¾åæ€ä¹‰å°±æ˜¯<font color=#FF0000>é‡‡ç”¨å£°æ˜çš„æ–¹å¼æ¥å¤„ç†äº‹åŠ¡</font>ã€‚è¿™é‡Œæ‰€è¯´çš„å£°æ˜ï¼Œå°±æ˜¯æŒ‡åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜ï¼Œç”¨åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­å£°æ˜å¼çš„å¤„ç†äº‹åŠ¡æ¥ä»£æ›¿ä»£ç å¼çš„å¤„ç†äº‹åŠ¡ã€‚</p><p><strong>ä½œç”¨ï¼š</strong></p><ul><li>äº‹åŠ¡ç®¡ç†ä¸ä¾µå…¥å¼€å‘çš„ç»„ä»¶ã€‚å…·ä½“æ¥è¯´ï¼Œä¸šåŠ¡é€»è¾‘å¯¹è±¡å°±ä¸ä¼šæ„è¯†åˆ°æ­£åœ¨äº‹åŠ¡ç®¡ç†ä¹‹ä¸­ï¼Œäº‹å®ä¸Šä¹Ÿåº”è¯¥å¦‚æ­¤ï¼Œå› ä¸ºäº‹åŠ¡ç®¡ç†æ˜¯å±äºç³»ç»Ÿå±‚é¢çš„æœåŠ¡ï¼Œè€Œä¸æ˜¯ä¸šåŠ¡é€»è¾‘çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æœæƒ³è¦æ”¹å˜äº‹åŠ¡ç®¡ç†ç­–åˆ’çš„è¯ï¼Œä¹Ÿåªéœ€è¦åœ¨å®šä¹‰æ–‡ä»¶ä¸­é‡æ–°é…ç½®å³å¯</li><li>åœ¨ä¸éœ€è¦äº‹åŠ¡ç®¡ç†çš„æ—¶å€™ï¼Œåªè¦åœ¨è®¾å®šæ–‡ä»¶ä¸Šä¿®æ”¹ä¸€ä¸‹ï¼Œå³å¯ç§»å»äº‹åŠ¡ç®¡ç†æœåŠ¡ï¼Œæ— éœ€æ”¹å˜ä»£ç é‡æ–°ç¼–è¯‘ï¼Œè¿™æ ·ç»´æŠ¤èµ·æ¥æå…¶æ–¹ä¾¿</li></ul><p><font color=#FF0000>Spring å£°æ˜å¼äº‹åŠ¡æ§åˆ¶åº•å±‚å°±æ˜¯AOP</font></p><h4 id="6-2-2-å£°æ˜å¼äº‹åŠ¡æ§åˆ¶çš„å®ç°"><a href="#6-2-2-å£°æ˜å¼äº‹åŠ¡æ§åˆ¶çš„å®ç°" class="headerlink" title="6.2.2 å£°æ˜å¼äº‹åŠ¡æ§åˆ¶çš„å®ç°"></a>6.2.2 å£°æ˜å¼äº‹åŠ¡æ§åˆ¶çš„å®ç°</h4><p>å£°æ˜å¼äº‹åŠ¡æ§åˆ¶æ˜ç¡®äº‹é¡¹ï¼š</p><ul><li><p>è°æ˜¯åˆ‡ç‚¹ï¼Ÿ</p></li><li><p>è°æ˜¯é€šçŸ¥ï¼Ÿ</p></li><li><p>é…ç½®åˆ‡é¢ï¼Ÿ</p></li></ul><p>â‘ å¼•å…¥txå‘½åç©ºé—´</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">beans</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:context</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:aop</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xmlns:tx</span>=<span class="hljs-string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="hljs-tag">       <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/context</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/aop</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/aop/spring-aop.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/tx</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/tx/spring-tx.xsd</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans</span></span><br><span class="hljs-tag"><span class="hljs-string">                           http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¡é…ç½®äº‹åŠ¡å¢å¼º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¹³å°äº‹åŠ¡ç®¡ç†å™¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;transactionManager&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-comment">&lt;!--äº‹åŠ¡å¢å¼ºé…ç½®--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘¢é…ç½®äº‹åŠ¡ AOP ç»‡å…¥</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--äº‹åŠ¡çš„aopå¢å¼º--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myPointcut&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.itheima.service.impl.*.*(..))&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;myPointcut&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">aop:advisor</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><p>â‘£æµ‹è¯•äº‹åŠ¡æ§åˆ¶è½¬è´¦ä¸šåŠ¡ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(String outMan, String inMan, <span class="hljs-keyword">double</span> money)</span> </span>&#123;<br>    accountDao.out(outMan,money);<br>    <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;<br>    accountDao.in(inMan,money);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="6-2-3-åˆ‡ç‚¹æ–¹æ³•çš„äº‹åŠ¡å‚æ•°çš„é…ç½®"><a href="#6-2-3-åˆ‡ç‚¹æ–¹æ³•çš„äº‹åŠ¡å‚æ•°çš„é…ç½®" class="headerlink" title="6.2.3 åˆ‡ç‚¹æ–¹æ³•çš„äº‹åŠ¡å‚æ•°çš„é…ç½®"></a>6.2.3 åˆ‡ç‚¹æ–¹æ³•çš„äº‹åŠ¡å‚æ•°çš„é…ç½®</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--äº‹åŠ¡å¢å¼ºé…ç½®--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;*&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ&lt; tx:method &gt; ä»£è¡¨åˆ‡ç‚¹æ–¹æ³•çš„äº‹åŠ¡å‚æ•°çš„é…ç½®ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;transfer&quot;</span> <span class="hljs-attr">isolation</span>=<span class="hljs-string">&quot;REPEATABLE_READ&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;REQUIRED&quot;</span> <span class="hljs-attr">timeout</span>=<span class="hljs-string">&quot;-1&quot;</span> <span class="hljs-attr">read-only</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><ul><li><p>nameï¼šåˆ‡ç‚¹æ–¹æ³•åç§°</p></li><li><p>isolationï¼šäº‹åŠ¡çš„éš”ç¦»çº§åˆ«</p></li><li><p>propogationï¼šäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</p></li><li><p>timeoutï¼šè¶…æ—¶æ—¶é—´</p></li><li><p>read-onlyï¼šæ˜¯å¦åªè¯»</p></li></ul><h4 id="6-2-4-è¦ç‚¹æ€»ç»“"><a href="#6-2-4-è¦ç‚¹æ€»ç»“" class="headerlink" title="6.2.4 è¦ç‚¹æ€»ç»“"></a>6.2.4 è¦ç‚¹æ€»ç»“</h4><p>å£°æ˜å¼äº‹åŠ¡æ§åˆ¶çš„é…ç½®è¦ç‚¹</p><ul><li><p>å¹³å°äº‹åŠ¡ç®¡ç†å™¨é…ç½®</p></li><li><p>äº‹åŠ¡é€šçŸ¥çš„é…ç½®</p></li><li><p>äº‹åŠ¡aopç»‡å…¥çš„é…ç½®</p></li></ul><h3 id="6-3-åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"><a href="#6-3-åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶" class="headerlink" title="6.3 åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"></a>6.3 åŸºäºæ³¨è§£çš„å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</h3><h4 id="6-3-1-ä½¿ç”¨æ³¨è§£é…ç½®å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"><a href="#6-3-1-ä½¿ç”¨æ³¨è§£é…ç½®å£°æ˜å¼äº‹åŠ¡æ§åˆ¶" class="headerlink" title="6.3.1 ä½¿ç”¨æ³¨è§£é…ç½®å£°æ˜å¼äº‹åŠ¡æ§åˆ¶"></a>6.3.1 ä½¿ç”¨æ³¨è§£é…ç½®å£°æ˜å¼äº‹åŠ¡æ§åˆ¶</h4><p>å‡†å¤‡å·¥ä½œï¼š</p><p>ç¼–å†™ AccountDao å’Œ AccountService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Repository(&quot;accountDao&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountDaoImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccountDao</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">out</span><span class="hljs-params">(String outMan, <span class="hljs-keyword">double</span> money)</span> </span>&#123;<br>        jdbcTemplate.update(<span class="hljs-string">&quot;update account set money=money-? where name=?&quot;</span>,money,outMan);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">in</span><span class="hljs-params">(String inMan, <span class="hljs-keyword">double</span> money)</span> </span>&#123;<br>        jdbcTemplate.update(<span class="hljs-string">&quot;update account set money=money+? where name=?&quot;</span>,money,inMan);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service(&quot;accountService&quot;)</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">AccountService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AccountDao accountDao;<br>    <span class="hljs-meta">@Transactional(isolation = Isolation.READ_COMMITTED,propagation = Propagation.REQUIRED)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">transfer</span><span class="hljs-params">(String outMan, String inMan, <span class="hljs-keyword">double</span> money)</span> </span>&#123;<br>        accountDao.out(outMan,money);<br>        <span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>/<span class="hljs-number">0</span>;<br>        accountDao.in(inMan,money);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–å†™ applicationContext.xml é…ç½®æ–‡ä»¶</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- ä¹‹å‰çœç•¥datsSourceã€jdbcTemplateã€å¹³å°äº‹åŠ¡ç®¡ç†å™¨çš„é…ç½®--&gt;</span><br><span class="hljs-comment">&lt;!--ç»„ä»¶æ‰«æ--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.itheima&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!--äº‹åŠ¡çš„æ³¨è§£é©±åŠ¨--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:annotation-driven</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;transactionManager&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h4 id="6-3-2-æ³¨è§£é…ç½®å£°æ˜å¼äº‹åŠ¡æ§åˆ¶è§£æ"><a href="#6-3-2-æ³¨è§£é…ç½®å£°æ˜å¼äº‹åŠ¡æ§åˆ¶è§£æ" class="headerlink" title="6.3.2 æ³¨è§£é…ç½®å£°æ˜å¼äº‹åŠ¡æ§åˆ¶è§£æ"></a>6.3.2 æ³¨è§£é…ç½®å£°æ˜å¼äº‹åŠ¡æ§åˆ¶è§£æ</h4><p>â‘ ä½¿ç”¨ @Transactional åœ¨éœ€è¦è¿›è¡Œäº‹åŠ¡æ§åˆ¶çš„ç±»æˆ–æ˜¯æ–¹æ³•ä¸Šä¿®é¥°ï¼Œæ³¨è§£å¯ç”¨çš„å±æ€§åŒ xml é…ç½®æ–¹å¼ï¼Œä¾‹å¦‚éš”ç¦»çº§åˆ«ã€ä¼ æ’­è¡Œä¸ºç­‰ã€‚</p><p>â‘¡æ³¨è§£ä½¿ç”¨åœ¨ç±»ä¸Šï¼Œé‚£ä¹ˆè¯¥ç±»ä¸‹çš„æ‰€æœ‰æ–¹æ³•éƒ½ä½¿ç”¨åŒä¸€å¥—æ³¨è§£å‚æ•°é…ç½®ã€‚</p><p>â‘¢ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œä¸åŒçš„æ–¹æ³•å¯ä»¥é‡‡ç”¨ä¸åŒçš„äº‹åŠ¡å‚æ•°é…ç½®ã€‚</p><p>â‘£Xmlé…ç½®æ–‡ä»¶ä¸­è¦å¼€å¯äº‹åŠ¡çš„æ³¨è§£é©±åŠ¨&lt; tx:annotation-driven /&gt;</p><h4 id="6-3-3-è¦ç‚¹æ€»ç»“"><a href="#6-3-3-è¦ç‚¹æ€»ç»“" class="headerlink" title="6.3.3 è¦ç‚¹æ€»ç»“"></a>6.3.3 è¦ç‚¹æ€»ç»“</h4><p>æ³¨è§£å£°æ˜å¼äº‹åŠ¡æ§åˆ¶çš„é…ç½®è¦ç‚¹</p><ul><li><p>å¹³å°äº‹åŠ¡ç®¡ç†å™¨é…ç½®ï¼ˆxmlæ–¹å¼ï¼‰</p></li><li><p>äº‹åŠ¡é€šçŸ¥çš„é…ç½®ï¼ˆ@Transactionalæ³¨è§£é…ç½®ï¼‰</p></li><li><p>äº‹åŠ¡æ³¨è§£é©±åŠ¨çš„é…ç½® &lt; tx:annotation-driven /&gt;</p></li></ul><h2 id="7-Mybatis"><a href="#7-Mybatis" class="headerlink" title="7. Mybatis"></a>7. Mybatis</h2><h2 id="å®æˆ˜ç»ƒä¹ ï¼š"><a href="#å®æˆ˜ç»ƒä¹ ï¼š" class="headerlink" title="å®æˆ˜ç»ƒä¹ ï¼š"></a>å®æˆ˜ç»ƒä¹ ï¼š</h2><ul><li>ç¬¬ä¸€é˜¶æ®µçš„springç»ƒä¹ ï¼šå·©å›º 2 - 3.4 ä»¥åŠ 4 çš„çŸ¥è¯†å®æˆ˜ â€”â€” è§†é¢‘ <a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=89&t=307">p89 - p106</a></li><li>ç¬¬äºŒé˜¶æ®µçš„springç»ƒä¹ ï¼šå·©å›º 3.5 çš„çŸ¥è¯†å®è·µ â€”â€” è§†é¢‘ <a href="https://www.bilibili.com/video/BV1WZ4y1P7Bp?p=112">p112- p115</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Framework</category>
      
      <category>Spring</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Spring</tag>
      
      <tag>SpringMVC</tag>
      
      <tag>Mybatis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>èš‚èšå¤§å®‰å…¨javaå¼€å‘å®ä¹ é¢ç»ï¼ˆ2+1ï¼‰</title>
    <link href="/2021/04/22/%E9%9D%A2%E8%AF%95%E5%A4%8D%E7%9B%98%EF%BC%9A%E8%9A%82%E8%9A%81cro%E7%BA%BF%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E9%83%A8%E9%97%A8%E9%9D%A2%E7%BB%8F2+1/"/>
    <url>/2021/04/22/%E9%9D%A2%E8%AF%95%E5%A4%8D%E7%9B%98%EF%BC%9A%E8%9A%82%E8%9A%81cro%E7%BA%BF%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E9%83%A8%E9%97%A8%E9%9D%A2%E7%BB%8F2+1/</url>
    
    <content type="html"><![CDATA[<h1 id="èš‚èšå¤§å®‰å…¨é¢ç»ï¼ˆ2-1ï¼‰"><a href="#èš‚èšå¤§å®‰å…¨é¢ç»ï¼ˆ2-1ï¼‰" class="headerlink" title="èš‚èšå¤§å®‰å…¨é¢ç»ï¼ˆ2+1ï¼‰"></a>èš‚èšå¤§å®‰å…¨é¢ç»ï¼ˆ2+1ï¼‰</h1><p>æˆ‘é¢è¯•é‡åˆ°çš„èš‚èšé¢è¯•å®˜æ„Ÿè§‰éƒ½æŒºå’Œè”¼çš„ï¼Œè¯´è¯å¾ˆå®¢æ°”ï¼Œé¢è¯•ä½“éªŒéå¸¸è‰¯å¥½ã€‚</p><h2 id="1-ä¸€é¢ï¼ˆ50minï¼‰"><a href="#1-ä¸€é¢ï¼ˆ50minï¼‰" class="headerlink" title="1. ä¸€é¢ï¼ˆ50minï¼‰"></a>1. ä¸€é¢ï¼ˆ50minï¼‰</h2><p>æˆéƒ½çš„é¢è¯•å®˜</p><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>ä½ äº†è§£è®¾è®¡æ¨¡å¼ä¹ˆï¼Ÿ</li><li>ä»‹ç»ä¸€ä¸‹å•ä¾‹æ¨¡å¼ï¼Ÿå¤§æ¦‚æœ‰å“ªäº›å®ç°æ–¹å¼åŠå…¶çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿï¼ˆæ‡’æ±‰åŒé‡æ£€æŸ¥é”ã€æ‡’æ±‰é™æ€å†…éƒ¨ç±»ã€é¥¿æ±‰é™æ€å˜é‡ç›´æ¥åŠ è½½ã€æšä¸¾ï¼‰</li><li>ä½ ç®€å•ä»‹ç»ä¸€ä¸‹å…¶ä»–ä½ ç”¨è¿‡çš„è®¾è®¡æ¨¡å¼åŠå…¶æ€æƒ³ï¼Ÿï¼ˆè£…é¥°ã€æ„é€ è€…ã€ä»£ç†ã€å·¥å‚ã€æ¨¡æ¿ã€é€‚é…å™¨..ï¼‰</li><li>è¿™äº›è®¾è®¡æ¨¡å¼ä½ æ˜¯æ€ä¹ˆç”¨åˆ°ä»–ä»¬çš„ï¼Ÿæˆ–è€…è¯´æ€ä¹ˆè¢«åº”ç”¨ï¼Ÿï¼ˆå›ç­”ä¸€äº›ç»å…¸çš„JDKä»£ç ä¸­çš„è®¾è®¡æ¨¡å¼ä»¥åŠMybatisä¸­çš„ä¸€äº›æ¨¡å¼åº”ç”¨ï¼Œå½“æ—¶springè¿˜æ²¡æ€ä¹ˆçœ‹å®Œï¼Œæ‰€ä»¥æ²¡æœ‰è°ˆåœ¨springä¸­çš„åº”ç”¨ï¼Œè¯´é”™äº†å°±ç”»è›‡æ·»è¶³äº†ï¼‰</li><li>è°ˆè°ˆä½ å¯¹è®¾è®¡æ¨¡å¼çš„ç†è§£ï¼Ÿ</li><li>ä½ ç”¨è¿‡å“ªäº›è¯­è¨€ï¼Ÿ</li><li>è¿™ä¸¤ç§è¯­è¨€çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæˆ‘è¯´pythonå’Œjavaäº†ï¼Œç„¶åä¸»è¦å›ç­”äº†javaçš„ç‰¹æ€§ï¼Œpythonäº†è§£çš„ä¸æ·±å…¥å¤§æ¦‚è¯´äº†è¯´ï¼‰</li><li>æµè§ˆå™¨è®¿é—®ç½‘å€çš„è¿‡ç¨‹ï¼Ÿ</li><li>æœåŠ¡å™¨å“åº”httpè¯·æ±‚çš„å…·ä½“è¿‡ç¨‹ï¼Ÿ</li><li>çº¿ç¨‹åˆ›å»ºæ–¹æ³•æœ‰å“ªäº›ï¼Ÿï¼ˆå›ç­”äº†ä¸‰ç§ï¼šç»§æ‰¿threadç±»ï¼Œrunnableæ¥å£å®ç°ï¼Œä»¥åŠfuturetaskç»“åˆcallableæ¥å£æ˜¯å®ç°ï¼‰</li><li>çº¿ç¨‹æ€ä¹ˆç»ˆæ­¢æœ‰å“ªäº›æ–¹å¼ï¼Ÿï¼ˆè€ƒå¯Ÿç›´æ¥ç»ˆæ­¢å’Œä¸¤é˜¶æ®µç»ˆæ­¢ï¼‰</li><li>ThreadLocalï¼Ÿï¼ˆæˆ‘æ²¡å¬æ¸…é¢è¯•å®˜å…·ä½“é—®çš„å•¥ï¼Œä»–å°±è¯´ä¸‹ä¸€ä¸ªé—®é¢˜å§..ï¼‰</li><li>é—®é¡¹ç›®ï¼Ÿï¼ˆç®€å†çš„ä¸‰ä¸ªé¡¹ç›®å…¨é—®äº†ä¸€émotivationå’Œæˆ‘çš„è´¡çŒ®ï¼‰</li><li>é¡¹ç›®ä¸­é‡åˆ°çš„å›°éš¾ï¼Ÿ</li><li>ä½ ä¸ºä»€ä¹ˆé€‰æˆ‘ä»¬éƒ¨é—¨ï¼Ÿ</li><li>ä½ å¯¹æˆ‘ä»¬å…¬å¸æœ‰ä»€ä¹ˆäº†è§£ï¼Ÿ</li></ul><h2 id="2-äºŒé¢ï¼ˆ50minï¼‰"><a href="#2-äºŒé¢ï¼ˆ50minï¼‰" class="headerlink" title="2. äºŒé¢ï¼ˆ50minï¼‰"></a>2. äºŒé¢ï¼ˆ50minï¼‰</h2><p>æ­å·çš„é¢è¯•å®˜</p><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>é‡ç‚¹ä»‹ç»ä¸€ä¸‹ï¼Œä½ æœ€ä¸»è¦çš„é¡¹ç›®ï¼ˆä¸»è¦å¯¹æˆ‘çš„è®ºæ–‡é¡¹ç›®æ„Ÿå…´è¶£ï¼‰</li><li>é¡¹ç›®çš„å›°éš¾ï¼Ÿï¼ˆå°±æŠŠä¼šè®®è®ºæ–‡æ‹“å±•æˆæœŸåˆŠçš„æ‹“å±•å½“ä½œå›°éš¾è§£é‡Šäº†ä¸€éï¼Œå¹¶å¦‚ä½•è§£å†³çš„ï¼‰</li><li>ä½ æ€ä¹ˆå­¦ä¹ æ•°æ®ç»“æ„çš„ï¼Ÿ</li><li>å¦‚ä½•ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—ï¼Ÿï¼ˆå‰‘æŒ‡offeråŸé¢˜ï¼‰</li><li>ä¸Šé¢è¿™ä¸ªé—®é¢˜å¦‚æœæ˜¯å¹¶å‘çš„å‹å…¥å’Œå¼¹å‡ºï¼Œæ€ä¹ˆæ”¹å–„ï¼Ÿ<ul><li>ä½¿ç”¨äº†ä¸€ä¸ªvolatileä¿®é¥°çš„æ ‡å¿—ä½ï¼Œç»“åˆsynchronizeå…³é”®å­—å®ç°äº†ä¸€ä¸ªç®€å•çš„balkingæ¨¡å¼ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Œè‡³å°‘çœ‹ä¸Šå»æ²¡å•¥é—®é¢˜ï¼‰</li><li>å…¶æ€»æ„Ÿè§‰è¿˜æœ‰é—®é¢˜ï¼Œå½“æ—¶æˆ‘è§‰å¾—åŸå§‹çš„dequeå®ç°çš„æ ˆä¾ç„¶æœ‰çº¿ç¨‹é—®é¢˜ï¼Œä½†æ˜¯æˆ‘æäº†ä¸€ä¸‹ï¼Œå¦‚æœè¿™ä¸ªä¹Ÿè¦é”çš„è¯ï¼Œè¿™é“é¢˜å°±å˜æˆæ‰‹å†™ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—äº†ï¼Œé¢è¯•å®˜æ²¡è®©æˆ‘å†™ä¸‹å»äº†ï¼‰</li></ul></li><li>10äº¿ä¸ªæ•°ï¼Œæ‰¾æœ€å¤§1000ä¸ªæ€ä¹ˆåšï¼Ÿå¤æ‚åº¦æ€ä¹ˆç®—ï¼Ÿï¼ˆæœ€å°å †ï¼Œnlog1000ï¼‰</li><li>ä½¿ç”¨æœ€å°å †è¿™ä¸ªæ•°æ®ç»“æ„çš„è§£å†³æ–¹æ¡ˆè¿˜èƒ½æ”¹è¿›ä¹ˆï¼Ÿ<ul><li>å½“æ—¶æ²¡æƒ³å‡ºæ¥</li><li>å¤ç›˜å’ŒåŒå­¦è®¨è®ºï¼Œæ„Ÿè§‰åº”è¯¥å¯ä»¥åˆ†æˆ10åˆ†ï¼Œåˆ†åˆ«ç”¨å †æ’å¾—åˆ°10ä¸ªtop1000ï¼Œå†å¯¹10ä¸ªtop1000å†æ’ä¸€æ¬¡ï¼Œå¤æ‚åº¦å¹¶æ²¡æœ‰å˜åŒ–ä½†æ˜¯å¹¶å‘åº¦æé«˜äº†10å€</li></ul></li><li>è®¡ç½‘TCPä½ å¯¹è¿™ä¸ªçš„ç†è§£ï¼ˆå›ç­”çš„å®ç°æ•°æ®å¯é æ€§ï¼šç¡®è®¤ã€é‡ä¼ ã€æ ¡éªŒå’Œã€æ‹¥å¡æ§åˆ¶ã€æµé‡æ§åˆ¶ç­‰ç­‰ï¼‰</li><li>å¦‚æœæ˜¯æ”¯ä»˜åœºæ™¯ä½ ä¼šé€‰å“ªä¸€ç§åè®®ï¼ˆTCP/UDPï¼‰</li><li>å¦‚æœæ˜¯æ¸¸æˆçš„è¯ä½ ä¼šé€‰å“ªä¸€ç§åè®®ï¼ˆTCP/UDPï¼‰</li><li>é‚£è¿™ç§æ”¯ä»˜çš„åœºæ™¯ä¿è¯å®‰å…¨éœ€è¦åŠ å¯†ï¼Œä½ äº†è§£å“ªäº›åŠ å¯†ç®—æ³•ï¼Ÿ</li><li>ä¸å¯¹ç§°åŠ å¯†çš„å…¬é’¥å’Œç§é’¥æ˜¯å¦‚ä½•ç”Ÿæˆçš„ï¼Ÿ</li><li>ä½ å­¦ä¹ çš„æ¸ é“æœ‰å“ªäº›ï¼Ÿ</li><li>ä½ åšé˜¿é‡Œç¬”è¯•é¢˜æœ‰é‡åˆ°è¿‡å¹³æ—¶åšè¿‡çš„é¢˜ç›®ä¹ˆï¼Ÿ</li><li>ä½ è§‰å¾—ä½ æ˜¯ä¸€ä¸ªæ€æ ·çš„äººï¼Ÿ</li><li>ä½ çš„èŒä¸šè§„åˆ’æ˜¯ä»€ä¹ˆï¼Ÿ</li></ul><h2 id="3-HRé¢ï¼ˆ30minï¼‰"><a href="#3-HRé¢ï¼ˆ30minï¼‰" class="headerlink" title="3. HRé¢ï¼ˆ30minï¼‰"></a>3. HRé¢ï¼ˆ30minï¼‰</h2><p>å…¨æ˜¯éæŠ€æœ¯é—®é¢˜ï¼Œæ°›å›´æ¯”è¾ƒè½»æ¾ï¼Œé¢è¯•å®˜çœ‹ä¸Šå»å…¨ç¨‹æŒºå¼€å¿ƒçš„ï¼ˆæˆ‘è¯´è¯å¾ˆæç¬‘ï¼ŸğŸ•ï¼‰</p><ul><li>è‡ªæˆ‘ä»‹ç»</li><li>é¡¹ç›®</li><li>æœ€æœ‰æˆå°±çš„äº‹æƒ…</li><li>é‡åˆ°æœ€å¤§çš„å›°éš¾</li><li>åšæŒæœ€é•¿æ—¶é—´çš„äº‹æƒ…</li><li>ä½ æ¥æˆ‘ä»¬å…¬å¸ç›¸æ¯”åˆ«çš„å®ä¹ ç”Ÿæœ‰ä»€ä¹ˆä¼˜åŠ¿</li><li>ä½ çš„ä¼˜åŠ£æ˜¯ä»€ä¹ˆ</li><li>ä½ å‚åŠ ä¸€äº›ç”Ÿæ´»ç»„ç»‡æ´»åŠ¨ä¹ˆ</li><li>ä½ ç°åœ¨çš„å­¦ä¹ å®‰æ’æ˜¯ä»€ä¹ˆ</li><li>ä½ å¤§æ¦‚ä»€ä¹ˆæ—¶å€™èƒ½å…¥èŒï¼Ÿä½ é€‰æ‹©çš„baseåœ°ç‚¹åœ¨å“ªï¼Ÿ</li></ul><h2 id="4-å‡†å¤‡é¢è¯•çš„æ„Ÿæ‚Ÿ"><a href="#4-å‡†å¤‡é¢è¯•çš„æ„Ÿæ‚Ÿ" class="headerlink" title="4. å‡†å¤‡é¢è¯•çš„æ„Ÿæ‚Ÿ"></a>4. å‡†å¤‡é¢è¯•çš„æ„Ÿæ‚Ÿ</h2><p>ä»3æœˆåº•å‹‰å¼ºå‡†å¤‡å¥½å¼€å§‹æŠ•ç®€å†ï¼Œåˆ°ç°åœ¨ï¼Œå‘ç”Ÿäº†å„ç§å„æ ·å‡ºä¹æ„æ–™çš„äº‹æƒ…ï¼ˆå“~~ï¼‰</p><p>ä»å»å¹´å¹´åº•å¼€å§‹è‡ªå­¦javaå¼€å‘ï¼Œé¢äº†è¿™ä¹ˆå¤šä¹‹åæ„Ÿè§‰åŠè·¯å‡ºå®¶æƒ³æ‰¾åˆ°åˆé€‚çš„å¼€å‘å®ä¹ ç¡®å®æŒºéš¾çš„ï¼Œå¾ˆå¤šå…¬å¸ç¬”è¯•å®Œå°±æ²¡åŠ¨é™äº†ï¼Œç”šè‡³ç¬”è¯•éƒ½ä¸ç»™ä¸€ç‚¹ååº”ï¼ˆå¯èƒ½æˆéƒ½å²—ä½ä¸å¤šä¹Ÿæ˜¯åŸå› ï¼Œå“ï¼Œå¿ƒç´¯..ï¼‰ã€‚åªèƒ½æ¯å¤©éƒ½é«˜å¼ºåº¦åœ°å¼¥è¡¥å¼€å‘åŸºç¡€ï¼Œå¤ä¹ å…«è‚¡æ–‡ã€‚ä¸‡å¹¸çš„æ˜¯ï¼Œè¿˜å¥½æœ€åæ‹¿åˆ°äº†ç¬¬ä¸€ä¸ªofferã€‚åé¢æˆ‘åº”è¯¥æŠŠå·²ç»æŠ•å‡ºå»çš„æµç¨‹éƒ½èµ°å®Œå°±ä¸æŠ•äº†ã€‚</p><p>è¿™é‡Œé¼“åŠ±ä¸€ä¸‹å¤§å®¶ï¼Œä¸€å®šä¸è¦å› ä¸ºä¸€æ¬¡é¢è¯•ä½“éªŒæå·®æˆ–è€…è¡¨ç°ä¸å¥½å°±å¦å®šè‡ªå·±ï¼ŒçœŸçš„è¿æ°”æˆåˆ†è¿˜æ˜¯å¾ˆå¤§çš„ï¼ˆæ•™ç ”å®¤å‘¨å›´äººéƒ½è¢«æŸé¹…å‚é­å°¸åå¾—å‡ºçš„ç»“è®ºï¼Œä»¥ä¸Šä»…æ˜¯ä¸ªäººè§‚ç‚¹ï¼‰ã€‚æœ€åå¸Œæœ›å„ä½éƒ½èƒ½æ‹¿åˆ°æ»¡æ„çš„offerï¼Œå¤§å®¶åŠ æ²¹ï¼Œæ±‚èŒè·¯ä¸Šã€ä¸å›å…±å‹‰ï¼</p>]]></content>
    
    
    <categories>
      
      <category>Interview</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Interview</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JVMå­¦ä¹ </title>
    <link href="/2021/04/17/JVM/"/>
    <url>/2021/04/17/JVM/</url>
    
    <content type="html"><![CDATA[<h1 id="JVMå­¦ä¹ "><a href="#JVMå­¦ä¹ " class="headerlink" title="JVMå­¦ä¹ "></a>JVMå­¦ä¹ </h1><p><a href="https://www.bilibili.com/video/BV1yE411Z7AP"><strong>è§£å¯†JVMã€é»‘é©¬ç¨‹åºå‘˜å‡ºå“ã€‘</strong></a>æ•™å­¦è§†é¢‘çš„ç¬”è®°ï¼ˆè½¬è½½<a href="https://nyimac.gitee.io/2020/07/03/JVM%E5%AD%A6%E4%B9%A0/#2%E3%80%81%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95">nyimac</a>ï¼Œåšä¸€æ¡æ‡’ğŸ•ï¼Œè¿™ä¸ªäººåšçš„ä¸é”™ï¼‰</p><h2 id="ä¸€ã€ä»€ä¹ˆæ˜¯JVM"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯JVM" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯JVM"></a>ä¸€ã€ä»€ä¹ˆæ˜¯JVM</h2><h3 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h3><p>Java Virtual Machineï¼ŒJAVAç¨‹åºçš„<strong>è¿è¡Œç¯å¢ƒ</strong>ï¼ˆJAVAäºŒè¿›åˆ¶å­—èŠ‚ç çš„è¿è¡Œç¯å¢ƒï¼‰</p><h3 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h3><ul><li>ä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œ</li><li>è‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶</li><li>æ•°ç»„ä¸‹æ ‡è¶Šç•Œæ£€æŸ¥</li></ul><h3 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h3><p>JVM JRE JDKçš„åŒºåˆ«</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150422.png" alt="img"></a></p><h2 id="äºŒã€å†…å­˜ç»“æ„"><a href="#äºŒã€å†…å­˜ç»“æ„" class="headerlink" title="äºŒã€å†…å­˜ç»“æ„"></a>äºŒã€å†…å­˜ç»“æ„</h2><h3 id="æ•´ä½“æ¶æ„"><a href="#æ•´ä½“æ¶æ„" class="headerlink" title="æ•´ä½“æ¶æ„"></a><strong>æ•´ä½“æ¶æ„</strong></h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150440.png" alt="img"></a></p><h3 id="1ã€ç¨‹åºè®¡æ•°å™¨"><a href="#1ã€ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="1ã€ç¨‹åºè®¡æ•°å™¨"></a>1ã€ç¨‹åºè®¡æ•°å™¨</h3><h4 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h4><p>ç”¨äºä¿å­˜JVMä¸­ä¸‹ä¸€æ¡æ‰€è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€</p><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li>çº¿ç¨‹ç§æœ‰<ul><li>CPUä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ†é…æ—¶é—´ç‰‡ï¼Œå½“å½“å‰çº¿ç¨‹çš„æ—¶é—´ç‰‡ä½¿ç”¨å®Œä»¥åï¼ŒCPUå°±ä¼šå»æ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­çš„ä»£ç </li><li>ç¨‹åºè®¡æ•°å™¨æ˜¯<strong>æ¯ä¸ªçº¿ç¨‹</strong>æ‰€<strong>ç§æœ‰</strong>çš„ï¼Œå½“å¦ä¸€ä¸ªçº¿ç¨‹çš„æ—¶é—´ç‰‡ç”¨å®Œï¼Œåˆè¿”å›æ¥æ‰§è¡Œå½“å‰çº¿ç¨‹çš„ä»£ç æ—¶ï¼Œé€šè¿‡ç¨‹åºè®¡æ•°å™¨å¯ä»¥çŸ¥é“åº”è¯¥æ‰§è¡Œå“ªä¸€å¥æŒ‡ä»¤</li></ul></li><li>ä¸ä¼šå­˜åœ¨å†…å­˜æº¢å‡º</li></ul><h3 id="2ã€è™šæ‹Ÿæœºæ ˆ"><a href="#2ã€è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="2ã€è™šæ‹Ÿæœºæ ˆ"></a>2ã€è™šæ‹Ÿæœºæ ˆ</h3><h4 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><ul><li>æ¯ä¸ª<strong>çº¿ç¨‹</strong>è¿è¡Œéœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œç§°ä¸º<strong>è™šæ‹Ÿæœºæ ˆ</strong></li><li>æ¯ä¸ªæ ˆç”±å¤šä¸ª<strong>æ ˆå¸§</strong>ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶æ‰€å ç”¨çš„å†…å­˜</li><li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰<strong>ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§</strong>ï¼Œå¯¹åº”ç€<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•</strong></li></ul><h4 id="æ¼”ç¤º"><a href="#æ¼”ç¤º" class="headerlink" title="æ¼”ç¤º"></a>æ¼”ç¤º</h4><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>method1();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">method1</span><span class="hljs-params">()</span> </span>&#123;<br>method2(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">method2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br><span class="hljs-keyword">int</span> c = a + b;<br><span class="hljs-keyword">return</span> c;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150534.png" alt="img"></a></p><p>åœ¨æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œä¸»ç±»ä¸­çš„æ–¹æ³•åœ¨è¿›å…¥è™šæ‹Ÿæœºæ ˆçš„æ—¶å€™ï¼Œç¬¦åˆæ ˆçš„ç‰¹ç‚¹</p><h4 id="é—®é¢˜è¾¨æ"><a href="#é—®é¢˜è¾¨æ" class="headerlink" title="é—®é¢˜è¾¨æ"></a>é—®é¢˜è¾¨æ</h4><ul><li>åƒåœ¾å›æ”¶æ˜¯å¦æ¶‰åŠæ ˆå†…å­˜ï¼Ÿ<ul><li><strong>ä¸éœ€è¦</strong>ã€‚å› ä¸ºè™šæ‹Ÿæœºæ ˆä¸­æ˜¯ç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆçš„ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå¯¹åº”çš„æ ˆå¸§å°±ä¼šè¢«å¼¹å‡ºæ ˆã€‚æ‰€ä»¥æ— éœ€é€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å»å›æ”¶å†…å­˜ã€‚</li></ul></li><li>æ ˆå†…å­˜çš„åˆ†é…è¶Šå¤§è¶Šå¥½å—ï¼Ÿ<ul><li>ä¸æ˜¯ã€‚å› ä¸º<strong>ç‰©ç†å†…å­˜æ˜¯ä¸€å®šçš„</strong>ï¼Œæ ˆå†…å­˜è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒæ›´å¤šçš„é€’å½’è°ƒç”¨ï¼Œä½†æ˜¯å¯æ‰§è¡Œçš„çº¿ç¨‹æ•°å°±ä¼šè¶Šå°‘ã€‚</li></ul></li><li>æ–¹æ³•å†…çš„å±€éƒ¨å˜é‡æ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ<ul><li>å¦‚æœæ–¹æ³•å†…<strong>å±€éƒ¨å˜é‡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™æ˜¯<strong>çº¿ç¨‹å®‰å…¨</strong>çš„</li><li>å¦‚æœå¦‚æœ<strong>å±€éƒ¨å˜é‡å¼•ç”¨äº†å¯¹è±¡</strong>ï¼Œå¹¶<strong>é€ƒç¦»äº†æ–¹æ³•çš„ä½œç”¨èŒƒå›´</strong>ï¼Œåˆ™éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li></ul></li></ul><h4 id="å†…å­˜æº¢å‡º"><a href="#å†…å­˜æº¢å‡º" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><p><strong>Java.lang.stackOverflowError</strong> æ ˆå†…å­˜æº¢å‡º</p><p><strong>å‘ç”ŸåŸå› </strong></p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­ï¼Œ<strong>æ ˆå¸§è¿‡å¤š</strong>ï¼ˆæ— é™é€’å½’ï¼‰</li><li>æ¯ä¸ªæ ˆå¸§<strong>æ‰€å ç”¨è¿‡å¤§</strong></li></ul><h4 id="çº¿ç¨‹è¿è¡Œè¯Šæ–­"><a href="#çº¿ç¨‹è¿è¡Œè¯Šæ–­" class="headerlink" title="çº¿ç¨‹è¿è¡Œè¯Šæ–­"></a>çº¿ç¨‹è¿è¡Œè¯Šæ–­</h4><p>CPUå ç”¨è¿‡é«˜</p><ul><li>Linuxç¯å¢ƒä¸‹è¿è¡ŒæŸäº›ç¨‹åºçš„æ—¶å€™ï¼Œå¯èƒ½å¯¼è‡´CPUçš„å ç”¨è¿‡é«˜ï¼Œè¿™æ—¶éœ€è¦å®šä½å ç”¨CPUè¿‡é«˜çš„çº¿ç¨‹<ul><li><strong>top</strong>å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å“ªä¸ª<strong>è¿›ç¨‹</strong>å ç”¨CPUè¿‡é«˜</li><li><strong>ps H -eo pid, tidï¼ˆçº¿ç¨‹idï¼‰, %cpu | grep åˆšæ‰é€šè¿‡topæŸ¥åˆ°çš„è¿›ç¨‹å·</strong> é€šè¿‡pså‘½ä»¤è¿›ä¸€æ­¥æŸ¥çœ‹æ˜¯å“ªä¸ªçº¿ç¨‹å ç”¨CPUè¿‡é«˜</li><li><strong>jstack è¿›ç¨‹id</strong> é€šè¿‡æŸ¥çœ‹è¿›ç¨‹ä¸­çš„çº¿ç¨‹çš„nidï¼Œåˆšæ‰é€šè¿‡pså‘½ä»¤çœ‹åˆ°çš„tidæ¥<strong>å¯¹æ¯”å®šä½</strong>ï¼Œæ³¨æ„jstackæŸ¥æ‰¾å‡ºçš„çº¿ç¨‹idæ˜¯<strong>16è¿›åˆ¶çš„</strong>ï¼Œ<strong>éœ€è¦è½¬æ¢</strong></li></ul></li></ul><h3 id="3ã€æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#3ã€æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="3ã€æœ¬åœ°æ–¹æ³•æ ˆ"></a>3ã€æœ¬åœ°æ–¹æ³•æ ˆ</h3><p>ä¸€äº›å¸¦æœ‰<strong>nativeå…³é”®å­—</strong>çš„æ–¹æ³•å°±æ˜¯éœ€è¦JAVAå»è°ƒç”¨æœ¬åœ°çš„Cæˆ–è€…C++æ–¹æ³•ï¼Œå› ä¸ºJAVAæœ‰æ—¶å€™æ²¡æ³•ç›´æ¥å’Œæ“ä½œç³»ç»Ÿåº•å±‚äº¤äº’ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ°æœ¬åœ°æ–¹æ³•</p><h3 id="4ã€å †"><a href="#4ã€å †" class="headerlink" title="4ã€å †"></a>4ã€å †</h3><h4 id="å®šä¹‰-2"><a href="#å®šä¹‰-2" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><p>é€šè¿‡newå…³é”®å­—<strong>åˆ›å»ºçš„å¯¹è±¡</strong>éƒ½ä¼šè¢«æ”¾åœ¨å †å†…å­˜</p><h4 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><ul><li><strong>æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ï¼Œå †å†…å­˜ä¸­çš„å¯¹è±¡éƒ½éœ€è¦<strong>è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜</strong></li><li>æœ‰åƒåœ¾å›æ”¶æœºåˆ¶</li></ul><h4 id="å †å†…å­˜æº¢å‡º"><a href="#å †å†…å­˜æº¢å‡º" class="headerlink" title="å †å†…å­˜æº¢å‡º"></a>å †å†…å­˜æº¢å‡º</h4><p><strong>java.lang.OutofMemoryError</strong> ï¼šjava heap space. å †å†…å­˜æº¢å‡º</p><h4 id="å †å†…å­˜è¯Šæ–­"><a href="#å †å†…å­˜è¯Šæ–­" class="headerlink" title="å †å†…å­˜è¯Šæ–­"></a>å †å†…å­˜è¯Šæ–­</h4><p><strong>jps</strong></p><p><strong>jmap</strong></p><p><strong>jconsole</strong></p><p><strong>jvirsalvm</strong></p><h3 id="5ã€æ–¹æ³•åŒº"><a href="#5ã€æ–¹æ³•åŒº" class="headerlink" title="5ã€æ–¹æ³•åŒº"></a>5ã€æ–¹æ³•åŒº</h3><h4 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150547.png" alt="img"></a></p><h4 id="å†…å­˜æº¢å‡º-1"><a href="#å†…å­˜æº¢å‡º-1" class="headerlink" title="å†…å­˜æº¢å‡º"></a>å†…å­˜æº¢å‡º</h4><ul><li>1.8ä»¥å‰ä¼šå¯¼è‡´<strong>æ°¸ä¹…ä»£</strong>å†…å­˜æº¢å‡º</li><li>1.8ä»¥åä¼šå¯¼è‡´<strong>å…ƒç©ºé—´</strong>å†…å­˜æº¢å‡º</li></ul><h4 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><blockquote><p>åœ¨å­¦ä¹  JVM ä¸­æ€»æ˜¯è¢«å‡ ä¸ªå¸¸é‡æ± çš„å…³ç³»ææ™•ï¼Œè¿™é‡Œä¸€ç¯‡æ¯”è¾ƒå¥½çš„<a href="http://tangxman.github.io/2015/07/27/the-difference-of-java-string-pool/">æ–‡ç« </a>æœ‰æ€»ç»“å‡ ç§å¸¸é‡æ± çš„å…³ç³»</p><p>Java ä¸­å‡ ç§å¸¸é‡æ± çš„åŒºåˆ†:</p><ul><li>å…¨å±€å­—ç¬¦å¸¸é‡æ± ï¼ˆä¸²æ± ï¼‰</li><li>classæ–‡ä»¶å¸¸é‡æ± </li><li>è¿è¡Œæ—¶å¸¸é‡æ± </li></ul></blockquote><p>äºŒè¿›åˆ¶å­—èŠ‚ç çš„ç»„æˆï¼šç±»çš„åŸºæœ¬ä¿¡æ¯ã€å¸¸é‡æ± ã€ç±»çš„æ–¹æ³•å®šä¹‰ï¼ˆåŒ…å«äº†è™šæ‹ŸæœºæŒ‡ä»¤ï¼‰</p><p><strong>é€šè¿‡åç¼–è¯‘æ¥æŸ¥çœ‹ç±»çš„ä¿¡æ¯</strong></p><ul><li><p>è·å¾—å¯¹åº”ç±»çš„.classæ–‡ä»¶</p><ul><li><p>åœ¨JDKå¯¹åº”çš„binç›®å½•ä¸‹è¿è¡Œcmdï¼Œ<strong>ä¹Ÿå¯ä»¥åœ¨IDEAæ§åˆ¶å°è¾“å…¥</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150602.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150602.png" alt="img"></a></p></li><li><p>è¾“å…¥ <strong>javac å¯¹åº”ç±»çš„ç»å¯¹è·¯å¾„</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">F:\JAVA\JDK8.0\bin&gt;javac F:\Thread_study\src\com\nyima\JVM\day01\Main.java<br></code></pre></td></tr></table></figure><p>è¾“å…¥å®Œæˆåï¼Œå¯¹åº”çš„ç›®å½•ä¸‹å°±ä¼šå‡ºç°ç±»çš„.classæ–‡ä»¶</p></li></ul></li><li><p>åœ¨æ§åˆ¶å°è¾“å…¥ javap -v ç±»çš„ç»å¯¹è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">javap -v F:\Thread_study\src\com\nyima\JVM\day01\Main.class<br></code></pre></td></tr></table></figure></li><li><p>ç„¶åèƒ½åœ¨æ§åˆ¶å°çœ‹åˆ°åç¼–è¯‘ä»¥åç±»çš„ä¿¡æ¯äº†</p><ul><li><p>ç±»çš„åŸºæœ¬ä¿¡æ¯</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150618.png" alt="img"></a></p></li><li><p>å¸¸é‡æ± </p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150630.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150641.png" alt="img"></a></p></li><li><p>è™šæ‹Ÿæœºä¸­æ‰§è¡Œç¼–è¯‘çš„æ–¹æ³•ï¼ˆæ¡†å†…çš„æ˜¯çœŸæ­£ç¼–è¯‘æ‰§è¡Œçš„å†…å®¹ï¼Œ**#å·çš„å†…å®¹éœ€è¦åœ¨å¸¸é‡æ± ä¸­æŸ¥æ‰¾**ï¼‰</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150653.png" alt="img"></a></p></li></ul></li></ul><h4 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h4><ul><li>å¸¸é‡æ± <ul><li>å°±æ˜¯ä¸€å¼ è¡¨ï¼ˆå¦‚ä¸Šå›¾ä¸­çš„constant poolï¼‰ï¼Œè™šæ‹ŸæœºæŒ‡ä»¤æ ¹æ®è¿™å¼ å¸¸é‡è¡¨æ‰¾åˆ°è¦æ‰§è¡Œçš„ç±»åã€æ–¹æ³•åã€å‚æ•°ç±»å‹ã€å­—é¢é‡ä¿¡æ¯</li></ul></li><li>è¿è¡Œæ—¶å¸¸é‡æ± <ul><li>å¸¸é‡æ± æ˜¯*.classæ–‡ä»¶ä¸­çš„ï¼Œå½“è¯¥<strong>ç±»è¢«åŠ è½½ä»¥å</strong>ï¼Œå®ƒçš„å¸¸é‡æ± ä¿¡æ¯å°±ä¼š<strong>æ”¾å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼Œå¹¶æŠŠé‡Œé¢çš„<strong>ç¬¦å·åœ°å€å˜ä¸ºçœŸå®åœ°å€</strong></li></ul></li></ul><h4 id="å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"><a href="#å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»" class="headerlink" title="å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»"></a>å¸¸é‡æ± ä¸ä¸²æ± çš„å…³ç³»</h4><h5 id="ä¸²æ± StringTable"><a href="#ä¸²æ± StringTable" class="headerlink" title="ä¸²æ± StringTable"></a><strong>ä¸²æ± </strong>StringTable</h5><p><strong>ç‰¹å¾</strong></p><ul><li>å¸¸é‡æ± ä¸­çš„å­—ç¬¦ä¸²ä»…æ˜¯ç¬¦å·ï¼Œåªæœ‰<strong>åœ¨è¢«ç”¨åˆ°æ—¶æ‰ä¼šè½¬åŒ–ä¸ºå¯¹è±¡</strong></li><li>åˆ©ç”¨ä¸²æ± çš„æœºåˆ¶ï¼Œæ¥é¿å…é‡å¤åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡</li><li>å­—ç¬¦ä¸²<strong>å˜é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>StringBuilder</strong></li><li>å­—ç¬¦ä¸²<strong>å¸¸é‡</strong>æ‹¼æ¥çš„åŸç†æ˜¯<strong>ç¼–è¯‘å™¨ä¼˜åŒ–</strong></li><li>å¯ä»¥ä½¿ç”¨<strong>internæ–¹æ³•</strong>ï¼Œä¸»åŠ¨å°†ä¸²æ± ä¸­è¿˜æ²¡æœ‰çš„å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥ä¸²æ± ä¸­</li><li><strong>æ³¨æ„</strong>ï¼šæ— è®ºæ˜¯ä¸²æ± è¿˜æ˜¯å †é‡Œé¢çš„å­—ç¬¦ä¸²ï¼Œéƒ½æ˜¯å¯¹è±¡</li></ul><p>ç”¨æ¥æ”¾å­—ç¬¦ä¸²å¯¹è±¡ä¸”é‡Œé¢çš„<strong>å…ƒç´ ä¸é‡å¤</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>String a = <span class="hljs-string">&quot;a&quot;</span>; <br>String b = <span class="hljs-string">&quot;b&quot;</span>;<br>String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¸¸é‡æ± ä¸­çš„ä¿¡æ¯ï¼Œéƒ½ä¼šè¢«åŠ è½½åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ï¼Œä½†è¿™æ˜¯a b ab ä»…æ˜¯å¸¸é‡æ± ä¸­çš„ç¬¦å·ï¼Œ<strong>è¿˜æ²¡æœ‰æˆä¸ºjavaå­—ç¬¦ä¸²</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">0: ldc           #2                  // String a<br>2: astore_1<br>3: ldc           #3                  // String b<br>5: astore_2<br>6: ldc           #4                  // String ab<br>8: astore_3<br>9: return<br></code></pre></td></tr></table></figure><p>å½“æ‰§è¡Œåˆ° ldc #2 æ—¶ï¼Œä¼šæŠŠç¬¦å· a å˜ä¸º â€œaâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œ<strong>å¹¶æ”¾å…¥ä¸²æ± ä¸­</strong>ï¼ˆhashtableç»“æ„ ä¸å¯æ‰©å®¹ï¼‰</p><p>å½“æ‰§è¡Œåˆ° ldc #3 æ—¶ï¼Œä¼šæŠŠç¬¦å· b å˜ä¸º â€œbâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p><p>å½“æ‰§è¡Œåˆ° ldc #4 æ—¶ï¼Œä¼šæŠŠç¬¦å· ab å˜ä¸º â€œabâ€ å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶æ”¾å…¥ä¸²æ± ä¸­</p><p>æœ€ç»ˆ<strong>StringTable [â€œaâ€, â€œbâ€, â€œabâ€]</strong></p><p><strong>æ³¨æ„</strong>ï¼šå­—ç¬¦ä¸²å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯<strong>æ‡’æƒ°çš„</strong>ï¼Œåªæœ‰å½“è¿è¡Œåˆ°é‚£ä¸€è¡Œå­—ç¬¦ä¸²ä¸”åœ¨ä¸²æ± ä¸­ä¸å­˜åœ¨çš„æ—¶å€™ï¼ˆå¦‚ ldc #2ï¼‰æ—¶ï¼Œè¯¥å­—ç¬¦ä¸²æ‰ä¼šè¢«åˆ›å»ºå¹¶æ”¾å…¥ä¸²æ± ä¸­ã€‚</p><p>ä½¿ç”¨æ‹¼æ¥<strong>å­—ç¬¦ä¸²å˜é‡å¯¹è±¡</strong>åˆ›å»ºå­—ç¬¦ä¸²çš„è¿‡ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>String a = <span class="hljs-string">&quot;a&quot;</span>;<br>String b = <span class="hljs-string">&quot;b&quot;</span>;<br>String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br><span class="hljs-comment">//æ‹¼æ¥å­—ç¬¦ä¸²å¯¹è±¡æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²</span><br>String ab2 = a+b; <br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åç¼–è¯‘åçš„ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell"> Code:<br>      stack=2, locals=5, args_size=1<br>         0: ldc           #2                  // String a<br>         2: astore_1<br>         3: ldc           #3                  // String b<br>         5: astore_2<br>         6: ldc           #4                  // String ab<br>         8: astore_3<br>         9: new           #5                  // class java/lang/StringBuilder<br>        12: dup<br>        13: invokespecial #6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V<br>        16: aload_1<br>        17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String<br>;)Ljava/lang/StringBuilder;<br>        20: aload_2<br>        21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String<br>;)Ljava/lang/StringBuilder;<br>        24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/Str<br>ing;<br>        27: astore        4<br>        29: return<br></code></pre></td></tr></table></figure><p>é€šè¿‡æ‹¼æ¥çš„æ–¹å¼æ¥åˆ›å»ºå­—ç¬¦ä¸²çš„<strong>è¿‡ç¨‹</strong>æ˜¯ï¼šStringBuilder().append(â€œaâ€).append(â€œbâ€).toString()</p><p>æœ€åçš„toStringæ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¸€ä¸ª<strong>æ–°çš„å­—ç¬¦ä¸²</strong>ï¼Œä½†å­—ç¬¦ä¸²çš„<strong>å€¼</strong>å’Œæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸€è‡´ï¼Œä½†æ˜¯ä¸¤ä¸ªä¸åŒçš„å­—ç¬¦ä¸²ï¼Œ<strong>ä¸€ä¸ªå­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œä¸€ä¸ªå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>String ab2 = a+b;<br><span class="hljs-comment">//ç»“æœä¸ºfalse,å› ä¸ºabæ˜¯å­˜åœ¨äºä¸²æ± ä¹‹ä¸­ï¼Œab2æ˜¯ç”±StringBufferçš„toStringæ–¹æ³•æ‰€è¿”å›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br>System.out.println(ab == ab2);<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡å¯¹è±¡</strong>çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StringTableStudy</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>String a = <span class="hljs-string">&quot;a&quot;</span>;<br>String b = <span class="hljs-string">&quot;b&quot;</span>;<br>String ab = <span class="hljs-string">&quot;ab&quot;</span>;<br>String ab2 = a+b;<br><span class="hljs-comment">//ä½¿ç”¨æ‹¼æ¥å­—ç¬¦ä¸²çš„æ–¹æ³•åˆ›å»ºå­—ç¬¦ä¸²</span><br>String ab3 = <span class="hljs-string">&quot;a&quot;</span> + <span class="hljs-string">&quot;b&quot;</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åç¼–è¯‘åçš„ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">   Code:<br>      stack=2, locals=6, args_size=1<br>         0: ldc           #2                  // String a<br>         2: astore_1<br>         3: ldc           #3                  // String b<br>         5: astore_2<br>         6: ldc           #4                  // String ab<br>         8: astore_3<br>         9: new           #5                  // class java/lang/StringBuilder<br>        12: dup<br>        13: invokespecial #6                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V<br>        16: aload_1<br>        17: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String<br>;)Ljava/lang/StringBuilder;<br>        20: aload_2<br>        21: invokevirtual #7                  // Method java/lang/StringBuilder.append:(Ljava/lang/String<br>;)Ljava/lang/StringBuilder;<br>        24: invokevirtual #8                  // Method java/lang/StringBuilder.toString:()Ljava/lang/Str<br>ing;<br>        27: astore        4<br>        //ab3åˆå§‹åŒ–æ—¶ç›´æ¥ä»ä¸²æ± ä¸­è·å–å­—ç¬¦ä¸²<br>        29: ldc           #4                  // String ab<br>        31: astore        5<br>        33: return<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å¸¸é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸º<strong>å†…å®¹æ˜¯å¸¸é‡ï¼Œjavacåœ¨ç¼–è¯‘æœŸä¼šè¿›è¡Œä¼˜åŒ–ï¼Œç»“æœå·²åœ¨ç¼–è¯‘æœŸç¡®å®šä¸ºab</strong>ï¼Œè€Œåˆ›å»ºabçš„æ—¶å€™å·²ç»åœ¨ä¸²æ± ä¸­æ”¾å…¥äº†â€œabâ€ï¼Œæ‰€ä»¥ab3ç›´æ¥ä»ä¸²æ± ä¸­è·å–å€¼ï¼Œæ‰€ä»¥è¿›è¡Œçš„æ“ä½œå’Œ ab = â€œabâ€ ä¸€è‡´ã€‚</li><li>ä½¿ç”¨<strong>æ‹¼æ¥å­—ç¬¦ä¸²å˜é‡</strong>çš„æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æ—¶ï¼Œå› ä¸ºå†…å®¹æ˜¯å˜é‡ï¼Œåªèƒ½<strong>åœ¨è¿è¡ŒæœŸç¡®å®šå®ƒçš„å€¼ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨StringBuilderæ¥åˆ›å»º</strong></li></ul><h5 id="internæ–¹æ³•-1-8"><a href="#internæ–¹æ³•-1-8" class="headerlink" title="internæ–¹æ³• 1.8"></a>internæ–¹æ³• 1.8</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p><ul><li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥æˆåŠŸ</li><li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li></ul><p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p><p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶å¦‚æœè°ƒç”¨internæ–¹æ³•æˆåŠŸï¼Œå †å†…å­˜ä¸ä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼›å¦‚æœå¤±è´¥ï¼Œåˆ™ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</p><p><strong>ä¾‹1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-comment">//&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­ï¼Œstråˆ™å­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br>String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);<br><span class="hljs-comment">//è°ƒç”¨strçš„internæ–¹æ³•ï¼Œè¿™æ—¶ä¸²æ± ä¸­æ²¡æœ‰&quot;ab&quot;ï¼Œåˆ™ä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡æ”¾å…¥åˆ°ä¸²æ± ä¸­ï¼Œæ­¤æ—¶å †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡</span><br>String st2 = str.intern();<br><span class="hljs-comment">//ç»™str3èµ‹å€¼ï¼Œå› ä¸ºæ­¤æ—¶ä¸²æ± ä¸­å·²æœ‰&quot;ab&quot;ï¼Œåˆ™ç›´æ¥å°†ä¸²æ± ä¸­çš„å†…å®¹è¿”å›</span><br>String str3 = <span class="hljs-string">&quot;ab&quot;</span>;<br><span class="hljs-comment">//å› ä¸ºå †å†…å­˜ä¸ä¸²æ± ä¸­çš„&quot;ab&quot;æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ä»¥ä¸‹ä¸¤æ¡è¯­å¥æ‰“å°çš„éƒ½ä¸ºtrue</span><br>System.out.println(str == st2);<br>System.out.println(str == str3);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ä¾‹2</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//æ­¤å¤„åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡&quot;ab&quot;ï¼Œå› ä¸ºä¸²æ± ä¸­è¿˜æ²¡æœ‰&quot;ab&quot;ï¼Œæ‰€ä»¥å°†å…¶æ”¾å…¥ä¸²æ± ä¸­</span><br>String str3 = <span class="hljs-string">&quot;ab&quot;</span>;<br>        <span class="hljs-comment">//&quot;a&quot; &quot;b&quot; è¢«æ”¾å…¥ä¸²æ± ä¸­ï¼Œstråˆ™å­˜åœ¨äºå †å†…å­˜ä¹‹ä¸­</span><br>String str = <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;a&quot;</span>) + <span class="hljs-keyword">new</span> String(<span class="hljs-string">&quot;b&quot;</span>);<br>        <span class="hljs-comment">//æ­¤æ—¶å› ä¸ºåœ¨åˆ›å»ºstr3æ—¶ï¼Œ&quot;ab&quot;å·²å­˜åœ¨ä¸ä¸²æ± ä¸­ï¼Œæ‰€ä»¥æ”¾å…¥å¤±è´¥ï¼Œä½†æ˜¯ä¼šè¿”å›ä¸²æ± ä¸­çš„&quot;ab&quot;</span><br>String str2 = str.intern();<br>        <span class="hljs-comment">//false</span><br>System.out.println(str == str2);<br>        <span class="hljs-comment">//false</span><br>System.out.println(str == str3);<br>        <span class="hljs-comment">//true</span><br>System.out.println(str2 == str3);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="internæ–¹æ³•-1-6"><a href="#internæ–¹æ³•-1-6" class="headerlink" title="internæ–¹æ³• 1.6"></a>internæ–¹æ³• 1.6</h5><p>è°ƒç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„internæ–¹æ³•ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å°è¯•æ”¾å…¥åˆ°ä¸²æ± ä¸­</p><ul><li>å¦‚æœä¸²æ± ä¸­æ²¡æœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¼šå°†è¯¥å­—ç¬¦ä¸²å¯¹è±¡å¤åˆ¶ä¸€ä»½ï¼Œå†æ”¾å…¥åˆ°ä¸²æ± ä¸­</li><li>å¦‚æœæœ‰è¯¥å­—ç¬¦ä¸²å¯¹è±¡ï¼Œåˆ™æ”¾å…¥å¤±è´¥</li></ul><p>æ— è®ºæ”¾å…¥æ˜¯å¦æˆåŠŸï¼Œéƒ½ä¼šè¿”å›<strong>ä¸²æ± ä¸­</strong>çš„å­—ç¬¦ä¸²å¯¹è±¡</p><p><strong>æ³¨æ„</strong>ï¼šæ­¤æ—¶æ— è®ºè°ƒç”¨internæ–¹æ³•æˆåŠŸä¸å¦ï¼Œä¸²æ± ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡å’Œå †å†…å­˜ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡<strong>éƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</strong></p><h4 id="StringTable-åƒåœ¾å›æ”¶"><a href="#StringTable-åƒåœ¾å›æ”¶" class="headerlink" title="StringTable åƒåœ¾å›æ”¶"></a>StringTable åƒåœ¾å›æ”¶</h4><p>StringTableåœ¨å†…å­˜ç´§å¼ æ—¶ï¼Œä¼šå‘ç”Ÿåƒåœ¾å›æ”¶</p><h4 id="StringTableè°ƒä¼˜"><a href="#StringTableè°ƒä¼˜" class="headerlink" title="StringTableè°ƒä¼˜"></a>StringTableè°ƒä¼˜</h4><ul><li><p>å› ä¸ºStringTableæ˜¯ç”±HashTableå®ç°çš„ï¼Œæ‰€ä»¥å¯ä»¥<strong>é€‚å½“å¢åŠ HashTableæ¡¶çš„ä¸ªæ•°</strong>ï¼Œæ¥å‡å°‘å­—ç¬¦ä¸²æ”¾å…¥ä¸²æ± æ‰€éœ€è¦çš„æ—¶é—´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">-XX:StringTableSize=xxxx<br></code></pre></td></tr></table></figure></li><li><p>è€ƒè™‘æ˜¯å¦éœ€è¦å°†å­—ç¬¦ä¸²å¯¹è±¡å…¥æ± </p><p>å¯ä»¥é€šè¿‡<strong>internæ–¹æ³•å‡å°‘é‡å¤å…¥æ± </strong></p></li></ul><h3 id="6ã€ç›´æ¥å†…å­˜"><a href="#6ã€ç›´æ¥å†…å­˜" class="headerlink" title="6ã€ç›´æ¥å†…å­˜"></a>6ã€ç›´æ¥å†…å­˜</h3><ul><li>å±äºæ“ä½œç³»ç»Ÿï¼Œå¸¸è§äºNIOæ“ä½œæ—¶ï¼Œ<strong>ç”¨äºæ•°æ®ç¼“å†²åŒº</strong></li><li>åˆ†é…å›æ”¶æˆæœ¬è¾ƒé«˜ï¼Œä½†è¯»å†™æ€§èƒ½é«˜</li><li>ä¸å—JVMå†…å­˜å›æ”¶ç®¡ç†</li></ul><h4 id="æ–‡ä»¶è¯»å†™æµç¨‹"><a href="#æ–‡ä»¶è¯»å†™æµç¨‹" class="headerlink" title="æ–‡ä»¶è¯»å†™æµç¨‹"></a>æ–‡ä»¶è¯»å†™æµç¨‹</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150715.png" alt="img"></a></p><p><strong>ä½¿ç”¨äº†DirectBuffer</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150736.png" alt="img"></a></p><p>ç›´æ¥å†…å­˜æ˜¯æ“ä½œç³»ç»Ÿå’ŒJavaä»£ç <strong>éƒ½å¯ä»¥è®¿é—®çš„ä¸€å—åŒºåŸŸ</strong>ï¼Œæ— éœ€å°†ä»£ç ä»ç³»ç»Ÿå†…å­˜å¤åˆ¶åˆ°Javaå †å†…å­˜ï¼Œä»è€Œæé«˜äº†æ•ˆç‡</p><h4 id="é‡Šæ”¾åŸç†"><a href="#é‡Šæ”¾åŸç†" class="headerlink" title="é‡Šæ”¾åŸç†"></a>é‡Šæ”¾åŸç†</h4><p>ç›´æ¥å†…å­˜çš„å›æ”¶ä¸æ˜¯é€šè¿‡JVMçš„åƒåœ¾å›æ”¶æ¥é‡Šæ”¾çš„ï¼Œè€Œæ˜¯é€šè¿‡<strong>unsafe.freeMemory</strong>æ¥æ‰‹åŠ¨é‡Šæ”¾</p><p>é€šè¿‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é€šè¿‡ByteBufferç”³è¯·1Mçš„ç›´æ¥å†…å­˜</span><br>ByteBuffer byteBuffer = ByteBuffer.allocateDirect(_1M);<br></code></pre></td></tr></table></figure><p>ç”³è¯·ç›´æ¥å†…å­˜ï¼Œä½†JVMå¹¶ä¸èƒ½å›æ”¶ç›´æ¥å†…å­˜ä¸­çš„å†…å®¹ï¼Œå®ƒæ˜¯å¦‚ä½•å®ç°å›æ”¶çš„å‘¢ï¼Ÿ</p><p><strong>allocateDirectçš„å®ç°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ByteBuffer <span class="hljs-title">allocateDirect</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DirectByteBuffer(capacity);<br>&#125;<br></code></pre></td></tr></table></figure><p>DirectByteBufferç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java">DirectByteBuffer(<span class="hljs-keyword">int</span> cap) &#123;   <span class="hljs-comment">// package-private</span><br>   <br>    <span class="hljs-keyword">super</span>(-<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, cap, cap);<br>    <span class="hljs-keyword">boolean</span> pa = VM.isDirectMemoryPageAligned();<br>    <span class="hljs-keyword">int</span> ps = Bits.pageSize();<br>    <span class="hljs-keyword">long</span> size = Math.max(<span class="hljs-number">1L</span>, (<span class="hljs-keyword">long</span>)cap + (pa ? ps : <span class="hljs-number">0</span>));<br>    Bits.reserveMemory(size, cap);<br><br>    <span class="hljs-keyword">long</span> base = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        base = unsafe.allocateMemory(size); <span class="hljs-comment">//ç”³è¯·å†…å­˜</span><br>    &#125; <span class="hljs-keyword">catch</span> (OutOfMemoryError x) &#123;<br>        Bits.unreserveMemory(size, cap);<br>        <span class="hljs-keyword">throw</span> x;<br>    &#125;<br>    unsafe.setMemory(base, size, (<span class="hljs-keyword">byte</span>) <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (pa &amp;&amp; (base % ps != <span class="hljs-number">0</span>)) &#123;<br>        <span class="hljs-comment">// Round up to page boundary</span><br>        address = base + ps - (base &amp; (ps - <span class="hljs-number">1</span>));<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        address = base;<br>    &#125;<br>    cleaner = Cleaner.create(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> Deallocator(base, size, cap)); <span class="hljs-comment">//é€šè¿‡è™šå¼•ç”¨ï¼Œæ¥å®ç°ç›´æ¥å†…å­˜çš„é‡Šæ”¾ï¼Œthisä¸ºè™šå¼•ç”¨çš„å®é™…å¯¹è±¡</span><br>    att = <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸ªCleanerçš„createæ–¹æ³•ï¼Œä¸”åå°çº¿ç¨‹è¿˜ä¼šå¯¹è™šå¼•ç”¨çš„å¯¹è±¡ç›‘æµ‹ï¼Œå¦‚æœè™šå¼•ç”¨çš„å®é™…å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯DirectByteBufferï¼‰è¢«å›æ”¶ä»¥åï¼Œå°±ä¼šè°ƒç”¨Cleanerçš„cleanæ–¹æ³•ï¼Œæ¥æ¸…é™¤ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clean</span><span class="hljs-params">()</span> </span>&#123;<br>       <span class="hljs-keyword">if</span> (remove(<span class="hljs-keyword">this</span>)) &#123;<br>           <span class="hljs-keyword">try</span> &#123;<br>               <span class="hljs-keyword">this</span>.thunk.run(); <span class="hljs-comment">//è°ƒç”¨runæ–¹æ³•</span><br>           &#125; <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">final</span> Throwable var2) &#123;<br>               AccessController.doPrivileged(<span class="hljs-keyword">new</span> PrivilegedAction&lt;Void&gt;() &#123;<br>                   <span class="hljs-function"><span class="hljs-keyword">public</span> Void <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                       <span class="hljs-keyword">if</span> (System.err != <span class="hljs-keyword">null</span>) &#123;<br>                           (<span class="hljs-keyword">new</span> Error(<span class="hljs-string">&quot;Cleaner terminated abnormally&quot;</span>, var2)).printStackTrace();<br>                       &#125;<br><br>                       System.exit(<span class="hljs-number">1</span>);<br>                       <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>                   &#125;<br>               &#125;);<br>           &#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”å¯¹è±¡çš„runæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (address == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// Paranoia</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    unsafe.freeMemory(address); <span class="hljs-comment">//é‡Šæ”¾ç›´æ¥å†…å­˜ä¸­å ç”¨çš„å†…å­˜</span><br>    address = <span class="hljs-number">0</span>;<br>    Bits.unreserveMemory(size, capacity);<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"><a href="#ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“" class="headerlink" title="ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“"></a>ç›´æ¥å†…å­˜çš„å›æ”¶æœºåˆ¶æ€»ç»“</h5><ul><li>ä½¿ç”¨äº†Unsafeç±»æ¥å®Œæˆç›´æ¥å†…å­˜çš„åˆ†é…å›æ”¶ï¼Œå›æ”¶éœ€è¦ä¸»åŠ¨è°ƒç”¨freeMemoryæ–¹æ³•</li><li>ByteBufferçš„å®ç°å†…éƒ¨ä½¿ç”¨äº†Cleanerï¼ˆè™šå¼•ç”¨ï¼‰æ¥æ£€æµ‹ByteBufferã€‚ä¸€æ—¦ByteBufferè¢«åƒåœ¾å›æ”¶ï¼Œé‚£ä¹ˆä¼šç”±ReferenceHandleræ¥è°ƒç”¨Cleanerçš„cleanæ–¹æ³•è°ƒç”¨freeMemoryæ¥é‡Šæ”¾å†…å­˜</li></ul><h2 id="ä¸‰ã€åƒåœ¾å›æ”¶"><a href="#ä¸‰ã€åƒåœ¾å›æ”¶" class="headerlink" title="ä¸‰ã€åƒåœ¾å›æ”¶"></a>ä¸‰ã€åƒåœ¾å›æ”¶</h2><h3 id="1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"><a href="#1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶" class="headerlink" title="1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶"></a>1ã€å¦‚ä½•åˆ¤æ–­å¯¹è±¡å¯ä»¥å›æ”¶</h3><h4 id="å¼•ç”¨è®¡æ•°æ³•"><a href="#å¼•ç”¨è®¡æ•°æ³•" class="headerlink" title="å¼•ç”¨è®¡æ•°æ³•"></a>å¼•ç”¨è®¡æ•°æ³•</h4><p>å¼Šç«¯ï¼šå¾ªç¯å¼•ç”¨æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡çš„è®¡æ•°éƒ½ä¸º1ï¼Œå¯¼è‡´ä¸¤ä¸ªå¯¹è±¡éƒ½æ— æ³•è¢«é‡Šæ”¾</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150750.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150750.png" alt="img"></a></p><h4 id="å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="å¯è¾¾æ€§åˆ†æç®—æ³•"></a>å¯è¾¾æ€§åˆ†æç®—æ³•</h4><ul><li>JVMä¸­çš„åƒåœ¾å›æ”¶å™¨é€šè¿‡<strong>å¯è¾¾æ€§åˆ†æ</strong>æ¥æ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡</li><li>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹èƒ½å¦æ²¿ç€GC Rootå¯¹è±¡ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¦‚æœ<strong>æ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å›æ”¶</strong></li><li>å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡<ul><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚ã€€</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li></ul></li></ul><h4 id="äº”ç§å¼•ç”¨"><a href="#äº”ç§å¼•ç”¨" class="headerlink" title="äº”ç§å¼•ç”¨"></a>äº”ç§å¼•ç”¨</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150800.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150800.png" alt="img"></a></p><h5 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h5><p>åªæœ‰GC Root<strong>éƒ½ä¸å¼•ç”¨</strong>è¯¥å¯¹è±¡æ—¶ï¼Œæ‰ä¼šå›æ”¶<strong>å¼ºå¼•ç”¨</strong>å¯¹è±¡</p><ul><li>å¦‚ä¸Šå›¾Bã€Cå¯¹è±¡éƒ½ä¸å¼•ç”¨A1å¯¹è±¡æ—¶ï¼ŒA1å¯¹è±¡æ‰ä¼šè¢«å›æ”¶</li></ul><h5 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h5><p>å½“GC RootæŒ‡å‘è½¯å¼•ç”¨å¯¹è±¡æ—¶ï¼Œåœ¨<strong>å†…å­˜ä¸è¶³æ—¶</strong>ï¼Œä¼š<strong>å›æ”¶è½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</strong></p><ul><li>å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A2å¯¹è±¡ä¸”å†…å­˜ä¸è¶³æ—¶ï¼Œè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„A2å¯¹è±¡å°±ä¼šè¢«å›æ”¶</li></ul><h6 id="è½¯å¼•ç”¨çš„ä½¿ç”¨"><a href="#è½¯å¼•ç”¨çš„ä½¿ç”¨" class="headerlink" title="è½¯å¼•ç”¨çš„ä½¿ç”¨"></a>è½¯å¼•ç”¨çš„ä½¿ç”¨</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> _4M = <span class="hljs-number">4</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>;<br><span class="hljs-comment">//ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span><br>List&lt;SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt; ref= <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[_4M]);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨åƒåœ¾å›æ”¶æ—¶å‘ç°å†…å­˜ä¸è¶³ï¼Œåœ¨å›æ”¶è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡æ—¶ï¼Œ<strong>è½¯å¼•ç”¨æœ¬èº«ä¸ä¼šè¢«æ¸…ç†</strong></p><p>å¦‚æœæƒ³è¦<strong>æ¸…ç†è½¯å¼•ç”¨</strong>ï¼Œéœ€è¦ä½¿<strong>ç”¨å¼•ç”¨é˜Ÿåˆ—</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> _4M = <span class="hljs-number">4</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>;<br><span class="hljs-comment">//ä½¿ç”¨å¼•ç”¨é˜Ÿåˆ—ï¼Œç”¨äºç§»é™¤å¼•ç”¨ä¸ºç©ºçš„è½¯å¼•ç”¨å¯¹è±¡</span><br>ReferenceQueue&lt;<span class="hljs-keyword">byte</span>[]&gt; queue = <span class="hljs-keyword">new</span> ReferenceQueue&lt;&gt;();<br><span class="hljs-comment">//ä½¿ç”¨è½¯å¼•ç”¨å¯¹è±¡ listå’ŒSoftReferenceæ˜¯å¼ºå¼•ç”¨ï¼Œè€ŒSoftReferenceå’Œbyteæ•°ç»„åˆ™æ˜¯è½¯å¼•ç”¨</span><br>List&lt;SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>SoftReference&lt;<span class="hljs-keyword">byte</span>[]&gt; ref= <span class="hljs-keyword">new</span> SoftReference&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[_4M]);<br><br><span class="hljs-comment">//éå†å¼•ç”¨é˜Ÿåˆ—ï¼Œå¦‚æœæœ‰å…ƒç´ ï¼Œåˆ™ç§»é™¤</span><br>Reference&lt;? extends <span class="hljs-keyword">byte</span>[]&gt; poll = queue.poll();<br><span class="hljs-keyword">while</span>(poll != <span class="hljs-keyword">null</span>) &#123;<br><span class="hljs-comment">//å¼•ç”¨é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œåˆ™ä»é›†åˆä¸­ç§»é™¤è¯¥å…ƒç´ </span><br>list.remove(poll);<br><span class="hljs-comment">//ç§»åŠ¨åˆ°å¼•ç”¨é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span><br>poll = queue.poll();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¤§æ¦‚æ€è·¯ä¸ºï¼š</strong>æŸ¥çœ‹å¼•ç”¨é˜Ÿåˆ—ä¸­æœ‰æ— è½¯å¼•ç”¨ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å°†è¯¥è½¯å¼•ç”¨ä»å­˜æ”¾å®ƒçš„é›†åˆä¸­ç§»é™¤ï¼ˆè¿™é‡Œä¸ºä¸€ä¸ªlisté›†åˆï¼‰</p><h5 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h5><p>åªæœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œåœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œ<strong>æ— è®ºå†…å­˜æ˜¯å¦å……è¶³</strong>ï¼Œéƒ½ä¼šå›æ”¶å¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡</p><ul><li>å¦‚ä¸Šå›¾å¦‚æœBå¯¹è±¡ä¸å†å¼•ç”¨A3å¯¹è±¡ï¼Œåˆ™A3å¯¹è±¡ä¼šè¢«å›æ”¶</li></ul><p><strong>å¼±å¼•ç”¨çš„ä½¿ç”¨å’Œè½¯å¼•ç”¨ç±»ä¼¼</strong>ï¼Œåªæ˜¯å°† <strong>SoftReference æ¢ä¸ºäº† WeakReference</strong></p><h5 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a><strong>è™šå¼•ç”¨</strong></h5><p>å½“è™šå¼•ç”¨å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œè°ƒç”¨è™šå¼•ç”¨çš„æ–¹æ³•</p><ul><li>è™šå¼•ç”¨çš„ä¸€ä¸ªä½“ç°æ˜¯<strong>é‡Šæ”¾ç›´æ¥å†…å­˜æ‰€åˆ†é…çš„å†…å­˜</strong>ï¼Œå½“å¼•ç”¨çš„å¯¹è±¡ByteBufferè¢«åƒåœ¾å›æ”¶ä»¥åï¼Œè™šå¼•ç”¨å¯¹è±¡Cleanerå°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨Cleanerçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li><li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨ByteBufferå¯¹è±¡ï¼ŒByteBufferå°±ä¼šè¢«å›æ”¶ã€‚ä½†æ˜¯ç›´æ¥å†…å­˜ä¸­çš„å†…å­˜è¿˜æœªè¢«å›æ”¶ã€‚è¿™æ—¶éœ€è¦å°†è™šå¼•ç”¨å¯¹è±¡Cleaneræ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åè°ƒç”¨å®ƒçš„cleanæ–¹æ³•æ¥é‡Šæ”¾ç›´æ¥å†…å­˜</li></ul><h5 id="ç»ˆç»“å™¨å¼•ç”¨"><a href="#ç»ˆç»“å™¨å¼•ç”¨" class="headerlink" title="ç»ˆç»“å™¨å¼•ç”¨"></a>ç»ˆç»“å™¨å¼•ç”¨</h5><p>æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿è‡ªObjectç±»ï¼ŒObjectç±»æœ‰ä¸€ä¸ªfinalizeæ–¹æ³•ã€‚å½“æŸä¸ªå¯¹è±¡ä¸å†è¢«å…¶ä»–çš„å¯¹è±¡æ‰€å¼•ç”¨æ—¶ï¼Œä¼šå…ˆå°†ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ”¾å…¥é¥®ç”¨é˜Ÿåˆ—ä¸­ï¼Œç„¶åæ ¹æ®ç»ˆç»“å™¨å¼•ç”¨å¯¹è±¡æ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</p><ul><li>å¦‚ä¸Šå›¾ï¼ŒBå¯¹è±¡ä¸å†å¼•ç”¨A4å¯¹è±¡ã€‚è¿™æ˜¯ç»ˆç»“å™¨å¯¹è±¡å°±ä¼šè¢«æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œå¼•ç”¨é˜Ÿåˆ—ä¼šæ ¹æ®å®ƒï¼Œæ‰¾åˆ°å®ƒæ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åè°ƒç”¨è¢«å¼•ç”¨å¯¹è±¡çš„finalizeæ–¹æ³•ã€‚è°ƒç”¨ä»¥åï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«åƒåœ¾å›æ”¶äº†</li></ul><h5 id="å¼•ç”¨é˜Ÿåˆ—"><a href="#å¼•ç”¨é˜Ÿåˆ—" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ—"></a>å¼•ç”¨é˜Ÿåˆ—</h5><ul><li>è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨<strong>å¯ä»¥é…åˆ</strong>å¼•ç”¨é˜Ÿåˆ—<ul><li>åœ¨<strong>å¼±å¼•ç”¨</strong>å’Œ<strong>è™šå¼•ç”¨</strong>æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶ä»¥åï¼Œä¼šå°†è¿™äº›å¼•ç”¨æ”¾å…¥å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼Œæ–¹ä¾¿ä¸€èµ·å›æ”¶è¿™äº›è½¯/å¼±å¼•ç”¨å¯¹è±¡</li></ul></li><li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨<strong>å¿…é¡»é…åˆ</strong>å¼•ç”¨é˜Ÿåˆ—<ul><li>è™šå¼•ç”¨å’Œç»ˆç»“å™¨å¼•ç”¨åœ¨ä½¿ç”¨æ—¶ä¼šå…³è”ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—</li></ul></li></ul><h3 id="2ã€åƒåœ¾å›æ”¶ç®—æ³•"><a href="#2ã€åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="2ã€åƒåœ¾å›æ”¶ç®—æ³•"></a>2ã€åƒåœ¾å›æ”¶ç®—æ³•</h3><h4 id="æ ‡è®°-æ¸…é™¤"><a href="#æ ‡è®°-æ¸…é™¤" class="headerlink" title="æ ‡è®°-æ¸…é™¤"></a>æ ‡è®°-æ¸…é™¤</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150813.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150813.png" alt="img"></a></p><p><strong>å®šä¹‰</strong>ï¼šæ ‡è®°æ¸…é™¤ç®—æ³•é¡¾åæ€ä¹‰ï¼Œæ˜¯æŒ‡åœ¨è™šæ‹Ÿæœºæ‰§è¡Œåƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆé‡‡ç”¨æ ‡è®°ç®—æ³•ç¡®å®šå¯å›æ”¶å¯¹è±¡ï¼Œç„¶ååƒåœ¾æ”¶é›†å™¨æ ¹æ®æ ‡è¯†æ¸…é™¤ç›¸åº”çš„å†…å®¹ï¼Œç»™å †å†…å­˜è…¾å‡ºç›¸åº”çš„ç©ºé—´</p><ul><li>è¿™é‡Œçš„è…¾å‡ºå†…å­˜ç©ºé—´å¹¶ä¸æ˜¯å°†å†…å­˜ç©ºé—´çš„å­—èŠ‚æ¸…0ï¼Œè€Œæ˜¯è®°å½•ä¸‹è¿™æ®µå†…å­˜çš„èµ·å§‹ç»“æŸåœ°å€ï¼Œä¸‹æ¬¡åˆ†é…å†…å­˜çš„æ—¶å€™ï¼Œä¼šç›´æ¥<strong>è¦†ç›–</strong>è¿™æ®µå†…å­˜</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š<strong>å®¹æ˜“äº§ç”Ÿå¤§é‡çš„å†…å­˜ç¢ç‰‡</strong>ï¼Œå¯èƒ½æ— æ³•æ»¡è¶³å¤§å¯¹è±¡çš„å†…å­˜åˆ†é…ï¼Œä¸€æ—¦å¯¼è‡´æ— æ³•åˆ†é…å¯¹è±¡ï¼Œé‚£å°±ä¼šå¯¼è‡´jvmå¯åŠ¨gcï¼Œä¸€æ—¦å¯åŠ¨gcï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±ä¼šæš‚åœï¼Œè¿™å°±å¯¼è‡´åº”ç”¨çš„å“åº”é€Ÿåº¦å˜æ…¢</p><h4 id="æ ‡è®°-æ•´ç†"><a href="#æ ‡è®°-æ•´ç†" class="headerlink" title="æ ‡è®°-æ•´ç†"></a>æ ‡è®°-æ•´ç†</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150827.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150827.png" alt="img"></a></p><p>æ ‡è®°-æ•´ç† ä¼šå°†ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡å›æ”¶ï¼Œæ¸…æ¥šå…¶å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ç„¶åæ•´ç†å‰©ä½™çš„å¯¹è±¡ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å› å†…å­˜ç¢ç‰‡è€Œå¯¼è‡´çš„é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ•´ä½“éœ€è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œæ‰€ä»¥æ•ˆç‡è¾ƒä½</p><h4 id="å¤åˆ¶"><a href="#å¤åˆ¶" class="headerlink" title="å¤åˆ¶"></a>å¤åˆ¶</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150842.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150842.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150856.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150856.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150907.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150907.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150919.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150919.png" alt="img"></a></p><p>å°†å†…å­˜åˆ†ä¸ºç­‰å¤§å°çš„ä¸¤ä¸ªåŒºåŸŸï¼ŒFROMå’ŒTOï¼ˆTOä¸­ä¸ºç©ºï¼‰ã€‚å…ˆå°†è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ä»FROMæ”¾å…¥TOä¸­ï¼Œå†å›æ”¶ä¸è¢«GC Rootå¼•ç”¨çš„å¯¹è±¡ã€‚ç„¶åäº¤æ¢FROMå’ŒTOã€‚è¿™æ ·ä¹Ÿå¯ä»¥é¿å…å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œä½†æ˜¯ä¼šå ç”¨åŒå€çš„å†…å­˜ç©ºé—´ã€‚</p><h3 id="3ã€åˆ†ä»£å›æ”¶"><a href="#3ã€åˆ†ä»£å›æ”¶" class="headerlink" title="3ã€åˆ†ä»£å›æ”¶"></a>3ã€åˆ†ä»£å›æ”¶</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150931.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150931.png" alt="img"></a></p><h4 id="å›æ”¶æµç¨‹"><a href="#å›æ”¶æµç¨‹" class="headerlink" title="å›æ”¶æµç¨‹"></a>å›æ”¶æµç¨‹</h4><p>æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½è¢«æ”¾åœ¨äº†<strong>æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­</strong>ä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150939.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150939.png" alt="img"></a></p><p>å½“ä¼Šç”¸å›­ä¸­çš„å†…å­˜ä¸è¶³æ—¶ï¼Œå°±ä¼šè¿›è¡Œä¸€æ¬¡åƒåœ¾å›æ”¶ï¼Œè¿™æ—¶çš„å›æ”¶å«åš <strong>Minor GC</strong></p><p>Minor GC ä¼šå°†<strong>ä¼Šç”¸å›­å’Œå¹¸å­˜åŒºFROM</strong>å­˜æ´»çš„å¯¹è±¡<strong>å…ˆ</strong>å¤åˆ¶åˆ° <strong>å¹¸å­˜åŒº TO</strong>ä¸­ï¼Œ å¹¶è®©å…¶<strong>å¯¿å‘½åŠ 1</strong>ï¼Œå†<strong>äº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒº</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150946.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150946.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150955.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150955.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151002.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151002.png" alt="img"></a></p><p>å†æ¬¡åˆ›å»ºå¯¹è±¡ï¼Œè‹¥æ–°ç”Ÿä»£çš„ä¼Šç”¸å›­åˆæ»¡äº†ï¼Œåˆ™ä¼š<strong>å†æ¬¡è§¦å‘ Minor GC</strong>ï¼ˆä¼šè§¦å‘ <strong>stop the world</strong>ï¼Œ æš‚åœå…¶ä»–ç”¨æˆ·çº¿ç¨‹ï¼Œåªè®©åƒåœ¾å›æ”¶çº¿ç¨‹å·¥ä½œï¼‰ï¼Œè¿™æ—¶ä¸ä»…ä¼šå›æ”¶ä¼Šç”¸å›­ä¸­çš„åƒåœ¾ï¼Œ<strong>è¿˜ä¼šå›æ”¶å¹¸å­˜åŒºä¸­çš„åƒåœ¾</strong>ï¼Œå†å°†æ´»è·ƒå¯¹è±¡å¤åˆ¶åˆ°å¹¸å­˜åŒºTOä¸­ã€‚å›æ”¶ä»¥åä¼šäº¤æ¢ä¸¤ä¸ªå¹¸å­˜åŒºï¼Œå¹¶è®©å¹¸å­˜åŒºä¸­çš„å¯¹è±¡<strong>å¯¿å‘½åŠ 1</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151010.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151010.png" alt="img"></a></p><p>å¦‚æœå¹¸å­˜åŒºä¸­çš„å¯¹è±¡çš„<strong>å¯¿å‘½è¶…è¿‡æŸä¸ªé˜ˆå€¼</strong>ï¼ˆæœ€å¤§ä¸º15ï¼Œ4bitï¼‰ï¼Œå°±ä¼šè¢«<strong>æ”¾å…¥è€å¹´ä»£</strong>ä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151018.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151018.png" alt="img"></a></p><p>å¦‚æœæ–°ç”Ÿä»£è€å¹´ä»£ä¸­çš„å†…å­˜éƒ½æ»¡äº†ï¼Œå°±ä¼šå…ˆå‡ºæ³•Minor Gcï¼Œå†è§¦å‘<strong>Full GC</strong>ï¼Œæ‰«æ<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸­</strong>æ‰€æœ‰ä¸å†ä½¿ç”¨çš„å¯¹è±¡å¹¶å›æ”¶</p><h4 id="GC-åˆ†æ"><a href="#GC-åˆ†æ" class="headerlink" title="GC åˆ†æ"></a>GC åˆ†æ</h4><h5 id="å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"><a href="#å¤§å¯¹è±¡å¤„ç†ç­–ç•¥" class="headerlink" title="å¤§å¯¹è±¡å¤„ç†ç­–ç•¥"></a>å¤§å¯¹è±¡å¤„ç†ç­–ç•¥</h5><p>å½“é‡åˆ°ä¸€ä¸ª<strong>è¾ƒå¤§çš„å¯¹è±¡</strong>æ—¶ï¼Œå°±ç®—æ–°ç”Ÿä»£çš„<strong>ä¼Šç”¸å›­</strong>ä¸ºç©ºï¼Œä¹Ÿ<strong>æ— æ³•å®¹çº³è¯¥å¯¹è±¡</strong>æ—¶ï¼Œä¼šå°†è¯¥å¯¹è±¡<strong>ç›´æ¥æ™‹å‡ä¸ºè€å¹´ä»£</strong></p><h5 id="çº¿ç¨‹å†…å­˜æº¢å‡º"><a href="#çº¿ç¨‹å†…å­˜æº¢å‡º" class="headerlink" title="çº¿ç¨‹å†…å­˜æº¢å‡º"></a>çº¿ç¨‹å†…å­˜æº¢å‡º</h5><p>æŸä¸ªçº¿ç¨‹çš„å†…å­˜æº¢å‡ºäº†è€ŒæŠ›å¼‚å¸¸ï¼ˆout of memoryï¼‰ï¼Œä¸ä¼šè®©å…¶ä»–çš„çº¿ç¨‹ç»“æŸè¿è¡Œ</p><p>è¿™æ˜¯å› ä¸ºå½“ä¸€ä¸ªçº¿ç¨‹<strong>æŠ›å‡ºOOMå¼‚å¸¸å</strong>ï¼Œ<strong>å®ƒæ‰€å æ®çš„å†…å­˜èµ„æºä¼šå…¨éƒ¨è¢«é‡Šæ”¾æ‰</strong>ï¼Œä»è€Œä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œï¼Œ<strong>è¿›ç¨‹ä¾ç„¶æ­£å¸¸</strong></p><h3 id="4ã€åƒåœ¾å›æ”¶å™¨"><a href="#4ã€åƒåœ¾å›æ”¶å™¨" class="headerlink" title="4ã€åƒåœ¾å›æ”¶å™¨"></a>4ã€åƒåœ¾å›æ”¶å™¨</h3><h4 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h4><p><strong>å¹¶è¡Œæ”¶é›†</strong>ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶<strong>ç”¨æˆ·çº¿ç¨‹ä»å¤„äºç­‰å¾…çŠ¶æ€</strong>ã€‚</p><p><strong>å¹¶å‘æ”¶é›†</strong>ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹<strong>åŒæ—¶å·¥ä½œ</strong>ï¼ˆä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„å¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ã€‚<strong>ç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œ</strong>ï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œåœ¨å¦ä¸€ä¸ªCPUä¸Š</p><p><strong>ååé‡</strong>ï¼šå³CPUç”¨äº<strong>è¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´</strong>ä¸CPU<strong>æ€»æ¶ˆè€—æ—¶é—´</strong>çš„æ¯”å€¼ï¼ˆååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ / ( è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ )ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€‚ä¾‹å¦‚ï¼šè™šæ‹Ÿæœºå…±è¿è¡Œ100åˆ†é’Ÿï¼Œåƒåœ¾æ”¶é›†å™¨èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ä¹ˆååé‡å°±æ˜¯99%</p><h4 id="ä¸²è¡Œ"><a href="#ä¸²è¡Œ" class="headerlink" title="ä¸²è¡Œ"></a>ä¸²è¡Œ</h4><ul><li>å•çº¿ç¨‹</li><li>å†…å­˜è¾ƒå°ï¼Œä¸ªäººç”µè„‘ï¼ˆCPUæ ¸æ•°è¾ƒå°‘ï¼‰</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151027.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151027.png" alt="img"></a></p><p><strong>å®‰å…¨ç‚¹</strong>ï¼šè®©å…¶ä»–çº¿ç¨‹éƒ½åœ¨è¿™ä¸ªç‚¹åœä¸‹æ¥ï¼Œä»¥å…åƒåœ¾å›æ”¶æ—¶ç§»åŠ¨å¯¹è±¡åœ°å€ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ‰¾ä¸åˆ°è¢«ç§»åŠ¨çš„å¯¹è±¡</p><p>å› ä¸ºæ˜¯ä¸²è¡Œçš„ï¼Œæ‰€ä»¥åªæœ‰ä¸€ä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹ã€‚ä¸”åœ¨è¯¥çº¿ç¨‹æ‰§è¡Œå›æ”¶å·¥ä½œæ—¶ï¼Œå…¶ä»–çº¿ç¨‹è¿›å…¥<strong>é˜»å¡</strong>çŠ¶æ€</p><h5 id="Serial-æ”¶é›†å™¨"><a href="#Serial-æ”¶é›†å™¨" class="headerlink" title="Serial æ”¶é›†å™¨"></a>Serial æ”¶é›†å™¨</h5><p>Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬çš„ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨</p><p><strong>ç‰¹ç‚¹ï¼š</strong>å•çº¿ç¨‹ã€ç®€å•é«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰ï¼Œé‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ã€‚å¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ‰‹æœºæ•ˆç‡ã€‚æ”¶é›†å™¨è¿›è¡Œåƒåœ¾å›æ”¶æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒç»“æŸï¼ˆStop The Worldï¼‰</p><h5 id="ParNew-æ”¶é›†å™¨"><a href="#ParNew-æ”¶é›†å™¨" class="headerlink" title="ParNew æ”¶é›†å™¨"></a>ParNew æ”¶é›†å™¨</h5><p>ParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</p><p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ã€ParNewæ”¶é›†å™¨é»˜è®¤å¼€å¯çš„æ”¶é›†çº¿ç¨‹æ•°ä¸CPUçš„æ•°é‡ç›¸åŒï¼Œåœ¨CPUéå¸¸å¤šçš„ç¯å¢ƒä¸­ï¼Œå¯ä»¥ä½¿ç”¨-XX:ParallelGCThreadså‚æ•°æ¥é™åˆ¶åƒåœ¾æ”¶é›†çš„çº¿ç¨‹æ•°ã€‚å’ŒSerialæ”¶é›†å™¨ä¸€æ ·å­˜åœ¨Stop The Worldé—®é¢˜</p><h5 id="Serial-Old-æ”¶é›†å™¨"><a href="#Serial-Old-æ”¶é›†å™¨" class="headerlink" title="Serial Old æ”¶é›†å™¨"></a>Serial Old æ”¶é›†å™¨</h5><p>Serial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p><p><strong>ç‰¹ç‚¹</strong>ï¼šåŒæ ·æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong></p><h4 id="ååé‡ä¼˜å…ˆ"><a href="#ååé‡ä¼˜å…ˆ" class="headerlink" title="ååé‡ä¼˜å…ˆ"></a>ååé‡ä¼˜å…ˆ</h4><ul><li>å¤šçº¿ç¨‹</li><li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li><li>å•ä½æ—¶é—´å†…ï¼ŒSTWï¼ˆstop the worldï¼Œåœæ‰å…¶ä»–æ‰€æœ‰å·¥ä½œçº¿ç¨‹ï¼‰æ—¶é—´æœ€çŸ­</li><li><strong>JDK1.8é»˜è®¤ä½¿ç”¨</strong>çš„åƒåœ¾å›æ”¶å™¨</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151039.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151039.png" alt="img"></a></p><h5 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge æ”¶é›†å™¨"></a>Parallel Scavenge æ”¶é›†å™¨</h5><p>ä¸ååé‡å…³ç³»å¯†åˆ‡ï¼Œæ•…ä¹Ÿç§°ä¸ºååé‡ä¼˜å…ˆæ”¶é›†å™¨</p><p><strong>ç‰¹ç‚¹</strong>ï¼šå±äºæ–°ç”Ÿä»£æ”¶é›†å™¨ä¹Ÿæ˜¯é‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>çš„æ”¶é›†å™¨ï¼ˆç”¨åˆ°äº†æ–°ç”Ÿä»£çš„å¹¸å­˜åŒºï¼‰ï¼Œåˆæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼ˆä¸ParNewæ”¶é›†å™¨ç±»ä¼¼ï¼‰</p><p>è¯¥æ”¶é›†å™¨çš„ç›®æ ‡æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ã€‚è¿˜æœ‰ä¸€ä¸ªå€¼å¾—å…³æ³¨çš„ç‚¹æ˜¯ï¼š<strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼ˆä¸ParNewæ”¶é›†å™¨æœ€é‡è¦çš„ä¸€ä¸ªåŒºåˆ«ï¼‰</p><p><strong>GCè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥</strong>ï¼šParallel Scavengeæ”¶é›†å™¨å¯è®¾ç½®-XX:+UseAdptiveSizePolicyå‚æ•°ã€‚å½“å¼€å…³æ‰“å¼€æ—¶<strong>ä¸éœ€è¦</strong>æ‰‹åŠ¨æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ï¼ˆ-Xmnï¼‰ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ï¼ˆ-XX:SurvivorRationï¼‰ã€æ™‹å‡è€å¹´ä»£çš„å¯¹è±¡å¹´é¾„ï¼ˆ-XX:PretenureSizeThresholdï¼‰ç­‰ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®ç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è®¾ç½®è¿™äº›å‚æ•°ä»¥æä¾›æœ€ä¼˜çš„åœé¡¿æ—¶é—´å’Œæœ€é«˜çš„ååé‡ï¼Œè¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºGCçš„è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚</p><p>Parallel Scavengeæ”¶é›†å™¨ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æ§åˆ¶ååé‡ï¼š</p><ul><li>XX:MaxGCPauseMillis æ§åˆ¶æœ€å¤§çš„åƒåœ¾æ”¶é›†åœé¡¿æ—¶é—´</li><li>XX:GCRatio ç›´æ¥è®¾ç½®ååé‡çš„å¤§å°</li></ul><h5 id="Parallel-Old-æ”¶é›†å™¨"><a href="#Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="Parallel Old æ”¶é›†å™¨"></a><strong>Parallel Old æ”¶é›†å™¨</strong></h5><p>æ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p><p><strong>ç‰¹ç‚¹</strong>ï¼šå¤šçº¿ç¨‹ï¼Œé‡‡ç”¨<strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼ˆè€å¹´ä»£æ²¡æœ‰å¹¸å­˜åŒºï¼‰</p><h4 id="å“åº”æ—¶é—´ä¼˜å…ˆ"><a href="#å“åº”æ—¶é—´ä¼˜å…ˆ" class="headerlink" title="å“åº”æ—¶é—´ä¼˜å…ˆ"></a>å“åº”æ—¶é—´ä¼˜å…ˆ</h4><ul><li>å¤šçº¿ç¨‹</li><li>å †å†…å­˜è¾ƒå¤§ï¼Œå¤šæ ¸CPU</li><li>å°½å¯èƒ½è®©å•æ¬¡STWæ—¶é—´å˜çŸ­ï¼ˆå°½é‡ä¸å½±å“å…¶ä»–çº¿ç¨‹è¿è¡Œï¼‰</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151052.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151052.png" alt="img"></a></p><h5 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS æ”¶é›†å™¨"></a>CMS æ”¶é›†å™¨</h5><p>Concurrent Mark Sweepï¼Œä¸€ç§ä»¥è·å–<strong>æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„<strong>è€å¹´ä»£</strong>æ”¶é›†å™¨</p><p><strong>ç‰¹ç‚¹</strong>ï¼šåŸºäº<strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>å®ç°ã€‚å¹¶å‘æ”¶é›†ã€ä½åœé¡¿ï¼Œä½†æ˜¯ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</p><p><strong>åº”ç”¨åœºæ™¯</strong>ï¼šé€‚ç”¨äºæ³¨é‡æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œç»™ç”¨æˆ·å¸¦æ¥æ›´å¥½çš„ä½“éªŒç­‰åœºæ™¯ä¸‹ã€‚å¦‚webç¨‹åºã€b/sæœåŠ¡</p><p><strong>CMSæ”¶é›†å™¨çš„è¿è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸‹åˆ—4æ­¥ï¼š</strong></p><p><strong>åˆå§‹æ ‡è®°</strong>ï¼šæ ‡è®°GC Rootsèƒ½ç›´æ¥åˆ°çš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆå¿«ä½†æ˜¯<strong>ä»å­˜åœ¨Stop The Worldé—®é¢˜</strong></p><p><strong>å¹¶å‘æ ‡è®°</strong>ï¼šè¿›è¡ŒGC Roots Tracing çš„è¿‡ç¨‹ï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ä¸”ç”¨æˆ·çº¿ç¨‹å¯å¹¶å‘æ‰§è¡Œ</p><p><strong>é‡æ–°æ ‡è®°</strong>ï¼šä¸ºäº†<strong>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´</strong>å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ã€‚ä»ç„¶å­˜åœ¨Stop The Worldé—®é¢˜</p><p><strong>å¹¶å‘æ¸…é™¤</strong>ï¼šå¯¹æ ‡è®°çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤å›æ”¶</p><p>CMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·<strong>å¹¶å‘æ‰§è¡Œ</strong>çš„</p><h4 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h4><h5 id="å®šä¹‰ï¼š"><a href="#å®šä¹‰ï¼š" class="headerlink" title="å®šä¹‰ï¼š"></a><strong>å®šä¹‰</strong>ï¼š</h5><p>Garbage First</p><p>JDK 9ä»¥åé»˜è®¤ä½¿ç”¨ï¼Œè€Œä¸”æ›¿ä»£äº†CMS æ”¶é›†å™¨</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200909201212.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200909201212.png" alt="img"></a></p><h5 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="headerlink" title="é€‚ç”¨åœºæ™¯"></a>é€‚ç”¨åœºæ™¯</h5><ul><li>åŒæ—¶æ³¨é‡ååé‡å’Œä½å»¶è¿Ÿï¼ˆå“åº”æ—¶é—´ï¼‰</li><li>è¶…å¤§å †å†…å­˜ï¼ˆå†…å­˜å¤§çš„ï¼‰ï¼Œä¼šå°†å †å†…å­˜åˆ’åˆ†ä¸ºå¤šä¸ª<strong>å¤§å°ç›¸ç­‰</strong>çš„åŒºåŸŸ</li><li>æ•´ä½“ä¸Šæ˜¯<strong>æ ‡è®°-æ•´ç†</strong>ç®—æ³•ï¼Œä¸¤ä¸ªåŒºåŸŸä¹‹é—´æ˜¯<strong>å¤åˆ¶</strong>ç®—æ³•</li></ul><p><strong>ç›¸å…³å‚æ•°</strong>ï¼šJDK8 å¹¶ä¸æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œæ‰€éœ€è¦å‚æ•°å¼€å¯</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151100.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151100.png" alt="img"></a></p><h5 id="G1åƒåœ¾å›æ”¶é˜¶æ®µ"><a href="#G1åƒåœ¾å›æ”¶é˜¶æ®µ" class="headerlink" title="G1åƒåœ¾å›æ”¶é˜¶æ®µ"></a>G1åƒåœ¾å›æ”¶é˜¶æ®µ</h5><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151109.png" alt="img"></a></p><p>æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶â€”â€“&gt;å†…å­˜ä¸è¶³ï¼Œæ–°ç”Ÿä»£å›æ”¶+å¹¶å‘æ ‡è®°â€”â€“&gt;å›æ”¶æ–°ç”Ÿä»£ä¼Šç”¸å›­ã€å¹¸å­˜åŒºã€è€å¹´ä»£å†…å­˜â€”â€”&gt;æ–°ç”Ÿä»£ä¼Šç”¸å›­åƒåœ¾å›æ”¶(é‡æ–°å¼€å§‹)</p><h5 id="Young-Collection"><a href="#Young-Collection" class="headerlink" title="Young Collection"></a>Young Collection</h5><p><strong>åˆ†åŒºç®—æ³•region</strong></p><p>åˆ†ä»£æ˜¯æŒ‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ï¼Œåˆ†åŒºåˆ™æ˜¯å°†å †ç©ºé—´åˆ’åˆ†è¿ç»­å‡ ä¸ªä¸åŒå°åŒºé—´ï¼Œæ¯ä¸€ä¸ªå°åŒºé—´ç‹¬ç«‹å›æ”¶ï¼Œå¯ä»¥æ§åˆ¶ä¸€æ¬¡å›æ”¶å¤šå°‘ä¸ªå°åŒºé—´ï¼Œæ–¹ä¾¿æ§åˆ¶ GC äº§ç”Ÿçš„åœé¡¿æ—¶é—´</p><p>Eï¼šä¼Šç”¸å›­ Sï¼šå¹¸å­˜åŒº Oï¼šè€å¹´ä»£</p><ul><li>ä¼šSTW</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151119.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151129.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151129.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151140.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151140.png" alt="img"></a></p><h5 id="Young-Collection-CM"><a href="#Young-Collection-CM" class="headerlink" title="Young Collection + CM"></a>Young Collection + CM</h5><p>CMï¼šå¹¶å‘æ ‡è®°</p><ul><li>åœ¨ Young GC æ—¶ä¼š<strong>å¯¹ GC Root è¿›è¡Œåˆå§‹æ ‡è®°</strong></li><li>åœ¨è€å¹´ä»£<strong>å ç”¨å †å†…å­˜çš„æ¯”ä¾‹</strong>è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œå¯¹è¿›è¡Œå¹¶å‘æ ‡è®°ï¼ˆä¸ä¼šSTWï¼‰ï¼Œé˜ˆå€¼å¯ä»¥æ ¹æ®ç”¨æˆ·æ¥è¿›è¡Œè®¾å®š</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151150.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151150.png" alt="img"></a></p><h5 id="Mixed-Collection"><a href="#Mixed-Collection" class="headerlink" title="Mixed Collection"></a>Mixed Collection</h5><p>ä¼šå¯¹E S O è¿›è¡Œ<strong>å…¨é¢çš„å›æ”¶</strong></p><ul><li>æœ€ç»ˆæ ‡è®°</li><li><strong>æ‹·è´</strong>å­˜æ´»</li></ul><p>-XX:MaxGCPauseMills:xxx ç”¨äºæŒ‡å®šæœ€é•¿çš„åœé¡¿æ—¶é—´</p><p><strong>é—®</strong>ï¼šä¸ºä»€ä¹ˆæœ‰çš„è€å¹´ä»£è¢«æ‹·è´äº†ï¼Œæœ‰çš„æ²¡æ‹·è´ï¼Ÿ</p><p>å› ä¸ºæŒ‡å®šäº†æœ€å¤§åœé¡¿æ—¶é—´ï¼Œå¦‚æœå¯¹æ‰€æœ‰è€å¹´ä»£éƒ½è¿›è¡Œå›æ”¶ï¼Œè€—æ—¶å¯èƒ½è¿‡é«˜ã€‚ä¸ºäº†ä¿è¯æ—¶é—´ä¸è¶…è¿‡è®¾å®šçš„åœé¡¿æ—¶é—´ï¼Œä¼š<strong>å›æ”¶æœ€æœ‰ä»·å€¼çš„è€å¹´ä»£</strong>ï¼ˆå›æ”¶åï¼Œèƒ½å¤Ÿå¾—åˆ°æ›´å¤šå†…å­˜ï¼‰</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151201.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151201.png" alt="img"></a></p><h5 id="Full-GC"><a href="#Full-GC" class="headerlink" title="Full GC"></a>Full GC</h5><p>G1åœ¨è€å¹´ä»£å†…å­˜ä¸è¶³æ—¶ï¼ˆè€å¹´ä»£æ‰€å å†…å­˜è¶…è¿‡é˜ˆå€¼ï¼‰</p><ul><li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦æ…¢äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¸ä¼šè§¦å‘Full GCï¼Œè¿˜æ˜¯å¹¶å‘åœ°è¿›è¡Œæ¸…ç†</li><li>å¦‚æœåƒåœ¾äº§ç”Ÿé€Ÿåº¦å¿«äºåƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œä¾¿ä¼šè§¦å‘Full GC</li></ul><h5 id="Young-Collection-è·¨ä»£å¼•ç”¨"><a href="#Young-Collection-è·¨ä»£å¼•ç”¨" class="headerlink" title="Young Collection è·¨ä»£å¼•ç”¨"></a>Young Collection è·¨ä»£å¼•ç”¨</h5><ul><li>æ–°ç”Ÿä»£å›æ”¶çš„è·¨ä»£å¼•ç”¨ï¼ˆè€å¹´ä»£å¼•ç”¨æ–°ç”Ÿä»£ï¼‰é—®é¢˜</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151211.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151211.png" alt="img"></a></p><ul><li>å¡è¡¨ä¸Remembered Set<ul><li>Remembered Set å­˜åœ¨äºEä¸­ï¼Œç”¨äºä¿å­˜æ–°ç”Ÿä»£å¯¹è±¡å¯¹åº”çš„è„å¡<ul><li>è„å¡ï¼šOè¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼ˆä¸€ä¸ªåŒºåŸŸ512Kï¼‰ï¼Œå¦‚æœè¯¥åŒºåŸŸå¼•ç”¨äº†æ–°ç”Ÿä»£å¯¹è±¡ï¼Œåˆ™è¯¥åŒºåŸŸè¢«ç§°ä¸ºè„å¡</li></ul></li></ul></li><li>åœ¨å¼•ç”¨å˜æ›´æ—¶é€šè¿‡post-write barried + dirty card queue</li><li>concurrent refinement threads æ›´æ–° Remembered Set</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151222.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151222.png" alt="img"></a></p><h5 id="Remark"><a href="#Remark" class="headerlink" title="Remark"></a>Remark</h5><p>é‡æ–°æ ‡è®°é˜¶æ®µ</p><p>åœ¨åƒåœ¾å›æ”¶æ—¶ï¼Œæ”¶é›†å™¨å¤„ç†å¯¹è±¡çš„è¿‡ç¨‹ä¸­</p><p>é»‘è‰²ï¼šå·²è¢«å¤„ç†ï¼Œéœ€è¦ä¿ç•™çš„ ç°è‰²ï¼šæ­£åœ¨å¤„ç†ä¸­çš„ ç™½è‰²ï¼šè¿˜æœªå¤„ç†çš„</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151229.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151229.png" alt="img"></a></p><p>ä½†æ˜¯åœ¨<strong>å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­</strong>ï¼Œæœ‰å¯èƒ½Aè¢«å¤„ç†äº†ä»¥åæœªå¼•ç”¨Cï¼Œä½†è¯¥å¤„ç†è¿‡ç¨‹è¿˜æœªç»“æŸï¼Œåœ¨å¤„ç†è¿‡ç¨‹ç»“æŸä¹‹å‰Aå¼•ç”¨äº†Cï¼Œè¿™æ—¶å°±ä¼šç”¨åˆ°remark</p><p>è¿‡ç¨‹å¦‚ä¸‹</p><ul><li>ä¹‹å‰Cæœªè¢«å¼•ç”¨ï¼Œè¿™æ—¶Aå¼•ç”¨äº†Cï¼Œå°±ä¼šç»™CåŠ ä¸€ä¸ªå†™å±éšœï¼Œå†™å±éšœçš„æŒ‡ä»¤ä¼šè¢«æ‰§è¡Œï¼Œå°†Cæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—å½“ä¸­ï¼Œå¹¶å°†Cå˜ä¸º å¤„ç†ä¸­ çŠ¶æ€</li><li>åœ¨<strong>å¹¶å‘æ ‡è®°</strong>é˜¶æ®µç»“æŸä»¥åï¼Œé‡æ–°æ ‡è®°é˜¶æ®µä¼šSTWï¼Œç„¶åå°†æ”¾åœ¨è¯¥é˜Ÿåˆ—ä¸­çš„å¯¹è±¡é‡æ–°å¤„ç†ï¼Œå‘ç°æœ‰å¼ºå¼•ç”¨å¼•ç”¨å®ƒï¼Œå°±ä¼šå¤„ç†å®ƒ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151239.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151239.png" alt="img"></a></p><h5 id="JDK-8u20-å­—ç¬¦ä¸²å»é‡"><a href="#JDK-8u20-å­—ç¬¦ä¸²å»é‡" class="headerlink" title="JDK 8u20 å­—ç¬¦ä¸²å»é‡"></a>JDK 8u20 å­—ç¬¦ä¸²å»é‡</h5><p>è¿‡ç¨‹</p><ul><li>å°†æ‰€æœ‰æ–°åˆ†é…çš„å­—ç¬¦ä¸²ï¼ˆåº•å±‚æ˜¯char[]ï¼‰æ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—</li><li>å½“æ–°ç”Ÿä»£å›æ”¶æ—¶ï¼ŒG1å¹¶å‘æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤çš„å­—ç¬¦ä¸²</li><li>å¦‚æœå­—ç¬¦ä¸²çš„å€¼ä¸€æ ·ï¼Œå°±è®©ä»–ä»¬<strong>å¼•ç”¨åŒä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡</strong></li><li>æ³¨æ„ï¼Œå…¶ä¸String.internçš„åŒºåˆ«<ul><li>internå…³æ³¨çš„æ˜¯å­—ç¬¦ä¸²å¯¹è±¡</li><li>å­—ç¬¦ä¸²å»é‡å…³æ³¨çš„æ˜¯char[]</li><li>åœ¨JVMå†…éƒ¨ï¼Œä½¿ç”¨äº†ä¸åŒçš„å­—ç¬¦ä¸²æ ‡</li></ul></li></ul><p>ä¼˜ç‚¹ä¸ç¼ºç‚¹</p><ul><li>èŠ‚çœäº†å¤§é‡å†…å­˜</li><li>æ–°ç”Ÿä»£å›æ”¶æ—¶é—´ç•¥å¾®å¢åŠ ï¼Œå¯¼è‡´ç•¥å¾®å¤šå ç”¨CPU</li></ul><h5 id="JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½"><a href="#JDK-8u40-å¹¶å‘æ ‡è®°ç±»å¸è½½" class="headerlink" title="JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½"></a>JDK 8u40 å¹¶å‘æ ‡è®°ç±»å¸è½½</h5><p>åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸä»¥åï¼Œå°±èƒ½çŸ¥é“å“ªäº›ç±»ä¸å†è¢«ä½¿ç”¨ã€‚å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨çš„æ‰€æœ‰ç±»éƒ½ä¸åœ¨ä½¿ç”¨ï¼Œåˆ™å¸è½½å®ƒæ‰€åŠ è½½çš„æ‰€æœ‰ç±»</p><h5 id="JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡"><a href="#JDK-8u60-å›æ”¶å·¨å‹å¯¹è±¡" class="headerlink" title="JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡"></a>JDK 8u60 å›æ”¶å·¨å‹å¯¹è±¡</h5><ul><li>ä¸€ä¸ªå¯¹è±¡å¤§äºregionçš„ä¸€åŠæ—¶ï¼Œå°±ç§°ä¸ºå·¨å‹å¯¹è±¡</li><li>G1ä¸ä¼šå¯¹å·¨å‹å¯¹è±¡è¿›è¡Œæ‹·è´</li><li>å›æ”¶æ—¶è¢«ä¼˜å…ˆè€ƒè™‘</li><li>G1ä¼šè·Ÿè¸ªè€å¹´ä»£æ‰€æœ‰incomingå¼•ç”¨ï¼Œå¦‚æœè€å¹´ä»£incomingå¼•ç”¨ä¸º0çš„å·¨å‹å¯¹è±¡å°±å¯ä»¥åœ¨æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶å¤„ç†æ‰</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151249.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151249.png" alt="img"></a></p><h3 id="5ã€GC-è°ƒä¼˜"><a href="#5ã€GC-è°ƒä¼˜" class="headerlink" title="5ã€GC è°ƒä¼˜"></a>5ã€GC è°ƒä¼˜</h3><p>æŸ¥çœ‹è™šæ‹Ÿæœºå‚æ•°å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">&quot;F:\JAVA\JDK8.0\bin\java&quot; -XX:+PrintFlagsFinal -version | findstr &quot;GC&quot;<br></code></pre></td></tr></table></figure><p>å¯ä»¥æ ¹æ®å‚æ•°å»æŸ¥è¯¢å…·ä½“çš„ä¿¡æ¯</p><h4 id="è°ƒä¼˜é¢†åŸŸ"><a href="#è°ƒä¼˜é¢†åŸŸ" class="headerlink" title="è°ƒä¼˜é¢†åŸŸ"></a>è°ƒä¼˜é¢†åŸŸ</h4><ul><li>å†…å­˜</li><li>é”ç«äº‰</li><li>CPUå ç”¨</li><li>IO</li><li>GC</li></ul><h4 id="ç¡®å®šç›®æ ‡"><a href="#ç¡®å®šç›®æ ‡" class="headerlink" title="ç¡®å®šç›®æ ‡"></a>ç¡®å®šç›®æ ‡</h4><p>ä½å»¶è¿Ÿ/é«˜ååé‡ï¼Ÿ é€‰æ‹©åˆé€‚çš„GC</p><ul><li>CMS G1 ZGC</li><li>ParallelGC</li><li>Zing</li></ul><h4 id="æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"><a href="#æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC" class="headerlink" title="æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC"></a>æœ€å¿«çš„GCæ˜¯ä¸å‘ç”ŸGC</h4><p>é¦–å…ˆæ’é™¤å‡å°‘å› ä¸ºè‡ªèº«ç¼–å†™çš„ä»£ç è€Œå¼•å‘çš„å†…å­˜é—®é¢˜</p><ul><li>æŸ¥çœ‹Full GCå‰åçš„å†…å­˜å ç”¨ï¼Œè€ƒè™‘ä»¥ä¸‹å‡ ä¸ªé—®é¢˜<ul><li>æ•°æ®æ˜¯ä¸æ˜¯å¤ªå¤šï¼Ÿ</li><li>æ•°æ®è¡¨ç¤ºæ˜¯å¦å¤ªè‡ƒè‚¿<ul><li>å¯¹è±¡å›¾</li><li>å¯¹è±¡å¤§å°</li></ul></li><li>æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼</li></ul></li></ul><h4 id="æ–°ç”Ÿä»£è°ƒä¼˜"><a href="#æ–°ç”Ÿä»£è°ƒä¼˜" class="headerlink" title="æ–°ç”Ÿä»£è°ƒä¼˜"></a>æ–°ç”Ÿä»£è°ƒä¼˜</h4><ul><li>æ–°ç”Ÿä»£çš„ç‰¹ç‚¹<ul><li>æ‰€æœ‰çš„newæ“ä½œåˆ†é…å†…å­˜éƒ½æ˜¯éå¸¸å»‰ä»·çš„<ul><li>TLAB</li></ul></li><li>æ­»äº¡å¯¹è±¡å›æ”¶é›¶ä»£ä»·</li><li>å¤§éƒ¨åˆ†å¯¹è±¡ç”¨è¿‡å³æ­»ï¼ˆæœç”Ÿå¤•æ­»ï¼‰</li><li>MInor GC æ‰€ç”¨æ—¶é—´è¿œå°äºFull GC</li></ul></li><li>æ–°ç”Ÿä»£å†…å­˜è¶Šå¤§è¶Šå¥½ä¹ˆï¼Ÿ<ul><li>ä¸æ˜¯<ul><li>æ–°ç”Ÿä»£å†…å­˜å¤ªå°ï¼šé¢‘ç¹è§¦å‘Minor GCï¼Œä¼šSTWï¼Œä¼šä½¿å¾—ååé‡ä¸‹é™</li><li>æ–°ç”Ÿä»£å†…å­˜å¤ªå¤§ï¼šè€å¹´ä»£å†…å­˜å æ¯”æœ‰æ‰€é™ä½ï¼Œä¼šæ›´é¢‘ç¹åœ°è§¦å‘Full GCã€‚è€Œä¸”è§¦å‘Minor GCæ—¶ï¼Œæ¸…ç†æ–°ç”Ÿä»£æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ›´é•¿</li></ul></li><li>æ–°ç”Ÿä»£å†…å­˜è®¾ç½®ä¸ºå†…å®¹çº³[å¹¶å‘é‡*(è¯·æ±‚-å“åº”)]çš„æ•°æ®ä¸ºå®œ</li></ul></li></ul><h4 id="å¹¸å­˜åŒºè°ƒä¼˜"><a href="#å¹¸å­˜åŒºè°ƒä¼˜" class="headerlink" title="å¹¸å­˜åŒºè°ƒä¼˜"></a>å¹¸å­˜åŒºè°ƒä¼˜</h4><ul><li>å¹¸å­˜åŒºéœ€è¦èƒ½å¤Ÿä¿å­˜ <strong>å½“å‰æ´»è·ƒå¯¹è±¡</strong>+<strong>éœ€è¦æ™‹å‡çš„å¯¹è±¡</strong></li><li>æ™‹å‡é˜ˆå€¼é…ç½®å¾—å½“ï¼Œè®©é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡å°½å¿«æ™‹å‡</li></ul><h4 id="è€å¹´ä»£è°ƒä¼˜"><a href="#è€å¹´ä»£è°ƒä¼˜" class="headerlink" title="è€å¹´ä»£è°ƒä¼˜"></a>è€å¹´ä»£è°ƒä¼˜</h4><h2 id="å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯"><a href="#å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯" class="headerlink" title="å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯"></a>å››ã€ç±»åŠ è½½ä¸å­—èŠ‚ç æŠ€æœ¯</h2><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151300.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151300.png" alt="img"></a></p><h3 id="1ã€ç±»æ–‡ä»¶ç»“æ„"><a href="#1ã€ç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="1ã€ç±»æ–‡ä»¶ç»“æ„"></a>1ã€ç±»æ–‡ä»¶ç»“æ„</h3><p>é¦–å…ˆè·å¾—.classå­—èŠ‚ç æ–‡ä»¶</p><p>æ–¹æ³•ï¼š</p><ul><li>åœ¨æ–‡æœ¬æ–‡æ¡£é‡Œå†™å…¥javaä»£ç ï¼ˆæ–‡ä»¶åä¸ç±»åä¸€è‡´ï¼‰ï¼Œå°†æ–‡ä»¶ç±»å‹æ”¹ä¸º.java</li><li>javaç»ˆç«¯ä¸­ï¼Œæ‰§è¡Œjavac X:â€¦\XXX.java</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200910155135.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200910155135.png" alt="img"></a></p><p>ä»¥ä¸‹æ˜¯å­—èŠ‚ç æ–‡ä»¶</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0000000</span> ca fe ba be <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">34</span> <span class="hljs-number">00</span> <span class="hljs-number">23</span> <span class="hljs-number">0</span>a <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">15</span> <span class="hljs-number">09</span> <br><span class="hljs-attribute">0000020</span> <span class="hljs-number">00</span> <span class="hljs-number">16</span> <span class="hljs-number">00</span> <span class="hljs-number">17</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">18</span> <span class="hljs-number">0</span>a <span class="hljs-number">00</span> <span class="hljs-number">19</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>a <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>b <span class="hljs-number">07</span> <br><span class="hljs-attribute">0000040</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>c <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">3</span>c <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">69</span> <span class="hljs-number">74</span> <span class="hljs-number">3</span>e <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">03</span> <span class="hljs-number">28</span> <span class="hljs-number">29</span> <br><span class="hljs-attribute">0000060</span> <span class="hljs-number">56</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">43</span> <span class="hljs-number">6</span>f <span class="hljs-number">64</span> <span class="hljs-number">65</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>f <span class="hljs-number">4</span>c <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">65</span> <span class="hljs-number">4</span>e <br><span class="hljs-attribute">0000100</span> <span class="hljs-number">75</span> <span class="hljs-number">6</span>d <span class="hljs-number">62</span> <span class="hljs-number">65</span> <span class="hljs-number">72</span> <span class="hljs-number">54</span> <span class="hljs-number">61</span> <span class="hljs-number">62</span> <span class="hljs-number">6</span>c <span class="hljs-number">65</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">12</span> <span class="hljs-number">4</span>c <span class="hljs-number">6</span>f <span class="hljs-number">63</span> <br><span class="hljs-attribute">0000120</span> <span class="hljs-number">61</span> <span class="hljs-number">6</span>c <span class="hljs-number">56</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">61</span> <span class="hljs-number">62</span> <span class="hljs-number">6</span>c <span class="hljs-number">65</span> <span class="hljs-number">54</span> <span class="hljs-number">61</span> <span class="hljs-number">62</span> <span class="hljs-number">6</span>c <span class="hljs-number">65</span> <span class="hljs-number">01</span> <br><span class="hljs-attribute">0000140</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">74</span> <span class="hljs-number">68</span> <span class="hljs-number">69</span> <span class="hljs-number">73</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>d <span class="hljs-number">4</span>c <span class="hljs-number">63</span> <span class="hljs-number">6</span>e <span class="hljs-number">2</span>f <span class="hljs-number">69</span> <span class="hljs-number">74</span> <span class="hljs-number">63</span> <br><span class="hljs-attribute">0000160</span> <span class="hljs-number">61</span> <span class="hljs-number">73</span> <span class="hljs-number">74</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>a <span class="hljs-number">76</span> <span class="hljs-number">6</span>d <span class="hljs-number">2</span>f <span class="hljs-number">74</span> <span class="hljs-number">35</span> <span class="hljs-number">2</span>f <span class="hljs-number">48</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <span class="hljs-number">6</span>f <br><span class="hljs-attribute">0000200</span> <span class="hljs-number">57</span> <span class="hljs-number">6</span>f <span class="hljs-number">72</span> <span class="hljs-number">6</span>c <span class="hljs-number">64</span> <span class="hljs-number">3</span>b <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">6</span>d <span class="hljs-number">61</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">16</span> <br><span class="hljs-attribute">0000220</span> <span class="hljs-number">28</span> <span class="hljs-number">5</span>b <span class="hljs-number">4</span>c <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <br><span class="hljs-attribute">0000240</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">3</span>b <span class="hljs-number">29</span> <span class="hljs-number">56</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">67</span> <span class="hljs-number">73</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">13</span> <br><span class="hljs-attribute">0000260</span> <span class="hljs-number">5</span>b <span class="hljs-number">4</span>c <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <br><span class="hljs-attribute">0000300</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">3</span>b <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">4</span>d <span class="hljs-number">65</span> <span class="hljs-number">74</span> <span class="hljs-number">68</span> <span class="hljs-number">6</span>f <span class="hljs-number">64</span> <span class="hljs-number">50</span> <span class="hljs-number">61</span> <span class="hljs-number">72</span> <span class="hljs-number">61</span> <br><span class="hljs-attribute">0000320</span> <span class="hljs-number">6</span>d <span class="hljs-number">65</span> <span class="hljs-number">74</span> <span class="hljs-number">65</span> <span class="hljs-number">72</span> <span class="hljs-number">73</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>a <span class="hljs-number">53</span> <span class="hljs-number">6</span>f <span class="hljs-number">75</span> <span class="hljs-number">72</span> <span class="hljs-number">63</span> <span class="hljs-number">65</span> <span class="hljs-number">46</span> <br><span class="hljs-attribute">0000340</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>c <span class="hljs-number">65</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>f <span class="hljs-number">48</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <span class="hljs-number">6</span>f <span class="hljs-number">57</span> <span class="hljs-number">6</span>f <span class="hljs-number">72</span> <span class="hljs-number">6</span>c <span class="hljs-number">64</span><br><span class="hljs-attribute">0000360</span> <span class="hljs-number">2</span>e <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">08</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>d <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">1</span>e <br><span class="hljs-attribute">0000400</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>f <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>b <span class="hljs-number">68</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <span class="hljs-number">6</span>f <span class="hljs-number">20</span> <span class="hljs-number">77</span> <span class="hljs-number">6</span>f <span class="hljs-number">72</span> <span class="hljs-number">6</span>c <span class="hljs-number">64</span> <br><span class="hljs-attribute">0000420</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">20</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">21</span> <span class="hljs-number">00</span> <span class="hljs-number">22</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">1</span>b <span class="hljs-number">63</span> <span class="hljs-number">6</span>e <span class="hljs-number">2</span>f <span class="hljs-number">69</span> <span class="hljs-number">74</span> <br><span class="hljs-attribute">0000440</span> <span class="hljs-number">63</span> <span class="hljs-number">61</span> <span class="hljs-number">73</span> <span class="hljs-number">74</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>a <span class="hljs-number">76</span> <span class="hljs-number">6</span>d <span class="hljs-number">2</span>f <span class="hljs-number">74</span> <span class="hljs-number">35</span> <span class="hljs-number">2</span>f <span class="hljs-number">48</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>c <br><span class="hljs-attribute">0000460</span> <span class="hljs-number">6</span>f <span class="hljs-number">57</span> <span class="hljs-number">6</span>f <span class="hljs-number">72</span> <span class="hljs-number">6</span>c <span class="hljs-number">64</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <br><span class="hljs-attribute">0000500</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">4</span>f <span class="hljs-number">62</span> <span class="hljs-number">6</span>a <span class="hljs-number">65</span> <span class="hljs-number">63</span> <span class="hljs-number">74</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <br><span class="hljs-attribute">0000520</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">79</span> <span class="hljs-number">73</span> <span class="hljs-number">74</span> <span class="hljs-number">65</span> <span class="hljs-number">6</span>d <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">03</span> <span class="hljs-number">6</span>f <br><span class="hljs-attribute">0000540</span> <span class="hljs-number">75</span> <span class="hljs-number">74</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">15</span> <span class="hljs-number">4</span>c <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">69</span> <span class="hljs-number">6</span>f <span class="hljs-number">2</span>f <span class="hljs-number">50</span> <span class="hljs-number">72</span> <br><span class="hljs-attribute">0000560</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">74</span> <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">65</span> <span class="hljs-number">61</span> <span class="hljs-number">6</span>d <span class="hljs-number">3</span>b <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">13</span> <span class="hljs-number">6</span>a <span class="hljs-number">61</span> <span class="hljs-number">76</span> <br><span class="hljs-attribute">0000600</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">69</span> <span class="hljs-number">6</span>f <span class="hljs-number">2</span>f <span class="hljs-number">50</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">74</span> <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">65</span> <span class="hljs-number">61</span> <span class="hljs-number">6</span>d <br><span class="hljs-attribute">0000620</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">07</span> <span class="hljs-number">70</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">74</span> <span class="hljs-number">6</span>c <span class="hljs-number">6</span>e <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">15</span> <span class="hljs-number">28</span> <span class="hljs-number">4</span>c <span class="hljs-number">6</span>a <br><span class="hljs-attribute">0000640</span> <span class="hljs-number">61</span> <span class="hljs-number">76</span> <span class="hljs-number">61</span> <span class="hljs-number">2</span>f <span class="hljs-number">6</span>c <span class="hljs-number">61</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">2</span>f <span class="hljs-number">53</span> <span class="hljs-number">74</span> <span class="hljs-number">72</span> <span class="hljs-number">69</span> <span class="hljs-number">6</span>e <span class="hljs-number">67</span> <span class="hljs-number">3</span>b <br><span class="hljs-attribute">0000660</span> <span class="hljs-number">29</span> <span class="hljs-number">56</span> <span class="hljs-number">00</span> <span class="hljs-number">21</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <br><span class="hljs-attribute">0000700</span> <span class="hljs-number">00</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">09</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">2</span>f <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <br><span class="hljs-attribute">0000720</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">2</span>a b<span class="hljs-number">7</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> b<span class="hljs-number">1</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>a <span class="hljs-number">00</span> <br><span class="hljs-attribute">0000740</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>b <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <br><span class="hljs-attribute">0000760</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">0</span>d <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">09</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>e <span class="hljs-number">00</span> <br><span class="hljs-attribute">0001000</span> <span class="hljs-number">0</span>f <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">09</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">37</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">0001020</span> <span class="hljs-number">09</span> b<span class="hljs-number">2</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">12</span> <span class="hljs-number">03</span> b<span class="hljs-number">6</span> <span class="hljs-number">00</span> <span class="hljs-number">04</span> b<span class="hljs-number">1</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>a <br><span class="hljs-attribute">0001040</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>a <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">06</span> <span class="hljs-number">00</span> <span class="hljs-number">08</span> <span class="hljs-number">00</span> <span class="hljs-number">07</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>b <br><span class="hljs-attribute">0001060</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">0</span>c <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">09</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">00</span> <span class="hljs-number">11</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">0001100</span> <span class="hljs-number">00</span> <span class="hljs-number">12</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">05</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">10</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">13</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">0001120</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">14</span> <br></code></pre></td></tr></table></figure><p>æ ¹æ® JVM è§„èŒƒï¼Œ<strong>ç±»æ–‡ä»¶ç»“æ„</strong>å¦‚ä¸‹</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs abnf">u4  magic<br>u2             minor_version<span class="hljs-comment">;    </span><br>u2             major_version<span class="hljs-comment">;    </span><br>u2             constant_pool_count<span class="hljs-comment">;    </span><br>cp_info        constant_pool[constant_pool_count-<span class="hljs-number">1</span>]<span class="hljs-comment">;    </span><br>u2             access_flags<span class="hljs-comment">;    </span><br>u2             this_class<span class="hljs-comment">;    </span><br>u2             super_class<span class="hljs-comment">;   </span><br>u2             interfaces_count<span class="hljs-comment">;    </span><br>u2             interfaces[interfaces_count]<span class="hljs-comment">;   </span><br>u2             fields_count<span class="hljs-comment">;    </span><br>field_info     fields[fields_count]<span class="hljs-comment">;   </span><br>u2             methods_count<span class="hljs-comment">;    </span><br>method_info    methods[methods_count]<span class="hljs-comment">;    </span><br>u2             attributes_count<span class="hljs-comment">;    </span><br>attribute_info attributes[attributes_count]<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><h4 id="é­”æ•°"><a href="#é­”æ•°" class="headerlink" title="é­”æ•°"></a>é­”æ•°</h4><p>u4 magic</p><p>å¯¹åº”å­—èŠ‚ç æ–‡ä»¶çš„0~3ä¸ªå­—èŠ‚</p><p>0000000 <strong>ca fe ba be</strong> 00 00 00 34 00 23 0a 00 06 00 15 09</p><h4 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h4><p>u2 minor_version;</p><p>u2 major_version;</p><p>0000000 ca fe ba be <strong>00 00 00 34</strong> 00 23 0a 00 06 00 15 09</p><p>34H = 52ï¼Œä»£è¡¨JDK8</p><h4 id="å¸¸é‡æ± -1"><a href="#å¸¸é‡æ± -1" class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h4><p>è§èµ„æ–™æ–‡ä»¶</p><p>â€¦ç•¥</p><h3 id="2ã€å­—èŠ‚ç æŒ‡ä»¤"><a href="#2ã€å­—èŠ‚ç æŒ‡ä»¤" class="headerlink" title="2ã€å­—èŠ‚ç æŒ‡ä»¤"></a>2ã€å­—èŠ‚ç æŒ‡ä»¤</h3><p>å¯å‚è€ƒ</p><p><a href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5">https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5</a></p><h4 id="javapå·¥å…·"><a href="#javapå·¥å…·" class="headerlink" title="javapå·¥å…·"></a>javapå·¥å…·</h4><p>Oracle æä¾›äº† <strong>javap</strong> å·¥å…·æ¥åç¼–è¯‘ class æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs shell">javap -v F:\Thread_study\src\com\nyima\JVM\day01\Main.classCopy<br>F:\Thread_study&gt;javap -v F:\Thread_study\src\com\nyima\JVM\day5\Demo1.class<br>Classfile /F:/Thread_study/src/com/nyima/JVM/day5/Demo1.class<br>  Last modified 2020-6-6; size 434 bytes<br>  MD5 checksum df1dce65bf6fb0b4c1de318051f4a67e<br>  Compiled from &quot;Demo1.java&quot;<br>public class com.nyima.JVM.day5.Demo1<br>  minor version: 0<br>  major version: 52<br>  flags: ACC_PUBLIC, ACC_SUPER<br>Constant pool:<br><span class="hljs-meta">   #</span><span class="bash">1 = Methodref          <span class="hljs-comment">#6.#15         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="hljs-meta">   #</span><span class="bash">2 = Fieldref           <span class="hljs-comment">#16.#17        // java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="hljs-meta">   #</span><span class="bash">3 = String             <span class="hljs-comment">#18            // hello world</span></span><br><span class="hljs-meta">   #</span><span class="bash">4 = Methodref          <span class="hljs-comment">#19.#20        // java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="hljs-meta">   #</span><span class="bash">5 = Class              <span class="hljs-comment">#21            // com/nyima/JVM/day5/Demo1</span></span><br><span class="hljs-meta">   #</span><span class="bash">6 = Class              <span class="hljs-comment">#22            // java/lang/Object</span></span><br><span class="hljs-meta">   #</span><span class="bash">7 = Utf8               &lt;init&gt;</span><br><span class="hljs-meta">   #</span><span class="bash">8 = Utf8               ()V</span><br><span class="hljs-meta">   #</span><span class="bash">9 = Utf8               Code</span><br><span class="hljs-meta">  #</span><span class="bash">10 = Utf8               LineNumberTable</span><br><span class="hljs-meta">  #</span><span class="bash">11 = Utf8               main</span><br><span class="hljs-meta">  #</span><span class="bash">12 = Utf8               ([Ljava/lang/String;)V</span><br><span class="hljs-meta">  #</span><span class="bash">13 = Utf8               SourceFile</span><br><span class="hljs-meta">  #</span><span class="bash">14 = Utf8               Demo1.java</span><br><span class="hljs-meta">  #</span><span class="bash">15 = NameAndType        <span class="hljs-comment">#7:#8          // &quot;&lt;init&gt;&quot;:()V</span></span><br><span class="hljs-meta">  #</span><span class="bash">16 = Class              <span class="hljs-comment">#23            // java/lang/System</span></span><br><span class="hljs-meta">  #</span><span class="bash">17 = NameAndType        <span class="hljs-comment">#24:#25        // out:Ljava/io/PrintStream;</span></span><br><span class="hljs-meta">  #</span><span class="bash">18 = Utf8               hello world</span><br><span class="hljs-meta">  #</span><span class="bash">19 = Class              <span class="hljs-comment">#26            // java/io/PrintStream</span></span><br><span class="hljs-meta">  #</span><span class="bash">20 = NameAndType        <span class="hljs-comment">#27:#28        // println:(Ljava/lang/String;)V</span></span><br><span class="hljs-meta">  #</span><span class="bash">21 = Utf8               com/nyima/JVM/day5/Demo1</span><br><span class="hljs-meta">  #</span><span class="bash">22 = Utf8               java/lang/Object</span><br><span class="hljs-meta">  #</span><span class="bash">23 = Utf8               java/lang/System</span><br><span class="hljs-meta">  #</span><span class="bash">24 = Utf8               out</span><br><span class="hljs-meta">  #</span><span class="bash">25 = Utf8               Ljava/io/PrintStream;</span><br><span class="hljs-meta">  #</span><span class="bash">26 = Utf8               java/io/PrintStream</span><br><span class="hljs-meta">  #</span><span class="bash">27 = Utf8               println</span><br><span class="hljs-meta">  #</span><span class="bash">28 = Utf8               (Ljava/lang/String;)V</span><br>&#123;<br>  public com.nyima.JVM.day5.Demo1();<br>    descriptor: ()V<br>    flags: ACC_PUBLIC<br>    Code:<br>      stack=1, locals=1, args_size=1<br>         0: aload_0<br>         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V<br>         4: return<br>      LineNumberTable:<br>        line 7: 0<br><br>  public static void main(java.lang.String[]);<br>    descriptor: ([Ljava/lang/String;)V<br>    flags: ACC_PUBLIC, ACC_STATIC<br>    Code:<br>      stack=2, locals=1, args_size=1<br>         0: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;<br>         3: ldc           #3                  // String hello world<br>         5: invokevirtual #4                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V<br><br>         8: return<br>      LineNumberTable:<br>        line 9: 0<br>        line 10: 8<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"><a href="#å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹" class="headerlink" title="å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹"></a>å›¾è§£æ–¹æ³•æ‰§è¡Œæµç¨‹</h4><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3_1</span> </span>&#123;    <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        <br><span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;        <br><span class="hljs-keyword">int</span> b = Short.MAX_VALUE + <span class="hljs-number">1</span>;        <br><span class="hljs-keyword">int</span> c = a + b;        <br>System.out.println(c);   <br>    &#125; <br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¸¸é‡æ± è½½å…¥è¿è¡Œæ—¶å¸¸é‡æ± </strong></p><p>å¸¸é‡æ± ä¹Ÿå±äºæ–¹æ³•åŒºï¼Œåªä¸è¿‡è¿™é‡Œå•ç‹¬æå‡ºæ¥äº†</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151317.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151317.png" alt="img"></a></p><p><strong>æ–¹æ³•å­—èŠ‚ç è½½å…¥æ–¹æ³•åŒº</strong></p><p>ï¼ˆstack=2ï¼Œlocals=4ï¼‰ å¯¹åº”æ“ä½œæ•°æ ˆæœ‰2ä¸ªç©ºé—´ï¼ˆæ¯ä¸ªç©ºé—´4ä¸ªå­—èŠ‚ï¼‰ï¼Œå±€éƒ¨å˜é‡è¡¨ä¸­æœ‰4ä¸ªæ§½ä½</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151325.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151325.png" alt="img"></a></p><p><strong>æ‰§è¡Œå¼•æ“å¼€å§‹æ‰§è¡Œå­—èŠ‚ç </strong></p><p><strong>bipush 10</strong></p><ul><li><p>å°†ä¸€ä¸ª byte å‹å…¥æ“ä½œæ•°æ ˆ</p><p>ï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰ï¼Œç±»ä¼¼çš„æŒ‡ä»¤è¿˜æœ‰</p><ul><li>sipush å°†ä¸€ä¸ª short å‹å…¥æ“ä½œæ•°æ ˆï¼ˆå…¶é•¿åº¦ä¼šè¡¥é½ 4 ä¸ªå­—èŠ‚ï¼‰</li><li>ldc å°†ä¸€ä¸ª int å‹å…¥æ“ä½œæ•°æ ˆ</li><li>ldc2_w å°†ä¸€ä¸ª long å‹å…¥æ“ä½œæ•°æ ˆï¼ˆ<strong>åˆ†ä¸¤æ¬¡å‹å…¥</strong>ï¼Œå› ä¸º long æ˜¯ 8 ä¸ªå­—èŠ‚ï¼‰</li><li>è¿™é‡Œå°çš„æ•°å­—éƒ½æ˜¯å’Œå­—èŠ‚ç æŒ‡ä»¤å­˜åœ¨ä¸€èµ·ï¼Œ<strong>è¶…è¿‡ short èŒƒå›´çš„æ•°å­—å­˜å…¥äº†å¸¸é‡æ± </strong></li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151336.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151336.png" alt="img"></a></p><p><strong>istore 1</strong></p><p>å°†æ“ä½œæ•°æ ˆæ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„slot 1ä¸­</p><p>å¯¹åº”ä»£ç ä¸­çš„</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">a</span> = <span class="hljs-number">10</span> <br></code></pre></td></tr></table></figure><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151346.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151346.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151412.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151412.png" alt="img"></a></p><p><strong>ldc #3</strong></p><p>è¯»å–è¿è¡Œæ—¶å¸¸é‡æ± ä¸­#3ï¼Œå³32768(è¶…è¿‡shortæœ€å¤§å€¼èŒƒå›´çš„æ•°ä¼šè¢«æ”¾åˆ°è¿è¡Œæ—¶å¸¸é‡æ± ä¸­)ï¼Œå°†å…¶åŠ è½½åˆ°æ“ä½œæ•°æ ˆä¸­</p><p>æ³¨æ„ Short.MAX_VALUE æ˜¯ 32767ï¼Œæ‰€ä»¥ 32768 = Short.MAX_VALUE + 1 å®é™…æ˜¯åœ¨ç¼–è¯‘æœŸé—´è®¡ç®—å¥½çš„</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151421.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151421.png" alt="img"></a></p><p><strong>istore 2</strong></p><p>å°†æ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¼¹å‡ºï¼Œæ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151432.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151432.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151441.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151441.png" alt="img"></a></p><p><strong>iload1 iload2</strong></p><p>å°†å±€éƒ¨å˜é‡è¡¨ä¸­1å·ä½ç½®å’Œ2å·ä½ç½®çš„å…ƒç´ æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</p><ul><li>å› ä¸ºåªèƒ½åœ¨æ“ä½œæ•°æ ˆä¸­æ‰§è¡Œè¿ç®—æ“ä½œ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151450.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151450.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151459.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151459.png" alt="img"></a></p><p><strong>iadd</strong></p><p>å°†æ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªå…ƒç´ <strong>å¼¹å‡ºæ ˆ</strong>å¹¶ç›¸åŠ ï¼Œç»“æœåœ¨å‹å…¥æ“ä½œæ•°æ ˆä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151508.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151508.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151523.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151523.png" alt="img"></a></p><p><strong>istore 3</strong></p><p>å°†æ“ä½œæ•°æ ˆä¸­çš„å…ƒç´ å¼¹å‡ºï¼Œæ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„3å·ä½ç½®</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151547.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151547.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151555.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151555.png" alt="img"></a></p><p><strong>getstatic #4</strong></p><p>åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­æ‰¾åˆ°#4ï¼Œå‘ç°æ˜¯ä¸€ä¸ªå¯¹è±¡</p><p>åœ¨å †å†…å­˜ä¸­æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¹¶å°†å…¶<strong>å¼•ç”¨</strong>æ”¾å…¥æ“ä½œæ•°æ ˆä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151605.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151605.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151613.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151613.png" alt="img"></a></p><p><strong>iload 3</strong></p><p>å°†å±€éƒ¨å˜é‡è¡¨ä¸­3å·ä½ç½®çš„å…ƒç´ å‹å…¥æ“ä½œæ•°æ ˆä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151624.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151624.png" alt="img"></a></p><p><strong>invokevirtual 5</strong></p><p>æ‰¾åˆ°å¸¸é‡æ±  #5 é¡¹ï¼Œå®šä½åˆ°æ–¹æ³•åŒº java/io/PrintStream.println:(I)V æ–¹æ³•</p><p>ç”Ÿæˆæ–°çš„æ ˆå¸§ï¼ˆåˆ†é… localsã€stackç­‰ï¼‰</p><p>ä¼ é€’å‚æ•°ï¼Œæ‰§è¡Œæ–°æ ˆå¸§ä¸­çš„å­—èŠ‚ç </p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151632.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151632.png" alt="img"></a></p><p>æ‰§è¡Œå®Œæ¯•ï¼Œå¼¹å‡ºæ ˆå¸§</p><p>æ¸…é™¤ main æ“ä½œæ•°æ ˆå†…å®¹</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151640.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608151640.png" alt="img"></a></p><p><strong>return</strong><br>å®Œæˆ main æ–¹æ³•è°ƒç”¨ï¼Œå¼¹å‡º main æ ˆå¸§ï¼Œç¨‹åºç»“æŸ</p><h4 id="é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜"><a href="#é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜" class="headerlink" title="é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜"></a>é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥åˆ†æé—®é¢˜</h4><p>ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">int</span> x=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span>(i&lt;<span class="hljs-number">10</span>) &#123;<br>x = x++;<br>i++;<br>&#125;<br>System.out.println(x); <span class="hljs-comment">//æ¥è¿‡ä¸º0</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæœ€ç»ˆçš„xç»“æœä¸º0å‘¢ï¼Ÿ é€šè¿‡åˆ†æå­—èŠ‚ç æŒ‡ä»¤å³å¯çŸ¥æ™“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=2, locals=3, args_size=1//æ“ä½œæ•°æ ˆåˆ†é…2ä¸ªç©ºé—´ï¼Œå±€éƒ¨å˜é‡è¡¨åˆ†é…3ä¸ªç©ºé—´<br>        0: iconst_0//å‡†å¤‡ä¸€ä¸ªå¸¸æ•°0<br>        1: istore_1//å°†å¸¸æ•°0æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„1å·æ§½ä½ i=0<br>        2: iconst_0//å‡†å¤‡ä¸€ä¸ªå¸¸æ•°0<br>        3: istore_2//å°†å¸¸æ•°0æ”¾å…¥å±€éƒ¨å˜é‡çš„2å·æ§½ä½ x=0<br>        4: iload_1//å°†å±€éƒ¨å˜é‡è¡¨1å·æ§½ä½çš„æ•°æ”¾å…¥æ“ä½œæ•°æ ˆä¸­<br>        5: bipush        10//å°†æ•°å­—10æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ­¤æ—¶æ“ä½œæ•°æ ˆä¸­æœ‰2ä¸ªæ•°<br>        7: if_icmpge     21//æ¯”è¾ƒæ“ä½œæ•°æ ˆä¸­çš„ä¸¤ä¸ªæ•°ï¼Œå¦‚æœä¸‹é¢çš„æ•°å¤§äºä¸Šé¢çš„æ•°ï¼Œå°±è·³è½¬åˆ°21ã€‚è¿™é‡Œçš„æ¯”è¾ƒæ˜¯å°†ä¸¤ä¸ªæ•°åšå‡æ³•ã€‚å› ä¸ºæ¶‰åŠè¿ç®—æ“ä½œï¼Œæ‰€ä»¥ä¼šå°†ä¸¤ä¸ªæ•°å¼¹å‡ºæ“ä½œæ•°æ ˆæ¥è¿›è¡Œè¿ç®—ã€‚è¿ç®—ç»“æŸåæ“ä½œæ•°æ ˆä¸ºç©º<br>       10: iload_2//å°†å±€éƒ¨å˜é‡2å·æ§½ä½çš„æ•°æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œæ”¾å…¥çš„å€¼æ˜¯0<br>       11: iinc          2, 1//å°†å±€éƒ¨å˜é‡2å·æ§½ä½çš„æ•°åŠ 1ï¼Œè‡ªå¢åï¼Œæ§½ä½ä¸­çš„å€¼ä¸º1<br>       14: istore_2//å°†æ“ä½œæ•°æ ˆä¸­çš„æ•°æ”¾å…¥åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·æ§½ä½ï¼Œ2å·æ§½ä½çš„å€¼åˆå˜ä¸ºäº†0<br>       15: iinc          1, 1 //1å·æ§½ä½çš„å€¼è‡ªå¢1<br>       18: goto          4 //è·³è½¬åˆ°ç¬¬4æ¡æŒ‡ä»¤<br>       21: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;<br>       24: iload_2<br>       25: invokevirtual #3                  // Method java/io/PrintStream.println:(I)V<br>       28: return<br></code></pre></td></tr></table></figure><h4 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h4><h5 id="cinit-V"><a href="#cinit-V" class="headerlink" title="cinit()V"></a>cinit()V</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;<br><br><span class="hljs-keyword">static</span> &#123;<br>i = <span class="hljs-number">20</span>;<br>&#125;<br><br><span class="hljs-keyword">static</span> &#123;<br>i = <span class="hljs-number">30</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>System.out.println(i); <span class="hljs-comment">//ç»“æœä¸º30</span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šæŒ‰<strong>ä»ä¸Šè‡³ä¸‹</strong>çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ static é™æ€ä»£ç å—å’Œé™æ€æˆå‘˜èµ‹å€¼çš„ä»£ç ï¼Œ<strong>åˆå¹¶</strong>ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• cinit()V ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">stack=1, locals=0, args_size=0<br>         0: bipush        10<br>         2: putstatic     #3                  // Field i:I<br>         5: bipush        20<br>         7: putstatic     #3                  // Field i:I<br>        10: bipush        30<br>        12: putstatic     #3                  // Field i:I<br>        15: return<br></code></pre></td></tr></table></figure><h5 id="init-V"><a href="#init-V" class="headerlink" title="init()V"></a>init()V</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br><span class="hljs-keyword">private</span> String a = <span class="hljs-string">&quot;s1&quot;</span>;<br><br>&#123;<br>b = <span class="hljs-number">20</span>;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> b = <span class="hljs-number">10</span>;<br><br>&#123;<br>a = <span class="hljs-string">&quot;s2&quot;</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo4</span><span class="hljs-params">(String a, <span class="hljs-keyword">int</span> b)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.a = a;<br><span class="hljs-keyword">this</span>.b = b;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>Demo4 d = <span class="hljs-keyword">new</span> Demo4(<span class="hljs-string">&quot;s3&quot;</span>, <span class="hljs-number">30</span>);<br>System.out.println(d.a);<br>System.out.println(d.b);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šæŒ‰<strong>ä»ä¸Šè‡³ä¸‹</strong>çš„é¡ºåºï¼Œæ”¶é›†æ‰€æœ‰ {} ä»£ç å—å’Œæˆå‘˜å˜é‡èµ‹å€¼çš„ä»£ç ï¼Œ<strong>å½¢æˆæ–°çš„æ„é€ æ–¹æ³•</strong>ï¼Œä½†<strong>åŸå§‹æ„é€ æ–¹æ³•</strong>å†…çš„ä»£ç <strong>æ€»æ˜¯åœ¨å</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=2, locals=3, args_size=3<br>        0: aload_0<br>        1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V<br>        4: aload_0<br>        5: ldc           #2                  // String s1<br>        7: putfield      #3                  // Field a:Ljava/lang/String;<br>       10: aload_0<br>       11: bipush        20<br>       13: putfield      #4                  // Field b:I<br>       16: aload_0<br>       17: bipush        10<br>       19: putfield      #4                  // Field b:I<br>       22: aload_0<br>       23: ldc           #5                  // String s2<br>       25: putfield      #3                  // Field a:Ljava/lang/String;<br>       //åŸå§‹æ„é€ æ–¹æ³•åœ¨æœ€åæ‰§è¡Œ<br>       28: aload_0<br>       29: aload_1<br>       30: putfield      #3                  // Field a:Ljava/lang/String;<br>       33: aload_0<br>       34: iload_2<br>       35: putfield      #4                  // Field b:I<br>       38: return<br></code></pre></td></tr></table></figure><h4 id="æ–¹æ³•è°ƒç”¨"><a href="#æ–¹æ³•è°ƒç”¨" class="headerlink" title="æ–¹æ³•è°ƒç”¨"></a>æ–¹æ³•è°ƒç”¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo5</span><span class="hljs-params">()</span> </span>&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span> </span>&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span> </span>&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span> </span>&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test4</span><span class="hljs-params">()</span> </span>&#123;<br><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>Demo5 demo5 = <span class="hljs-keyword">new</span> Demo5();<br>demo5.test1();<br>demo5.test2();<br>demo5.test3();<br>Demo5.test4();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸åŒæ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œå¯¹åº”çš„è™šæ‹ŸæœºæŒ‡ä»¤æœ‰æ‰€åŒºåˆ«</p><ul><li>ç§æœ‰ã€æ„é€ ã€è¢«finalä¿®é¥°çš„æ–¹æ³•ï¼Œåœ¨è°ƒç”¨æ—¶éƒ½ä½¿ç”¨<strong>invokespecial</strong>æŒ‡ä»¤</li><li>æ™®é€šæˆå‘˜æ–¹æ³•åœ¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨invokespecialæŒ‡ä»¤ã€‚å› ä¸ºç¼–è¯‘æœŸé—´æ— æ³•ç¡®å®šè¯¥æ–¹æ³•çš„å†…å®¹ï¼Œåªæœ‰åœ¨è¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®š</li><li>é™æ€æ–¹æ³•åœ¨è°ƒç”¨æ—¶ä½¿ç”¨invokestaticæŒ‡ä»¤</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>      stack=2, locals=2, args_size=1<br>         0: new           #2                  // class com/nyima/JVM/day5/Demo5 <br>         3: dup<br>         4: invokespecial #3                  // Method &quot;&lt;init&gt;&quot;:()V<br>         7: astore_1<br>         8: aload_1<br>         9: invokespecial #4                  // Method test1:()V<br>        12: aload_1<br>        13: invokespecial #5                  // Method test2:()V<br>        16: aload_1<br>        17: invokevirtual #6                  // Method test3:()V<br>        20: invokestatic  #7                  // Method test4:()V<br>        23: return<br></code></pre></td></tr></table></figure><ul><li>new æ˜¯åˆ›å»ºã€å¯¹è±¡ã€‘ï¼Œç»™å¯¹è±¡åˆ†é…å †å†…å­˜ï¼Œæ‰§è¡ŒæˆåŠŸä¼šå°†ã€<strong>å¯¹è±¡å¼•ç”¨</strong>ã€‘å‹å…¥æ“ä½œæ•°æ ˆ</li><li>dup æ˜¯èµ‹å€¼æ“ä½œæ•°æ ˆæ ˆé¡¶çš„å†…å®¹ï¼Œæœ¬ä¾‹å³ä¸ºã€<strong>å¯¹è±¡å¼•ç”¨</strong>ã€‘ï¼Œä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä»½å¼•ç”¨å‘¢ï¼Œä¸€ä¸ªæ˜¯è¦é…åˆ invokespecial è°ƒç”¨è¯¥å¯¹è±¡çš„æ„é€ æ–¹æ³• â€œinitâ€:()V ï¼ˆä¼šæ¶ˆè€—æ‰æ ˆé¡¶ä¸€ä¸ªå¼•ç”¨ï¼‰ï¼Œå¦ä¸€ä¸ªè¦ é…åˆ astore_1 èµ‹å€¼ç»™å±€éƒ¨å˜é‡</li><li>ç»ˆæ–¹æ³•ï¼ˆï¬nalï¼‰ï¼Œç§æœ‰æ–¹æ³•ï¼ˆprivateï¼‰ï¼Œæ„é€ æ–¹æ³•éƒ½æ˜¯ç”± invokespecial æŒ‡ä»¤æ¥è°ƒç”¨ï¼Œå±äºé™æ€ç»‘å®š</li><li>æ™®é€šæˆå‘˜æ–¹æ³•æ˜¯ç”± invokevirtual è°ƒç”¨ï¼Œå±äº<strong>åŠ¨æ€ç»‘å®š</strong>ï¼Œå³æ”¯æŒå¤šæ€ æˆå‘˜æ–¹æ³•ä¸é™æ€æ–¹æ³•è°ƒç”¨çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œæ‰§è¡Œæ–¹æ³•å‰æ˜¯å¦éœ€è¦ã€å¯¹è±¡å¼•ç”¨ã€‘</li></ul><h4 id="å¤šæ€åŸç†"><a href="#å¤šæ€åŸç†" class="headerlink" title="å¤šæ€åŸç†"></a>å¤šæ€åŸç†</h4><p>å› ä¸ºæ™®é€šæˆå‘˜æ–¹æ³•éœ€è¦åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šå…·ä½“çš„å†…å®¹ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºéœ€è¦è°ƒç”¨<strong>invokevirtual</strong>æŒ‡ä»¤</p><p>åœ¨æ‰§è¡ŒinvokevirtualæŒ‡ä»¤æ—¶ï¼Œç»å†äº†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</p><ul><li>å…ˆé€šè¿‡æ ˆå¸§ä¸­å¯¹è±¡çš„å¼•ç”¨æ‰¾åˆ°å¯¹è±¡</li><li>åˆ†æå¯¹è±¡å¤´ï¼Œæ‰¾åˆ°å¯¹è±¡å®é™…çš„Class</li><li>Classç»“æ„ä¸­æœ‰<strong>vtable</strong></li><li>æŸ¥è¯¢vtableæ‰¾åˆ°æ–¹æ³•çš„å…·ä½“åœ°å€</li><li>æ‰§è¡Œæ–¹æ³•çš„å­—èŠ‚ç </li></ul><h4 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h4><h5 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">try</span> &#123;<br>i = <span class="hljs-number">10</span>;<br>&#125;<span class="hljs-keyword">catch</span> (Exception e) &#123;<br>i = <span class="hljs-number">20</span>;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”å­—èŠ‚ç æŒ‡ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=3, args_size=1<br>        0: iconst_0<br>        1: istore_1<br>        2: bipush        10<br>        4: istore_1<br>        5: goto          12<br>        8: astore_2<br>        9: bipush        20<br>       11: istore_1<br>       12: return<br>     //å¤šå‡ºæ¥ä¸€ä¸ªå¼‚å¸¸è¡¨<br>     Exception table:<br>        from    to  target type<br>            2     5     8   Class java/lang/Exception<br></code></pre></td></tr></table></figure><ul><li>å¯ä»¥çœ‹åˆ°å¤šå‡ºæ¥ä¸€ä¸ª Exception table çš„ç»“æ„ï¼Œ[from, to) æ˜¯<strong>å‰é—­åå¼€</strong>ï¼ˆä¹Ÿå°±æ˜¯æ£€æµ‹2~4è¡Œï¼‰çš„æ£€æµ‹èŒƒå›´ï¼Œä¸€æ—¦è¿™ä¸ªèŒƒå›´å†…çš„å­—èŠ‚ç æ‰§è¡Œå‡ºç°å¼‚å¸¸ï¼Œåˆ™é€šè¿‡ type åŒ¹é…å¼‚å¸¸ç±»å‹ï¼Œå¦‚æœä¸€è‡´ï¼Œè¿›å…¥ target æ‰€æŒ‡ç¤ºè¡Œå·</li><li>8è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ astore_2 æ˜¯å°†å¼‚å¸¸å¯¹è±¡å¼•ç”¨å­˜å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®ï¼ˆä¸ºeï¼‰</li></ul><h5 id="å¤šä¸ªsingle-catch"><a href="#å¤šä¸ªsingle-catch" class="headerlink" title="å¤šä¸ªsingle-catch"></a>å¤šä¸ªsingle-catch</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">try</span> &#123;<br>i = <span class="hljs-number">10</span>;<br>&#125;<span class="hljs-keyword">catch</span> (ArithmeticException e) &#123;<br>i = <span class="hljs-number">20</span>;<br>&#125;<span class="hljs-keyword">catch</span> (Exception e) &#123;<br>i = <span class="hljs-number">30</span>;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”çš„å­—èŠ‚ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=3, args_size=1<br>        0: iconst_0<br>        1: istore_1<br>        2: bipush        10<br>        4: istore_1<br>        5: goto          19<br>        8: astore_2<br>        9: bipush        20<br>       11: istore_1<br>       12: goto          19<br>       15: astore_2<br>       16: bipush        30<br>       18: istore_1<br>       19: return<br>     Exception table:<br>        from    to  target type<br>            2     5     8   Class java/lang/ArithmeticException<br>            2     5    15   Class java/lang/Exception<br></code></pre></td></tr></table></figure><ul><li>å› ä¸ºå¼‚å¸¸å‡ºç°æ—¶ï¼Œ<strong>åªèƒ½è¿›å…¥</strong> Exception table ä¸­<strong>ä¸€ä¸ªåˆ†æ”¯</strong>ï¼Œæ‰€ä»¥å±€éƒ¨å˜é‡è¡¨ slot 2 ä½ç½®<strong>è¢«å…±ç”¨</strong></li></ul><h5 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">try</span> &#123;<br>i = <span class="hljs-number">10</span>;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>i = <span class="hljs-number">20</span>;<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>i = <span class="hljs-number">30</span>;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”å­—èŠ‚ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=4, args_size=1<br>        0: iconst_0<br>        1: istore_1<br>        //tryå—<br>        2: bipush        10<br>        4: istore_1<br>        //tryå—æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡Œfinally    <br>        5: bipush        30<br>        7: istore_1<br>        8: goto          27<br>       //catchå—     <br>       11: astore_2 //å¼‚å¸¸ä¿¡æ¯æ”¾å…¥å±€éƒ¨å˜é‡è¡¨çš„2å·æ§½ä½<br>       12: bipush        20<br>       14: istore_1<br>       //catchå—æ‰§è¡Œå®Œåï¼Œä¼šæ‰§è¡Œfinally        <br>       15: bipush        30<br>       17: istore_1<br>       18: goto          27<br>       //å‡ºç°å¼‚å¸¸ï¼Œä½†æœªè¢«Exceptionæ•è·ï¼Œä¼šæŠ›å‡ºå…¶ä»–å¼‚å¸¸ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦æ‰§è¡Œfinallyå—ä¸­çš„ä»£ç    <br>       21: astore_3<br>       22: bipush        30<br>       24: istore_1<br>       25: aload_3<br>       26: athrow  //æŠ›å‡ºå¼‚å¸¸<br>       27: return<br>     Exception table:<br>        from    to  target type<br>            2     5    11   Class java/lang/Exception<br>            2     5    21   any<br>           11    15    21   any<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° ï¬nally ä¸­çš„ä»£ç è¢«<strong>å¤åˆ¶äº† 3 ä»½</strong>ï¼Œåˆ†åˆ«æ”¾å…¥ try æµç¨‹ï¼Œcatch æµç¨‹ä»¥åŠ catchå‰©ä½™çš„å¼‚å¸¸ç±»å‹æµç¨‹</p><p><strong>æ³¨æ„</strong>ï¼šè™½ç„¶ä»å­—èŠ‚ç æŒ‡ä»¤çœ‹æ¥ï¼Œæ¯ä¸ªå—ä¸­éƒ½æœ‰finallyå—ï¼Œä½†æ˜¯finallyå—ä¸­çš„ä»£ç <strong>åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡</strong></p><h5 id="finallyä¸­çš„return"><a href="#finallyä¸­çš„return" class="headerlink" title="finallyä¸­çš„return"></a>finallyä¸­çš„return</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i = Demo3.test();<br>        <span class="hljs-comment">//ç»“æœä¸º20</span><br>System.out.println(i);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">int</span> i;<br><span class="hljs-keyword">try</span> &#123;<br>i = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">return</span> i;<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>i = <span class="hljs-number">20</span>;<br><span class="hljs-keyword">return</span> i;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”å­—èŠ‚ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=3, args_size=0<br>        0: bipush        10<br>        2: istore_0<br>        3: iload_0<br>        4: istore_1  //æš‚å­˜è¿”å›å€¼<br>        5: bipush        20<br>        7: istore_0<br>        8: iload_0<br>        9: ireturn//ireturnä¼šè¿”å›æ“ä½œæ•°æ ˆé¡¶çš„æ•´å‹å€¼20<br>       //å¦‚æœå‡ºç°å¼‚å¸¸ï¼Œè¿˜æ˜¯ä¼šæ‰§è¡Œfinallyå—ä¸­çš„å†…å®¹ï¼Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸<br>       10: astore_2<br>       11: bipush        20<br>       13: istore_0<br>       14: iload_0<br>       15: ireturn//è¿™é‡Œæ²¡æœ‰athrowäº†ï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨finallyå—ä¸­å¦‚æœæœ‰è¿”å›æ“ä½œçš„è¯ï¼Œä¸”tryå—ä¸­å‡ºç°å¼‚å¸¸ï¼Œä¼šåæ‰å¼‚å¸¸ï¼<br>     Exception table:<br>        from    to  target type<br>            0     5    10   any<br></code></pre></td></tr></table></figure><ul><li>ç”±äº ï¬nally ä¸­çš„ <strong>ireturn</strong> è¢«æ’å…¥äº†æ‰€æœ‰å¯èƒ½çš„æµç¨‹ï¼Œå› æ­¤è¿”å›ç»“æœè‚¯å®šä»¥ï¬nallyçš„ä¸ºå‡†</li><li>è‡³äºå­—èŠ‚ç ä¸­ç¬¬ 2 è¡Œï¼Œä¼¼ä¹æ²¡å•¥ç”¨ï¼Œä¸”ç•™ä¸ªä¼ç¬”ï¼Œçœ‹ä¸‹ä¸ªä¾‹å­</li><li>è·Ÿä¸Šä¾‹ä¸­çš„ ï¬nally ç›¸æ¯”ï¼Œå‘ç°<strong>æ²¡æœ‰ athrow äº†</strong>ï¼Œè¿™å‘Šè¯‰æˆ‘ä»¬ï¼šå¦‚æœåœ¨ ï¬nally ä¸­å‡ºç°äº† returnï¼Œä¼š<strong>åæ‰å¼‚å¸¸</strong></li><li>æ‰€ä»¥<strong>ä¸è¦åœ¨finallyä¸­è¿›è¡Œè¿”å›æ“ä½œ</strong></li></ul><h5 id="è¢«åæ‰çš„å¼‚å¸¸"><a href="#è¢«åæ‰çš„å¼‚å¸¸" class="headerlink" title="è¢«åæ‰çš„å¼‚å¸¸"></a>è¢«åæ‰çš„å¼‚å¸¸</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> i = Demo3.test();<br>      <span class="hljs-comment">//æœ€ç»ˆç»“æœä¸º20</span><br>      System.out.println(i);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> i;<br>      <span class="hljs-keyword">try</span> &#123;<br>         i = <span class="hljs-number">10</span>;<br>         <span class="hljs-comment">//è¿™é‡Œåº”è¯¥ä¼šæŠ›å‡ºå¼‚å¸¸</span><br>         i = i/<span class="hljs-number">0</span>;<br>         <span class="hljs-keyword">return</span> i;<br>      &#125; <span class="hljs-keyword">finally</span> &#123;<br>         i = <span class="hljs-number">20</span>;<br>         <span class="hljs-keyword">return</span> i;<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼šå‘ç°æ‰“å°ç»“æœä¸º20ï¼Œå¹¶æœªæŠ›å‡ºå¼‚å¸¸</p><h5 id="finallyä¸å¸¦return"><a href="#finallyä¸å¸¦return" class="headerlink" title="finallyä¸å¸¦return"></a>finallyä¸å¸¦return</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i = Demo4.test();<br>System.out.println(i);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">return</span> i;<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>i = <span class="hljs-number">20</span>;<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”å­—èŠ‚ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=1, locals=3, args_size=0<br>        0: bipush        10<br>        2: istore_0 //èµ‹å€¼ç»™i 10<br>        3: iload_0//åŠ è½½åˆ°æ“ä½œæ•°æ ˆé¡¶<br>        4: istore_1 //åŠ è½½åˆ°å±€éƒ¨å˜é‡è¡¨çš„1å·ä½ç½®<br>        5: bipush        20<br>        7: istore_0 //èµ‹å€¼ç»™i 20<br>        8: iload_1 //åŠ è½½å±€éƒ¨å˜é‡è¡¨1å·ä½ç½®çš„æ•°10åˆ°æ“ä½œæ•°æ ˆ<br>        9: ireturn //è¿”å›æ“ä½œæ•°æ ˆé¡¶å…ƒç´  10<br>       10: astore_2<br>       11: bipush        20<br>       13: istore_0<br>       14: aload_2 //åŠ è½½å¼‚å¸¸<br>       15: athrow //æŠ›å‡ºå¼‚å¸¸<br>     Exception table:<br>        from    to  target type<br>            3     5    10   any<br></code></pre></td></tr></table></figure><h4 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">int</span> i = <span class="hljs-number">10</span>;<br>Lock lock = <span class="hljs-keyword">new</span> Lock();<br><span class="hljs-keyword">synchronized</span> (lock) &#123;<br>System.out.println(i);<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Lock</span></span>&#123;&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”å­—èŠ‚ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>     stack=2, locals=5, args_size=1<br>        0: bipush        10<br>        2: istore_1<br>        3: new           #2                  // class com/nyima/JVM/day06/Lock<br>        6: dup //å¤åˆ¶ä¸€ä»½ï¼Œæ”¾åˆ°æ“ä½œæ•°æ ˆé¡¶ï¼Œç”¨äºæ„é€ å‡½æ•°æ¶ˆè€—<br>        7: invokespecial #3                  // Method com/nyima/JVM/day06/Lock.&quot;&lt;init&gt;&quot;:()V<br>       10: astore_2 //å‰©ä¸‹çš„ä¸€ä»½æ”¾åˆ°å±€éƒ¨å˜é‡è¡¨çš„2å·ä½ç½®<br>       11: aload_2 //åŠ è½½åˆ°æ“ä½œæ•°æ ˆ<br>       12: dup //å¤åˆ¶ä¸€ä»½ï¼Œæ”¾åˆ°æ“ä½œæ•°æ ˆï¼Œç”¨äºåŠ é”æ—¶æ¶ˆè€—<br>       13: astore_3 //å°†æ“ä½œæ•°æ ˆé¡¶å…ƒç´ å¼¹å‡ºï¼Œæš‚å­˜åˆ°å±€éƒ¨å˜é‡è¡¨çš„ä¸‰å·æ§½ä½ã€‚è¿™æ—¶æ“ä½œæ•°æ ˆä¸­æœ‰ä¸€ä»½å¯¹è±¡çš„å¼•ç”¨<br>       14: monitorenter //åŠ é”<br>       //é”ä½åä»£ç å—ä¸­çš„æ“ä½œ    <br>       15: getstatic     #4                  // Field java/lang/System.out:Ljava/io/PrintStream;<br>       18: iload_1<br>       19: invokevirtual #5                  // Method java/io/PrintStream.println:(I)V<br>       //åŠ è½½å±€éƒ¨å˜é‡è¡¨ä¸­ä¸‰å·æ§½ä½å¯¹è±¡çš„å¼•ç”¨ï¼Œç”¨äºè§£é”    <br>       22: aload_3    <br>       23: monitorexit //è§£é”<br>       24: goto          34<br>       //å¼‚å¸¸æ“ä½œ    <br>       27: astore        4<br>       29: aload_3<br>       30: monitorexit //è§£é”<br>       31: aload         4<br>       33: athrow<br>       34: return<br>     //å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºä½•æ—¶å‡ºç°å¼‚å¸¸ï¼Œéƒ½ä¼šè·³è½¬åˆ°27è¡Œï¼Œå°†å¼‚å¸¸æ”¾å…¥å±€éƒ¨å˜é‡ä¸­ï¼Œå¹¶è¿›è¡Œè§£é”æ“ä½œï¼Œç„¶ååŠ è½½å¼‚å¸¸å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚      <br>     Exception table:<br>        from    to  target type<br>           15    24    27   any<br>           27    31    27   any<br></code></pre></td></tr></table></figure><h3 id="3ã€ç¼–è¯‘æœŸå¤„ç†"><a href="#3ã€ç¼–è¯‘æœŸå¤„ç†" class="headerlink" title="3ã€ç¼–è¯‘æœŸå¤„ç†"></a>3ã€ç¼–è¯‘æœŸå¤„ç†</h3><p>æ‰€è°“çš„ <strong>è¯­æ³•ç³–</strong> ï¼Œå…¶å®å°±æ˜¯æŒ‡ java ç¼–è¯‘å™¨æŠŠ *.java æºç ç¼–è¯‘ä¸º *.class å­—èŠ‚ç çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>è‡ªåŠ¨ç”Ÿæˆ</strong>å’Œ<strong>è½¬æ¢</strong>çš„ä¸€äº›ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ï¼Œç®—æ˜¯ java ç¼–è¯‘å™¨ç»™æˆ‘ä»¬çš„ä¸€ä¸ªé¢å¤–ç¦åˆ©</p><p><strong>æ³¨æ„</strong>ï¼Œä»¥ä¸‹ä»£ç çš„åˆ†æï¼Œå€ŸåŠ©äº† javap å·¥å…·ï¼Œidea çš„åç¼–è¯‘åŠŸèƒ½ï¼Œidea æ’ä»¶ jclasslib ç­‰å·¥å…·ã€‚å¦å¤–ï¼Œ ç¼–è¯‘å™¨è½¬æ¢çš„<strong>ç»“æœç›´æ¥å°±æ˜¯ class å­—èŠ‚ç </strong>ï¼Œåªæ˜¯ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œç»™å‡ºäº† å‡ ä¹ç­‰ä»· çš„ java æºç æ–¹å¼ï¼Œå¹¶ä¸æ˜¯ç¼–è¯‘å™¨è¿˜ä¼šè½¬æ¢å‡ºä¸­é—´çš„ java æºç ï¼Œåˆ‡è®°ã€‚</p><h4 id="é»˜è®¤æ„é€ å‡½æ•°"><a href="#é»˜è®¤æ„é€ å‡½æ•°" class="headerlink" title="é»˜è®¤æ„é€ å‡½æ•°"></a>é»˜è®¤æ„é€ å‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Candy1</span> </span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç»è¿‡ç¼–è¯‘æœŸä¼˜åŒ–å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Candy1</span> </span>&#123;<br>   <span class="hljs-comment">//è¿™ä¸ªæ— å‚æ„é€ å™¨æ˜¯javaç¼–è¯‘å™¨å¸®æˆ‘ä»¬åŠ ä¸Šçš„</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Candy1</span><span class="hljs-params">()</span> </span>&#123;<br>      <span class="hljs-comment">//å³è°ƒç”¨çˆ¶ç±» Object çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œå³è°ƒç”¨ java/lang/Object.&quot; &lt;init&gt;&quot;:()V</span><br>      <span class="hljs-keyword">super</span>();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è‡ªåŠ¨æ‹†è£…ç®±"><a href="#è‡ªåŠ¨æ‹†è£…ç®±" class="headerlink" title="è‡ªåŠ¨æ‹†è£…ç®±"></a>è‡ªåŠ¨æ‹†è£…ç®±</h4><p>åŸºæœ¬ç±»å‹å’Œå…¶åŒ…è£…ç±»å‹çš„ç›¸äº’è½¬æ¢è¿‡ç¨‹ï¼Œç§°ä¸ºæ‹†è£…ç®±</p><p>åœ¨JDK 5ä»¥åï¼Œå®ƒä»¬çš„è½¬æ¢å¯ä»¥åœ¨ç¼–è¯‘æœŸè‡ªåŠ¨å®Œæˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      Integer x = <span class="hljs-number">1</span>;<br>      <span class="hljs-keyword">int</span> y = x;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo2</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-comment">//åŸºæœ¬ç±»å‹èµ‹å€¼ç»™åŒ…è£…ç±»å‹ï¼Œç§°ä¸ºè£…ç®±</span><br>      Integer x = Integer.valueOf(<span class="hljs-number">1</span>);<br>      <span class="hljs-comment">//åŒ…è£…ç±»å‹èµ‹å€¼ç»™åŸºæœ¬ç±»å‹ï¼Œç§°è°“æ‹†ç®±</span><br>      <span class="hljs-keyword">int</span> y = x.intValue();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æ³›å‹é›†åˆå–å€¼"><a href="#æ³›å‹é›†åˆå–å€¼" class="headerlink" title="æ³›å‹é›†åˆå–å€¼"></a>æ³›å‹é›†åˆå–å€¼</h4><p>æ³›å‹ä¹Ÿæ˜¯åœ¨ JDK 5 å¼€å§‹åŠ å…¥çš„ç‰¹æ€§ï¼Œä½† java åœ¨<strong>ç¼–è¯‘æ³›å‹ä»£ç å</strong>ä¼šæ‰§è¡Œ <strong>æ³›å‹æ“¦é™¤</strong> çš„åŠ¨ä½œï¼Œå³æ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘ä¸ºå­—èŠ‚ç ä¹‹åå°±<strong>ä¸¢å¤±</strong>äº†ï¼Œå®é™…çš„ç±»å‹éƒ½å½“åšäº† <strong>Object</strong> ç±»å‹æ¥å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>      list.add(<span class="hljs-number">10</span>);<br>      Integer x = list.get(<span class="hljs-number">0</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”å­—èŠ‚ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs shell">Code:<br>    stack=2, locals=3, args_size=1<br>       0: new           #2                  // class java/util/ArrayList<br>       3: dup<br>       4: invokespecial #3                  // Method java/util/ArrayList.&quot;&lt;init&gt;&quot;:()V<br>       7: astore_1<br>       8: aload_1<br>       9: bipush        10<br>      11: invokestatic  #4                  // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;<br>      //è¿™é‡Œè¿›è¡Œäº†æ³›å‹æ“¦é™¤ï¼Œå®é™…è°ƒç”¨çš„æ˜¯add(Objcet o)<br>      14: invokeinterface #5,  2            // InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z<br><br>      19: pop<br>      20: aload_1<br>      21: iconst_0<br>      //è¿™é‡Œä¹Ÿè¿›è¡Œäº†æ³›å‹æ“¦é™¤ï¼Œå®é™…è°ƒç”¨çš„æ˜¯get(Object o)   <br>      22: invokeinterface #6,  2            // InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;<br>//è¿™é‡Œè¿›è¡Œäº†ç±»å‹è½¬æ¢ï¼Œå°†Objectè½¬æ¢æˆäº†Integer<br>      27: checkcast     #7                  // class java/lang/Integer<br>      30: astore_2<br>      31: return<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥è°ƒç”¨getå‡½æ•°å–å€¼æ—¶ï¼Œæœ‰ä¸€ä¸ªç±»å‹è½¬æ¢çš„æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer x = (Integer) list.get(<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure><p>å¦‚æœè¦å°†è¿”å›ç»“æœèµ‹å€¼ç»™ä¸€ä¸ªintç±»å‹çš„å˜é‡ï¼Œåˆ™è¿˜æœ‰<strong>è‡ªåŠ¨æ‹†ç®±</strong>çš„æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">int</span> x = (Integer) list.get(<span class="hljs-number">0</span>).intValue();<br></code></pre></td></tr></table></figure><h4 id="å¯å˜å‚æ•°"><a href="#å¯å˜å‚æ•°" class="headerlink" title="å¯å˜å‚æ•°"></a>å¯å˜å‚æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(String... args)</span> </span>&#123;<br>      <span class="hljs-comment">//å°†argsèµ‹å€¼ç»™arrï¼Œå¯ä»¥çœ‹å‡ºString...å®é™…å°±æ˜¯String[] </span><br>      String[] arr = args;<br>      System.out.println(arr.length);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      foo(<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯å˜å‚æ•° <strong>Stringâ€¦</strong> args å…¶å®æ˜¯ä¸€ä¸ª <strong>String[]</strong> args ï¼Œä»ä»£ç ä¸­çš„èµ‹å€¼è¯­å¥ä¸­å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚ åŒ æ · java ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´å°†ä¸Šè¿°ä»£ç å˜æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br>   <span class="hljs-keyword">public</span> Demo4 &#123;&#125;<br><br>    <br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      String[] arr = args;<br>      System.out.println(arr.length);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      foo(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">&quot;hello&quot;</span>, <span class="hljs-string">&quot;world&quot;</span>&#125;);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå¦‚æœè°ƒç”¨çš„æ˜¯foo()ï¼Œå³æœªä¼ é€’å‚æ•°æ—¶ï¼Œç­‰ä»·ä»£ç ä¸ºfoo(new String[]{})ï¼Œ<strong>åˆ›å»ºäº†ä¸€ä¸ªç©ºæ•°ç»„</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¼ é€’çš„null</p><h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//æ•°ç»„èµ‹åˆå€¼çš„ç®€åŒ–å†™æ³•ä¹Ÿæ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚</span><br><span class="hljs-keyword">int</span>[] arr = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> x : arr) &#123;<br>System.out.println(x);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è½¬æ¢ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> Demo5 &#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">int</span>[] arr = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>&#125;;<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;arr.length; ++i) &#123;<br><span class="hljs-keyword">int</span> x = arr[i];<br>System.out.println(x);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¦‚æœæ˜¯é›†åˆä½¿ç”¨foreach</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);<br>      <span class="hljs-keyword">for</span> (Integer x : list) &#123;<br>         System.out.println(x);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é›†åˆè¦ä½¿ç”¨foreachï¼Œéœ€è¦è¯¥é›†åˆç±»å®ç°äº†<strong>Iterableæ¥å£</strong>ï¼Œå› ä¸ºé›†åˆçš„éå†éœ€è¦ç”¨åˆ°<strong>è¿­ä»£å™¨Iterator</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo5</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> Demo5 &#123;&#125;<br>    <br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      List&lt;Integer&gt; list = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>);<br>      <span class="hljs-comment">//è·å¾—è¯¥é›†åˆçš„è¿­ä»£å™¨</span><br>      Iterator&lt;Integer&gt; iterator = list.iterator();<br>      <span class="hljs-keyword">while</span>(iterator.hasNext()) &#123;<br>         Integer x = iterator.next();<br>         System.out.println(x);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="switchå­—ç¬¦ä¸²"><a href="#switchå­—ç¬¦ä¸²" class="headerlink" title="switchå­—ç¬¦ä¸²"></a>switchå­—ç¬¦ä¸²</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo6</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      String str = <span class="hljs-string">&quot;hello&quot;</span>;<br>      <span class="hljs-keyword">switch</span> (str) &#123;<br>         <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;hello&quot;</span> :<br>            System.out.println(<span class="hljs-string">&quot;h&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;world&quot;</span> :<br>            System.out.println(<span class="hljs-string">&quot;w&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ç¼–è¯‘å™¨ä¸­æ‰§è¡Œçš„æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo6</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Demo6</span><span class="hljs-params">()</span> </span>&#123;<br>      <br>   &#125;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      String str = <span class="hljs-string">&quot;hello&quot;</span>;<br>      <span class="hljs-keyword">int</span> x = -<span class="hljs-number">1</span>;<br>      <span class="hljs-comment">//é€šè¿‡å­—ç¬¦ä¸²çš„hashCode+valueæ¥åˆ¤æ–­æ˜¯å¦åŒ¹é…</span><br>      <span class="hljs-keyword">switch</span> (str.hashCode()) &#123;<br>         <span class="hljs-comment">//helloçš„hashCode</span><br>         <span class="hljs-keyword">case</span> <span class="hljs-number">99162322</span> :<br>            <span class="hljs-comment">//å†æ¬¡æ¯”è¾ƒï¼Œå› ä¸ºå­—ç¬¦ä¸²çš„hashCodeæœ‰å¯èƒ½ç›¸ç­‰</span><br>            <span class="hljs-keyword">if</span>(str.equals(<span class="hljs-string">&quot;hello&quot;</span>)) &#123;<br>               x = <span class="hljs-number">0</span>;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-comment">//worldçš„hashCode</span><br>         <span class="hljs-keyword">case</span> <span class="hljs-number">11331880</span> :<br>            <span class="hljs-keyword">if</span>(str.equals(<span class="hljs-string">&quot;world&quot;</span>)) &#123;<br>               x = <span class="hljs-number">1</span>;<br>            &#125;<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br><br>      <span class="hljs-comment">//ç”¨ç¬¬äºŒä¸ªswitchåœ¨è¿›è¡Œè¾“å‡ºåˆ¤æ–­</span><br>      <span class="hljs-keyword">switch</span> (x) &#123;<br>         <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>            System.out.println(<span class="hljs-string">&quot;h&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            System.out.println(<span class="hljs-string">&quot;w&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿‡ç¨‹è¯´æ˜ï¼š</p><ul><li>åœ¨ç¼–è¯‘æœŸé—´ï¼Œå•ä¸ªçš„switchè¢«åˆ†ä¸ºäº†ä¸¤ä¸ª<ul><li>ç¬¬ä¸€ä¸ªç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²ï¼Œå¹¶ç»™xèµ‹å€¼<ul><li>å­—ç¬¦ä¸²çš„åŒ¹é…ç”¨åˆ°äº†å­—ç¬¦ä¸²çš„hashCodeï¼Œè¿˜ç”¨åˆ°äº†equalsæ–¹æ³•</li><li>ä½¿ç”¨hashCodeæ˜¯ä¸ºäº†æé«˜æ¯”è¾ƒæ•ˆç‡ï¼Œä½¿ç”¨equalsæ˜¯é˜²æ­¢æœ‰hashCodeå†²çªï¼ˆå¦‚BMå’ŒC.ï¼‰</li></ul></li><li>ç¬¬äºŒä¸ªç”¨æ¥æ ¹æ®xçš„å€¼æ¥å†³å®šè¾“å‡ºè¯­å¥</li></ul></li></ul><h4 id="switchæšä¸¾"><a href="#switchæšä¸¾" class="headerlink" title="switchæšä¸¾"></a>switchæšä¸¾</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo7</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      SEX sex = SEX.MALE;<br>      <span class="hljs-keyword">switch</span> (sex) &#123;<br>         <span class="hljs-keyword">case</span> MALE:<br>            System.out.println(<span class="hljs-string">&quot;man&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> FEMALE:<br>            System.out.println(<span class="hljs-string">&quot;woman&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;<br>   MALE, FEMALE;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å™¨ä¸­æ‰§è¡Œçš„ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo7</span> </span>&#123;<br>   <span class="hljs-comment">/**     </span><br><span class="hljs-comment">    * å®šä¹‰ä¸€ä¸ªåˆæˆç±»ï¼ˆä»… jvm ä½¿ç”¨ï¼Œå¯¹æˆ‘ä»¬ä¸å¯è§ï¼‰     </span><br><span class="hljs-comment">    * ç”¨æ¥æ˜ å°„æšä¸¾çš„ ordinal ä¸æ•°ç»„å…ƒç´ çš„å…³ç³»     </span><br><span class="hljs-comment">    * æšä¸¾çš„ ordinal è¡¨ç¤ºæšä¸¾å¯¹è±¡çš„åºå·ï¼Œä» 0 å¼€å§‹     </span><br><span class="hljs-comment">    * å³ MALE çš„ ordinal()=0ï¼ŒFEMALE çš„ ordinal()=1     </span><br><span class="hljs-comment">    */</span> <br>   <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> $<span class="hljs-title">MAP</span> </span>&#123;<br>      <span class="hljs-comment">//æ•°ç»„å¤§å°å³ä¸ºæšä¸¾å…ƒç´ ä¸ªæ•°ï¼Œé‡Œé¢å­˜æ”¾äº†caseç”¨äºæ¯”è¾ƒçš„æ•°å­—</span><br>      <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>[] map = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">2</span>];<br>      <span class="hljs-keyword">static</span> &#123;<br>         <span class="hljs-comment">//ordinalå³æšä¸¾å…ƒç´ å¯¹åº”æ‰€åœ¨çš„ä½ç½®ï¼ŒMALEä¸º0ï¼ŒFEMALEä¸º1</span><br>         map[SEX.MALE.ordinal()] = <span class="hljs-number">1</span>;<br>         map[SEX.FEMALE.ordinal()] = <span class="hljs-number">2</span>;<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      SEX sex = SEX.MALE;<br>      <span class="hljs-comment">//å°†å¯¹åº”ä½ç½®æšä¸¾å…ƒç´ çš„å€¼èµ‹ç»™xï¼Œç”¨äºcaseæ“ä½œ</span><br>      <span class="hljs-keyword">int</span> x = $MAP.map[sex.ordinal()];<br>      <span class="hljs-keyword">switch</span> (x) &#123;<br>         <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            System.out.println(<span class="hljs-string">&quot;man&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            System.out.println(<span class="hljs-string">&quot;woman&quot;</span>);<br>            <span class="hljs-keyword">break</span>;<br>         <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">break</span>;<br>      &#125;<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;<br>   MALE, FEMALE;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="æšä¸¾ç±»"><a href="#æšä¸¾ç±»" class="headerlink" title="æšä¸¾ç±»"></a>æšä¸¾ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">SEX</span> </span>&#123;<br>   MALE, FEMALE;<br>&#125;<br></code></pre></td></tr></table></figure><p>è½¬æ¢åçš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sex</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Enum</span>&lt;<span class="hljs-title">Sex</span>&gt; </span>&#123;   <br>   <span class="hljs-comment">//å¯¹åº”æšä¸¾ç±»ä¸­çš„å…ƒç´ </span><br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex MALE;    <br>   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex FEMALE;    <br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Sex[] $VALUES;<br>   <br>    <span class="hljs-keyword">static</span> &#123;       <br>    <span class="hljs-comment">//è°ƒç”¨æ„é€ å‡½æ•°ï¼Œä¼ å…¥æšä¸¾å…ƒç´ çš„å€¼åŠordinal</span><br>    MALE = <span class="hljs-keyword">new</span> Sex(<span class="hljs-string">&quot;MALE&quot;</span>, <span class="hljs-number">0</span>);    <br>        FEMALE = <span class="hljs-keyword">new</span> Sex(<span class="hljs-string">&quot;FEMALE&quot;</span>, <span class="hljs-number">1</span>);   <br>        $VALUES = <span class="hljs-keyword">new</span> Sex[]&#123;MALE, FEMALE&#125;; <br>   &#125;<br> <br>   <span class="hljs-comment">//è°ƒç”¨çˆ¶ç±»ä¸­çš„æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Sex</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> ordinal)</span> </span>&#123;     <br>        <span class="hljs-keyword">super</span>(name, ordinal);    <br>    &#125;<br>   <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sex[] values() &#123;  <br>        <span class="hljs-keyword">return</span> $VALUES.clone();  <br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Sex <span class="hljs-title">valueOf</span><span class="hljs-params">(String name)</span> </span>&#123; <br>        <span class="hljs-keyword">return</span> Enum.valueOf(Sex.class, name);  <br>    &#125; <br>   <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åŒ¿åå†…éƒ¨ç±»"><a href="#åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="åŒ¿åå†…éƒ¨ç±»"></a>åŒ¿åå†…éƒ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;running...&quot;</span>);<br>         &#125;<br>      &#125;;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è½¬æ¢åçš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-comment">//ç”¨é¢å¤–åˆ›å»ºçš„ç±»æ¥åˆ›å»ºåŒ¿åå†…éƒ¨ç±»å¯¹è±¡</span><br>      Runnable runnable = <span class="hljs-keyword">new</span> Demo8$<span class="hljs-number">1</span>();<br>   &#125;<br>&#125;<br><br><span class="hljs-comment">//åˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„ç±»ï¼Œå®ç°äº†Runnableæ¥å£</span><br><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span>$1 <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>   <span class="hljs-keyword">public</span> Demo8$<span class="hljs-number">1</span>() &#123;&#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;running...&quot;</span>);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœåŒ¿åå†…éƒ¨ç±»ä¸­å¼•ç”¨äº†<strong>å±€éƒ¨å˜é‡</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> x = <span class="hljs-number">1</span>;<br>      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            System.out.println(x);<br>         &#125;<br>      &#125;;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è½¬åŒ–åä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-keyword">int</span> x = <span class="hljs-number">1</span>;<br>      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            System.out.println(x);<br>         &#125;<br>      &#125;;<br>   &#125;<br>&#125;<br><br><span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo8</span>$1 <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>   <span class="hljs-comment">//å¤šåˆ›å»ºäº†ä¸€ä¸ªå˜é‡</span><br>   <span class="hljs-keyword">int</span> val$x;<br>   <span class="hljs-comment">//å˜ä¸ºäº†æœ‰å‚æ„é€ å™¨</span><br>   <span class="hljs-keyword">public</span> Demo8$<span class="hljs-number">1</span>(<span class="hljs-keyword">int</span> x) &#123;<br>      <span class="hljs-keyword">this</span>.val$x = x;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>      System.out.println(val$x);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4ã€ç±»åŠ è½½é˜¶æ®µ"><a href="#4ã€ç±»åŠ è½½é˜¶æ®µ" class="headerlink" title="4ã€ç±»åŠ è½½é˜¶æ®µ"></a>4ã€ç±»åŠ è½½é˜¶æ®µ</h3><h4 id="åŠ è½½"><a href="#åŠ è½½" class="headerlink" title="åŠ è½½"></a>åŠ è½½</h4><ul><li><p>å°†ç±»çš„å­—èŠ‚ç è½½å…¥</p><p>æ–¹æ³•åŒº</p><p>ï¼ˆ1.8åä¸ºå…ƒç©ºé—´ï¼Œåœ¨æœ¬åœ°å†…å­˜ä¸­ï¼‰ä¸­ï¼Œå†…éƒ¨é‡‡ç”¨ C++ çš„ instanceKlass æè¿° java ç±»ï¼Œå®ƒçš„é‡è¦ ï¬eld æœ‰ï¼š</p><ul><li>_java_mirror å³ java çš„ç±»é•œåƒï¼Œä¾‹å¦‚å¯¹ String æ¥è¯´ï¼Œå®ƒçš„é•œåƒç±»å°±æ˜¯ String.classï¼Œä½œç”¨æ˜¯æŠŠ klass æš´éœ²ç»™ java ä½¿ç”¨</li><li>_super å³çˆ¶ç±»</li><li>_ï¬elds å³æˆå‘˜å˜é‡</li><li>_methods å³æ–¹æ³•</li><li>_constants å³å¸¸é‡æ± </li><li>_class_loader å³ç±»åŠ è½½å™¨</li><li>_vtable è™šæ–¹æ³•è¡¨</li><li>_itable æ¥å£æ–¹æ³•</li></ul></li><li><p>å¦‚æœè¿™ä¸ªç±»è¿˜æœ‰çˆ¶ç±»æ²¡æœ‰åŠ è½½ï¼Œ<strong>å…ˆåŠ è½½çˆ¶ç±»</strong></p></li><li><p>åŠ è½½å’Œé“¾æ¥å¯èƒ½æ˜¯<strong>äº¤æ›¿è¿è¡Œ</strong>çš„</p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611205050.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611205050.png" alt="img"></a></p><ul><li>instanceKlassä¿å­˜åœ¨<strong>æ–¹æ³•åŒº</strong>ã€‚JDK 8ä»¥åï¼Œæ–¹æ³•åŒºä½äºå…ƒç©ºé—´ä¸­ï¼Œè€Œå…ƒç©ºé—´åˆä½äºæœ¬åœ°å†…å­˜ä¸­</li><li>_java_mirroråˆ™æ˜¯ä¿å­˜åœ¨<strong>å †å†…å­˜</strong>ä¸­</li><li>InstanceKlasså’Œ*.class(JAVAé•œåƒç±»)äº’ç›¸ä¿å­˜äº†å¯¹æ–¹çš„åœ°å€</li><li>ç±»çš„å¯¹è±¡åœ¨å¯¹è±¡å¤´ä¸­ä¿å­˜äº†*.classçš„åœ°å€ã€‚è®©å¯¹è±¡å¯ä»¥é€šè¿‡å…¶æ‰¾åˆ°æ–¹æ³•åŒºä¸­çš„instanceKlassï¼Œä»è€Œè·å–ç±»çš„å„ç§ä¿¡æ¯</li></ul><h4 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h4><h5 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h5><p>éªŒè¯ç±»æ˜¯å¦ç¬¦åˆ JVMè§„èŒƒï¼Œå®‰å…¨æ€§æ£€æŸ¥</p><h5 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h5><p>ä¸º static å˜é‡åˆ†é…ç©ºé—´ï¼Œè®¾ç½®é»˜è®¤å€¼</p><ul><li>staticå˜é‡åœ¨JDK 7ä»¥å‰æ˜¯å­˜å‚¨ä¸instanceKlassæœ«å°¾ã€‚ä½†åœ¨JDK 7ä»¥åå°±å­˜å‚¨åœ¨_java_mirroræœ«å°¾äº†</li><li>staticå˜é‡åœ¨åˆ†é…ç©ºé—´å’Œèµ‹å€¼æ˜¯åœ¨ä¸¤ä¸ªé˜¶æ®µå®Œæˆçš„ã€‚åˆ†é…ç©ºé—´åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆï¼Œèµ‹å€¼åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</li><li>å¦‚æœ static å˜é‡æ˜¯ ï¬nal çš„<strong>åŸºæœ¬ç±»å‹</strong>ï¼Œä»¥åŠ<strong>å­—ç¬¦ä¸²å¸¸é‡</strong>ï¼Œé‚£ä¹ˆç¼–è¯‘é˜¶æ®µå€¼å°±ç¡®å®šäº†ï¼Œ<strong>èµ‹å€¼åœ¨å‡†å¤‡é˜¶æ®µå®Œæˆ</strong></li><li>å¦‚æœ static å˜é‡æ˜¯ ï¬nal çš„ï¼Œä½†å±äº<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œé‚£ä¹ˆèµ‹å€¼ä¹Ÿä¼šåœ¨<strong>åˆå§‹åŒ–é˜¶æ®µå®Œæˆ</strong></li></ul><h5 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h5><p><strong>HSDBçš„ä½¿ç”¨</strong></p><ul><li>å…ˆè·å¾—è¦æŸ¥çœ‹çš„è¿›ç¨‹ID</li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">jps</span><br></code></pre></td></tr></table></figure><ul><li>æ‰“å¼€HSDB</li></ul><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">java -cp F:<span class="hljs-symbol">\J</span>AVA<span class="hljs-symbol">\J</span>DK8.0<span class="hljs-symbol">\l</span>ib<span class="hljs-symbol">\s</span>a-jdi.jar sun.jvm.hotspot.HSDB<br></code></pre></td></tr></table></figure><ul><li>è¿è¡Œæ—¶å¯èƒ½ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸º<strong>ç¼ºå°‘ä¸€ä¸ª.dllçš„æ–‡ä»¶</strong>ï¼Œæˆ‘ä»¬åœ¨JDKçš„å®‰è£…ç›®å½•ä¸­æ‰¾åˆ°è¯¥æ–‡ä»¶ï¼Œå¤åˆ¶åˆ°ç¼ºå¤±çš„æ–‡ä»¶ä¸‹å³å¯</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221703.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221703.png" alt="img"></a></p><ul><li>å®šä½éœ€è¦çš„è¿›ç¨‹</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221857.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611221857.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611222029.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611222029.png" alt="img"></a></p><p><strong>è§£æçš„å«ä¹‰</strong></p><p>å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</p><ul><li>æœªè§£ææ—¶ï¼Œå¸¸é‡æ± ä¸­çš„çœ‹åˆ°çš„å¯¹è±¡ä»…æ˜¯ç¬¦å·ï¼ŒæœªçœŸæ­£çš„å­˜åœ¨äºå†…å­˜ä¸­</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException </span>&#123;<br>      ClassLoader loader = Demo1.class.getClassLoader();<br>      <span class="hljs-comment">//åªåŠ è½½ä¸è§£æ</span><br>      Class&lt;?&gt; c = loader.loadClass(<span class="hljs-string">&quot;com.nyima.JVM.day8.C&quot;</span>);<br>      <span class="hljs-comment">//ç”¨äºé˜»å¡ä¸»çº¿ç¨‹</span><br>      System.in.read();<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span> </span>&#123;<br>   D d = <span class="hljs-keyword">new</span> D();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span> </span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ‰“å¼€HSDB<ul><li>å¯ä»¥çœ‹åˆ°æ­¤æ—¶åªåŠ è½½äº†ç±»C</li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223153.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223153.png" alt="img"></a></p><p>æŸ¥çœ‹ç±»Cçš„å¸¸é‡æ± ï¼Œå¯ä»¥çœ‹åˆ°ç±»D<strong>æœªè¢«è§£æ</strong>ï¼Œåªæ˜¯å­˜åœ¨äºå¸¸é‡æ± ä¸­çš„ç¬¦å·</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611230658.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611230658.png" alt="img"></a></p><ul><li><p>è§£æä»¥åï¼Œä¼šå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨è§£æä¸ºç›´æ¥å¼•ç”¨</p><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶å·²åŠ è½½å¹¶è§£æäº†ç±»Cå’Œç±»D</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223441.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200611223441.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200613104723.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200613104723.png" alt="img"></a></p></li></ul><h4 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h4><p>åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯<strong>æ‰§è¡Œç±»æ„é€ å™¨clinit()æ–¹æ³•çš„è¿‡ç¨‹</strong>ï¼Œè™šæ‹Ÿæœºä¼šä¿è¯è¿™ä¸ªç±»çš„ã€æ„é€ æ–¹æ³•ã€çš„çº¿ç¨‹å®‰å…¨</p><ul><li>clinit()æ–¹æ³•æ˜¯ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ”¶é›†ç±»ä¸­çš„æ‰€æœ‰ç±»å˜é‡çš„<strong>èµ‹å€¼åŠ¨ä½œå’Œé™æ€è¯­å¥å—</strong>ï¼ˆstatic{}å—ï¼‰ä¸­çš„è¯­å¥åˆå¹¶äº§ç”Ÿçš„</li></ul><p><strong>æ³¨æ„</strong></p><p>ç¼–è¯‘å™¨æ”¶é›†çš„é¡ºåºæ˜¯ç”±è¯­å¥åœ¨æºæ–‡ä»¶ä¸­<strong>å‡ºç°çš„é¡ºåºå†³å®š</strong>çš„ï¼Œé™æ€è¯­å¥å—ä¸­åªèƒ½è®¿é—®åˆ°å®šä¹‰åœ¨é™æ€è¯­å¥å—ä¹‹å‰çš„å˜é‡ï¼Œå®šä¹‰åœ¨å®ƒ<strong>ä¹‹å</strong>çš„å˜é‡ï¼Œåœ¨å‰é¢çš„é™æ€è¯­å¥å—<strong>å¯ä»¥èµ‹å€¼ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®</strong>ï¼Œå¦‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201118204542.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201118204542.png" alt="img"></a></p><h5 id="å‘ç”Ÿæ—¶æœº"><a href="#å‘ç”Ÿæ—¶æœº" class="headerlink" title="å‘ç”Ÿæ—¶æœº"></a>å‘ç”Ÿæ—¶æœº</h5><p><strong>ç±»çš„åˆå§‹åŒ–çš„æ‡’æƒ°çš„</strong>ï¼Œä»¥ä¸‹æƒ…å†µä¼šåˆå§‹åŒ–</p><ul><li>main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ–</li><li>é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶</li><li>å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘</li><li>å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li><li>Class.forName</li><li>new ä¼šå¯¼è‡´åˆå§‹åŒ–</li></ul><p>ä»¥ä¸‹æƒ…å†µä¸ä¼šåˆå§‹åŒ–</p><ul><li>è®¿é—®ç±»çš„ static ï¬nal é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰</li><li>ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li><li>åˆ›å»ºè¯¥ç±»å¯¹è±¡çš„æ•°ç»„</li><li>ç±»åŠ è½½å™¨çš„.loadClassæ–¹æ³•</li><li>Class.forNamedçš„å‚æ•°2ä¸ºfalseæ—¶</li></ul><p><strong>éªŒè¯ç±»æ˜¯å¦è¢«åˆå§‹åŒ–ï¼Œå¯ä»¥çœ‹æ”¹ç±»çš„é™æ€ä»£ç å—æ˜¯å¦è¢«æ‰§è¡Œ</strong></p><h3 id="5ã€ç±»åŠ è½½å™¨"><a href="#5ã€ç±»åŠ è½½å™¨" class="headerlink" title="5ã€ç±»åŠ è½½å™¨"></a>5ã€ç±»åŠ è½½å™¨</h3><p>Javaè™šæ‹Ÿæœºè®¾è®¡å›¢é˜Ÿæœ‰æ„æŠŠç±»åŠ è½½é˜¶æ®µä¸­çš„<strong>â€œé€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–æè¿°è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµâ€</strong>è¿™ä¸ªåŠ¨ä½œæ”¾åˆ°Javaè™šæ‹Ÿæœºå¤–éƒ¨å»å®ç°ï¼Œä»¥ä¾¿è®©åº”ç”¨ç¨‹åºè‡ªå·±å†³å®šå¦‚ä½•å»è·å–æ‰€éœ€çš„ç±»ã€‚å®ç°è¿™ä¸ªåŠ¨ä½œçš„ä»£ç è¢«ç§°ä¸º<strong>â€œç±»åŠ è½½å™¨â€</strong>ï¼ˆClassLoaderï¼‰</p><h4 id="ç±»ä¸ç±»åŠ è½½å™¨"><a href="#ç±»ä¸ç±»åŠ è½½å™¨" class="headerlink" title="ç±»ä¸ç±»åŠ è½½å™¨"></a>ç±»ä¸ç±»åŠ è½½å™¨</h4><p>ç±»åŠ è½½å™¨è™½ç„¶åªç”¨äºå®ç°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œä½†å®ƒåœ¨Javaç¨‹åºä¸­èµ·åˆ°çš„ä½œç”¨å´è¿œè¶…ç±»åŠ è½½é˜¶æ®µ</p><p>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½å¿…é¡»ç”±åŠ è½½å®ƒçš„<strong>ç±»åŠ è½½å™¨</strong>å’Œè¿™ä¸ª<strong>ç±»æœ¬èº«</strong>ä¸€èµ·å…±åŒç¡®ç«‹å…¶åœ¨Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œæ¯ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œéƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç±»åç§°ç©ºé—´ã€‚è¿™å¥è¯å¯ä»¥è¡¨è¾¾å¾—æ›´é€šä¿—ä¸€äº›ï¼š<strong>æ¯”è¾ƒä¸¤ä¸ªç±»æ˜¯å¦â€œç›¸ç­‰â€ï¼Œåªæœ‰åœ¨è¿™ä¸¤ä¸ªç±»æ˜¯ç”±åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰</strong>ï¼Œå¦åˆ™ï¼Œå³ä½¿è¿™ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªJavaè™šæ‹ŸæœºåŠ è½½ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰</p><p>ä»¥JDK 8ä¸ºä¾‹</p><table><thead><tr><th>åç§°</th><th>åŠ è½½çš„ç±»</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Bootstrap ClassLoaderï¼ˆå¯åŠ¨ç±»åŠ è½½å™¨ï¼‰</td><td>JAVA_HOME/jre/lib</td><td>æ— æ³•ç›´æ¥è®¿é—®</td></tr><tr><td>Extension ClassLoader(æ‹“å±•ç±»åŠ è½½å™¨)</td><td>JAVA_HOME/jre/lib/ext</td><td>ä¸Šçº§ä¸ºBootstrapï¼Œ<strong>æ˜¾ç¤ºä¸ºnull</strong></td></tr><tr><td>Application ClassLoader(åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨)</td><td>classpath</td><td>ä¸Šçº§ä¸ºExtension</td></tr><tr><td>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</td><td>è‡ªå®šä¹‰</td><td>ä¸Šçº§ä¸ºApplication</td></tr></tbody></table><h4 id="å¯åŠ¨ç±»åŠ è½½å™¨"><a href="#å¯åŠ¨ç±»åŠ è½½å™¨" class="headerlink" title="å¯åŠ¨ç±»åŠ è½½å™¨"></a>å¯åŠ¨ç±»åŠ è½½å™¨</h4><p>å¯é€šè¿‡åœ¨æ§åˆ¶å°è¾“å…¥æŒ‡ä»¤ï¼Œä½¿å¾—ç±»è¢«å¯åŠ¨ç±»åŠ å™¨åŠ è½½</p><h4 id="æ‹“å±•ç±»åŠ è½½å™¨"><a href="#æ‹“å±•ç±»åŠ è½½å™¨" class="headerlink" title="æ‹“å±•ç±»åŠ è½½å™¨"></a>æ‹“å±•ç±»åŠ è½½å™¨</h4><p>å¦‚æœclasspathå’ŒJAVA_HOME/jre/lib/ext ä¸‹æœ‰åŒåç±»ï¼ŒåŠ è½½æ—¶ä¼šä½¿ç”¨<strong>æ‹“å±•ç±»åŠ è½½å™¨</strong>åŠ è½½ã€‚å½“åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å‘ç°æ‹“å±•ç±»åŠ è½½å™¨å·²å°†è¯¥åŒåç±»åŠ è½½è¿‡äº†ï¼Œåˆ™ä¸ä¼šå†æ¬¡åŠ è½½</p><h4 id="åŒäº²å§”æ´¾æ¨¡å¼"><a href="#åŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å¼"></a>åŒäº²å§”æ´¾æ¨¡å¼</h4><p>åŒäº²å§”æ´¾æ¨¡å¼ï¼Œå³è°ƒç”¨ç±»åŠ è½½å™¨ClassLoader çš„ loadClass æ–¹æ³•æ—¶ï¼ŒæŸ¥æ‰¾ç±»çš„è§„åˆ™</p><p>loadClassæºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-keyword">boolean</span> resolve)<br>    <span class="hljs-keyword">throws</span> ClassNotFoundException<br>&#123;<br>    <span class="hljs-keyword">synchronized</span> (getClassLoadingLock(name)) &#123;<br>        <span class="hljs-comment">// é¦–å…ˆæŸ¥æ‰¾è¯¥ç±»æ˜¯å¦å·²ç»è¢«è¯¥ç±»åŠ è½½å™¨åŠ è½½è¿‡äº†</span><br>        Class&lt;?&gt; c = findLoadedClass(name);<br>        <span class="hljs-comment">//å¦‚æœæ²¡æœ‰è¢«åŠ è½½è¿‡</span><br>        <span class="hljs-keyword">if</span> (c == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">long</span> t0 = System.nanoTime();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//çœ‹æ˜¯å¦è¢«å®ƒçš„ä¸Šçº§åŠ è½½å™¨åŠ è½½è¿‡äº† Extensionçš„ä¸Šçº§æ˜¯Bootstarpï¼Œä½†å®ƒæ˜¾ç¤ºä¸ºnull</span><br>                <span class="hljs-keyword">if</span> (parent != <span class="hljs-keyword">null</span>) &#123;<br>                    c = parent.loadClass(name, <span class="hljs-keyword">false</span>);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-comment">//çœ‹æ˜¯å¦è¢«å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½è¿‡</span><br>                    c = findBootstrapClassOrNull(name);<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>                <span class="hljs-comment">// ClassNotFoundException thrown if class not found</span><br>                <span class="hljs-comment">// from the non-null parent class loader</span><br>                <span class="hljs-comment">//æ•è·å¼‚å¸¸ï¼Œä½†ä¸åšä»»ä½•å¤„ç†</span><br>            &#125;<br><br>            <span class="hljs-keyword">if</span> (c == <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-comment">//å¦‚æœè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ï¼Œå…ˆè®©æ‹“å±•ç±»åŠ è½½å™¨è°ƒç”¨findClassæ–¹æ³•å»æ‰¾åˆ°è¯¥ç±»ï¼Œå¦‚æœè¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå°±æŠ›å‡ºå¼‚å¸¸</span><br>                <span class="hljs-comment">//ç„¶åè®©åº”ç”¨ç±»åŠ è½½å™¨å»æ‰¾classpathä¸‹æ‰¾è¯¥ç±»</span><br>                <span class="hljs-keyword">long</span> t1 = System.nanoTime();<br>                c = findClass(name);<br><br>                <span class="hljs-comment">// è®°å½•æ—¶é—´</span><br>                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);<br>                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);<br>                sun.misc.PerfCounter.getFindClasses().increment();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (resolve) &#123;<br>            resolveClass(c);<br>        &#125;<br>        <span class="hljs-keyword">return</span> c;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨" class="headerlink" title="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"></a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h4><h5 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h5><ul><li>æƒ³åŠ è½½é classpath éšæ„è·¯å¾„ä¸­çš„ç±»æ–‡ä»¶</li><li>é€šè¿‡æ¥å£æ¥ä½¿ç”¨å®ç°ï¼Œå¸Œæœ›è§£è€¦æ—¶ï¼Œå¸¸ç”¨åœ¨æ¡†æ¶è®¾è®¡</li><li>è¿™äº›ç±»å¸Œæœ›äºˆä»¥éš”ç¦»ï¼Œä¸åŒåº”ç”¨çš„åŒåç±»éƒ½å¯ä»¥åŠ è½½ï¼Œä¸å†²çªï¼Œå¸¸è§äº tomcat å®¹å™¨</li></ul><h5 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h5><ul><li>ç»§æ‰¿ClassLoaderçˆ¶ç±»</li><li>è¦éµä»åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‡å†™ ï¬ndClass æ–¹æ³•<ul><li>ä¸æ˜¯é‡å†™loadClassæ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šèµ°åŒäº²å§”æ´¾æœºåˆ¶</li></ul></li><li>è¯»å–ç±»æ–‡ä»¶çš„å­—èŠ‚ç </li><li>è°ƒç”¨çˆ¶ç±»çš„ deï¬neClass æ–¹æ³•æ¥åŠ è½½ç±»</li><li>ä½¿ç”¨è€…è°ƒç”¨è¯¥ç±»åŠ è½½å™¨çš„ loadClass æ–¹æ³•</li></ul><h4 id="ç ´ååŒäº²å§”æ´¾æ¨¡å¼"><a href="#ç ´ååŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="ç ´ååŒäº²å§”æ´¾æ¨¡å¼"></a>ç ´ååŒäº²å§”æ´¾æ¨¡å¼</h4><ul><li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸€æ¬¡â€œè¢«ç ´åâ€å…¶å®å‘ç”Ÿåœ¨åŒäº²å§”æ´¾æ¨¡å‹å‡ºç°ä¹‹å‰â€”â€”å³JDK1.2é¢ä¸–ä»¥å‰çš„â€œè¿œå¤â€æ—¶ä»£<ul><li>å»ºè®®ç”¨æˆ·é‡å†™findClass()æ–¹æ³•ï¼Œåœ¨ç±»åŠ è½½å™¨ä¸­çš„loadClass()æ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•</li></ul></li><li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬äºŒæ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±è¿™ä¸ªæ¨¡å‹è‡ªèº«çš„ç¼ºé™·å¯¼è‡´çš„<ul><li>å¦‚æœæœ‰åŸºç¡€ç±»å‹åˆè¦è°ƒç”¨å›ç”¨æˆ·çš„ä»£ç ï¼Œæ­¤æ—¶ä¹Ÿä¼šç ´ååŒäº²å§”æ´¾æ¨¡å¼</li></ul></li><li>åŒäº²å§”æ´¾æ¨¡å‹çš„ç¬¬ä¸‰æ¬¡â€œè¢«ç ´åâ€æ˜¯ç”±äºç”¨æˆ·å¯¹ç¨‹åºåŠ¨æ€æ€§çš„è¿½æ±‚è€Œå¯¼è‡´çš„<ul><li>è¿™é‡Œæ‰€è¯´çš„â€œåŠ¨æ€æ€§â€æŒ‡çš„æ˜¯ä¸€äº›éå¸¸â€œçƒ­â€é—¨çš„åè¯ï¼šä»£ç çƒ­æ›¿æ¢ï¼ˆHot Swapï¼‰ã€æ¨¡å—çƒ­éƒ¨ç½²ï¼ˆHot Deploymentï¼‰ç­‰</li></ul></li></ul><h3 id="6ã€è¿è¡ŒæœŸä¼˜åŒ–"><a href="#6ã€è¿è¡ŒæœŸä¼˜åŒ–" class="headerlink" title="6ã€è¿è¡ŒæœŸä¼˜åŒ–"></a>6ã€è¿è¡ŒæœŸä¼˜åŒ–</h3><h4 id="åˆ†å±‚ç¼–è¯‘"><a href="#åˆ†å±‚ç¼–è¯‘" class="headerlink" title="åˆ†å±‚ç¼–è¯‘"></a>åˆ†å±‚ç¼–è¯‘</h4><p>JVM å°†æ‰§è¡ŒçŠ¶æ€åˆ†æˆäº† 5 ä¸ªå±‚æ¬¡ï¼š</p><ul><li>0å±‚ï¼šè§£é‡Šæ‰§è¡Œï¼Œç”¨è§£é‡Šå™¨å°†å­—èŠ‚ç ç¿»è¯‘ä¸ºæœºå™¨ç </li><li>1å±‚ï¼šä½¿ç”¨ C1 <strong>å³æ—¶ç¼–è¯‘å™¨</strong>ç¼–è¯‘æ‰§è¡Œï¼ˆä¸å¸¦ proï¬lingï¼‰</li><li>2å±‚ï¼šä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦åŸºæœ¬çš„profilingï¼‰</li><li>3å±‚ï¼šä½¿ç”¨ C1 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œï¼ˆå¸¦å®Œå…¨çš„profilingï¼‰</li><li>4å±‚ï¼šä½¿ç”¨ C2 å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘æ‰§è¡Œ</li></ul><p>proï¬ling æ˜¯æŒ‡åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ”¶é›†ä¸€äº›ç¨‹åºæ‰§è¡ŒçŠ¶æ€çš„æ•°æ®ï¼Œä¾‹å¦‚ã€æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ã€‘ï¼Œã€å¾ªç¯çš„ å›è¾¹æ¬¡æ•°ã€‘ç­‰</p><h5 id="å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«"><a href="#å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«" class="headerlink" title="å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«"></a>å³æ—¶ç¼–è¯‘å™¨ï¼ˆJITï¼‰ä¸è§£é‡Šå™¨çš„åŒºåˆ«</h5><ul><li>è§£é‡Šå™¨<ul><li>å°†å­—èŠ‚ç <strong>è§£é‡Š</strong>ä¸ºæœºå™¨ç ï¼Œä¸‹æ¬¡å³ä½¿é‡åˆ°ç›¸åŒçš„å­—èŠ‚ç ï¼Œä»ä¼šæ‰§è¡Œé‡å¤çš„è§£é‡Š</li><li>æ˜¯å°†å­—èŠ‚ç è§£é‡Šä¸ºé’ˆå¯¹æ‰€æœ‰å¹³å°éƒ½é€šç”¨çš„æœºå™¨ç </li></ul></li><li>å³æ—¶ç¼–è¯‘å™¨<ul><li>å°†ä¸€äº›å­—èŠ‚ç <strong>ç¼–è¯‘</strong>ä¸ºæœºå™¨ç ï¼Œ<strong>å¹¶å­˜å…¥ Code Cache</strong>ï¼Œä¸‹æ¬¡é‡åˆ°ç›¸åŒçš„ä»£ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œæ— éœ€å†ç¼–è¯‘</li><li>æ ¹æ®å¹³å°ç±»å‹ï¼Œç”Ÿæˆå¹³å°ç‰¹å®šçš„æœºå™¨ç </li></ul></li></ul><p>å¯¹äºå¤§éƒ¨åˆ†çš„ä¸å¸¸ç”¨çš„ä»£ç ï¼Œæˆ‘ä»¬æ— éœ€è€—è´¹æ—¶é—´å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œè€Œæ˜¯é‡‡å–è§£é‡Šæ‰§è¡Œçš„æ–¹å¼è¿è¡Œï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹äºä»…å æ®å°éƒ¨åˆ†çš„çƒ­ç‚¹ä»£ç ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥å°†å…¶ç¼–è¯‘æˆæœºå™¨ç ï¼Œä»¥è¾¾åˆ°ç†æƒ³çš„è¿è¡Œé€Ÿåº¦ã€‚ æ‰§è¡Œæ•ˆç‡ä¸Šç®€å•æ¯”è¾ƒä¸€ä¸‹ Interpreter &lt; C1 &lt; C2ï¼Œæ€»çš„ç›®æ ‡æ˜¯å‘ç°çƒ­ç‚¹ä»£ç ï¼ˆhotspotåç§°çš„ç”± æ¥ï¼‰ï¼Œå¹¶ä¼˜åŒ–è¿™äº›çƒ­ç‚¹ä»£ç </p><h5 id="é€ƒé€¸åˆ†æ"><a href="#é€ƒé€¸åˆ†æ" class="headerlink" title="é€ƒé€¸åˆ†æ"></a>é€ƒé€¸åˆ†æ</h5><p>é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰ç®€å•æ¥è®²å°±æ˜¯ï¼ŒJava Hotspot è™šæ‹Ÿæœºå¯ä»¥åˆ†ææ–°åˆ›å»ºå¯¹è±¡çš„ä½¿ç”¨èŒƒå›´ï¼Œå¹¶å†³å®šæ˜¯å¦åœ¨ Java å †ä¸Šåˆ†é…å†…å­˜çš„ä¸€é¡¹æŠ€æœ¯</p><p>é€ƒé€¸åˆ†æçš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>å¼€å¯é€ƒé€¸åˆ†æï¼š-XX:+DoEscapeAnalysis</li><li>å…³é—­é€ƒé€¸åˆ†æï¼š-XX:-DoEscapeAnalysis</li><li>æ˜¾ç¤ºåˆ†æç»“æœï¼š-XX:+PrintEscapeAnalysis</li></ul><p>é€ƒé€¸åˆ†ææŠ€æœ¯åœ¨ Java SE 6u23+ å¼€å§‹æ”¯æŒï¼Œå¹¶é»˜è®¤è®¾ç½®ä¸ºå¯ç”¨çŠ¶æ€ï¼Œå¯ä»¥ä¸ç”¨é¢å¤–åŠ è¿™ä¸ªå‚æ•°</p><p><strong>å¯¹è±¡é€ƒé€¸çŠ¶æ€</strong></p><p><strong>å…¨å±€é€ƒé€¸ï¼ˆGlobalEscapeï¼‰</strong></p><ul><li>å³ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨èŒƒå›´é€ƒå‡ºäº†å½“å‰æ–¹æ³•æˆ–è€…å½“å‰çº¿ç¨‹ï¼Œæœ‰ä»¥ä¸‹å‡ ç§åœºæ™¯ï¼š<ul><li>å¯¹è±¡æ˜¯ä¸€ä¸ªé™æ€å˜é‡</li><li>å¯¹è±¡æ˜¯ä¸€ä¸ªå·²ç»å‘ç”Ÿé€ƒé€¸çš„å¯¹è±¡</li><li>å¯¹è±¡ä½œä¸ºå½“å‰æ–¹æ³•çš„è¿”å›å€¼</li></ul></li></ul><p><strong>å‚æ•°é€ƒé€¸ï¼ˆArgEscapeï¼‰</strong></p><ul><li>å³ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºæ–¹æ³•å‚æ•°ä¼ é€’æˆ–è€…è¢«å‚æ•°å¼•ç”¨ï¼Œä½†åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­ä¸ä¼šå‘ç”Ÿå…¨å±€é€ƒé€¸ï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯é€šè¿‡è¢«è°ƒæ–¹æ³•çš„å­—èŠ‚ç ç¡®å®šçš„</li></ul><p><strong>æ²¡æœ‰é€ƒé€¸</strong></p><ul><li>å³æ–¹æ³•ä¸­çš„å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸</li></ul><p><strong>é€ƒé€¸åˆ†æä¼˜åŒ–</strong></p><p>é’ˆå¯¹ä¸Šé¢ç¬¬ä¸‰ç‚¹ï¼Œå½“ä¸€ä¸ªå¯¹è±¡<strong>æ²¡æœ‰é€ƒé€¸</strong>æ—¶ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹å‡ ä¸ªè™šæ‹Ÿæœºçš„ä¼˜åŒ–</p><p><strong>é”æ¶ˆé™¤</strong></p><p>æˆ‘ä»¬çŸ¥é“çº¿ç¨‹åŒæ­¥é”æ˜¯éå¸¸ç‰ºç‰²æ€§èƒ½çš„ï¼Œå½“ç¼–è¯‘å™¨ç¡®å®šå½“å‰å¯¹è±¡åªæœ‰å½“å‰çº¿ç¨‹ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±ä¼šç§»é™¤è¯¥å¯¹è±¡çš„åŒæ­¥é”</p><p>ä¾‹å¦‚ï¼ŒStringBuffer å’Œ Vector éƒ½æ˜¯ç”¨ synchronized ä¿®é¥°çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå®ƒä»¬éƒ½åªæ˜¯åœ¨å½“å‰çº¿ç¨‹ä¸­ç”¨åˆ°ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±ä¼šä¼˜åŒ–ç§»é™¤æ‰è¿™äº›é”æ“ä½œ</p><p>é”æ¶ˆé™¤çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>å¼€å¯é”æ¶ˆé™¤ï¼š-XX:+EliminateLocks</li><li>å…³é—­é”æ¶ˆé™¤ï¼š-XX:-EliminateLocks</li></ul><p>é”æ¶ˆé™¤åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”é”æ¶ˆé™¤éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š</p><p><strong>æ ‡é‡æ›¿æ¢</strong></p><p>é¦–å…ˆè¦æ˜ç™½æ ‡é‡å’Œèšåˆé‡ï¼Œ<strong>åŸºç¡€ç±»å‹</strong>å’Œ<strong>å¯¹è±¡çš„å¼•ç”¨</strong>å¯ä»¥ç†è§£ä¸º<strong>æ ‡é‡</strong>ï¼Œå®ƒä»¬ä¸èƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£ã€‚è€Œèƒ½è¢«è¿›ä¸€æ­¥åˆ†è§£çš„é‡å°±æ˜¯èšåˆé‡ï¼Œæ¯”å¦‚ï¼šå¯¹è±¡</p><p>å¯¹è±¡æ˜¯èšåˆé‡ï¼Œå®ƒåˆå¯ä»¥è¢«è¿›ä¸€æ­¥åˆ†è§£æˆæ ‡é‡ï¼Œå°†å…¶æˆå‘˜å˜é‡åˆ†è§£ä¸ºåˆ†æ•£çš„å˜é‡ï¼Œè¿™å°±å«åš<strong>æ ‡é‡æ›¿æ¢</strong>ã€‚</p><p>è¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸ï¼Œé‚£å‹æ ¹å°±ä¸ç”¨åˆ›å»ºå®ƒï¼Œåªä¼šåœ¨æ ˆæˆ–è€…å¯„å­˜å™¨ä¸Šåˆ›å»ºå®ƒç”¨åˆ°çš„æˆå‘˜æ ‡é‡ï¼ŒèŠ‚çœäº†å†…å­˜ç©ºé—´ï¼Œä¹Ÿæå‡äº†åº”ç”¨ç¨‹åºæ€§èƒ½</p><p>æ ‡é‡æ›¿æ¢çš„ JVM å‚æ•°å¦‚ä¸‹ï¼š</p><ul><li>å¼€å¯æ ‡é‡æ›¿æ¢ï¼š-XX:+EliminateAllocations</li><li>å…³é—­æ ‡é‡æ›¿æ¢ï¼š-XX:-EliminateAllocations</li><li>æ˜¾ç¤ºæ ‡é‡æ›¿æ¢è¯¦æƒ…ï¼š-XX:+PrintEliminateAllocations</li></ul><p>æ ‡é‡æ›¿æ¢åŒæ ·åœ¨ JDK8 ä¸­éƒ½æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¹¶ä¸”éƒ½è¦å»ºç«‹åœ¨é€ƒé€¸åˆ†æçš„åŸºç¡€ä¸Š</p><p><strong>æ ˆä¸Šåˆ†é…</strong></p><p>å½“å¯¹è±¡æ²¡æœ‰å‘ç”Ÿé€ƒé€¸æ—¶ï¼Œè¯¥<strong>å¯¹è±¡</strong>å°±å¯ä»¥é€šè¿‡æ ‡é‡æ›¿æ¢åˆ†è§£æˆæˆå‘˜æ ‡é‡åˆ†é…åœ¨<strong>æ ˆå†…å­˜</strong>ä¸­ï¼Œå’Œæ–¹æ³•çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œéšç€æ ˆå¸§å‡ºæ ˆæ—¶é”€æ¯ï¼Œå‡å°‘äº† GC å‹åŠ›ï¼Œæé«˜äº†åº”ç”¨ç¨‹åºæ€§èƒ½</p><h4 id="æ–¹æ³•å†…è”"><a href="#æ–¹æ³•å†…è”" class="headerlink" title="æ–¹æ³•å†…è”"></a>æ–¹æ³•å†…è”</h4><h5 id="å†…è”å‡½æ•°"><a href="#å†…è”å‡½æ•°" class="headerlink" title="å†…è”å‡½æ•°"></a><strong>å†…è”å‡½æ•°</strong></h5><p>å†…è”å‡½æ•°å°±æ˜¯åœ¨ç¨‹åºç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å°†ç¨‹åºä¸­å‡ºç°çš„å†…è”å‡½æ•°çš„è°ƒç”¨è¡¨è¾¾å¼ç”¨å†…è”å‡½æ•°çš„å‡½æ•°ä½“æ¥ç›´æ¥è¿›è¡Œæ›¿æ¢</p><h5 id="JVMå†…è”å‡½æ•°"><a href="#JVMå†…è”å‡½æ•°" class="headerlink" title="JVMå†…è”å‡½æ•°"></a><strong>JVMå†…è”å‡½æ•°</strong></h5><p>C++æ˜¯å¦ä¸ºå†…è”å‡½æ•°ç”±è‡ªå·±å†³å®šï¼ŒJavaç”±<strong>ç¼–è¯‘å™¨å†³å®š</strong>ã€‚Javaä¸æ”¯æŒç›´æ¥å£°æ˜ä¸ºå†…è”å‡½æ•°çš„ï¼Œå¦‚æœæƒ³è®©ä»–å†…è”ï¼Œä½ åªèƒ½å¤Ÿå‘ç¼–è¯‘å™¨æå‡ºè¯·æ±‚: å…³é”®å­—<strong>finalä¿®é¥°</strong> ç”¨æ¥æŒ‡æ˜é‚£ä¸ªå‡½æ•°æ˜¯å¸Œæœ›è¢«JVMå†…è”çš„ï¼Œå¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span> </span>&#123;  <br>        <span class="hljs-comment">// to do something  </span><br>&#125;<br></code></pre></td></tr></table></figure><p>æ€»çš„æ¥è¯´ï¼Œä¸€èˆ¬çš„å‡½æ•°éƒ½ä¸ä¼šè¢«å½“åšå†…è”å‡½æ•°ï¼Œåªæœ‰å£°æ˜äº†finalåï¼Œç¼–è¯‘å™¨æ‰ä¼šè€ƒè™‘æ˜¯ä¸æ˜¯è¦æŠŠä½ çš„å‡½æ•°å˜æˆå†…è”å‡½æ•°</p><p>JVMå†…å»ºæœ‰è®¸å¤šè¿è¡Œæ—¶ä¼˜åŒ–ã€‚é¦–å…ˆ<strong>çŸ­æ–¹æ³•</strong>æ›´åˆ©äºJVMæ¨æ–­ã€‚æµç¨‹æ›´æ˜æ˜¾ï¼Œä½œç”¨åŸŸæ›´çŸ­ï¼Œå‰¯ä½œç”¨ä¹Ÿæ›´æ˜æ˜¾ã€‚å¦‚æœæ˜¯é•¿æ–¹æ³•JVMå¯èƒ½ç›´æ¥å°±è·ªäº†ã€‚</p><p>ç¬¬äºŒä¸ªåŸå› åˆ™æ›´é‡è¦ï¼š<strong>æ–¹æ³•å†…è”</strong></p><p>å¦‚æœJVMç›‘æµ‹åˆ°ä¸€äº›<strong>å°æ–¹æ³•è¢«é¢‘ç¹çš„æ‰§è¡Œ</strong>ï¼Œå®ƒä¼šæŠŠæ–¹æ³•çš„è°ƒç”¨æ›¿æ¢æˆæ–¹æ³•ä½“æœ¬èº«ï¼Œå¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add4</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> x3, <span class="hljs-keyword">int</span> x4)</span> </span>&#123; <br><span class="hljs-comment">//è¿™é‡Œè°ƒç”¨äº†add2æ–¹æ³•</span><br>        <span class="hljs-keyword">return</span> add2(x1, x2) + add2(x3, x4);  <br>    &#125;  <br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2)</span> </span>&#123;  <br>        <span class="hljs-keyword">return</span> x1 + x2;  <br>    &#125;<br></code></pre></td></tr></table></figure><p>æ–¹æ³•è°ƒç”¨è¢«æ›¿æ¢å</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">add4</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x1, <span class="hljs-keyword">int</span> x2, <span class="hljs-keyword">int</span> x3, <span class="hljs-keyword">int</span> x4)</span> </span>&#123;  <br>    <span class="hljs-comment">//è¢«æ›¿æ¢ä¸ºäº†æ–¹æ³•æœ¬èº«</span><br>        <span class="hljs-keyword">return</span> x1 + x2 + x3 + x4;  <br>&#125;<br></code></pre></td></tr></table></figure><h4 id="åå°„ä¼˜åŒ–"><a href="#åå°„ä¼˜åŒ–" class="headerlink" title="åå°„ä¼˜åŒ–"></a>åå°„ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reflect1</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">foo</span><span class="hljs-params">()</span> </span>&#123;<br>      System.out.println(<span class="hljs-string">&quot;foo...&quot;</span>);<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException </span>&#123;<br>      Method foo = Demo3.class.getMethod(<span class="hljs-string">&quot;foo&quot;</span>);<br>      <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i&lt;=<span class="hljs-number">16</span>; i++) &#123;<br>         foo.invoke(<span class="hljs-keyword">null</span>);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>foo.invoke å‰é¢ 0 ~ 15 æ¬¡è°ƒç”¨ä½¿ç”¨çš„æ˜¯ MethodAccessor çš„ NativeMethodAccessorImpl å®ç°</p><p>invokeæ–¹æ³•æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CallerSensitive</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object obj, Object... args)</span></span><br><span class="hljs-function">    <span class="hljs-keyword">throws</span> IllegalAccessException, IllegalArgumentException,</span><br><span class="hljs-function">       InvocationTargetException</span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!override) &#123;<br>        <span class="hljs-keyword">if</span> (!Reflection.quickCheckMemberAccess(clazz, modifiers)) &#123;<br>            Class&lt;?&gt; caller = Reflection.getCallerClass();<br>            checkAccess(caller, clazz, obj, modifiers);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//MethodAccessoræ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰3ä¸ªå®ç°ç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯æŠ½è±¡ç±»</span><br>    MethodAccessor ma = methodAccessor;             <span class="hljs-comment">// read volatile</span><br>    <span class="hljs-keyword">if</span> (ma == <span class="hljs-keyword">null</span>) &#123;<br>        ma = acquireMethodAccessor();<br>    &#125;<br>    <span class="hljs-keyword">return</span> ma.invoke(obj, args);<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614133554.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614133554.png" alt="img"></a></p><p>ä¼šç”±DelegatingMehodAccessorImplå»è°ƒç”¨NativeMethodAccessorImpl</p><p>NativeMethodAccessorImplæºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NativeMethodAccessorImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MethodAccessorImpl</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Method method;<br>    <span class="hljs-keyword">private</span> DelegatingMethodAccessorImpl parent;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> numInvocations;<br><br>    NativeMethodAccessorImpl(Method var1) &#123;<br>        <span class="hljs-keyword">this</span>.method = var1;<br>    &#125;<br><br><span class="hljs-comment">//æ¯æ¬¡è¿›è¡Œåå°„è°ƒç”¨ï¼Œä¼šè®©numInvocationä¸ReflectionFactory.inflationThresholdçš„å€¼ï¼ˆ15ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶ä½¿ä½¿å¾—numInvocationçš„å€¼åŠ ä¸€</span><br><span class="hljs-comment">//å¦‚æœnumInvocation&gt;ReflectionFactory.inflationThresholdï¼Œåˆ™ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0æ–¹æ³•</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object var1, Object[] var2)</span> <span class="hljs-keyword">throws</span> IllegalArgumentException, InvocationTargetException </span>&#123;<br>        <span class="hljs-keyword">if</span> (++<span class="hljs-keyword">this</span>.numInvocations &gt; ReflectionFactory.inflationThreshold() &amp;&amp; !ReflectUtil.isVMAnonymousClass(<span class="hljs-keyword">this</span>.method.getDeclaringClass())) &#123;<br>            MethodAccessorImpl var3 = (MethodAccessorImpl)(<span class="hljs-keyword">new</span> MethodAccessorGenerator()).generateMethod(<span class="hljs-keyword">this</span>.method.getDeclaringClass(), <span class="hljs-keyword">this</span>.method.getName(), <span class="hljs-keyword">this</span>.method.getParameterTypes(), <span class="hljs-keyword">this</span>.method.getReturnType(), <span class="hljs-keyword">this</span>.method.getExceptionTypes(), <span class="hljs-keyword">this</span>.method.getModifiers());<br>            <span class="hljs-keyword">this</span>.parent.setDelegate(var3);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> invoke0(<span class="hljs-keyword">this</span>.method, var1, var2);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setParent</span><span class="hljs-params">(DelegatingMethodAccessorImpl var1)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.parent = var1;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> Object <span class="hljs-title">invoke0</span><span class="hljs-params">(Method var0, Object var1, Object[] var2)</span></span>;<br>&#125;<br><span class="hljs-comment">//ReflectionFactory.inflationThreshold()æ–¹æ³•çš„è¿”å›å€¼</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> inflationThreshold = <span class="hljs-number">15</span>;<br></code></pre></td></tr></table></figure><ul><li>ä¸€å¼€å§‹ifæ¡ä»¶ä¸æ»¡è¶³ï¼Œå°±ä¼šè°ƒç”¨æœ¬åœ°æ–¹æ³•invoke0</li><li>éšç€numInvocationçš„å¢å¤§ï¼Œå½“å®ƒå¤§äºReflectionFactory.inflationThresholdçš„å€¼16æ—¶ï¼Œå°±ä¼šæœ¬åœ°æ–¹æ³•è®¿é—®å™¨æ›¿æ¢ä¸ºä¸€ä¸ªè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„è®¿é—®å™¨ï¼Œæ¥æé«˜æ•ˆç‡<ul><li>è¿™æ—¶ä¼šä»åå°„è°ƒç”¨å˜ä¸º<strong>æ­£å¸¸è°ƒç”¨</strong>ï¼Œå³ç›´æ¥è°ƒç”¨ Reflect1.foo()</li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614135011.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200614135011.png" alt="img"></a></p><h2 id="äº”ã€å†…å­˜æ¨¡å‹"><a href="#äº”ã€å†…å­˜æ¨¡å‹" class="headerlink" title="äº”ã€å†…å­˜æ¨¡å‹"></a>äº”ã€å†…å­˜æ¨¡å‹</h2><p>å†…å­˜æ¨¡å‹å†…å®¹è¯¦è§ <a href="http://lihengxu.cn/2021/04/17/JUC/#%E5%9B%9B%E3%80%81%E5%85%B1%E4%BA%AB%E6%A8%A1%E5%9E%8B%E4%B9%8B%E5%86%85%E5%AD%98">JAVAå¹¶å‘ ç¬¬å››ç« </a></p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUCå­¦ä¹ </title>
    <link href="/2021/04/17/JUC/"/>
    <url>/2021/04/17/JUC/</url>
    
    <content type="html"><![CDATA[<h1 id="å¹¶å‘ç¼–ç¨‹ç¬”è®°"><a href="#å¹¶å‘ç¼–ç¨‹ç¬”è®°" class="headerlink" title="å¹¶å‘ç¼–ç¨‹ç¬”è®°"></a>å¹¶å‘ç¼–ç¨‹ç¬”è®°</h1><p><a href="https://www.bilibili.com/video/av81461839?from=search&seid=8445102345230304010"><strong>é»‘é©¬javaå¹¶å‘ç¼–ç¨‹æ•™ç¨‹</strong></a>æ•™å­¦è§†é¢‘çš„ç¬”è®°ï¼ˆè½¬è½½<a href="https://nyimac.gitee.io/2020/06/08/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">nyimac</a>ï¼Œå†è½¬ä¸€ç¯‡å­¦ä¹ å­¦ä¹ ï¼Œè¡¥å……äº†éƒ¨åˆ†ç¬”è®°ï¼Œç­‰çœ‹ä¸€éã€Šjavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹åï¼Œå†æ•´ç†è‡ªå·±çš„å­¦ä¹ noteå§ï¼‰</p><h1 id="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"><a href="#ä¸€ã€åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ä¸€ã€åŸºæœ¬æ¦‚å¿µ"></a>ä¸€ã€åŸºæœ¬æ¦‚å¿µ</h1><h2 id="1ã€è¿›ç¨‹ä¸çº¿ç¨‹"><a href="#1ã€è¿›ç¨‹ä¸çº¿ç¨‹" class="headerlink" title="1ã€è¿›ç¨‹ä¸çº¿ç¨‹"></a>1ã€è¿›ç¨‹ä¸çº¿ç¨‹</h2><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><ul><li>ç¨‹åºç”±æŒ‡ä»¤å’Œæ•°æ®ç»„æˆï¼Œä½†è¿™äº›æŒ‡ä»¤è¦è¿è¡Œï¼Œæ•°æ®è¦è¯»å†™ï¼Œå°±å¿…é¡»å°†æŒ‡ä»¤åŠ è½½è‡³ CPUï¼Œæ•°æ®åŠ è½½è‡³å†…å­˜ã€‚åœ¨æŒ‡ä»¤è¿è¡Œè¿‡ç¨‹ä¸­è¿˜éœ€è¦ç”¨åˆ°ç£ç›˜ã€ç½‘ç»œç­‰è®¾å¤‡ã€‚è¿›ç¨‹å°±æ˜¯ç”¨æ¥åŠ è½½æŒ‡ä»¤ã€ç®¡ç†å†…å­˜ã€ç®¡ç† IO çš„ã€‚</li><li>å½“ä¸€ä¸ªç¨‹åºè¢«è¿è¡Œï¼Œä»ç£ç›˜åŠ è½½è¿™ä¸ªç¨‹åºçš„ä»£ç è‡³å†…å­˜ï¼Œè¿™æ—¶å°±å¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ã€‚</li><li>è¿›ç¨‹å°±å¯ä»¥è§†ä¸ºç¨‹åºçš„ä¸€ä¸ªå®ä¾‹ã€‚å¤§éƒ¨åˆ†ç¨‹åºå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚è®°äº‹æœ¬ã€ç”»å›¾ã€æµè§ˆå™¨ ç­‰ï¼‰ï¼Œä¹Ÿæœ‰çš„ç¨‹åºåªèƒ½å¯åŠ¨ä¸€ä¸ªå®ä¾‹è¿›ç¨‹ï¼ˆä¾‹å¦‚ç½‘æ˜“äº‘éŸ³ä¹ã€360 å®‰å…¨å«å£«ç­‰ï¼‰</li></ul><h3 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h3><ul><li>ä¸€ä¸ªè¿›ç¨‹ä¹‹å†…å¯ä»¥åˆ†ä¸ºä¸€åˆ°å¤šä¸ªçº¿ç¨‹ã€‚</li><li>ä¸€ä¸ªçº¿ç¨‹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤æµï¼Œå°†æŒ‡ä»¤æµä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ä»¥ä¸€å®šçš„é¡ºåºäº¤ç»™ CPU æ‰§è¡Œ ã€‚</li><li>Java ä¸­ï¼Œçº¿ç¨‹ä½œä¸ºå°è°ƒåº¦å•ä½ï¼Œè¿›ç¨‹ä½œä¸ºèµ„æºåˆ†é…çš„å°å•ä½ã€‚ åœ¨ windows ä¸­è¿›ç¨‹æ˜¯ä¸æ´»åŠ¨çš„ï¼Œåªæ˜¯ä½œ ä¸ºçº¿ç¨‹çš„å®¹å™¨</li></ul><h3 id="äºŒè€…å¯¹æ¯”"><a href="#äºŒè€…å¯¹æ¯”" class="headerlink" title="äºŒè€…å¯¹æ¯”"></a>äºŒè€…å¯¹æ¯”</h3><ul><li>è¿›ç¨‹åŸºæœ¬ä¸Šç›¸äº’ç‹¬ç«‹çš„ï¼Œè€Œçº¿ç¨‹å­˜åœ¨äºè¿›ç¨‹å†…ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå­é›† è¿›ç¨‹æ‹¥æœ‰å…±äº«çš„èµ„æºï¼Œå¦‚å†…å­˜ç©ºé—´ç­‰ï¼Œä¾›å…¶å†…éƒ¨çš„çº¿ç¨‹å…±äº«<ul><li>è¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ åŒä¸€å°è®¡ç®—æœºçš„è¿›ç¨‹é€šä¿¡ç§°ä¸º IPCï¼ˆInter-process communicationï¼‰</li><li>ä¸åŒè®¡ç®—æœºä¹‹é—´çš„è¿›ç¨‹é€šä¿¡ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œï¼Œå¹¶éµå®ˆå…±åŒçš„åè®®ï¼Œä¾‹å¦‚ HTTP</li></ul></li><li>çº¿ç¨‹é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå› ä¸ºå®ƒä»¬å…±äº«è¿›ç¨‹å†…çš„å†…å­˜ï¼Œä¸€ä¸ªä¾‹å­æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«å˜é‡ çº¿ç¨‹æ›´è½»é‡ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ä¸€èˆ¬ä¸Šè¦æ¯”è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ä½</li></ul><h4 id="è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢"><a href="#è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢" class="headerlink" title="è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢"></a>è¿›ç¨‹å’Œçº¿ç¨‹çš„åˆ‡æ¢</h4><p><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong></p><p>å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹ç»´æŒä¸€ä¸ªä¸Šä¸‹æ–‡ã€‚<strong>ä¸Šä¸‹æ–‡å°±æ˜¯å†…æ ¸é‡æ–°å¯åŠ¨ä¸€ä¸ªè¢«æŠ¢å çš„è¿›ç¨‹æ‰€éœ€çš„çŠ¶æ€ã€‚</strong>åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>é€šç”¨ç›®çš„å¯„å­˜å™¨</li><li>æµ®ç‚¹å¯„å­˜å™¨</li><li>ç¨‹åºè®¡æ•°å™¨</li><li>ç”¨æˆ·æ ˆ</li><li>çŠ¶æ€å¯„å­˜å™¨</li><li>å†…æ ¸æ ˆ</li><li>å„ç§å†…æ ¸æ•°æ®ç»“æ„ï¼šæ¯”å¦‚æç»˜åœ°å€ç©ºé—´çš„<strong>é¡µè¡¨</strong>ï¼ŒåŒ…å«æœ‰å…³å½“å‰è¿›ç¨‹ä¿¡æ¯çš„<strong>è¿›ç¨‹è¡¨</strong>ï¼Œä»¥åŠåŒ…å«è¿›ç¨‹å·²æ‰“å¼€æ–‡ä»¶çš„ä¿¡æ¯çš„<strong>æ–‡ä»¶è¡¨</strong></li></ul><p><strong>è¿›ç¨‹åˆ‡æ¢å’Œçº¿ç¨‹åˆ‡æ¢çš„ä¸»è¦åŒºåˆ«</strong></p><p>æœ€ä¸»è¦çš„ä¸€ä¸ªåŒºåˆ«åœ¨äº<strong>è¿›ç¨‹åˆ‡æ¢æ¶‰åŠè™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ‡æ¢è€Œçº¿ç¨‹ä¸ä¼š</strong>ã€‚å› ä¸ºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè€Œ<strong>çº¿ç¨‹æ˜¯å…±äº«æ‰€åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„</strong>ï¼Œå› æ­¤åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹è¿›è¡Œçº¿ç¨‹åˆ‡æ¢æ—¶ä¸æ¶‰åŠè™šæ‹Ÿåœ°å€ç©ºé—´çš„è½¬æ¢</p><p>é¡µè¡¨æŸ¥æ‰¾æ˜¯ä¸€ä¸ªå¾ˆæ…¢çš„è¿‡ç¨‹ï¼Œå› æ­¤é€šå¸¸ä½¿ç”¨cacheæ¥ç¼“å­˜å¸¸ç”¨çš„åœ°å€æ˜ å°„ï¼Œè¿™æ ·å¯ä»¥åŠ é€Ÿé¡µè¡¨æŸ¥æ‰¾ï¼Œè¿™ä¸ªcacheå°±æ˜¯å¿«è¡¨TLBï¼ˆtranslation Lookaside Bufferï¼Œç”¨æ¥åŠ é€Ÿé¡µè¡¨æŸ¥æ‰¾ï¼‰ã€‚ç”±äºæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œé‚£ä¹ˆæ˜¾ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œé‚£ä¹ˆ<strong>å½“è¿›ç¨‹åˆ‡æ¢åé¡µè¡¨ä¹Ÿè¦è¿›è¡Œåˆ‡æ¢ï¼Œé¡µè¡¨åˆ‡æ¢åTLBå°±å¤±æ•ˆäº†</strong>ï¼Œcacheå¤±æ•ˆå¯¼è‡´å‘½ä¸­ç‡é™ä½ï¼Œé‚£ä¹ˆè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€å°±ä¼šå˜æ…¢ï¼Œè¡¨ç°å‡ºæ¥çš„å°±æ˜¯ç¨‹åºè¿è¡Œä¼šå˜æ…¢ï¼Œè€Œçº¿ç¨‹åˆ‡æ¢åˆ™ä¸ä¼šå¯¼è‡´TLBå¤±æ•ˆï¼Œå› ä¸ºçº¿ç¨‹çº¿ç¨‹æ— éœ€åˆ‡æ¢åœ°å€ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬é€šå¸¸è¯´çº¿ç¨‹åˆ‡æ¢è¦æ¯”è¾ƒè¿›ç¨‹åˆ‡æ¢å¿«</p><p>è€Œä¸”è¿˜å¯èƒ½å‡ºç°<strong>ç¼ºé¡µä¸­æ–­</strong>ï¼Œè¿™å°±éœ€è¦æ“ä½œç³»ç»Ÿå°†éœ€è¦çš„å†…å®¹è°ƒå…¥å†…å­˜ä¸­ï¼Œè‹¥å†…å­˜å·²æ»¡åˆ™è¿˜éœ€è¦å°†ä¸ç”¨çš„å†…å®¹è°ƒå‡ºå†…å­˜ï¼Œè¿™ä¹Ÿéœ€è¦èŠ±è´¹æ—¶é—´</p><p><strong>ä¸ºä»€ä¹ˆTLBèƒ½åŠ å¿«è®¿é—®é€Ÿåº¦</strong></p><p>å¿«è¡¨å¯ä»¥é¿å…æ¯æ¬¡éƒ½å¯¹é¡µå·è¿›è¡Œåœ°å€çš„æœ‰æ•ˆæ€§åˆ¤æ–­ã€‚å¿«è¡¨ä¸­ä¿å­˜äº†å¯¹åº”çš„ç‰©ç†å—å·ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—å‡ºç‰©ç†åœ°å€ï¼Œæ— éœ€å†è¿›è¡Œæœ‰æ•ˆæ€§æ£€æŸ¥</p><h2 id="2ã€å¹¶å‘ä¸å¹¶è¡Œ"><a href="#2ã€å¹¶å‘ä¸å¹¶è¡Œ" class="headerlink" title="2ã€å¹¶å‘ä¸å¹¶è¡Œ"></a>2ã€å¹¶å‘ä¸å¹¶è¡Œ</h2><p>å¹¶å‘æ˜¯ä¸€ä¸ªCPUåœ¨ä¸åŒçš„æ—¶é—´å»ä¸åŒçº¿ç¨‹ä¸­æ‰§è¡ŒæŒ‡ä»¤ã€‚</p><p>å¹¶è¡Œæ˜¯å¤šä¸ªCPUåŒæ—¶å¤„ç†ä¸åŒçš„çº¿ç¨‹ã€‚</p><p>å¼•ç”¨ Rob Pike çš„ä¸€æ®µæè¿°ï¼š</p><ul><li>å¹¶å‘ï¼ˆconcurrentï¼‰æ˜¯åŒä¸€æ—¶é—´<strong>åº”å¯¹</strong>ï¼ˆdealing withï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</li><li>å¹¶è¡Œï¼ˆparallelï¼‰æ˜¯åŒä¸€æ—¶é—´<strong>åŠ¨æ‰‹åš</strong>ï¼ˆdoingï¼‰å¤šä»¶äº‹æƒ…çš„èƒ½åŠ›</li></ul><h3 id="3ã€åº”ç”¨"><a href="#3ã€åº”ç”¨" class="headerlink" title="3ã€åº”ç”¨"></a>3ã€åº”ç”¨</h3><h4 id="åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰"><a href="#åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰" class="headerlink" title="åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰"></a>åº”ç”¨ä¹‹å¼‚æ­¥è°ƒç”¨ï¼ˆæ¡ˆä¾‹1ï¼‰</h4><p>ä»¥è°ƒç”¨æ–¹è§’åº¦æ¥è®²ï¼Œå¦‚æœ</p><ul><li>éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯åŒæ­¥</li><li>ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯å¼‚æ­¥</li></ul><ol><li>è®¾è®¡<br>å¤šçº¿ç¨‹å¯ä»¥è®©æ–¹æ³•æ‰§è¡Œå˜ä¸ºå¼‚æ­¥çš„ï¼ˆå³ä¸è¦å·´å·´å¹²ç­‰ç€ï¼‰æ¯”å¦‚è¯´è¯»å–ç£ç›˜æ–‡ä»¶æ—¶ï¼Œå‡è®¾è¯»å–æ“ä½œèŠ±è´¹äº† 5 ç§’é’Ÿï¼Œå¦‚ æœæ²¡æœ‰çº¿ç¨‹è°ƒåº¦æœºåˆ¶ï¼Œè¿™ 5 ç§’ cpu ä»€ä¹ˆéƒ½åšä¸äº†ï¼Œå…¶å®ƒä»£ç éƒ½å¾—æš‚åœâ€¦</li><li>ç»“è®º</li></ol><ul><li>æ¯”å¦‚åœ¨é¡¹ç›®ä¸­ï¼Œè§†é¢‘æ–‡ä»¶éœ€è¦è½¬æ¢æ ¼å¼ç­‰æ“ä½œæ¯”è¾ƒè´¹æ—¶ï¼Œè¿™æ—¶å¼€ä¸€ä¸ªæ–°çº¿ç¨‹å¤„ç†è§†é¢‘è½¬æ¢ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹</li><li>tomcat çš„å¼‚æ­¥ servlet ä¹Ÿæ˜¯ç±»ä¼¼çš„ç›®çš„ï¼Œè®©ç”¨æˆ·çº¿ç¨‹å¤„ç†è€—æ—¶è¾ƒé•¿çš„æ“ä½œï¼Œé¿å…é˜»å¡</li><li>tomcat çš„å·¥ä½œçº¿ç¨‹ ui ç¨‹åºä¸­ï¼Œå¼€çº¿ç¨‹è¿›è¡Œå…¶ä»–æ“ä½œï¼Œé¿å…é˜»å¡ ui çº¿ç¨‹</li></ul><p>ç»“è®º</p><ol><li>å•æ ¸ cpu ä¸‹ï¼Œå¤šçº¿ç¨‹ä¸èƒ½å®é™…æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡ï¼Œåªæ˜¯ä¸ºäº†èƒ½å¤Ÿåœ¨ä¸åŒçš„ä»»åŠ¡ä¹‹é—´åˆ‡æ¢ï¼Œä¸åŒçº¿ç¨‹è½®æµä½¿ç”¨ cpu ï¼Œä¸è‡³äºä¸€ä¸ªçº¿ç¨‹æ€»å ç”¨ cpuï¼Œåˆ«çš„çº¿ç¨‹æ²¡æ³•å¹²æ´»</li><li>å¤šæ ¸ cpu å¯ä»¥å¹¶è¡Œè·‘å¤šä¸ªçº¿ç¨‹ï¼Œä½†èƒ½å¦æé«˜ç¨‹åºè¿è¡Œæ•ˆç‡è¿˜æ˜¯è¦åˆ†æƒ…å†µçš„<ul><li>æœ‰äº›ä»»åŠ¡ï¼Œç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œå°†ä»»åŠ¡æ‹†åˆ†ï¼Œå¹¶è¡Œæ‰§è¡Œï¼Œå½“ç„¶å¯ä»¥æé«˜ç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚ä½†ä¸æ˜¯æ‰€æœ‰è®¡ç®—ä»» åŠ¡éƒ½èƒ½æ‹†åˆ†ï¼ˆå‚è€ƒåæ–‡çš„ã€é˜¿å§†è¾¾å°”å®šå¾‹ã€‘ï¼‰</li><li>ä¹Ÿä¸æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ‹†åˆ†ï¼Œä»»åŠ¡çš„ç›®çš„å¦‚æœä¸åŒï¼Œè°ˆæ‹†åˆ†å’Œæ•ˆç‡æ²¡å•¥æ„ä¹‰</li></ul></li><li>IO æ“ä½œä¸å ç”¨ cpuï¼Œåªæ˜¯æˆ‘ä»¬ä¸€èˆ¬æ‹·è´æ–‡ä»¶ä½¿ç”¨çš„æ˜¯ã€é˜»å¡ IOã€‘ï¼Œè¿™æ—¶ç›¸å½“äºçº¿ç¨‹è™½ç„¶ä¸ç”¨ cpuï¼Œä½†éœ€è¦ä¸€ ç›´ç­‰å¾… IO ç»“æŸï¼Œæ²¡èƒ½å……åˆ†åˆ©ç”¨çº¿ç¨‹ã€‚æ‰€ä»¥æ‰æœ‰åé¢çš„ã€éé˜»å¡ IOã€‘å’Œã€å¼‚æ­¥ IOã€‘ä¼˜åŒ–</li></ol><h1 id="äºŒã€çº¿ç¨‹çš„åˆ›å»º"><a href="#äºŒã€çº¿ç¨‹çš„åˆ›å»º" class="headerlink" title="äºŒã€çº¿ç¨‹çš„åˆ›å»º"></a>äºŒã€çº¿ç¨‹çš„åˆ›å»º</h1><h2 id="1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰"><a href="#1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰" class="headerlink" title="1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰"></a>1ã€åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰</h2><h3 id="æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿Threadåˆ›å»ºçº¿ç¨‹"><a href="#æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿Threadåˆ›å»ºçº¿ç¨‹" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿Threadåˆ›å»ºçº¿ç¨‹"></a>æ–¹æ³•ä¸€ï¼šé€šè¿‡ç»§æ‰¿Threadåˆ›å»ºçº¿ç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateThread</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>Thread myThread = <span class="hljs-keyword">new</span> MyThread();<br>        <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span><br>myThread.start();<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span> </span>&#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;my thread running...&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ç»§æ‰¿æ–¹å¼çš„å¥½å¤„æ˜¯ï¼Œåœ¨runï¼ˆï¼‰æ–¹æ³•å†…è·å–å½“å‰çº¿ç¨‹ç›´æ¥ä½¿ç”¨thiså°±å¯ä»¥äº†ï¼Œæ— é¡»ä½¿ç”¨Thread.currentThreadï¼ˆï¼‰æ–¹æ³•ï¼›ä¸å¥½çš„åœ°æ–¹æ˜¯Javaä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆå°±ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ã€‚å¦å¤–ä»»åŠ¡ä¸ä»£ç æ²¡æœ‰åˆ†ç¦»ï¼Œå½“å¤šä¸ªçº¿ç¨‹æ‰§è¡Œä¸€æ ·çš„ä»»åŠ¡æ—¶éœ€è¦å¤šä»½ä»»åŠ¡ä»£ç </p><h3 id="æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread-æ¨è"><a href="#æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread-æ¨è" class="headerlink" title="æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread(æ¨è)"></a>æ–¹æ³•äºŒï¼šä½¿ç”¨Runnableé…åˆThread(æ¨è)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹ä»»åŠ¡</span><br>Runnable r = <span class="hljs-keyword">new</span> Runnable() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;Runnable running&quot;</span>);<br>&#125;<br>&#125;;<br><span class="hljs-comment">//å°†Runnableå¯¹è±¡ä¼ ç»™Thread</span><br>Thread t = <span class="hljs-keyword">new</span> Thread(r);<br><span class="hljs-comment">//å¯åŠ¨çº¿ç¨‹</span><br>t.start();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CreateThread2</span> </span>&#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>         System.out.println(<span class="hljs-string">&quot;my runnable running...&quot;</span>);<br>      &#125;<br>   &#125;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      MyRunnable myRunnable = <span class="hljs-keyword">new</span> MyRunnable();<br>      Thread thread = <span class="hljs-keyword">new</span> Thread(myRunnable);<br>      thread.start();<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é€šè¿‡å®ç°Runnableæ¥å£ï¼Œå¹¶ä¸”å®ç°run()æ–¹æ³•ã€‚åœ¨åˆ›å»ºçº¿ç¨‹æ—¶ä½œä¸ºå‚æ•°ä¼ å…¥è¯¥ç±»çš„å®ä¾‹å³å¯</p><h4 id="æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ"><a href="#æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ" class="headerlink" title="æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ"></a>æ–¹æ³•äºŒçš„ç®€åŒ–ï¼šä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ“ä½œ</h4><p><strong>å½“ä¸€ä¸ªæ¥å£å¸¦æœ‰@FunctionalInterfaceæ³¨è§£æ—¶ï¼Œæ˜¯å¯ä»¥ä½¿ç”¨lambdaæ¥ç®€åŒ–æ“ä½œçš„</strong></p><p>æ‰€ä»¥æ–¹æ³•äºŒä¸­çš„ä»£ç å¯ä»¥è¢«ç®€åŒ–ä¸º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹ä»»åŠ¡</span><br>Runnable r = () -&gt; &#123;<br>            <span class="hljs-comment">//ç›´æ¥å†™æ–¹æ³•ä½“å³å¯</span><br>System.out.println(<span class="hljs-string">&quot;Runnable running&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;Hello Thread&quot;</span>);<br>&#125;;<br><span class="hljs-comment">//å°†Runnableå¯¹è±¡ä¼ ç»™Thread</span><br>Thread t = <span class="hljs-keyword">new</span> Thread(r);<br><span class="hljs-comment">//å¯åŠ¨çº¿ç¨‹</span><br>t.start();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥å†Runnableä¸Šä½¿ç”¨Alt+Enter</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144534.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144534.png" alt="img"></a></p><h4 id="åŸç†ä¹‹-Thread-ä¸-Runnable-çš„å…³ç³»"><a href="#åŸç†ä¹‹-Thread-ä¸-Runnable-çš„å…³ç³»" class="headerlink" title="åŸç†ä¹‹ Thread ä¸ Runnable çš„å…³ç³»"></a>åŸç†ä¹‹ Thread ä¸ Runnable çš„å…³ç³»</h4><p>åˆ†æ Thread çš„æºç ï¼Œç†æ¸…å®ƒä¸ Runnable çš„å…³ç³»<br><strong>å°ç»“</strong></p><ul><li>æ–¹æ³•1 æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆå¹¶åœ¨äº†ä¸€èµ·</li><li>æ–¹æ³•2 æ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆ†å¼€äº†</li><li>ç”¨ Runnable æ›´å®¹æ˜“ä¸çº¿ç¨‹æ± ç­‰é«˜çº§ API é…åˆ ç”¨ Runnable è®©ä»»åŠ¡ç±»è„±ç¦»äº† Thread ç»§æ‰¿ä½“ç³»ï¼Œæ›´çµæ´»</li></ul><h3 id="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ"><a href="#æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ" class="headerlink" title="æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ"></a>æ–¹æ³•ä¸‰ï¼šä½¿ç”¨FutureTaskä¸Threadç»“åˆ</h3><p><strong>ä½¿ç”¨FutureTaskå¯ä»¥ç”¨æ³›å‹æŒ‡å®šçº¿ç¨‹çš„è¿”å›å€¼ç±»å‹ï¼ˆRunnableçš„runæ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test3</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>&#123;<br>        <span class="hljs-comment">//éœ€è¦ä¼ å…¥ä¸€ä¸ªCallableå¯¹è±¡</span><br>FutureTask&lt;Integer&gt; task = <span class="hljs-keyword">new</span> FutureTask&lt;Integer&gt;(<span class="hljs-keyword">new</span> Callable&lt;Integer&gt;() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;çº¿ç¨‹æ‰§è¡Œ!&quot;</span>);<br>Thread.sleep(<span class="hljs-number">1000</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">100</span>;<br>&#125;<br>&#125;);<br><br>Thread r1 = <span class="hljs-keyword">new</span> Thread(task, <span class="hljs-string">&quot;t2&quot;</span>);<br>r1.start();<br><span class="hljs-comment">//è·å–çº¿ç¨‹ä¸­æ–¹æ³•æ‰§è¡Œåçš„è¿”å›ç»“æœ</span><br>System.out.println(task.get());<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UseFutureTask</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ExecutionException, InterruptedException </span>&#123;<br>      FutureTask&lt;String&gt; futureTask = <span class="hljs-keyword">new</span> FutureTask&lt;&gt;(<span class="hljs-keyword">new</span> MyCall());<br>      Thread thread = <span class="hljs-keyword">new</span> Thread(futureTask);<br>      thread.start();<br>      <span class="hljs-comment">// è·å¾—çº¿ç¨‹è¿è¡Œåçš„è¿”å›å€¼</span><br>      System.out.println(futureTask.get());<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCall</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Callable</span>&lt;<span class="hljs-title">String</span>&gt; </span>&#123;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello world&quot;</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä½¿ç”¨<strong>ç»§æ‰¿æ–¹å¼çš„å¥½å¤„æ˜¯æ–¹ä¾¿ä¼ å‚</strong>ï¼Œä½ å¯ä»¥åœ¨å­ç±»é‡Œé¢æ·»åŠ æˆå‘˜å˜é‡ï¼Œé€šè¿‡setæ–¹æ³•è®¾ç½®å‚æ•°æˆ–è€…é€šè¿‡æ„é€ å‡½æ•°è¿›è¡Œä¼ é€’ï¼Œè€Œå¦‚æœä½¿ç”¨Runnableæ–¹å¼ï¼Œåˆ™åªèƒ½ä½¿ç”¨ä¸»çº¿ç¨‹é‡Œé¢è¢«å£°æ˜ä¸ºfinalçš„å˜é‡ã€‚<strong>ä¸å¥½çš„åœ°æ–¹æ˜¯Javaä¸æ”¯æŒå¤šç»§æ‰¿</strong>ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œé‚£ä¹ˆå­ç±»ä¸èƒ½å†ç»§æ‰¿å…¶ä»–ç±»ï¼Œè€ŒRunableåˆ™æ²¡æœ‰è¿™ä¸ªé™åˆ¶ã€‚<strong>å‰ä¸¤ç§æ–¹å¼éƒ½æ²¡åŠæ³•æ‹¿åˆ°ä»»åŠ¡çš„è¿”å›ç»“æœï¼Œä½†æ˜¯Futuretaskæ–¹å¼å¯ä»¥</strong></p><h3 id="ï¼ˆå¸¸ç”¨ï¼‰æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹æ–¹æ³•â­"><a href="#ï¼ˆå¸¸ç”¨ï¼‰æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹æ–¹æ³•â­" class="headerlink" title="ï¼ˆå¸¸ç”¨ï¼‰æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹æ–¹æ³•â­"></a>ï¼ˆå¸¸ç”¨ï¼‰æŸ¥çœ‹è¿›ç¨‹çº¿ç¨‹æ–¹æ³•â­</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_1_20210417.png"></p><h2 id="2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ"><a href="#2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ" class="headerlink" title="2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ"></a>2ã€åŸç†ä¹‹çº¿ç¨‹è¿è¡Œ</h2><h4 id="æ ˆä¸æ ˆå¸§"><a href="#æ ˆä¸æ ˆå¸§" class="headerlink" title="æ ˆä¸æ ˆå¸§"></a>æ ˆä¸æ ˆå¸§</h4><p>Java Virtual Machine Stacks ï¼ˆJava è™šæ‹Ÿæœºæ ˆï¼‰ æˆ‘ä»¬éƒ½çŸ¥é“ JVM ä¸­ç”±å †ã€æ ˆã€æ–¹æ³•åŒºæ‰€ç»„æˆï¼Œå…¶ä¸­æ ˆå†…å­˜æ˜¯ç»™è°ç”¨çš„å‘¢ï¼Ÿ</p><ul><li>å…¶å®å°±æ˜¯çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å¯åŠ¨åï¼Œè™šæ‹Ÿæœºå°±ä¼šä¸ºå…¶åˆ†é…ä¸€å—<strong>æ ˆå†…å­˜</strong></li><li>æ¯ä¸ªæ ˆç”±å¤šä¸ªæ ˆå¸§ï¼ˆFrameï¼‰ç»„æˆï¼Œå¯¹åº”ç€æ¯æ¬¡<strong>æ–¹æ³•è°ƒç”¨æ—¶æ‰€å ç”¨çš„å†…å­˜</strong></li><li>æ¯ä¸ªçº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªæ´»åŠ¨æ ˆå¸§ï¼Œå¯¹åº”ç€å½“å‰æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸ªæ–¹æ³•</li></ul><h4 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread-Context-Switchï¼‰"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread-Context-Switchï¼‰" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆThread Context Switchï¼‰</h4><p>å› ä¸ºä»¥ä¸‹ä¸€äº›åŸå› å¯¼è‡´ cpu ä¸å†æ‰§è¡Œå½“å‰çš„çº¿ç¨‹ï¼Œè½¬è€Œæ‰§è¡Œå¦ä¸€ä¸ªçº¿ç¨‹çš„ä»£ç </p><ul><li>çº¿ç¨‹çš„ cpu æ—¶é—´ç‰‡ç”¨å®Œ</li><li>åƒåœ¾å›æ”¶ æœ‰æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹éœ€è¦è¿è¡Œ</li><li>çº¿ç¨‹è‡ªå·±è°ƒç”¨äº† sleepã€yieldã€waitã€joinã€parkã€synchronizedã€lock ç­‰æ–¹æ³•</li></ul><p>å½“ Context Switch å‘ç”Ÿæ—¶ï¼Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿä¿å­˜å½“å‰çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¹¶æ¢å¤å¦ä¸€ä¸ªçº¿ç¨‹çš„çŠ¶æ€ï¼ŒJava ä¸­å¯¹åº”çš„æ¦‚å¿µ å°±æ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯è®°ä½ä¸‹ä¸€æ¡ jvm æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œæ˜¯çº¿ç¨‹ç§æœ‰çš„</p><ul><li>çŠ¶æ€åŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆä¸­æ¯ä¸ªæ ˆå¸§çš„ä¿¡æ¯ï¼Œå¦‚å±€éƒ¨å˜é‡ã€æ“ä½œæ•°æ ˆã€è¿”å›åœ°å€ç­‰</li><li>Context Switch é¢‘ç¹å‘ç”Ÿä¼šå½±å“æ€§èƒ½</li></ul><h2 id="3ã€å¸¸ç”¨æ–¹æ³•"><a href="#3ã€å¸¸ç”¨æ–¹æ³•" class="headerlink" title="3ã€å¸¸ç”¨æ–¹æ³•"></a>3ã€å¸¸ç”¨æ–¹æ³•</h2><h3 id="1-start-vs-run"><a href="#1-start-vs-run" class="headerlink" title="(1)start() vs run()"></a>(1)start() vs run()</h3><p>è¢«åˆ›å»ºçš„Threadå¯¹è±¡ç›´æ¥è°ƒç”¨é‡å†™çš„runæ–¹æ³•æ—¶ï¼Œ runæ–¹æ³•æ˜¯åœ¨<strong>ä¸»çº¿ç¨‹</strong>ä¸­è¢«æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨æˆ‘ä»¬æ‰€åˆ›å»ºçš„çº¿ç¨‹ä¸­æ‰§è¡Œã€‚æ‰€ä»¥å¦‚æœæƒ³è¦åœ¨æ‰€åˆ›å»ºçš„çº¿ç¨‹ä¸­æ‰§è¡Œrunæ–¹æ³•ï¼Œ<strong>éœ€è¦ä½¿ç”¨Threadå¯¹è±¡çš„startæ–¹æ³•ã€‚</strong></p><h3 id="2-sleep-ä¸yield"><a href="#2-sleep-ä¸yield" class="headerlink" title="(2)sleep()ä¸yield()"></a>(2)sleep()ä¸yield()</h3><h4 id="sleep-ä½¿çº¿ç¨‹é˜»å¡"><a href="#sleep-ä½¿çº¿ç¨‹é˜»å¡" class="headerlink" title="sleep (ä½¿çº¿ç¨‹é˜»å¡)"></a><strong>sleep</strong> (ä½¿çº¿ç¨‹é˜»å¡)</h4><ol><li><p>è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» <strong>Running è¿›å…¥ Timed Waiting çŠ¶æ€ï¼ˆé˜»å¡ï¼‰</strong>ï¼Œå¯é€šè¿‡state()æ–¹æ³•æŸ¥çœ‹</p></li><li><p>å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ <strong>interrupt</strong> æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedException</p></li><li><p>ç¡çœ ç»“æŸåçš„çº¿ç¨‹æœªå¿…ä¼šç«‹åˆ»å¾—åˆ°æ‰§è¡Œ</p></li><li><p>å»ºè®®ç”¨ <strong>TimeUnit çš„ sleep</strong> ä»£æ›¿ Thread çš„ sleep æ¥è·å¾—æ›´å¥½çš„å¯è¯»æ€§ ã€‚å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä¼‘çœ ä¸€ç§’</span><br>TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br><span class="hljs-comment">//ä¼‘çœ ä¸€åˆ†é’Ÿ</span><br>TimeUnit.MINUTES.sleep(<span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure></li></ol><h4 id="yield-ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰"><a href="#yield-ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰" class="headerlink" title="yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰"></a>yield ï¼ˆè®©å‡ºå½“å‰çº¿ç¨‹ï¼‰</h4><ol><li>è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä» <strong>Running è¿›å…¥ Runnable å°±ç»ªçŠ¶æ€</strong>ï¼ˆä»ç„¶æœ‰å¯èƒ½è¢«æ‰§è¡Œï¼‰ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹</li><li>å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</li></ol><h4 id="çº¿ç¨‹ä¼˜å…ˆçº§"><a href="#çº¿ç¨‹ä¼˜å…ˆçº§" class="headerlink" title="çº¿ç¨‹ä¼˜å…ˆçº§"></a>çº¿ç¨‹ä¼˜å…ˆçº§</h4><ul><li><p>çº¿ç¨‹ä¼˜å…ˆçº§ä¼šæç¤ºï¼ˆhintï¼‰è°ƒåº¦å™¨ä¼˜å…ˆè°ƒåº¦è¯¥çº¿ç¨‹ï¼Œä½†å®ƒä»…ä»…æ˜¯ä¸€ä¸ªæç¤ºï¼Œè°ƒåº¦å™¨å¯ä»¥å¿½ç•¥å®ƒ</p></li><li><p>å¦‚æœ cpu æ¯”è¾ƒå¿™ï¼Œé‚£ä¹ˆä¼˜å…ˆçº§é«˜çš„çº¿ç¨‹ä¼šè·å¾—æ›´å¤šçš„æ—¶é—´ç‰‡ï¼Œä½† cpu é—²æ—¶ï¼Œä¼˜å…ˆçº§å‡ ä¹æ²¡ä½œç”¨</p></li><li><p>è®¾ç½®æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">thread1.setPriority(Thread.MAX_PRIORITY); <span class="hljs-comment">//è®¾ç½®ä¸ºä¼˜å…ˆçº§æœ€é«˜</span><br></code></pre></td></tr></table></figure></li></ul><h3 id="3-join-æ–¹æ³•"><a href="#3-join-æ–¹æ³•" class="headerlink" title="(3)join()æ–¹æ³•"></a>(3)join()æ–¹æ³•</h3><p>ç”¨äºç­‰å¾…æŸä¸ªçº¿ç¨‹ç»“æŸã€‚å“ªä¸ªçº¿ç¨‹å†…è°ƒç”¨join()æ–¹æ³•ï¼Œå°±ç­‰å¾…å“ªä¸ªçº¿ç¨‹ç»“æŸï¼Œç„¶åå†å»æ‰§è¡Œå…¶ä»–çº¿ç¨‹ã€‚</p><p>å¦‚åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨ti.join()ï¼Œåˆ™æ˜¯ä¸»çº¿ç¨‹ç­‰å¾…t1çº¿ç¨‹ç»“æŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Thread thread = <span class="hljs-keyword">new</span> Thread();<br><span class="hljs-comment">//ç­‰å¾…threadçº¿ç¨‹æ‰§è¡Œç»“æŸ</span><br>thread.join();<br><span class="hljs-comment">//æœ€å¤šç­‰å¾…1000ms,å¦‚æœ1000mså†…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™ä¼šç›´æ¥æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¸ä¼šç­‰å¤Ÿ1000ms</span><br>thread.join(<span class="hljs-number">1000</span>);<br></code></pre></td></tr></table></figure><h3 id="4-interrupt-æ–¹æ³•"><a href="#4-interrupt-æ–¹æ³•" class="headerlink" title="(4)interrupt()æ–¹æ³•"></a>(4)interrupt()æ–¹æ³•</h3><p>ç”¨äºæ‰“æ–­<strong>é˜»å¡</strong>(sleep wait joinâ€¦)çš„çº¿ç¨‹ã€‚ å¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼ŒCPUä¸ä¼šç»™å…¶åˆ†é…æ—¶é—´ç‰‡ã€‚</p><ul><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨åœ¨è¿è¡Œä¸­è¢«æ‰“æ–­ï¼Œæ‰“æ–­æ ‡è®°ä¼šè¢«ç½®ä¸ºtrueã€‚</li><li>å¦‚æœæ˜¯æ‰“æ–­å› sleep wait joinæ–¹æ³•è€Œè¢«é˜»å¡çš„çº¿ç¨‹ï¼Œä¼šå°†æ‰“æ–­æ ‡è®°ç½®ä¸ºfalse</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ç”¨äºæŸ¥çœ‹æ‰“æ–­æ ‡è®°ï¼Œè¿”å›å€¼è¢«booleanç±»å‹</span><br>t1.isInterrupted();<br></code></pre></td></tr></table></figure><p>æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹åœ¨è¢«æ‰“æ–­åï¼Œ<strong>ä¸ä¼šåœæ­¢</strong>ï¼Œä¼šç»§ç»­æ‰§è¡Œã€‚å¦‚æœè¦è®©çº¿ç¨‹åœ¨è¢«æ‰“æ–­ååœä¸‹æ¥ï¼Œéœ€è¦<strong>ä½¿ç”¨æ‰“æ–­æ ‡è®°æ¥åˆ¤æ–­</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;<br>    <span class="hljs-keyword">if</span>(Thread.currentThread().isInterrupted()) &#123;<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"><a href="#interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼" class="headerlink" title="interruptæ–¹æ³•çš„åº”ç”¨â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼"></a><strong>interruptæ–¹æ³•çš„åº”ç”¨</strong>â€”â€”ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼</h5><p>å½“æˆ‘ä»¬åœ¨æ‰§è¡Œçº¿ç¨‹ä¸€æ—¶ï¼Œæƒ³è¦ç»ˆæ­¢çº¿ç¨‹äºŒï¼Œè¿™æ˜¯å°±éœ€è¦ä½¿ç”¨interruptæ–¹æ³•æ¥<strong>ä¼˜é›…</strong>çš„åœæ­¢çº¿ç¨‹äºŒã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144553.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144553.png" alt="img"></a></p><p><strong>ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test7</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>Monitor monitor = <span class="hljs-keyword">new</span> Monitor();<br>monitor.start();<br>Thread.sleep(<span class="hljs-number">3500</span>);<br>monitor.stop();<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Monitor</span> </span>&#123;<br><br>Thread monitor;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span><br>monitor = <span class="hljs-keyword">new</span> Thread() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//å¼€å§‹ä¸åœçš„ç›‘æ§</span><br><span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                    <span class="hljs-comment">//åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦è¢«æ‰“æ–­äº†</span><br><span class="hljs-keyword">if</span>(Thread.currentThread().isInterrupted()) &#123;<br>System.out.println(<span class="hljs-string">&quot;å¤„ç†åç»­ä»»åŠ¡&quot;</span>);<br>                        <span class="hljs-comment">//ç»ˆæ­¢çº¿ç¨‹æ‰§è¡Œ</span><br><span class="hljs-keyword">break</span>;<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//çº¿ç¨‹ä¼‘çœ </span><br>Thread.sleep(<span class="hljs-number">1000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br><span class="hljs-comment">//å¦‚æœæ˜¯åœ¨ä¼‘çœ çš„æ—¶å€™è¢«æ‰“æ–­ï¼Œä¸ä¼šå°†æ‰“æ–­æ ‡è®°è®¾ç½®ä¸ºtrueï¼Œè¿™æ—¶è¦é‡æ–°è®¾ç½®æ‰“æ–­æ ‡è®°</span><br>Thread.currentThread().interrupt();<br>&#125;<br>&#125;<br>&#125;<br>&#125;;<br>monitor.start();<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//æ‰“æ–­çº¿ç¨‹</span><br>monitor.interrupt();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>æ‰“æ–­ park çº¿ç¨‹ï¼ˆæ–¹æ³•LockSupport.park()ï¼‰, ä¸ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€ï¼Œå¦‚æœæ‰“æ–­æ ‡è®°å·²ç»æ˜¯ true, åˆ™ park ä¼šå¤±æ•ˆ<ul><li>å¯ä»¥ä½¿ç”¨ Thread.interrupted() æ¸…é™¤æ‰“æ–­çŠ¶æ€</li></ul></li></ul><h3 id="5-ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•"><a href="#5-ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•" class="headerlink" title="(5)ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•"></a>(5)ä¸æ¨èä½¿ç”¨çš„æ‰“æ–­æ–¹æ³•</h3><ul><li>stopæ–¹æ³• åœæ­¢çº¿ç¨‹è¿è¡Œï¼ˆå¯èƒ½é€ æˆå…±äº«èµ„æºæ— æ³•è¢«é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•ä½¿ç”¨è¿™äº›å…±äº«èµ„æºï¼‰</li><li>suspendï¼ˆæš‚åœçº¿ç¨‹ï¼‰/resumeï¼ˆæ¢å¤çº¿ç¨‹ï¼‰æ–¹æ³•</li></ul><h3 id="6-å®ˆæŠ¤çº¿ç¨‹"><a href="#6-å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="(6)å®ˆæŠ¤çº¿ç¨‹"></a>(6)å®ˆæŠ¤çº¿ç¨‹</h3><p>å½“JAVAè¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ—¶ï¼Œåªæœ‰å½“æ‰€æœ‰éå®ˆæŠ¤çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•åï¼ŒJAVAè¿›ç¨‹æ‰ä¼šç»“æŸã€‚<strong>ä½†å½“éå®ˆæŠ¤çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œå®ˆæŠ¤çº¿ç¨‹æ— è®ºæ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿä¼šä¸€åŒç»“æŸã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å°†çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹, é»˜è®¤ä¸ºfalse</span><br>monitor.setDaemon(<span class="hljs-keyword">true</span>); <br></code></pre></td></tr></table></figure><p><strong>å®ˆæŠ¤çº¿ç¨‹çš„åº”ç”¨</strong></p><ul><li>åƒåœ¾å›æ”¶å™¨çº¿ç¨‹å°±æ˜¯ä¸€ç§å®ˆæŠ¤çº¿ç¨‹</li><li>Tomcat ä¸­çš„ Acceptor å’Œ Poller çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥ Tomcat æ¥æ”¶åˆ° shutdown å‘½ä»¤åï¼Œä¸ä¼šç­‰ å¾…å®ƒä»¬å¤„ç†å®Œå½“å‰è¯·æ±‚</li></ul><h2 id="4ã€çº¿ç¨‹çš„çŠ¶æ€"><a href="#4ã€çº¿ç¨‹çš„çŠ¶æ€" class="headerlink" title="4ã€çº¿ç¨‹çš„çŠ¶æ€"></a>4ã€çº¿ç¨‹çš„çŠ¶æ€</h2><h3 id="1-äº”ç§çŠ¶æ€"><a href="#1-äº”ç§çŠ¶æ€" class="headerlink" title="(1)äº”ç§çŠ¶æ€"></a>(1)äº”ç§çŠ¶æ€</h3><p>è¿™æ˜¯ä» <strong>æ“ä½œç³»ç»Ÿ</strong> å±‚é¢æ¥æè¿°çš„</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144606.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144606.png" alt="img"></a></p><ul><li>ã€åˆå§‹çŠ¶æ€ã€‘ä»…æ˜¯åœ¨è¯­è¨€å±‚é¢åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ï¼Œè¿˜æœªä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼ˆä¾‹å¦‚çº¿ç¨‹è°ƒç”¨äº†startæ–¹æ³•ï¼‰</li><li>ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼ˆå°±ç»ªçŠ¶æ€ï¼‰æŒ‡è¯¥çº¿ç¨‹å·²ç»è¢«åˆ›å»ºï¼ˆä¸æ“ä½œç³»ç»Ÿçº¿ç¨‹å…³è”ï¼‰ï¼Œå¯ä»¥ç”± CPU è°ƒåº¦æ‰§è¡Œ</li><li>ã€è¿è¡ŒçŠ¶æ€ã€‘æŒ‡è·å–äº† CPU æ—¶é—´ç‰‡è¿è¡Œä¸­çš„çŠ¶æ€<ul><li>å½“ CPU æ—¶é—´ç‰‡ç”¨å®Œï¼Œä¼šä»ã€è¿è¡ŒçŠ¶æ€ã€‘è½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ï¼Œä¼šå¯¼è‡´çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</li></ul></li><li>ã€é˜»å¡çŠ¶æ€ã€‘<ul><li>å¦‚æœè°ƒç”¨äº†é˜»å¡ APIï¼Œå¦‚ BIO è¯»å†™æ–‡ä»¶ï¼Œè¿™æ—¶è¯¥çº¿ç¨‹å®é™…ä¸ä¼šç”¨åˆ° CPUï¼Œä¼šå¯¼è‡´çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥ ã€é˜»å¡çŠ¶æ€ã€‘</li><li>ç­‰ BIO æ“ä½œå®Œæ¯•ï¼Œä¼šç”±æ“ä½œç³»ç»Ÿå”¤é†’é˜»å¡çš„çº¿ç¨‹ï¼Œè½¬æ¢è‡³ã€å¯è¿è¡ŒçŠ¶æ€ã€‘</li><li>ä¸ã€å¯è¿è¡ŒçŠ¶æ€ã€‘çš„åŒºåˆ«æ˜¯ï¼Œå¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„çº¿ç¨‹æ¥è¯´åªè¦å®ƒä»¬ä¸€ç›´ä¸å”¤é†’ï¼Œè°ƒåº¦å™¨å°±ä¸€ç›´ä¸ä¼šè€ƒè™‘è°ƒåº¦å®ƒä»¬</li></ul></li><li>ã€ç»ˆæ­¢çŠ¶æ€ã€‘è¡¨ç¤ºçº¿ç¨‹å·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œä¸ä¼šå†è½¬æ¢ä¸ºå…¶å®ƒçŠ¶æ€</li></ul><h3 id="2-å…­ç§çŠ¶æ€"><a href="#2-å…­ç§çŠ¶æ€" class="headerlink" title="(2)å…­ç§çŠ¶æ€"></a>(2)å…­ç§çŠ¶æ€</h3><p>è¿™æ˜¯ä» <strong>Java API</strong> å±‚é¢æ¥æè¿°çš„<br>æ ¹æ® Thread.State æšä¸¾ï¼Œåˆ†ä¸ºå…­ç§çŠ¶æ€</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144621.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144621.png" alt="img"></a></p><ul><li><strong>NEW</strong> çº¿ç¨‹åˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨ start() æ–¹æ³•</li><li><strong>RUNNABLE</strong> å½“è°ƒç”¨äº† start() æ–¹æ³•ä¹‹åï¼Œæ³¨æ„ï¼ŒJava API å±‚é¢çš„ RUNNABLE çŠ¶æ€æ¶µç›–äº†æ“ä½œç³»ç»Ÿå±‚é¢çš„ ã€å¯è¿è¡ŒçŠ¶æ€ã€‘ã€ã€è¿è¡ŒçŠ¶æ€ã€‘å’Œã€é˜»å¡çŠ¶æ€ã€‘ï¼ˆç”±äº BIO å¯¼è‡´çš„çº¿ç¨‹é˜»å¡ï¼Œåœ¨ Java é‡Œæ— æ³•åŒºåˆ†ï¼Œä»ç„¶è®¤ä¸º æ˜¯å¯è¿è¡Œï¼‰</li><li><strong>BLOCKED ï¼Œ WAITING ï¼Œ TIMED_WAITING</strong> éƒ½æ˜¯ <strong>Java API å±‚é¢</strong>å¯¹ã€é˜»å¡çŠ¶æ€ã€‘çš„ç»†åˆ†ï¼Œå¦‚sleepå°±ä½TIMED_WAITINGï¼Œ joinä¸ºWAITINGçŠ¶æ€ã€‚åé¢ä¼šåœ¨çŠ¶æ€è½¬æ¢ä¸€èŠ‚è¯¦è¿°ã€‚</li><li><strong>TERMINATED</strong> å½“çº¿ç¨‹ä»£ç è¿è¡Œç»“æŸ</li></ul><h1 id="ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"><a href="#ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹" class="headerlink" title="ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹"></a>ä¸‰ã€å…±äº«æ¨¡å‹ä¹‹ç®¡ç¨‹</h1><h2 id="1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜"><a href="#1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜" class="headerlink" title="1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜"></a>1ã€å…±äº«å¸¦æ¥çš„é—®é¢˜</h2><h3 id="1-ä¸´ç•ŒåŒº-Critical-Section"><a href="#1-ä¸´ç•ŒåŒº-Critical-Section" class="headerlink" title="(1)ä¸´ç•ŒåŒº Critical Section"></a>(1)ä¸´ç•ŒåŒº Critical Section</h3><ul><li>ä¸€ä¸ªç¨‹åºè¿è¡Œå¤šä¸ªçº¿ç¨‹æœ¬èº«æ˜¯æ²¡æœ‰é—®é¢˜çš„</li><li>é—®é¢˜å‡ºåœ¨å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº<ul><li>å¤šä¸ªçº¿ç¨‹è¯»å…±äº«èµ„æºå…¶å®ä¹Ÿæ²¡æœ‰é—®é¢˜</li><li>åœ¨å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºè¯»å†™æ“ä½œæ—¶å‘ç”ŸæŒ‡ä»¤äº¤é”™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜</li></ul></li><li>ä¸€æ®µä»£ç å—å†…å¦‚æœå­˜åœ¨å¯¹å…±äº«èµ„æºçš„å¤šçº¿ç¨‹è¯»å†™æ“ä½œï¼Œç§°è¿™æ®µä»£ç å—ä¸º<strong>ä¸´ç•ŒåŒº</strong><br>ä¾‹å¦‚ï¼Œä¸‹é¢ä»£ç ä¸­çš„ä¸´ç•ŒåŒº</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> counter = <span class="hljs-number">0</span>;<br> <br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">increment</span><span class="hljs-params">()</span> </span><br><span class="hljs-function"><span class="hljs-comment">// ä¸´ç•ŒåŒº </span></span><br><span class="hljs-function"></span>&#123;   <br>    counter++; <br>&#125;<br> <br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">decrement</span><span class="hljs-params">()</span> </span><br><span class="hljs-function"><span class="hljs-comment">// ä¸´ç•ŒåŒº </span></span><br><span class="hljs-function"></span>&#123; <br>    counter--; <br>&#125; <br></code></pre></td></tr></table></figure><h3 id="2-ç«æ€æ¡ä»¶-Race-Condition"><a href="#2-ç«æ€æ¡ä»¶-Race-Condition" class="headerlink" title="(2)ç«æ€æ¡ä»¶ Race Condition"></a><strong>(2)ç«æ€æ¡ä»¶ Race Condition</strong></h3><p>å¤šä¸ªçº¿ç¨‹åœ¨<strong>ä¸´ç•ŒåŒº</strong>å†…æ‰§è¡Œï¼Œç”±äºä»£ç çš„æ‰§è¡Œåºåˆ—ä¸åŒè€Œå¯¼è‡´ç»“æœæ— æ³•é¢„æµ‹ï¼Œç§°ä¹‹ä¸ºå‘ç”Ÿäº†<strong>ç«æ€æ¡ä»¶</strong></p><h2 id="2ã€synchronized-è§£å†³æ–¹æ¡ˆ"><a href="#2ã€synchronized-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2ã€synchronized è§£å†³æ–¹æ¡ˆ"></a>2ã€synchronized è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-è§£å†³æ‰‹æ®µ"><a href="#1-è§£å†³æ‰‹æ®µ" class="headerlink" title="(1)è§£å†³æ‰‹æ®µ"></a>(1)è§£å†³æ‰‹æ®µ</h3><p>ä¸ºäº†é¿å…ä¸´ç•ŒåŒºçš„ç«æ€æ¡ä»¶å‘ç”Ÿï¼Œæœ‰å¤šç§æ‰‹æ®µå¯ä»¥è¾¾åˆ°ç›®çš„ã€‚</p><ul><li>é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šsynchronizedï¼ŒLock</li><li>éé˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼šåŸå­å˜é‡</li></ul><p>æœ¬æ¬¡è¯¾ä½¿ç”¨é˜»å¡å¼çš„è§£å†³æ–¹æ¡ˆï¼š<strong>synchronized</strong>ï¼Œæ¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå³ä¿—ç§°çš„<strong>ã€å¯¹è±¡é”ã€‘</strong>ï¼Œå®ƒé‡‡ç”¨äº’æ–¥çš„æ–¹å¼è®©åŒä¸€ æ—¶åˆ»è‡³å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŒæœ‰ã€å¯¹è±¡é”ã€‘ï¼Œå…¶å®ƒçº¿ç¨‹å†æƒ³è·å–è¿™ä¸ªã€å¯¹è±¡é”ã€‘æ—¶å°±ä¼šé˜»å¡ä½(blocked)ã€‚è¿™æ ·å°±èƒ½ä¿è¯æ‹¥æœ‰é” çš„çº¿ç¨‹å¯ä»¥å®‰å…¨çš„æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ï¼Œä¸ç”¨æ‹…å¿ƒçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</p><h3 id="2-synchronizedè¯­æ³•"><a href="#2-synchronizedè¯­æ³•" class="headerlink" title="(2)synchronizedè¯­æ³•"></a>(2)synchronizedè¯­æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span>(å¯¹è±¡) &#123;<br><span class="hljs-comment">//ä¸´ç•ŒåŒº</span><br>&#125; <br></code></pre></td></tr></table></figure><p>ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> counter = <span class="hljs-number">0</span>; <br><span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªå…¬å…±å¯¹è±¡ï¼Œä½œä¸ºå¯¹è±¡é”çš„å¯¹è±¡</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object room = <span class="hljs-keyword">new</span> Object();<br> <br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;    <br>Thread t1 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;        <br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;            <br>        <span class="hljs-keyword">synchronized</span> (room) &#123;     <br>        counter++;            <br>        &#125;       <br>    &#125;    <br>    &#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br> <br>    Thread t2 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;       <br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5000</span>; i++) &#123;         <br>            <span class="hljs-keyword">synchronized</span> (room) &#123;            <br>            counter--;          <br>            &#125;    <br>        &#125; <br>    &#125;, <span class="hljs-string">&quot;t2&quot;</span>);<br> <br>    t1.start();    <br>    t2.start(); <br>    t1.join();   <br>    t2.join();    <br>    log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>,counter); <br>&#125; <br></code></pre></td></tr></table></figure><h3 id="3-synchronizedåŠ åœ¨æ–¹æ³•ä¸Š"><a href="#3-synchronizedåŠ åœ¨æ–¹æ³•ä¸Š" class="headerlink" title="(3)synchronizedåŠ åœ¨æ–¹æ³•ä¸Š"></a>(3)synchronizedåŠ åœ¨æ–¹æ³•ä¸Š</h3><ul><li><p>åŠ åœ¨æˆå‘˜æ–¹æ³•ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123;<br><span class="hljs-comment">//åœ¨æ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizedå…³é”®å­—</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br><br>&#125;<br><span class="hljs-comment">//ç­‰ä»·äº</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">synchronized</span>(<span class="hljs-keyword">this</span>) &#123;<br><br>&#125;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure></li><li><p>åŠ åœ¨é™æ€æ–¹æ³•ä¸Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo</span> </span>&#123;<br><span class="hljs-comment">//åœ¨é™æ€æ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizedå…³é”®å­—</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br><br>&#125;<br><span class="hljs-comment">//ç­‰ä»·äº</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">synchronized</span>(Demo.class) &#123;<br><br>&#125;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure></li></ul><h2 id="3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"><a href="#3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ" class="headerlink" title="3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ"></a>3ã€å˜é‡çš„çº¿ç¨‹å®‰å…¨åˆ†æ</h2><h4 id="æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>æˆå‘˜å˜é‡å’Œé™æ€å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><ul><li>å¦‚æœå®ƒä»¬æ²¡æœ‰å…±äº«ï¼Œåˆ™çº¿ç¨‹å®‰å…¨</li><li>å¦‚æœå®ƒä»¬è¢«å…±äº«äº†ï¼Œæ ¹æ®å®ƒä»¬çš„çŠ¶æ€æ˜¯å¦èƒ½å¤Ÿæ”¹å˜ï¼Œåˆåˆ†ä¸¤ç§æƒ…å†µ<ul><li>å¦‚æœåªæœ‰è¯»æ“ä½œï¼Œåˆ™çº¿ç¨‹å®‰å…¨</li><li>å¦‚æœæœ‰è¯»å†™æ“ä½œï¼Œåˆ™è¿™æ®µä»£ç æ˜¯ä¸´ç•ŒåŒºï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</li></ul></li></ul><h4 id="å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨ï¼Ÿ</h4><ul><li><p>å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„</p></li><li><p>ä½†å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡åˆ™æœªå¿… ï¼ˆè¦çœ‹è¯¥å¯¹è±¡</p><p>æ˜¯å¦è¢«å…±äº«</p><p>ä¸”è¢«æ‰§è¡Œäº†è¯»å†™æ“ä½œï¼‰</p><ul><li>å¦‚æœè¯¥å¯¹è±¡æ²¡æœ‰é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</li><li>å¦‚æœè¯¥å¯¹è±¡é€ƒç¦»æ–¹æ³•çš„ä½œç”¨èŒƒå›´ï¼Œéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨</li></ul></li><li><p>å±€éƒ¨å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„â€”â€”æ¯ä¸ªæ–¹æ³•éƒ½åœ¨å¯¹åº”çº¿ç¨‹çš„æ ˆä¸­åˆ›å»ºæ ˆå¸§ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹å…±äº«</p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144636.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144636.png" alt="img"></a></p><ul><li>å¦‚æœè°ƒç”¨çš„å¯¹è±¡è¢«å…±äº«ï¼Œä¸”æ‰§è¡Œäº†è¯»å†™æ“ä½œï¼Œåˆ™<strong>çº¿ç¨‹ä¸å®‰å…¨</strong></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144649.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144649.png" alt="img"></a></p><ul><li>å¦‚æœæ˜¯å±€éƒ¨å˜é‡ï¼Œåˆ™ä¼šåœ¨å †ä¸­åˆ›å»ºå¯¹åº”çš„å¯¹è±¡ï¼Œä¸ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144702.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144702.png" alt="img"></a></p><h3 id="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"><a href="#å¸¸è§çº¿ç¨‹å®‰å…¨ç±»" class="headerlink" title="å¸¸è§çº¿ç¨‹å®‰å…¨ç±»"></a>å¸¸è§çº¿ç¨‹å®‰å…¨ç±»</h3><ul><li>String</li><li>Integer</li><li>StringBuï¬€er</li><li>Random</li><li>Vector ï¼ˆListçš„çº¿ç¨‹å®‰å…¨å®ç°ç±»ï¼‰</li><li>Hashtable ï¼ˆHashçš„çº¿ç¨‹å®‰å…¨å®ç°ç±»ï¼‰</li><li>java.util.concurrent åŒ…ä¸‹çš„ç±»</li></ul><p>è¿™é‡Œè¯´å®ƒä»¬æ˜¯çº¿ç¨‹å®‰å…¨çš„æ˜¯æŒ‡ï¼Œå¤šä¸ªçº¿ç¨‹è°ƒç”¨å®ƒä»¬<strong>åŒä¸€ä¸ªå®ä¾‹çš„æŸä¸ªæ–¹æ³•æ—¶</strong>ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„</p><ul><li>å®ƒä»¬çš„æ¯ä¸ªæ–¹æ³•æ˜¯åŸå­çš„ï¼ˆéƒ½è¢«åŠ ä¸Šäº†synchronizedï¼‰</li><li>ä½†æ³¨æ„å®ƒä»¬<strong>å¤šä¸ªæ–¹æ³•çš„ç»„åˆä¸æ˜¯åŸå­çš„</strong>ï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144903.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144903.png" alt="img"></a></p><h3 id="ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§"><a href="#ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§" class="headerlink" title="ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§"></a>ä¸å¯å˜ç±»çº¿ç¨‹å®‰å…¨æ€§</h3><p>Stringã€Integer ç­‰éƒ½æ˜¯<strong>ä¸å¯å˜ç±»</strong>ï¼Œå› ä¸ºå…¶å†…éƒ¨çš„çŠ¶æ€ä¸å¯ä»¥æ”¹å˜ï¼Œå› æ­¤å®ƒä»¬çš„æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„</p><p>æœ‰åŒå­¦æˆ–è®¸æœ‰ç–‘é—®ï¼ŒString æœ‰ replaceï¼Œsubstring ç­‰æ–¹æ³•ã€å¯ä»¥ã€‘æ”¹å˜å€¼å•Šï¼Œé‚£ä¹ˆè¿™äº›æ–¹æ³•åˆæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰ å…¨çš„å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºè¿™äº›æ–¹æ³•çš„è¿”å›å€¼éƒ½<strong>åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥æ”¹å˜Stringã€Integerå¯¹è±¡æœ¬èº«ã€‚</p><h2 id="4ã€Monitoræ¦‚å¿µ"><a href="#4ã€Monitoræ¦‚å¿µ" class="headerlink" title="4ã€Monitoræ¦‚å¿µ"></a>4ã€Monitoræ¦‚å¿µ</h2><h3 id="1-åŸç†ä¹‹Monitor"><a href="#1-åŸç†ä¹‹Monitor" class="headerlink" title="(1)åŸç†ä¹‹Monitor"></a>(1)åŸç†ä¹‹Monitor</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144917.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144917.png" alt="img"></a></p><ul><li><p>å½“çº¿ç¨‹æ‰§è¡Œåˆ°ä¸´ç•ŒåŒºä»£ç æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†synchronizedï¼Œä¼šå…ˆæŸ¥è¯¢synchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)<strong>æ˜¯å¦ç»‘å®šäº†Monitor</strong>ã€‚</p><ul><li><p>å¦‚æœ<strong>æ²¡æœ‰ç»‘å®š</strong>ï¼Œåˆ™ä¼šå…ˆå»å»ä¸Monitorç»‘å®šï¼Œå¹¶ä¸”å°†Ownerè®¾ä¸ºå½“å‰çº¿ç¨‹ã€‚</p></li><li><p>å¦‚æœ</p><p>å·²ç»ç»‘å®š</p><p>ï¼Œåˆ™ä¼šå»æŸ¥è¯¢è¯¥Monitoræ˜¯å¦å·²ç»æœ‰äº†Owner</p><ul><li>å¦‚æœæ²¡æœ‰ï¼Œåˆ™Ownerä¸å°†å½“å‰çº¿ç¨‹ç»‘å®š</li><li>å¦‚æœæœ‰ï¼Œåˆ™æ”¾å…¥EntryListï¼Œè¿›å…¥é˜»å¡çŠ¶æ€(blocked)</li></ul></li></ul></li><li><p>å½“Monitorçš„Ownerå°†ä¸´ç•ŒåŒºä¸­ä»£ç æ‰§è¡Œå®Œæ¯•åï¼ŒOwnerä¾¿ä¼šè¢«æ¸…ç©ºï¼Œæ­¤æ—¶EntryListä¸­å¤„äº<strong>é˜»å¡</strong>çŠ¶æ€çš„çº¿ç¨‹ä¼šè¢«<strong>å«é†’å¹¶ç«äº‰</strong>ï¼Œæ­¤æ—¶çš„ç«äº‰æ˜¯<strong>éå…¬å¹³çš„</strong></p></li><li><p><strong>æ³¨æ„</strong>ï¼š</p><ul><li>å¯¹è±¡åœ¨ä½¿ç”¨äº†synchronizedåä¸Monitorç»‘å®šæ—¶ï¼Œä¼šå°†å¯¹è±¡å¤´ä¸­çš„<strong>Mark Word</strong>ç½®ä¸ºMonitoræŒ‡é’ˆã€‚</li><li>æ¯ä¸ªå¯¹è±¡éƒ½ä¼šç»‘å®šä¸€ä¸ª<strong>å”¯ä¸€çš„Monitor</strong>ï¼Œå¦‚æœsynchronizedä¸­æ‰€æŒ‡å®šçš„å¯¹è±¡(obj)<strong>ä¸åŒ</strong>ï¼Œåˆ™ä¼šç»‘å®š<strong>ä¸åŒ</strong>çš„Monitor</li></ul></li></ul><h2 id="5ã€SynchronizedåŸç†è¿›é˜¶"><a href="#5ã€SynchronizedåŸç†è¿›é˜¶" class="headerlink" title="5ã€SynchronizedåŸç†è¿›é˜¶"></a>5ã€SynchronizedåŸç†è¿›é˜¶</h2><h3 id="å¯¹è±¡å¤´æ ¼å¼"><a href="#å¯¹è±¡å¤´æ ¼å¼" class="headerlink" title="å¯¹è±¡å¤´æ ¼å¼"></a>å¯¹è±¡å¤´æ ¼å¼</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144926.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144926.png" alt="img"></a></p><h3 id="1-è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰"><a href="#1-è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰" class="headerlink" title="(1)è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰"></a>(1)è½»é‡çº§é”ï¼ˆç”¨äºä¼˜åŒ–Monitorè¿™ç±»çš„é‡é‡çº§é”ï¼‰</h3><p><strong>è½»é‡çº§é”ä½¿ç”¨åœºæ™¯ï¼š</strong>å½“ä¸€ä¸ªå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œä½†è®¿é—®çš„æ—¶é—´æ˜¯<strong>é”™å¼€çš„ï¼ˆä¸å­˜åœ¨ç«äº‰ï¼‰</strong>ï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨<strong>è½»é‡çº§é”</strong>æ¥ä¼˜åŒ–ã€‚</p><ul><li><p>åˆ›å»º<strong>é”è®°å½•</strong>ï¼ˆLock Recordï¼‰å¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„æ ˆå¸§éƒ½ä¼šåŒ…å«ä¸€ä¸ªé”è®°å½•å¯¹è±¡ï¼Œå†…éƒ¨å¯ä»¥å­˜å‚¨é”å®šå¯¹è±¡çš„mark wordï¼ˆä¸å†ä¸€å¼€å§‹å°±ä½¿ç”¨Monitorï¼‰</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144942.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144942.png" alt="img"></a></p></li><li><p>è®©é”è®°å½•ä¸­çš„Object referenceæŒ‡å‘é”å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œå¹¶å°è¯•ç”¨caså»æ›¿æ¢Objectä¸­çš„mark wordï¼Œå°†æ­¤mark wordæ”¾å…¥lock recordä¸­ä¿å­˜</p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144950.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144950.png" alt="img"></a></p><ul><li>å¦‚æœcasæ›¿æ¢æˆåŠŸï¼Œåˆ™å°†Objectçš„å¯¹è±¡å¤´æ›¿æ¢ä¸º<strong>é”è®°å½•çš„åœ°å€</strong>å’Œ<strong>çŠ¶æ€ 00ï¼ˆè½»é‡çº§é”çŠ¶æ€ï¼‰</strong>ï¼Œå¹¶ç”±è¯¥çº¿ç¨‹ç»™å¯¹è±¡åŠ é”</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144957.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608144957.png" alt="img"></a></p><h3 id="2-é”è†¨èƒ€"><a href="#2-é”è†¨èƒ€" class="headerlink" title="(2)é”è†¨èƒ€"></a>(2)é”è†¨èƒ€</h3><ul><li>å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨ç»™ä¸€ä¸ªå¯¹è±¡åŠ è½»é‡çº§é”æ—¶ï¼Œ<strong>casæ›¿æ¢æ“ä½œå¤±è´¥</strong>ï¼ˆå› ä¸ºæ­¤æ—¶å…¶ä»–çº¿ç¨‹å·²ç»ç»™å¯¹è±¡åŠ äº†è½»é‡çº§é”ï¼‰ï¼Œæ­¤æ—¶è¯¥çº¿ç¨‹å°±ä¼šè¿›å…¥<strong>é”è†¨èƒ€</strong>è¿‡ç¨‹</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145004.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145004.png" alt="img"></a></p><ul><li><p>æ­¤æ—¶ä¾¿ä¼šç»™å¯¹è±¡åŠ ä¸Šé‡é‡çº§é”ï¼ˆä½¿ç”¨Monitorï¼‰</p><ul><li><p>å°†å¯¹è±¡å¤´çš„Mark Wordæ”¹ä¸ºMonitorçš„åœ°å€ï¼Œå¹¶ä¸”çŠ¶æ€æ”¹ä¸º10(é‡é‡çº§é”)</p></li><li><p>å¹¶ä¸”è¯¥çº¿ç¨‹æ”¾å…¥å…¥EntryListä¸­ï¼Œå¹¶è¿›å…¥é˜»å¡çŠ¶æ€(blocked)</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145148.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145148.png" alt="img"></a></p></li></ul></li></ul><h3 id="3-è‡ªæ—‹ä¼˜åŒ–"><a href="#3-è‡ªæ—‹ä¼˜åŒ–" class="headerlink" title="(3)è‡ªæ—‹ä¼˜åŒ–"></a>(3)è‡ªæ—‹ä¼˜åŒ–</h3><p><strong>é‡é‡çº§é”</strong>ç«äº‰æ—¶ï¼Œè¿˜å¯ä»¥ä½¿ç”¨è‡ªé€‰æ¥ä¼˜åŒ–ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨<strong>è‡ªæ—‹æˆåŠŸ</strong>ï¼ˆä½¿ç”¨é”çš„çº¿ç¨‹é€€å‡ºäº†åŒæ­¥å—ï¼Œ<strong>é‡Šæ”¾äº†é”</strong>ï¼‰ï¼Œè¿™æ—¶å°±å¯ä»¥é¿å…çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ã€‚</p><ul><li>ç¬¬ä¸€ç§æƒ…å†µ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145136.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145136.png" alt="img"></a></p><ul><li>ç¬¬äºŒç§æƒ…å†µ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145125.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145125.png" alt="img"></a></p><h3 id="4-åå‘é”-ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥"><a href="#4-åå‘é”-ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥" class="headerlink" title="(4)åå‘é”(ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥)"></a>(4)åå‘é”(ç”¨äºä¼˜åŒ–è½»é‡çº§é”é‡å…¥)</h3><p>è½»é‡çº§é”åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œæ¯æ¬¡<strong>é‡å…¥</strong>ï¼ˆè¯¥çº¿ç¨‹æ‰§è¡Œçš„æ–¹æ³•ä¸­å†æ¬¡é”ä½è¯¥å¯¹è±¡ï¼‰æ“ä½œä»éœ€è¦casæ›¿æ¢æ“ä½œï¼Œè¿™æ ·æ˜¯ä¼šä½¿æ€§èƒ½é™ä½çš„ã€‚</p><p>æ‰€ä»¥å¼•å…¥äº†<strong>åå‘é”</strong>å¯¹æ€§èƒ½è¿›è¡Œä¼˜åŒ–ï¼šåœ¨<strong>ç¬¬ä¸€æ¬¡</strong>casæ—¶ä¼šå°†<strong>çº¿ç¨‹çš„ID</strong>å†™å…¥å¯¹è±¡çš„Mark Wordä¸­ã€‚æ­¤åå‘ç°è¿™ä¸ªçº¿ç¨‹IDå°±æ˜¯è‡ªå·±çš„ï¼Œå°±è¡¨ç¤ºæ²¡æœ‰ç«äº‰ï¼Œå°±ä¸éœ€è¦å†æ¬¡casï¼Œä»¥ååªè¦ä¸å‘ç”Ÿç«äº‰ï¼Œè¿™ä¸ªå¯¹è±¡å°±å½’è¯¥çº¿ç¨‹æ‰€æœ‰ã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145109.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145109.png" alt="img"></a></p><h4 id="åå‘çŠ¶æ€"><a href="#åå‘çŠ¶æ€" class="headerlink" title="åå‘çŠ¶æ€"></a>åå‘çŠ¶æ€</h4><ul><li>Normalï¼šä¸€èˆ¬çŠ¶æ€ï¼Œæ²¡æœ‰åŠ ä»»ä½•é”ï¼Œå‰é¢62ä½ä¿å­˜çš„æ˜¯å¯¹è±¡çš„ä¿¡æ¯ï¼Œ<strong>æœ€å2ä½ä¸ºçŠ¶æ€ï¼ˆ01ï¼‰ï¼Œå€’æ•°ç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨åå‘é”ï¼ˆæœªä½¿ç”¨ï¼š0ï¼‰</strong></li><li>Biasedï¼šåå‘çŠ¶æ€ï¼Œä½¿ç”¨åå‘é”ï¼Œå‰é¢54ä½ä¿å­˜çš„å½“å‰çº¿ç¨‹çš„IDï¼Œ<strong>æœ€å2ä½ä¸ºçŠ¶æ€ï¼ˆ01ï¼‰ï¼Œå€’æ•°ç¬¬ä¸‰ä½è¡¨ç¤ºæ˜¯å¦ä½¿ç”¨åå‘é”ï¼ˆä½¿ç”¨ï¼š1ï¼‰</strong></li><li>Lightweightï¼šä½¿ç”¨è½»é‡çº§é”ï¼Œå‰62ä½ä¿å­˜çš„æ˜¯é”è®°å½•çš„æŒ‡é’ˆï¼Œ<strong>æœ€åä¸¤ä½ä¸ºçŠ¶æ€ï¼ˆ00ï¼‰</strong></li><li>Heavyweightï¼šä½¿ç”¨é‡é‡çº§é”ï¼Œå‰62ä½ä¿å­˜çš„æ˜¯Monitorçš„åœ°å€æŒ‡é’ˆï¼Œ<strong>åä¸¤ä½ä¸ºçŠ¶æ€(10)</strong></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145101.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145101.png" alt="img"></a></p><ul><li>å¦‚æœå¼€å¯äº†åå‘é”ï¼ˆé»˜è®¤å¼€å¯ï¼‰ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„Mark Wordåä¸‰ä½åº”è¯¥æ˜¯101</li><li>ä½†æ˜¯åå‘é”é»˜è®¤æ˜¯<strong>æœ‰å»¶è¿Ÿ</strong>çš„ï¼Œä¸ä¼šå†ç¨‹åºä¸€å¯åŠ¨å°±ç”Ÿæ•ˆï¼Œè€Œæ˜¯ä¼šåœ¨ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´ï¼ˆå‡ ç§’ä¹‹åï¼‰ï¼Œæ‰ä¼šå¯¹åˆ›å»ºçš„å¯¹è±¡è®¾ç½®ä¸ºåå‘çŠ¶æ€</li><li>å¦‚æœæ²¡æœ‰å¼€å¯åå‘é”ï¼Œå¯¹è±¡çš„Mark Wordåä¸‰ä½åº”è¯¥æ˜¯001</li></ul><h4 id="æ’¤é”€åå‘"><a href="#æ’¤é”€åå‘" class="headerlink" title="æ’¤é”€åå‘"></a>æ’¤é”€åå‘</h4><p>ä»¥ä¸‹å‡ ç§æƒ…å†µä¼šä½¿å¯¹è±¡çš„åå‘é”å¤±æ•ˆ</p><ul><li>è°ƒç”¨å¯¹è±¡çš„hashCodeæ–¹æ³•</li><li>å¤šä¸ªçº¿ç¨‹ä½¿ç”¨è¯¥å¯¹è±¡</li><li><strong>è°ƒç”¨äº†wait/notifyæ–¹æ³•</strong>ï¼ˆè°ƒç”¨waitæ–¹æ³•ä¼šå¯¼è‡´é”è†¨èƒ€è€Œä½¿ç”¨<strong>é‡é‡çº§é”</strong>ï¼‰</li></ul><h3 id="5-æ‰¹é‡é‡åå‘"><a href="#5-æ‰¹é‡é‡åå‘" class="headerlink" title="(5)æ‰¹é‡é‡åå‘"></a>(5)æ‰¹é‡é‡åå‘</h3><ul><li>å¦‚æœå¯¹è±¡è™½ç„¶è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œä½†æ˜¯çº¿ç¨‹é—´ä¸å­˜åœ¨ç«äº‰ï¼Œè¿™æ—¶åå‘T1çš„å¯¹è±¡ä»æœ‰æœºä¼šé‡æ–°åå‘T2<ul><li>é‡åå‘ä¼šé‡ç½®Thread ID</li></ul></li><li>å½“æ’¤é”€è¶…è¿‡20æ¬¡åï¼ˆè¶…è¿‡é˜ˆå€¼ï¼‰ï¼ŒJVMä¼šè§‰å¾—æ˜¯ä¸æ˜¯åå‘é”™äº†ï¼Œè¿™æ—¶ä¼šåœ¨ç»™å¯¹è±¡åŠ é”æ—¶ï¼Œé‡æ–°åå‘è‡³åŠ é”çº¿ç¨‹ã€‚</li></ul><h3 id="6-æ‰¹é‡æ’¤é”€"><a href="#6-æ‰¹é‡æ’¤é”€" class="headerlink" title="(6)æ‰¹é‡æ’¤é”€"></a>(6)æ‰¹é‡æ’¤é”€</h3><p>å½“æ’¤é”€åå‘é”çš„é˜ˆå€¼è¶…è¿‡40ä»¥åï¼Œå°±ä¼šå°†<strong>æ•´ä¸ªç±»çš„å¯¹è±¡éƒ½æ”¹ä¸ºä¸å¯åå‘çš„</strong></p><h2 id="6ã€Wait-Notify"><a href="#6ã€Wait-Notify" class="headerlink" title="6ã€Wait/Notify"></a>6ã€Wait/Notify</h2><h3 id="1-åŸç†"><a href="#1-åŸç†" class="headerlink" title="(1)åŸç†"></a>(1)åŸç†</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145204.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145204.png" alt="img"></a></p><ul><li><p>é”å¯¹è±¡è°ƒç”¨waitæ–¹æ³•ï¼ˆobj.waitï¼‰ï¼Œå°±ä¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥WaitSetä¸­ï¼Œå˜ä¸ºWAITINGçŠ¶æ€ã€‚</p></li><li><p>å¤„äºBLOCKEDå’ŒWAITINGçŠ¶æ€çš„çº¿ç¨‹éƒ½ä¸º</p><p>é˜»å¡</p><p>çŠ¶æ€ï¼ŒCPUéƒ½ä¸ä¼šåˆ†ç»™ä»–ä»¬æ—¶é—´ç‰‡ã€‚ä½†æ˜¯æœ‰æ‰€åŒºåˆ«ï¼š</p><ul><li>BLOCKEDçŠ¶æ€çš„çº¿ç¨‹æ˜¯åœ¨ç«äº‰å¯¹è±¡æ—¶ï¼Œå‘ç°Monitorçš„Ownerå·²ç»æ˜¯åˆ«çš„çº¿ç¨‹äº†ï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥EntryListä¸­ï¼Œå¹¶å¤„äºBLOCKEDçŠ¶æ€</li><li>WAITINGçŠ¶æ€çš„çº¿ç¨‹æ˜¯è·å¾—äº†å¯¹è±¡çš„é”ï¼Œä½†æ˜¯è‡ªèº«å› ä¸ºæŸäº›åŸå› éœ€è¦è¿›å…¥é˜»å¡çŠ¶æ€æ—¶ï¼Œé”å¯¹è±¡è°ƒç”¨äº†waitæ–¹æ³•è€Œè¿›å…¥äº†WaitSetä¸­ï¼Œå¤„äºWAITINGçŠ¶æ€</li></ul></li><li><p>BLOCKEDçŠ¶æ€çš„çº¿ç¨‹ä¼šåœ¨é”è¢«é‡Šæ”¾çš„æ—¶å€™è¢«å”¤é†’ï¼Œä½†æ˜¯å¤„äºWAITINGçŠ¶æ€çš„çº¿ç¨‹åªæœ‰è¢«é”å¯¹è±¡è°ƒç”¨äº†notifyæ–¹æ³•(obj.notify/obj.notifyAll)ï¼Œæ‰ä¼šè¢«å”¤é†’ã€‚</p></li></ul><p><strong>æ³¨ï¼šåªæœ‰å½“å¯¹è±¡è¢«é”ä»¥åï¼Œæ‰èƒ½è°ƒç”¨waitå’Œnotifyæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test1</span> </span>&#123;<br><span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> Object LOCK = <span class="hljs-keyword">new</span> Object();<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>        <span class="hljs-comment">//åªæœ‰åœ¨å¯¹è±¡è¢«é”ä½åæ‰èƒ½è°ƒç”¨waitæ–¹æ³•</span><br><span class="hljs-keyword">synchronized</span> (LOCK) &#123;<br>LOCK.wait();<br>&#125;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><h3 id="2-Waitä¸Sleepçš„åŒºåˆ«"><a href="#2-Waitä¸Sleepçš„åŒºåˆ«" class="headerlink" title="(2)Waitä¸Sleepçš„åŒºåˆ«"></a>(2)Waitä¸Sleepçš„åŒºåˆ«</h3><p><strong>ä¸åŒç‚¹</strong></p><ul><li>Sleepæ˜¯Threadç±»çš„é™æ€æ–¹æ³•ï¼ŒWaitæ˜¯Objectçš„æ–¹æ³•ï¼ŒObjectåˆæ˜¯æ‰€æœ‰ç±»çš„çˆ¶ç±»ï¼Œæ‰€ä»¥æ‰€æœ‰ç±»éƒ½æœ‰Waitæ–¹æ³•ã€‚</li><li>Sleepåœ¨é˜»å¡çš„æ—¶å€™ä¸ä¼šé‡Šæ”¾é”ï¼Œè€ŒWaitåœ¨é˜»å¡çš„æ—¶å€™ä¼šé‡Šæ”¾é”</li><li>Sleepä¸éœ€è¦ä¸synchronizedä¸€èµ·ä½¿ç”¨ï¼Œè€ŒWaitéœ€è¦ä¸synchronizedä¸€èµ·ä½¿ç”¨ï¼ˆå¯¹è±¡è¢«é”ä»¥åæ‰èƒ½ä½¿ç”¨ï¼‰</li></ul><p><strong>ç›¸åŒç‚¹</strong></p><ul><li>é˜»å¡çŠ¶æ€éƒ½ä¸º<strong>TIMED_WAITING</strong></li></ul><h3 id="3-ä¼˜é›…åœ°ä½¿ç”¨wait-notify"><a href="#3-ä¼˜é›…åœ°ä½¿ç”¨wait-notify" class="headerlink" title="(3)ä¼˜é›…åœ°ä½¿ç”¨wait/notify"></a>(3)ä¼˜é›…åœ°ä½¿ç”¨wait/notify</h3><p><strong>ä»€ä¹ˆæ—¶å€™é€‚åˆä½¿ç”¨wait</strong></p><ul><li>å½“çº¿ç¨‹<strong>ä¸æ»¡è¶³æŸäº›æ¡ä»¶</strong>ï¼Œéœ€è¦æš‚åœè¿è¡Œæ—¶ï¼Œå¯ä»¥ä½¿ç”¨waitã€‚è¿™æ ·ä¼šå°†<strong>å¯¹è±¡çš„é”é‡Šæ”¾</strong>ï¼Œè®©å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç»§ç»­è¿è¡Œã€‚å¦‚æœæ­¤æ—¶ä½¿ç”¨sleepï¼Œä¼šå¯¼è‡´æ‰€æœ‰çº¿ç¨‹éƒ½è¿›å…¥é˜»å¡ï¼Œå¯¼è‡´æ‰€æœ‰çº¿ç¨‹éƒ½æ²¡æ³•è¿è¡Œï¼Œç›´åˆ°å½“å‰çº¿ç¨‹sleepç»“æŸåï¼Œè¿è¡Œå®Œæ¯•ï¼Œæ‰èƒ½å¾—åˆ°æ‰§è¡Œã€‚</li></ul><p><strong>ä½¿ç”¨wait/notifyéœ€è¦æ³¨æ„ä»€ä¹ˆ</strong></p><ul><li>å½“æœ‰<strong>å¤šä¸ª</strong>çº¿ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œå¯¹è±¡è°ƒç”¨äº†waitæ–¹æ³•ï¼Œæ­¤æ—¶è¿™äº›çº¿ç¨‹éƒ½ä¼šè¿›å…¥WaitSetä¸­ç­‰å¾…ã€‚å¦‚æœè¿™æ—¶ä½¿ç”¨äº†<strong>notify</strong>æ–¹æ³•ï¼Œå¯èƒ½ä¼šé€ æˆ<strong>è™šå‡å”¤é†’</strong>ï¼ˆå”¤é†’çš„ä¸æ˜¯æ»¡è¶³æ¡ä»¶çš„ç­‰å¾…çº¿ç¨‹ï¼‰ï¼Œè¿™æ—¶å°±éœ€è¦ä½¿ç”¨<strong>notifyAll</strong>æ–¹æ³•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">synchronized</span> (LOCK) &#123;<br><span class="hljs-keyword">while</span>(<span class="hljs-comment">//ä¸æ»¡è¶³æ¡ä»¶ï¼Œä¸€ç›´ç­‰å¾…ï¼Œé¿å…è™šå‡å”¤é†’) &#123;</span><br>LOCK.wait();<br>&#125;<br><span class="hljs-comment">//æ»¡è¶³æ¡ä»¶åå†è¿è¡Œ</span><br>&#125;<br><br><span class="hljs-keyword">synchronized</span> (LOCK) &#123;<br><span class="hljs-comment">//å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span><br>LOCK.notifyAll();<br>&#125; <br></code></pre></td></tr></table></figure><h2 id="7ã€æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ"><a href="#7ã€æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ" class="headerlink" title="7ã€æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ"></a>7ã€æ¨¡å¼ä¹‹ä¿æŠ¤æ€§æš‚åœ</h2><h3 id="1-å®šä¹‰"><a href="#1-å®šä¹‰" class="headerlink" title="(1)å®šä¹‰"></a>(1)å®šä¹‰</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145223.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145223.png" alt="img"></a></p><h3 id="2-ä¸¾ä¾‹"><a href="#2-ä¸¾ä¾‹" class="headerlink" title="(2)ä¸¾ä¾‹"></a>(2)ä¸¾ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test2</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>String hello = <span class="hljs-string">&quot;hello thread!&quot;</span>;<br>Guarded guarded = <span class="hljs-keyword">new</span> Guarded();<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>System.out.println(<span class="hljs-string">&quot;æƒ³è¦å¾—åˆ°ç»“æœ&quot;</span>);<br><span class="hljs-keyword">synchronized</span> (guarded) &#123;<br>System.out.println(<span class="hljs-string">&quot;ç»“æœæ˜¯ï¼š&quot;</span>+guarded.getResponse());<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;å¾—åˆ°ç»“æœ&quot;</span>);<br>&#125;).start();<br><br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>System.out.println(<span class="hljs-string">&quot;è®¾ç½®ç»“æœ&quot;</span>);<br><span class="hljs-keyword">synchronized</span> (guarded) &#123;<br>guarded.setResponse(hello);<br>&#125;<br>&#125;).start();<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Guarded</span> </span>&#123;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¦è¿”å›çš„ç»“æœ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> Object response;<br><br>    <span class="hljs-comment">//ä¼˜é›…åœ°ä½¿ç”¨wait/notify</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getResponse</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//å¦‚æœè¿”å›ç»“æœä¸ºç©ºå°±ä¸€ç›´ç­‰å¾…ï¼Œé¿å…è™šå‡å”¤é†’</span><br><span class="hljs-keyword">while</span>(response == <span class="hljs-keyword">null</span>) &#123;<br><span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">this</span>.wait();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> response;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setResponse</span><span class="hljs-params">(Object response)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.response = response;<br><span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br><span class="hljs-comment">//å”¤é†’ä¼‘çœ çš„çº¿ç¨‹</span><br><span class="hljs-keyword">this</span>.notifyAll();<br>&#125;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Guarded&#123;&quot;</span> +<br><span class="hljs-string">&quot;response=&quot;</span> + response +<br><span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><p><strong>å¸¦è¶…æ—¶åˆ¤æ–­çš„æš‚åœ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">getResponse</span><span class="hljs-params">(<span class="hljs-keyword">long</span> time)</span> </span>&#123;<br><span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br><span class="hljs-comment">//è·å–å¼€å§‹æ—¶é—´</span><br><span class="hljs-keyword">long</span> currentTime = System.currentTimeMillis();<br><span class="hljs-comment">//ç”¨äºä¿å­˜å·²ç»ç­‰å¾…äº†çš„æ—¶é—´</span><br><span class="hljs-keyword">long</span> passedTime = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">while</span>(response == <span class="hljs-keyword">null</span>) &#123;<br><span class="hljs-comment">//çœ‹ç»è¿‡çš„æ—¶é—´-å¼€å§‹æ—¶é—´æ˜¯å¦è¶…è¿‡äº†æŒ‡å®šæ—¶é—´</span><br><span class="hljs-keyword">long</span> waitTime = time -passedTime;<br><span class="hljs-keyword">if</span>(waitTime &lt;= <span class="hljs-number">0</span>) &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br>                   <span class="hljs-comment">//ç­‰å¾…å‰©ä½™æ—¶é—´</span><br><span class="hljs-keyword">this</span>.wait(waitTime);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-comment">//è·å–å½“å‰æ—¶é—´</span><br>passedTime = System.currentTimeMillis()-currentTime<br>            &#125;<br>&#125;<br><span class="hljs-keyword">return</span> response;<br>&#125; <br></code></pre></td></tr></table></figure><h3 id="3-joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼"><a href="#3-joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼" class="headerlink" title="(3)joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼"></a>(3)joinæºç â€”â€”ä½¿ç”¨ä¿æŠ¤æ€§æš‚åœæ¨¡å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">join</span><span class="hljs-params">(<span class="hljs-keyword">long</span> millis)</span></span><br><span class="hljs-function">    <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>        <span class="hljs-keyword">long</span> base = System.currentTimeMillis();<br>        <span class="hljs-keyword">long</span> now = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-keyword">if</span> (millis &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;timeout value is negative&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-keyword">if</span> (millis == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">while</span> (isAlive()) &#123;<br>                wait(<span class="hljs-number">0</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">while</span> (isAlive()) &#123;<br>                <span class="hljs-keyword">long</span> delay = millis - now;<br>                <span class="hljs-keyword">if</span> (delay &lt;= <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                wait(delay);<br>                now = System.currentTimeMillis() - base;<br>            &#125;<br>        &#125;<br>    &#125; <br></code></pre></td></tr></table></figure><h2 id="8ã€park-unpark"><a href="#8ã€park-unpark" class="headerlink" title="8ã€park/unpark"></a>8ã€park/unpark</h2><h3 id="1-åŸºæœ¬ä½¿ç”¨"><a href="#1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="(1)åŸºæœ¬ä½¿ç”¨"></a>(1)åŸºæœ¬ä½¿ç”¨</h3><p><strong>park/unparkéƒ½æ˜¯LockSupportç±»ä¸­çš„çš„æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æš‚åœçº¿ç¨‹è¿è¡Œ</span><br>LockSupport.park;<br><br><span class="hljs-comment">//æ¢å¤çº¿ç¨‹è¿è¡Œ</span><br>LockSupport.unpark(thread);Copy<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>Thread thread = <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;<br>System.out.println(<span class="hljs-string">&quot;park&quot;</span>);<br>            <span class="hljs-comment">//æš‚åœçº¿ç¨‹è¿è¡Œ</span><br>LockSupport.park();<br>System.out.println(<span class="hljs-string">&quot;resume&quot;</span>);<br>&#125;, <span class="hljs-string">&quot;t1&quot;</span>);<br>thread.start();<br><br>Thread.sleep(<span class="hljs-number">1000</span>);<br>System.out.println(<span class="hljs-string">&quot;unpark&quot;</span>);<br>    <span class="hljs-comment">//æ¢å¤çº¿ç¨‹è¿è¡Œ</span><br>LockSupport.unpark(thread);<br>&#125; <br></code></pre></td></tr></table></figure><h3 id="2-ç‰¹ç‚¹"><a href="#2-ç‰¹ç‚¹" class="headerlink" title="(2)ç‰¹ç‚¹"></a>(2)ç‰¹ç‚¹</h3><p><strong>ä¸wait/notifyçš„åŒºåˆ«</strong></p><ul><li>waitï¼Œnotify å’Œ notifyAll å¿…é¡»é…åˆ<strong>Object Monitor</strong>ä¸€èµ·ä½¿ç”¨ï¼Œè€Œparkï¼Œunparkä¸å¿…</li><li>park ï¼Œunpark æ˜¯ä»¥<strong>çº¿ç¨‹ä¸ºå•ä½</strong>æ¥<strong>é˜»å¡</strong>å’Œ<strong>å”¤é†’</strong>çº¿ç¨‹ï¼Œè€Œ notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼ŒnotifyAll æ˜¯å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹ï¼Œå°±ä¸é‚£ä¹ˆç²¾ç¡®</li><li>park &amp; unpark å¯ä»¥<strong>å…ˆ unpark</strong>ï¼Œè€Œ wait &amp; notify ä¸èƒ½å…ˆ notify</li><li><strong>parkä¸ä¼šé‡Šæ”¾é”</strong>ï¼Œè€Œwaitä¼šé‡Šæ”¾é”</li></ul><h3 id="3-åŸç†"><a href="#3-åŸç†" class="headerlink" title="(3)åŸç†"></a>(3)åŸç†</h3><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„<strong>Parkå¯¹è±¡</strong>ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡**_counter, _cond,__mutex**ç»„æˆ</p><ul><li><p>å…ˆè°ƒç”¨parkå†è°ƒç”¨unparkæ—¶</p><ul><li><p>å…ˆè°ƒç”¨park</p><ul><li>çº¿ç¨‹è¿è¡Œæ—¶ï¼Œä¼šå°†Parkå¯¹è±¡ä¸­çš„**_counterçš„å€¼è®¾ä¸º0**ï¼›</li><li>è°ƒç”¨parkæ—¶ï¼Œä¼šå…ˆæŸ¥çœ‹counterçš„å€¼æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0ï¼Œåˆ™å°†çº¿ç¨‹æ”¾å…¥é˜»å¡é˜Ÿåˆ—condä¸­</li><li>æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­åï¼Œä¼š<strong>å†æ¬¡</strong>å°†counterè®¾ç½®ä¸º0</li></ul></li><li><p>ç„¶åè°ƒç”¨unpark</p><ul><li><p>è°ƒç”¨unparkæ–¹æ³•åï¼Œä¼šå°†counterçš„å€¼è®¾ç½®ä¸º1</p></li><li><p>å»å”¤é†’é˜»å¡é˜Ÿåˆ—condä¸­çš„çº¿ç¨‹</p></li><li><p>çº¿ç¨‹ç»§ç»­è¿è¡Œå¹¶å°†counterçš„å€¼è®¾ä¸º0</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145250.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145250.png" alt="img"></a></p></li></ul></li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145303.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145303.png" alt="img"></a></p><ul><li>å…ˆè°ƒç”¨unparkï¼Œå†è°ƒç”¨park<ul><li>è°ƒç”¨unpark<ul><li>ä¼šå°†counterè®¾ç½®ä¸º1ï¼ˆè¿è¡Œæ—¶0ï¼‰</li></ul></li><li>è°ƒç”¨parkæ–¹æ³•<ul><li>æŸ¥çœ‹counteræ˜¯å¦ä¸º0</li><li>å› ä¸ºunparkå·²ç»æŠŠcounterè®¾ç½®ä¸º1ï¼Œæ‰€ä»¥æ­¤æ—¶å°†counterè®¾ç½®ä¸º0ï¼Œä½†<strong>ä¸æ”¾å…¥</strong>é˜»å¡é˜Ÿåˆ—condä¸­</li></ul></li></ul></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145313.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145313.png" alt="img"></a></p><h2 id="9ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢"><a href="#9ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢" class="headerlink" title="9ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢"></a>9ã€çº¿ç¨‹ä¸­çš„çŠ¶æ€è½¬æ¢</h2><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145330.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145330.png" alt="img"></a></p><h3 id="æƒ…å†µä¸€ï¼šNEW-â€“-gt-RUNNABLE"><a href="#æƒ…å†µä¸€ï¼šNEW-â€“-gt-RUNNABLE" class="headerlink" title="æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE"></a>æƒ…å†µä¸€ï¼šNEW â€“&gt; RUNNABLE</h3><ul><li>å½“è°ƒç”¨äº†t.start()æ–¹æ³•æ—¶ï¼Œç”± NEW â€“&gt; RUNNABLE</li></ul><h3 id="æƒ…å†µäºŒï¼š-RUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µäºŒï¼š-RUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µäºŒï¼š RUNNABLE &lt;â€“&gt; WAITING</h3><ul><li>å½“è°ƒç”¨äº†t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”å<ul><li>è°ƒç”¨ obj.wait() æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</li><li>è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶<ul><li>ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE</li><li>ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» WAITING â€“&gt; BLOCKED</li></ul></li></ul></li></ul><h3 id="æƒ…å†µä¸‰ï¼šRUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µä¸‰ï¼šRUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µä¸‰ï¼šRUNNABLE &lt;â€“&gt; WAITING</h3><ul><li><p>å½“å‰çº¿ç¨‹</p><p>è°ƒç”¨ t.join() æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</p><ul><li>æ³¨æ„æ˜¯<strong>å½“å‰çº¿ç¨‹</strong>åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…</li></ul></li><li><p>t çº¿ç¨‹<strong>è¿è¡Œç»“æŸ</strong>ï¼Œæˆ–è°ƒç”¨äº†<strong>å½“å‰çº¿ç¨‹</strong>çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE</p></li></ul><h3 id="æƒ…å†µå››ï¼š-RUNNABLE-lt-â€“-gt-WAITING"><a href="#æƒ…å†µå››ï¼š-RUNNABLE-lt-â€“-gt-WAITING" class="headerlink" title="æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING"></a>æƒ…å†µå››ï¼š RUNNABLE &lt;â€“&gt; WAITING</h3><ul><li>å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.park() æ–¹æ³•ä¼šè®©å½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; WAITING</li><li>è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» WAITING â€“&gt; RUNNABLE</li></ul><h3 id="æƒ…å†µäº”ï¼š-RUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µäº”ï¼š-RUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µäº”ï¼š RUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><p>t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”å</p><ul><li>è°ƒç”¨ obj.wait(<strong>long n</strong>) æ–¹æ³•æ—¶ï¼Œt çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</li><li>t çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–è°ƒç”¨ obj.notify() ï¼Œ obj.notifyAll() ï¼Œ t.interrupt() æ—¶<ul><li>ç«äº‰é”æˆåŠŸï¼Œt çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</li><li>ç«äº‰é”å¤±è´¥ï¼Œt çº¿ç¨‹ä» TIMED_WAITING â€“&gt; BLOCKED</li></ul></li></ul><h3 id="æƒ…å†µå…­ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µå…­ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µå…­ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul><li><p>å½“å‰çº¿ç¨‹è°ƒç”¨ t.join</p><p>(long n</p><p>) æ–¹æ³•æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</p><ul><li>æ³¨æ„æ˜¯å½“å‰çº¿ç¨‹åœ¨t çº¿ç¨‹å¯¹è±¡çš„ç›‘è§†å™¨ä¸Šç­‰å¾…</li></ul></li><li><p>å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œæˆ–t çº¿ç¨‹è¿è¡Œç»“æŸï¼Œæˆ–è°ƒç”¨äº†å½“å‰çº¿ç¨‹çš„ interrupt() æ—¶ï¼Œå½“å‰çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</p></li></ul><h3 id="æƒ…å†µä¸ƒï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µä¸ƒï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µä¸ƒï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul><li>å½“å‰çº¿ç¨‹è°ƒç”¨ Thread.sleep(long n) ï¼Œå½“å‰çº¿ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</li><li>å½“å‰çº¿ç¨‹ç­‰å¾…æ—¶é—´è¶…è¿‡äº† n æ¯«ç§’ï¼Œå½“å‰çº¿ç¨‹ä» TIMED_WAITING â€“&gt; RUNNABLE</li></ul><h3 id="æƒ…å†µå…«ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING"><a href="#æƒ…å†µå…«ï¼šRUNNABLE-lt-â€“-gt-TIMED-WAITING" class="headerlink" title="æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING"></a>æƒ…å†µå…«ï¼šRUNNABLE &lt;â€“&gt; TIMED_WAITING</h3><ul><li>å½“å‰çº¿ç¨‹è°ƒç”¨ LockSupport.parkNanos(long nanos) æˆ– LockSupport.parkUntil(long millis) æ—¶ï¼Œå½“å‰çº¿ ç¨‹ä» RUNNABLE â€“&gt; TIMED_WAITING</li><li>è°ƒç”¨ LockSupport.unpark(ç›®æ ‡çº¿ç¨‹) æˆ–è°ƒç”¨äº†çº¿ç¨‹ çš„ interrupt() ï¼Œæˆ–æ˜¯ç­‰å¾…è¶…æ—¶ï¼Œä¼šè®©ç›®æ ‡çº¿ç¨‹ä» TIMED_WAITINGâ€“&gt; RUNNABLE</li></ul><h3 id="æƒ…å†µä¹ï¼šRUNNABLE-lt-â€“-gt-BLOCKED"><a href="#æƒ…å†µä¹ï¼šRUNNABLE-lt-â€“-gt-BLOCKED" class="headerlink" title="æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED"></a>æƒ…å†µä¹ï¼šRUNNABLE &lt;â€“&gt; BLOCKED</h3><ul><li>t çº¿ç¨‹ç”¨ synchronized(obj) è·å–äº†å¯¹è±¡é”æ—¶å¦‚æœ<strong>ç«äº‰å¤±è´¥</strong>ï¼Œä» RUNNABLE â€“&gt; BLOCKED</li><li>æŒ obj é”çº¿ç¨‹çš„åŒæ­¥ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œä¼šå”¤é†’è¯¥å¯¹è±¡ä¸Šæ‰€æœ‰ BLOCKED çš„çº¿ç¨‹é‡æ–°ç«äº‰ï¼Œå¦‚æœå…¶ä¸­ t çº¿ç¨‹ç«äº‰ æˆåŠŸï¼Œä» BLOCKED â€“&gt; RUNNABLE ï¼Œå…¶å®ƒ<strong>å¤±è´¥</strong>çš„çº¿ç¨‹ä»ç„¶ BLOCKED</li></ul><h3 id="æƒ…å†µåï¼š-RUNNABLE-lt-â€“-gt-TERMINATED"><a href="#æƒ…å†µåï¼š-RUNNABLE-lt-â€“-gt-TERMINATED" class="headerlink" title="æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED"></a>æƒ…å†µåï¼š RUNNABLE &lt;â€“&gt; TERMINATED</h3><p>å½“å‰çº¿<strong>ç¨‹æ‰€æœ‰ä»£ç è¿è¡Œå®Œæ¯•</strong>ï¼Œè¿›å…¥ TERMINATED</p><h2 id="10ã€å¤šæŠŠé”"><a href="#10ã€å¤šæŠŠé”" class="headerlink" title="10ã€å¤šæŠŠé”"></a>10ã€å¤šæŠŠé”</h2><p><strong>å°†é”çš„ç²’åº¦ç»†åˆ†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BigRoom</span> </span>&#123;<br>    <span class="hljs-comment">//é¢å¤–åˆ›å»ºå¯¹è±¡æ¥ä½œä¸ºé”</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object studyRoom = <span class="hljs-keyword">new</span> Object();<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Object bedRoom = <span class="hljs-keyword">new</span> Object();<br>&#125; <br></code></pre></td></tr></table></figure><h2 id="11ã€æ´»è·ƒæ€§"><a href="#11ã€æ´»è·ƒæ€§" class="headerlink" title="11ã€æ´»è·ƒæ€§"></a>11ã€æ´»è·ƒæ€§</h2><h3 id="1-å®šä¹‰-1"><a href="#1-å®šä¹‰-1" class="headerlink" title="(1)å®šä¹‰"></a>(1)å®šä¹‰</h3><p>å› ä¸ºæŸç§åŸå› ï¼Œä½¿å¾—ä»£ç ä¸€ç›´æ— æ³•æ‰§è¡Œå®Œæ¯•ï¼Œè¿™æ ·çš„ç°è±¡å«åšæ´»è·ƒæ€§</p><h3 id="2-æ­»é”"><a href="#2-æ­»é”" class="headerlink" title="(2)æ­»é”"></a>(2)æ­»é”</h3><p>æœ‰è¿™æ ·çš„æƒ…å†µï¼šä¸€ä¸ªçº¿ç¨‹éœ€è¦<strong>åŒæ—¶è·å–å¤šæŠŠé”</strong>ï¼Œè¿™æ—¶å°±å®¹æ˜“å‘ç”Ÿæ­»é”</p><p>å¦‚ï¼št1çº¿ç¨‹è·å¾—Aå¯¹è±¡ é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Bå¯¹è±¡çš„é”t2çº¿ç¨‹è·å¾—Bå¯¹è±¡é”ï¼Œæ¥ä¸‹æ¥æƒ³è·å–Aå¯¹è±¡çš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">final</span> Object A = <span class="hljs-keyword">new</span> Object();<br><span class="hljs-keyword">final</span> Object B = <span class="hljs-keyword">new</span> Object();<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br><span class="hljs-keyword">synchronized</span> (A) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">2000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">synchronized</span> (B) &#123;<br><br>&#125;<br>&#125;<br>&#125;).start();<br><br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br><span class="hljs-keyword">synchronized</span> (B) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">1000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">synchronized</span> (A) &#123;<br><br>&#125;<br>&#125;<br>&#125;).start();<br>&#125; <br></code></pre></td></tr></table></figure><h4 id="å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"><a href="#å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶" class="headerlink" title="å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶"></a>å‘ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶</h4><ul><li>äº’æ–¥æ¡ä»¶<ul><li>åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œä¸€ç§èµ„æºåªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹æ‰€ä½¿ç”¨</li></ul></li><li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶<ul><li>è¿›ç¨‹å·²ç»æ‹¥æœ‰äº†è‡³å°‘ä¸€ç§èµ„æºï¼ŒåŒæ—¶åˆå»ç”³è¯·å…¶ä»–èµ„æºã€‚å› ä¸ºå…¶ä»–èµ„æºè¢«åˆ«çš„è¿›ç¨‹æ‰€ä½¿ç”¨ï¼Œè¯¥è¿›ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå¹¶ä¸”ä¸é‡Šæ”¾è‡ªå·±å·²æœ‰çš„èµ„æº</li></ul></li><li>ä¸å¯æŠ¢å æ¡ä»¶<ul><li>è¿›ç¨‹å¯¹å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œæˆå‰ä¸èƒ½è¢«å¼ºå ï¼Œåªèƒ½åœ¨è¿›ç¨‹ä½¿ç”¨å®Œåè‡ªå·±é‡Šæ”¾</li></ul></li><li>å¾ªç¯ç­‰å¾…æ¡ä»¶<ul><li>å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹â€”â€”èµ„æºçš„å¾ªç¯é“¾ã€‚</li></ul></li></ul><h4 id="å®šä½æ­»é”çš„æ–¹æ³•"><a href="#å®šä½æ­»é”çš„æ–¹æ³•" class="headerlink" title="å®šä½æ­»é”çš„æ–¹æ³•"></a>å®šä½æ­»é”çš„æ–¹æ³•</h4><ul><li><p>jps+jstack ThreadID</p><ul><li><p>åœ¨JAVAæ§åˆ¶å°ä¸­çš„Terminalä¸­è¾“å…¥<strong>jps</strong>æŒ‡ä»¤å¯ä»¥æŸ¥çœ‹è¿è¡Œä¸­çš„çº¿ç¨‹IDï¼Œä½¿ç”¨<strong>jstack ThreadID</strong>å¯ä»¥æŸ¥çœ‹çº¿ç¨‹çŠ¶æ€ã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145351.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145351.png" alt="img"></a></p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">F:\Thread_study&gt;jps<br><span class="hljs-number">20672</span> RemoteMavenServer36<br><span class="hljs-number">22880</span> Jps<br><span class="hljs-number">4432</span> Launcher<br><span class="hljs-number">5316</span> Test5<br><span class="hljs-number">20184</span> KotlinCompileDaemon<br><span class="hljs-number">11132</span><br><br>F:\Thread_study&gt;jstack <span class="hljs-number">5316</span> <br></code></pre></td></tr></table></figure></li><li><p>æ‰“å°çš„ç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//æ‰¾åˆ°ä¸€ä¸ªjavaçº§åˆ«çš„æ­»é”</span><br>Found one Java-level deadlock:<br>=============================<br><span class="hljs-string">&quot;Thread-1&quot;</span>:<br>  waiting to lock monitor <span class="hljs-number">0x0000000017f40de8</span> (object <span class="hljs-number">0x00000000d6188880</span>, a java.lang.Object),<br>  which is held by <span class="hljs-string">&quot;Thread-0&quot;</span><br><span class="hljs-string">&quot;Thread-0&quot;</span>:<br>  waiting to lock monitor <span class="hljs-number">0x0000000017f43678</span> (object <span class="hljs-number">0x00000000d6188890</span>, a java.lang.Object),<br>  which is held by <span class="hljs-string">&quot;Thread-1&quot;</span> <br></code></pre></td></tr></table></figure></li><li><p>jconsoleæ£€æµ‹æ­»é”</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145405.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145405.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145416.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145416.png" alt="img"></a></p></li></ul><h4 id="å“²å­¦å®¶å°±é¤é—®é¢˜"><a href="#å“²å­¦å®¶å°±é¤é—®é¢˜" class="headerlink" title="å“²å­¦å®¶å°±é¤é—®é¢˜"></a>å“²å­¦å®¶å°±é¤é—®é¢˜</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145436.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145436.png" alt="img"></a></p><h4 id="é¿å…æ­»é”çš„æ–¹æ³•"><a href="#é¿å…æ­»é”çš„æ–¹æ³•" class="headerlink" title="é¿å…æ­»é”çš„æ–¹æ³•"></a>é¿å…æ­»é”çš„æ–¹æ³•</h4><p>åœ¨çº¿ç¨‹ä½¿ç”¨é”å¯¹è±¡æ—¶<strong>ï¼Œé¡ºåºåŠ é”</strong>å³å¯é¿å…æ­»é”</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145450.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145450.png" alt="img"></a></p><h3 id="3-æ´»é”"><a href="#3-æ´»é”" class="headerlink" title="(3)æ´»é”"></a>(3)æ´»é”</h3><p>æ´»é”å‡ºç°åœ¨ä¸¤ä¸ªçº¿ç¨‹<strong>äº’ç›¸æ”¹å˜å¯¹æ–¹çš„ç»“æŸæ¡ä»¶</strong>ï¼Œåè°ä¹Ÿæ— æ³•ç»“æŸã€‚</p><h4 id="é¿å…æ´»é”çš„æ–¹æ³•"><a href="#é¿å…æ´»é”çš„æ–¹æ³•" class="headerlink" title="é¿å…æ´»é”çš„æ–¹æ³•"></a>é¿å…æ´»é”çš„æ–¹æ³•</h4><p>åœ¨çº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œä¸­é€”ç»™äºˆ<strong>ä¸åŒçš„é—´éš”æ—¶é—´</strong>å³å¯ã€‚</p><h4 id="æ­»é”ä¸æ´»é”çš„åŒºåˆ«"><a href="#æ­»é”ä¸æ´»é”çš„åŒºåˆ«" class="headerlink" title="æ­»é”ä¸æ´»é”çš„åŒºåˆ«"></a>æ­»é”ä¸æ´»é”çš„åŒºåˆ«</h4><ul><li>æ­»é”æ˜¯å› ä¸ºçº¿ç¨‹äº’ç›¸æŒæœ‰å¯¹è±¡æƒ³è¦çš„é”ï¼Œå¹¶ä¸”éƒ½ä¸é‡Šæ”¾ï¼Œæœ€ååˆ°æ—¶<strong>çº¿ç¨‹é˜»å¡</strong>ï¼Œ<strong>åœæ­¢è¿è¡Œ</strong>çš„ç°è±¡ã€‚</li><li>æ´»é”æ˜¯å› ä¸ºçº¿ç¨‹é—´ä¿®æ”¹äº†å¯¹æ–¹çš„ç»“æŸæ¡ä»¶ï¼Œè€Œå¯¼è‡´ä»£ç <strong>ä¸€ç›´åœ¨è¿è¡Œ</strong>ï¼Œå´ä¸€ç›´<strong>è¿è¡Œä¸å®Œ</strong>çš„ç°è±¡ã€‚</li></ul><h3 id="4-é¥¥é¥¿"><a href="#4-é¥¥é¥¿" class="headerlink" title="(4)é¥¥é¥¿"></a>(4)é¥¥é¥¿</h3><p>æŸäº›çº¿ç¨‹å› ä¸ºä¼˜å…ˆçº§å¤ªä½ï¼Œå¯¼è‡´ä¸€ç›´æ— æ³•è·å¾—èµ„æºçš„ç°è±¡ã€‚</p><p>åœ¨ä½¿ç”¨é¡ºåºåŠ é”æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é¥¥é¥¿ç°è±¡</p><h2 id="12ã€ReentrantLock"><a href="#12ã€ReentrantLock" class="headerlink" title="12ã€ReentrantLock"></a>12ã€ReentrantLock</h2><p><strong>å’Œsynchronizedç›¸æ¯”å…·æœ‰çš„çš„ç‰¹ç‚¹</strong></p><ul><li>å¯ä¸­æ–­</li><li>å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´</li><li>å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é” (å…ˆåˆ°å…ˆå¾—)</li><li>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡( å…·æœ‰<strong>å¤šä¸ª</strong>waitset)</li></ul><p><strong>åŸºæœ¬è¯­æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//è·å–ReentrantLockå¯¹è±¡</span><br><span class="hljs-keyword">private</span> ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();<br><span class="hljs-comment">//åŠ é”</span><br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//éœ€è¦æ‰§è¡Œçš„ä»£ç </span><br>&#125;<span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-comment">//é‡Šæ”¾é”</span><br>lock.unlock();<br>&#125; <br></code></pre></td></tr></table></figure><h4 id="å¯é‡å…¥"><a href="#å¯é‡å…¥" class="headerlink" title="å¯é‡å…¥"></a>å¯é‡å…¥</h4><ul><li>å¯é‡å…¥æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¦‚æœé¦–æ¬¡è·å¾—äº†è¿™æŠŠé”ï¼Œé‚£ä¹ˆå› ä¸ºå®ƒæ˜¯è¿™æŠŠé”çš„æ‹¥æœ‰è€…ï¼Œå› æ­¤æœ‰æƒåˆ©å†æ¬¡è·å–è¿™æŠŠé”</li><li>å¦‚æœæ˜¯ä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡è·å¾—é”æ—¶ï¼Œè‡ªå·±ä¹Ÿä¼šè¢«é”æŒ¡ä½</li></ul><h4 id="å¯æ‰“æ–­"><a href="#å¯æ‰“æ–­" class="headerlink" title="å¯æ‰“æ–­"></a>å¯æ‰“æ–­</h4><p>å¦‚æœæŸä¸ªçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œå¯ä»¥è°ƒç”¨å…¶interruptæ–¹æ³•è®©å…¶åœæ­¢é˜»å¡ï¼Œè·å¾—é”å¤±è´¥</p><p><strong>ç®€è€Œè¨€ä¹‹</strong>å°±æ˜¯ï¼šå¤„äºé˜»å¡çŠ¶æ€çš„çº¿ç¨‹ï¼Œè¢«æ‰“æ–­äº†å°±ä¸ç”¨é˜»å¡äº†ï¼Œç›´æ¥åœæ­¢è¿è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();<br>Thread t1 = <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//åŠ é”ï¼Œå¯æ‰“æ–­é”</span><br>lock.lockInterruptibly();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>                <span class="hljs-comment">//è¢«æ‰“æ–­ï¼Œè¿”å›ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œ</span><br><span class="hljs-keyword">return</span>;<br>&#125;<span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-comment">//é‡Šæ”¾é”</span><br>lock.unlock();<br>&#125;<br><br>&#125;);<br><br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br>t1.start();<br>Thread.sleep(<span class="hljs-number">1000</span>);<br><span class="hljs-comment">//æ‰“æ–­</span><br>t1.interrupt();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><h4 id="é”è¶…æ—¶"><a href="#é”è¶…æ—¶" class="headerlink" title="é”è¶…æ—¶"></a>é”è¶…æ—¶</h4><p>ä½¿ç”¨<strong>lock.tryLock</strong>æ–¹æ³•ä¼šè¿”å›è·å–é”æ˜¯å¦æˆåŠŸã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›trueï¼Œåä¹‹åˆ™è¿”å›falseã€‚</p><p>å¹¶ä¸”tryLockæ–¹æ³•å¯ä»¥<strong>æŒ‡å®šç­‰å¾…æ—¶é—´</strong>ï¼Œå‚æ•°ä¸ºï¼štryLock(long timeout, TimeUnit unit), å…¶ä¸­timeoutä¸ºæœ€é•¿ç­‰å¾…æ—¶é—´ï¼ŒTimeUnitä¸ºæ—¶é—´å•ä½</p><p><strong>ç®€è€Œè¨€ä¹‹</strong>å°±æ˜¯ï¼šè·å–å¤±è´¥äº†ã€è·å–è¶…æ—¶äº†æˆ–è€…è¢«æ‰“æ–­äº†ï¼Œä¸å†é˜»å¡ï¼Œç›´æ¥åœæ­¢è¿è¡Œ</p><p>ä¸è®¾ç½®ç­‰å¾…æ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();<br>Thread t1 = <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;<br>            <span class="hljs-comment">//æœªè®¾ç½®ç­‰å¾…æ—¶é—´ï¼Œä¸€æ—¦è·å–å¤±è´¥ï¼Œç›´æ¥è¿”å›false</span><br><span class="hljs-keyword">if</span>(!lock.tryLock()) &#123;<br>System.out.println(<span class="hljs-string">&quot;è·å–å¤±è´¥&quot;</span>);<br>                <span class="hljs-comment">//è·å–å¤±è´¥ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œè¿”å›</span><br><span class="hljs-keyword">return</span>;<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;å¾—åˆ°äº†é”&quot;</span>);<br>lock.unlock();<br>&#125;);<br><br><br>lock.lock();<br><span class="hljs-keyword">try</span>&#123;<br>t1.start();<br>Thread.sleep(<span class="hljs-number">3000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>è®¾ç½®ç­‰å¾…æ—¶é—´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();<br>Thread t1 = <span class="hljs-keyword">new</span> Thread(()-&gt; &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//åˆ¤æ–­è·å–é”æ˜¯å¦æˆåŠŸï¼Œæœ€å¤šç­‰å¾…1ç§’</span><br><span class="hljs-keyword">if</span>(!lock.tryLock(<span class="hljs-number">1</span>, TimeUnit.SECONDS)) &#123;<br>System.out.println(<span class="hljs-string">&quot;è·å–å¤±è´¥&quot;</span>);<br><span class="hljs-comment">//è·å–å¤±è´¥ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œç›´æ¥è¿”å›</span><br><span class="hljs-keyword">return</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br><span class="hljs-comment">//è¢«æ‰“æ–­ï¼Œä¸å†å‘ä¸‹æ‰§è¡Œï¼Œç›´æ¥è¿”å›</span><br><span class="hljs-keyword">return</span>;<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;å¾—åˆ°äº†é”&quot;</span>);<br><span class="hljs-comment">//é‡Šæ”¾é”</span><br>lock.unlock();<br>&#125;);<br><br><br>lock.lock();<br><span class="hljs-keyword">try</span>&#123;<br>t1.start();<br><span class="hljs-comment">//æ‰“æ–­ç­‰å¾…</span><br>t1.interrupt();<br>Thread.sleep(<span class="hljs-number">3000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><h4 id="å…¬å¹³é”"><a href="#å…¬å¹³é”" class="headerlink" title="å…¬å¹³é”"></a>å…¬å¹³é”</h4><p>åœ¨çº¿ç¨‹è·å–é”å¤±è´¥ï¼Œè¿›å…¥é˜»å¡é˜Ÿåˆ—æ—¶ï¼Œ<strong>å…ˆè¿›å…¥</strong>çš„ä¼šåœ¨é”è¢«é‡Šæ”¾å<strong>å…ˆè·å¾—</strong>é”ã€‚è¿™æ ·çš„è·å–æ–¹å¼å°±æ˜¯<strong>å…¬å¹³</strong>çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//é»˜è®¤æ˜¯ä¸å…¬å¹³é”ï¼Œéœ€è¦åœ¨åˆ›å»ºæ—¶æŒ‡å®šä¸ºå…¬å¹³é”</span><br>ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock(<span class="hljs-keyword">true</span>); <br></code></pre></td></tr></table></figure><h4 id="æ¡ä»¶å˜é‡"><a href="#æ¡ä»¶å˜é‡" class="headerlink" title="æ¡ä»¶å˜é‡"></a>æ¡ä»¶å˜é‡</h4><p>synchronized ä¸­ä¹Ÿæœ‰æ¡ä»¶å˜é‡ï¼Œå°±æ˜¯æˆ‘ä»¬è®²åŸç†æ—¶é‚£ä¸ª waitSet ä¼‘æ¯å®¤ï¼Œå½“æ¡ä»¶ä¸æ»¡è¶³æ—¶è¿›å…¥waitSet ç­‰å¾…</p><p>ReentrantLock çš„æ¡ä»¶å˜é‡æ¯” synchronized å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œå®ƒæ˜¯æ”¯æŒ<strong>å¤šä¸ª</strong>æ¡ä»¶å˜é‡çš„ï¼Œè¿™å°±å¥½æ¯”</p><ul><li>synchronized æ˜¯é‚£äº›ä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹éƒ½åœ¨ä¸€é—´ä¼‘æ¯å®¤ç­‰æ¶ˆæ¯</li><li>è€Œ ReentrantLock æ”¯æŒå¤šé—´ä¼‘æ¯å®¤ï¼Œæœ‰ä¸“é—¨ç­‰çƒŸçš„ä¼‘æ¯å®¤ã€ä¸“é—¨ç­‰æ—©é¤çš„ä¼‘æ¯å®¤ã€å”¤é†’æ—¶ä¹Ÿæ˜¯æŒ‰ä¼‘æ¯å®¤æ¥å”¤ é†’</li></ul><p>ä½¿ç”¨è¦ç‚¹ï¼š</p><ul><li>await å‰éœ€è¦<strong>è·å¾—é”</strong></li><li>await æ‰§è¡Œåï¼Œä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ conditionObject ç­‰å¾…</li><li>await çš„çº¿ç¨‹è¢«å”¤é†’ï¼ˆæˆ–æ‰“æ–­ã€æˆ–è¶…æ—¶ï¼‰å–é‡æ–°ç«äº‰ lock é”</li><li>ç«äº‰ lock é”æˆåŠŸåï¼Œä» await åç»§ç»­æ‰§</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> Boolean judge = <span class="hljs-keyword">false</span>;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>ReentrantLock lock = <span class="hljs-keyword">new</span> ReentrantLock();<br><span class="hljs-comment">//è·å¾—æ¡ä»¶å˜é‡</span><br>Condition condition = lock.newCondition();<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>lock.lock();<br><span class="hljs-keyword">try</span>&#123;<br><span class="hljs-keyword">while</span>(!judge) &#123;<br>System.out.println(<span class="hljs-string">&quot;ä¸æ»¡è¶³æ¡ä»¶ï¼Œç­‰å¾…...&quot;</span>);<br><span class="hljs-comment">//ç­‰å¾…</span><br>condition.await();<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œå®Œæ¯•ï¼&quot;</span>);<br>lock.unlock();<br>&#125;<br>&#125;).start();<br><br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>lock.lock();<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">1</span>);<br>judge = <span class="hljs-keyword">true</span>;<br><span class="hljs-comment">//é‡Šæ”¾</span><br>condition.signal();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>lock.unlock();<br>&#125;<br><br>&#125;).start();<br>&#125; <br></code></pre></td></tr></table></figure><h4 id="é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”"><a href="#é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”" class="headerlink" title="é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”"></a>é€šè¿‡Lockä¸AQSå®ç°å¯é‡å…¥é”</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyLock</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Lock</span> </span>&#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sync</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueuedSynchronizer</span> </span>&#123;<br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryAcquire</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span> </span>&#123;<br>         <span class="hljs-keyword">if</span> (getExclusiveOwnerThread() == <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">if</span> (compareAndSetState(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>               setExclusiveOwnerThread(Thread.currentThread());<br>               <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>         &#125;<br><br>         <span class="hljs-keyword">if</span> (getExclusiveOwnerThread() == Thread.currentThread()) &#123;<br>            <span class="hljs-keyword">int</span> state = getState();<br>            compareAndSetState(state, state + <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>         &#125;<br><br>         <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>      &#125;<br><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryRelease</span><span class="hljs-params">(<span class="hljs-keyword">int</span> arg)</span> </span>&#123;<br>         <span class="hljs-keyword">if</span> (getState() &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalMonitorStateException();<br>         &#125;<br><br>         <span class="hljs-keyword">if</span> (getExclusiveOwnerThread() != Thread.currentThread()) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalMonitorStateException();<br>         &#125;<br><br>         <span class="hljs-keyword">int</span> state = getState();<br>         <span class="hljs-keyword">if</span> (state == <span class="hljs-number">1</span>) &#123;<br>            setExclusiveOwnerThread(<span class="hljs-keyword">null</span>);<br>            compareAndSetState(state, <span class="hljs-number">0</span>);<br>         &#125; <span class="hljs-keyword">else</span> &#123;<br>            compareAndSetState(state, state - <span class="hljs-number">1</span>);<br>         &#125;<br>         <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>      &#125;<br><br>      <span class="hljs-meta">@Override</span><br>      <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">isHeldExclusively</span><span class="hljs-params">()</span> </span>&#123;<br>         <span class="hljs-keyword">return</span> getState() &gt;= <span class="hljs-number">1</span>;<br>      &#125;<br><br>      <span class="hljs-function"><span class="hljs-keyword">public</span> Condition <span class="hljs-title">newCondition</span><span class="hljs-params">()</span> </span>&#123;<br>         <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConditionObject();<br>      &#125;<br><br>   &#125;<br><br>   Sync sync = <span class="hljs-keyword">new</span> Sync();<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;<br>      sync.acquire(<span class="hljs-number">1</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lockInterruptibly</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>      sync.acquireInterruptibly(<span class="hljs-number">1</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryLock</span><span class="hljs-params">()</span> </span>&#123;<br>      <span class="hljs-keyword">return</span> sync.tryAcquire(<span class="hljs-number">1</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">tryLock</span><span class="hljs-params">(<span class="hljs-keyword">long</span> time, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>      <span class="hljs-keyword">return</span> sync.tryAcquireNanos(<span class="hljs-number">1</span>, time);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;<br>      sync.release(<span class="hljs-number">1</span>);<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> Condition <span class="hljs-title">newCondition</span><span class="hljs-params">()</span> </span>&#123;<br>      <span class="hljs-keyword">return</span> sync.newCondition();<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>   <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException, IOException </span>&#123;<br>      MyLock lock = <span class="hljs-keyword">new</span> MyLock();<br><br>      Object syncLock = <span class="hljs-keyword">new</span> Object();<br><br>      Thread t1 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>         <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) &#123;<br>            lock.lock();<br>            <span class="hljs-keyword">try</span> &#123;<br>               lock.lock();<br>               <span class="hljs-keyword">try</span> &#123;<br>                  lock.lock();<br>                  <span class="hljs-keyword">try</span> &#123;<br>                     num++;<br>                  &#125; <span class="hljs-keyword">finally</span> &#123;<br>                     lock.unlock();<br>                  &#125;<br>               &#125; <span class="hljs-keyword">finally</span> &#123;<br>                  lock.unlock();<br>               &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>               lock.unlock();<br>            &#125;<br>         &#125;<br>      &#125;);<br><br>      Thread t2 = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>         <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) &#123;<br>            lock.lock();<br>            <span class="hljs-keyword">try</span> &#123;<br>               lock.lock();<br>               <span class="hljs-keyword">try</span> &#123;<br>                  lock.lock();<br>                  <span class="hljs-keyword">try</span> &#123;<br>                     num--;<br>                  &#125; <span class="hljs-keyword">finally</span> &#123;<br>                     lock.unlock();<br>                  &#125;<br>               &#125; <span class="hljs-keyword">finally</span> &#123;<br>                  lock.unlock();<br>               &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>               lock.unlock();<br>            &#125;<br>         &#125;<br>      &#125;);<br><br>      t1.start();<br>      t2.start();<br>      t1.join();<br>      t2.join();<br><br>      <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;<br>   &#125;<br>&#125; <br></code></pre></td></tr></table></figure><h2 id="13ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶"><a href="#13ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶" class="headerlink" title="13ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶"></a>13ã€åŒæ­¥æ¨¡å¼ä¹‹é¡ºåºæ§åˆ¶</h2><h3 id="Wait-Notifyç‰ˆæœ¬"><a href="#Wait-Notifyç‰ˆæœ¬" class="headerlink" title="Wait/Notifyç‰ˆæœ¬"></a>Wait/Notifyç‰ˆæœ¬</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object LOCK = <span class="hljs-keyword">new</span> Object();<br><span class="hljs-comment">//åˆ¤æ–­å…ˆæ‰§è¡Œçš„å†…å®¹æ˜¯å¦æ‰§è¡Œå®Œæ¯•</span><br><span class="hljs-keyword">static</span> Boolean judge = <span class="hljs-keyword">false</span>;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br><span class="hljs-keyword">synchronized</span> (LOCK) &#123;<br><span class="hljs-keyword">while</span> (!judge) &#123;<br><span class="hljs-keyword">try</span> &#123;<br>LOCK.wait();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;2&quot;</span>);<br>&#125;<br>&#125;).start();<br><br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br><span class="hljs-keyword">synchronized</span> (LOCK) &#123;<br>System.out.println(<span class="hljs-string">&quot;1&quot;</span>);<br>judge = <span class="hljs-keyword">true</span>;<br>               <span class="hljs-comment">//æ‰§è¡Œå®Œæ¯•ï¼Œå”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span><br>LOCK.notifyAll();<br>&#125;<br>&#125;).start();<br>&#125; <br></code></pre></td></tr></table></figure><h3 id="äº¤æ›¿è¾“å‡º"><a href="#äº¤æ›¿è¾“å‡º" class="headerlink" title="äº¤æ›¿è¾“å‡º"></a>äº¤æ›¿è¾“å‡º</h3><p><strong>wait/notifyç‰ˆæœ¬</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test4</span> </span>&#123;<br><span class="hljs-keyword">static</span> Symbol symbol = <span class="hljs-keyword">new</span> Symbol();<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>symbol.run(<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);<br>&#125;).start();<br><br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>symbol.run(<span class="hljs-string">&quot;b&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);<br><br>&#125;).start();<br>symbol.run(<span class="hljs-string">&quot;c&quot;</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>);<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br><br>&#125;).start();<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Symbol</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String str, <span class="hljs-keyword">int</span> flag, <span class="hljs-keyword">int</span> nextFlag)</span> </span>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;loopNumber; i++) &#123;<br><span class="hljs-keyword">while</span>(flag != <span class="hljs-keyword">this</span>.flag) &#123;<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-keyword">this</span>.wait();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;<br>System.out.println(str);<br><span class="hljs-comment">//è®¾ç½®ä¸‹ä¸€ä¸ªè¿è¡Œçš„çº¿ç¨‹æ ‡è®°</span><br><span class="hljs-keyword">this</span>.flag = nextFlag;<br><span class="hljs-comment">//å”¤é†’æ‰€æœ‰çº¿ç¨‹</span><br><span class="hljs-keyword">this</span>.notifyAll();<br>&#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * çº¿ç¨‹çš„æ‰§è¡Œæ ‡è®°ï¼Œ 1-&gt;a 2-&gt;b 3-&gt;c</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> flag = <span class="hljs-number">1</span>;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> loopNumber = <span class="hljs-number">5</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getFlag</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> flag;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setFlag</span><span class="hljs-params">(<span class="hljs-keyword">int</span> flag)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.flag = flag;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getLoopNumber</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> loopNumber;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLoopNumber</span><span class="hljs-params">(<span class="hljs-keyword">int</span> loopNumber)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.loopNumber = loopNumber;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><p><strong>await/signalç‰ˆæœ¬</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test5</span> </span>&#123;<br><span class="hljs-keyword">static</span> AwaitSignal awaitSignal = <span class="hljs-keyword">new</span> AwaitSignal();<br><span class="hljs-keyword">static</span> Condition conditionA = awaitSignal.newCondition();<br><span class="hljs-keyword">static</span> Condition conditionB = awaitSignal.newCondition();<br><span class="hljs-keyword">static</span> Condition conditionC = awaitSignal.newCondition();<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>awaitSignal.run(<span class="hljs-string">&quot;a&quot;</span>, conditionA, conditionB);<br>&#125;).start();<br><br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>awaitSignal.run(<span class="hljs-string">&quot;b&quot;</span>, conditionB, conditionC);<br>&#125;).start();<br><br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>awaitSignal.run(<span class="hljs-string">&quot;c&quot;</span>, conditionC, conditionA);<br>&#125;).start();<br><br><br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">1000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>awaitSignal.lock();<br><span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//å”¤é†’ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹</span><br>conditionA.signal();<br>&#125;<span class="hljs-keyword">finally</span> &#123;<br>awaitSignal.unlock();<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AwaitSignal</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ReentrantLock</span></span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String str, Condition thisCondition, Condition nextCondition)</span> </span>&#123;<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>; i&lt;loopNumber; i++) &#123;<br>lock();<br><span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">//å…¨éƒ¨è¿›å…¥ç­‰å¾…çŠ¶æ€</span><br>thisCondition.await();<br>System.out.print(str);<br>nextCondition.signal();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>unlock();<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> loopNumber=<span class="hljs-number">5</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getLoopNumber</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> loopNumber;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setLoopNumber</span><span class="hljs-params">(<span class="hljs-keyword">int</span> loopNumber)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.loopNumber = loopNumber;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><h2 id="14ã€ThreadLocal"><a href="#14ã€ThreadLocal" class="headerlink" title="14ã€ThreadLocal"></a>14ã€ThreadLocal</h2><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ThreadLocalæ˜¯JDKåŒ…æä¾›çš„ï¼Œå®ƒæä¾›äº†çº¿ç¨‹æœ¬åœ°å˜é‡ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªThreadLocalå˜é‡ï¼Œé‚£ä¹ˆ<strong>è®¿é—®è¿™ä¸ªå˜é‡çš„æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è¿™ä¸ªå˜é‡çš„ä¸€ä¸ªæœ¬åœ°å‰¯æœ¬</strong>ã€‚å½“å¤šä¸ªçº¿ç¨‹æ“ä½œè¿™ä¸ªå˜é‡æ—¶ï¼Œå®é™…æ“ä½œçš„æ˜¯è‡ªå·±æœ¬åœ°å†…å­˜é‡Œé¢çš„å˜é‡ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹å®‰å…¨é—®é¢˜</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadLocalStudy</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-comment">// åˆ›å»ºThreadLocalå˜é‡</span><br>      ThreadLocal&lt;String&gt; stringThreadLocal = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();<br>      ThreadLocal&lt;User&gt; userThreadLocal = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();<br><br>      <span class="hljs-comment">// åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸Šé¢çš„ä¸¤ä¸ªThreadLocalå˜é‡</span><br>      Thread thread1 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>         <span class="hljs-comment">// stringThreadLocalç¬¬ä¸€æ¬¡èµ‹å€¼</span><br>         stringThreadLocal.set(<span class="hljs-string">&quot;thread1 stringThreadLocal first&quot;</span>);<br>         <span class="hljs-comment">// stringThreadLocalç¬¬äºŒæ¬¡èµ‹å€¼</span><br>         stringThreadLocal.set(<span class="hljs-string">&quot;thread1 stringThreadLocal second&quot;</span>);<br>         <span class="hljs-comment">// userThreadLocalèµ‹å€¼</span><br>         userThreadLocal.set(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;Nyima&quot;</span>, <span class="hljs-number">20</span>));<br><br>         <span class="hljs-comment">// å–å€¼</span><br>         System.out.println(stringThreadLocal.get());<br>         System.out.println(userThreadLocal.get());<br>          <br>          <span class="hljs-comment">// ç§»é™¤</span><br> userThreadLocal.remove();<br> System.out.println(userThreadLocal.get());<br>      &#125;);<br><br>      Thread thread2 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>         <span class="hljs-comment">// stringThreadLocalç¬¬ä¸€æ¬¡èµ‹å€¼</span><br>         stringThreadLocal.set(<span class="hljs-string">&quot;thread2 stringThreadLocal first&quot;</span>);<br>         <span class="hljs-comment">// stringThreadLocalç¬¬äºŒæ¬¡èµ‹å€¼</span><br>         stringThreadLocal.set(<span class="hljs-string">&quot;thread2 stringThreadLocal second&quot;</span>);<br>         <span class="hljs-comment">// userThreadLocalèµ‹å€¼</span><br>         userThreadLocal.set(<span class="hljs-keyword">new</span> User(<span class="hljs-string">&quot;Hulu&quot;</span>, <span class="hljs-number">20</span>));<br><br>         <span class="hljs-comment">// å–å€¼</span><br>         System.out.println(stringThreadLocal.get());<br>         System.out.println(userThreadLocal.get());<br>      &#125;);<br><br>      <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span><br>      thread1.start();<br>      thread2.start();<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>   String name;<br>   <span class="hljs-keyword">int</span> age;<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(String name, <span class="hljs-keyword">int</span> age)</span> </span>&#123;<br>      <span class="hljs-keyword">this</span>.name = name;<br>      <span class="hljs-keyword">this</span>.age = age;<br>   &#125;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;User&#123;&quot;</span> +<br>            <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>            <span class="hljs-string">&quot;, age=&quot;</span> + age +<br>            <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>   &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">thread1 stringThreadLocal second<br>thread2 stringThreadLocal second<br>User&#123;name=<span class="hljs-string">&#x27;Nyima&#x27;</span>, age=<span class="hljs-number">20</span>&#125;<br>User&#123;name=<span class="hljs-string">&#x27;Hulu&#x27;</span>, age=<span class="hljs-number">20</span>&#125;<br><span class="hljs-keyword">null</span> <br></code></pre></td></tr></table></figure><p>ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡º</p><ul><li>æ¯ä¸ªçº¿ç¨‹ä¸­çš„ThreadLocalå˜é‡æ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„ï¼Œè€Œä¸æ˜¯å…±äº«çš„<ul><li>ä»çº¿ç¨‹1å’Œçº¿ç¨‹2çš„æ‰“å°ç»“æœå¯ä»¥çœ‹å‡º</li></ul></li><li>ThreadLocalå…¶å®å°±ç›¸å½“äºå…¶æ³›å‹ç±»å‹çš„ä¸€ä¸ªå˜é‡ï¼Œåªä¸è¿‡æ˜¯æ¯ä¸ªçº¿ç¨‹ç§æœ‰çš„<ul><li>stringThreadLocalè¢«èµ‹å€¼äº†ä¸¤æ¬¡ï¼Œä¿å­˜çš„æ˜¯æœ€åä¸€æ¬¡èµ‹å€¼çš„ç»“æœ</li></ul></li><li>ThreadLocalå¯ä»¥è¿›è¡Œä»¥ä¸‹å‡ ä¸ªæ“ä½œ<ul><li>set è®¾ç½®å€¼</li><li>get å–å‡ºå€¼</li><li>remove ç§»é™¤å€¼</li></ul></li></ul><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="Threadä¸­çš„threadLocals"><a href="#Threadä¸­çš„threadLocals" class="headerlink" title="Threadä¸­çš„threadLocals"></a>Threadä¸­çš„threadLocals</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Thread</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br> ...<br><br> ThreadLocal.ThreadLocalMap threadLocals = <span class="hljs-keyword">null</span>;<br><br> <span class="hljs-comment">// æ”¾åœ¨åé¢è¯´</span><br> ThreadLocal.ThreadLocalMap inheritableThreadLocals = <span class="hljs-keyword">null</span>;<br><br> ...<br>&#125;Copy<br><span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadLocalMap</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WeakReference</span>&lt;<span class="hljs-title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;<br>        <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span><br>        Object value;<br><br>        Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;<br>            <span class="hljs-keyword">super</span>(k);<br>            value = v;<br>        &#125;<br>    &#125; <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºThreadç±»ä¸­æœ‰ä¸€ä¸ªthreadLocalså’Œä¸€ä¸ªinheritableThreadLocalsï¼Œå®ƒä»¬éƒ½æ˜¯ThreadLocalMapç±»å‹çš„å˜é‡ï¼Œè€ŒThreadLocalMapæ˜¯ä¸€ä¸ªå®šåˆ¶åŒ–çš„Hashmapã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„è¿™ä¸¤ä¸ªå˜é‡éƒ½ä¸ºnullã€‚æ­¤å¤„å…ˆè®¨è®ºthreadLocalsï¼ŒinheritableThreadLocalsæ”¾åœ¨åé¢è®¨è®º</p><h4 id="ThreadLocalä¸­çš„æ–¹æ³•"><a href="#ThreadLocalä¸­çš„æ–¹æ³•" class="headerlink" title="ThreadLocalä¸­çš„æ–¹æ³•"></a><strong>ThreadLocalä¸­çš„æ–¹æ³•</strong></h4><p><strong>setæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(T value)</span> </span>&#123;<br>    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹</span><br>    Thread t = Thread.currentThread();<br>    <br>    <span class="hljs-comment">// è·å¾—ThreadLocalMapå¯¹è±¡ </span><br>    <span class="hljs-comment">// è¿™é‡Œçš„getä¼šè¿”å›Threadç±»ä¸­çš„threadLocals</span><br>    ThreadLocalMap map = getMap(t);<br>    <br>    <span class="hljs-comment">// åˆ¤æ–­mapæ˜¯å¦å·²ç»åˆ›å»ºï¼Œæ²¡åˆ›å»ºå°±åˆ›å»ºå¹¶æ”¾å…¥å€¼ï¼Œåˆ›å»ºäº†å°±ç›´æ¥æ”¾å…¥</span><br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-keyword">null</span>)<br>        <span class="hljs-comment">// ThreadLocalè‡ªç”Ÿçš„å¼•ç”¨ä½œä¸ºkeyï¼Œä¼ å…¥çš„å€¼ä½œä¸ºvalue</span><br>        map.set(<span class="hljs-keyword">this</span>, value);<br>    <span class="hljs-keyword">else</span><br>        createMap(t, value);<br>&#125; <br></code></pre></td></tr></table></figure><p><strong>å¦‚æœæœªåˆ›å»º</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> </span>&#123;<br>    <span class="hljs-comment">// åˆ›å»ºçš„åŒæ—¶è®¾ç½®æƒ³æ”¾å…¥çš„å€¼</span><br>    <span class="hljs-comment">// hreadLocalè‡ªç”Ÿçš„å¼•ç”¨ä½œä¸ºkeyï¼Œä¼ å…¥çš„å€¼ä½œä¸ºvalue</span><br>    t.threadLocals = <span class="hljs-keyword">new</span> ThreadLocalMap(<span class="hljs-keyword">this</span>, firstValue);<br>&#125; <br></code></pre></td></tr></table></figure><p><strong>getæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">get</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹</span><br>    Thread t = Thread.currentThread();<br><span class="hljs-comment">// è·å–å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡</span><br>    ThreadLocalMap map = getMap(t);<br>    <br>    <span class="hljs-comment">// åˆ¤æ–­threadLocalsæ˜¯å¦è¢«åˆå§‹åŒ–äº†</span><br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// å·²ç»åˆå§‹åŒ–åˆ™ç›´æ¥è¿”å›</span><br>        ThreadLocalMap.Entry e = map.getEntry(<span class="hljs-keyword">this</span>);<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            T result = (T)e.value;<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// å¦åˆ™å°±åˆ›å»ºthreadLocals</span><br>    <span class="hljs-keyword">return</span> setInitialValue();<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">private</span> T <span class="hljs-title">setInitialValue</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•è¿”å›æ˜¯null</span><br>    T value = initialValue();<br>    Thread t = Thread.currentThread();<br>    ThreadLocalMap map = getMap(t);<br>    <br>    <span class="hljs-comment">// æ— è®ºmapåˆ›å»ºä¸å¦ï¼Œæœ€ç»ˆvalueçš„å€¼éƒ½ä¸ºnull</span><br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-keyword">null</span>)<br>        map.set(<span class="hljs-keyword">this</span>, value);<br>    <span class="hljs-keyword">else</span><br>        createMap(t, value);<br>    <span class="hljs-keyword">return</span> value;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">protected</span> T <span class="hljs-title">initialValue</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125; <br></code></pre></td></tr></table></figure><p><strong>removeæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span><span class="hljs-params">()</span> </span>&#123;<br>    ThreadLocalMap m = getMap(Thread.currentThread());<br>    <span class="hljs-keyword">if</span> (m != <span class="hljs-keyword">null</span>)<br>        <span class="hljs-comment">// å¦‚æœthreadLocalså·²ç»è¢«åˆå§‹åŒ–ï¼Œåˆ™ç§»é™¤</span><br>        m.remove(<span class="hljs-keyword">this</span>);<br>&#125; <br></code></pre></td></tr></table></figure><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h4><p>åœ¨æ¯ä¸ªçº¿ç¨‹å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªåä¸ºthreadLocalsçš„æˆå‘˜å˜é‡ï¼Œè¯¥å˜é‡çš„ç±»å‹ä¸ºHashMapï¼Œå…¶ä¸­<strong>keyä¸ºæˆ‘ä»¬å®šä¹‰çš„ThreadLocalå˜é‡çš„thiså¼•ç”¨ï¼Œvalueåˆ™ä¸ºæˆ‘ä»¬ä½¿ç”¨setæ–¹æ³•è®¾ç½®çš„å€¼</strong>ã€‚æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡å­˜æ”¾åœ¨çº¿ç¨‹è‡ªå·±çš„å†…å­˜å˜é‡threadLocalsä¸­</p><p>åªæœ‰å½“å‰çº¿ç¨‹<strong>ç¬¬ä¸€æ¬¡è°ƒç”¨ThreadLocalçš„setæˆ–è€…getæ–¹æ³•æ—¶æ‰ä¼šåˆ›å»ºthreadLocals</strong>ï¼ˆinheritableThreadLocalsä¹Ÿæ˜¯ä¸€æ ·ï¼‰ã€‚å…¶å®æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡ä¸æ˜¯å­˜æ”¾åœ¨ThreadLocalå®ä¾‹é‡Œé¢ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨è°ƒç”¨çº¿ç¨‹çš„threadLocalså˜é‡é‡Œé¢</p><h2 id="15ã€InheritableThreadLocal"><a href="#15ã€InheritableThreadLocal" class="headerlink" title="15ã€InheritableThreadLocal"></a>15ã€InheritableThreadLocal</h2><h3 id="ç®€ä»‹-1"><a href="#ç®€ä»‹-1" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>ä»ThreadLocalçš„æºç å¯ä»¥çœ‹å‡ºï¼Œæ— è®ºæ˜¯setã€getã€è¿˜æ˜¯removeï¼Œéƒ½æ˜¯ç›¸å¯¹äºå½“å‰çº¿ç¨‹æ“ä½œçš„</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Thread</span>.</span></span>current<span class="hljs-constructor">Thread()</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥ThreadLocalæ— æ³•ä»çˆ¶çº¿ç¨‹ä¼ å‘å­çº¿ç¨‹ï¼Œæ‰€ä»¥InheritableThreadLocalå‡ºç°äº†ï¼Œ<strong>å®ƒèƒ½å¤Ÿè®©çˆ¶çº¿ç¨‹ä¸­ThreadLocalçš„å€¼ä¼ ç»™å­çº¿ç¨‹ã€‚</strong></p><p>ä¹Ÿå°±æ˜¯ä»mainæ‰€åœ¨çš„çº¿ç¨‹ï¼Œä¼ ç»™thread1æˆ–thread2</p><h3 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      ThreadLocal&lt;String&gt; stringThreadLocal = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();<br>      InheritableThreadLocal&lt;String&gt; stringInheritable = <span class="hljs-keyword">new</span> InheritableThreadLocal&lt;&gt;();<br><br>      <span class="hljs-comment">// ä¸»çº¿ç¨‹èµ‹å¯¹ä¸Šé¢ä¸¤ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼</span><br>      stringThreadLocal.set(<span class="hljs-string">&quot;this is threadLocal&quot;</span>);<br>      stringInheritable.set(<span class="hljs-string">&quot;this is inheritableThreadLocal&quot;</span>);<br><br>      <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹</span><br>      Thread thread1 = <span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br>         <span class="hljs-comment">// è·å¾—ThreadLocalä¸­å­˜æ”¾çš„å€¼</span><br>         System.out.println(stringThreadLocal.get());<br><br>         <span class="hljs-comment">// è·å¾—InheritableThreadLocalå­˜æ”¾çš„å€¼</span><br>         System.out.println(stringInheritable.get());<br>      &#125;);<br><br>      thread1.start();<br>   &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p><strong>è¿è¡Œç»“æœ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">null</span><br><span class="hljs-keyword">this</span> is inheritableThreadLocal <br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºInheritableThreadLocalçš„å€¼æˆåŠŸä»ä¸»çº¿ç¨‹ä¼ å…¥äº†å­çº¿ç¨‹ï¼Œè€ŒThreadLocalåˆ™æ²¡æœ‰</p><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><h4 id="InheritableThreadLocal"><a href="#InheritableThreadLocal" class="headerlink" title="InheritableThreadLocal"></a>InheritableThreadLocal</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InheritableThreadLocal</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title">ThreadLocal</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br>    <span class="hljs-comment">// ä¼ å…¥çˆ¶çº¿ç¨‹ä¸­çš„ä¸€ä¸ªå€¼ï¼Œç„¶åç›´æ¥è¿”å›</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> T <span class="hljs-title">childValue</span><span class="hljs-params">(T parentValue)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> parentValue;<br>    &#125;<br><br>  <span class="hljs-comment">// è¿”å›ä¼ å…¥çº¿ç¨‹çš„inheritableThreadLocals</span><br>    <span class="hljs-comment">// Threadä¸­æœ‰ä¸€ä¸ªinheritableThreadLocalså˜é‡</span><br>    <span class="hljs-comment">// ThreadLocal.ThreadLocalMap inheritableThreadLocals = null;</span><br>    <span class="hljs-function">ThreadLocalMap <span class="hljs-title">getMap</span><span class="hljs-params">(Thread t)</span> </span>&#123;<br>       <span class="hljs-keyword">return</span> t.inheritableThreadLocals;<br>    &#125;<br><br> <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªinheritableThreadLocals</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">createMap</span><span class="hljs-params">(Thread t, T firstValue)</span> </span>&#123;<br>        t.inheritableThreadLocals = <span class="hljs-keyword">new</span> ThreadLocalMap(<span class="hljs-keyword">this</span>, firstValue);<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>ç”±å¦‚ä¸Šä»£ç å¯çŸ¥ï¼ŒInheritableThreadLocalç»§æ‰¿äº†ThreadLocalï¼Œå¹¶é‡å†™äº†ä¸‰ä¸ªæ–¹æ³•ã€‚InheritableThreadLocalé‡å†™äº†<strong>createMapæ–¹æ³•</strong>ï¼Œé‚£ä¹ˆç°åœ¨å½“ç¬¬ä¸€æ¬¡è°ƒç”¨setæ–¹æ³•æ—¶ï¼Œåˆ›å»ºçš„æ˜¯å½“å‰çº¿ç¨‹çš„inheritableThreadLocalså˜é‡çš„å®ä¾‹è€Œä¸å†æ˜¯threadLocalsã€‚å½“è°ƒç”¨<strong>getMapæ–¹æ³•</strong>è·å–å½“å‰çº¿ç¨‹å†…éƒ¨çš„mapå˜é‡æ—¶ï¼Œè·å–çš„æ˜¯inheritableThreadLocalsè€Œä¸å†æ˜¯threadLocals</p><h4 id="childValue-T-parentValue-æ–¹æ³•çš„è°ƒç”¨"><a href="#childValue-T-parentValue-æ–¹æ³•çš„è°ƒç”¨" class="headerlink" title="childValue(T parentValue)æ–¹æ³•çš„è°ƒç”¨"></a>childValue(T parentValue)æ–¹æ³•çš„è°ƒç”¨</h4><p>åœ¨ä¸»å‡½æ•°è¿è¡Œæ—¶ï¼Œä¼šè°ƒç”¨Threadçš„é»˜è®¤æ„é€ å‡½æ•°ï¼ˆ<strong>åˆ›å»ºä¸»çº¿ç¨‹</strong>ï¼Œä¹Ÿå°±æ˜¯çˆ¶çº¿ç¨‹ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆçœ‹çœ‹Threadçš„é»˜è®¤æ„é€ å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Thread</span><span class="hljs-params">()</span> </span>&#123;<br>    init(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;Thread-&quot;</span> + nextThreadNum(), <span class="hljs-number">0</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ThreadGroup g, Runnable target, String name,</span></span><br><span class="hljs-function"><span class="hljs-params">                  <span class="hljs-keyword">long</span> stackSize, AccessControlContext acc,</span></span><br><span class="hljs-function"><span class="hljs-params">                  <span class="hljs-keyword">boolean</span> inheritThreadLocals)</span> </span>&#123;<br>   ...<br>        <br><span class="hljs-comment">// è·å¾—å½“å‰çº¿ç¨‹çš„ï¼Œåœ¨è¿™é‡Œæ˜¯ä¸»çº¿ç¨‹</span><br>    Thread parent = currentThread();<br>   <br>    ...<br>    <br>    <span class="hljs-comment">// å¦‚æœçˆ¶çº¿ç¨‹çš„inheritableThreadLocalså­˜åœ¨</span><br>    <span class="hljs-comment">// æˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨setå’Œgetæ—¶ï¼Œä¼šåˆ›å»ºinheritableThreadLocals</span><br>    <span class="hljs-keyword">if</span> (inheritThreadLocals &amp;&amp; parent.inheritableThreadLocals != <span class="hljs-keyword">null</span>)<br>        <span class="hljs-comment">// è®¾ç½®å­çº¿ç¨‹çš„inheritableThreadLocals</span><br>        <span class="hljs-keyword">this</span>.inheritableThreadLocals =<br>            ThreadLocal.createInheritedMap(parent.inheritableThreadLocals);<br>    <br>    <span class="hljs-comment">/* Stash the specified stack size in case the VM cares */</span><br>    <span class="hljs-keyword">this</span>.stackSize = stackSize;<br><br>    <span class="hljs-comment">/* Set thread ID */</span><br>    tid = nextThreadID();<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">static</span> ThreadLocalMap <span class="hljs-title">createInheritedMap</span><span class="hljs-params">(ThreadLocalMap parentMap)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ThreadLocalMap(parentMap);<br>&#125; <br></code></pre></td></tr></table></figure><p>åœ¨createInheritedMapå†…éƒ¨ä½¿ç”¨çˆ¶çº¿ç¨‹çš„inheritableThreadLocalså˜é‡ä½œä¸ºæ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ThreadLocalMapå˜é‡ï¼Œç„¶åèµ‹å€¼ç»™äº†å­çº¿ç¨‹çš„inheritableThreadLocalså˜é‡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">ThreadLocalMap</span><span class="hljs-params">(ThreadLocalMap parentMap)</span> </span>&#123;<br>    Entry[] parentTable = parentMap.table;<br>    <span class="hljs-keyword">int</span> len = parentTable.length;<br>    setThreshold(len);<br>    table = <span class="hljs-keyword">new</span> Entry[len];<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; len; j++) &#123;<br>        Entry e = parentTable[j];<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>            ThreadLocal&lt;Object&gt; key = (ThreadLocal&lt;Object&gt;) e.get();<br>            <span class="hljs-keyword">if</span> (key != <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-comment">// è¿™é‡Œè°ƒç”¨äº† childValue æ–¹æ³•</span><br>                <span class="hljs-comment">// è¯¥æ–¹æ³•ä¼šè¿”å›parentçš„å€¼</span><br>                Object value = key.childValue(e.value);<br>                <br>                Entry c = <span class="hljs-keyword">new</span> Entry(key, value);<br>                <span class="hljs-keyword">int</span> h = key.threadLocalHashCode &amp; (len - <span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">while</span> (table[h] != <span class="hljs-keyword">null</span>)<br>                    h = nextIndex(h, len);<br>                table[h] = c;<br>                size++;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>åœ¨è¯¥æ„é€ å‡½æ•°å†…éƒ¨æŠŠçˆ¶çº¿ç¨‹çš„inheritableThreadLocalsæˆå‘˜å˜é‡çš„å€¼å¤åˆ¶åˆ°æ–°çš„ThreadLocalMapå¯¹è±¡ä¸­</p><h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>InheritableThreadLocalç±»é€šè¿‡é‡å†™getMapå’ŒcreateMapï¼Œè®©æœ¬åœ°å˜é‡ä¿å­˜åˆ°äº†å…·ä½“çº¿ç¨‹çš„inheritableThreadLocalså˜é‡é‡Œé¢ï¼Œé‚£ä¹ˆçº¿ç¨‹åœ¨é€šè¿‡InheritableThreadLocalç±»å®ä¾‹çš„setæˆ–è€…getæ–¹æ³•è®¾ç½®å˜é‡æ—¶ï¼Œå°±ä¼šåˆ›å»ºå½“å‰çº¿ç¨‹çš„inheritableThreadLocalså˜é‡ã€‚</p><p><strong>å½“çˆ¶çº¿ç¨‹åˆ›å»ºå­çº¿ç¨‹æ—¶ï¼Œæ„é€ å‡½æ•°ä¼šæŠŠçˆ¶çº¿ç¨‹ä¸­inheritableThreadLocalså˜é‡é‡Œé¢çš„æœ¬åœ°å˜é‡å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å­çº¿ç¨‹çš„inheritableThreadLocalså˜é‡é‡Œé¢ã€‚</strong></p><h1 id="å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜"><a href="#å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜" class="headerlink" title="å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜"></a>å››ã€å…±äº«æ¨¡å‹ä¹‹å†…å­˜</h1><h2 id="1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"><a href="#1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰" class="headerlink" title="1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰"></a>1ã€JAVAå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰</h2><p>JMM å³ Java Memory Modelï¼Œå®ƒå®šä¹‰äº†<strong>ä¸»å­˜ï¼ˆå…±äº«å†…å­˜ï¼‰ã€å·¥ä½œå†…å­˜ï¼ˆçº¿ç¨‹ç§æœ‰ï¼‰</strong>æŠ½è±¡æ¦‚å¿µï¼Œåº•å±‚å¯¹åº”ç€ CPU å¯„å­˜å™¨ã€ç¼“å­˜ã€ç¡¬ä»¶å†…å­˜ã€ CPU æŒ‡ä»¤ä¼˜åŒ–ç­‰ã€‚</p><p><strong>JMMä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢</strong></p><ul><li>åŸå­æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå—åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å½±å“</li><li>å¯è§æ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu ç¼“å­˜çš„å½±å“</li><li>æœ‰åºæ€§ - ä¿è¯æŒ‡ä»¤ä¸ä¼šå— cpu æŒ‡ä»¤å¹¶è¡Œä¼˜åŒ–çš„å½±å“</li></ul><h2 id="2ã€å¯è§æ€§"><a href="#2ã€å¯è§æ€§" class="headerlink" title="2ã€å¯è§æ€§"></a>2ã€å¯è§æ€§</h2><h4 id="å¼•ä¾‹"><a href="#å¼•ä¾‹" class="headerlink" title="å¼•ä¾‹"></a>å¼•ä¾‹</h4><p><strong>é€€å‡ºä¸å‡ºçš„å¾ªç¯</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> Boolean run = <span class="hljs-keyword">true</span>;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br><span class="hljs-keyword">while</span> (run) &#123;<br><span class="hljs-comment">//å¦‚æœrunä¸ºçœŸï¼Œåˆ™ä¸€ç›´æ‰§è¡Œ</span><br>&#125;<br>&#125;).start();<br><br>Thread.sleep(<span class="hljs-number">1000</span>);<br>System.out.println(<span class="hljs-string">&quot;æ”¹å˜runçš„å€¼ä¸ºfalse&quot;</span>);<br>run = <span class="hljs-keyword">false</span>;<br>&#125; <br></code></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆæ— æ³•é€€å‡ºè¯¥å¾ªç¯</strong></p><ul><li>åˆå§‹çŠ¶æ€ï¼Œ t çº¿ç¨‹åˆšå¼€å§‹ä»<strong>ä¸»å†…å­˜</strong>è¯»å–äº† run çš„å€¼åˆ°<strong>å·¥ä½œå†…å­˜</strong>ã€‚</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145505.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145505.png" alt="img"></a></p><ul><li>å› ä¸º t çº¿ç¨‹è¦é¢‘ç¹ä»ä¸»å†…å­˜ä¸­è¯»å– run çš„å€¼ï¼ŒJIT ç¼–è¯‘å™¨ä¼šå°† run çš„å€¼<strong>ç¼“å­˜è‡³è‡ªå·±å·¥ä½œå†…å­˜</strong>ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­ï¼Œ å‡å°‘å¯¹ä¸»å­˜ä¸­ run çš„è®¿é—®ï¼Œæé«˜æ•ˆç‡</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145517.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145517.png" alt="img"></a></p><ul><li>1 ç§’ä¹‹åï¼Œmain çº¿ç¨‹ä¿®æ”¹äº† run çš„å€¼ï¼Œå¹¶åŒæ­¥è‡³ä¸»å­˜ï¼Œè€Œ t æ˜¯ä»è‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸­è¯»å–è¿™ä¸ªå˜é‡ çš„å€¼ï¼Œç»“æœæ°¸è¿œæ˜¯<strong>æ—§å€¼</strong></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145529.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145529.png" alt="img"></a></p><p><strong>è§£å†³æ–¹æ³•</strong></p><ul><li>ä½¿ç”¨<strong>volatile</strong>æ˜“å˜å…³é”®å­—</li><li>å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°<strong>æˆå‘˜å˜é‡</strong>å’Œ<strong>é™æ€æˆå‘˜å˜é‡</strong>ï¼ˆæ”¾åœ¨ä¸»å­˜ä¸­çš„å˜é‡ï¼‰ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°ä¸»å­˜ä¸­è·å–å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯<strong>ç›´æ¥æ“ä½œä¸»å­˜</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//ä½¿ç”¨æ˜“å˜å…³é”®å­—</span><br><span class="hljs-keyword">volatile</span> <span class="hljs-keyword">static</span> Boolean run = <span class="hljs-keyword">true</span>;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br><span class="hljs-keyword">new</span> Thread(()-&gt;&#123;<br><span class="hljs-keyword">while</span> (run) &#123;<br><span class="hljs-comment">//å¦‚æœrunä¸ºçœŸï¼Œåˆ™ä¸€ç›´æ‰§è¡Œ</span><br>&#125;<br>&#125;).start();<br><br>Thread.sleep(<span class="hljs-number">1000</span>);<br>System.out.println(<span class="hljs-string">&quot;æ”¹å˜runçš„å€¼ä¸ºfalse&quot;</span>);<br>run = <span class="hljs-keyword">false</span>;<br>&#125; <br></code></pre></td></tr></table></figure><h4 id="å¯è§æ€§ä¸åŸå­æ€§"><a href="#å¯è§æ€§ä¸åŸå­æ€§" class="headerlink" title="å¯è§æ€§ä¸åŸå­æ€§"></a>å¯è§æ€§ä¸åŸå­æ€§</h4><p>å‰é¢ä¾‹å­ä½“ç°çš„å®é™…å°±æ˜¯<strong>å¯è§æ€§</strong>ï¼Œå®ƒä¿è¯çš„æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹<strong>volatileå˜é‡</strong>çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ï¼Œ <strong>ä¸èƒ½</strong>ä¿è¯åŸå­æ€§ï¼Œä»…ç”¨åœ¨<strong>ä¸€ä¸ªå†™</strong>çº¿ç¨‹ï¼Œ<strong>å¤šä¸ªè¯»</strong>çº¿ç¨‹çš„æƒ…å†µ</p><ul><li><p>æ³¨æ„ synchronized è¯­å¥å—æ—¢å¯ä»¥ä¿è¯ä»£ç å—çš„<strong>åŸå­æ€§</strong>ï¼Œä¹ŸåŒæ—¶ä¿è¯ä»£ç å—å†…å˜é‡çš„<strong>å¯è§æ€§</strong>ã€‚</p></li><li><p>ä½†ç¼ºç‚¹æ˜¯ synchronized æ˜¯å±äº<strong>é‡é‡çº§</strong>æ“ä½œï¼Œæ€§èƒ½ç›¸å¯¹æ›´ä½ã€‚</p></li><li><p>å¦‚æœåœ¨å‰é¢ç¤ºä¾‹çš„æ­»å¾ªç¯ä¸­åŠ å…¥ System.out.println() ä¼šå‘ç°å³ä½¿ä¸åŠ  volatile ä¿®é¥°ç¬¦ï¼Œçº¿ç¨‹ t ä¹Ÿèƒ½æ­£ç¡®çœ‹åˆ° å¯¹ run å˜é‡çš„ä¿®æ”¹äº†ï¼Œæƒ³ä¸€æƒ³ä¸ºä»€ä¹ˆï¼Ÿ</p><ul><li><p>å› ä¸ºä½¿ç”¨äº†<strong>synchronized</strong>å…³é”®å­—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">println</span><span class="hljs-params">(String x)</span> </span>&#123;<br><span class="hljs-comment">//ä½¿ç”¨äº†synchronizedå…³é”®å­—</span><br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br>            print(x);<br>            newLine();<br>        &#125;<br>    &#125; <br></code></pre></td></tr></table></figure></li></ul></li></ul><h4 id="ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–"><a href="#ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–" class="headerlink" title="ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–"></a>ä¸¤é˜¶ç»ˆæ­¢æ¨¡å¼ä¼˜åŒ–</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test7</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>Monitor monitor = <span class="hljs-keyword">new</span> Monitor();<br>monitor.start();<br>Thread.sleep(<span class="hljs-number">3500</span>);<br>monitor.stop();<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Monitor</span> </span>&#123;<br><br>Thread monitor;<br><span class="hljs-comment">//è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«ç»ˆæ­¢äº†</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">boolean</span> stop = <span class="hljs-keyword">false</span>;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span><br>monitor = <span class="hljs-keyword">new</span> Thread() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//å¼€å§‹ä¸åœçš„ç›‘æ§</span><br><span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br><span class="hljs-keyword">if</span>(stop) &#123;<br>System.out.println(<span class="hljs-string">&quot;å¤„ç†åç»­ä»»åŠ¡&quot;</span>);<br><span class="hljs-keyword">break</span>;<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//çº¿ç¨‹ä¼‘çœ </span><br>Thread.sleep(<span class="hljs-number">1000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>System.out.println(<span class="hljs-string">&quot;è¢«æ‰“æ–­äº†&quot;</span>);<br>&#125;<br>&#125;<br>&#125;<br>&#125;;<br>monitor.start();<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//æ‰“æ–­çº¿ç¨‹</span><br>monitor.interrupt();<br>        <span class="hljs-comment">//ä¿®æ”¹æ ‡è®°</span><br>stop = <span class="hljs-keyword">true</span>;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><h4 id="åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼"><a href="#åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼" class="headerlink" title="åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼"></a>åŒæ­¥æ¨¡å¼ä¹‹çŠ¹è±«æ¨¡å¼</h4><p><strong>å®šä¹‰</strong></p><p>Balking ï¼ˆçŠ¹è±«ï¼‰æ¨¡å¼ç”¨åœ¨ä¸€ä¸ªçº¿ç¨‹å‘ç°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–æœ¬çº¿ç¨‹<strong>å·²ç»åšäº†æŸä¸€ä»¶ç›¸åŒ</strong>çš„äº‹ï¼Œé‚£ä¹ˆæœ¬çº¿ç¨‹å°±æ— éœ€å†åš äº†ï¼Œ<strong>ç›´æ¥ç»“æŸè¿”å›</strong></p><ul><li>ç”¨ä¸€ä¸ªæ ‡è®°æ¥åˆ¤æ–­è¯¥ä»»åŠ¡æ˜¯å¦å·²ç»è¢«æ‰§è¡Œè¿‡äº†</li><li>éœ€è¦é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜<ul><li>åŠ é”çš„ä»£ç å—è¦å°½é‡çš„å°ï¼Œä»¥ä¿è¯æ€§èƒ½</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.nyima.day1;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Chen Panwen</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@data</span> 2020/3/26 16:11</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Test7</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br>Monitor monitor = <span class="hljs-keyword">new</span> Monitor();<br>monitor.start();<br>monitor.start();<br>Thread.sleep(<span class="hljs-number">3500</span>);<br>monitor.stop();<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Monitor</span> </span>&#123;<br><br>Thread monitor;<br><span class="hljs-comment">//è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦è¢«ç»ˆæ­¢äº†</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">boolean</span> stop = <span class="hljs-keyword">false</span>;<br><span class="hljs-comment">//è®¾ç½®æ ‡è®°ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦å·²ç»å¯åŠ¨è¿‡äº†</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> starting = <span class="hljs-keyword">false</span>;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯åŠ¨ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//ä¸Šé”ï¼Œé¿å…å¤šçº¿ç¨‹è¿è¡Œæ—¶å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜</span><br><span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br><span class="hljs-keyword">if</span> (starting) &#123;<br><span class="hljs-comment">//å·²è¢«å¯åŠ¨ï¼Œç›´æ¥è¿”å›</span><br><span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-comment">//å¯åŠ¨ç›‘è§†å™¨ï¼Œæ”¹å˜æ ‡è®°</span><br>starting = <span class="hljs-keyword">true</span>;<br>&#125;<br><span class="hljs-comment">//è®¾ç½®çº¿æ§å™¨çº¿ç¨‹ï¼Œç”¨äºç›‘æ§çº¿ç¨‹çŠ¶æ€</span><br>monitor = <span class="hljs-keyword">new</span> Thread() &#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//å¼€å§‹ä¸åœçš„ç›‘æ§</span><br><span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br><span class="hljs-keyword">if</span>(stop) &#123;<br>System.out.println(<span class="hljs-string">&quot;å¤„ç†åç»­ä»»åŠ¡&quot;</span>);<br><span class="hljs-keyword">break</span>;<br>&#125;<br>System.out.println(<span class="hljs-string">&quot;ç›‘æ§å™¨è¿è¡Œä¸­...&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//çº¿ç¨‹ä¼‘çœ </span><br>Thread.sleep(<span class="hljs-number">1000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>System.out.println(<span class="hljs-string">&quot;è¢«æ‰“æ–­äº†&quot;</span>);<br>&#125;<br>&#125;<br>&#125;<br>&#125;;<br>monitor.start();<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨äºåœæ­¢ç›‘æ§å™¨çº¿ç¨‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//æ‰“æ–­çº¿ç¨‹</span><br>monitor.interrupt();<br>stop = <span class="hljs-keyword">true</span>;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><h2 id="3ã€æœ‰åºæ€§"><a href="#3ã€æœ‰åºæ€§" class="headerlink" title="3ã€æœ‰åºæ€§"></a>3ã€æœ‰åºæ€§</h2><h3 id="æŒ‡ä»¤é‡æ’"><a href="#æŒ‡ä»¤é‡æ’" class="headerlink" title="æŒ‡ä»¤é‡æ’"></a>æŒ‡ä»¤é‡æ’</h3><ul><li>JVM ä¼šåœ¨<strong>ä¸å½±å“æ­£ç¡®æ€§</strong>çš„å‰æä¸‹ï¼Œå¯ä»¥<strong>è°ƒæ•´</strong>è¯­å¥çš„æ‰§è¡Œ<strong>é¡ºåº</strong></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145546.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145546.png" alt="img"></a></p><p>è¿™ç§ç‰¹æ€§ç§°ä¹‹ä¸ºã€<strong>æŒ‡ä»¤é‡æ’</strong>ã€ï¼Œ<strong>å¤šçº¿ç¨‹ä¸‹ã€æŒ‡ä»¤é‡æ’ã€ä¼šå½±å“æ­£ç¡®æ€§</strong>ã€‚</p><h3 id="æŒ‡ä»¤é‡æ’åºä¼˜åŒ–"><a href="#æŒ‡ä»¤é‡æ’åºä¼˜åŒ–" class="headerlink" title="æŒ‡ä»¤é‡æ’åºä¼˜åŒ–"></a>æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</h3><ul><li>äº‹å®ä¸Šï¼Œç°ä»£å¤„ç†å™¨ä¼šè®¾è®¡ä¸ºä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå®Œæˆä¸€æ¡æ‰§è¡Œæ—¶é—´é•¿çš„ CPU æŒ‡ä»¤ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå¯ä»¥æƒ³åˆ°æŒ‡ä»¤è¿˜å¯ä»¥å†åˆ’åˆ†æˆä¸€ä¸ªä¸ªæ›´å°çš„é˜¶æ®µï¼Œä¾‹å¦‚ï¼Œæ¯æ¡æŒ‡ä»¤éƒ½å¯ä»¥åˆ†ä¸ºï¼š <strong>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</strong> è¿™5 ä¸ªé˜¶æ®µ</li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145615.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145615.png" alt="img"></a></p><ul><li><p>åœ¨ä¸æ”¹å˜ç¨‹åºç»“æœçš„å‰æä¸‹ï¼Œè¿™äº›æŒ‡ä»¤çš„å„ä¸ªé˜¶æ®µå¯ä»¥é€šè¿‡<strong>é‡æ’åº</strong>å’Œ<strong>ç»„åˆ</strong>æ¥å®ç°<strong>æŒ‡ä»¤çº§å¹¶è¡Œ</strong></p></li><li><p>æŒ‡ä»¤é‡æ’çš„å‰ææ˜¯ï¼Œé‡æ’æŒ‡ä»¤<strong>ä¸èƒ½å½±å“ç»“æœ</strong>ï¼Œä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¯ä»¥é‡æ’çš„ä¾‹å­ </span><br><span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>; <br><span class="hljs-keyword">int</span> b = <span class="hljs-number">20</span>; <br>System.out.println( a + b );<br><br><span class="hljs-comment">// ä¸èƒ½é‡æ’çš„ä¾‹å­ </span><br><span class="hljs-keyword">int</span> a = <span class="hljs-number">10</span>;<br><span class="hljs-keyword">int</span> b = a - <span class="hljs-number">5</span>; <br></code></pre></td></tr></table></figure></li></ul><h3 id="æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨"><a href="#æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨" class="headerlink" title="æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨"></a>æ”¯æŒæµæ°´çº¿çš„å¤„ç†å™¨</h3><p>ç°ä»£ CPU æ”¯æŒå¤šçº§<strong>æŒ‡ä»¤æµæ°´çº¿</strong>ï¼Œä¾‹å¦‚æ”¯æŒ<strong>åŒæ—¶</strong>æ‰§è¡Œ <strong>å–æŒ‡ä»¤ - æŒ‡ä»¤è¯‘ç  - æ‰§è¡ŒæŒ‡ä»¤ - å†…å­˜è®¿é—® - æ•°æ®å†™å›</strong> çš„å¤„ç†å™¨ï¼Œå°±å¯ä»¥ç§°ä¹‹ä¸ºäº”çº§æŒ‡ä»¤æµæ°´çº¿ã€‚è¿™æ—¶ CPU å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼ŒåŒæ—¶è¿è¡Œäº”æ¡æŒ‡ä»¤çš„ä¸åŒé˜¶æ®µï¼ˆç›¸å½“äºä¸€ æ¡æ‰§è¡Œæ—¶é—´é•¿çš„å¤æ‚æŒ‡ä»¤ï¼‰ï¼ŒIPC = 1ï¼Œæœ¬è´¨ä¸Šï¼Œæµæ°´çº¿æŠ€æœ¯å¹¶ä¸èƒ½ç¼©çŸ­å•æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œä½†å®ƒå˜ç›¸åœ°æé«˜äº†æŒ‡ä»¤åœ°<strong>ååç‡</strong>ã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145602.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145602.png" alt="img"></a></p><p><strong>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼ŒæŒ‡ä»¤é‡æ’åºå¯èƒ½å¯¼è‡´å‡ºç°æ„æ–™ä¹‹å¤–çš„ç»“æœ</strong></p><h3 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h3><p><strong>volatile</strong> ä¿®é¥°çš„å˜é‡ï¼Œå¯ä»¥<strong>ç¦ç”¨</strong>æŒ‡ä»¤é‡æ’</p><ul><li>ç¦æ­¢çš„æ˜¯åŠ volatileå…³é”®å­—å˜é‡ä¹‹å‰çš„ä»£ç è¢«é‡æ’åº</li></ul><h2 id="4ã€å†…å­˜å±éšœ"><a href="#4ã€å†…å­˜å±éšœ" class="headerlink" title="4ã€å†…å­˜å±éšœ"></a>4ã€å†…å­˜å±éšœ</h2><ul><li>å¯è§æ€§<ul><li><strong>å†™å±éšœ</strong>ï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœ<strong>ä¹‹å‰</strong>çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</li><li><strong>è¯»å±éšœ</strong>ï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœ<strong>ä¹‹å</strong>ï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æ–°æ•°æ®</li></ul></li><li>æœ‰åºæ€§<ul><li>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†<strong>å†™å±éšœä¹‹å‰</strong>çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å</li><li>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†<strong>è¯»å±éšœä¹‹å</strong>çš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</li></ul></li></ul><h2 id="5ã€volatile-åŸç†"><a href="#5ã€volatile-åŸç†" class="headerlink" title="5ã€volatile åŸç†"></a>5ã€volatile åŸç†</h2><p>volatileçš„åº•å±‚å®ç°åŸç†æ˜¯<strong>å†…å­˜å±éšœ</strong>ï¼ŒMemory Barrierï¼ˆMemory Fenceï¼‰</p><ul><li>å¯¹ volatile å˜é‡çš„å†™æŒ‡ä»¤åä¼šåŠ å…¥å†™å±éšœ</li><li>å¯¹ volatile å˜é‡çš„è¯»æŒ‡ä»¤å‰ä¼šåŠ å…¥è¯»å±éšœ</li></ul><h3 id="å¦‚ä½•ä¿è¯å¯è§æ€§"><a href="#å¦‚ä½•ä¿è¯å¯è§æ€§" class="headerlink" title="å¦‚ä½•ä¿è¯å¯è§æ€§"></a>å¦‚ä½•ä¿è¯å¯è§æ€§</h3><ul><li><p>å†™å±éšœï¼ˆsfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹å‰çš„ï¼Œå¯¹å…±äº«å˜é‡çš„æ”¹åŠ¨ï¼Œéƒ½åŒæ­¥åˆ°ä¸»å­˜å½“ä¸­</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145630.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145630.png" alt="img"></a></p></li><li><p>è€Œè¯»å±éšœï¼ˆlfenceï¼‰ä¿è¯åœ¨è¯¥å±éšœä¹‹åï¼Œå¯¹å…±äº«å˜é‡çš„è¯»å–ï¼ŒåŠ è½½çš„æ˜¯ä¸»å­˜ä¸­æ–°æ•°æ®</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145713.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145713.png" alt="img"></a></p></li></ul><h3 id="å¦‚ä½•ä¿è¯æœ‰åºæ€§"><a href="#å¦‚ä½•ä¿è¯æœ‰åºæ€§" class="headerlink" title="å¦‚ä½•ä¿è¯æœ‰åºæ€§"></a>å¦‚ä½•ä¿è¯æœ‰åºæ€§</h3><ul><li><p>å†™å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†å†™å±éšœä¹‹å‰çš„ä»£ç æ’åœ¨å†™å±éšœä¹‹å</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145723.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145723.png" alt="img"></a></p></li><li><p>è¯»å±éšœä¼šç¡®ä¿æŒ‡ä»¤é‡æ’åºæ—¶ï¼Œä¸ä¼šå°†è¯»å±éšœä¹‹åçš„ä»£ç æ’åœ¨è¯»å±éšœä¹‹å‰</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145729.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145729.png" alt="img"></a></p></li></ul><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145741.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145741.png" alt="img"></a></p><p><strong>ä½†æ˜¯ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜</strong></p><ul><li>å†™å±éšœä»…ä»…æ˜¯ä¿è¯ä¹‹åçš„è¯»èƒ½å¤Ÿè¯»åˆ°æ–°çš„ç»“æœï¼Œä½†ä¸èƒ½ä¿è¯è¯»è·‘åˆ°å®ƒå‰é¢å»</li><li>è€Œæœ‰åºæ€§çš„ä¿è¯ä¹Ÿåªæ˜¯ä¿è¯äº†<strong>æœ¬çº¿ç¨‹å†…</strong>ç›¸å…³ä»£ç ä¸è¢«é‡æ’åº</li></ul><h3 id="å®ç°åŸç†ä¹‹Lockå‰ç¼€"><a href="#å®ç°åŸç†ä¹‹Lockå‰ç¼€" class="headerlink" title="å®ç°åŸç†ä¹‹Lockå‰ç¼€"></a>å®ç°åŸç†ä¹‹Lockå‰ç¼€</h3><p>åœ¨X86å¤„ç†å™¨ä¸‹é€šè¿‡å·¥å…·è·å–JITç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–æŒ‡ä»¤æ¥æŸ¥çœ‹å¯¹volatileè¿›è¡Œå†™æ“ä½œæ—¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">instance = <span class="hljs-keyword">new</span> Singleton(); <br></code></pre></td></tr></table></figure><p>å¯¹åº”çš„æ±‡ç¼–ä»£ç æ˜¯</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">...</span> lock addl <span class="hljs-string">...</span> <br></code></pre></td></tr></table></figure><p>æœ‰volatileå˜é‡ä¿®é¥°çš„å…±äº«å˜é‡è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ä¼šå¤šå‡ºç¬¬äºŒè¡Œæ±‡ç¼–ä»£ç ï¼Œé€šè¿‡æŸ¥IA-32æ¶æ„è½¯ä»¶å¼€å‘è€…æ‰‹å†Œå¯çŸ¥ï¼Œ<strong>Lockå‰ç¼€</strong>çš„æŒ‡ä»¤åœ¨å¤šæ ¸å¤„ç†å™¨ä¸‹ä¼šå¼•å‘äº†ä¸¤ä»¶äº‹</p><ul><li><p>Lockå‰ç¼€æŒ‡ä»¤ä¼šå¼•èµ·å¤„ç†å™¨</p><p>ç¼“å­˜å›å†™åˆ°å†…å­˜</p><ul><li>Lockå‰ç¼€æŒ‡ä»¤å¯¼è‡´åœ¨æ‰§è¡ŒæŒ‡ä»¤æœŸé—´ï¼Œå£°è¨€å¤„ç†å™¨çš„LOCK#ä¿¡å·ã€‚åœ¨å¤šå¤„ç†å™¨ç¯å¢ƒä¸­ï¼ŒLOCK#ä¿¡å·ç¡®ä¿åœ¨å£°è¨€è¯¥ä¿¡å·æœŸé—´ï¼Œå¤„ç†å™¨å¯ä»¥ç‹¬å ä»»ä½•å…±äº«å†…å­˜ã€‚ä½†æ˜¯ï¼Œåœ¨æœ€è¿‘çš„å¤„ç†å™¨é‡Œï¼ŒLOCK #ä¿¡å·ä¸€èˆ¬ä¸é”æ€»çº¿ï¼Œè€Œæ˜¯<strong>é”ç¼“å­˜</strong>ï¼Œæ¯•ç«Ÿé”æ€»çº¿å¼€é”€çš„æ¯”è¾ƒå¤§ã€‚ä½¿ç”¨ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶æ¥ç¡®ä¿ä¿®æ”¹çš„åŸå­æ€§ï¼Œæ­¤æ“ä½œè¢«ç§°ä¸ºâ€œç¼“å­˜é”å®šâ€ï¼Œ<strong>ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹ç”±ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®</strong></li></ul></li><li><p>ä¸€ä¸ªå¤„ç†å™¨çš„ç¼“å­˜å›å†™åˆ°å†…å­˜ä¼š</p><p>å¯¼è‡´å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜æ— æ•ˆ</p><ul><li>åœ¨å¤šæ ¸å¤„ç†å™¨ç³»ç»Ÿä¸­è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼ŒIA-32å’ŒIntel 64å¤„ç†å™¨èƒ½<strong>å—…æ¢å…¶ä»–å¤„ç†å™¨è®¿é—®ç³»ç»Ÿå†…å­˜å’Œå®ƒä»¬çš„å†…éƒ¨ç¼“å­˜</strong>ã€‚å¤„ç†å™¨ä½¿ç”¨å—…æ¢æŠ€æœ¯ä¿è¯å®ƒçš„å†…éƒ¨ç¼“å­˜ã€ç³»ç»Ÿå†…å­˜å’Œå…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜çš„æ•°æ®åœ¨æ€»çº¿ä¸Šä¿æŒä¸€è‡´</li></ul></li></ul><h3 id="è¡¥å……ï¼šå•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨çš„ä¸€äº›é—®é¢˜"><a href="#è¡¥å……ï¼šå•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨çš„ä¸€äº›é—®é¢˜" class="headerlink" title="è¡¥å……ï¼šå•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨çš„ä¸€äº›é—®é¢˜"></a>è¡¥å……ï¼šå•ä¾‹æ¨¡å¼çº¿ç¨‹å®‰å…¨çš„ä¸€äº›é—®é¢˜</h3><ul><li><p>é¥¿æ±‰</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_2_20210420.png"></p><ul><li>é—®é¢˜ä¸€ï¼šfinalå¯ä»¥é˜²æ­¢å­ç±»ä¸é€‚å½“çš„æ–¹æ³•ç ´åå•ä¾‹</li><li>é—®é¢˜äºŒï¼šï¼ˆè§ä¸Šå›¾ï¼‰åœ¨ååºåˆ—åŒ–ä¸­ï¼Œä¼šæŠŠreadResolveæ–¹æ³•ä¸­çš„å¯¹è±¡ä½œä¸ºååºåˆ—åŒ–ç»“æœï¼Œä¿è¯ååºåˆ—åŒ–åä¾ç„¶æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚</li><li>é—®é¢˜ä¸‰ï¼šç§æœ‰é˜²æ­¢åˆ«äººè°ƒç”¨æ„é€ æ–¹æ³•</li><li>é—®é¢˜å››ï¼šèƒ½ä¿è¯ï¼Œç±»åŠ è½½é˜¶æ®µå®Œæˆåˆå§‹åŒ–ï¼Œjvmä¿è¯çº¿ç¨‹å®‰å…¨</li><li>é—®é¢˜äº”ï¼š<ul><li>æ–¹æ³•æä¾›äº†æ›´å¥½çš„å°è£…æ€§ï¼Œå¯ä»¥å†…éƒ¨å®ç°æ‡’æƒ°åˆå§‹åŒ–</li><li>å¯ä»¥å¯¹åˆ›å»ºå¯¹è±¡åšæ›´å¤šçš„æ§åˆ¶ </li><li>å¯ä»¥æä¾›æ³›å‹çš„æ”¯æŒ</li></ul></li></ul></li><li><p>æšä¸¾</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_3_20210420.png"></p><ul><li>é—®é¢˜ä¸€ï¼šæšä¸¾ä¸­å®šä¹‰çš„å¯¹è±¡ç›¸å½“äºæšä¸¾ç±»çš„é™æ€æˆå‘˜å˜é‡ï¼Œå®šä¹‰æ—¶æœ‰å‡ ä¸ªï¼Œåé¢å°±æœ‰å‡ ä¸ªå¯¹è±¡</li><li>é—®é¢˜äºŒï¼šé™æ€æˆå‘˜å˜é‡ï¼Œç±»åŠ è½½é˜¶æ®µå®Œæˆåˆå§‹åŒ–ï¼Œjvmä¿è¯çº¿ç¨‹å®‰å…¨</li><li>é—®é¢˜ä¸‰ï¼šä¸èƒ½</li><li>é—®é¢˜å››ï¼šå¯ä»¥é¿å…ååºåˆ—ç ´åå•ä¾‹</li><li>é—®é¢˜äº”ï¼šé¥¿æ±‰å¼</li><li>é—®é¢˜å…­ï¼šåŠ ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå†™å…¥ä¸€äº›åˆå§‹åŒ–é€»è¾‘</li></ul></li><li><p>æ‡’æ±‰</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_4_20210420.png"></p><ul><li>é—®é¢˜ï¼šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯é”çš„èŒƒå›´è¿‡å¤§ï¼Œæ¯æ¬¡éƒ½åŠ é”</li></ul></li><li><p>æ‡’æ±‰æ”¹è¿›</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_5_20210420.png"></p><ul><li>é—®é¢˜ä¸€ï¼šé˜²æ­¢synchronizedå†…å‘ç”ŸæŒ‡ä»¤é‡æ’åºï¼Œå…·ä½“å°±æ˜¯ä¿è¯INSTANCE = new Singlenton( )ï¼›ä¸ä¼šå’Œå‰é¢çš„æŒ‡ä»¤å‘ç”Ÿé‡æ’åºï¼ˆå†™å±éšœå®ç°ï¼‰ã€‚</li><li>é—®é¢˜äºŒï¼šç¼©å°äº†åŒæ­¥ä»£ç å—çš„èŒƒå›´ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ä¸Šé”ï¼ˆåŒé‡æ£€æŸ¥ï¼‰</li><li>é—®é¢˜ä¸‰ï¼šé˜²æ­¢é¦–æ¬¡åˆ›å»ºçš„å¹¶å‘é—®é¢˜ï¼ˆé¦–æ¬¡å¤šä¸ªçº¿ç¨‹éƒ½é€šè¿‡äº†ç¬¬ä¸€ä¸ªifï¼‰</li></ul></li><li><p>é™æ€å†…éƒ¨ç±»å®ç°</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_6_20210420.png"></p><ul><li>é—®é¢˜ä¸€ï¼šæ‡’æ±‰</li><li>é—®é¢˜äºŒï¼šæ²¡æœ‰ï¼Œè°ƒç”¨getInstanceæ–¹æ³•è§¦å‘å†…éƒ¨ç±»çš„ç±»åŠ è½½å®Œæˆåˆå§‹åŒ–ï¼Œjvmä¿è¯çº¿ç¨‹å®‰å…¨</li></ul></li></ul><h1 id="äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”"><a href="#äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”" class="headerlink" title="äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”"></a>äº”ã€å…±äº«æ¨¡å‹ä¹‹æ— é”</h1><h2 id="1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"><a href="#1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜" class="headerlink" title="1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜"></a>1ã€æ— é”è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜</h2><ul><li>ä½¿ç”¨<strong>åŸå­æ•´æ•°</strong></li></ul><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">AtomicInteger balance</span> = new AtomicInteger();<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Account</span> </span>&#123;<br><span class="hljs-function">Integer <span class="hljs-title">getBalance</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(Integer amount)</span></span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ     * å¦‚æœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æœåº”å½“æ˜¯ 0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">demo</span><span class="hljs-params">(Account account)</span> </span>&#123;<br>List&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><span class="hljs-keyword">long</span> start = System.nanoTime();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>ts.add(<span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>account.withdraw(<span class="hljs-number">10</span>);<br>&#125;));<br>&#125;<br>ts.forEach(Thread::start);<br>ts.forEach(t -&gt; &#123;<br><span class="hljs-keyword">try</span> &#123;<br>t.join();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;);<br><span class="hljs-keyword">long</span> end = System.nanoTime();<br>System.out.println(account.getBalance() + <span class="hljs-string">&quot; cost: &quot;</span> + (end - start) / <span class="hljs-number">1000_000</span> + <span class="hljs-string">&quot; ms&quot;</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//çº¿ç¨‹ä¸å®‰å…¨çš„åšæ³•</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountUnsafe</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Account</span> </span>&#123;<br><span class="hljs-keyword">private</span> Integer balance;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccountUnsafe</span><span class="hljs-params">(Integer balance)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.balance = balance;<br>&#125;<br><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getBalance</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.balance;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(Integer amount)</span> </span>&#123;<br>balance -= amount;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>Account.demo(<span class="hljs-keyword">new</span> AccountUnsafe(<span class="hljs-number">10000</span>));<br>Account.demo(<span class="hljs-keyword">new</span> AccountCas(<span class="hljs-number">10000</span>));<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//çº¿ç¨‹å®‰å…¨çš„åšæ³•</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccountCas</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Account</span> </span>&#123;<br><span class="hljs-comment">//ä½¿ç”¨åŸå­æ•´æ•°</span><br><span class="hljs-keyword">private</span> AtomicInteger balance;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AccountCas</span><span class="hljs-params">(<span class="hljs-keyword">int</span> balance)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.balance = <span class="hljs-keyword">new</span> AtomicInteger(balance);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getBalance</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">//å¾—åˆ°åŸå­æ•´æ•°çš„å€¼</span><br><span class="hljs-keyword">return</span> balance.get();<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(Integer amount)</span> </span>&#123;<br><span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;<br><span class="hljs-comment">//è·å¾—ä¿®æ”¹å‰çš„å€¼</span><br><span class="hljs-keyword">int</span> prev = balance.get();<br><span class="hljs-comment">//è·å¾—ä¿®æ”¹åçš„å€¼</span><br><span class="hljs-keyword">int</span> next = prev-amount;<br><span class="hljs-comment">//æ¯”è¾ƒå¹¶è®¾å€¼</span><br><span class="hljs-keyword">if</span>(balance.compareAndSet(prev, next)) &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><h2 id="2ã€CASä¸volatile"><a href="#2ã€CASä¸volatile" class="headerlink" title="2ã€CASä¸volatile"></a>2ã€CASä¸volatile</h2><p>å‰é¢çœ‹åˆ°çš„ AtomicInteger çš„è§£å†³æ–¹æ³•ï¼Œå†…éƒ¨å¹¶æ²¡æœ‰ç”¨é”æ¥ä¿æŠ¤å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨ã€‚é‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>å…¶ä¸­çš„<strong>å…³é”®æ˜¯ compareAndSwap</strong>ï¼ˆæ¯”è¾ƒå¹¶è®¾ç½®å€¼ï¼‰ï¼Œå®ƒçš„<strong>ç®€ç§°å°±æ˜¯ CAS</strong> ï¼ˆä¹Ÿæœ‰ Compare And Swap çš„è¯´æ³•ï¼‰ï¼Œå®ƒå¿…é¡»æ˜¯<strong>åŸå­æ“ä½œ</strong>ã€‚</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145914.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145914.png" alt="img"></a></p><h3 id="å·¥ä½œæµç¨‹"><a href="#å·¥ä½œæµç¨‹" class="headerlink" title="å·¥ä½œæµç¨‹"></a><strong>å·¥ä½œæµç¨‹</strong></h3><ul><li>å½“ä¸€ä¸ªçº¿ç¨‹è¦å»ä¿®æ”¹Accountå¯¹è±¡ä¸­çš„å€¼æ—¶ï¼Œå…ˆè·å–å€¼preï¼ˆè°ƒç”¨getæ–¹æ³•ï¼‰ï¼Œç„¶åå†å°†å…¶è®¾ç½®ä¸ºæ–°çš„å€¼nextï¼ˆè°ƒç”¨casæ–¹æ³•ï¼‰ã€‚åœ¨è°ƒç”¨casæ–¹æ³•æ—¶ï¼Œä¼šå°†preä¸Accountä¸­çš„ä½™é¢è¿›è¡Œæ¯”è¾ƒã€‚<ul><li>å¦‚æœ<strong>ä¸¤è€…ç›¸ç­‰</strong>ï¼Œå°±è¯´æ˜è¯¥å€¼è¿˜æœªè¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ï¼Œæ­¤æ—¶ä¾¿å¯ä»¥è¿›è¡Œä¿®æ”¹æ“ä½œã€‚</li><li>å¦‚æœ<strong>ä¸¤è€…ä¸ç›¸ç­‰</strong>ï¼Œå°±ä¸è®¾ç½®å€¼ï¼Œé‡æ–°è·å–å€¼preï¼ˆè°ƒç”¨getæ–¹æ³•ï¼‰ï¼Œç„¶åå†å°†å…¶è®¾ç½®ä¸ºæ–°çš„å€¼nextï¼ˆè°ƒç”¨casæ–¹æ³•ï¼‰ï¼Œç›´åˆ°ä¿®æ”¹æˆåŠŸä¸ºæ­¢ã€‚</li></ul></li></ul><p><strong>æ³¨æ„</strong></p><ul><li>å…¶å® CAS çš„åº•å±‚æ˜¯ <strong>lock cmpxchg</strong> æŒ‡ä»¤ï¼ˆX86 æ¶æ„ï¼‰ï¼Œåœ¨å•æ ¸ CPU å’Œå¤šæ ¸ CPU ä¸‹éƒ½èƒ½å¤Ÿä¿è¯ã€æ¯”è¾ƒ-äº¤æ¢ã€‘çš„<strong>åŸå­æ€§</strong>ã€‚</li><li>åœ¨å¤šæ ¸çŠ¶æ€ä¸‹ï¼ŒæŸä¸ªæ ¸æ‰§è¡Œåˆ°å¸¦ lock çš„æŒ‡ä»¤æ—¶ï¼ŒCPU ä¼šè®©æ€»çº¿é”ä½ï¼Œå½“è¿™ä¸ªæ ¸æŠŠæ­¤æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œå†å¼€å¯æ€»çº¿ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ä¸ä¼šè¢«çº¿ç¨‹çš„è°ƒåº¦æœºåˆ¶æ‰€æ‰“æ–­ï¼Œä¿è¯äº†å¤šä¸ªçº¿ç¨‹å¯¹å†…å­˜æ“ä½œçš„å‡†ç¡®æ€§ï¼Œæ˜¯åŸå­çš„ã€‚</li></ul><h3 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h3><p>è·å–å…±äº«å˜é‡æ—¶ï¼Œä¸ºäº†ä¿è¯è¯¥å˜é‡çš„<strong>å¯è§æ€§</strong>ï¼Œéœ€è¦ä½¿ç”¨ <strong>volatile</strong> ä¿®é¥°ã€‚<br>å®ƒå¯ä»¥ç”¨æ¥ä¿®é¥°æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å˜é‡ï¼Œä»–å¯ä»¥é¿å…çº¿ç¨‹ä»è‡ªå·±çš„å·¥ä½œç¼“å­˜ä¸­æŸ¥æ‰¾å˜é‡çš„å€¼ï¼Œå¿…é¡»åˆ°<strong>ä¸»å­˜ä¸­è·å–</strong> å®ƒçš„å€¼ï¼Œçº¿ç¨‹æ“ä½œ volatile å˜é‡éƒ½æ˜¯ç›´æ¥æ“ä½œä¸»å­˜ã€‚å³ä¸€ä¸ªçº¿ç¨‹å¯¹ volatile å˜é‡çš„ä¿®æ”¹ï¼Œå¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚</p><p><strong>æ³¨æ„</strong></p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">volatile</span> ä»…ä»…ä¿è¯äº†å…±äº«å˜é‡çš„å¯è§æ€§ï¼Œè®©å…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°æ–°å€¼ï¼Œä½†ä¸èƒ½è§£å†³æŒ‡ä»¤äº¤é”™é—®é¢˜ï¼ˆä¸èƒ½ä¿è¯åŸå­æ€§ï¼‰ <br></code></pre></td></tr></table></figure><p><strong>CAS å¿…é¡»å€ŸåŠ© volatile</strong> æ‰èƒ½è¯»å–åˆ°å…±äº«å˜é‡çš„æ–°å€¼æ¥å®ç°ã€æ¯”è¾ƒå¹¶äº¤æ¢ã€‘çš„æ•ˆæœ</p><h3 id="æ•ˆç‡é—®é¢˜"><a href="#æ•ˆç‡é—®é¢˜" class="headerlink" title="æ•ˆç‡é—®é¢˜"></a>æ•ˆç‡é—®é¢˜</h3><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ— é”æ¯”ä½¿ç”¨åŠ é”çš„<strong>æ•ˆç‡æ›´é«˜ã€‚</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145931.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145931.png" alt="img"></a></p><p><strong>åŸå› </strong></p><h3 id="CASç‰¹ç‚¹"><a href="#CASç‰¹ç‚¹" class="headerlink" title="CASç‰¹ç‚¹"></a>CASç‰¹ç‚¹</h3><p>ç»“åˆ CAS å’Œ volatile å¯ä»¥å®ç°<strong>æ— é”å¹¶å‘</strong>ï¼Œé€‚ç”¨äº<strong>çº¿ç¨‹æ•°å°‘ã€å¤šæ ¸ CPU</strong> çš„åœºæ™¯ä¸‹ã€‚</p><ul><li><p>CAS æ˜¯åŸºäº<strong>ä¹è§‚é”</strong>çš„æ€æƒ³ï¼šä¹è§‚çš„ä¼°è®¡ï¼Œä¸æ€•åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œå°±ç®—æ”¹äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘åƒäºç‚¹å†é‡è¯•å‘—ã€‚</p></li><li><p>synchronized æ˜¯åŸºäºæ‚²è§‚é”çš„æ€æƒ³ï¼šæ‚²è§‚çš„ä¼°è®¡ï¼Œå¾—é˜²ç€å…¶å®ƒçº¿ç¨‹æ¥ä¿®æ”¹å…±äº«å˜é‡ï¼Œæˆ‘ä¸Šäº†é”ä½ ä»¬éƒ½åˆ«æƒ³æ”¹ï¼Œæˆ‘æ”¹å®Œäº†è§£å¼€é”ï¼Œä½ ä»¬æ‰æœ‰æœºä¼šã€‚</p></li><li><p>CAS ä½“ç°çš„æ˜¯</p><p>æ— é”å¹¶å‘ã€æ— é˜»å¡å¹¶å‘</p><p>ï¼Œè¯·ä»”ç»†ä½“ä¼šè¿™ä¸¤å¥è¯çš„æ„æ€</p><ul><li>å› ä¸ºæ²¡æœ‰ä½¿ç”¨ synchronizedï¼Œæ‰€ä»¥çº¿ç¨‹ä¸ä¼šé™·å…¥é˜»å¡ï¼Œè¿™æ˜¯æ•ˆç‡æå‡çš„å› ç´ ä¹‹ä¸€</li><li>ä½†å¦‚æœç«äº‰æ¿€çƒˆï¼Œå¯ä»¥æƒ³åˆ°é‡è¯•å¿…ç„¶é¢‘ç¹å‘ç”Ÿï¼Œåè€Œæ•ˆç‡ä¼šå—å½±å“</li></ul></li></ul><h2 id="3ã€åŸå­æ•´æ•°"><a href="#3ã€åŸå­æ•´æ•°" class="headerlink" title="3ã€åŸå­æ•´æ•°"></a>3ã€åŸå­æ•´æ•°</h2><p>J.U.C å¹¶å‘åŒ…æä¾›äº†</p><ul><li>AtomicBoolean</li><li>AtomicInteger</li><li>AtomicLong</li></ul><p><strong>ä»¥ AtomicInteger ä¸ºä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"> AtomicInteger i = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);<br> <br><span class="hljs-comment">// è·å–å¹¶è‡ªå¢ï¼ˆi = 0, ç»“æœ i = 1, è¿”å› 0ï¼‰ï¼Œç±»ä¼¼äº i++ System.out.println(i.getAndIncrement());</span><br> <br><span class="hljs-comment">// è‡ªå¢å¹¶è·å–ï¼ˆi = 1, ç»“æœ i = 2, è¿”å› 2ï¼‰ï¼Œç±»ä¼¼äº ++i System.out.println(i.incrementAndGet());</span><br> <br><span class="hljs-comment">// è‡ªå‡å¹¶è·å–ï¼ˆi = 2, ç»“æœ i = 1, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº --i System.out.println(i.decrementAndGet());</span><br> <br><span class="hljs-comment">// è·å–å¹¶è‡ªå‡ï¼ˆi = 1, ç»“æœ i = 0, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº i--</span><br>System.out.println(i.getAndDecrement());<br> <br><span class="hljs-comment">// è·å–å¹¶åŠ å€¼ï¼ˆi = 0, ç»“æœ i = 5, è¿”å› 0ï¼‰ </span><br>System.out.println(i.getAndAdd(<span class="hljs-number">5</span>));<br> <br><span class="hljs-comment">// åŠ å€¼å¹¶è·å–ï¼ˆi = 5, ç»“æœ i = 0, è¿”å› 0ï¼‰ </span><br>System.out.println(i.addAndGet(-<span class="hljs-number">5</span>));<br> <br><span class="hljs-comment">// è·å–å¹¶æ›´æ–°ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = -2, è¿”å› 0ï¼‰ </span><br><span class="hljs-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ </span><br>System.out.println(i.getAndUpdate(p -&gt; p - <span class="hljs-number">2</span>));<br> <br><span class="hljs-comment">// æ›´æ–°å¹¶è·å–ï¼ˆi = -2, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = 0, è¿”å› 0ï¼‰</span><br><span class="hljs-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ </span><br>System.out.println(i.updateAndGet(p -&gt; p + <span class="hljs-number">2</span>));<br> <br><span class="hljs-comment">// è·å–å¹¶è®¡ç®—ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 10, è¿”å› 0ï¼‰ </span><br><span class="hljs-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨ // getAndUpdate å¦‚æœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„ </span><br><span class="hljs-comment">// getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ </span><br><span class="hljs-keyword">final</span> System.out.println(i.getAndAccumulate(<span class="hljs-number">10</span>, (p, x) -&gt; p + x));<br> <br><span class="hljs-comment">// è®¡ç®—å¹¶è·å–ï¼ˆi = 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 0, è¿”å› 0ï¼‰ </span><br><span class="hljs-comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span><br>System.out.println(i.accumulateAndGet(-<span class="hljs-number">10</span>, (p, x) -&gt; p + x)); <br></code></pre></td></tr></table></figure><h2 id="4ã€åŸå­å¼•ç”¨"><a href="#4ã€åŸå­å¼•ç”¨" class="headerlink" title="4ã€åŸå­å¼•ç”¨"></a>4ã€åŸå­å¼•ç”¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DecimalAccount</span> </span>&#123;<br><span class="hljs-function">BigDecimal <span class="hljs-title">getBalance</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(BigDecimal amount)</span></span>;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ    </span><br><span class="hljs-comment">     * å¦‚æœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æœåº”å½“æ˜¯ 0</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">demo</span><span class="hljs-params">(DecimalAccountImpl account)</span> </span>&#123;<br>List&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br><span class="hljs-keyword">long</span> start = System.nanoTime();<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) &#123;<br>ts.add(<span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>account.withdraw(BigDecimal.TEN);<br>&#125;));<br>&#125;<br>ts.forEach(Thread::start);<br>ts.forEach(t -&gt; &#123;<br><span class="hljs-keyword">try</span> &#123;<br>t.join();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br>&#125;);<br><span class="hljs-keyword">long</span> end = System.nanoTime();<br>System.out.println(account.getBalance() + <span class="hljs-string">&quot; cost: &quot;</span> + (end - start) / <span class="hljs-number">1000_000</span> + <span class="hljs-string">&quot; ms&quot;</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DecimalAccountImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">DecimalAccount</span> </span>&#123;<br><span class="hljs-comment">//åŸå­å¼•ç”¨ï¼Œæ³›å‹ç±»å‹ä¸ºå°æ•°ç±»å‹</span><br>AtomicReference&lt;BigDecimal&gt; balance;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DecimalAccountImpl</span><span class="hljs-params">(BigDecimal balance)</span> </span>&#123;<br><span class="hljs-keyword">this</span>.balance = <span class="hljs-keyword">new</span> AtomicReference&lt;BigDecimal&gt;(balance);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> BigDecimal <span class="hljs-title">getBalance</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> balance.get();<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">withdraw</span><span class="hljs-params">(BigDecimal amount)</span> </span>&#123;<br><span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;<br>BigDecimal pre = balance.get();<br>BigDecimal next = pre.subtract(amount);<br><span class="hljs-keyword">if</span>(balance.compareAndSet(pre, next)) &#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>DecimalAccount.demo(<span class="hljs-keyword">new</span> DecimalAccountImpl(<span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-string">&quot;10000&quot;</span>)));<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><h2 id="5ã€ABAé—®é¢˜"><a href="#5ã€ABAé—®é¢˜" class="headerlink" title="5ã€ABAé—®é¢˜"></a>5ã€ABAé—®é¢˜</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br><span class="hljs-keyword">static</span> AtomicReference&lt;String&gt; str = <span class="hljs-keyword">new</span> AtomicReference&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>);<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>String pre = str.get();<br>System.out.println(<span class="hljs-string">&quot;change&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br>other();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">1000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-comment">//æŠŠsträ¸­çš„Aæ”¹ä¸ºC</span><br>System.out.println(<span class="hljs-string">&quot;change A-&gt;C &quot;</span> + str.compareAndSet(pre, <span class="hljs-string">&quot;C&quot;</span>));<br>&#125;).start();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br><span class="hljs-keyword">new</span> Thread(()-&gt; &#123;<br>System.out.println(<span class="hljs-string">&quot;change A-&gt;B &quot;</span> + str.compareAndSet(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>));<br>&#125;).start();<br>Thread.sleep(<span class="hljs-number">500</span>);<br><span class="hljs-keyword">new</span> Thread(()-&gt; &#123;<br>System.out.println(<span class="hljs-string">&quot;change B-&gt;A &quot;</span> + str.compareAndSet(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;A&quot;</span>));<br>&#125;).start();<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145952.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608145952.png" alt="img"></a></p><p>ä¸»çº¿ç¨‹ä»…èƒ½åˆ¤æ–­å‡ºå…±äº«å˜é‡çš„å€¼ä¸åˆå€¼ A <strong>æ˜¯å¦ç›¸åŒ</strong>ï¼Œä¸èƒ½æ„ŸçŸ¥åˆ°è¿™ç§ä» A æ”¹ä¸º B åˆ æ”¹å› A çš„æƒ…å†µï¼Œå¦‚æœä¸»çº¿ç¨‹å¸Œæœ›ï¼š<br>åªè¦æœ‰å…¶å®ƒçº¿ç¨‹ã€<strong>åŠ¨è¿‡äº†</strong>ã€‘å…±äº«å˜é‡ï¼Œé‚£ä¹ˆè‡ªå·±çš„ <strong>cas å°±ç®—å¤±è´¥</strong>ï¼Œè¿™æ—¶ï¼Œä»…æ¯”è¾ƒå€¼æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦å†åŠ ä¸€ä¸ª<strong>ç‰ˆæœ¬å·</strong></p><h3 id="AtomicStampedReference"><a href="#AtomicStampedReference" class="headerlink" title="AtomicStampedReference"></a><strong>AtomicStampedReference</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo3</span> </span>&#123;<br><span class="hljs-comment">//æŒ‡å®šç‰ˆæœ¬å·</span><br><span class="hljs-keyword">static</span> AtomicStampedReference&lt;String&gt; str = <span class="hljs-keyword">new</span> AtomicStampedReference&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-number">0</span>);<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>String pre = str.getReference();<br><span class="hljs-comment">//è·å¾—ç‰ˆæœ¬å·</span><br><span class="hljs-keyword">int</span> stamp = str.getStamp();<br>System.out.println(<span class="hljs-string">&quot;change&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br>other();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">1000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-comment">//æŠŠsträ¸­çš„Aæ”¹ä¸ºC,å¹¶æ¯”å¯¹ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ç›¸åŒï¼Œå°±æ‰§è¡Œæ›¿æ¢ï¼Œå¹¶è®©ç‰ˆæœ¬å·+1</span><br>System.out.println(<span class="hljs-string">&quot;change A-&gt;C stamp &quot;</span> + stamp + str.compareAndSet(pre, <span class="hljs-string">&quot;C&quot;</span>, stamp, stamp+<span class="hljs-number">1</span>));<br>&#125;).start();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br><span class="hljs-keyword">new</span> Thread(()-&gt; &#123;<br><span class="hljs-keyword">int</span> stamp = str.getStamp();<br>System.out.println(<span class="hljs-string">&quot;change A-&gt;B stamp &quot;</span> + stamp + str.compareAndSet(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, stamp, stamp+<span class="hljs-number">1</span>));<br>&#125;).start();<br>Thread.sleep(<span class="hljs-number">500</span>);<br><span class="hljs-keyword">new</span> Thread(()-&gt; &#123;<br><span class="hljs-keyword">int</span> stamp = str.getStamp();<br>System.out.println(<span class="hljs-string">&quot;change B-&gt;A stamp &quot;</span> + stamp +  str.compareAndSet(<span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;A&quot;</span>, stamp, stamp+<span class="hljs-number">1</span>));<br>&#125;).start();<br>&#125;<br>&#125; <br></code></pre></td></tr></table></figure><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150003.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150003.png" alt="img"></a></p><h3 id="AtomicMarkableReference"><a href="#AtomicMarkableReference" class="headerlink" title="AtomicMarkableReference"></a>AtomicMarkableReference</h3><p>AtomicStampedReference å¯ä»¥ç»™åŸå­å¼•ç”¨åŠ ä¸Šç‰ˆæœ¬å·ï¼Œè¿½è¸ªåŸå­å¼•ç”¨æ•´ä¸ªçš„å˜åŒ–è¿‡ç¨‹ï¼Œå¦‚ï¼š A -&gt; B -&gt; A -&gt; C ï¼Œé€šè¿‡AtomicStampedReferenceï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¼•ç”¨å˜é‡ä¸­é€”è¢«æ›´æ”¹äº†å‡ æ¬¡ã€‚<br>ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå¹¶ä¸å…³å¿ƒå¼•ç”¨å˜é‡æ›´æ”¹äº†å‡ æ¬¡ï¼Œåªæ˜¯å•çº¯çš„å…³å¿ƒ<strong>æ˜¯å¦æ›´æ”¹è¿‡</strong>ï¼Œæ‰€ä»¥å°±æœ‰äº† <strong>AtomicMarkableReference</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo4</span> </span>&#123;<br><span class="hljs-comment">//æŒ‡å®šç‰ˆæœ¬å·</span><br><span class="hljs-keyword">static</span> AtomicMarkableReference&lt;String&gt; str = <span class="hljs-keyword">new</span> AtomicMarkableReference&lt;&gt;(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-keyword">true</span>);<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>String pre = str.getReference();<br>System.out.println(<span class="hljs-string">&quot;change&quot;</span>);<br><span class="hljs-keyword">try</span> &#123;<br>other();<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">1000</span>);<br>&#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>e.printStackTrace();<br>&#125;<br><span class="hljs-comment">//æŠŠsträ¸­çš„Aæ”¹ä¸ºC,å¹¶æ¯”å¯¹ç‰ˆæœ¬å·ï¼Œå¦‚æœç‰ˆæœ¬å·ç›¸åŒï¼Œå°±æ‰§è¡Œæ›¿æ¢ï¼Œå¹¶è®©ç‰ˆæœ¬å·+1</span><br>System.out.println(<span class="hljs-string">&quot;change A-&gt;C mark &quot;</span> +  str.compareAndSet(pre, <span class="hljs-string">&quot;C&quot;</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>));<br>&#125;).start();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">other</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException </span>&#123;<br><span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>System.out.println(<span class="hljs-string">&quot;change A-&gt;A mark &quot;</span> + str.compareAndSet(<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>));<br>&#125;).start();<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150017.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150017.png" alt="img"></a></p><h3 id="ä¸¤è€…çš„åŒºåˆ«"><a href="#ä¸¤è€…çš„åŒºåˆ«" class="headerlink" title="ä¸¤è€…çš„åŒºåˆ«"></a>ä¸¤è€…çš„åŒºåˆ«</h3><ul><li><strong>AtomicStampedReference</strong> éœ€è¦æˆ‘ä»¬ä¼ å…¥<strong>æ•´å‹å˜é‡</strong>ä½œä¸ºç‰ˆæœ¬å·ï¼Œæ¥åˆ¤å®šæ˜¯å¦è¢«æ›´æ”¹è¿‡</li><li><strong>AtomicMarkableReference</strong>éœ€è¦æˆ‘ä»¬ä¼ å…¥<strong>å¸ƒå°”å˜é‡</strong>ä½œä¸ºæ ‡è®°ï¼Œæ¥åˆ¤æ–­æ˜¯å¦è¢«æ›´æ”¹è¿‡</li></ul><h2 id="6ã€åŸå­æ•°ç»„"><a href="#6ã€åŸå­æ•°ç»„" class="headerlink" title="6ã€åŸå­æ•°ç»„"></a>6ã€åŸå­æ•°ç»„</h2><ul><li>AtomicIntegerArray</li><li>AtomicLongArray</li><li>AtomicReferenceArray</li></ul><h3 id="lambaè¡¨è¾¾å¼çš„ä½¿ç”¨"><a href="#lambaè¡¨è¾¾å¼çš„ä½¿ç”¨" class="headerlink" title="lambaè¡¨è¾¾å¼çš„ä½¿ç”¨"></a>lambaè¡¨è¾¾å¼çš„ä½¿ç”¨</h3><ul><li>æä¾›è€…<ul><li>æ— å‚åˆè¿”å›</li><li>()-&gt;è¿”å›ç»“æœ</li></ul></li><li>æ–¹æ³•<ul><li>æœ‰å‚æœ‰è¿”å›</li><li>(å‚æ•°ä¸€â€¦)-&gt;è¿”å›ç»“æœ</li></ul></li><li>æ¶ˆè´¹è€…<ul><li>æœ‰å‚æ— è¿”å›</li><li>(å‚æ•°ä¸€â€¦)-&gt;void</li></ul></li></ul><h2 id="7ã€åŸå­æ›´æ–°å™¨"><a href="#7ã€åŸå­æ›´æ–°å™¨" class="headerlink" title="7ã€åŸå­æ›´æ–°å™¨"></a>7ã€åŸå­æ›´æ–°å™¨</h2><ul><li>AtomicReferenceFieldUpdater // åŸŸ å­—æ®µ</li><li>AtomicIntegerFieldUpdater</li><li>AtomicLongFieldUpdate</li></ul><p>åŸå­æ›´æ–°å™¨ç”¨äºå¸®åŠ©æˆ‘ä»¬æ”¹å˜æŸä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      Student student = <span class="hljs-keyword">new</span> Student();<br>       <br>      <span class="hljs-comment">// è·å¾—åŸå­æ›´æ–°å™¨</span><br>      <span class="hljs-comment">// æ³›å‹</span><br>      <span class="hljs-comment">// å‚æ•°1 æŒæœ‰å±æ€§çš„ç±» å‚æ•°2 è¢«æ›´æ–°çš„å±æ€§çš„ç±»</span><br>      <span class="hljs-comment">// newUpdaterä¸­çš„å‚æ•°ï¼šç¬¬ä¸‰ä¸ªä¸ºå±æ€§çš„åç§°</span><br>      AtomicReferenceFieldUpdater&lt;Student, String&gt; updater = AtomicReferenceFieldUpdater.newUpdater(Student.class, String.class, <span class="hljs-string">&quot;name&quot;</span>);<br>       <br>      <span class="hljs-comment">// ä¿®æ”¹</span><br>      updater.compareAndSet(student, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;Nyima&quot;</span>);<br>      System.out.println(student);<br>   &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;<br>   <span class="hljs-keyword">volatile</span> String name;<br><br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Student&#123;&quot;</span> +<br>            <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>            <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹"><a href="#åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹"></a>åŸå­æ›´æ–°å™¨åˆå§‹åŒ–è¿‡ç¨‹</h3><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼ŒåŸå­æ›´æ–°å™¨æ˜¯é€šè¿‡newUpdateræ¥è·å–å®ä¾‹çš„ã€‚å…¶ä¸­ä¼ å…¥äº†ä¸‰ä¸ªå‚æ•°</p><ul><li>æ‹¥æœ‰å±æ€§çš„ç±»çš„Class</li><li>å±æ€§çš„Class</li><li>å±æ€§çš„åç§°</li></ul><p>å¤§æ¦‚å¯ä»¥çŒœå‡ºæ¥ï¼Œ<strong>åˆå§‹åŒ–è¿‡ç¨‹ç”¨åˆ°äº†åå°„</strong>ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æºç æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªçŒœæµ‹ã€‚</p><h4 id="newUpdateræ–¹æ³•"><a href="#newUpdateræ–¹æ³•" class="headerlink" title="newUpdateræ–¹æ³•"></a>newUpdateræ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;U,W&gt; <span class="hljs-function">AtomicReferenceFieldUpdater&lt;U,W&gt; <span class="hljs-title">newUpdater</span><span class="hljs-params">(Class&lt;U&gt; tclass,</span></span><br><span class="hljs-function"><span class="hljs-params">                                                                Class&lt;W&gt; vclass,</span></span><br><span class="hljs-function"><span class="hljs-params">                                                                String fieldName)</span> </span>&#123;<br>    <span class="hljs-comment">// è¿”å›äº†ä¸€ä¸ªAtomicReferenceFieldUpdaterImplå®ä¾‹</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AtomicReferenceFieldUpdaterImpl&lt;U,W&gt;<br>        (tclass, vclass, fieldName, Reflection.getCallerClass());<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»newUpdateræ–¹æ³•è¿˜å¹¶ä¸èƒ½çœ‹å‡ºæ¥å…·ä½“çš„åˆå§‹åŒ–è¿‡ç¨‹</p><h4 id="å†…éƒ¨å®ç°ç±»"><a href="#å†…éƒ¨å®ç°ç±»" class="headerlink" title="å†…éƒ¨å®ç°ç±»"></a>å†…éƒ¨å®ç°ç±»</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145006.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145006.png" alt="img"></a></p><p>AtomicReferenceFieldUpdaterä¸ºæŠ½è±¡ç±»ï¼Œè¯¥ç±»<strong>å†…éƒ¨æœ‰ä¸€ä¸ªè‡ªå·±çš„å®ç°ç±»AtomicReferenceFieldUpdaterImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AtomicReferenceFieldUpdaterImpl</span>&lt;<span class="hljs-title">T</span>,<span class="hljs-title">V</span>&gt;</span><br><span class="hljs-class">        <span class="hljs-keyword">extends</span> <span class="hljs-title">AtomicReferenceFieldUpdater</span>&lt;<span class="hljs-title">T</span>,<span class="hljs-title">V</span>&gt;</span><br></code></pre></td></tr></table></figure><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201020145119.png" alt="img"></a></p><p><strong>æ„é€ æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java">AtomicReferenceFieldUpdaterImpl(<span class="hljs-keyword">final</span> Class&lt;T&gt; tclass,<br>                                <span class="hljs-keyword">final</span> Class&lt;V&gt; vclass,<br>                                <span class="hljs-keyword">final</span> String fieldName,<br>                                <span class="hljs-keyword">final</span> Class&lt;?&gt; caller) &#123;<br>    <span class="hljs-comment">// ç”¨äºä¿å­˜è¦è¢«ä¿®æ”¹çš„å±æ€§</span><br>    <span class="hljs-keyword">final</span> Field field;<br>    <br>    <span class="hljs-comment">// å±æ€§çš„Class</span><br>    <span class="hljs-keyword">final</span> Class&lt;?&gt; fieldClass;<br>    <br>    <span class="hljs-comment">// fieldçš„ä¿®é¥°ç¬¦</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> modifiers;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// åå°„è·å¾—å±æ€§</span><br>        field = AccessController.doPrivileged(<br>            <span class="hljs-keyword">new</span> PrivilegedExceptionAction&lt;Field&gt;() &#123;<br>                <span class="hljs-function"><span class="hljs-keyword">public</span> Field <span class="hljs-title">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> NoSuchFieldException </span>&#123;<br>                    <span class="hljs-comment">// tclassä¸ºä¼ å…¥çš„å±æ€§çš„Classï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è·å¾—å±æ€§</span><br>                    <span class="hljs-keyword">return</span> tclass.getDeclaredField(fieldName);<br>                &#125;<br>            &#125;);<br>        <br>        <span class="hljs-comment">// è·å¾—å±æ€§çš„ä¿®é¥°ç¬¦ï¼Œä¸»è¦ç”¨äºåˆ¤æ–­</span><br>        <span class="hljs-comment">// 1ã€vclass ä¸ å±æ€§ç¡®åˆ‡çš„ç±»å‹æ˜¯å¦åŒ¹é…</span><br>        <span class="hljs-comment">// 2ã€æ˜¯å¦ä¸ºå¼•ç”¨ç±»å‹</span><br>        <span class="hljs-comment">// 3ã€è¢«ä¿®æ”¹çš„å±æ€§æ˜¯å¦åŠ äº†volatileå…³é”®å­—</span><br>        modifiers = field.getModifiers();<br>        sun.reflect.misc.ReflectUtil.ensureMemberAccess(<br>            caller, tclass, <span class="hljs-keyword">null</span>, modifiers);<br>        ClassLoader cl = tclass.getClassLoader();<br>        ClassLoader ccl = caller.getClassLoader();<br>        <span class="hljs-keyword">if</span> ((ccl != <span class="hljs-keyword">null</span>) &amp;&amp; (ccl != cl) &amp;&amp;<br>            ((cl == <span class="hljs-keyword">null</span>) || !isAncestor(cl, ccl))) &#123;<br>            sun.reflect.misc.ReflectUtil.checkPackageAccess(tclass);<br>        &#125;<br>        <br>        <span class="hljs-comment">// è·å¾—å±æ€§ç±»çš„Class</span><br>        fieldClass = field.getType();<br>    &#125; <span class="hljs-keyword">catch</span> (PrivilegedActionException pae) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(pae.getException());<br>    &#125; <span class="hljs-keyword">catch</span> (Exception ex) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(ex);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (vclass != fieldClass)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ClassCastException();<br>    <span class="hljs-keyword">if</span> (vclass.isPrimitive())<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Must be reference type&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (!Modifier.isVolatile(modifiers))<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">&quot;Must be volatile type&quot;</span>);<br><br>    <span class="hljs-comment">// Access to protected field members is restricted to receivers only</span><br>    <span class="hljs-comment">// of the accessing class, or one of its subclasses, and the</span><br>    <span class="hljs-comment">// accessing class must in turn be a subclass (or package sibling)</span><br>    <span class="hljs-comment">// of the protected member&#x27;s defining class.</span><br>    <span class="hljs-comment">// If the updater refers to a protected field of a declaring class</span><br>    <span class="hljs-comment">// outside the current package, the receiver argument will be</span><br>    <span class="hljs-comment">// narrowed to the type of the accessing class.</span><br> <span class="hljs-comment">// å¯¹ç±»ä¸­çš„å±æ€§è¿›è¡Œåˆå§‹åŒ–</span><br>    <span class="hljs-keyword">this</span>.cclass = (Modifier.isProtected(modifiers) &amp;&amp;<br>                   tclass.isAssignableFrom(caller) &amp;&amp;<br>                   !isSamePackage(tclass, caller))<br>                  ? caller : tclass;<br>    <span class="hljs-keyword">this</span>.tclass = tclass;<br>    <span class="hljs-keyword">this</span>.vclass = vclass;<br>    <span class="hljs-comment">// è·å¾—åç§»é‡</span><br>    <span class="hljs-keyword">this</span>.offset = U.objectFieldOffset(field);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å¯ä»¥çœ‹å‡ºï¼ŒåŸå­å¼•ç”¨æ›´æ–°å™¨ç¡®å®ä½¿ç”¨äº†åå°„</strong></p><h2 id="8ã€LongAdderåŸç†"><a href="#8ã€LongAdderåŸç†" class="headerlink" title="8ã€LongAdderåŸç†"></a>8ã€LongAdderåŸç†</h2><h3 id="ç´¯åŠ å™¨æ€§èƒ½æ¯”è¾ƒ"><a href="#ç´¯åŠ å™¨æ€§èƒ½æ¯”è¾ƒ" class="headerlink" title="ç´¯åŠ å™¨æ€§èƒ½æ¯”è¾ƒ"></a>ç´¯åŠ å™¨æ€§èƒ½æ¯”è¾ƒ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">demo</span><span class="hljs-params">(Supplier&lt;T&gt; adderSupplier, Consumer&lt;T&gt; action)</span> </span>&#123;<br>    T adder = adderSupplier.get();<br>    <span class="hljs-keyword">long</span> start = System.nanoTime();<br>    List&lt;Thread&gt; ts = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>    <span class="hljs-comment">// 4 ä¸ªçº¿ç¨‹ï¼Œæ¯äººç´¯åŠ  50 ä¸‡</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) &#123;<br>        ts.add(<span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">500000</span>; j++) &#123;<br>            action.accept(adder);<br>            &#125;<br>        &#125;));<br>    &#125;<br>    ts.forEach(t -&gt; t.start());<br>    ts.forEach(t -&gt; &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            t.join();<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        &#125;);<br>    <span class="hljs-keyword">long</span> end = System.nanoTime();<br>    System.out.println(adder + <span class="hljs-string">&quot; cost:&quot;</span> + (end - start)/<span class="hljs-number">1000_000</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¯”è¾ƒAtomicLong ä¸ LongAdder</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>demo(() -&gt; <span class="hljs-keyword">new</span> LongAdder(), adder -&gt; adder.increment());<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>demo(() -&gt; <span class="hljs-keyword">new</span> AtomicLong(), adder -&gt; adder.getAndIncrement());<br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">43</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">9</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">7</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">7</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">7</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">31</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">27</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">28</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">24</span><br><span class="hljs-symbol">1000000 </span>cost:<span class="hljs-number">22</span><br></code></pre></td></tr></table></figure><p>æ€§èƒ½æå‡çš„åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æœ‰ç«äº‰æ—¶ï¼Œè®¾ç½®å¤šä¸ªç´¯åŠ å•å…ƒï¼ŒTherad-0 ç´¯åŠ  Cell[0]ï¼Œè€Œ Thread-1 ç´¯åŠ Cell[1]â€¦ æœ€åå°†ç»“æœæ±‡æ€»ã€‚è¿™æ ·å®ƒä»¬åœ¨ç´¯åŠ æ—¶æ“ä½œçš„ä¸åŒçš„ Cell å˜é‡ï¼Œå› æ­¤å‡å°‘äº† CAS é‡è¯•å¤±è´¥ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p><h3 id="æºç ä¹‹LongAdder"><a href="#æºç ä¹‹LongAdder" class="headerlink" title="æºç ä¹‹LongAdder"></a>æºç ä¹‹LongAdder</h3><p>LongAdder æ˜¯å¹¶å‘å¤§å¸ˆ @author Doug Lea ï¼ˆå¤§å“¥æï¼‰çš„ä½œå“ï¼Œè®¾è®¡çš„éå¸¸ç²¾å·§<br>LongAdder ç±»æœ‰å‡ ä¸ªå…³é”®åŸŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç´¯åŠ å•å…ƒæ•°ç»„, æ‡’æƒ°åˆå§‹åŒ–</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> Cell[] cells;<br><br><span class="hljs-comment">// åŸºç¡€å€¼, å¦‚æœæ²¡æœ‰ç«äº‰, åˆ™ç”¨ cas ç´¯åŠ è¿™ä¸ªåŸŸ</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">long</span> base;<br><br><span class="hljs-comment">// åœ¨ cells åˆ›å»ºæˆ–æ‰©å®¹æ—¶, ç½®ä¸º 1, è¡¨ç¤ºåŠ é”</span><br><span class="hljs-keyword">transient</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">int</span> cellsBusy;<br></code></pre></td></tr></table></figure><p>casé”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸è¦ç”¨äºå®è·µï¼ï¼ï¼</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LockCas</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> AtomicInteger state = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">lock</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>            <span class="hljs-keyword">if</span> (state.compareAndSet(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">unlock</span><span class="hljs-params">()</span> </span>&#123;<br>        log.debug(<span class="hljs-string">&quot;unlock...&quot;</span>);<br>        state.set(<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åŸç†ä¹‹ä¼ªå…±äº«"><a href="#åŸç†ä¹‹ä¼ªå…±äº«" class="headerlink" title="åŸç†ä¹‹ä¼ªå…±äº«"></a>åŸç†ä¹‹ä¼ªå…±äº«</h3><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150037.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150037.png" alt="img"></a></p><p>ç¼“å­˜è¡Œä¼ªå…±äº«å¾—ä»ç¼“å­˜è¯´èµ·<br>ç¼“å­˜ä¸å†…å­˜çš„é€Ÿåº¦æ¯”è¾ƒ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150051.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150051.png" alt="img"></a></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150102.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150102.png" alt="img"></a></p><p>å› ä¸º CPU ä¸ å†…å­˜çš„é€Ÿåº¦å·®å¼‚å¾ˆå¤§ï¼Œéœ€è¦é é¢„è¯»æ•°æ®è‡³<strong>ç¼“å­˜</strong>æ¥æå‡æ•ˆç‡ã€‚<br>è€Œç¼“å­˜ä»¥<strong>ç¼“å­˜è¡Œ</strong>ä¸ºå•ä½ï¼Œæ¯ä¸ªç¼“å­˜è¡Œå¯¹åº”ç€ä¸€å—å†…å­˜ï¼Œä¸€èˆ¬æ˜¯ <strong>64 byte</strong>ï¼ˆ8 ä¸ª longï¼‰<br>ç¼“å­˜çš„åŠ å…¥ä¼šé€ æˆæ•°æ®å‰¯æœ¬çš„äº§ç”Ÿï¼Œå³åŒä¸€ä»½æ•°æ®ä¼šç¼“å­˜åœ¨ä¸åŒæ ¸å¿ƒçš„ç¼“å­˜è¡Œä¸­<br>CPU è¦ä¿è¯æ•°æ®çš„<strong>ä¸€è‡´æ€§</strong>ï¼Œå¦‚æœæŸä¸ª CPU æ ¸å¿ƒ<strong>æ›´æ”¹</strong>äº†æ•°æ®ï¼Œå…¶å®ƒ CPU æ ¸å¿ƒå¯¹åº”çš„æ•´ä¸ªç¼“å­˜è¡Œå¿…é¡»<strong>å¤±æ•ˆ</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150111.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150111.png" alt="img"></a></p><p>å› ä¸º Cell æ˜¯æ•°ç»„å½¢å¼ï¼Œåœ¨å†…å­˜ä¸­æ˜¯è¿ç»­å­˜å‚¨çš„ï¼Œä¸€ä¸ª Cell ä¸º 24 å­—èŠ‚ï¼ˆ16 å­—èŠ‚çš„å¯¹è±¡å¤´å’Œ 8 å­—èŠ‚çš„ valueï¼‰ï¼Œå›  æ­¤ç¼“å­˜è¡Œå¯ä»¥å­˜ä¸‹ 2 ä¸ªçš„ Cell å¯¹è±¡ã€‚è¿™æ ·é—®é¢˜æ¥äº†ï¼š</p><ul><li>Core-0 è¦ä¿®æ”¹ Cell[0]</li><li>Core-1 è¦ä¿®æ”¹ Cell[1]</li></ul><p>æ— è®ºè°ä¿®æ”¹æˆåŠŸï¼Œéƒ½ä¼šå¯¼è‡´å¯¹æ–¹ Core çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œ</p><p>æ¯”å¦‚ Core-0 ä¸­ Cell[0]=6000, Cell[1]=8000 è¦ç´¯åŠ  Cell[0]=6001, Cell[1]=8000 ï¼Œè¿™æ—¶ä¼šè®© Core-1 çš„ç¼“å­˜è¡Œå¤±æ•ˆ</p><p>@sun.misc.Contended ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒçš„åŸç†æ˜¯åœ¨ä½¿ç”¨æ­¤æ³¨è§£çš„å¯¹è±¡æˆ–å­—æ®µçš„<strong>å‰åå„å¢åŠ  128 å­—èŠ‚å¤§å°çš„ padding</strong>ï¼ˆç©ºç™½ï¼‰ï¼Œä»è€Œè®© CPU å°†å¯¹è±¡é¢„è¯»è‡³ç¼“å­˜æ—¶<strong>å ç”¨ä¸åŒçš„ç¼“å­˜è¡Œ</strong>ï¼Œè¿™æ ·ï¼Œä¸ä¼šé€ æˆå¯¹æ–¹ç¼“å­˜è¡Œçš„å¤±æ•ˆ</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150119.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150119.png" alt="img"></a></p><p><strong>ç´¯åŠ ä¸»è¦è°ƒç”¨ä»¥ä¸‹æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x)</span> </span>&#123;<br>    <span class="hljs-comment">// as ä¸ºç´¯åŠ å•å…ƒæ•°ç»„</span><br><span class="hljs-comment">// b ä¸ºåŸºç¡€å€¼</span><br><span class="hljs-comment">// x ä¸ºç´¯åŠ å€¼</span><br>    Cell[] as; <span class="hljs-keyword">long</span> b, v; <span class="hljs-keyword">int</span> m; Cell a;<br>    <br>    <span class="hljs-comment">// è¿›å…¥ if çš„ä¸¤ä¸ªæ¡ä»¶</span><br>    <span class="hljs-comment">// 1. as æœ‰å€¼, è¡¨ç¤ºå·²ç»å‘ç”Ÿè¿‡ç«äº‰, è¿›å…¥ if</span><br>    <span class="hljs-comment">// 2. cas ç»™ base ç´¯åŠ æ—¶å¤±è´¥äº†, è¡¨ç¤º base å‘ç”Ÿäº†ç«äº‰, è¿›å…¥ if</span><br>    <span class="hljs-keyword">if</span> ((as = cells) != <span class="hljs-keyword">null</span> || !casBase(b = base, b + x)) &#123;<br>        <span class="hljs-comment">// uncontended è¡¨ç¤º cell æ²¡æœ‰ç«äº‰</span><br>        <span class="hljs-keyword">boolean</span> uncontended = <span class="hljs-keyword">true</span>;<br>        <span class="hljs-keyword">if</span> (<br>            <span class="hljs-comment">// as è¿˜æ²¡æœ‰åˆ›å»º</span><br>            as == <span class="hljs-keyword">null</span> || (m = as.length - <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span> ||<br>            <span class="hljs-comment">// å½“å‰çº¿ç¨‹å¯¹åº”çš„ cell è¿˜æ²¡æœ‰</span><br>            (a = as[getProbe() &amp; m]) == <span class="hljs-keyword">null</span> ||<br>            <span class="hljs-comment">// cas ç»™å½“å‰çº¿ç¨‹çš„ cell ç´¯åŠ å¤±è´¥ uncontended=false ( a ä¸ºå½“å‰çº¿ç¨‹çš„ cell )</span><br>            !(uncontended = a.cas(v = a.value, v + x)))<br>            <br>            longAccumulate(x, <span class="hljs-keyword">null</span>, uncontended);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>ç´¯åŠ æµç¨‹å›¾</strong></p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150129.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20200608150129.png" alt="img"></a></p><p><strong>longAccumulateæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">longAccumulate</span><span class="hljs-params">(<span class="hljs-keyword">long</span> x, LongBinaryOperator fn, <span class="hljs-keyword">boolean</span> wasUncontended)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> h;<br>    <span class="hljs-comment">// å½“å‰çº¿ç¨‹è¿˜æ²¡æœ‰å¯¹åº”çš„ cell, éœ€è¦éšæœºç”Ÿæˆä¸€ä¸ª h å€¼ç”¨æ¥å°†å½“å‰çº¿ç¨‹ç»‘å®šåˆ° cell</span><br>    <span class="hljs-keyword">if</span> ((h = getProbe()) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// åˆå§‹åŒ– probe</span><br>        ThreadLocalRandom.current();<br>        <span class="hljs-comment">// h å¯¹åº”æ–°çš„ probe å€¼, ç”¨æ¥å¯¹åº” cell</span><br>        h = getProbe();<br>        wasUncontended = <span class="hljs-keyword">true</span>;<br>    &#125;<br>    <br>    <span class="hljs-comment">// collide ä¸º true è¡¨ç¤ºéœ€è¦æ‰©å®¹</span><br>    <span class="hljs-keyword">boolean</span> collide = <span class="hljs-keyword">false</span>;<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        Cell[] as; Cell a; <span class="hljs-keyword">int</span> n; <span class="hljs-keyword">long</span> v;<br>        <span class="hljs-comment">// å·²ç»æœ‰äº† cells</span><br>        <span class="hljs-keyword">if</span> ((as = cells) != <span class="hljs-keyword">null</span> &amp;&amp; (n = as.length) &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// è¿˜æ²¡æœ‰ cell</span><br>            <span class="hljs-keyword">if</span> ((a = as[(n - <span class="hljs-number">1</span>) &amp; h]) == <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-comment">// ä¸º cellsBusy åŠ é”, åˆ›å»º cell, cell çš„åˆå§‹ç´¯åŠ å€¼ä¸º x</span><br>        <span class="hljs-comment">// æˆåŠŸåˆ™ break, å¦åˆ™ç»§ç»­ continue å¾ªç¯</span><br>    &#125;<br>            <br>            <span class="hljs-comment">// æœ‰ç«äº‰, æ”¹å˜çº¿ç¨‹å¯¹åº”çš„ cell æ¥é‡è¯• cas</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!wasUncontended)<br>                wasUncontended = <span class="hljs-keyword">true</span>;<br><br>            <span class="hljs-comment">// cas å°è¯•ç´¯åŠ , fn é…åˆ LongAccumulator ä¸ä¸º null, é…åˆ LongAdder ä¸º null</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a.cas(v = a.value, ((fn == <span class="hljs-keyword">null</span>) ? v + x : fn.applyAsLong(v, x))))<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-comment">// å¦‚æœ cells é•¿åº¦å·²ç»è¶…è¿‡äº†æœ€å¤§é•¿åº¦, æˆ–è€…å·²ç»æ‰©å®¹, æ”¹å˜çº¿ç¨‹å¯¹åº”çš„ cell æ¥é‡è¯• cas</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (n &gt;= NCPU || cells != as)<br>                collide = <span class="hljs-keyword">false</span>;<br><br>            <span class="hljs-comment">// ç¡®ä¿ collide ä¸º false è¿›å…¥æ­¤åˆ†æ”¯, å°±ä¸ä¼šè¿›å…¥ä¸‹é¢çš„ else if è¿›è¡Œæ‰©å®¹äº†</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!collide)<br>                collide = <span class="hljs-keyword">true</span>;<br><br>            <span class="hljs-comment">// åŠ é”</span><br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span> &amp;&amp; casCellsBusy()) &#123;<br>                <span class="hljs-comment">// åŠ é”æˆåŠŸ, æ‰©å®¹</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br><br>            <span class="hljs-comment">// æ”¹å˜çº¿ç¨‹å¯¹åº”çš„ cell</span><br>            h = advanceProbe(h);<br>        &#125;<br>        <br>        <span class="hljs-comment">// è¿˜æ²¡æœ‰ cells, å°è¯•ç»™ cellsBusy åŠ é”</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cellsBusy == <span class="hljs-number">0</span> &amp;&amp; cells == as &amp;&amp; casCellsBusy()) &#123;<br>            <span class="hljs-comment">// åŠ é”æˆåŠŸ, åˆå§‹åŒ– cells, æœ€å¼€å§‹é•¿åº¦ä¸º 2, å¹¶å¡«å……ä¸€ä¸ª cell</span><br>            <span class="hljs-comment">// æˆåŠŸåˆ™ break;</span><br>        &#125;<br><br>        <span class="hljs-comment">// ä¸Šä¸¤ç§æƒ…å†µå¤±è´¥, å°è¯•ç»™ base ç´¯åŠ </span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (casBase(v = base, ((fn == <span class="hljs-keyword">null</span>) ? v + x : fn.applyAsLong(v, x))))<br>            <span class="hljs-keyword">break</span>;<br>        <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>longAccumulate æµç¨‹å›¾</strong></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_7_20210502.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_8_20210502.png"></p><p><strong>æ¯ä¸ªçº¿ç¨‹åˆšè¿›å…¥ longAccumulate æ—¶ï¼Œä¼šå°è¯•å¯¹åº”ä¸€ä¸ª cell å¯¹è±¡ï¼ˆæ‰¾åˆ°ä¸€ä¸ªå‘ä½ï¼‰</strong></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JUC_9_20210502.png"></p><p><strong>è·å–æœ€ç»ˆç»“æœé€šè¿‡ sum æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">sum</span><span class="hljs-params">()</span> </span>&#123;<br>    Cell[] as = cells; Cell a;<br>    <span class="hljs-keyword">long</span> sum = base;<br>    <span class="hljs-keyword">if</span> (as != <span class="hljs-keyword">null</span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; as.length; ++i) &#123;<br>            <span class="hljs-keyword">if</span> ((a = as[i]) != <span class="hljs-keyword">null</span>)<br>            sum += a.value;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sum;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9ã€Unsafe"><a href="#9ã€Unsafe" class="headerlink" title="9ã€Unsafe"></a>9ã€Unsafe</h2><p>Unsafe å¯¹è±¡æä¾›äº†éå¸¸åº•å±‚çš„ï¼Œæ“ä½œå†…å­˜ã€çº¿ç¨‹çš„æ–¹æ³•ï¼ŒUnsafe å¯¹è±¡ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡<strong>åå°„</strong>è·å¾—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetUnsafe</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException, NoSuchFieldException </span>&#123;<br><span class="hljs-comment">// é€šè¿‡åå°„è·å¾—Unsafeå¯¹è±¡</span><br>Class unsafeClass = Unsafe.class;<br><span class="hljs-comment">// è·å¾—æ„é€ å‡½æ•°ï¼ŒUnsafeçš„æ„é€ å‡½æ•°ä¸ºç§æœ‰çš„</span><br>Constructor constructor = unsafeClass.getDeclaredConstructor();<br><span class="hljs-comment">// è®¾ç½®ä¸ºå…è®¸è®¿é—®ç§æœ‰å†…å®¹</span><br>constructor.setAccessible(<span class="hljs-keyword">true</span>);<br><span class="hljs-comment">// åˆ›å»ºUnsafeå¯¹è±¡</span><br>Unsafe unsafe = (Unsafe) constructor.newInstance();<br><br><span class="hljs-comment">// åˆ›å»ºPersonå¯¹è±¡</span><br>Person person = <span class="hljs-keyword">new</span> Person();<br><span class="hljs-comment">// è·å¾—å…¶å±æ€§ name çš„åç§»é‡</span><br>Field field = Person.class.getDeclaredField(<span class="hljs-string">&quot;name&quot;</span>);<br><span class="hljs-keyword">long</span> offset = unsafe.objectFieldOffset(field);<br><br><span class="hljs-comment">// é€šè¿‡unsafeçš„CASæ“ä½œæ”¹å˜å€¼</span><br>unsafe.compareAndSwapObject(person, offset, <span class="hljs-keyword">null</span>, <span class="hljs-string">&quot;Nyima&quot;</span>);<br>System.out.println(person);<br>&#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;<br>    <span class="hljs-comment">// é…åˆCASæ“ä½œï¼Œå¿…é¡»ç”¨volatileä¿®é¥°</span><br> <span class="hljs-keyword">volatile</span> String name;<br><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br><span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br><span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜"><a href="#å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜" class="headerlink" title="å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜"></a>å…­ã€å…±äº«æ¨¡å‹ä¹‹ä¸å¯å˜</h1><h2 id="1ã€ä¸å¯å˜"><a href="#1ã€ä¸å¯å˜" class="headerlink" title="1ã€ä¸å¯å˜"></a>1ã€ä¸å¯å˜</h2><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨<strong>ä¸èƒ½å¤Ÿä¿®</strong>æ”¹å…¶å†…éƒ¨çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä¸å­˜åœ¨å¹¶å‘ä¿®æ”¹ã€‚</p><p><strong>ä¾‹å¦‚</strong></p><p>SimpleDateFormat ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨ Java 8 åï¼Œæä¾›äº†ä¸€ä¸ªæ–°çš„æ—¥æœŸæ ¼å¼åŒ–ç±» DateTimeFormatter</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">DateTimeFormatter dtf = DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;<br>    <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>        LocalDate date = dtf.parse(<span class="hljs-string">&quot;2018-10-01&quot;</span>, LocalDate::from);<br>        log.debug(<span class="hljs-string">&quot;&#123;&#125;&quot;</span>, date);<br>    &#125;).start();<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹ DateTimeFormatter çš„æ–‡æ¡£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@implSpec</span><br>This <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">is</span> <span class="hljs-title">immutable</span> <span class="hljs-title">and</span> <span class="hljs-title">thread</span>-<span class="hljs-title">safe</span>.</span><br></code></pre></td></tr></table></figure><p>ä¸å¯å˜å¯¹è±¡ï¼Œå®é™…æ˜¯å¦ä¸€ç§é¿å…ç«äº‰çš„æ–¹å¼ã€‚</p><h2 id="2ã€ä¸å¯å˜è®¾è®¡"><a href="#2ã€ä¸å¯å˜è®¾è®¡" class="headerlink" title="2ã€ä¸å¯å˜è®¾è®¡"></a>2ã€ä¸å¯å˜è®¾è®¡</h2><h3 id="Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°"><a href="#Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°" class="headerlink" title="Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°"></a>Stringç±»ä¸­ä¸å¯å˜çš„ä½“ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">String</span></span><br><span class="hljs-class">    <span class="hljs-keyword">implements</span> <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">Serializable</span>, <span class="hljs-title">Comparable</span>&lt;<span class="hljs-title">String</span>&gt;, <span class="hljs-title">CharSequence</span> </span>&#123;<br>    <span class="hljs-comment">/** The value is used for character storage. */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">char</span> value[];<br><br>    <span class="hljs-comment">/** Cache the hash code for the string */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> hash; <span class="hljs-comment">// Default to 0</span><br>    <br>   <span class="hljs-comment">//....</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ï¬nal-çš„ä½¿ç”¨"><a href="#ï¬nal-çš„ä½¿ç”¨" class="headerlink" title="ï¬nal çš„ä½¿ç”¨"></a>ï¬nal çš„ä½¿ç”¨</h3><p>å‘ç°è¯¥ç±»ã€ç±»ä¸­æ‰€æœ‰å±æ€§éƒ½æ˜¯<strong>ï¬nal</strong>çš„</p><ul><li>å±æ€§ç”¨ ï¬nal ä¿®é¥°ä¿è¯äº†è¯¥å±æ€§æ˜¯åªè¯»çš„ï¼Œä¸èƒ½ä¿®æ”¹</li><li>ç±»ç”¨ ï¬nal ä¿®é¥°ä¿è¯äº†è¯¥ç±»ä¸­çš„æ–¹æ³•ä¸èƒ½è¢«è¦†ç›–ï¼Œ<strong>é˜²æ­¢å­ç±»æ— æ„é—´ç ´åä¸å¯å˜æ€§</strong></li></ul><h3 id="ä¿æŠ¤æ€§æ‹·è´"><a href="#ä¿æŠ¤æ€§æ‹·è´" class="headerlink" title="ä¿æŠ¤æ€§æ‹·è´"></a>ä¿æŠ¤æ€§æ‹·è´</h3><p>ä½†æœ‰åŒå­¦ä¼šè¯´ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿæœ‰ä¸€äº›è·Ÿä¿®æ”¹ç›¸å…³çš„æ–¹æ³•å•Šï¼Œæ¯”å¦‚ substring ç­‰ï¼Œé‚£ä¹ˆä¸‹é¢å°±çœ‹ä¸€çœ‹è¿™äº›æ–¹æ³•æ˜¯ å¦‚ä½•å®ç°çš„ï¼Œå°±ä»¥ substring ä¸ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">substring</span><span class="hljs-params">(<span class="hljs-keyword">int</span> beginIndex)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (beginIndex &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(beginIndex);<br>        &#125;<br>        <span class="hljs-keyword">int</span> subLen = value.length - beginIndex;<br>        <span class="hljs-keyword">if</span> (subLen &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(subLen);<br>        &#125;<br>    <span class="hljs-comment">//è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡</span><br>        <span class="hljs-keyword">return</span> (beginIndex == <span class="hljs-number">0</span>) ? <span class="hljs-keyword">this</span> : <span class="hljs-keyword">new</span> String(value, beginIndex, subLen);<br>    &#125;<br></code></pre></td></tr></table></figure><p>å‘ç°å…¶å†…éƒ¨æ˜¯è°ƒç”¨ String çš„æ„é€ æ–¹æ³•<strong>åˆ›å»ºäº†ä¸€ä¸ªæ–°å­—ç¬¦ä¸²</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">String</span><span class="hljs-params">(<span class="hljs-keyword">char</span> value[], <span class="hljs-keyword">int</span> offset, <span class="hljs-keyword">int</span> count)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(offset);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (count &lt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (count &lt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(count);<br>            &#125;<br>            <span class="hljs-keyword">if</span> (offset &lt;= value.length) &#123;<br>                <span class="hljs-keyword">this</span>.value = <span class="hljs-string">&quot;&quot;</span>.value;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-comment">// Note: offset or count might be near -1&gt;&gt;&gt;1.</span><br>        <span class="hljs-keyword">if</span> (offset &gt; value.length - count) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> StringIndexOutOfBoundsException(offset + count);<br>        &#125;<br>        <span class="hljs-keyword">this</span>.value = Arrays.copyOfRange(value, offset, offset+count);<br>    &#125;<br></code></pre></td></tr></table></figure><p>æ„é€ æ–°å­—ç¬¦ä¸²å¯¹è±¡æ—¶ï¼Œä¼šç”Ÿæˆæ–°çš„ char[] valueï¼Œå¯¹å†…å®¹è¿›è¡Œå¤åˆ¶ ã€‚è¿™ç§é€šè¿‡åˆ›å»ºå‰¯æœ¬å¯¹è±¡æ¥é¿å…å…±äº«çš„æ‰‹æ®µç§°ä¹‹ä¸ºã€<strong>ä¿æŠ¤æ€§æ‹·è´</strong>ï¼ˆdefensive copyï¼‰ã€‘</p><h2 id="3ã€äº«å…ƒæ¨¡å¼"><a href="#3ã€äº«å…ƒæ¨¡å¼" class="headerlink" title="3ã€äº«å…ƒæ¨¡å¼"></a>3ã€äº«å…ƒæ¨¡å¼</h2><p>ç”±äºä¸å¯å˜ç±»çš„ä¿æŠ¤æ€§æ‹·è´ä¼šé¢‘ç¹çš„åˆ›å»ºå¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æå‰åˆ›å»ºä¸€äº›å¸¸ç”¨çš„ä¸å¯å˜å¯¹è±¡ä½œä¸ºç¼“å­˜ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº«å…ƒæ¨¡å¼çš„æ€æƒ³</p><h3 id="ç®€ä»‹-2"><a href="#ç®€ä»‹-2" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p><strong>å®šä¹‰</strong> è‹±æ–‡åç§°ï¼šFlyweight pattern. å½“éœ€è¦é‡ç”¨æ•°é‡æœ‰é™çš„åŒä¸€ç±»å¯¹è±¡æ—¶</p><blockquote><p>wikipediaï¼š A flyweight is an object that minimizes memory usage by sharing as much data as</p><p>possible with other similar objects</p></blockquote><p><strong>å‡ºè‡ª</strong> â€œGang of Fourâ€ design patterns</p><p><strong>å½’ç±»</strong> Structual patterns</p><h3 id="ä½“ç°"><a href="#ä½“ç°" class="headerlink" title="ä½“ç°"></a>ä½“ç°</h3><ul><li><p>åŒ…è£…ç±»</p><ul><li><p>åœ¨JDKä¸­ Booleanï¼ŒByteï¼ŒShortï¼ŒIntegerï¼ŒLongï¼ŒCharacter ç­‰åŒ…è£…ç±»æä¾›äº† valueOf æ–¹æ³•ï¼Œä¾‹å¦‚ Long çš„<br>valueOf ä¼šç¼“å­˜ -128~127 ä¹‹é—´çš„ Long å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªèŒƒå›´ä¹‹é—´ä¼šé‡ç”¨å¯¹è±¡ï¼Œå¤§äºè¿™ä¸ªèŒƒå›´ï¼Œæ‰ä¼šæ–°å»º Long å¯¹<br>è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Long <span class="hljs-title">valueOf</span><span class="hljs-params">(<span class="hljs-keyword">long</span> l)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> offset = <span class="hljs-number">128</span>;<br>    <span class="hljs-keyword">if</span> (l &gt;= -<span class="hljs-number">128</span> &amp;&amp; l &lt;= <span class="hljs-number">127</span>) &#123; <span class="hljs-comment">// will cache</span><br>    <span class="hljs-keyword">return</span> LongCache.cache[(<span class="hljs-keyword">int</span>)l + offset];<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Long(l);<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼š</p><ul><li><p>Byte, Short, Long ç¼“å­˜çš„èŒƒå›´éƒ½æ˜¯ -128~127</p></li><li><p>Character ç¼“å­˜çš„èŒƒå›´æ˜¯ 0~127</p></li><li><p>Integerçš„é»˜è®¤èŒƒå›´æ˜¯ -128~127</p><p>æœ€å°å€¼ä¸èƒ½å˜</p><p>ä½†æœ€å¤§å€¼å¯ä»¥é€šè¿‡è°ƒæ•´è™šæ‹Ÿæœºå‚æ•° <code> -Djava.lang.Integer.IntegerCache.high</code> æ¥æ”¹å˜</p></li><li><p>Boolean ç¼“å­˜äº† TRUE å’Œ FALSE</p></li></ul></blockquote></li></ul></li><li><p>String ä¸²æ± ï¼ˆæ­£å› ä¸ºä¸²æ± æœ‰ç¼“å­˜çš„ä½œç”¨ï¼Œä¸€èˆ¬ä¸è¦ä½¿ç”¨Stringå¯¹è±¡ä½œä¸ºé”å¯¹è±¡ï¼‰</p></li><li><p>BigDecimal BigInteger</p><ul><li>æ³¨æ„è™½ç„¶ä¸å¯å˜ç±»å•ä¸ªæ–¹æ³•å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ–¹æ³•ç»„åˆä¾ç„¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå› æ­¤åœ¨å‰é¢ä½¿ç”¨äº†åŸå­å¼•ç”¨ç±»å¯¹BigDecimalè¿›è¡Œäº†æ”¹è¿›ï¼Œå®ç°CASäº¤æ¢ä¿è¯åŸå­æ€§ï¼ˆå› ä¸ºè¿™ä¸ªæ“ä½œåŒ…æ‹¬äº†è¯»å–ï¼Œæ“ä½œå’Œèµ‹å€¼ï¼Œä¸‰ä¸ªæ“ä½œï¼ŒCASæ‰èƒ½ä¿è¯åŸå­æ€§ï¼‰</li></ul></li></ul><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>é€šè¿‡äº«å…ƒæ¨¡å¼æ€æƒ³å®ç°æ•°æ®åº“è¿æ¥æ± ï¼ˆè¯¥å®ç°ä»¿ç…§äº†tomcatçš„æ± å®ç°ï¼Œå…¶ä»–æ–¹å¼å¯ä»¥å‚è€ƒå…¶ä»–ç¬¬ä¸‰æ–¹æ•°æ®åº“è¿æ¥æ± çš„å®ç°æºç ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pool</span> </span>&#123;<br>    <span class="hljs-comment">// 1. è¿æ¥æ± å¤§å°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> poolSize;<br>    <span class="hljs-comment">// 2. è¿æ¥å¯¹è±¡æ•°ç»„</span><br>    <span class="hljs-keyword">private</span> Connection[] connections;<br>    <span class="hljs-comment">// 3. è¿æ¥çŠ¶æ€æ•°ç»„ 0 è¡¨ç¤ºç©ºé—²ï¼Œ 1 è¡¨ç¤ºç¹å¿™</span><br>    <span class="hljs-keyword">private</span> AtomicIntegerArray states;<br>    <span class="hljs-comment">// 4. æ„é€ æ–¹æ³•åˆå§‹åŒ–</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Pool</span><span class="hljs-params">(<span class="hljs-keyword">int</span> poolSize)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.poolSize = poolSize;<br>        <span class="hljs-keyword">this</span>.connections = <span class="hljs-keyword">new</span> Connection[poolSize];<br>        <span class="hljs-keyword">this</span>.states = <span class="hljs-keyword">new</span> AtomicIntegerArray(<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[poolSize]);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>       connections[i] = <span class="hljs-keyword">new</span> MockConnection(<span class="hljs-string">&quot;è¿æ¥&quot;</span> + (i+<span class="hljs-number">1</span>));<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// 5. å€Ÿè¿æ¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Connection <span class="hljs-title">borrow</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>                <span class="hljs-comment">// è·å–ç©ºé—²è¿æ¥</span><br>                <span class="hljs-keyword">if</span>(states.get(i) == <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">if</span> (states.compareAndSet(i, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>)) &#123;<br>                        log.debug(<span class="hljs-string">&quot;borrow &#123;&#125;&quot;</span>, connections[i]);<br>                        <span class="hljs-keyword">return</span> connections[i];<br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç©ºé—²è¿æ¥ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…</span><br>            <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    log.debug(<span class="hljs-string">&quot;wait...&quot;</span>);<br>                    <span class="hljs-keyword">this</span>.wait();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <br><span class="hljs-comment">// 6. å½’è¿˜è¿æ¥</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">free</span><span class="hljs-params">(Connection conn)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; poolSize; i++) &#123;<br>            <span class="hljs-keyword">if</span> (connections[i] == conn) &#123;<br>                states.set(i, <span class="hljs-number">0</span>);<br>                <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>) &#123;<br>                    log.debug(<span class="hljs-string">&quot;free &#123;&#125;&quot;</span>, conn);<br>                    <span class="hljs-keyword">this</span>.notifyAll();<br>                &#125;<br>                    <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MockConnection</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Connection</span> </span>&#123;<br><span class="hljs-comment">// å®ç°ç•¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è¿æ¥æ± ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java">Pool pool = <span class="hljs-keyword">new</span> Pool(<span class="hljs-number">2</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) &#123;<br>    <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>        Connection conn = pool.borrow();<br>        <span class="hljs-keyword">try</span> &#123;<br>        Thread.sleep(<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">1000</span>));<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>        e.printStackTrace();<br>        &#125;<br>        pool.free(conn);<br>    &#125;).start();<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šå®ç°æ²¡æœ‰è€ƒè™‘ï¼š</p><ul><li>è¿æ¥çš„åŠ¨æ€å¢é•¿ä¸æ”¶ç¼©</li><li>è¿æ¥ä¿æ´»ï¼ˆå¯ç”¨æ€§æ£€æµ‹ï¼‰</li><li>ç­‰å¾…è¶…æ—¶å¤„ç†ï¼ˆå¯ä»¥å‚è€ƒã€Šjavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ç¬¬4ç«  ç­‰å¾…è¶…æ—¶æ¨¡å¼ æ•°æ®åº“è¿æ¥æ± ç¤ºä¾‹åº”ç”¨ï¼‰</li><li>åˆ†å¸ƒå¼ hash</li></ul><p>å¯¹äºå…³ç³»å‹æ•°æ®åº“ï¼Œæœ‰æ¯”è¾ƒæˆç†Ÿçš„è¿æ¥æ± å®ç°ï¼Œä¾‹å¦‚c3p0, druidç­‰ å¯¹äºæ›´é€šç”¨çš„å¯¹è±¡æ± ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨apache commons poolï¼Œä¾‹å¦‚redisè¿æ¥æ± å¯ä»¥å‚è€ƒjedisä¸­å…³äºè¿æ¥æ± çš„å®ç°</p><h2 id="4ã€finalåŸç†"><a href="#4ã€finalåŸç†" class="headerlink" title="4ã€finalåŸç†"></a>4ã€finalåŸç†</h2><h3 id="è®¾ç½®-final-å˜é‡çš„åŸç†ï¼ˆfinalåŸŸçš„å†…å­˜è¯­ä¹‰ï¼‰"><a href="#è®¾ç½®-final-å˜é‡çš„åŸç†ï¼ˆfinalåŸŸçš„å†…å­˜è¯­ä¹‰ï¼‰" class="headerlink" title="è®¾ç½® final å˜é‡çš„åŸç†ï¼ˆfinalåŸŸçš„å†…å­˜è¯­ä¹‰ï¼‰"></a>è®¾ç½® final å˜é‡çš„åŸç†ï¼ˆfinalåŸŸçš„å†…å­˜è¯­ä¹‰ï¼‰</h3><p>ç†è§£äº† volatile åŸç†ï¼Œå†å¯¹æ¯” final çš„å®ç°å°±æ¯”è¾ƒç®€å•äº†ï¼Œè¯¦ç»†å‚è€ƒã€Šjavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹3.6 </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestFinal</span> </span>&#123;<br><span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> a = <span class="hljs-number">20</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å­—èŠ‚ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">0</span>: aload_0<br>1: invokespecial #1 // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V<br><span class="hljs-number">4</span>: aload_0<br><span class="hljs-number">5</span>: bipush <span class="hljs-number">20</span><br>7: putfield #2 // Field a:I<br>&lt;-- å†™å±éšœ<br><span class="hljs-number">10</span>: <span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><p>å‘ç° final å˜é‡çš„èµ‹å€¼ä¹Ÿä¼šé€šè¿‡ putfield æŒ‡ä»¤æ¥å®Œæˆï¼ŒåŒæ ·åœ¨è¿™æ¡æŒ‡ä»¤ä¹‹åä¹Ÿä¼šåŠ å…¥å†™å±éšœï¼Œä¿è¯åœ¨å…¶å®ƒçº¿ç¨‹è¯»åˆ°<br>å®ƒçš„å€¼æ—¶ä¸ä¼šå‡ºç°ä¸º 0 çš„æƒ…å†µ</p><h3 id="è·å–-final-å˜é‡çš„åŸç†"><a href="#è·å–-final-å˜é‡çš„åŸç†" class="headerlink" title="è·å– final å˜é‡çš„åŸç†"></a>è·å– final å˜é‡çš„åŸç†</h3><p>finalå¯ä¼˜åŒ–é™æ€æˆå‘˜å˜é‡çš„å…±äº«ï¼Œå®ç°è¯»å–ä¼˜åŒ–</p><ul><li>ä½¿ç”¨finalä¿®é¥°çš„é™æ€æˆå‘˜å˜é‡ï¼Œè®¿é—®æ—¶å¯ä»¥ç›´æ¥è®¿é—®å¤åˆ¶åˆ°æ ˆå†…å­˜çš„æ‹·è´ï¼ˆæ•ˆç‡é«˜ï¼‰ï¼Œè€Œä¸æ˜¯è®¿é—®é™æ€æˆå‘˜å˜é‡çš„å…±äº«å†…å­˜ï¼ˆå †ï¼‰</li><li>é™æ€æˆå‘˜å˜é‡è¶…è¿‡äº†shortçš„æœ€å¤§å€¼ï¼Œåˆ™ä¼šæ”¾åœ¨å¸¸é‡æ± ï¼ˆå †ï¼‰ä¸­ï¼Œä½¿ç”¨finalä¿®é¥°åŒæ ·å¯ä»¥å®ç°è®¿é—®å¤åˆ¶åˆ°æ ˆå†…å­˜çš„æ‹·è´ï¼ˆæ•ˆç‡é«˜ï¼‰</li></ul><h2 id="5ã€æ— çŠ¶æ€"><a href="#5ã€æ— çŠ¶æ€" class="headerlink" title="5ã€æ— çŠ¶æ€"></a>5ã€æ— çŠ¶æ€</h2><p>åœ¨ web é˜¶æ®µå­¦ä¹ æ—¶ï¼Œè®¾è®¡ Servlet æ—¶ä¸ºäº†ä¿è¯å…¶çº¿ç¨‹å®‰å…¨ï¼Œéƒ½ä¼šæœ‰è¿™æ ·çš„å»ºè®®ï¼Œä¸è¦ä¸º Servlet è®¾ç½®æˆå‘˜å˜é‡ï¼Œè¿™<br>ç§æ²¡æœ‰ä»»ä½•æˆå‘˜å˜é‡çš„ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„</p><blockquote><p>å› ä¸ºæˆå‘˜å˜é‡ä¿å­˜çš„æ•°æ®ä¹Ÿå¯ä»¥ç§°ä¸ºçŠ¶æ€ä¿¡æ¯ï¼Œå› æ­¤æ²¡æœ‰æˆå‘˜å˜é‡å°±ç§°ä¹‹ä¸ºã€æ— çŠ¶æ€ã€‘</p></blockquote><h1 id="ä¸ƒã€å…±äº«æ¨¡å‹ä¹‹å·¥å…·"><a href="#ä¸ƒã€å…±äº«æ¨¡å‹ä¹‹å·¥å…·" class="headerlink" title="ä¸ƒã€å…±äº«æ¨¡å‹ä¹‹å·¥å…·"></a>ä¸ƒã€å…±äº«æ¨¡å‹ä¹‹å·¥å…·</h1><h2 id="1ã€çº¿ç¨‹æ± "><a href="#1ã€çº¿ç¨‹æ± " class="headerlink" title="1ã€çº¿ç¨‹æ± "></a>1ã€çº¿ç¨‹æ± </h2><h3 id="1-è‡ªå®šä¹‰çº¿ç¨‹æ± "><a href="#1-è‡ªå®šä¹‰çº¿ç¨‹æ± " class="headerlink" title="(1) è‡ªå®šä¹‰çº¿ç¨‹æ± "></a>(1) è‡ªå®šä¹‰çº¿ç¨‹æ± </h3><h4 id="å›¾è§£"><a href="#å›¾è§£" class="headerlink" title="å›¾è§£"></a>å›¾è§£</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201021154837.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201021154837.png" alt="img"></a></p><ul><li>é˜»å¡é˜Ÿåˆ—ä¸­ç»´æŠ¤äº†ç”±ä¸»çº¿ç¨‹ï¼ˆæˆ–è€…å…¶ä»–çº¿ç¨‹ï¼‰æ‰€äº§ç”Ÿçš„çš„ä»»åŠ¡</li><li>ä¸»çº¿ç¨‹ç±»ä¼¼äº<strong>ç”Ÿäº§è€…</strong>ï¼Œäº§ç”Ÿä»»åŠ¡å¹¶æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­</li><li>çº¿ç¨‹æ± ç±»ä¼¼äº<strong>æ¶ˆè´¹è€…</strong>ï¼Œå¾—åˆ°é˜»å¡é˜Ÿåˆ—ä¸­å·²æœ‰çš„ä»»åŠ¡å¹¶æ‰§è¡Œ</li></ul><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.ArrayDeque;<br><span class="hljs-keyword">import</span> java.util.Deque;<br><span class="hljs-keyword">import</span> java.util.HashSet;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><span class="hljs-keyword">import</span> java.util.concurrent.locks.Condition;<br><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestPool</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ThreadPool threadPool = <span class="hljs-keyword">new</span> ThreadPool(<span class="hljs-number">2</span>, TimeUnit.SECONDS, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, (blockingQeque, task) -&gt; &#123;<br>            <span class="hljs-comment">// æŠŠå…·ä½“çš„æ‹’ç»ç­–ç•¥æŠ½è±¡ä¸ºä¸€ä¸ªæ¥å£ï¼Œç”±è°ƒç”¨è€…ä¼ å…¥å…·ä½“çš„æ‹’ç»æ–¹æ³•ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰</span><br>            <span class="hljs-comment">// 1.æ­»ç­‰ç­–ç•¥</span><br>            <span class="hljs-comment">// blockingQeque.put(task);</span><br>            <span class="hljs-comment">// 2.å¸¦è¶…æ—¶ç­‰å¾…</span><br>            <span class="hljs-comment">// blockingQeque.offer(task, 500, TimeUnit.MILLISECONDS);</span><br>            <span class="hljs-comment">// 3.è°ƒç”¨è€…æ”¾å¼ƒè°ƒç”¨ä»»åŠ¡</span><br>            <span class="hljs-comment">// System.out.println(&quot;æ”¾å¼ƒè°ƒç”¨ä»»åŠ¡&quot;);</span><br>            <span class="hljs-comment">// 4.è°ƒç”¨è€…æŠ›å‡ºå¼‚å¸¸</span><br>            <span class="hljs-comment">// throw new RuntimeException(&quot;ä»»åŠ¡æ‰§è¡Œå¤±è´¥&quot; + task);</span><br>            <span class="hljs-comment">// 5.è°ƒç”¨è€…è‡ªå·±æ‰§è¡Œä»»åŠ¡</span><br>            task.run();<br>        &#125;);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)&#123;<br>            threadPool.execute(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    TimeUnit.SECONDS.sleep(<span class="hljs-number">1</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ&quot;</span>);<br>            &#125;);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@FunctionalInterface</span> <span class="hljs-comment">// æ‹’ç»ç­–ç•¥</span><br><span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">RejectPolicy</span>&lt;<span class="hljs-title">T</span>&gt;</span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">reject</span><span class="hljs-params">(BlockingQeque&lt;T&gt; blockingQeque, T task)</span></span>;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThreadPool</span></span>&#123;<br>    <span class="hljs-comment">// ä¸€ä¸ªä»»åŠ¡é˜»å¡é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">private</span> BlockingQeque&lt;Runnable&gt; blockingQeque;<br>    <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> coreSize;<br>    <span class="hljs-comment">// å·¥ä½œçº¿ç¨‹é›†åˆ</span><br>    <span class="hljs-keyword">private</span> HashSet&lt;Worker&gt; workers = <span class="hljs-keyword">new</span> HashSet&lt;Worker&gt;();<br><br>    <span class="hljs-comment">// æŒ‡å®šçº¿ç¨‹æœ€å¤§å­˜æ´»æ—¶é—´</span><br>    <span class="hljs-keyword">private</span> TimeUnit timeUnit;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> timeout;<br><br>    <span class="hljs-comment">// æ‹’ç»ç­–ç•¥</span><br>    <span class="hljs-keyword">private</span> RejectPolicy&lt;Runnable&gt; rejectPolicy;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worker</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Thread</span></span>&#123;<br>        Runnable task;<br><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Worker</span><span class="hljs-params">(Runnable task)</span></span>&#123;<br>            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;åˆå§‹åŒ–ä»»åŠ¡&quot;</span>);<br>            <span class="hljs-keyword">this</span>.task = task;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-comment">//            while(task != null || (task = blockingQeque.take()) != null)&#123;</span><br>            <span class="hljs-keyword">while</span>(task != <span class="hljs-keyword">null</span> || (task = blockingQeque.take(timeout, timeUnit)) != <span class="hljs-keyword">null</span>)&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;æ‰§è¡Œä»»åŠ¡&quot;</span>);<br>                    task.run();<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                    e.printStackTrace();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;ä»»åŠ¡æ‰§è¡Œå®Œæ¯•&quot;</span>);<br>                    task = <span class="hljs-keyword">null</span>;<br>                &#125;<br>            &#125;<br><br>            <span class="hljs-keyword">synchronized</span> (workers) &#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;ç§»é™¤ä»»åŠ¡&quot;</span>);<br>                workers.remove(<span class="hljs-keyword">this</span>);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPool</span><span class="hljs-params">(<span class="hljs-keyword">int</span> coreSize, TimeUnit timeUnit, <span class="hljs-keyword">long</span> timeout, <span class="hljs-keyword">int</span> capacity, RejectPolicy&lt;Runnable&gt; rejectPolicy)</span></span>&#123;<br>        <span class="hljs-keyword">this</span>.coreSize = coreSize;<br>        <span class="hljs-keyword">this</span>.timeUnit = timeUnit;<br>        <span class="hljs-keyword">this</span>.timeout = timeout;<br>        <span class="hljs-keyword">this</span>.rejectPolicy = rejectPolicy;<br>        blockingQeque = <span class="hljs-keyword">new</span> BlockingQeque&lt;Runnable&gt;(capacity);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable task)</span></span>&#123;<br>        <span class="hljs-keyword">synchronized</span> (workers) &#123;<br>            <span class="hljs-keyword">if</span>(workers.size() &lt; coreSize)&#123;<br>                Worker worker = <span class="hljs-keyword">new</span> Worker(task);<br>                workers.add(worker);<br>                worker.start();<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;çº¿ç¨‹æ± ä¸­çº¿ç¨‹å·²ç”¨å®Œï¼Œè¯·ç¨ç­‰&quot;</span>);<br>                <span class="hljs-comment">//blockingQeque.put(task);</span><br>                blockingQeque.tryPut(rejectPolicy, task);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä»»åŠ¡é˜»å¡é˜Ÿåˆ—</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> &lt;T&gt;</span><br><span class="hljs-comment"> */</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlockingQeque</span>&lt;<span class="hljs-title">T</span>&gt;</span>&#123;<br>    <span class="hljs-comment">// é˜»å¡é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">private</span> Deque&lt;T&gt; blockingQueue;<br><br>    <span class="hljs-comment">// é˜Ÿåˆ—å®¹é‡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> capacity;<br><br>    <span class="hljs-comment">// é”</span><br>    <span class="hljs-keyword">private</span> ReentrantLock lock;<br><br>    <span class="hljs-comment">// æ¡ä»¶å˜é‡</span><br>    <span class="hljs-keyword">private</span> Condition fullQueue;<br>    <span class="hljs-keyword">private</span> Condition emptyQueue;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">BlockingQeque</span><span class="hljs-params">(<span class="hljs-keyword">int</span> capacity)</span></span>&#123;<br>        blockingQueue = <span class="hljs-keyword">new</span> ArrayDeque&lt;&gt;();<br>        <span class="hljs-keyword">this</span>.capacity = capacity;<br>        lock = <span class="hljs-keyword">new</span> ReentrantLock();<br>        fullQueue = lock.newCondition();<br>        emptyQueue = lock.newCondition();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ä»»åŠ¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">take</span><span class="hljs-params">(<span class="hljs-keyword">long</span> time, TimeUnit unit)</span></span>&#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">long</span> nanos = unit.toNanos(time);<br>            <span class="hljs-keyword">while</span>(blockingQueue.isEmpty())&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    <span class="hljs-keyword">if</span>(nanos &lt;= <span class="hljs-number">0</span>)&#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>                    &#125;<br>                    nanos = emptyQueue.awaitNanos(nanos);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            T task = blockingQueue.removeFirst();<br>            fullQueue.signalAll();<br>            <span class="hljs-keyword">return</span> task;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–ä»»åŠ¡ï¼Œè¶…æ—¶ç­‰å¾…(é‡è½½)</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">take</span><span class="hljs-params">()</span></span>&#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">while</span>(blockingQueue.isEmpty())&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    emptyQueue.await();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            T task = blockingQueue.removeFirst();<br>            fullQueue.signalAll();<br>            <span class="hljs-keyword">return</span> task;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åŠ å…¥ä»»åŠ¡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> task</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(T task)</span></span>&#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">while</span>(blockingQueue.size() == capacity)&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    fullQueue.await();<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            blockingQueue.addLast(task);<br>            emptyQueue.signalAll();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¸¦è¶…æ—¶æ—¶é—´çš„é˜»å¡æ·»åŠ </span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">offer</span><span class="hljs-params">(T task, <span class="hljs-keyword">long</span> timeout, TimeUnit timeUnit)</span> </span>&#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">long</span> nanos = timeUnit.toNanos(timeout);<br>            <span class="hljs-keyword">while</span>(blockingQueue.size() == capacity)&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    <span class="hljs-keyword">if</span>(nanos &lt;= <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>                    &#125;<br>                    nanos = fullQueue.awaitNanos(nanos);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            blockingQueue.addLast(task);<br>            emptyQueue.signalAll();<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å¾—ä»»åŠ¡æ•°é‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getSize</span><span class="hljs-params">()</span></span>&#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">return</span> blockingQueue.size();<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tryPut</span><span class="hljs-params">(RejectPolicy&lt;T&gt; rejectPolicy, T task)</span> </span>&#123;<br>        lock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span>(blockingQueue.size() == capacity)&#123;<br>                rejectPolicy.reject(<span class="hljs-keyword">this</span>, task);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">&quot;åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—&quot;</span> + task);<br>                blockingQueue.addLast(task);<br>                emptyQueue.signalAll();<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å®ç°äº†ä¸€ä¸ªç®€å•çš„çº¿ç¨‹æ± </p><ul><li>é˜»å¡é˜Ÿåˆ—BlockingQueueç”¨äºæš‚å­˜æ¥ä¸åŠè¢«çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡<ul><li>ä¹Ÿå¯ä»¥è¯´æ˜¯å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ‰§è¡Œé€Ÿåº¦ä¸Šçš„å·®å¼‚</li><li>é‡Œé¢çš„è·å–ä»»åŠ¡å’Œæ”¾å…¥ä»»åŠ¡ç”¨åˆ°äº†<strong>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼</strong></li><li>é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œå†åŠ å…¥ä»»åŠ¡çš„å¤„ç†ç­–ç•¥æŠ½è±¡ä¸ºæ‹’ç»ç­–ç•¥æ¥å£ï¼Œç”±è°ƒç”¨çº¿ç¨‹ä¼ å…¥å…·ä½“ç­–ç•¥æ–¹æ³•</li></ul></li><li>çº¿ç¨‹æ± ä¸­å¯¹çº¿ç¨‹Threadè¿›è¡Œäº†å†æ¬¡çš„å°è£…ï¼Œå°è£…ä¸ºäº†Worker<ul><li>åœ¨è°ƒç”¨ä»»åŠ¡çš„runæ–¹æ³•æ—¶ï¼Œçº¿ç¨‹ä¼šå»æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åè¿˜ä¼š<strong>åˆ°é˜»å¡é˜Ÿåˆ—ä¸­è·å–æ–°ä»»åŠ¡æ¥æ‰§è¡Œ</strong></li></ul></li><li>çº¿ç¨‹æ± ä¸­æ‰§è¡Œä»»åŠ¡çš„ä¸»è¦æ–¹æ³•ä¸ºexecuteæ–¹æ³•<ul><li>æ‰§è¡Œæ—¶è¦åˆ¤æ–­æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹æ•°æ˜¯å¦å¤§äºäº†çº¿ç¨‹æ± å®¹é‡</li></ul></li></ul><h3 id="2-ThreadPoolExecutor"><a href="#2-ThreadPoolExecutor" class="headerlink" title="(2) ThreadPoolExecutor"></a>(2) ThreadPoolExecutor</h3><h4 id="ç»§æ‰¿å…³ç³»"><a href="#ç»§æ‰¿å…³ç³»" class="headerlink" title="ç»§æ‰¿å…³ç³»"></a>ç»§æ‰¿å…³ç³»</h4><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022212832.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022212832.png" alt="img"></a></p><h4 id="çº¿ç¨‹æ± çŠ¶æ€"><a href="#çº¿ç¨‹æ± çŠ¶æ€" class="headerlink" title="çº¿ç¨‹æ± çŠ¶æ€"></a>çº¿ç¨‹æ± çŠ¶æ€</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€</span><br><span class="hljs-comment">// runState is stored in the high-order bits</span><br><span class="hljs-comment">// RUNNING é«˜3ä½ä¸º111</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> RUNNING    = -<span class="hljs-number">1</span> &lt;&lt; COUNT_BITS;<br><br><span class="hljs-comment">// SHUTDOWN é«˜3ä½ä¸º000</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> SHUTDOWN   =  <span class="hljs-number">0</span> &lt;&lt; COUNT_BITS;<br><br><span class="hljs-comment">// é«˜3ä½ 001</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> STOP       =  <span class="hljs-number">1</span> &lt;&lt; COUNT_BITS;<br><br><span class="hljs-comment">// é«˜3ä½ 010</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TIDYING    =  <span class="hljs-number">2</span> &lt;&lt; COUNT_BITS;<br><br><span class="hljs-comment">// é«˜3ä½ 011</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> TERMINATED =  <span class="hljs-number">3</span> &lt;&lt; COUNT_BITS;<br></code></pre></td></tr></table></figure><table><thead><tr><th>çŠ¶æ€åç§°</th><th>é«˜3ä½çš„å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>RUNNING</td><td>111</td><td>æ¥æ”¶æ–°ä»»åŠ¡ï¼ŒåŒæ—¶å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td></tr><tr><td>SHUTDOWN</td><td>000</td><td>ä¸æ¥å—æ–°ä»»åŠ¡ï¼Œä½†æ˜¯å¤„ç†ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td></tr><tr><td>STOP</td><td>001</td><td>ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼ŒåŒæ—¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</td></tr><tr><td>TIDYING</td><td>010</td><td>ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œæ´»åŠ¨çº¿ç¨‹ä¸º0æ—¶ï¼Œå³å°†è¿›å…¥ç»ˆç»“é˜¶æ®µ</td></tr><tr><td>TERMINATED</td><td>011</td><td>ç»ˆç»“çŠ¶æ€</td></tr></tbody></table><p>çº¿ç¨‹æ± çŠ¶æ€å’Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡<strong>ç”±ä¸€ä¸ªåŸå­æ•´å‹ctlæ¥å…±åŒè¡¨ç¤º</strong></p><ul><li>ä½¿ç”¨ä¸€ä¸ªæ•°æ¥è¡¨ç¤ºä¸¤ä¸ªå€¼çš„ä¸»è¦åŸå› æ˜¯ï¼š<strong>å¯ä»¥é€šè¿‡ä¸€æ¬¡CASåŒæ—¶æ›´æ”¹ä¸¤ä¸ªå±æ€§çš„å€¼</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// åŸå­æ•´æ•°ï¼Œå‰3ä½ä¿å­˜äº†çº¿ç¨‹æ± çš„çŠ¶æ€ï¼Œå‰©ä½™ä½ä¿å­˜çš„æ˜¯çº¿ç¨‹æ•°é‡</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicInteger ctl = <span class="hljs-keyword">new</span> AtomicInteger(ctlOf(RUNNING, <span class="hljs-number">0</span>));<br><br><span class="hljs-comment">// å¹¶ä¸æ˜¯æ‰€æœ‰å¹³å°çš„intéƒ½æ˜¯32ä½ã€‚</span><br><span class="hljs-comment">// å»æ‰å‰ä¸‰ä½ä¿å­˜çº¿ç¨‹çŠ¶æ€çš„ä½æ•°ï¼Œå‰©ä¸‹çš„ç”¨äºä¿å­˜çº¿ç¨‹æ•°é‡</span><br><span class="hljs-comment">// é«˜3ä½ä¸º0ï¼Œå‰©ä½™ä½æ•°å…¨ä¸º1</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> COUNT_BITS = Integer.SIZE - <span class="hljs-number">3</span>;<br><br><span class="hljs-comment">// 2^COUNT_BITSæ¬¡æ–¹ï¼Œè¡¨ç¤ºå¯ä»¥ä¿å­˜çš„æœ€å¤§çº¿ç¨‹æ•°</span><br><span class="hljs-comment">// CAPACITY çš„é«˜3ä½ä¸º 0</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> CAPACITY   = (<span class="hljs-number">1</span> &lt;&lt; COUNT_BITS) - <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><p>è·å–çº¿ç¨‹æ± çŠ¶æ€ã€çº¿ç¨‹æ•°é‡ä»¥åŠåˆå¹¶ä¸¤ä¸ªå€¼çš„æ“ä½œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Packing and unpacking ctl</span><br><span class="hljs-comment">// è·å–è¿è¡ŒçŠ¶æ€</span><br><span class="hljs-comment">// è¯¥æ“ä½œä¼šè®©é™¤é«˜3ä½ä»¥å¤–çš„æ•°å…¨éƒ¨å˜ä¸º0</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">runStateOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span>     </span>&#123; <span class="hljs-keyword">return</span> c &amp; ~CAPACITY; &#125;<br><br><span class="hljs-comment">// è·å–è¿è¡Œçº¿ç¨‹æ•°</span><br><span class="hljs-comment">// è¯¥æ“ä½œä¼šè®©é«˜3ä½ä¸º0</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">workerCountOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> c)</span>  </span>&#123; <span class="hljs-keyword">return</span> c &amp; CAPACITY; &#125;<br><br><span class="hljs-comment">// è®¡ç®—ctlæ–°å€¼</span><br><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ctlOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> rs, <span class="hljs-keyword">int</span> wc)</span> </span>&#123; <span class="hljs-keyword">return</span> rs | wc; &#125;<br></code></pre></td></tr></table></figure><h4 id="çº¿ç¨‹æ± å±æ€§"><a href="#çº¿ç¨‹æ± å±æ€§" class="headerlink" title="çº¿ç¨‹æ± å±æ€§"></a>çº¿ç¨‹æ± å±æ€§</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å·¥ä½œçº¿ç¨‹ï¼Œå†…éƒ¨å°è£…äº†Thread</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Worker</span></span><br><span class="hljs-class">        <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractQueuedSynchronizer</span></span><br><span class="hljs-class">        <span class="hljs-keyword">implements</span> <span class="hljs-title">Runnable</span> </span>&#123;<br>    ...<br>&#125;<br><br><span class="hljs-comment">// é˜»å¡é˜Ÿåˆ—ï¼Œç”¨äºå­˜æ”¾æ¥ä¸åŠè¢«æ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Runnable&gt; workQueue;<br><br><span class="hljs-comment">// é”</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">new</span> ReentrantLock();<br><br><span class="hljs-comment">//  ç”¨äºå­˜æ”¾æ ¸å¿ƒçº¿ç¨‹çš„å®¹å™¨ï¼Œåªæœ‰å½“æŒæœ‰é”æ—¶æ‰èƒ½å¤Ÿè·å–å…¶ä¸­çš„å…ƒç´ ï¼ˆæ ¸å¿ƒçº¿ç¨‹ï¼‰</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HashSet&lt;Worker&gt; workers = <span class="hljs-keyword">new</span> HashSet&lt;Worker&gt;();<br></code></pre></td></tr></table></figure><h4 id="æ„é€ æ–¹æ³•æå…¶å‚æ•°"><a href="#æ„é€ æ–¹æ³•æå…¶å‚æ•°" class="headerlink" title="æ„é€ æ–¹æ³•æå…¶å‚æ•°"></a>æ„é€ æ–¹æ³•æå…¶å‚æ•°</h4><p><strong>ThreadPoolExecutoræœ€å…¨é¢çš„æ„é€ æ–¹æ³•</strong></p><p>ä¹Ÿæ˜¯æ„é€ è‡ªå®šä¹‰çº¿ç¨‹æ± çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-keyword">int</span> corePoolSize,</span></span><br><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">int</span> maximumPoolSize,</span></span><br><span class="hljs-function"><span class="hljs-params">                          <span class="hljs-keyword">long</span> keepAliveTime,</span></span><br><span class="hljs-function"><span class="hljs-params">                          TimeUnit unit,</span></span><br><span class="hljs-function"><span class="hljs-params">                          BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="hljs-function"><span class="hljs-params">                          ThreadFactory threadFactory,</span></span><br><span class="hljs-function"><span class="hljs-params">                          RejectedExecutionHandler handler)</span></span><br></code></pre></td></tr></table></figure><h5 id="å‚æ•°è§£é‡Š"><a href="#å‚æ•°è§£é‡Š" class="headerlink" title="å‚æ•°è§£é‡Š"></a>å‚æ•°è§£é‡Š</h5><ul><li>corePoolSizeï¼šæ ¸å¿ƒçº¿ç¨‹æ•°</li><li>maximumPoolSizeï¼šæœ€å¤§çº¿ç¨‹æ•°<ul><li>maximumPoolSize - corePoolSize = æ•‘æ€¥çº¿ç¨‹æ•°</li></ul></li><li>keepAliveTimeï¼šæ•‘æ€¥çº¿ç¨‹ç©ºé—²æ—¶çš„æœ€å¤§ç”Ÿå­˜æ—¶é—´</li><li>unitï¼šæ—¶é—´å•ä½</li><li>workQueueï¼šé˜»å¡é˜Ÿåˆ—ï¼ˆå­˜æ”¾ä»»åŠ¡ï¼‰<ul><li>æœ‰ç•Œé˜»å¡é˜Ÿåˆ— ArrayBlockingQueue</li><li>æ— ç•Œé˜»å¡é˜Ÿåˆ— LinkedBlockingQueue</li><li>æœ€å¤šåªæœ‰ä¸€ä¸ªåŒæ­¥å…ƒç´ çš„ SynchronousQueue</li><li>ä¼˜å…ˆé˜Ÿåˆ— PriorityBlockingQueue</li></ul></li><li>threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼ˆç»™çº¿ç¨‹å–åå­—ï¼‰</li><li>handlerï¼šæ‹’ç»ç­–ç•¥</li></ul><h5 id="å·¥ä½œæ–¹å¼"><a href="#å·¥ä½œæ–¹å¼" class="headerlink" title="å·¥ä½œæ–¹å¼"></a>å·¥ä½œæ–¹å¼</h5><ul><li>å½“ä¸€ä¸ªä»»åŠ¡ä¼ ç»™çº¿ç¨‹æ± ä»¥åï¼Œå¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½<ul><li>å°†ä»»åŠ¡åˆ†é…ç»™ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œ</li><li>æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œå°†ä»»åŠ¡æ”¾åˆ°é˜»å¡é˜Ÿåˆ—workQueueä¸­ç­‰å¾…è¢«æ‰§è¡Œ</li><li>é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä½¿ç”¨æ•‘æ€¥çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡<ul><li>æ•‘æ€¥çº¿ç¨‹ç”¨å®Œä»¥åï¼Œè¶…è¿‡ç”Ÿå­˜æ—¶é—´ï¼ˆkeepAliveTimeï¼‰åä¼šè¢«é‡Šæ”¾</li></ul></li><li>ä»»åŠ¡æ€»æ•°å¤§äºäº† æœ€å¤§çº¿ç¨‹æ•°ï¼ˆmaximumPoolSizeï¼‰ä¸é˜»å¡é˜Ÿåˆ—å®¹é‡çš„æœ€å¤§å€¼ï¼ˆworkQueue.capacityï¼‰ï¼Œä½¿ç”¨æ‹’æ¥ç­–ç•¥</li></ul></li></ul><h5 id="æ‹’ç»ç­–ç•¥"><a href="#æ‹’ç»ç­–ç•¥" class="headerlink" title="æ‹’ç»ç­–ç•¥"></a>æ‹’ç»ç­–ç•¥</h5><p>å¦‚æœçº¿ç¨‹åˆ°è¾¾ maximumPoolSize ä»ç„¶æœ‰æ–°ä»»åŠ¡è¿™æ—¶ä¼šæ‰§è¡Œ<strong>æ‹’ç»ç­–ç•¥</strong>ã€‚æ‹’ç»ç­–ç•¥ jdk æä¾›äº† 4 ç§å®ç°</p><p><a href="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022194718.png"><img src="https://nyimapicture.oss-cn-beijing.aliyuncs.com/img/20201022194718.png" alt="img"></a></p><ul><li>AbortPolicyï¼šè®©è°ƒç”¨è€…æŠ›å‡º RejectedExecutionException å¼‚å¸¸ï¼Œ<strong>è¿™æ˜¯é»˜è®¤ç­–ç•¥</strong></li><li>CallerRunsPolicyï¼šè®©è°ƒç”¨è€…è¿è¡Œä»»åŠ¡</li><li>DiscardPolicyï¼šæ”¾å¼ƒæœ¬æ¬¡ä»»åŠ¡</li><li>DiscardOldestPolicyï¼šæ”¾å¼ƒé˜Ÿåˆ—ä¸­æœ€æ—©çš„ä»»åŠ¡ï¼Œæœ¬ä»»åŠ¡å–è€Œä»£ä¹‹</li></ul><h5 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Demo1</span> </span>&#123;<br>   <span class="hljs-keyword">static</span> AtomicInteger threadId = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">0</span>);<br><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-comment">// æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span><br>      <span class="hljs-comment">// åˆ›å»ºæœ‰ç•Œé˜»å¡é˜Ÿåˆ—</span><br>      ArrayBlockingQueue&lt;Runnable&gt; runnable = <span class="hljs-keyword">new</span> ArrayBlockingQueue&lt;Runnable&gt;(<span class="hljs-number">10</span>);<br>      <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹å·¥å‚</span><br>      ThreadFactory threadFactory = <span class="hljs-keyword">new</span> ThreadFactory() &#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> Thread <span class="hljs-title">newThread</span><span class="hljs-params">(Runnable r)</span> </span>&#123;<br>            Thread thread = <span class="hljs-keyword">new</span> Thread(r, <span class="hljs-string">&quot;working_thread_&quot;</span>+threadId.getAndIncrement());<br>            <span class="hljs-keyword">return</span> thread;<br>         &#125;<br>      &#125;;<br><br>      <span class="hljs-comment">// æ‰‹åŠ¨åˆ›å»ºçº¿ç¨‹æ± </span><br>      <span class="hljs-comment">// æ‹’ç»ç­–ç•¥é‡‡ç”¨é»˜è®¤ç­–ç•¥</span><br>      ThreadPoolExecutor executor = <span class="hljs-keyword">new</span> ThreadPoolExecutor(<span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS, runnable, threadFactory);<br><br>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) &#123;<br>         executor.execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>               System.out.println(Thread.currentThread());<br>               <span class="hljs-keyword">try</span> &#123;<br>                  Thread.sleep(<span class="hljs-number">100000</span>);<br>               &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                  e.printStackTrace();<br>               &#125;<br>            &#125;<br>         &#125;);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="FixedThreadPool"><a href="#FixedThreadPool" class="headerlink" title="FixedThreadPool"></a>FixedThreadPool</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestFixedThreadPool</span> </span>&#123;<br>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>      <span class="hljs-comment">// è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚</span><br>      ThreadFactory factory = <span class="hljs-keyword">new</span> ThreadFactory() &#123;<br>         AtomicInteger atomicInteger = <span class="hljs-keyword">new</span> AtomicInteger(<span class="hljs-number">1</span>);<br><br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> Thread <span class="hljs-title">newThread</span><span class="hljs-params">(Runnable r)</span> </span>&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Thread(r, <span class="hljs-string">&quot;myThread_&quot;</span> + atomicInteger.getAndIncrement());<br>         &#125;<br>      &#125;;<br><br>      <span class="hljs-comment">// åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ•°é‡ä¸º2çš„çº¿ç¨‹æ± </span><br>      <span class="hljs-comment">// é€šè¿‡ ThreadFactoryå¯ä»¥ç»™çº¿ç¨‹æ·»åŠ åå­—</span><br><br>      ExecutorService executorService = Executors.newFixedThreadPool(<span class="hljs-number">2</span>, factory);<br><br>      <span class="hljs-comment">// ä»»åŠ¡</span><br>      Runnable runnable = <span class="hljs-keyword">new</span> Runnable() &#123;<br>         <span class="hljs-meta">@Override</span><br>         <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>            System.out.println(Thread.currentThread().getName());<br>            System.out.println(<span class="hljs-string">&quot;this is fixedThreadPool&quot;</span>);<br>         &#125;<br>      &#125;;<br>      <br>      executorService.execute(runnable);<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å›ºå®šå¤§å°çš„çº¿ç¨‹æ± å¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°</p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼šnThreads</li><li>çº¿ç¨‹å·¥å‚ï¼šthreadFactory</li></ul><p>å†…éƒ¨è°ƒç”¨çš„æ„é€ æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadPoolExecutor(nThreads, nThreads,<br>                              <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>                              <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(),<br>                              threadFactory);<br></code></pre></td></tr></table></figure><h4 id="CachedThreadPool"><a href="#CachedThreadPool" class="headerlink" title="CachedThreadPool"></a>CachedThreadPool</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ExecutorService executorService = Executors.newCachedThreadPool();<br></code></pre></td></tr></table></figure><p><strong>å†…éƒ¨æ„é€ æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">ThreadPoolExecutor(<span class="hljs-number">0</span>, Integer.MAX_VALUE,<br>                              <span class="hljs-number">60L</span>, TimeUnit.SECONDS,<br>                              <span class="hljs-keyword">new</span> SynchronousQueue&lt;Runnable&gt;());<br></code></pre></td></tr></table></figure><ul><li><p>æ²¡æœ‰æ ¸å¿ƒçº¿ç¨‹ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUEï¼Œ<strong>æ‰€æœ‰åˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯æ•‘æ€¥çº¿ç¨‹</strong>ï¼Œç©ºé—²æ—¶ç”Ÿå­˜æ—¶é—´ä¸º60ç§’</p></li><li><p>é˜»å¡é˜Ÿåˆ—ä½¿ç”¨çš„æ˜¯SynchronousQueue</p><ul><li><p>SynchronousQueue</p><p>æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—</p><ul><li><strong>æ²¡æœ‰å®¹é‡</strong>ï¼Œæ²¡æœ‰çº¿ç¨‹æ¥å–æ˜¯æ”¾ä¸è¿›å»çš„</li><li>åªæœ‰å½“çº¿ç¨‹å–ä»»åŠ¡æ—¶ï¼Œæ‰ä¼šå°†ä»»åŠ¡æ”¾å…¥è¯¥é˜»å¡é˜Ÿåˆ—ä¸­</li></ul></li></ul></li></ul><h4 id="SingleThread"><a href="#SingleThread" class="headerlink" title="SingleThread"></a>SingleThread</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">ExecutorService service = Executors.newSingleThreadExecutor();<br></code></pre></td></tr></table></figure><p><strong>å†…éƒ¨æ„é€ æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> FinalizableDelegatedExecutorService<br>    (<span class="hljs-keyword">new</span> ThreadPoolExecutor(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,<br>                            <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,<br>                            <span class="hljs-keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));<br></code></pre></td></tr></table></figure><p>å†…éƒ¨è°ƒç”¨äº†<strong>new ThreadPoolExecutor</strong>çš„æ„é€ æ–¹æ³•ï¼Œä¼ å…¥çš„corePoolSizeå’ŒmaximumPoolSizeéƒ½ä¸º1ã€‚ç„¶åå°†è¯¥å¯¹è±¡ä¼ ç»™äº†FinalizableDelegatedExecutorServiceã€‚è¯¥ç±»ä¿®é¥°äº†ThreadPoolExecutorï¼Œè®©å¤–éƒ¨æ— æ³•è°ƒç”¨ThreadPoolExecutorå†…éƒ¨çš„æŸäº›æ–¹æ³•æ¥ä¿®æ”¹æ‰€åˆ›å»ºçš„çº¿ç¨‹æ± çš„å¤§å°ã€‚</p><h5 id="å‡ ä¸ªæ³¨æ„"><a href="#å‡ ä¸ªæ³¨æ„" class="headerlink" title="å‡ ä¸ªæ³¨æ„"></a>å‡ ä¸ªæ³¨æ„</h5><ul><li><p>SingleThreadå’Œè‡ªå·±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥è¿è¡Œå¤šä¸ªä»»åŠ¡çš„åŒºåˆ«</p><ul><li>å½“çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå¦‚æœæ˜¯è‡ªå·±åˆ›å»ºçš„çº¿ç¨‹ï¼Œè¯¥ä»»åŠ¡å’Œå‰©ä½™çš„ä»»åŠ¡å°±æ— æ³•å†ç»§ç»­è¿è¡Œä¸‹å»ã€‚è€ŒSingleThreadä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œç»§ç»­æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—ä¸­å‰©ä½™çš„ä»»åŠ¡ã€‚</li></ul></li><li><p>SingleThreadå’ŒnewFixedThreadPool(1)çš„åŒºåˆ«</p><ul><li>newFixedThreadPool(1)ä¼ å€¼ä¸º1ï¼Œå¯ä»¥å°†FixedThreadPoolå¼ºè½¬ä¸ºThreadPoolExecutorï¼Œç„¶åé€šè¿‡setCorePoolSizeæ”¹å˜æ ¸å¿ƒçº¿ç¨‹æ•°</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¼ºè½¬ä¸ºThreadPoolExecutor</span><br>ThreadPoolExecutor threadPool = (ThreadPoolExecutor) Executors.newFixedThreadPool(<span class="hljs-number">1</span>);<br><span class="hljs-comment">// æ”¹å˜æ ¸å¿ƒçº¿ç¨‹æ•°</span><br>threadPool.setCorePoolSize(<span class="hljs-number">2</span>);<br></code></pre></td></tr></table></figure><ul><li>è€ŒSingleThreadæ— æ³•ä¿®æ”¹æ ¸å¿ƒçº¿ç¨‹æ•°</li></ul></li></ul><h4 id="æ‰§è¡Œä»»åŠ¡"><a href="#æ‰§è¡Œä»»åŠ¡" class="headerlink" title="æ‰§è¡Œä»»åŠ¡"></a>æ‰§è¡Œä»»åŠ¡</h4><h5 id="execute-æ–¹æ³•"><a href="#execute-æ–¹æ³•" class="headerlink" title="execute()æ–¹æ³•"></a>execute()æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">execute(Runnable command)<br></code></pre></td></tr></table></figure><p>ä¼ å…¥ä¸€ä¸ªRunnableå¯¹è±¡ï¼Œæ‰§è¡Œå…¶ä¸­çš„runæ–¹æ³•</p><p><strong>æºç è§£æ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (command == <span class="hljs-keyword">null</span>)<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br><br>    <span class="hljs-comment">// è·å–ctl</span><br>    <span class="hljs-keyword">int</span> c = ctl.get();<br>    <br>    <span class="hljs-comment">// åˆ¤æ–­å½“å‰å¯ç”¨çš„çº¿ç¨‹æ•°æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•°</span><br>    <span class="hljs-keyword">if</span> (workerCountOf(c) &lt; corePoolSize) &#123;<br>        <span class="hljs-comment">// ä¸ºè¯¥ä»»åŠ¡åˆ†é…çº¿ç¨‹</span><br>        <span class="hljs-keyword">if</span> (addWorker(command, <span class="hljs-keyword">true</span>))<br>            <span class="hljs-comment">// åˆ†é…æˆåŠŸå°±è¿”å›</span><br>            <span class="hljs-keyword">return</span>;<br>        <br>        <span class="hljs-comment">// åˆ†é…å¤±è´¥å†æ¬¡è·å–ctl</span><br>        c = ctl.get();<br>    &#125;<br>    <br>    <span class="hljs-comment">// åˆ†é…å’Œä¿¡æ¯çº¿ç¨‹å¤±è´¥ä»¥å</span><br>    <span class="hljs-comment">// å¦‚æœæ± çŠ¶æ€ä¸ºRUNNINGå¹¶ä¸”æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—æˆåŠŸ</span><br>    <span class="hljs-keyword">if</span> (isRunning(c) &amp;&amp; workQueue.offer(command)) &#123;<br>        <br>        <span class="hljs-comment">// åŒé‡æ£€æµ‹ï¼Œå¯èƒ½åœ¨æ·»åŠ åçº¿ç¨‹æ± çŠ¶æ€å˜ä¸ºäº†éRUNNING</span><br>        <span class="hljs-keyword">int</span> recheck = ctl.get();<br>        <br>        <span class="hljs-comment">// å¦‚æœæ± çŠ¶æ€ä¸ºéRUNNINGï¼Œåˆ™ä¸ä¼šæ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡</span><br>        <span class="hljs-comment">// å°†è¯¥ä»»åŠ¡ä»é˜»å¡é˜Ÿåˆ—ä¸­ç§»é™¤</span><br>        <span class="hljs-keyword">if</span> (! isRunning(recheck) &amp;&amp; remove(command))<br>            <span class="hljs-comment">// è°ƒç”¨æ‹’ç»ç­–ç•¥ï¼Œæ‹’ç»è¯¥ä»»åŠ¡çš„æ‰§è¡Œ</span><br>            reject(command);<br>        <br>        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹</span><br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (workerCountOf(recheck) == <span class="hljs-number">0</span>)<br>            <span class="hljs-comment">// å°±åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡</span><br>            addWorker(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">false</span>);<br>    &#125;<br>    <br>    <span class="hljs-comment">// å¦‚æœæ·»åŠ å¤±è´¥äº†ï¼ˆä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œå°±è°ƒç”¨æ‹’ç»ç­–ç•¥</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!addWorker(command, <span class="hljs-keyword">false</span>))<br>        reject(command);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­è°ƒç”¨äº†**addWoker()**æ–¹æ³•ï¼Œå†çœ‹çœ‹çœ‹è¿™ä¸ªæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">addWorker</span><span class="hljs-params">(Runnable firstTask, <span class="hljs-keyword">boolean</span> core)</span> </span>&#123;<br>    retry:<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-keyword">int</span> c = ctl.get();<br>        <span class="hljs-keyword">int</span> rs = runStateOf(c);<br><br>        <span class="hljs-comment">// Check if queue empty only if necessary.</span><br>        <span class="hljs-comment">// å¦‚æœæ± çŠ¶æ€ä¸ºéRUNNINGçŠ¶æ€ã€çº¿ç¨‹æ± ä¸ºSHUTDOWNä¸”è¯¥ä»»åŠ¡ä¸ºç©º æˆ–è€…é˜»å¡é˜Ÿåˆ—ä¸­å·²ç»æœ‰ä»»åŠ¡</span><br>        <span class="hljs-keyword">if</span> (rs &gt;= SHUTDOWN &amp;&amp;<br>            ! (rs == SHUTDOWN &amp;&amp;<br>               firstTask == <span class="hljs-keyword">null</span> &amp;&amp;<br>               ! workQueue.isEmpty()))<br>            <span class="hljs-comment">// åˆ›å»ºæ–°çº¿ç¨‹å¤±è´¥</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br><br>        <span class="hljs-keyword">for</span> (;;) &#123;<br>            <span class="hljs-comment">// è·å¾—å½“å‰å·¥ä½œçº¿ç¨‹æ•°</span><br>            <span class="hljs-keyword">int</span> wc = workerCountOf(c);<br><br>            <span class="hljs-comment">// å‚æ•°ä¸­ core ä¸ºtrue</span><br>            <span class="hljs-comment">// CAPACITY ä¸º 1 &lt;&lt; COUNT_BITS-1ï¼Œä¸€èˆ¬ä¸ä¼šè¶…è¿‡</span><br>            <span class="hljs-comment">// å¦‚æœå·¥ä½œçº¿ç¨‹æ•°å¤§äºäº†æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºå¤±è´¥</span><br>            <span class="hljs-keyword">if</span> (wc &gt;= CAPACITY ||<br>                wc &gt;= (core ? corePoolSize : maximumPoolSize))<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>            <span class="hljs-comment">// é€šè¿‡CASæ“ä½œæ”¹å˜cçš„å€¼</span><br>            <span class="hljs-keyword">if</span> (compareAndIncrementWorkerCount(c))<br>                <span class="hljs-comment">// æ›´æ”¹æˆåŠŸå°±è·³å‡ºå¤šé‡å¾ªç¯ï¼Œä¸”ä¸å†è¿è¡Œå¾ªç¯</span><br>                <span class="hljs-keyword">break</span> retry;<br>            <span class="hljs-comment">// æ›´æ”¹å¤±è´¥ï¼Œé‡æ–°è·å–ctlçš„å€¼</span><br>            c = ctl.get();  <span class="hljs-comment">// Re-read ctl</span><br>            <span class="hljs-keyword">if</span> (runStateOf(c) != rs)<br>                <span class="hljs-comment">// è·³å‡ºå¤šé‡å¾ªç¯ï¼Œä¸”é‡æ–°è¿›å…¥å¾ªç¯</span><br>                <span class="hljs-keyword">continue</span> retry;<br>            <span class="hljs-comment">// else CAS failed due to workerCount change; retry inner loop</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// ç”¨äºæ ‡è®°workä¸­çš„ä»»åŠ¡æ˜¯å¦æˆåŠŸæ‰§è¡Œ</span><br>    <span class="hljs-keyword">boolean</span> workerStarted = <span class="hljs-keyword">false</span>;<br>    <span class="hljs-comment">// ç”¨äºæ ‡è®°workeræ˜¯å¦æˆåŠŸåŠ å…¥äº†çº¿ç¨‹æ± ä¸­</span><br>    <span class="hljs-keyword">boolean</span> workerAdded = <span class="hljs-keyword">false</span>;<br>    Worker w = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»ºæ–°çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡</span><br>        w = <span class="hljs-keyword">new</span> Worker(firstTask);<br>        <span class="hljs-keyword">final</span> Thread t = w.thread;<br>        <span class="hljs-keyword">if</span> (t != <span class="hljs-keyword">null</span>) &#123;<br>            <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;<br>            <span class="hljs-comment">// åŠ é”</span><br>            mainLock.lock();<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// Recheck while holding lock.</span><br>                <span class="hljs-comment">// Back out on ThreadFactory failure or if</span><br>                <span class="hljs-comment">// shut down before lock acquired.</span><br>                <span class="hljs-comment">// åŠ é”çš„åŒæ—¶å†æ¬¡æ£€æµ‹</span><br>                <span class="hljs-comment">// é¿å…åœ¨é‡Šæ”¾é”ä¹‹å‰è°ƒç”¨äº†shut down</span><br>                <span class="hljs-keyword">int</span> rs = runStateOf(ctl.get());<br><br>                <span class="hljs-keyword">if</span> (rs &lt; SHUTDOWN ||<br>                    (rs == SHUTDOWN &amp;&amp; firstTask == <span class="hljs-keyword">null</span>)) &#123;<br>                    <span class="hljs-keyword">if</span> (t.isAlive()) <span class="hljs-comment">// precheck that t is startable</span><br>                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalThreadStateException();<br>                    <span class="hljs-comment">// å°†çº¿ç¨‹æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­</span><br>                    workers.add(w);<br>                    <span class="hljs-keyword">int</span> s = workers.size();<br>                    <span class="hljs-keyword">if</span> (s &gt; largestPoolSize)<br>                        largestPoolSize = s;<br>                    <span class="hljs-comment">// æ·»åŠ æˆåŠŸæ ‡å¿—ä½å˜ä¸ºtrue</span><br>                    workerAdded = <span class="hljs-keyword">true</span>;<br>                &#125;<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                mainLock.unlock();<br>            &#125;<br>            <span class="hljs-comment">// å¦‚æœworkeræˆåŠŸåŠ å…¥äº†çº¿ç¨‹æ± ï¼Œå°±æ‰§è¡Œå…¶ä¸­çš„ä»»åŠ¡</span><br>            <span class="hljs-keyword">if</span> (workerAdded) &#123;<br>                t.start();<br>                <span class="hljs-comment">// å¯åŠ¨æˆåŠŸ</span><br>                workerStarted = <span class="hljs-keyword">true</span>;<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-comment">// å¦‚æœæ‰§è¡Œå¤±è´¥</span><br>        <span class="hljs-keyword">if</span> (! workerStarted)<br>            <span class="hljs-comment">// è°ƒç”¨æ·»åŠ å¤±è´¥çš„å‡½æ•°</span><br>            addWorkerFailed(w);<br>    &#125;<br>    <span class="hljs-keyword">return</span> workerStarted;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="submit-æ–¹æ³•"><a href="#submit-æ–¹æ³•" class="headerlink" title="submit()æ–¹æ³•"></a>submit()æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;T&gt; <span class="hljs-function">Future&lt;T&gt; <span class="hljs-title">submit</span><span class="hljs-params">(Callable&lt;T&gt; task)</span> </span><br></code></pre></td></tr></table></figure><p>ä¼ å…¥ä¸€ä¸ªCallableå¯¹è±¡ï¼Œç”¨Futureæ¥<strong>æ•è·è¿”å›å€¼</strong></p><p><strong>ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€šè¿‡submitæ‰§è¡ŒCallableä¸­çš„callæ–¹æ³•</span><br><span class="hljs-comment">// é€šè¿‡Futureæ¥æ•è·è¿”å›å€¼</span><br>Future&lt;String&gt; future = threadPool.submit(<span class="hljs-keyword">new</span> Callable&lt;String&gt;() &#123;<br>   <span class="hljs-meta">@Override</span><br>   <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;hello submit&quot;</span>;<br>   &#125;<br>&#125;);<br><br><span class="hljs-comment">// æŸ¥çœ‹æ•è·çš„è¿”å›å€¼</span><br>System.out.println(future.get());<br></code></pre></td></tr></table></figure><h5 id="invokeAll-æ–¹æ³•"><a href="#invokeAll-æ–¹æ³•" class="headerlink" title="invokeAll()æ–¹æ³•"></a>invokeAll()æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;T&gt; List&lt;Future&lt;T&gt;&gt; invokeAll(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks) <span class="hljs-keyword">throws</span> InterruptedException; <br></code></pre></td></tr></table></figure><p>ä¼ å…¥ä¸€ä¸ªåŒ…å«æœ‰Callableå¯¹è±¡çš„collectioné›†åˆ tasksï¼Œç”¨List&lt;Future<T>&gt;æ¥<strong>æ•è·å…¨éƒ¨è¿”å›å€¼</strong></p><p><strong>ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€šè¿‡invokeAllæ‰§è¡ŒArrayä¸­çš„3ä¸ªcallæ–¹æ³•</span><br><span class="hljs-comment">// é€šè¿‡Futuresæ¥æ•è·è¿”å›å€¼</span><br>List&lt;Future&lt;String&gt;&gt; futures = threadPool.invokeAll(Arrays.asList(<br>() -&gt; &#123;<br>        System.out.println(<span class="hljs-string">&quot;begin&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span>;<br>    &#125;,<br>    () -&gt; &#123;<br>        System.out.println(<span class="hljs-string">&quot;begin&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">500</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;2&quot;</span>;<br>    &#125;,<br>    () -&gt; &#123;<br>        System.out.println(<span class="hljs-string">&quot;begin&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">2000</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;3&quot;</span>;<br>    &#125;<br>));<br><br><span class="hljs-comment">// æŸ¥çœ‹æ•è·çš„è¿”å›å€¼</span><br>futures.forEach(f -&gt; &#123;<br>    <span class="hljs-keyword">try</span>&#123;<br>        System.out.println(f.get);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        e,printStackTrace();<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h5 id="invokeAny-æ–¹æ³•"><a href="#invokeAny-æ–¹æ³•" class="headerlink" title="invokeAny()æ–¹æ³•"></a>invokeAny()æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;T&gt; <span class="hljs-function">T <span class="hljs-title">invokeAll</span><span class="hljs-params">(Collection&lt;? extends Callable&lt;T&gt;&gt; tasks)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException</span>; <br></code></pre></td></tr></table></figure><p>ä¼ å…¥ä¸€ä¸ªåŒ…å«æœ‰Callableå¯¹è±¡çš„collectioné›†åˆ tasksï¼Œ<strong>è¿”è¿˜æœ€å…ˆæˆåŠŸæ‰§è¡Œå®Œæ¯•çš„ä»»åŠ¡ç»“æœï¼Œå…¶ä»–ä»»åŠ¡å–æ¶ˆ</strong></p><p><strong>ä½¿ç”¨</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// é€šè¿‡submitæ‰§è¡ŒCallableä¸­çš„callæ–¹æ³•</span><br><span class="hljs-comment">// é€šè¿‡Futureæ¥æ•è·è¿”å›å€¼</span><br>String rs = threadPool.invokeAny(Arrays.asList(<br>() -&gt; &#123;<br>        System.out.println(<span class="hljs-string">&quot;begin&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">1000</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span>;<br>    &#125;,<br>    () -&gt; &#123;<br>        System.out.println(<span class="hljs-string">&quot;begin&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">500</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;2&quot;</span>;<br>    &#125;,<br>    () -&gt; &#123;<br>        System.out.println(<span class="hljs-string">&quot;begin&quot;</span>);<br>        Thread.sleep(<span class="hljs-number">2000</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;3&quot;</span>;<br>    &#125;<br>));<br><br><span class="hljs-comment">// æŸ¥çœ‹è¿”å›å€¼</span><br>System.out.println(rs);<br></code></pre></td></tr></table></figure><h4 id="åœæ­¢"><a href="#åœæ­¢" class="headerlink" title="åœæ­¢"></a>åœæ­¢</h4><h5 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown()"></a>shutdown()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* å°†çº¿ç¨‹æ± çš„çŠ¶æ€æ”¹ä¸º SHUTDOWN</span><br><span class="hljs-comment">* ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä½†æ˜¯ä¼šå°†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œ</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">shutdown</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;<br>    mainLock.lock();<br>    <span class="hljs-keyword">try</span> &#123;<br>        checkShutdownAccess();<br>        <br>        <span class="hljs-comment">// ä¿®æ”¹çº¿ç¨‹æ± çŠ¶æ€ä¸º SHUTDOWN</span><br>        advanceRunState(SHUTDOWN);<br>        <br>  <span class="hljs-comment">// ä¸­æ–­ç©ºé—²çº¿ç¨‹ï¼ˆæ²¡æœ‰æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼‰</span><br>        <span class="hljs-comment">// Idleï¼šç©ºé—²çš„</span><br>        interruptIdleWorkers();<br>        onShutdown(); <span class="hljs-comment">// hook for ScheduledThreadPoolExecutor</span><br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        mainLock.unlock();<br>    &#125;<br>    <span class="hljs-comment">// å°è¯•ç»ˆç»“ï¼Œä¸ä¸€å®šæˆåŠŸ</span><br>    <span class="hljs-comment">// </span><br>    tryTerminate();<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tryTerminate</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-keyword">int</span> c = ctl.get();<br>        <span class="hljs-comment">// ç»ˆç»“å¤±è´¥çš„æ¡ä»¶</span><br>        <span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€ä¸ºRUNNING</span><br>        <span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€ä¸º RUNNING SHUTDOWN STOP ï¼ˆçŠ¶æ€å€¼å¤§äºTIDYINGï¼‰</span><br>        <span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€ä¸ºSHUTDOWNï¼Œä½†é˜»å¡é˜Ÿåˆ—ä¸­è¿˜æœ‰ä»»åŠ¡ç­‰å¾…æ‰§è¡Œ</span><br>        <span class="hljs-keyword">if</span> (isRunning(c) ||<br>            runStateAtLeast(c, TIDYING) ||<br>            (runStateOf(c) == SHUTDOWN &amp;&amp; ! workQueue.isEmpty()))<br>            <span class="hljs-keyword">return</span>;<br>        <br>        <span class="hljs-comment">// å¦‚æœæ´»è·ƒçº¿ç¨‹æ•°ä¸ä¸º0</span><br>        <span class="hljs-keyword">if</span> (workerCountOf(c) != <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// Eligible to terminate</span><br>            <span class="hljs-comment">// ä¸­æ–­ç©ºé—²çº¿ç¨‹</span><br>            interruptIdleWorkers(ONLY_ONE);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;<br>        mainLock.lock();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// å¤„äºå¯ä»¥ç»ˆç»“çš„çŠ¶æ€</span><br>            <span class="hljs-comment">// é€šè¿‡CASå°†çº¿ç¨‹æ± çŠ¶æ€æ”¹ä¸ºTIDYING</span><br>            <span class="hljs-keyword">if</span> (ctl.compareAndSet(c, ctlOf(TIDYING, <span class="hljs-number">0</span>))) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    terminated();<br>                &#125; <span class="hljs-keyword">finally</span> &#123;<br>                    <span class="hljs-comment">// é€šè¿‡CASå°†çº¿ç¨‹æ± çŠ¶æ€æ”¹ä¸ºTERMINATED</span><br>                    ctl.set(ctlOf(TERMINATED, <span class="hljs-number">0</span>));<br>                    termination.signalAll();<br>                &#125;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            mainLock.unlock();<br>        &#125;<br>        <span class="hljs-comment">// else retry on failed CAS</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="shutdownNow"><a href="#shutdownNow" class="headerlink" title="shutdownNow()"></a>shutdownNow()</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* å°†çº¿ç¨‹æ± çš„çŠ¶æ€æ”¹ä¸º STOP</span><br><span class="hljs-comment">* ä¸å†æ¥å—æ–°ä»»åŠ¡ï¼Œä¹Ÿä¸ä¼šåœ¨æ‰§è¡Œé˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</span><br><span class="hljs-comment">* ä¼šå°†é˜»å¡é˜Ÿåˆ—ä¸­æœªæ‰§è¡Œçš„ä»»åŠ¡è¿”å›ç»™è°ƒç”¨è€…</span><br><span class="hljs-comment">*/</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Runnable&gt; <span class="hljs-title">shutdownNow</span><span class="hljs-params">()</span> </span>&#123;<br>    List&lt;Runnable&gt; tasks;<br>    <span class="hljs-keyword">final</span> ReentrantLock mainLock = <span class="hljs-keyword">this</span>.mainLock;<br>    mainLock.lock();<br>    <span class="hljs-keyword">try</span> &#123;<br>        checkShutdownAccess();<br>        <br>        <span class="hljs-comment">// ä¿®æ”¹çŠ¶æ€ä¸ºSTOPï¼Œä¸æ‰§è¡Œä»»ä½•ä»»åŠ¡</span><br>        advanceRunState(STOP);<br>        <br>        <span class="hljs-comment">// ä¸­æ–­æ‰€æœ‰çº¿ç¨‹</span><br>        interruptWorkers();<br>        <br>        <span class="hljs-comment">// å°†æœªæ‰§è¡Œçš„ä»»åŠ¡ä»é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œç„¶åè¿”å›ç»™è°ƒç”¨è€…</span><br>        tasks = drainQueue();<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        mainLock.unlock();<br>    &#125;<br>    <span class="hljs-comment">// å°è¯•ç»ˆç»“ï¼Œä¸€å®šä¼šæˆåŠŸï¼Œå› ä¸ºé˜»å¡é˜Ÿåˆ—ä¸ºç©ºäº†</span><br>    tryTerminate();<br>    <span class="hljs-keyword">return</span> tasks;<br>&#125;<br></code></pre></td></tr></table></figure><h5 id="å…¶ä»–æ–¹æ³•"><a href="#å…¶ä»–æ–¹æ³•" class="headerlink" title="å…¶ä»–æ–¹æ³•"></a>å…¶ä»–æ–¹æ³•</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä¸åœ¨ RUNNING çŠ¶æ€çš„çº¿ç¨‹æ± ï¼Œæ­¤æ–¹æ³•å°±è¿”å› true</span><br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isShutdown</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-comment">// çº¿ç¨‹æ± çŠ¶æ€æ˜¯å¦æ˜¯ TERMINATED</span><br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isTerminated</span><span class="hljs-params">()</span></span>;<br><br><span class="hljs-comment">// è°ƒç”¨ shutdown åï¼Œç”±äºè°ƒç”¨çº¿ç¨‹å¹¶ä¸ä¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡è¿è¡Œç»“æŸï¼Œå› æ­¤å¦‚æœå®ƒæƒ³åœ¨çº¿ç¨‹æ±  TERMINATED ååšäº›äº‹æƒ…ï¼Œå¯ä»¥åˆ©ç”¨æ­¤æ–¹æ³•ç­‰å¾…</span><br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">awaitTermination</span><span class="hljs-params">(<span class="hljs-keyword">long</span> timeout, TimeUnit unit)</span> <span class="hljs-keyword">throws</span> InterruptedException</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>JUC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>JUC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GCå¹¶å‘æ ‡è®°çš„é—®é¢˜</title>
    <link href="/2021/04/11/GC%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <url>/2021/04/11/GC%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0%E7%9A%84%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="GCå¹¶å‘æ ‡è®°çš„é—®é¢˜"><a href="#GCå¹¶å‘æ ‡è®°çš„é—®é¢˜" class="headerlink" title="GCå¹¶å‘æ ‡è®°çš„é—®é¢˜"></a>GCå¹¶å‘æ ‡è®°çš„é—®é¢˜</h1><p>åœ¨æœ€å¼€å§‹å­¦ä¹ åƒåœ¾å›æ”¶å™¨å¹¶å‘æ ‡è®°çš„é—®é¢˜æ—¶ï¼Œç†è§£çš„ä¸å¤Ÿåˆ°ä½ï¼Œè¿™é‡Œç»“åˆé©¬å£«å…µçš„è®²è§£è®°å½•ä¸€ä¸‹(é©¬å£«å…µå–œæ¬¢è®²ä¸€åŠï¼Œæ•…å¼„ç„è™šğŸ˜’)</p><h2 id="1-åƒåœ¾å›æ”¶å™¨ï¼ˆ10ç§ï¼‰"><a href="#1-åƒåœ¾å›æ”¶å™¨ï¼ˆ10ç§ï¼‰" class="headerlink" title="1.åƒåœ¾å›æ”¶å™¨ï¼ˆ10ç§ï¼‰"></a>1.åƒåœ¾å›æ”¶å™¨ï¼ˆ10ç§ï¼‰</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_1_20210411.png"></p><p>java 1.8é»˜è®¤Parallel Scavenge + Parallel Old</p><p>åƒåœ¾å›æ”¶å™¨åˆ†ä¸º</p><ul><li>åˆ†ä»£æ¨¡å‹ï¼ˆå·¦6ï¼‰</li><li>ä¸åˆ†ä»£æ¨¡å‹ï¼ˆå³3ï¼‰</li></ul><h2 id="2-åˆ¤æ–­å¯¹è±¡èƒ½å¦å›æ”¶"><a href="#2-åˆ¤æ–­å¯¹è±¡èƒ½å¦å›æ”¶" class="headerlink" title="2. åˆ¤æ–­å¯¹è±¡èƒ½å¦å›æ”¶"></a>2. åˆ¤æ–­å¯¹è±¡èƒ½å¦å›æ”¶</h2><h3 id="2-1-å¼•ç”¨è®¡æ•°"><a href="#2-1-å¼•ç”¨è®¡æ•°" class="headerlink" title="2.1 å¼•ç”¨è®¡æ•°"></a>2.1 å¼•ç”¨è®¡æ•°</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_3_20210411.png"></p><p>å¾ªç¯å¼•ç”¨å¯¹è±¡æ— æ³•å›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²</p><h3 id="2-2-å¯è¾¾æ€§åˆ†æ"><a href="#2-2-å¯è¾¾æ€§åˆ†æ" class="headerlink" title="2.2 å¯è¾¾æ€§åˆ†æ"></a>2.2 å¯è¾¾æ€§åˆ†æ</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_2_20210411.png"></p><ul><li>JVMä¸­çš„åƒåœ¾å›æ”¶å™¨é€šè¿‡<strong>å¯è¾¾æ€§åˆ†æ</strong>æ¥æ¢ç´¢æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡</li><li>æ‰«æå †ä¸­çš„å¯¹è±¡ï¼Œçœ‹èƒ½å¦æ²¿ç€GC Rootå¯¹è±¡ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾æ‰¾åˆ°è¯¥å¯¹è±¡ï¼Œå¦‚æœ<strong>æ‰¾ä¸åˆ°ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å›æ”¶</strong></li><li>å¯ä»¥ä½œä¸ºGC Rootçš„å¯¹è±¡<ul><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚ã€€</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆå³ä¸€èˆ¬è¯´çš„Nativeæ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡</li></ul></li></ul><h2 id="3-å¹¶å‘æ ‡è®°çš„é—®é¢˜"><a href="#3-å¹¶å‘æ ‡è®°çš„é—®é¢˜" class="headerlink" title="3. å¹¶å‘æ ‡è®°çš„é—®é¢˜"></a>3. å¹¶å‘æ ‡è®°çš„é—®é¢˜</h2><h3 id="3-1-ä¸¤ç§æƒ…å†µ"><a href="#3-1-ä¸¤ç§æƒ…å†µ" class="headerlink" title="3.1 ä¸¤ç§æƒ…å†µ"></a>3.1 ä¸¤ç§æƒ…å†µ</h3><ul><li>ä¸€ä¸ªå¯¹è±¡è¢«GCè®¤ä¸ºä¸æ˜¯åƒåœ¾ï¼Œä½†æ˜¯éšç€ä¸šåŠ¡è¿›è¡Œï¼Œå˜æˆåƒåœ¾<ul><li>æµ®åŠ¨åƒåœ¾ floating garbage</li><li>è§£å†³æ–¹æ³•ï¼šä¸‹ä¸€æ¬¡GCæ¸…é™¤</li></ul></li><li>ä¸€ä¸ªå¯¹è±¡è¢«GCè®¤ä¸ºæ˜¯åƒåœ¾ï¼Œéšç€ä¸šåŠ¡è¿›è¡Œï¼Œå˜æˆä¸æ˜¯åƒåœ¾<ul><li>ç¼“å­˜</li></ul></li></ul><h3 id="3-2-ä¸‰è‰²æ ‡è®°æ³•"><a href="#3-2-ä¸‰è‰²æ ‡è®°æ³•" class="headerlink" title="3.2 ä¸‰è‰²æ ‡è®°æ³•"></a>3.2 ä¸‰è‰²æ ‡è®°æ³•</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_4_20210411.png"></p><p>CMSå’ŒG1éƒ½æ˜¯ç”¨çš„ä¸‰è‰²æ ‡è®°æ³•ï¼ˆåŸºäºå¯è¾¾æ€§åˆ†æï¼‰</p><h3 id="3-3-è§£å†³æ–¹æ³•"><a href="#3-3-è§£å†³æ–¹æ³•" class="headerlink" title="3.3 è§£å†³æ–¹æ³•"></a>3.3 è§£å†³æ–¹æ³•</h3><h4 id="æƒ…å†µä¸€"><a href="#æƒ…å†µä¸€" class="headerlink" title="æƒ…å†µä¸€"></a>æƒ…å†µä¸€</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_5_20210411.png"></p><p>å…ˆB-&gt;D</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_6_20210411.png"></p><p>åB-&gt;Dæ¶ˆå¤±</p><blockquote><p>è§£å†³ï¼šä¸‹ä¸€æ¬¡GCæ¸…é™¤æµ®åŠ¨åƒåœ¾</p></blockquote><h4 id="æƒ…å†µäºŒ"><a href="#æƒ…å†µäºŒ" class="headerlink" title="æƒ…å†µäºŒ"></a>æƒ…å†µäºŒ</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_7_20210411.png"></p><p>å…ˆB-&gt;D</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_8_20210411.png"></p><p>åB-&gt;Dæ¶ˆå¤±ï¼ŒA-&gt;Då¢åŠ ï¼Œå¯¼è‡´Dæ¼æ ‡</p><blockquote><p>CMSçš„è§£å†³æ–¹æ¡ˆï¼ˆIncremental Updateï¼‰ï¼š</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_9_20210411.png"></p><p>å­˜åœ¨bug</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_10_20210411x.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_11_20210411.png"></p><p>å› æ­¤CMSåƒåœ¾å›æ”¶å™¨å¿…é¡»è¦æœ‰remarké‡å†™æ ‡è®°é˜¶æ®µï¼Œä»å¤´æ‰«ä¸€é</p><blockquote><p>G1çš„æ–¹æ¡ˆï¼ˆSATB Snapshot-At-The-Beginingï¼‰<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://blog.csdn.net/lu322313/article/details/104763933">[2]</span></a></sup></p></blockquote><ul><li>SATBâ€”Snapshot-At-The-Begining<br>åœ¨G1ä¸­,ä½¿ç”¨çš„æ˜¯SATBæ–¹å¼,åˆ é™¤çš„æ—¶å€™è®°å½•æ‰€æœ‰çš„å¯¹è±¡<br>å®ƒæœ‰3ä¸ªæ­¥éª¤<ul><li><p>åœ¨å¼€å§‹æ ‡è®°çš„æ—¶å€™ç”Ÿæˆä¸€ä¸ªå¿«ç…§å›¾,æ ‡è®°å­˜æ´»å¯¹è±¡</p></li><li><p>åœ¨å¹¶å‘æ ‡è®°çš„æ—¶å€™æ‰€æœ‰è¢«æ”¹å˜çš„å¯¹è±¡å…¥åˆ—(<font color="FF0000">åœ¨write barrier(å†™å±éšœ)é‡ŒæŠŠæ‰€æœ‰æ—§çš„çš„å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡éƒ½å˜æˆéç™½çš„</font>)<img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%B9%B6%E5%8F%91%E6%A0%87%E8%AE%B0_12_20210411.png"></p></li><li><p>å¯èƒ½å­˜åœ¨æµ®åŠ¨åƒåœ¾,å°†åœ¨ä¸‹æ¬¡è¢«æ”¶é›†</p></li></ul></li></ul><p>SATBæ˜¯ç»´æŒå¹¶å‘GCçš„ä¸€ç§æ‰‹æ®µ. G1å¹¶å‘çš„åŸºç¡€å°±æ˜¯SATB</p><p>  SATBå¯ä»¥ç†è§£æˆåœ¨GCå¼€å§‹ä¹‹å‰å¯¹å †å†…å­˜é‡Œçš„å¯¹è±¡åšä¸€æ¬¡å¿«ç…§,æ­¤æ—¶æ´»çš„å¯¹è±¡å°±è®¤ä¸ºæ˜¯æ´»çš„,ä»è€Œå½¢æˆä¸€ä¸ªå¯¹è±¡å›¾</p><ul><li><p>æ ‡è®°GCè¿‡ç¨‹æ‰¾é‚£ä¸ªåˆ†é…çš„å¯¹è±¡<br>åœ¨GCæ”¶é›†çš„æ—¶å€™,æ–°ç”Ÿä»£çš„å¯¹è±¡ä¹Ÿè®¤ä¸ºæ˜¯æ´»çš„å¯¹è±¡,é™¤æ­¤ä¹‹å¤–å…¶ä»–ä¸å¯è¾¾çš„å¯¹è±¡éƒ½è®¤ä¸ºæ˜¯åƒåœ¾å¯¹è±¡</p><p>å¦‚ä½•æ‰¾åˆ°åœ¨GCè¿‡ç¨‹ä¸­åˆ†é…çš„å¯¹è±¡å‘¢?æ¯ä¸ªregionè®°å½•è¿™ä¸¤ä¸ª<font color="FF0000">top-at-mark-start(TAMS)æŒ‡é’ˆ</font>, åˆ†åˆ«ä¸º</p><ul><li><font color="FF0000">prevTAMS</font></li><li><font color="FF0000">nextTAMS</font><br>åœ¨TAMSä»¥ä¸Šçš„å¯¹è±¡å°±æ˜¯æ–°åˆ†é…çš„,å› è€Œè¢«è§†ä¸º<font color="FF0000">éšå¼marked</font><br>é€šè¿‡è¿™ç§æ–¹å¼æˆ‘ä»¬å°±æ‰¾åˆ°äº†åœ¨GCè¿‡ç¨‹ä¸­æ–°åˆ†é…çš„å¯¹è±¡,å¹¶æŠŠè¿™äº›å¯¹è±¡è®¤ä¸ºæ˜¯æ´»çš„çš„å¯¹è±¡</li></ul></li></ul><ul><li><p>å¦‚ä½•è§£å†³GCè¿‡ç¨‹ä¸­çš„å¼•ç”¨å˜åŒ–<br>è§£å†³äº†å¯¹è±¡åœ¨GCè¿‡ç¨‹ä¸­åˆ†é…çš„é—®é¢˜,é‚£ä¹ˆåœ¨GCè¿‡ç¨‹ä¸­å¼•ç”¨å‘ç”Ÿå˜åŒ–çš„é—®é¢˜æ˜¯æ€ä¹ˆè§£å†³å‘¢?</p><p>G1ç»™å‡ºçš„è§£å†³åŠæ³•æ˜¯é€šè¿‡<font color="FF0000">Write Barrier</font>â€”å†™å±éšœ,å…¶ä½œç”¨å°±æ˜¯<font color="FF0000">å¯¹å¼•ç”¨å­—æ®µè¿›è¡Œèµ‹å€¼åšäº†é¢å¤–çš„å¤„ç†</font></p><p>é€šè¿‡Write Barrier`å°±å¯ä»¥äº†è§£åˆ°å“ªäº›å¯¹è±¡å‘ç”Ÿäº†ä»€ä¹ˆæ ·çš„å˜åŒ–</p></li></ul><ul><li>SATBçš„å®Œæ•´è¿‡ç¨‹<br>markçš„è¿‡ç¨‹å°±æ˜¯éå†Heapæ ‡è®°live Objectçš„è¿‡ç¨‹,é‡‡ç”¨çš„æ˜¯ä¸‰è‰²æ ‡è®°ç®—æ³•,è¿™ä¸‰ç§é¢œè‰²ä¸º<ul><li>whiteâ€”è¡¨ç¤ºè¿˜æœªè®¿é—®åˆ°</li><li>grayâ€”è®¿é—®åˆ°ä½†æ˜¯å®ƒç”¨åˆ°çš„å¼•ç”¨è¿˜æ²¡æœ‰å®Œå…¨æ‰«æå®Œ</li><li>blackâ€”è®¿é—®åˆ°è€Œä¸”å…¶ç”¨åˆ°çš„å¼•ç”¨å·²ç»å®Œå…¨æ‰«æå®Œ</li></ul>æ•´ä¸ªä¸‰è‰²æ ‡è®°ç®—æ³•å°±æ˜¯ä»GC rootæ˜¯å‡ºå‘éå†Heap, é’ˆå¯¹å¯è¾¾åˆ°çš„å¯¹è±¡å…ˆæ ‡è®°ä¸ºwhiteä¸ºgray,ç„¶åå†æ ‡è®°grayä¸ºblackéå†å®Œæˆä¹‹åæ‰€æœ‰å¯è¾¾çš„å¯¹è±¡éƒ½æ˜¯blackçš„,æ‰€æœ‰whiteéƒ½æ˜¯å¯ä»¥å›æ”¶çš„</li></ul><ul><li><p>å¹¶å‘æ ‡è®°å¯¹è±¡æ¼æ ‡è®°æƒ…å½¢<br>SATBä»…ä»…å¯¹äºåœ¨markingå¼€å§‹é˜¶æ®µè¿›è¡Œâ€Snapshotâ€â€”mark all reachable at mark start, ä½†æ˜¯concurrentçš„æ—¶å€™å¹¶å‘ä¿®æ”¹å¯èƒ½é€ æˆå¯¹è±¡æ¼æ ‡è®°</p><p>å¯¹è±¡æ¼æ ‡è®°æƒ…å½¢å¯èƒ½æœ‰å¦‚ä¸‹å‡ ç§:</p><ul><li><p>å¯¹blackæ–°å¼•ç”¨äº†ä¸€ä¸ªwhiteå¯¹è±¡,ç„¶ååˆä»grayå¯¹è±¡ä¸­åˆ é™¤äº†å¯¹è¯¥whiteå¯¹è±¡çš„å¼•ç”¨,è¿™æ ·ä¼šé€ æˆè¯¥whiteå¯¹è±¡çš„å¨„æ ‡å‰</p></li><li><p>å¯¹blackæ–°å¼•ç”¨äº†ä¸€ä¸ªwhiteå¯¹è±¡,ç„¶åä»grayå¯¹è±¡åˆ é™¤äº†ä¸€ä¸ªå¼•ç”¨è¯¥whiteå¯¹è±¡çš„whiteå¯¹è±¡,è¿™æ ·ä¹Ÿä¼šé€ æˆæ”¹å¯¹è±¡çš„æ¼æ ‡è®°</p></li><li><p>å¯¹blackæ–°å¼•ç”¨äº†ä¸€ä¸ªåˆšnewå‡ºæ¥çš„whiteå¯¹è±¡,æ²¡æœ‰å…¶ä»–grayå¯¹è±¡å¼•ç”¨æ”¹wihteå¯¹è±¡.è¿™æ ·ä¹Ÿä¼šé€ æˆäº†è¯¥whiteå¯¹è±¡æ¼æ ‡è®°</p></li></ul><p>SATBæä¾›çš„è§£å†³åŠæ³•<br>å¯¹äºä¸‰è‰²ç®—æ³•åœ¨concurentçš„æ—¶å€™å¯èƒ½ä¼šäº§å“çš„æ¼æ ‡è®°é—®é¢˜,SATBåœ¨markingé˜¶æ®µä¸­</p><ul><li><font color="FF0000">å¯¹äºä»grayå¯¹è±¡ç§»é™¤çš„ç›®æ ‡å¼•ç”¨å¯¹è±¡æ ‡è®°ä¸ºgray</font></li><li><font color="FF0000">å¯¹äºblackå¼•ç”¨çš„æ–°äº§ç”Ÿçš„å¯¹è±¡æ ‡è®°ä¸ºblack</font></li></ul><p>ç”±äºæ˜¯åœ¨å¼€å§‹çš„æ—¶å€™è¿›è¡Œsnapshot, å› è€Œå¯èƒ½å­˜åœ¨Floating Garbage</p></li></ul><ul><li>æ¼æ ‡ä¸è¯¯æ ‡<br>è¯¯æ ‡æ²¡ä»€ä¹ˆå…³ç³»,é¡¶å¤šæ˜¯é€ æˆæµ®åŠ¨åƒåœ¾,åœ¨ä¸‹æ¬¡GCè¿˜æ˜¯å¯ä»¥å›æ”¶çš„ä½†æ˜¯æ¼æ ‡çš„åæœæ˜¯è‡´å‘½çš„,æŠŠæœ¬åº”è¯¥å­˜æ´»çš„å¯¹è±¡ç»™å›æ”¶äº†,ä»è€Œå½±å“ç¨‹åºçš„æ­£ç¡®æ€§<ul><li>æ¼æ ‡<br>æ¼æ ‡çš„æƒ…å†µåªä¼šå‘ç”Ÿåœ¨ç™½è‰²å¯¹è±¡ä¸­,ä¸”æ»¡è¶³ä¸€ä¸‹ä»»ä¸€æ¡ä»¶<ul><li>å¹¶å‘æ ‡è®°æ—¶, åº”ç”¨çº¿ç¨‹ç»™ä¸€ä¸ªé»‘è‰²å¯¹è±¡çš„å¼•ç”¨ç±»å‹èµ‹å€¼äº†è¯¥ç™½è‰²ç±»å‹çš„å¼•ç”¨<br><font color="FF0000"><strong>è§£å†³åŠæ³•</strong></font>â€”åˆ©ç”¨post-write- barrier<font color="FF0000">å†™åå±éšœ</font>,è®°å½•æ‰€æœ‰æ–°å¢çš„å¼•ç”¨å…³ç³»,ç„¶åæ ¹æ®è¿™äº›å¼•ç”¨å…³ç³»ä¸ºæ ¹é‡æ–°æ‰«æä¸€é</li><li>å¹¶å‘æ ‡è®°æ—¶, åº”ç”¨çº¿ç¨‹ç»™åˆ é™¤æ‰€æœ‰ç°è‰²å¯¹è±¡åˆ°è¯¥ç™½è‰²å¯¹åº”çš„å¼•ç”¨<br><font color="FF0000"><strong>è§£å†³åŠæ³•</strong></font>â€”åˆ©ç”¨pre-write barrier<font color="FF0000">å†™å‰å±éšœ</font>,å°†æ‰€æœ‰å³å°†è¢«åˆ é™¤çš„å¼•ç”¨å…³ç³»çš„æ—§å¼•ç”¨è®°å½•ä¸‹æ¥,æœ€åä»¥è¿™äº›æ—§å¼•ç”¨ä¸ºæ ¹é‡æ–°æ‰«æä¸€é</li></ul></li></ul></li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>é©¬å£«å…µJVMå…¬å¼€è¯¾<a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://blog.csdn.net/lu322313/article/details/104763933">https://blog.csdn.net/lu322313/article/details/104763933</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Classç±»å’ŒClass.forName()ä½¿ç”¨æ€»ç»“</title>
    <link href="/2021/04/05/Class%E7%B1%BB%E5%92%8CClass.forName()%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"/>
    <url>/2021/04/05/Class%E7%B1%BB%E5%92%8CClass.forName()%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="Classç±»å’ŒClass-forName-ä½¿ç”¨æ€»ç»“"><a href="#Classç±»å’ŒClass-forName-ä½¿ç”¨æ€»ç»“" class="headerlink" title="Classç±»å’ŒClass.forName()ä½¿ç”¨æ€»ç»“"></a>Classç±»å’ŒClass.forName()ä½¿ç”¨æ€»ç»“</h1><p>ç»“åˆç€åå°„çš„å†…å®¹ï¼Œå‘ç°æœ‰å¾ˆå¤šçŸ¥è¯†ç‚¹ä»¥å‰æ²¡ç†æ¸…æ¥šï¼Œmarkä¸€ä¸‹Classå’Œç±»åŠ è½½Class.forName().</p><h2 id="1-Classç±»ç®€ä»‹"><a href="#1-Classç±»ç®€ä»‹" class="headerlink" title="1. Classç±»ç®€ä»‹"></a>1. Classç±»ç®€ä»‹</h2><p>Javaç¨‹åºåœ¨è¿è¡Œæ—¶ï¼ŒJavaè¿è¡Œæ—¶ç³»ç»Ÿä¸€ç›´å¯¹æ‰€æœ‰çš„å¯¹è±¡è¿›è¡Œæ‰€è°“çš„è¿è¡Œæ—¶ç±»å‹æ ‡è¯†ã€‚è¿™é¡¹ä¿¡æ¯çºªå½•äº†æ¯ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ã€‚è™šæ‹Ÿæœºé€šå¸¸ä½¿ç”¨è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯é€‰å‡†æ­£ç¡®æ–¹æ³•å»æ‰§è¡Œï¼Œç”¨æ¥ä¿å­˜è¿™äº›ç±»å‹ä¿¡æ¯çš„ç±»æ˜¯Classç±»ã€‚Classç±»å°è£…ä¸€ä¸ªå¯¹è±¡å’Œæ¥å£è¿è¡Œæ—¶çš„çŠ¶æ€ï¼Œå½“è£…è½½ç±»æ—¶ï¼ŒClassç±»å‹çš„å¯¹è±¡è‡ªåŠ¨åˆ›å»ºã€‚</p><p>Class æ²¡æœ‰å…¬å…±æ„é€ æ–¹æ³•ã€‚Class å¯¹è±¡æ˜¯åœ¨åŠ è½½ç±»æ—¶ç”±Java è™šæ‹Ÿæœºä»¥åŠé€šè¿‡è°ƒç”¨ç±»åŠ è½½å™¨ä¸­çš„ defineClass æ–¹æ³•è‡ªåŠ¨æ„é€ çš„ï¼Œå› æ­¤ä¸èƒ½æ˜¾å¼åœ°å£°æ˜ä¸€ä¸ªClasså¯¹è±¡ã€‚ </p><p>è™šæ‹Ÿæœºä¸ºæ¯ç§ç±»å‹ç®¡ç†ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„Classå¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªç±»ï¼ˆå‹ï¼‰éƒ½æœ‰ä¸€ä¸ªClasså¯¹è±¡ã€‚è¿è¡Œç¨‹åºæ—¶ï¼ŒJavaè™šæ‹Ÿæœº(JVM)é¦–å…ˆæ£€æŸ¥æ˜¯å¦æ‰€è¦åŠ è½½çš„ç±»å¯¹åº”çš„Classå¯¹è±¡æ˜¯å¦å·²ç»åŠ è½½ã€‚å¦‚æœæ²¡æœ‰åŠ è½½ï¼ŒJVMå°±ä¼šæ ¹æ®ç±»åæŸ¥æ‰¾.classæ–‡ä»¶ï¼Œå¹¶å°†å…¶Classå¯¹è±¡è½½å…¥ã€‚</p><p>åŸºæœ¬çš„ Java ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€longã€float å’Œ doubleï¼‰å’Œå…³é”®å­— void ä¹Ÿéƒ½å¯¹åº”ä¸€ä¸ª Class å¯¹è±¡ã€‚ </p><p>æ¯ä¸ªæ•°ç»„å±äºè¢«æ˜ å°„ä¸º Class å¯¹è±¡çš„ä¸€ä¸ªç±»ï¼Œæ‰€æœ‰å…·æœ‰ç›¸åŒå…ƒç´ ç±»å‹å’Œç»´æ•°çš„æ•°ç»„éƒ½å…±äº«è¯¥ Class å¯¹è±¡ã€‚</p><p>ä¸€èˆ¬æŸä¸ªç±»çš„Classå¯¹è±¡è¢«è½½å…¥å†…å­˜ï¼Œå®ƒå°±ç”¨æ¥åˆ›å»ºè¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ã€‚</p><h3 id="1-1-Classå¯¹è±¡çš„è·å–"><a href="#1-1-Classå¯¹è±¡çš„è·å–" class="headerlink" title="1.1 Classå¯¹è±¡çš„è·å–"></a>1.1 Classå¯¹è±¡çš„è·å–</h3><ul><li><p>1ã€è°ƒç”¨Objectç±»çš„getClass()æ–¹æ³•æ¥å¾—åˆ°Classå¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸è§çš„äº§ç”ŸClasså¯¹è±¡çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">MyObject x;<br>Class c1 = x.getClass();<br></code></pre></td></tr></table></figure></li><li><p>2ã€ä½¿ç”¨Classç±»çš„ä¸­é™æ€forName()æ–¹æ³•è·å¾—ä¸å­—ç¬¦ä¸²å¯¹åº”çš„Classå¯¹è±¡ã€‚ä¾‹å¦‚ï¼š </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Class c2 = Class.forName(<span class="hljs-string">&quot;MyObject&quot;</span>)<br></code></pre></td></tr></table></figure><p>,Employeeå¿…é¡»æ˜¯æ¥å£æˆ–è€…ç±»çš„åå­—ã€‚</p></li><li><p>3ã€è·å–Classç±»å‹å¯¹è±¡çš„ç¬¬ä¸‰ä¸ªæ–¹æ³•éå¸¸ç®€å•ã€‚å¦‚æœTæ˜¯ä¸€ä¸ªJavaç±»å‹ï¼Œé‚£ä¹ˆT.classå°±ä»£è¡¨äº†åŒ¹é…çš„ç±»å¯¹è±¡ã€‚ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Class cl1 = Manager.class;<br>Class cl2 = <span class="hljs-keyword">int</span>.class;<br>Class cl3 = Double[].class;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šClasså¯¹è±¡å®é™…ä¸Šæè¿°çš„åªæ˜¯ç±»å‹ï¼Œè€Œè¿™ç±»å‹æœªå¿…æ˜¯ç±»æˆ–è€…æ¥å£ã€‚ä¾‹å¦‚ä¸Šé¢çš„int.classæ˜¯ä¸€ä¸ªClassç±»å‹çš„å¯¹è±¡ã€‚ç”±äºå†å²åŸå› ï¼Œæ•°ç»„ç±»å‹çš„getNameæ–¹æ³•ä¼šè¿”å›å¥‡æ€ªçš„åå­—ã€‚</p></li></ul><h3 id="1-2-Classç±»çš„å¸¸ç”¨æ–¹æ³•"><a href="#1-2-Classç±»çš„å¸¸ç”¨æ–¹æ³•" class="headerlink" title="1.2 Classç±»çš„å¸¸ç”¨æ–¹æ³•"></a>1.2 Classç±»çš„å¸¸ç”¨æ–¹æ³•</h3><ul><li><p>getName() </p><p>ä¸€ä¸ªClasså¯¹è±¡æè¿°äº†ä¸€ä¸ªç‰¹å®šç±»çš„å±æ€§ï¼ŒClassç±»ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•getNameä»¥ String çš„å½¢å¼è¿”å›æ­¤ Class å¯¹è±¡æ‰€è¡¨ç¤ºçš„å®ä½“ï¼ˆç±»ã€æ¥å£ã€æ•°ç»„ç±»ã€åŸºæœ¬ç±»å‹æˆ– voidï¼‰åç§°ã€‚</p></li><li><p>newInstance()<br>Classè¿˜æœ‰ä¸€ä¸ªæœ‰ç”¨çš„æ–¹æ³•å¯ä»¥ä¸ºç±»åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªæ–¹æ³•å«åšnewInstance()ã€‚ä¾‹å¦‚ï¼š<br>x.getClass.newInstance()ï¼Œåˆ›å»ºäº†ä¸€ä¸ªåŒxä¸€æ ·ç±»å‹çš„æ–°å®ä¾‹ã€‚newInstance()æ–¹æ³•è°ƒç”¨é»˜è®¤æ„é€ å™¨ï¼ˆæ— å‚æ•°æ„é€ å™¨ï¼‰åˆå§‹åŒ–æ–°å»ºå¯¹è±¡ã€‚</p></li><li><p>getClassLoader() </p><p>è¿”å›è¯¥ç±»çš„ç±»åŠ è½½å™¨ã€‚</p></li><li><p>getComponentType() </p><p>è¿”å›è¡¨ç¤ºæ•°ç»„ç»„ä»¶ç±»å‹çš„ Classã€‚</p></li><li><p>getSuperclass() </p><p>è¿”å›è¡¨ç¤ºæ­¤ Class æ‰€è¡¨ç¤ºçš„å®ä½“ï¼ˆç±»ã€æ¥å£ã€åŸºæœ¬ç±»å‹æˆ– voidï¼‰çš„è¶…ç±»çš„ Classã€‚</p></li><li><p>isArray() </p><p>åˆ¤å®šæ­¤ Class å¯¹è±¡æ˜¯å¦è¡¨ç¤ºä¸€ä¸ªæ•°ç»„ç±»</p></li></ul><h3 id="1-3-Classçš„ä¸€äº›ä½¿ç”¨æŠ€å·§"><a href="#1-3-Classçš„ä¸€äº›ä½¿ç”¨æŠ€å·§" class="headerlink" title="1.3 Classçš„ä¸€äº›ä½¿ç”¨æŠ€å·§"></a>1.3 Classçš„ä¸€äº›ä½¿ç”¨æŠ€å·§</h3><ol><li><p>forNameå’ŒnewInstanceç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œå¯ä»¥æ ¹æ®å­˜å‚¨åœ¨å­—ç¬¦ä¸²ä¸­çš„ç±»ååˆ›å»ºå¯¹è±¡ã€‚ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Object obj = Class.forName(s).newInstance();<br></code></pre></td></tr></table></figure></li><li><p>è™šæ‹Ÿæœºä¸ºæ¯ç§ç±»å‹ç®¡ç†ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„Classå¯¹è±¡ã€‚å› æ­¤å¯ä»¥ä½¿ç”¨==æ“ä½œç¬¦æ¥æ¯”è¾ƒç±»å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span>(e.getClass() == Employee.class)...<br></code></pre></td></tr></table></figure></li></ol><h2 id="2-Class-forName-æ–¹æ³•"><a href="#2-Class-forName-æ–¹æ³•" class="headerlink" title="2. Class.forName()æ–¹æ³•"></a>2. Class.forName()æ–¹æ³•</h2><p><font color="0000FF">Class.forName</font>ï¼šè¿”å›ä¸ç»™å®šçš„å­—ç¬¦ä¸²åç§°ç›¸å…³è”ç±»æˆ–æ¥å£çš„Classå¯¹è±¡ã€‚</p><p><font color="0000FF">Class.forName</font>æ˜¯ä¸€ä¸ª<strong>é™æ€æ–¹æ³•</strong>ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥<strong>åŠ è½½ç±»</strong>ã€‚è¯¥æ–¹æ³•æœ‰ä¸¤ç§å½¢å¼ï¼šClass.forName(String name, boolean initialize, ClassLoader loader)å’Œ Class.forName(String className)ã€‚ç¬¬ä¸€ç§å½¢å¼çš„å‚æ•° nameè¡¨ç¤ºçš„æ˜¯ç±»çš„å…¨åï¼›initializeè¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–ç±»ï¼›loaderè¡¨ç¤ºåŠ è½½æ—¶ä½¿ç”¨çš„ç±»åŠ è½½å™¨ã€‚ç¬¬äºŒç§å½¢å¼åˆ™ç›¸å½“äºè®¾ç½®äº†å‚æ•° initializeçš„å€¼ä¸º trueï¼Œloaderçš„å€¼ä¸ºå½“å‰ç±»çš„ç±»åŠ è½½å™¨ã€‚</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>static Class&lt;?&gt;</td><td>forName(String className)<br/>Returns the Class object associated with the class or interface with the given string name.</td></tr><tr><td>static Class&lt;?&gt;</td><td>forName(String name, boolean initialize, ClassLoader loader)<br />Returns the Class object associated with the class or interface with the given string name, using the given class loader.</td></tr></tbody></table><p><font color="FF0000">è¯´æ˜</font>ï¼š</p><p>publicstatic Class&lt;?&gt; forName(String className)</p><p>Returns the Class object associated withthe class or interface with the given string name. <font color="FF0000">Invokingthis method is equivalent to:Class.forName(className,true, currentLoader)</font></p><p>where currentLoader denotes the definingclass loader of the current class.</p><p>For example, thefollowing code fragment returns the runtime Class descriptor for theclass named java.lang.Thread:</p><p>Class t =Class.forName(â€œjava.lang.Threadâ€)</p><p><font color="FF0000">A call to forName(â€œXâ€) causes theclass named X to beinitialized.</font></p><p><strong>Parameters</strong>:</p><p>className - the fully qualifiedname of the desired class.</p><p><strong>Returns</strong>:</p><p>the Class object for the classwith the specified name.</p><blockquote><p>ä»å®˜æ–¹ç»™å‡ºçš„APIæ–‡æ¡£ä¸­å¯ä»¥çœ‹å‡º:</p><p>Class.forName(className)å®é™…ä¸Šæ˜¯è°ƒClass.forName(className,true,this.getClass().getClassLoader()).</p><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯æŒ‡Classè¢«loadingåæ˜¯ä¸æ˜¯å¿…é¡»è¢«åˆå§‹åŒ–ã€‚</p><p>å¯ä»¥çœ‹å‡ºï¼Œä½¿ç”¨Class.forNameï¼ˆclassNameï¼‰åŠ è½½ç±»æ—¶åˆ™å·²åˆå§‹åŒ–ã€‚</p><p><font color="FF0000">æ‰€ä»¥Class.forName(className)å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼šè·å¾—å­—ç¬¦ä¸²å‚æ•°ä¸­æŒ‡å®šçš„ç±»ï¼Œå¹¶åˆå§‹åŒ–è¯¥ç±»ã€‚</font></p></blockquote><h3 id="2-1-ä»»ä½•classéƒ½è¦è£…è½½åœ¨è™šæ‹Ÿæœºä¸Šæ‰èƒ½è¿è¡Œ"><a href="#2-1-ä»»ä½•classéƒ½è¦è£…è½½åœ¨è™šæ‹Ÿæœºä¸Šæ‰èƒ½è¿è¡Œ" class="headerlink" title="2.1 ä»»ä½•classéƒ½è¦è£…è½½åœ¨è™šæ‹Ÿæœºä¸Šæ‰èƒ½è¿è¡Œ"></a>2.1 ä»»ä½•classéƒ½è¦è£…è½½åœ¨è™šæ‹Ÿæœºä¸Šæ‰èƒ½è¿è¡Œ</h3><ol><li><pre><code> forNameè¿™å¥è¯å°±æ˜¯&lt;font color=&quot;FF0000&quot;&gt;è£…è½½ç±»&lt;/font&gt;ç”¨çš„(newæ˜¯æ ¹æ®åŠ è½½åˆ°å†…å­˜ä¸­çš„ç±»åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¦åˆ†æ¸…æ¥š)ã€‚ </code></pre></li><li><p>è‡³äºä»€ä¹ˆæ—¶å€™ç”¨ï¼Œå¯ä»¥è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²å˜é‡ï¼Œå®ƒä»£è¡¨ä¸€ä¸ªç±»çš„åŒ…åå’Œç±»åï¼Œä½ æ€ä¹ˆå®ä¾‹åŒ–å®ƒï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">A a = (A) Class.forName(<span class="hljs-string">&quot;pacage.A&quot;</span>).newInstance();<br>A a = <span class="hljs-keyword">new</span> A();<br></code></pre></td></tr></table></figure><p>æ˜¯ä¸€æ ·çš„æ•ˆæœã€‚</p></li><li><p>jvmåœ¨è£…è½½ç±»æ—¶ä¼šæ‰§è¡Œç±»çš„é™æ€ä»£ç æ®µï¼Œè¦è®°ä½<font color="FF0000">é™æ€ä»£ç æ˜¯å’Œclassç»‘å®šçš„</font>ï¼Œclassè£…è½½æˆåŠŸå°±è¡¨ç¤ºæ‰§è¡Œäº†ä½ çš„é™æ€ä»£ç äº†ï¼Œè€Œä¸”ä»¥åä¸ä¼šå†æ‰§è¡Œè¿™æ®µé™æ€ä»£ç äº†ã€‚</p></li><li><p>Class.forName(xxx.xx.xx)çš„ä½œç”¨æ˜¯è¦æ±‚JVMæŸ¥æ‰¾å¹¶åŠ è½½æŒ‡å®šçš„ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´JVMä¼šæ‰§è¡Œè¯¥ç±»çš„é™æ€ä»£ç æ®µã€‚</p></li><li><p>åŠ¨æ€åŠ è½½å’Œåˆ›å»ºClass å¯¹è±¡ï¼Œæ¯”å¦‚æƒ³æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²æ¥åˆ›å»ºå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">String str = ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²;<br>Class t = Class.forName(str);  <br>t.newInstance(); <br></code></pre></td></tr></table></figure></li></ol><h3 id="2-2-åœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œç”Ÿæˆä¸€ä¸ªå®ä¾‹çš„æ—¶å€™ï¼ŒnewInstance-æ–¹æ³•å’Œnewå…³é”®å­—é™¤äº†ä¸€ä¸ªæ˜¯æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å…³é”®å­—å¤–ï¼Œæœ€ä¸»è¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#2-2-åœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œç”Ÿæˆä¸€ä¸ªå®ä¾‹çš„æ—¶å€™ï¼ŒnewInstance-æ–¹æ³•å’Œnewå…³é”®å­—é™¤äº†ä¸€ä¸ªæ˜¯æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å…³é”®å­—å¤–ï¼Œæœ€ä¸»è¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="2.2 åœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œç”Ÿæˆä¸€ä¸ªå®ä¾‹çš„æ—¶å€™ï¼ŒnewInstance()æ–¹æ³•å’Œnewå…³é”®å­—é™¤äº†ä¸€ä¸ªæ˜¯æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å…³é”®å­—å¤–ï¼Œæœ€ä¸»è¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>2.2 åœ¨åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œç”Ÿæˆä¸€ä¸ªå®ä¾‹çš„æ—¶å€™ï¼ŒnewInstance()æ–¹æ³•å’Œnewå…³é”®å­—é™¤äº†ä¸€ä¸ªæ˜¯æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å…³é”®å­—å¤–ï¼Œæœ€ä¸»è¦æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ol><li><p>åˆ›å»ºå¯¹è±¡çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œå‰è€…æ˜¯ä½¿ç”¨<strong>ç±»åŠ è½½æœºåˆ¶</strong>ï¼Œåè€…æ˜¯åˆ›å»ºä¸€ä¸ª<strong>æ–°ç±»</strong>ã€‚</p></li><li><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ç§åˆ›å»ºå¯¹è±¡æ–¹å¼ï¼Ÿ</p><p>è¿™ä¸»è¦è€ƒè™‘åˆ°è½¯ä»¶çš„å¯ä¼¸ç¼©ã€å¯æ‰©å±•å’Œå¯é‡ç”¨ç­‰è½¯ä»¶è®¾è®¡æ€æƒ³ã€‚  Javaä¸­<font color="FF0000">å·¥å‚æ¨¡å¼</font>ç»å¸¸ä½¿ç”¨newInstance()æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ï¼Œå› æ­¤ä»ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å·¥å‚æ¨¡å¼ä¸Šå¯ä»¥æ‰¾åˆ°å…·ä½“ç­”æ¡ˆã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">c</span> </span>= Class.forName(â€œExampleâ€);  <br>factory = (ExampleInterface) c.newInstance();  <br></code></pre></td></tr></table></figure><p>å…¶ä¸­ExampleInterfaceæ˜¯Exampleçš„æ¥å£ï¼Œå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">String className = <span class="hljs-string">&quot;Example&quot;</span>;  <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">c</span> </span>= Class.forName(className);  <br>factory = (ExampleInterface) c.newInstance();<br></code></pre></td></tr></table></figure><p>è¿›ä¸€æ­¥å¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">String className = readfromXMlConfig;<span class="hljs-comment">//ä»xml é…ç½®æ–‡ä»¶ä¸­è·å¾—å­—ç¬¦ä¸²</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">c</span> </span>= Class.forName(className); <br>factory = (ExampleInterface) c.newInstance(); <br></code></pre></td></tr></table></figure><p>ä¸Šé¢ä»£ç å·²ç»ä¸å­˜åœ¨Exampleçš„ç±»åç§°ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ï¼Œæ— è®ºExampleç±»æ€ä¹ˆå˜åŒ–ï¼Œä¸Šè¿°ä»£ç ä¸å˜ï¼Œç”šè‡³å¯ä»¥æ›´æ¢Exampleçš„å…„å¼Ÿç±»Example2 , Example3 , Example4â€¦â€¦ï¼Œåªè¦ä»–ä»¬ç»§æ‰¿ExampleInterfaceå°±å¯ä»¥ã€‚  </p></li><li><p>ä»JVMçš„è§’åº¦çœ‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å…³é”®å­—newåˆ›å»ºä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œè¿™ä¸ªç±»å¯ä»¥æ²¡æœ‰è¢«åŠ è½½ã€‚ ä½†æ˜¯ä½¿ç”¨newInstance()æ–¹æ³•çš„æ—¶å€™ï¼Œå°±å¿…é¡»ä¿è¯ï¼š</p><ul><li>è¿™ä¸ªç±»å·²ç»åŠ è½½</li><li>è¿™ä¸ªç±»å·²ç»è¿æ¥</li></ul><p>è€Œå®Œæˆä¸Šé¢ä¸¤ä¸ªæ­¥éª¤çš„æ­£æ˜¯Classçš„é™æ€æ–¹æ³•forName()æ‰€å®Œæˆçš„ï¼Œè¿™ä¸ªé™æ€æ–¹æ³•è°ƒç”¨äº†å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œå³åŠ è½½ java APIçš„é‚£ä¸ªåŠ è½½å™¨ã€‚</p><p>ç°åœ¨å¯ä»¥çœ‹å‡ºï¼ŒnewInstance()å®é™…ä¸Šæ˜¯æŠŠnewè¿™ä¸ªæ–¹å¼åˆ†è§£ä¸ºä¸¤æ­¥ï¼Œå³é¦–å…ˆè°ƒç”¨ClassåŠ è½½æ–¹æ³•åŠ è½½æŸä¸ªç±»ï¼Œç„¶åå®ä¾‹åŒ–ã€‚è¿™æ ·åˆ†æ­¥çš„å¥½å¤„æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è°ƒç”¨classçš„é™æ€åŠ è½½æ–¹æ³•forNameæ—¶è·å¾—æ›´å¥½çš„çµæ´»æ€§ï¼Œæä¾›ç»™äº†ä¸€ç§é™è€¦çš„æ‰‹æ®µã€‚</p></li></ol><h3 id="2-3-Class-forNameå’ŒClassLoaderçš„åŒºåˆ«"><a href="#2-3-Class-forNameå’ŒClassLoaderçš„åŒºåˆ«" class="headerlink" title="2.3 Class.forNameå’ŒClassLoaderçš„åŒºåˆ«"></a>2.3 Class.forNameå’ŒClassLoaderçš„åŒºåˆ«</h3><blockquote><p>javaä¸­class.forName()å’ŒclassLoaderéƒ½å¯ç”¨æ¥å¯¹ç±»è¿›è¡ŒåŠ è½½ã€‚</p><ol><li>class.forName()å‰è€…é™¤äº†å°†ç±»çš„.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ä¹‹å¤–ï¼Œè¿˜ä¼šå¯¹ç±»è¿›è¡Œè§£é‡Šï¼Œæ‰§è¡Œç±»ä¸­çš„staticå—</li><li>classLoaderåªå¹²ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å°†.classæ–‡ä»¶åŠ è½½åˆ°jvmä¸­ï¼Œä¸ä¼šæ‰§è¡Œstaticä¸­çš„å†…å®¹,åªæœ‰åœ¨newInstanceæ‰ä¼šå»æ‰§è¡Œstaticå—ã€‚</li><li>Class.forName(name, initialize, loader)å¸¦å‚å‡½æ•°ä¹Ÿå¯æ§åˆ¶æ˜¯å¦åŠ è½½staticå—ã€‚å¹¶ä¸”åªæœ‰è°ƒç”¨äº†newInstance()æ–¹æ³•é‡‡ç”¨è°ƒç”¨æ„é€ å‡½æ•°ï¼Œåˆ›å»ºç±»çš„å¯¹è±¡ã€‚</li></ol></blockquote><p>javaç±»åŠ è½½åˆ†ä¸‰æ­¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%97%B6%E6%9C%BA_2_20210405.png"></p><ul><li><p>åŠ è½½<br>JvmæŠŠclassæ–‡ä»¶å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™äº›é™æ€æ•°æ®è£…æ¢æˆè¿è¡Œæ—¶æ•°æ®åŒºä¸­æ–¹æ³•åŒºçš„ç±»å‹æ•°æ®ï¼Œåœ¨è¿è¡Œæ—¶æ•°æ®åŒºå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºç±»æ•°æ®çš„è®¿é—®å…¥å£ã€‚<br>*æ³¨ï¼šæ–¹æ³•åŒºä¸ä»…ä»…æ˜¯å­˜æ”¾æ–¹æ³•ï¼Œå®ƒå­˜æ”¾çš„æ˜¯ç±»çš„ç±»å‹ä¿¡æ¯ã€‚</p></li><li><p>é“¾æ¥ï¼šæ‰§è¡Œä¸‹é¢çš„æ ¡éªŒã€å‡†å¤‡å’Œè§£ææ­¥éª¤ï¼Œå…¶ä¸­è§£ææ­¥éª¤æ˜¯å¯é€‰çš„</p><ul><li><p>æ ¡éªŒï¼šæ£€æŸ¥åŠ è½½çš„classæ–‡ä»¶çš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§</p></li><li><p>å‡†å¤‡ï¼šä¸ºç±»å˜é‡åˆ†é…å­˜å‚¨ç©ºé—´å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼ï¼Œç±»å˜é‡éšç±»å‹ä¿¡æ¯å­˜æ”¾åœ¨æ–¹æ³•åŒºä¸­,ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿ï¼Œä½¿ç”¨ä¸å½“å’Œå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ã€‚</p><p>æ³¨ï¼šç±»å˜é‡å°±æ˜¯staticå˜é‡ï¼›åˆå§‹å€¼æŒ‡çš„æ˜¯ç±»å˜é‡ç±»å‹çš„é»˜è®¤å€¼è€Œä¸æ˜¯å®é™…è¦èµ‹çš„å€¼</p></li><li><p>è§£æï¼šjvmå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</p></li></ul></li><li><p>åˆå§‹åŒ–ï¼šæ‰§è¡Œç±»å˜é‡èµ‹å€¼å’Œé™æ€ä»£ç å—</p></li></ul><h4 id="æ–¹æ³•å¯¹æ¯”"><a href="#æ–¹æ³•å¯¹æ¯”" class="headerlink" title="æ–¹æ³•å¯¹æ¯”"></a>æ–¹æ³•å¯¹æ¯”</h4><ul><li><p>Classloder.loaderClass(String name)<br>å…¶å®è¯¥æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ˜¯ï¼šClassloder. loadClass(name, false)<br>æ–¹æ³•ï¼šClassloder. loadClass(String name, boolean resolve)</p><ul><li>å‚æ•°nameä»£è¡¨ç±»çš„å…¨é™å®šç±»å</li><li>å‚æ•°resolveä»£è¡¨æ˜¯å¦è§£æï¼Œresolveä¸ºtrueæ˜¯è§£æè¯¥ç±»</li></ul></li><li><p>Class.forName(String name)<br>å…¶å®è¯¥æ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ˜¯ï¼šClass.forName(className, true, ClassLoader.getClassLoader(caller))<br>æ–¹æ³•ï¼šClass.forName0(String name, boolean initialize, ClassLoader loader)</p><ul><li><p>å‚æ•°nameä»£è¡¨å…¨é™å®šç±»å</p></li><li><p>å‚æ•°initializeä»£è¡¨æ˜¯å¦åˆå§‹åŒ–è¯¥ç±»ï¼Œä¸ºtrueæ˜¯åˆå§‹åŒ–è¯¥ç±»</p></li><li><p>å‚æ•°loaderä»£è¡¨å¯¹åº”çš„ç±»åŠ è½½å™¨</p></li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Class.forName(String className)  è¿™æ˜¯1.8çš„æºç </span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Class&lt;?&gt; forName(String className) <span class="hljs-keyword">throws</span> ClassNotFoundException &#123;<br>    Class&lt;?&gt; caller = Reflection.getCallerClass();<br>    <span class="hljs-keyword">return</span> forName0(className, <span class="hljs-keyword">true</span>, ClassLoader.getClassLoader(caller), caller);<br>&#125;<br><span class="hljs-comment">//æ³¨æ„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯æŒ‡Classè¢«loadingåæ˜¯ä¸æ˜¯å¿…é¡»è¢«åˆå§‹åŒ–ã€‚ ä¸åˆå§‹åŒ–å°±æ˜¯ä¸æ‰§è¡Œstaticçš„ä»£ç å³é™æ€ä»£ç </span><br></code></pre></td></tr></table></figure><h4 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h4><p><font color="FF0000">Class.forNameå¾—åˆ°çš„classæ˜¯å·²ç»åˆå§‹åŒ–å®Œæˆçš„</font></p><p><font color="FF0000">Classloder.loaderClasså¾—åˆ°çš„classæ˜¯è¿˜æ²¡æœ‰é“¾æ¥çš„</font></p><h4 id="ä»£ç æ¼”ç¤º"><a href="#ä»£ç æ¼”ç¤º" class="headerlink" title="ä»£ç æ¼”ç¤º"></a>ä»£ç æ¼”ç¤º</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.reflect;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Line</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;é™æ€ä»£ç å—æ‰§è¡Œ: loading line&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.reflect;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Point</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;é™æ€ä»£ç å—æ‰§è¡Œ: loading point&quot;</span>);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.reflect;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClassloaderAndForNameTest</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        String wholeNameLine = <span class="hljs-string">&quot;com.reflect.Line&quot;</span>;<br>        String wholeNamePoint = <span class="hljs-string">&quot;com.reflect.Point&quot;</span>;<br>        System.out.println(<span class="hljs-string">&quot;ä¸‹é¢æ˜¯æµ‹è¯•Classloaderçš„æ•ˆæœ&quot;</span>);<br>        testClassloader(wholeNameLine, wholeNamePoint);<br>        System.out.println(<span class="hljs-string">&quot;----------------------------------&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;ä¸‹é¢æ˜¯æµ‹è¯•Class.forNameçš„æ•ˆæœ&quot;</span>);<br>        testForName(wholeNameLine, wholeNamePoint);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * classloader</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wholeNameLine</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wholeNamePoint</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testClassloader</span><span class="hljs-params">(String wholeNameLine, String wholeNamePoint)</span> </span>&#123;<br>        Class&lt;?&gt; line;<br>        Class&lt;?&gt; point;<br>        ClassLoader loader = ClassLoader.getSystemClassLoader();<br>        <span class="hljs-keyword">try</span> &#123;<br>            line = loader.loadClass(wholeNameLine);<br>            point = loader.loadClass(wholeNamePoint);<br>            System.out.println(<span class="hljs-string">&quot;line &quot;</span> + line.getName());<br>            System.out.println(<span class="hljs-string">&quot;point &quot;</span> + point.getName());<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Class.forName</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wholeNameLine</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> wholeNamePoint</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testForName</span><span class="hljs-params">(String wholeNameLine, String wholeNamePoint)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Class&lt;?&gt; line = Class.forName(wholeNameLine);<br>            Class&lt;?&gt; point = Class.forName(wholeNamePoint);<br>            System.out.println(<span class="hljs-string">&quot;line   &quot;</span> + line.getName());<br>            System.out.println(<span class="hljs-string">&quot;point   &quot;</span> + point.getName());<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ä¸‹é¢æ˜¯æµ‹è¯•Classloaderçš„æ•ˆæœ<br><span class="hljs-type">line</span> com.reflect.Line<br><span class="hljs-type">point</span> com.reflect.Point<br><span class="hljs-comment">----------------------------------</span><br>ä¸‹é¢æ˜¯æµ‹è¯•<span class="hljs-keyword">Class</span>.forNameçš„æ•ˆæœ<br>é™æ€ä»£ç å—æ‰§è¡Œ: loading <span class="hljs-type">line</span><br>é™æ€ä»£ç å—æ‰§è¡Œ: loading <span class="hljs-type">point</span><br><span class="hljs-type">line</span>   com.reflect.Line<br><span class="hljs-type">point</span>   com.reflect.Point<br></code></pre></td></tr></table></figure><p>æ ¹æ®è¿è¡Œç»“æœï¼Œå¯ä»¥çœ‹åˆ°ï¼Œclassloaderå¹¶æ²¡æœ‰æ‰§è¡Œé™æ€ä»£ç å—ï¼Œå¦‚å¼€å¤´çš„ç†è®ºæ‰€è¯´ã€‚</p><p>è€Œä¸‹é¢çš„Class.forNameåˆ™æ˜¯å¤¹åœ¨å®Œä¹‹åï¼Œå°±é‡Œé¢æ‰§è¡Œäº†é™æ€ä»£ç å—ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ2ä¸ªç±»ï¼Œlineå’Œpointçš„é™æ€ä»£ç å—æ‰§è¡Œç»“æœæ˜¯ä¸€èµ·çš„ï¼Œç„¶åæ‰æ˜¯å„è‡ªçš„æ‰“å°ç»“æœã€‚</p><p>ä¹Ÿè¯´æ˜ä¸Šé¢ç†è®ºæ˜¯OKçš„ã€‚</p><hr><p>æ¥ä¸‹æ¥ä¿®æ”¹ä¸‹Lineçš„ä»£ç ï¼Œæ·»åŠ äº†å‡ ä¸ªé™æ€çš„æ–¹æ³•å’Œå˜é‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.reflect;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Line</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;é™æ€ä»£ç å—æ‰§è¡Œ: loading line&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String s = getString();<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getString</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;ç»™é™æ€å˜é‡èµ‹å€¼çš„é™æ€æ–¹æ³•æ‰§è¡Œï¼šloading line&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;mask&quot;</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ™®é€šé™æ€æ–¹æ³•æ‰§è¡Œï¼šloading line&quot;</span>);<br>    &#125;<br><br>    &#123;<br>        System.out.println(<span class="hljs-string">&quot;æ™®é€šä»£ç å—&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Line</span><span class="hljs-params">()</span> </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æ„é€ æ–¹æ³•æ‰§è¡Œ&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">ä¸‹é¢æ˜¯æµ‹è¯•Classloaderçš„æ•ˆæœ<br><span class="hljs-type">line</span> com.reflect.Line<br><span class="hljs-type">point</span> com.reflect.Point<br><span class="hljs-comment">----------------------------------</span><br>ä¸‹é¢æ˜¯æµ‹è¯•<span class="hljs-keyword">Class</span>.forNameçš„æ•ˆæœ<br>é™æ€ä»£ç å—æ‰§è¡Œ: loading <span class="hljs-type">line</span><br>ç»™é™æ€å˜é‡èµ‹å€¼çš„é™æ€æ–¹æ³•æ‰§è¡Œï¼šloading <span class="hljs-type">line</span><br>é™æ€ä»£ç å—æ‰§è¡Œ: loading <span class="hljs-type">point</span><br><span class="hljs-type">line</span>   com.reflect.Line<br><span class="hljs-type">point</span>   com.reflect.Point<br></code></pre></td></tr></table></figure><p>é™¤äº†ï¼Œé™æ€ä»£ç å—çš„æ‰§è¡Œå¤–ï¼Œç«Ÿç„¶è¿˜æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•è¢«æ‰§è¡Œï¼Œå°±æ˜¯ç»™é™æ€å˜é‡èµ‹å€¼çš„é™æ€æ–¹æ³•è¢«æ‰§è¡Œäº†.</p><h2 id="3-åº”ç”¨åœºæ™¯"><a href="#3-åº”ç”¨åœºæ™¯" class="headerlink" title="3. åº”ç”¨åœºæ™¯"></a>3. åº”ç”¨åœºæ™¯</h2><h3 id="3-1-åœºæ™¯ä¸€ï¼šåŠ è½½æ•°æ®åº“é©±åŠ¨"><a href="#3-1-åœºæ™¯ä¸€ï¼šåŠ è½½æ•°æ®åº“é©±åŠ¨" class="headerlink" title="3.1 åœºæ™¯ä¸€ï¼šåŠ è½½æ•°æ®åº“é©±åŠ¨"></a>3.1 åœºæ™¯ä¸€ï¼šåŠ è½½æ•°æ®åº“é©±åŠ¨</h3><blockquote><p>åˆ©ç”¨äº†ç±»åŠ è½½å’Œé™æ€ä»£ç å—ç»‘å®šçš„ç‰¹ç‚¹</p></blockquote><p>ä½¿ç”¨newåŠ è½½æ³¨å†Œ</p><p>static void registerDriver(Driver driver) : æ³¨å†Œä¸ç»™å®šçš„é©±åŠ¨ç¨‹åº DriverManager</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">DriverManager.registerDriver(<span class="hljs-keyword">new</span> Driver());<br>Connection conn = DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql:///db3&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>);<br></code></pre></td></tr></table></figure><p>è€Œé€šå¸¸éƒ½æ˜¯é€šè¿‡åå°„ï¼ŒåŠ è½½ä¸æ³¨å†Œé©±åŠ¨ç±»ï¼Œ<strong>è§£è€¦åˆï¼ˆä¸ç›´æ¥ä¾èµ–ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>Connection conn = DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql:///db3&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>);<br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆåœ¨æˆ‘ä»¬åŠ è½½æ•°æ®åº“é©±åŠ¨åŒ…çš„æ—¶å€™æœ‰çš„å´æ²¡æœ‰è°ƒç”¨newInstance( )æ–¹æ³•å‘¢ï¼Ÿ(å³æœ‰çš„jdbcè¿æ¥æ•°æ®åº“çš„å†™æ³•é‡Œæ˜¯Class.forName(xxx.xx.xx);è€Œæœ‰ä¸€äº›Class.forName(xxx.xx.xx).newInstance()ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸¤ç§å†™æ³•å‘¢ï¼Ÿ)</p><p>åˆšæ‰æåˆ°ï¼ŒClass.forName() çš„ä½œç”¨æ˜¯è¦æ±‚JVMæŸ¥æ‰¾å¹¶åŠ è½½æŒ‡å®šçš„ç±»ï¼Œå¦‚æœåœ¨ç±»ä¸­æœ‰é™æ€åˆå§‹åŒ–å™¨çš„è¯ï¼ŒJVMå¿…ç„¶ä¼šæ‰§è¡Œè¯¥ç±»çš„é™æ€ä»£ç æ®µã€‚</p><p>è€Œåœ¨JDBCè§„èŒƒä¸­æ˜ç¡®è¦æ±‚è¿™ä¸ªDriverç±»å¿…é¡»å‘DriverManageræ³¨å†Œè‡ªå·±ï¼Œå³ä»»ä½•ä¸€ä¸ªJDBCDriverçš„Driverç±»çš„ä»£ç éƒ½å¿…é¡»ç±»ä¼¼å¦‚ä¸‹:</p><p>com.mysql.jdbc.Driverç±»ä¸­å­˜åœ¨é™æ€ä»£ç å—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br><span class="hljs-keyword">try</span> &#123;<br>  java.sql.DriverManager.registerDriver(<span class="hljs-keyword">new</span> Driver());<br>  &#125; <span class="hljs-keyword">catch</span> (SQLException E) &#123;<br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Can&#x27;t register driver!&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ—¢ç„¶åœ¨é™æ€åˆå§‹åŒ–å™¨çš„ä¸­å·²ç»è¿›è¡Œäº†æ³¨å†Œï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä½¿ç”¨JDBCæ—¶åªéœ€è¦Class.forName(XXX.XXX);å°±å¯ä»¥äº†ã€‚</p><h3 id="3-2-åœºæ™¯äºŒ-ä½¿ç”¨AIDLä¸ç”µè¯ç®¡ç†Servicè¿›è¡Œé€šä¿¡"><a href="#3-2-åœºæ™¯äºŒ-ä½¿ç”¨AIDLä¸ç”µè¯ç®¡ç†Servicè¿›è¡Œé€šä¿¡" class="headerlink" title="3.2 åœºæ™¯äºŒ: ä½¿ç”¨AIDLä¸ç”µè¯ç®¡ç†Servicè¿›è¡Œé€šä¿¡"></a>3.2 åœºæ™¯äºŒ: ä½¿ç”¨AIDLä¸ç”µè¯ç®¡ç†Servicè¿›è¡Œé€šä¿¡</h3><blockquote><p>è·å–ç±»å¯¹è±¡ï¼Œé€šè¿‡åå°„å®ç°ä»£ç†</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Method method = Class.forName(<span class="hljs-string">&quot;android.os.ServiceManager&quot;</span>).getMethod(<span class="hljs-string">&quot;getService&quot;</span>,String.class);<br><span class="hljs-comment">// è·å–è¿œç¨‹TELEPHONY_SERVICEçš„IBinderå¯¹è±¡çš„ä»£ç†</span><br>IBinder binder =(IBinder) method.invoke(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> Object[] &#123; TELEPHONY_SERVICE&#125;);<br><span class="hljs-comment">// å°†IBinderå¯¹è±¡çš„ä»£ç†è½¬æ¢ä¸ºITelephonyå¯¹è±¡</span><br>ITelephonytelephony = ITelephony.Stub.asInterface(binder);<br><span class="hljs-comment">// æŒ‚æ–­ç”µè¯</span><br>telephony.endCall();<br></code></pre></td></tr></table></figure><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://blog.csdn.net/fengyuzhengfan/article/details/38086743">https://blog.csdn.net/fengyuzhengfan/article/details/38086743</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span>JDK1.8_APIâ€¦/docs/api/java/lang/Class.html<a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="http://www.ibm.com/developerworks/cn/java/j-lo-classloader/">http://www.ibm.com/developerworks/cn/java/j-lo-classloader/</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://blog.csdn.net/riemann_/article/details/86769805">https://blog.csdn.net/riemann_/article/details/86769805</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaåˆå§‹åŒ–å‘ç”Ÿæ—¶æœº</title>
    <link href="/2021/04/05/Java%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E6%9C%BA/"/>
    <url>/2021/04/05/Java%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="Javaåˆå§‹åŒ–çš„æ—¶æœº"><a href="#Javaåˆå§‹åŒ–çš„æ—¶æœº" class="headerlink" title="Javaåˆå§‹åŒ–çš„æ—¶æœº"></a>Javaåˆå§‹åŒ–çš„æ—¶æœº</h1><p>Javaè™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰å¼ºåˆ¶æ€§çº¦æŸåœ¨ä»€ä¹ˆæ—¶å€™å¼€å§‹ç±»åŠ è½½è¿‡ç¨‹ï¼Œä½†æ˜¯å¯¹äºåˆå§‹åŒ–é˜¶æ®µï¼Œè™šæ‹Ÿæœºè§„èŒƒåˆ™ä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰å››ç§æƒ…å†µå¿…éœ€ç«‹å³å¯¹ç±»è¿›è¡Œâ€œåˆå§‹åŒ–â€ï¼ˆè€ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è¿æ¥é˜¶æ®µåˆ™å¿…éœ€åœ¨æ­¤ä¹‹å‰å¼€å§‹ï¼‰</p><p>é»‘é©¬çš„JVMè¯¾ç¨‹ä¸­æåˆ°è¿‡<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://www.bilibili.com/video/BV1yE411Z7AP">[3]</span></a></sup>ï¼Œå…·ä½“è§<a href="http://lihengxu.cn/2021/04/17/JVM/#%E5%8F%91%E7%94%9F%E6%97%B6%E6%9C%BA">ç¬”è®°</a></p><blockquote><p><strong>åˆå§‹åŒ–å‘ç”Ÿæ—¶æœº</strong></p></blockquote><p><strong>ç±»çš„åˆå§‹åŒ–çš„æ‡’æƒ°çš„</strong>ï¼Œä»¥ä¸‹æƒ…å†µä¼šåˆå§‹åŒ–</p><ul><li>main æ–¹æ³•æ‰€åœ¨çš„ç±»ï¼Œæ€»ä¼šè¢«é¦–å…ˆåˆå§‹åŒ–</li><li>é¦–æ¬¡è®¿é—®è¿™ä¸ªç±»çš„é™æ€å˜é‡æˆ–é™æ€æ–¹æ³•æ—¶</li><li>å­ç±»åˆå§‹åŒ–ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–ï¼Œä¼šå¼•å‘</li><li>å­ç±»è®¿é—®çˆ¶ç±»çš„é™æ€å˜é‡ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–</li><li>Class.forName</li><li>new ä¼šå¯¼è‡´åˆå§‹åŒ–</li></ul><p>ä»¥ä¸‹æƒ…å†µä¸ä¼šåˆå§‹åŒ–</p><ul><li>è®¿é—®ç±»çš„ static ï¬nal é™æ€å¸¸é‡ï¼ˆåŸºæœ¬ç±»å‹å’Œå­—ç¬¦ä¸²ï¼‰</li><li>ç±»å¯¹è±¡.class ä¸ä¼šè§¦å‘åˆå§‹åŒ–</li><li>åˆ›å»ºè¯¥ç±»å¯¹è±¡çš„æ•°ç»„</li><li>ç±»åŠ è½½å™¨çš„.loadClassæ–¹æ³•</li><li>Class.forNamedçš„å‚æ•°2ä¸ºfalseæ—¶</li></ul><p><strong>éªŒè¯ç±»æ˜¯å¦è¢«åˆå§‹åŒ–ï¼Œå¯ä»¥çœ‹æ”¹ç±»çš„é™æ€ä»£ç å—æ˜¯å¦è¢«æ‰§è¡Œ</strong></p><h2 id="1-å››ç§æƒ…å†µå½’ç±»"><a href="#1-å››ç§æƒ…å†µå½’ç±»" class="headerlink" title="1. å››ç§æƒ…å†µå½’ç±»"></a>1. å››ç§æƒ…å†µå½’ç±»</h2><ul><li><p>é‡åˆ°newã€getstaticã€putstaticæˆ–invokestaticè¿™4æ¡å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ç”Ÿæˆè¿™4æ¡æŒ‡ä»¤æœ€å¸¸è§çš„Javaä»£ç åœºæ™¯æ˜¯ï¼šä½¿ç”¨newå…³é”®å­—å®ä¾‹åŒ–å¯¹è±¡æ—¶ã€è¯»å–æˆ–è€…è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€å­—æ®µï¼ˆè¢«finalä¿®é¥°ã€å·²åœ¨ç¼–è¯‘å™¨æŠŠç»“æœæ”¾å…¥å¸¸é‡æ± çš„é™æ€å­—æ®µé™¤å¤–ï¼‰æ—¶ã€ä»¥åŠè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•çš„æ—¶å€™ã€‚</p></li><li><p>ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚</p></li><li><p>å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦è§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</p></li><li><p>å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªæ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«main()æ–¹æ³•çš„ç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªç±»ã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%97%B6%E6%9C%BA_1_20210405.png"></p><p>å¯¹äºè¿™å››ç§è§¦å‘ç±»è¿›è¡Œåˆå§‹åŒ–çš„åœºæ™¯ï¼Œåœ¨javaè™šæ‹Ÿæœºè§„èŒƒä¸­é™å®šäº†â€œ<strong>æœ‰ä¸”åªæœ‰</strong>â€è¿™å››ç§åœºæ™¯ä¼šè§¦å‘ã€‚è¿™å››ç§åœºæ™¯çš„è¡Œä¸ºç§°ä¸ºå¯¹ç±»çš„ä¸»åŠ¨å¼•ç”¨ï¼Œé™¤æ­¤ä»¥å¤–çš„æ‰€æœ‰å¼•ç”¨ç±»çš„æ–¹å¼éƒ½ä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ï¼Œç§°ä¸ºè¢«åŠ¨å¼•ç”¨ã€‚</p><h2 id="2-ä¸‰ä¸ªå®ä¾‹è¯´æ˜è¢«åŠ¨å¼•ç”¨"><a href="#2-ä¸‰ä¸ªå®ä¾‹è¯´æ˜è¢«åŠ¨å¼•ç”¨" class="headerlink" title="2. ä¸‰ä¸ªå®ä¾‹è¯´æ˜è¢«åŠ¨å¼•ç”¨"></a>2. ä¸‰ä¸ªå®ä¾‹è¯´æ˜è¢«åŠ¨å¼•ç”¨</h2><ul><li>ç¤ºä¾‹ä¸€</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// çˆ¶ç±»SuperClass.java </span><br><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * ClassName:SuperClass &lt;br/&gt; </span><br><span class="hljs-comment"> * Function: è¢«åŠ¨ä½¿ç”¨ç±»ï¼šé€šè¿‡å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å­—æ®µï¼Œä¸ä¼šå¯¼è‡´å­ç±»åˆå§‹åŒ–. &lt;br/&gt;    </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SuperClass</span> </span>&#123;  <br>    <span class="hljs-keyword">static</span>&#123;  <br>        System.out.println(<span class="hljs-string">&quot;SuperClass init!&quot;</span>);  <br>    &#125;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> value = <span class="hljs-number">123</span>;  <br>&#125;  <br><br><span class="hljs-comment">// å­ç±»SubClass.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SuperClass</span> </span>&#123;  <br>    <span class="hljs-keyword">static</span>&#123;  <br>        System.out.println(<span class="hljs-string">&quot;SubClass init!&quot;</span>);  <br>    &#125;  <br>&#125;  <br><br><span class="hljs-comment">// ä¸»ç±»NotInitialization.java </span><br><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * ClassName:NotInitialization &lt;br/&gt; </span><br><span class="hljs-comment"> * Function: éä¸»åŠ¨ä½¿ç”¨ç±»å­—æ®µæ¼”ç¤º. &lt;br/&gt;     </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotInitialization</span> </span>&#123;  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;  <br>        System.out.println(SubClass.value);  <br>    &#125;  <br>&#125;  <br><br><br>è¾“å‡ºç»“æœï¼š<br>Txtä»£ç   æ”¶è—ä»£ç <br>SuperClass init!  <br><span class="hljs-number">123</span>  <br></code></pre></td></tr></table></figure><blockquote><p>ç”±ç»“æœå¯ä»¥çœ‹å‡ºåªè¾“å‡ºäº†â€œSuperClass initï¼â€ï¼Œæ²¡æœ‰è¾“å‡ºâ€œSubClass initï¼â€ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºé™æ€å­—æ®µï¼Œåªæœ‰ç›´æ¥å®šä¹‰è¯¥å­—æ®µçš„ç±»æ‰ä¼šè¢«åˆå§‹åŒ–ï¼Œå› æ­¤å½“æˆ‘ä»¬é€šè¿‡å­ç±»æ¥å¼•ç”¨çˆ¶ç±»ä¸­å®šä¹‰çš„é™æ€å­—æ®µæ—¶ï¼Œåªä¼šè§¦å‘çˆ¶ç±»çš„åˆå§‹åŒ–ï¼Œè€Œä¸ä¼šè§¦å‘å­ç±»çš„åˆå§‹åŒ–ã€‚</p></blockquote><ul><li>ç¤ºä¾‹äºŒ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// çˆ¶ç±»SuperClass.javaå¦‚ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸€æ ·</span><br><br><span class="hljs-comment">// ä¸»ç±»NotInitialization.java </span><br><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * ClassName:NotInitialization &lt;br/&gt; </span><br><span class="hljs-comment"> * Function: é€šè¿‡æ•°ç»„å®šä¹‰æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘æ­¤ç±»çš„åˆå§‹åŒ–. &lt;br/&gt;     </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotInitialization</span> </span>&#123;  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;  <br>        SuperClass[] scs = <span class="hljs-keyword">new</span> SuperClass[<span class="hljs-number">10</span>];  <br>    &#125;  <br>&#125;  <br><br>è¾“å‡ºç»“æœä¸ºç©º<br></code></pre></td></tr></table></figure><blockquote><p>æ²¡æœ‰è¾“å‡ºâ€œSuperClass initï¼â€è¯´æ˜æ²¡æœ‰è§¦å‘ç±»com.chenzhou.classloading.SuperClassçš„åˆå§‹åŒ–é˜¶æ®µï¼Œä½†æ˜¯è¿™æ®µä»£ç ä¼šè§¦å‘â€œ[Lcom.chenzhou.classloading.SuperClassâ€ç±»çš„åˆå§‹åŒ–é˜¶æ®µã€‚è¿™ä¸ªç±»æ˜¯ç”±è™šæ‹Ÿæœºè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè¯¥åˆ›å»ºåŠ¨ä½œç”±newarrayè§¦å‘ã€‚</p></blockquote><ul><li>ç¤ºä¾‹ä¸‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¸¸é‡ç±»ConstClass.java</span><br><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * ClassName:ConstClass &lt;br/&gt; </span><br><span class="hljs-comment"> * Function: å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µä¼šå­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰ç›´æ¥å¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ï¼Œå› æ­¤ä¸ä¼šè§¦å‘å®šä¹‰å¸¸é‡çš„ç±»çš„åˆå§‹åŒ–. &lt;br/&gt;       </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConstClass</span> </span>&#123;  <br>    <span class="hljs-keyword">static</span>&#123;  <br>        System.out.println(<span class="hljs-string">&quot;ConstClass init!&quot;</span>);  <br>    &#125;  <br>      <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String HELLOWORLD = <span class="hljs-string">&quot;hello world&quot;</span>;  <br>&#125; <br><br><span class="hljs-comment">// ä¸»ç±»NotInitialization.java </span><br><span class="hljs-comment">/** </span><br><span class="hljs-comment"> * ClassName:NotInitialization &lt;br/&gt; </span><br><span class="hljs-comment"> * Function: éä¸»åŠ¨å®ç”¨ç±»å­—æ®µæ¼”ç¤º. &lt;br/&gt;      </span><br><span class="hljs-comment"> */</span>  <br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NotInitialization</span> </span>&#123;  <br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;  <br>        System.out.println(ConstClass.HELLOWORLD);  <br>    &#125;  <br>&#125;  <br><br>è¾“å‡ºï¼š<br>hello world<br></code></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç è¿è¡Œåä¹Ÿæ²¡æœ‰è¾“å‡ºâ€œSuperClass initï¼â€ï¼Œè¿™æ˜¯å› ä¸ºè™½ç„¶åœ¨Javaæºç ä¸­å¼•ç”¨äº†ConstClassç±»ä¸­çš„å¸¸é‡HELLOWORLDï¼Œä½†æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå°†æ­¤å¸¸é‡çš„å€¼â€œhello worldâ€å­˜å‚¨åˆ°äº†NotInitializationç±»çš„å¸¸é‡æ± ä¸­ï¼Œå¯¹äºå¸¸é‡ConstClass.HELLOWORLDçš„å¼•ç”¨å®é™…ä¸Šéƒ½è¢«è½¬åŒ–ä¸ºNotInitializationç±»å¯¹è‡ªèº«å¸¸é‡æ± çš„å¼•ç”¨äº†ã€‚å®é™…ä¸ŠNotInitializationçš„Classæ–‡ä»¶ä¹‹ä¸­å·²ç»ä¸å­˜åœ¨ConstClassç±»çš„ç¬¦å·å¼•ç”¨å…¥å£äº†ã€‚</p></blockquote><h2 id="3-æ¥å£åŠ è½½"><a href="#3-æ¥å£åŠ è½½" class="headerlink" title="3. æ¥å£åŠ è½½"></a>3. æ¥å£åŠ è½½</h2><p>æ¥å£çš„åŠ è½½è¿‡ç¨‹ä¸ç±»åŠ è½½çš„åŒºåˆ«åœ¨äºä¸Šé¢æåˆ°çš„å››ç§åœºæ™¯ä¸­çš„ç¬¬ä¸‰ç§ï¼Œå½“ç±»åœ¨åˆå§‹åŒ–æ—¶è¦æ±‚å…¶çˆ¶ç±»éƒ½å·²ç»åˆå§‹åŒ–è¿‡äº†ï¼Œä½†æ˜¯ä¸€ä¸ªæ¥å£åœ¨åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸è¦æ±‚å…¶çˆ¶ç±»éƒ½å®Œæˆäº†åˆå§‹åŒ–ï¼Œåªæœ‰åœ¨çœŸæ­£ç”¨åˆ°çˆ¶ç±»æ¥å£çš„æ—¶å€™ï¼ˆå¦‚å¼•ç”¨çˆ¶æ¥å£çš„å¸¸é‡ï¼‰æ‰ä¼šåˆå§‹åŒ–ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="http://chenzhou123520.iteye.com/blog/1597597">http://chenzhou123520.iteye.com/blog/1597597</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="http://www.360doc.com/content/20/0602/17/70282097_916085081.shtml">http://www.360doc.com/content/20/0602/17/70282097_916085081.shtml</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://www.bilibili.com/video/BV1yE411Z7AP">https://www.bilibili.com/video/BV1yE411Z7AP</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>JVM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JUnitå•å…ƒæµ‹è¯•ã€åå°„ã€æ³¨è§£ã€åŠ¨æ€ä»£ç†</title>
    <link href="/2021/04/03/JUnit%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E3%80%81%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E3%80%81JDK8%E6%96%B0%E7%89%B9%E6%80%A7/"/>
    <url>/2021/04/03/JUnit%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E3%80%81%E5%8F%8D%E5%B0%84%E3%80%81%E6%B3%A8%E8%A7%A3%E3%80%81%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E3%80%81JDK8%E6%96%B0%E7%89%B9%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="JUnitå•å…ƒæµ‹è¯•ã€åå°„ã€æ³¨è§£ã€åŠ¨æ€ä»£ç†"><a href="#JUnitå•å…ƒæµ‹è¯•ã€åå°„ã€æ³¨è§£ã€åŠ¨æ€ä»£ç†" class="headerlink" title="JUnitå•å…ƒæµ‹è¯•ã€åå°„ã€æ³¨è§£ã€åŠ¨æ€ä»£ç†"></a>JUnitå•å…ƒæµ‹è¯•ã€åå°„ã€æ³¨è§£ã€åŠ¨æ€ä»£ç†</h1><p>ç›´æ¥ä¸Šä¼ çš„é»‘é©¬çš„å®˜æ–¹ç¬”è®°ã€‚</p><p><strong>åå°„</strong>ã€æ³¨è§£ã€<strong>åŠ¨æ€ä»£ç†</strong>åœ¨è®¸å¤šæ¡†æ¶éƒ½æœ‰ä½¿ç”¨ã€‚</p><p>æœ€è¿‘çœ‹Mybatisä»£ç æ—¶ï¼Œæœ‰ç‚¹å¿˜äº†ï¼Œä¼ ä¸Šæ¥å¥½ç»å¸¸å¤ä¹ ã€‚</p><h1 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h1><ul><li><input disabled="" type="checkbox"> èƒ½å¤Ÿä½¿ç”¨Junitè¿›è¡Œå•å…ƒæµ‹è¯•</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡åå°„æŠ€æœ¯è·å–Classå­—èŠ‚ç å¯¹è±¡</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡åå°„æŠ€æœ¯è·å–æ„é€ æ–¹æ³•å¯¹è±¡ï¼Œå¹¶åˆ›å»ºå¯¹è±¡ã€‚</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡åå°„è·å–æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œå¹¶ä¸”è°ƒç”¨æ–¹æ³•ã€‚</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿé€šè¿‡åå°„è·å–å±æ€§å¯¹è±¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿç»™å¯¹è±¡çš„å±æ€§èµ‹å€¼å’Œå–å€¼ã€‚</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿè¯´å‡ºæ³¨è§£çš„ä½œç”¨ </li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿè‡ªå®šä¹‰æ³¨è§£å’Œä½¿ç”¨æ³¨è§£</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿè¯´å‡ºå¸¸ç”¨çš„å…ƒæ³¨è§£åŠå…¶ä½œç”¨</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿè§£ææ³¨è§£å¹¶è·å–æ³¨è§£ä¸­çš„æ•°æ®</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿå®Œæˆæ³¨è§£çš„MyTestæ¡ˆä¾‹</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿè¯´å‡ºåŠ¨æ€ä»£ç†æ¨¡å¼çš„ä½œç”¨</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿä½¿ç”¨Proxyçš„æ–¹æ³•ç”Ÿæˆä»£ç†å¯¹è±¡</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿä½¿ç”¨å››ç§æ–¹æ³•çš„å¼•ç”¨</li><li><input disabled="" type="checkbox"> èƒ½å¤Ÿä½¿ç”¨Base64å¯¹åŸºæœ¬æ•°æ®ã€URLå’ŒMIMEç±»å‹è¿›è¡Œç¼–è§£ç </li></ul><h1 id="ç¬¬ä¸€ç« -Junitå•å…ƒæµ‹è¯•"><a href="#ç¬¬ä¸€ç« -Junitå•å…ƒæµ‹è¯•" class="headerlink" title="ç¬¬ä¸€ç«  Junitå•å…ƒæµ‹è¯•"></a>ç¬¬ä¸€ç«  Junitå•å…ƒæµ‹è¯•</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java">Junitæ˜¯ä»€ä¹ˆ<br>    *  Junitæ˜¯Javaè¯­è¨€ç¼–å†™çš„ç¬¬ä¸‰æ–¹å•å…ƒæµ‹è¯•æ¡†æ¶(å·¥å…·ç±»)<br>    *  ç±»åº“ ==&gt; ç±»  junit.jar<br><br>å•å…ƒæµ‹è¯•æ¦‚å¿µ<br>    * å•å…ƒï¼šåœ¨Javaä¸­ï¼Œä¸€ä¸ªç±»å°±æ˜¯ä¸€ä¸ªå•å…ƒ<br>    * å•å…ƒæµ‹è¯•ï¼šç¨‹åºçŒ¿ç¼–å†™çš„ä¸€å°æ®µä»£ç ï¼Œç”¨æ¥å¯¹æŸä¸ªç±»ä¸­çš„æŸä¸ªæ–¹æ³•è¿›è¡ŒåŠŸèƒ½æµ‹è¯•æˆ–ä¸šåŠ¡é€»è¾‘æµ‹è¯•ã€‚<br><br>Junitå•å…ƒæµ‹è¯•æ¡†æ¶çš„ä½œç”¨<br>    * ç”¨æ¥å¯¹ç±»ä¸­çš„æ–¹æ³•åŠŸèƒ½è¿›è¡Œæœ‰ç›®çš„çš„æµ‹è¯•ï¼Œä»¥ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚<br>    * èƒ½å¤Ÿè®©æ–¹æ³•ç‹¬ç«‹è¿è¡Œèµ·æ¥ã€‚<br><br>Junitå•å…ƒæµ‹è¯•æ¡†æ¶çš„ä½¿ç”¨æ­¥éª¤<br>    * ç¼–å†™ä¸šåŠ¡ç±»ï¼Œåœ¨ä¸šåŠ¡ç±»ä¸­ç¼–å†™ä¸šåŠ¡æ–¹æ³•ã€‚æ¯”å¦‚å¢åˆ æ”¹æŸ¥çš„æ–¹æ³•<br>    * ç¼–å†™æµ‹è¯•ç±»ï¼Œåœ¨æµ‹è¯•ç±»ä¸­ç¼–å†™æµ‹è¯•æ–¹æ³•ï¼Œåœ¨æµ‹è¯•æ–¹æ³•ä¸­ç¼–å†™æµ‹è¯•ä»£ç æ¥æµ‹è¯•ã€‚<br>        * æµ‹è¯•ç±»çš„å‘½åè§„èŒƒï¼šä»¥Testå¼€å¤´ï¼Œä»¥ä¸šåŠ¡ç±»ç±»åç»“å°¾ï¼Œä½¿ç”¨é©¼å³°å‘½åæ³•<br>            * æ¯ä¸€ä¸ªå•è¯é¦–å­—æ¯å¤§å†™ï¼Œç§°ä¸ºå¤§é©¼å³°å‘½åæ³•ï¼Œæ¯”å¦‚ç±»åï¼Œæ¥å£å...<br>            * ä»ç¬¬äºŒå•è¯å¼€å§‹é¦–å­—æ¯å¤§å†™ï¼Œç§°ä¸ºå°é©¼å³°å‘½åæ³•ï¼Œæ¯”å¦‚æ–¹æ³•å‘½å<br>            * æ¯”å¦‚ä¸šåŠ¡ç±»ç±»åï¼šProductDaoï¼Œé‚£ä¹ˆæµ‹è¯•ç±»ç±»åå°±åº”è¯¥å«ï¼šTestProductDao<br>        * æµ‹è¯•æ–¹æ³•çš„å‘½åè§„åˆ™ï¼šä»¥testå¼€å¤´ï¼Œä»¥ä¸šåŠ¡æ–¹æ³•åç»“å°¾<br>            * æ¯”å¦‚ä¸šåŠ¡æ–¹æ³•åä¸ºï¼šsaveï¼Œé‚£ä¹ˆæµ‹è¯•æ–¹æ³•åå°±åº”è¯¥å«ï¼štestSave<br><br>æµ‹è¯•æ–¹æ³•æ³¨æ„äº‹é¡¹<br>    * å¿…é¡»æ˜¯<span class="hljs-keyword">public</span>ä¿®é¥°çš„ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œæ²¡æœ‰å‚æ•°<br>    * å¿…é¡»ä½¿æ³¨è§£<span class="hljs-meta">@Test</span>ä¿®é¥°<br><br>å¦‚ä½•è¿è¡Œæµ‹è¯•æ–¹æ³•<br>    * é€‰ä¸­æ–¹æ³•å --&gt; å³é”® --&gt; Run <span class="hljs-string">&#x27;æµ‹è¯•æ–¹æ³•å&#x27;</span>  è¿è¡Œé€‰ä¸­çš„æµ‹è¯•æ–¹æ³•<br>    * é€‰ä¸­æµ‹è¯•ç±»ç±»å --&gt; å³é”® --&gt; Run <span class="hljs-string">&#x27;æµ‹è¯•ç±»ç±»å&#x27;</span>  è¿è¡Œæµ‹è¯•ç±»ä¸­æ‰€æœ‰æµ‹è¯•æ–¹æ³•<br>    * é€‰ä¸­æ¨¡å—å --&gt; å³é”® --&gt; Run <span class="hljs-string">&#x27;All Tests&#x27;</span>  è¿è¡Œæ¨¡å—ä¸­çš„æ‰€æœ‰æµ‹è¯•ç±»çš„æ‰€æœ‰æµ‹è¯•æ–¹æ³•<br><br>å¦‚ä½•æŸ¥çœ‹æµ‹è¯•ç»“æœ<br>    * ç»¿è‰²ï¼šè¡¨ç¤ºæµ‹è¯•é€šè¿‡<br>    * çº¢è‰²ï¼šè¡¨ç¤ºæµ‹è¯•å¤±è´¥ï¼Œæœ‰é—®é¢˜<br><br>Junitå¸¸ç”¨æ³¨è§£(Junit4.xxxxç‰ˆæœ¬)<br>    * <span class="hljs-meta">@Before</span>ï¼šç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚<br>    * <span class="hljs-meta">@After</span>ï¼šç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚<br>    * <span class="hljs-meta">@BeforeClass</span>ï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚<br>    * <span class="hljs-meta">@AfterClass</span>ï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚<br><br>Junitå¸¸ç”¨æ³¨è§£(Junit5.xxxxç‰ˆæœ¬)<br>     * <span class="hljs-meta">@BeforeEach</span>ï¼šç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚<br>     * <span class="hljs-meta">@AfterEach</span>ï¼šç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚<br>     * <span class="hljs-meta">@BeforeAll</span>ï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚<br>     * <span class="hljs-meta">@AfterAll</span>ï¼šç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚<br></code></pre></td></tr></table></figure><ul><li>ç¤ºä¾‹ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> ä¸šåŠ¡ç±»ï¼šå®ç°åŠ å‡ä¹˜é™¤è¿ç®—</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cacluate</span> </span>&#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     ä¸šåŠ¡æ–¹æ³•1ï¼šæ±‚aå’Œbä¹‹å’Œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a,<span class="hljs-keyword">int</span> b)</span></span>&#123;<br>        <span class="hljs-keyword">return</span>  a + b + <span class="hljs-number">10</span>;<br>    &#125;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     ä¸šåŠ¡æ–¹æ³•2:æ±‚aå’Œbä¹‹å·®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">sub</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a,<span class="hljs-keyword">int</span> b)</span></span>&#123;<br>        <span class="hljs-keyword">return</span>  a - b;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestCacluate</span> </span>&#123;<br><br>    <span class="hljs-keyword">static</span> Cacluate c = <span class="hljs-keyword">null</span>;<br><br>    <span class="hljs-meta">@BeforeClass</span> <span class="hljs-comment">// ç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;åˆå§‹åŒ–æ“ä½œ&quot;</span>);<br>        <span class="hljs-comment">// åˆ›å»ºCacluateå¯¹è±¡</span><br>        c = <span class="hljs-keyword">new</span> Cacluate();<br>    &#125;<br><br>    <span class="hljs-meta">@AfterClass</span> <span class="hljs-comment">// ç”¨æ¥é™æ€ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰æµ‹è¯•æ–¹æ³•ä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;é‡Šæ”¾èµ„æº&quot;</span>);<br>        c = <span class="hljs-keyword">null</span>;<br>    &#125;<br><br>   <span class="hljs-comment">/* @Before // ç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ã€‚</span><br><span class="hljs-comment">    public void init()&#123;</span><br><span class="hljs-comment">        System.out.println(&quot;åˆå§‹åŒ–æ“ä½œ&quot;);</span><br><span class="hljs-comment">        // åˆ›å»ºCacluateå¯¹è±¡</span><br><span class="hljs-comment">        c = new Cacluate();</span><br><span class="hljs-comment">    &#125;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">    @After // ç”¨æ¥ä¿®é¥°æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨æ¯ä¸€ä¸ªæµ‹è¯•æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œä¸€æ¬¡ã€‚</span><br><span class="hljs-comment">    public void close()&#123;</span><br><span class="hljs-comment">        System.out.println(&quot;é‡Šæ”¾èµ„æº&quot;);</span><br><span class="hljs-comment">        c = null;</span><br><span class="hljs-comment">    &#125;*/</span><br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSum</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">int</span> result = c.sum(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">            æ–­è¨€ï¼šé¢„ä¹ åˆ¤æ–­æŸä¸ªæ¡ä»¶ä¸€å®šæˆç«‹ï¼Œå¦‚æœæ¡ä»¶ä¸æˆç«‹ï¼Œåˆ™ç›´æ¥å¥”æºƒã€‚</span><br><span class="hljs-comment">            assertEqualsæ–¹æ³•çš„å‚æ•°</span><br><span class="hljs-comment">            (String message, double expected, double actual)</span><br><span class="hljs-comment">            messageï¼š æ¶ˆæ¯å­—ç¬¦ä¸²</span><br><span class="hljs-comment">            expected: æœŸæœ›å€¼</span><br><span class="hljs-comment">            actual: å®é™…å€¼</span><br><span class="hljs-comment">         */</span><br>        <span class="hljs-comment">// å¦‚æœæœŸæœ›å€¼å’Œå®é™…å€¼ä¸€è‡´ï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸å‘ç”Ÿï¼Œå¦åˆ™ä¼šç›´æ¥å¥”æºƒã€‚</span><br>        Assert.assertEquals(<span class="hljs-string">&quot;æœŸæœ›å€¼å’Œå®é™…å€¼ä¸ä¸€è‡´&quot;</span>,<span class="hljs-number">12</span>,result);<br>        System.out.println(result);<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSub</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºCacluateå¯¹è±¡</span><br>        <span class="hljs-comment">// Cacluate c = new Cacluate();</span><br><br>        <span class="hljs-keyword">int</span> result = c.sub(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// å¦‚æœæœŸæœ›å€¼å’Œå®é™…å€¼ä¸€è‡´ï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸å‘ç”Ÿï¼Œå¦åˆ™ä¼šç›´æ¥å¥”æºƒã€‚</span><br>        Assert.assertEquals(<span class="hljs-string">&quot;æœŸæœ›å€¼å’Œå®é™…å€¼ä¸ä¸€è‡´&quot;</span>,<span class="hljs-number">0</span>,result);<br>        System.out.println(result);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç¬¬äºŒç« -åå°„"><a href="#ç¬¬äºŒç« -åå°„" class="headerlink" title="ç¬¬äºŒç«  åå°„"></a>ç¬¬äºŒç«  åå°„</h1><h2 id="2-1-åå°„çš„æ¦‚è¿°"><a href="#2-1-åå°„çš„æ¦‚è¿°" class="headerlink" title="2.1 åå°„çš„æ¦‚è¿°"></a>2.1 åå°„çš„æ¦‚è¿°</h2><h3 id="2-1-1-åå°„çš„å¼•å…¥"><a href="#2-1-1-åå°„çš„å¼•å…¥" class="headerlink" title="2.1.1  åå°„çš„å¼•å…¥"></a>2.1.1  åå°„çš„å¼•å…¥</h3><ul><li>é—®é¢˜ï¼šIDEAä¸­çš„å¯¹è±¡æ˜¯æ€ä¹ˆçŸ¥é“ç±»æœ‰å“ªäº›å±æ€§ï¼Œå“ªäº›æ–¹æ³•çš„å‘¢ï¼Ÿ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">é€šè¿‡åå°„æŠ€æœ¯å¯¹è±¡ç±»è¿›è¡Œäº†è§£å‰–å¾—åˆ°äº†ç±»çš„æ‰€æœ‰æˆå‘˜ã€‚<br></code></pre></td></tr></table></figure><h3 id="2-1-2-åå°„çš„æ¦‚å¿µ"><a href="#2-1-2-åå°„çš„æ¦‚å¿µ" class="headerlink" title="2.1.2  åå°„çš„æ¦‚å¿µ"></a>2.1.2  åå°„çš„æ¦‚å¿µ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">åå°„æ˜¯ä¸€ç§æœºåˆ¶ï¼Œåˆ©ç”¨è¯¥æœºåˆ¶å¯ä»¥åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¯¹ç±»è¿›è¡Œè§£å‰–å¹¶æ“ä½œç±»ä¸­çš„æ‰€æœ‰æˆå‘˜(æˆå‘˜å˜é‡ï¼Œæˆå‘˜æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•)<br></code></pre></td></tr></table></figure><h3 id="2-1-3-ä½¿ç”¨åå°„æ“ä½œç±»æˆå‘˜çš„å‰æ"><a href="#2-1-3-ä½¿ç”¨åå°„æ“ä½œç±»æˆå‘˜çš„å‰æ" class="headerlink" title="2.1.3 ä½¿ç”¨åå°„æ“ä½œç±»æˆå‘˜çš„å‰æ"></a>2.1.3 ä½¿ç”¨åå°„æ“ä½œç±»æˆå‘˜çš„å‰æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">è¦è·å¾—è¯¥ç±»å­—èŠ‚ç æ–‡ä»¶å¯¹è±¡ï¼Œå°±æ˜¯Classå¯¹è±¡<br></code></pre></td></tr></table></figure><h3 id="2-1-4-åå°„åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨"><a href="#2-1-4-åå°„åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨" class="headerlink" title="2.1.4 åå°„åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨"></a>2.1.4 åå°„åœ¨å®é™…å¼€å‘ä¸­çš„åº”ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">* å¼€å‘IDE(é›†æˆå¼€å‘ç¯å¢ƒ)ï¼Œæ¯”å¦‚IDEA,Eclipse<br>* å„ç§æ¡†æ¶çš„è®¾è®¡å’Œå­¦ä¹  æ¯”å¦‚Springï¼ŒHibernateï¼ŒStructï¼ŒMybaits....<br></code></pre></td></tr></table></figure><h2 id="2-2-Classå¯¹è±¡çš„è·å–æ–¹å¼"><a href="#2-2-Classå¯¹è±¡çš„è·å–æ–¹å¼" class="headerlink" title="2.2 Classå¯¹è±¡çš„è·å–æ–¹å¼"></a>2.2 Classå¯¹è±¡çš„è·å–æ–¹å¼</h2><h3 id="2-2-1-ä¸‰ç§è·å–æ–¹æ³•"><a href="#2-2-1-ä¸‰ç§è·å–æ–¹æ³•" class="headerlink" title="2.2.1 ä¸‰ç§è·å–æ–¹æ³•"></a>2.2.1 ä¸‰ç§è·å–æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">* æ–¹å¼<span class="hljs-number">1</span>: é€šè¿‡ç±»å.classè·å¾—<br>* æ–¹å¼<span class="hljs-number">2</span>ï¼šé€šè¿‡å¯¹è±¡å.getClass()æ–¹æ³•è·å¾—<br>* æ–¹å¼<span class="hljs-number">3</span>ï¼šé€šè¿‡Classç±»çš„é™æ€æ–¹æ³•è·å¾—ï¼š <span class="hljs-function"><span class="hljs-keyword">static</span> Class <span class="hljs-title">forName</span><span class="hljs-params">(<span class="hljs-string">&quot;ç±»å…¨å&quot;</span>)</span></span><br><span class="hljs-function">    * æ¯ä¸€ä¸ªç±»çš„Classå¯¹è±¡éƒ½åªæœ‰ä¸€ä¸ªã€‚</span><br></code></pre></td></tr></table></figure><ul><li>ç¤ºä¾‹ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReflectDemo01</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Studentç±»å¯¹åº”çš„Classå¯¹è±¡</span><br>        Class c1 = Student.class;<br><br>        <span class="hljs-comment">// åˆ›å»ºå­¦ç”Ÿå¯¹è±¡</span><br>        Student stu = <span class="hljs-keyword">new</span> Student();<br>        <span class="hljs-comment">// é€šè¿‡getClassæ–¹æ³•</span><br>        Class c2 = stu.getClass();<br>        System.out.println(c1 == c2);<br><br>        <span class="hljs-comment">// é€šè¿‡Classç±»çš„é™æ€æ–¹æ³•è·å¾—ï¼š static Class forName(&quot;ç±»å…¨å&quot;)</span><br>        Class c3 = Class.forName(<span class="hljs-string">&quot;com.itheima._03åå°„.Student&quot;</span>);<br>        System.out.println(c1 == c3);<br>        System.out.println(c2 == c3);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-2-Classç±»å¸¸ç”¨æ–¹æ³•"><a href="#2-2-2-Classç±»å¸¸ç”¨æ–¹æ³•" class="headerlink" title="2.2.2 Classç±»å¸¸ç”¨æ–¹æ³•"></a>2.2.2 Classç±»å¸¸ç”¨æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function">String <span class="hljs-title">getSimpleName</span><span class="hljs-params">()</span></span>; è·å¾—ç±»åå­—ç¬¦ä¸²ï¼šç±»å<br><span class="hljs-function">String <span class="hljs-title">getName</span><span class="hljs-params">()</span></span>;  è·å¾—ç±»å…¨åï¼šåŒ…å+ç±»å<br><span class="hljs-function">T <span class="hljs-title">newInstance</span><span class="hljs-params">()</span> </span>;  åˆ›å»ºClasså¯¹è±¡å…³è”ç±»çš„å¯¹è±¡<br></code></pre></td></tr></table></figure><ul><li>ç¤ºä¾‹ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReflectDemo02</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = Student.class;<br>        <span class="hljs-comment">// è·å¾—ç±»åå­—ç¬¦ä¸²ï¼šç±»å</span><br>        System.out.println(c.getSimpleName());<br>        <span class="hljs-comment">// è·å¾—ç±»å…¨åï¼šåŒ…å+ç±»å</span><br>        System.out.println(c.getName());<br>        <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡</span><br>        Student stu = (Student) c.newInstance();<br>        System.out.println(stu);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-3-åå°„ä¹‹æ“ä½œæ„é€ æ–¹æ³•"><a href="#2-3-åå°„ä¹‹æ“ä½œæ„é€ æ–¹æ³•" class="headerlink" title="2.3 åå°„ä¹‹æ“ä½œæ„é€ æ–¹æ³•"></a>2.3 åå°„ä¹‹æ“ä½œæ„é€ æ–¹æ³•</h2><h3 id="2-3-1-Constructorç±»æ¦‚è¿°"><a href="#2-3-1-Constructorç±»æ¦‚è¿°" class="headerlink" title="2.3.1 Constructorç±»æ¦‚è¿°"></a>2.3.1 Constructorç±»æ¦‚è¿°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">åå°„ä¹‹æ“ä½œæ„é€ æ–¹æ³•çš„ç›®çš„<br>    * è·å¾—Constructorå¯¹è±¡æ¥åˆ›å»ºç±»çš„å¯¹è±¡ã€‚<br><br>Constructorç±»æ¦‚è¿°<br>    * ç±»ä¸­çš„æ¯ä¸€ä¸ªæ„é€ æ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªConstructorç±»çš„å¯¹è±¡<br></code></pre></td></tr></table></figure><h3 id="2-3-2-Classç±»ä¸­ä¸Constructorç›¸å…³çš„æ–¹æ³•"><a href="#2-3-2-Classç±»ä¸­ä¸Constructorç›¸å…³çš„æ–¹æ³•" class="headerlink" title="2.3.2 Classç±»ä¸­ä¸Constructorç›¸å…³çš„æ–¹æ³•"></a>2.3.2 Classç±»ä¸­ä¸Constructorç›¸å…³çš„æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1.</span> <span class="hljs-function">Constructor <span class="hljs-title">getConstructor</span><span class="hljs-params">(Class... parameterTypes)</span></span><br><span class="hljs-function">        * æ ¹æ®å‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„Constructorå¯¹è±¡ã€‚</span><br><span class="hljs-function">        * åªèƒ½è·å¾—<span class="hljs-keyword">public</span>ä¿®é¥°çš„æ„é€ æ–¹æ³•</span><br><span class="hljs-function"> 2. Constructor <span class="hljs-title">getDeclaredConstructor</span><span class="hljs-params">(Class... parameterTypes)</span></span><br><span class="hljs-function">         * æ ¹æ®å‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„Constructorå¯¹è±¡ï¼ŒåŒ…æ‹¬<span class="hljs-keyword">private</span></span><br><span class="hljs-function"> 3. Constructor[] <span class="hljs-title">getConstructors</span><span class="hljs-params">()</span></span><br><span class="hljs-function">        è·å¾—ç±»ä¸­çš„æ‰€æœ‰æ„é€ æ–¹æ³•å¯¹è±¡ï¼Œåªèƒ½è·å¾—<span class="hljs-keyword">public</span>çš„</span><br><span class="hljs-function"> 4. Constructor[] <span class="hljs-title">getDeclaredConstructors</span><span class="hljs-params">()</span></span><br><span class="hljs-function">        è·å¾—ç±»ä¸­çš„æ‰€æœ‰æ„é€ æ–¹æ³•å¯¹è±¡ï¼ŒåŒ…æ‹¬<span class="hljs-keyword">private</span>ä¿®é¥°çš„</span><br></code></pre></td></tr></table></figure><h3 id="2-3-3-Constructorå¯¹è±¡å¸¸ç”¨æ–¹æ³•"><a href="#2-3-3-Constructorå¯¹è±¡å¸¸ç”¨æ–¹æ³•" class="headerlink" title="2.3.3 Constructorå¯¹è±¡å¸¸ç”¨æ–¹æ³•"></a>2.3.3 Constructorå¯¹è±¡å¸¸ç”¨æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1.</span> <span class="hljs-function">T <span class="hljs-title">newInstance</span><span class="hljs-params">(Object... initargs)</span></span><br><span class="hljs-function"> æ ¹æ®æŒ‡å®šçš„å‚æ•°åˆ›å»ºå¯¹è±¡</span><br><span class="hljs-function">2. <span class="hljs-keyword">void</span> <span class="hljs-title">setAccessible</span><span class="hljs-params">(<span class="hljs-keyword">true</span>)</span></span><br><span class="hljs-function">   è®¾ç½®æ˜¯å¦å–æ¶ˆæƒé™æ£€æŸ¥ï¼Œ<span class="hljs-keyword">true</span>å–æ¶ˆæƒé™æ£€æŸ¥ï¼Œ<span class="hljs-keyword">false</span>è¡¨ç¤ºä¸å–æ¶ˆ<span class="hljs-params">(æš´åŠ›åå°„)</span></span><br></code></pre></td></tr></table></figure><h3 id="2-3-4-ç¤ºä¾‹ä»£ç "><a href="#2-3-4-ç¤ºä¾‹ä»£ç " class="headerlink" title="2.3.4 ç¤ºä¾‹ä»£ç "></a>2.3.4 ç¤ºä¾‹ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReflectDemo03</span> </span>&#123;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">      Constructor[] getConstructors()</span><br><span class="hljs-comment">           è·å¾—ç±»ä¸­çš„æ‰€æœ‰æ„é€ æ–¹æ³•å¯¹è±¡ï¼Œåªèƒ½è·å¾—publicçš„</span><br><span class="hljs-comment">      Constructor[] getDeclaredConstructors()</span><br><span class="hljs-comment">            è·å¾—ç±»ä¸­çš„æ‰€æœ‰æ„é€ æ–¹æ³•å¯¹è±¡ï¼ŒåŒ…æ‹¬privateä¿®é¥°çš„</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test03</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = Student.class;<br>        <span class="hljs-comment">//  è·å¾—ç±»ä¸­çš„æ‰€æœ‰æ„é€ æ–¹æ³•å¯¹è±¡ï¼Œåªèƒ½è·å¾—publicçš„</span><br>        <span class="hljs-comment">// Constructor[] cons = c.getConstructors();</span><br>        Constructor[] cons = c.getDeclaredConstructors();<br>        <span class="hljs-keyword">for</span> (Constructor con:cons) &#123;<br>            System.out.println(con);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">       Constructor getDeclaredConstructor(Class... parameterTypes)</span><br><span class="hljs-comment">           æ ¹æ®å‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„Constructorå¯¹è±¡</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test02</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = Student.class;<br>        <span class="hljs-comment">// è·å¾—ä¸¤ä¸ªå‚æ•°æ„é€ æ–¹æ³•å¯¹è±¡</span><br>        Constructor con = c.getDeclaredConstructor(String.class,String.class);<br>        <span class="hljs-comment">// å–æ¶ˆæƒé™æ£€æŸ¥(æš´åŠ›åå°„)</span><br>        con.setAccessible(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-comment">// æ ¹æ®æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡</span><br>        Object obj = con.newInstance(<span class="hljs-string">&quot;rose&quot;</span>,<span class="hljs-string">&quot;å¥³&quot;</span>);<br>        System.out.println(obj);<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        Constructor getConstructor(Class... parameterTypes)</span><br><span class="hljs-comment">            æ ¹æ®å‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„Constructorå¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test01</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = Student.class;<br>        <span class="hljs-comment">// è·å¾—æ— å‚æ•°æ„é€ æ–¹æ³•å¯¹è±¡</span><br>        Constructor con = c.getConstructor();<br>        <span class="hljs-comment">// æ ¹æ®æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡</span><br>        Object obj = con.newInstance();<br>        System.out.println(obj);<br><br>        <span class="hljs-comment">// è·å¾—æœ‰å‚æ•°çš„æ„é€ æ–¹æ³•å¯¹è±¡</span><br>        Constructor con2 = c.getConstructor(String.class, String.class,<span class="hljs-keyword">int</span>.class);<br>        <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡</span><br>        Object obj2 = con2.newInstance(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-string">&quot;ç”·&quot;</span>,<span class="hljs-number">18</span>);<br>        System.out.println(obj2);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-4-åå°„ä¹‹æ“ä½œæˆå‘˜æ–¹æ³•"><a href="#2-4-åå°„ä¹‹æ“ä½œæˆå‘˜æ–¹æ³•" class="headerlink" title="2.4 åå°„ä¹‹æ“ä½œæˆå‘˜æ–¹æ³•"></a>2.4 åå°„ä¹‹æ“ä½œæˆå‘˜æ–¹æ³•</h2><h3 id="2-4-1-Methodç±»æ¦‚è¿°"><a href="#2-4-1-Methodç±»æ¦‚è¿°" class="headerlink" title="2.4.1 Methodç±»æ¦‚è¿°"></a>2.4.1 Methodç±»æ¦‚è¿°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">åå°„ä¹‹æ“ä½œæˆå‘˜æ–¹æ³•çš„ç›®çš„<br>    * æ“ä½œMethodå¯¹è±¡æ¥è°ƒç”¨æˆå‘˜æ–¹æ³•<br>Methodç±»æ¦‚è¿°<br>    * æ¯ä¸€ä¸ªæˆå‘˜æ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªMethodç±»çš„å¯¹è±¡ã€‚<br></code></pre></td></tr></table></figure><h3 id="2-4-2-Classç±»ä¸­ä¸Methodç›¸å…³çš„æ–¹æ³•"><a href="#2-4-2-Classç±»ä¸­ä¸Methodç›¸å…³çš„æ–¹æ³•" class="headerlink" title="2.4.2 Classç±»ä¸­ä¸Methodç›¸å…³çš„æ–¹æ³•"></a>2.4.2 Classç±»ä¸­ä¸Methodç›¸å…³çš„æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">* <span class="hljs-function">Method <span class="hljs-title">getMethod</span><span class="hljs-params">(String name,Class...args)</span></span>;<br>    * æ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„æ„é€ æ–¹æ³•å¯¹è±¡ï¼Œåªèƒ½è·å¾—<span class="hljs-keyword">public</span>çš„<br><br>* <span class="hljs-function">Method <span class="hljs-title">getDeclaredMethod</span><span class="hljs-params">(String name,Class...args)</span></span>;<br>    * æ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„æ„é€ æ–¹æ³•å¯¹è±¡ï¼ŒåŒ…æ‹¬<span class="hljs-keyword">private</span>çš„<br><br>* Method[] getMethods();<br>    * è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„ï¼Œåªèƒ½è·å¾—<span class="hljs-keyword">public</span>ä¿®é¥°çš„ä¸”åŒ…å«çˆ¶ç±»çš„<br><br>* Method[] getDeclaredMethods();<br>    * è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„,åªè·å¾—æœ¬ç±»çš„ï¼ŒåŒ…å«<span class="hljs-keyword">private</span>ä¿®é¥°çš„<br></code></pre></td></tr></table></figure><h3 id="2-4-3-Methodå¯¹è±¡å¸¸ç”¨æ–¹æ³•"><a href="#2-4-3-Methodå¯¹è±¡å¸¸ç”¨æ–¹æ³•" class="headerlink" title="2.4.3 Methodå¯¹è±¡å¸¸ç”¨æ–¹æ³•"></a>2.4.3 Methodå¯¹è±¡å¸¸ç”¨æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">*  <span class="hljs-function">Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object obj, Object... args)</span></span><br><span class="hljs-function">    * è°ƒç”¨æŒ‡å®šå¯¹è±¡objçš„è¯¥æ–¹æ³•</span><br><span class="hljs-function">    * argsï¼šè°ƒç”¨æ–¹æ³•æ—¶ä¼ é€’çš„å‚æ•°</span><br><span class="hljs-function">*  <span class="hljs-keyword">void</span> <span class="hljs-title">setAccessible</span><span class="hljs-params">(<span class="hljs-keyword">true</span>)</span></span><br><span class="hljs-function">    è®¾ç½®æ˜¯å¦å–æ¶ˆæƒé™æ£€æŸ¥ï¼Œ<span class="hljs-keyword">true</span>å–æ¶ˆæƒé™æ£€æŸ¥ï¼Œ<span class="hljs-keyword">false</span>è¡¨ç¤ºä¸å–æ¶ˆ<span class="hljs-params">(æš´åŠ›åå°„)</span></span><br></code></pre></td></tr></table></figure><h3 id="2-4-4-ç¤ºä¾‹ä»£ç "><a href="#2-4-4-ç¤ºä¾‹ä»£ç " class="headerlink" title="2.4.4 ç¤ºä¾‹ä»£ç "></a>2.4.4 ç¤ºä¾‹ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReflectDemo04</span> </span>&#123;<br><br>    <span class="hljs-comment">// åå°„æ“ä½œé™æ€æ–¹æ³•</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test04</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = Student.class;<br>        <span class="hljs-comment">// æ ¹æ®æ–¹æ³•åè·å¾—å¯¹åº”çš„æˆå‘˜æ–¹æ³•å¯¹è±¡</span><br>        Method method = c.getDeclaredMethod(<span class="hljs-string">&quot;eat&quot;</span>,String.class);<br>        <span class="hljs-comment">// é€šè¿‡methodæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•</span><br>        method.invoke(<span class="hljs-keyword">null</span>,<span class="hljs-string">&quot;è›‹ç‚’é¥­&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * Method[] getMethods();</span><br><span class="hljs-comment">        * è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„ï¼Œåªèƒ½è·å¾—publicä¿®é¥°çš„ä¸”åŒ…å«çˆ¶ç±»çš„</span><br><span class="hljs-comment">     * Method[] getDeclaredMethods();</span><br><span class="hljs-comment">        * è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„,åªè·å¾—æœ¬ç±»çš„ï¼ŒåŒ…å«privateä¿®é¥°çš„</span><br><span class="hljs-comment">   */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test03</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = Student.class;<br>        <span class="hljs-comment">// è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„ï¼Œåªèƒ½è·å¾—publicä¿®é¥°çš„ä¸”åŒ…å«çˆ¶ç±»çš„</span><br>        <span class="hljs-comment">// Method[] methods = c.getMethods();</span><br>        <span class="hljs-comment">// è·å¾—ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜æ–¹æ³•å¯¹è±¡ï¼Œè¿”å›æ•°ç»„,åªè·å¾—æœ¬ç±»çš„ï¼ŒåŒ…å«privateä¿®é¥°çš„</span><br>        Method[] methods = c.getDeclaredMethods();<br>        <span class="hljs-keyword">for</span> (Method m: methods) &#123;<br>            System.out.println(m);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">       Method getDeclaredMethod(String name,Class...args);</span><br><span class="hljs-comment">           * æ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„æ„é€ æ–¹æ³•å¯¹è±¡ï¼Œ</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test02</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = Student.class;<br><br>        <span class="hljs-comment">// æ ¹æ®Classå¯¹è±¡åˆ›å»ºå­¦ç”Ÿå¯¹è±¡</span><br>        Student stu = (Student) c.newInstance();<br>        <span class="hljs-comment">// è·å¾—sleepæ–¹æ³•å¯¹åº”çš„Methodå¯¹è±¡</span><br>        Method m =  c.getDeclaredMethod(<span class="hljs-string">&quot;sleep&quot;</span>);<br>        <span class="hljs-comment">// æš´åŠ›åå°„</span><br>        m.setAccessible(<span class="hljs-keyword">true</span>);<br><br>        <span class="hljs-comment">// é€šè¿‡må¯¹è±¡æ‰§è¡Œstuyæ–¹æ³•</span><br>        m.invoke(stu);<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        Method getMethod(String name,Class...args);</span><br><span class="hljs-comment">            * æ ¹æ®æ–¹æ³•åå’Œå‚æ•°ç±»å‹è·å¾—å¯¹åº”çš„æ„é€ æ–¹æ³•å¯¹è±¡ï¼Œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test01</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = Student.class;<br>        <br>        <span class="hljs-comment">// æ ¹æ®Classå¯¹è±¡åˆ›å»ºå­¦ç”Ÿå¯¹è±¡</span><br>        Student stu = (Student) c.newInstance();<br>        <span class="hljs-comment">// è·å¾—studyæ–¹æ³•å¯¹åº”çš„Methodå¯¹è±¡</span><br>        Method m =  c.getMethod(<span class="hljs-string">&quot;study&quot;</span>);<br>        <span class="hljs-comment">// é€šè¿‡må¯¹è±¡æ‰§è¡Œstuyæ–¹æ³•</span><br>        m.invoke(stu);<br><br><br>        <span class="hljs-comment">/// è·å¾—studyæ–¹æ³•å¯¹åº”çš„Methodå¯¹è±¡</span><br>        Method m2  = c.getMethod(<span class="hljs-string">&quot;study&quot;</span>, <span class="hljs-keyword">int</span>.class);<br>        <span class="hljs-comment">// é€šè¿‡m2å¯¹è±¡æ‰§è¡Œstuyæ–¹æ³•</span><br>        m2.invoke(stu,<span class="hljs-number">8</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2-5-åå°„ä¹‹æ“ä½œæˆå‘˜å˜é‡"><a href="#2-5-åå°„ä¹‹æ“ä½œæˆå‘˜å˜é‡" class="headerlink" title="2.5 åå°„ä¹‹æ“ä½œæˆå‘˜å˜é‡"></a>2.5 åå°„ä¹‹æ“ä½œæˆå‘˜å˜é‡</h2><h3 id="2-5-1-Fieldç±»æ¦‚è¿°"><a href="#2-5-1-Fieldç±»æ¦‚è¿°" class="headerlink" title="2.5.1 Fieldç±»æ¦‚è¿°"></a>2.5.1 Fieldç±»æ¦‚è¿°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">åå°„ä¹‹æ“ä½œæˆå‘˜å˜é‡çš„ç›®çš„<br>    * é€šè¿‡Fieldå¯¹è±¡ç»™å¯¹åº”çš„æˆå‘˜å˜é‡èµ‹å€¼å’Œå–å€¼<br><br>Fieldç±»æ¦‚è¿°<br>    * æ¯ä¸€ä¸ªæˆå‘˜å˜é‡éƒ½æ˜¯ä¸€ä¸ªFieldç±»çš„å¯¹è±¡ã€‚<br></code></pre></td></tr></table></figure><h3 id="2-5-2-Classç±»ä¸­ä¸Fieldç›¸å…³çš„æ–¹æ³•"><a href="#2-5-2-Classç±»ä¸­ä¸Fieldç›¸å…³çš„æ–¹æ³•" class="headerlink" title="2.5.2 Classç±»ä¸­ä¸Fieldç›¸å…³çš„æ–¹æ³•"></a>2.5.2 Classç±»ä¸­ä¸Fieldç›¸å…³çš„æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">* <span class="hljs-function">Field <span class="hljs-title">getField</span><span class="hljs-params">(String name)</span></span>;<br>    *  æ ¹æ®æˆå‘˜å˜é‡åè·å¾—å¯¹åº”Fieldå¯¹è±¡ï¼Œåªèƒ½è·å¾—<span class="hljs-keyword">public</span>ä¿®é¥°<br>* <span class="hljs-function">Field <span class="hljs-title">getDeclaredField</span><span class="hljs-params">(String name)</span></span>;<br>    *  æ ¹æ®æˆå‘˜å˜é‡åè·å¾—å¯¹åº”Fieldå¯¹è±¡ï¼ŒåŒ…å«<span class="hljs-keyword">private</span>ä¿®é¥°çš„<br>* Field[] getFields();<br>    * è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼Œåªèƒ½è·å¾—<span class="hljs-keyword">public</span>çš„<br>* Field[] getDeclaredFields();<br>    * è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼ŒåŒ…å«<span class="hljs-keyword">private</span>çš„<br></code></pre></td></tr></table></figure><h3 id="2-5-3-Fieldå¯¹è±¡å¸¸ç”¨æ–¹æ³•"><a href="#2-5-3-Fieldå¯¹è±¡å¸¸ç”¨æ–¹æ³•" class="headerlink" title="2.5.3 Fieldå¯¹è±¡å¸¸ç”¨æ–¹æ³•"></a>2.5.3 Fieldå¯¹è±¡å¸¸ç”¨æ–¹æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span>  <span class="hljs-title">set</span><span class="hljs-params">(Object obj, Object value)</span> </span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setInt</span><span class="hljs-params">(Object obj, <span class="hljs-keyword">int</span> i)</span> </span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setLong</span><span class="hljs-params">(Object obj, <span class="hljs-keyword">long</span> l)</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setBoolean</span><span class="hljs-params">(Object obj, <span class="hljs-keyword">boolean</span> z)</span> </span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setDouble</span><span class="hljs-params">(Object obj, <span class="hljs-keyword">double</span> d)</span> </span><br><span class="hljs-function"></span><br><span class="hljs-function">Object <span class="hljs-title">get</span><span class="hljs-params">(Object obj)</span>  </span><br><span class="hljs-function"><span class="hljs-keyword">int</span><span class="hljs-title">getInt</span><span class="hljs-params">(Object obj)</span> </span><br><span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">getLong</span><span class="hljs-params">(Object obj)</span> </span><br><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">getBoolean</span><span class="hljs-params">(Object ob)</span></span><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">getDouble</span><span class="hljs-params">(Object obj)</span> </span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setAccessible</span><span class="hljs-params">(<span class="hljs-keyword">true</span>)</span></span>;æš´åŠ›åå°„ï¼Œè®¾ç½®ä¸ºå¯ä»¥ç›´æ¥è®¿é—®ç§æœ‰ç±»å‹çš„å±æ€§ã€‚<br><span class="hljs-function">Class <span class="hljs-title">getType</span><span class="hljs-params">()</span></span>; è·å–å±æ€§çš„ç±»å‹ï¼Œè¿”å›Classå¯¹è±¡ã€‚<br></code></pre></td></tr></table></figure><blockquote><p>setXxxæ–¹æ³•éƒ½æ˜¯ç»™å¯¹è±¡objçš„å±æ€§è®¾ç½®ä½¿ç”¨ï¼Œé’ˆå¯¹ä¸åŒçš„ç±»å‹é€‰å–ä¸åŒçš„æ–¹æ³•ã€‚</p><p>getXxxæ–¹æ³•æ˜¯è·å–å¯¹è±¡objå¯¹åº”çš„å±æ€§å€¼çš„ï¼Œé’ˆå¯¹ä¸åŒçš„ç±»å‹é€‰å–ä¸åŒçš„æ–¹æ³•ã€‚</p></blockquote><h3 id="2-5-4-ç¤ºä¾‹ä»£ç "><a href="#2-5-4-ç¤ºä¾‹ä»£ç " class="headerlink" title="2.5.4 ç¤ºä¾‹ä»£ç "></a>2.5.4 ç¤ºä¾‹ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReflectDemo05</span> </span>&#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        Field[] getFields();</span><br><span class="hljs-comment">            * è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼Œåªèƒ½è·å¾—publicçš„</span><br><span class="hljs-comment">        Field[] getDeclaredFields();</span><br><span class="hljs-comment">            * è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼ŒåŒ…å«privateçš„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test02</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c  = Student.class;<br>        <span class="hljs-comment">// è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡</span><br>        <span class="hljs-comment">// Field[] fields = c.getFields();</span><br>        <span class="hljs-comment">// è·å¾—æ‰€æœ‰çš„æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ï¼ŒåŒ…æ‹¬private</span><br>        Field[] fields = c.getDeclaredFields();<br>        <span class="hljs-keyword">for</span> (Field f: fields) &#123;<br>            System.out.println(f);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        Field getField(String name);</span><br><span class="hljs-comment">            æ ¹æ®æˆå‘˜å˜é‡åè·å¾—å¯¹åº”Fieldå¯¹è±¡ï¼Œåªèƒ½è·å¾—publicä¿®é¥°</span><br><span class="hljs-comment">        Field getDeclaredField(String name);</span><br><span class="hljs-comment">            *  æ ¹æ®æˆå‘˜å˜é‡åè·å¾—å¯¹åº”Fieldå¯¹è±¡ï¼ŒåŒ…å«privateä¿®é¥°çš„</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test01</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c  = Student.class;<br>        <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡</span><br>        Object obj = c.newInstance();<br>        <span class="hljs-comment">// è·å¾—æˆå‘˜å˜é‡nameå¯¹åº”çš„Fieldå¯¹è±¡</span><br>        Field f = c.getField(<span class="hljs-string">&quot;name&quot;</span>);<br>        <span class="hljs-comment">// ç»™æˆå‘˜å˜é‡nameèµ‹å€¼</span><br>        <span class="hljs-comment">// ç»™æŒ‡å®šå¯¹è±¡objçš„nameå±æ€§èµ‹å€¼ä¸ºjack</span><br>        f.set(obj,<span class="hljs-string">&quot;jack&quot;</span>);<br><br>        <span class="hljs-comment">// è·å¾—æŒ‡å®šå¯¹è±¡objæˆå‘˜å˜é‡nameçš„å€¼</span><br>        System.out.println(f.get(obj)); <span class="hljs-comment">// jack</span><br>        <span class="hljs-comment">// è·å¾—æˆå‘˜å˜é‡çš„åå­—</span><br>        System.out.println(f.getName()); <span class="hljs-comment">// name</span><br><br><br>        <span class="hljs-comment">// ç»™æˆå‘˜å˜é‡genderèµ‹å€¼</span><br>        <span class="hljs-comment">// è·å¾—æˆå‘˜å˜é‡genderå¯¹åº”çš„Fieldå¯¹è±¡</span><br>        Field f1 = c.getDeclaredField(<span class="hljs-string">&quot;gender&quot;</span>);<br>        <span class="hljs-comment">// æš´åŠ›åå°„</span><br>        f1.setAccessible(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-comment">// ç»™æŒ‡å®šå¯¹è±¡objçš„genderå±æ€§èµ‹å€¼ä¸ºç”·</span><br>        f1.set(obj,<span class="hljs-string">&quot;ç”·&quot;</span>);<br><br>        System.out.println(obj);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç¬¬ä¸‰ç« -æ³¨è§£"><a href="#ç¬¬ä¸‰ç« -æ³¨è§£" class="headerlink" title="ç¬¬ä¸‰ç«  æ³¨è§£"></a>ç¬¬ä¸‰ç«  æ³¨è§£</h1><h2 id="3-1-æ³¨è§£çš„æ¦‚è¿°"><a href="#3-1-æ³¨è§£çš„æ¦‚è¿°" class="headerlink" title="3.1 æ³¨è§£çš„æ¦‚è¿°"></a>3.1 æ³¨è§£çš„æ¦‚è¿°</h2><h3 id="3-1-1-æ³¨è§£çš„æ¦‚å¿µ"><a href="#3-1-1-æ³¨è§£çš„æ¦‚å¿µ" class="headerlink" title="3.1.1 æ³¨è§£çš„æ¦‚å¿µ"></a>3.1.1 æ³¨è§£çš„æ¦‚å¿µ</h3><ul><li><p>æ³¨è§£æ˜¯JDK1.5çš„æ–°ç‰¹æ€§ã€‚</p></li><li><p>æ³¨è§£ç›¸å½“ä¸€ç§æ ‡è®°ï¼Œæ˜¯ç±»çš„ç»„æˆéƒ¨åˆ†ï¼Œå¯ä»¥ç»™ç±»æºå¸¦ä¸€äº›é¢å¤–çš„ä¿¡æ¯ã€‚</p></li><li><p>æ ‡è®°(æ³¨è§£)å¯ä»¥åŠ åœ¨åŒ…ï¼Œç±»ï¼Œå­—æ®µï¼Œæ–¹æ³•ï¼Œæ–¹æ³•å‚æ•°ä»¥åŠå±€éƒ¨å˜é‡ä¸Šã€‚</p></li><li><p>æ³¨è§£æ˜¯ç»™ç¼–è¯‘å™¨æˆ–JVMçœ‹çš„ï¼Œç¼–è¯‘å™¨æˆ–JVMå¯ä»¥æ ¹æ®æ³¨è§£æ¥å®Œæˆå¯¹åº”çš„åŠŸèƒ½ã€‚</p><h6 id="æ³¨è§£-Annotation-ç›¸å½“äºä¸€ç§æ ‡è®°ï¼Œåœ¨ç¨‹åºä¸­åŠ å…¥æ³¨è§£å°±ç­‰äºä¸ºç¨‹åºæ‰“ä¸ŠæŸç§æ ‡è®°ï¼Œä»¥åï¼Œjavacç¼–è¯‘å™¨ã€å¼€å‘å·¥å…·å’Œå…¶ä»–ç¨‹åºå¯ä»¥é€šè¿‡åå°„æ¥äº†è§£ä½ çš„ç±»åŠå„ç§å…ƒç´ ä¸Šæœ‰æ— ä½•ç§-æ ‡è®°ï¼Œçœ‹ä½ çš„ç¨‹åºæœ‰ä»€ä¹ˆæ ‡è®°ï¼Œå°±å»å¹²ç›¸åº”çš„äº‹ï¼Œæ ‡è®°å¯ä»¥åŠ åœ¨åŒ…ã€ç±»ï¼Œå±æ€§ã€æ–¹æ³•ï¼Œæ–¹æ³•çš„å‚æ•°ä»¥åŠå±€éƒ¨å˜é‡ä¸Šã€‚"><a href="#æ³¨è§£-Annotation-ç›¸å½“äºä¸€ç§æ ‡è®°ï¼Œåœ¨ç¨‹åºä¸­åŠ å…¥æ³¨è§£å°±ç­‰äºä¸ºç¨‹åºæ‰“ä¸ŠæŸç§æ ‡è®°ï¼Œä»¥åï¼Œjavacç¼–è¯‘å™¨ã€å¼€å‘å·¥å…·å’Œå…¶ä»–ç¨‹åºå¯ä»¥é€šè¿‡åå°„æ¥äº†è§£ä½ çš„ç±»åŠå„ç§å…ƒç´ ä¸Šæœ‰æ— ä½•ç§-æ ‡è®°ï¼Œçœ‹ä½ çš„ç¨‹åºæœ‰ä»€ä¹ˆæ ‡è®°ï¼Œå°±å»å¹²ç›¸åº”çš„äº‹ï¼Œæ ‡è®°å¯ä»¥åŠ åœ¨åŒ…ã€ç±»ï¼Œå±æ€§ã€æ–¹æ³•ï¼Œæ–¹æ³•çš„å‚æ•°ä»¥åŠå±€éƒ¨å˜é‡ä¸Šã€‚" class="headerlink" title="æ³¨è§£(Annotation)ç›¸å½“äºä¸€ç§æ ‡è®°ï¼Œåœ¨ç¨‹åºä¸­åŠ å…¥æ³¨è§£å°±ç­‰äºä¸ºç¨‹åºæ‰“ä¸ŠæŸç§æ ‡è®°ï¼Œä»¥åï¼Œjavacç¼–è¯‘å™¨ã€å¼€å‘å·¥å…·å’Œå…¶ä»–ç¨‹åºå¯ä»¥é€šè¿‡åå°„æ¥äº†è§£ä½ çš„ç±»åŠå„ç§å…ƒç´ ä¸Šæœ‰æ— ä½•ç§    æ ‡è®°ï¼Œçœ‹ä½ çš„ç¨‹åºæœ‰ä»€ä¹ˆæ ‡è®°ï¼Œå°±å»å¹²ç›¸åº”çš„äº‹ï¼Œæ ‡è®°å¯ä»¥åŠ åœ¨åŒ…ã€ç±»ï¼Œå±æ€§ã€æ–¹æ³•ï¼Œæ–¹æ³•çš„å‚æ•°ä»¥åŠå±€éƒ¨å˜é‡ä¸Šã€‚"></a><em>æ³¨è§£(Annotation)ç›¸å½“äºä¸€ç§æ ‡è®°ï¼Œåœ¨ç¨‹åºä¸­åŠ å…¥æ³¨è§£å°±ç­‰äºä¸ºç¨‹åºæ‰“ä¸ŠæŸç§æ ‡è®°ï¼Œä»¥åï¼Œjavacç¼–è¯‘å™¨ã€å¼€å‘å·¥å…·å’Œå…¶ä»–ç¨‹åºå¯ä»¥é€šè¿‡åå°„æ¥äº†è§£ä½ çš„ç±»åŠå„ç§å…ƒç´ ä¸Šæœ‰æ— ä½•ç§    æ ‡è®°ï¼Œçœ‹ä½ çš„ç¨‹åºæœ‰ä»€ä¹ˆæ ‡è®°ï¼Œå°±å»å¹²ç›¸åº”çš„äº‹ï¼Œæ ‡è®°å¯ä»¥åŠ åœ¨åŒ…ã€ç±»ï¼Œå±æ€§ã€æ–¹æ³•ï¼Œæ–¹æ³•çš„å‚æ•°ä»¥åŠå±€éƒ¨å˜é‡ä¸Šã€‚</em></h6></li></ul><h3 id="3-1-2-æ³¨è§£çš„ä½œç”¨"><a href="#3-1-2-æ³¨è§£çš„ä½œç”¨" class="headerlink" title="3.1.2 æ³¨è§£çš„ä½œç”¨"></a>3.1.2 æ³¨è§£çš„ä½œç”¨</h3><p> <strong>æ³¨è§£çš„ä½œç”¨å°±æ˜¯ç»™ç¨‹åºå¸¦å…¥å‚æ•°ã€‚</strong></p><p>ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨æ“ä½œä¸­éƒ½ä½¿ç”¨åˆ°äº†æ³¨è§£ï¼š</p><ol><li><p><strong>ç”Ÿæˆå¸®åŠ©æ–‡æ¡£</strong>ï¼š**@authorå’Œ@version**</p><ul><li><p><strong>@author</strong>ï¼šç”¨æ¥æ ‡è¯†ä½œè€…å§“åã€‚</p></li><li><p><strong>@version</strong>ï¼šç”¨äºæ ‡è¯†å¯¹è±¡çš„ç‰ˆæœ¬å·ï¼Œé€‚ç”¨èŒƒå›´ï¼šæ–‡ä»¶ã€ç±»ã€æ–¹æ³•ã€‚</p><ul><li><p>ä½¿ç”¨**@authorå’Œ@version<strong>æ³¨è§£å°±æ˜¯å‘Šè¯‰</strong>Javadocå·¥å…·**åœ¨ç”Ÿæˆå¸®åŠ©æ–‡æ¡£æ—¶æŠŠä½œè€…å§“åå’Œç‰ˆæœ¬å·ä¹Ÿæ ‡è®°åœ¨æ–‡æ¡£ä¸­ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E6%B3%A8%E8%A7%A3_1_20210403.png"></p></li></ul></li></ul></li><li><p><strong>ç¼–è¯‘æ£€æŸ¥</strong>ï¼š**@Override**</p><ul><li><p><strong>@Override</strong>ï¼šç”¨æ¥ä¿®é¥°æ–¹æ³•å£°æ˜ã€‚</p><ul><li>ç”¨æ¥å‘Šè¯‰<strong>ç¼–è¯‘å™¨</strong>è¯¥æ–¹æ³•æ˜¯é‡å†™çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœçˆ¶ç±»ä¸å­˜åœ¨è¯¥æ–¹æ³•ï¼Œåˆ™ç¼–è¯‘å¤±è´¥ã€‚å¦‚ä¸‹å›¾</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E6%B3%A8%E8%A7%A3_2_20210403.png"></p></li></ul></li><li><p><strong>æ¡†æ¶çš„é…ç½®(æ¡†æ¶=ä»£ç +é…ç½®)</strong></p><ul><li>å…·ä½“ä½¿ç”¨è¯·å…³æ³¨æ¡†æ¶è¯¾ç¨‹çš„å†…å®¹çš„å­¦ä¹ ã€‚</li></ul></li></ol><h3 id="3-1-3-å¸¸è§æ³¨è§£"><a href="#3-1-3-å¸¸è§æ³¨è§£" class="headerlink" title="3.1.3 å¸¸è§æ³¨è§£"></a>3.1.3 å¸¸è§æ³¨è§£</h3><ol><li><strong>@author</strong>ï¼šç”¨æ¥æ ‡è¯†ä½œè€…åï¼Œeclipseå¼€å‘å·¥å…·é»˜è®¤çš„æ˜¯ç³»ç»Ÿç”¨æˆ·åã€‚</li><li><strong>@version</strong>ï¼šç”¨äºæ ‡è¯†å¯¹è±¡çš„ç‰ˆæœ¬å·ï¼Œé€‚ç”¨èŒƒå›´ï¼šæ–‡ä»¶ã€ç±»ã€æ–¹æ³•ã€‚</li><li><strong>@Override</strong> ï¼šç”¨æ¥ä¿®é¥°æ–¹æ³•å£°æ˜ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨è¯¥æ–¹æ³•æ˜¯é‡å†™çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼Œå¦‚æœçˆ¶ç±»ä¸å­˜åœ¨è¯¥æ–¹æ³•ï¼Œåˆ™ç¼–è¯‘å¤±è´¥ã€‚</li></ol><h2 id="3-2-è‡ªå®šä¹‰æ³¨è§£"><a href="#3-2-è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="3.2 è‡ªå®šä¹‰æ³¨è§£"></a>3.2 è‡ªå®šä¹‰æ³¨è§£</h2><h3 id="3-2-1-å®šä¹‰æ ¼å¼"><a href="#3-2-1-å®šä¹‰æ ¼å¼" class="headerlink" title="3.2.1 å®šä¹‰æ ¼å¼"></a>3.2.1 å®šä¹‰æ ¼å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> æ³¨è§£å&#123;<br><br>&#125;<br>å¦‚ï¼šå®šä¹‰ä¸€ä¸ªåä¸ºStudentçš„æ³¨è§£<br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Student &#123;<br><br>&#125; <br></code></pre></td></tr></table></figure><h3 id="3-2-2-æ³¨è§£çš„å±æ€§"><a href="#3-2-2-æ³¨è§£çš„å±æ€§" class="headerlink" title="3.2.2 æ³¨è§£çš„å±æ€§"></a>3.2.2 æ³¨è§£çš„å±æ€§</h3><ol><li><p><strong>å±æ€§çš„æ ¼å¼</strong></p><ul><li><strong>æ ¼å¼1ï¼šæ•°æ®ç±»å‹ å±æ€§å();</strong></li><li><strong>æ ¼å¼2ï¼šæ•°æ®ç±»å‹ å±æ€§å() default é»˜è®¤å€¼;</strong></li></ul></li><li><p><strong>å±æ€§å®šä¹‰ç¤ºä¾‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å§“å</span><br><span class="hljs-function">String <span class="hljs-title">name</span><span class="hljs-params">()</span></span>;<br><span class="hljs-comment">// å¹´é¾„</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">age</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> 18</span>;<br><span class="hljs-comment">// çˆ±å¥½</span><br>String[] hobby();<br></code></pre></td></tr></table></figure></li><li><p><strong>å±æ€§é€‚ç”¨çš„æ•°æ®ç±»å‹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">* å…«ç§æ•°æ®æ•°æ®ç±»å‹(<span class="hljs-keyword">int</span>ï¼Œ<span class="hljs-keyword">short</span>ï¼Œ<span class="hljs-keyword">long</span>ï¼Œ<span class="hljs-keyword">double</span>ï¼Œ<span class="hljs-keyword">byte</span>ï¼Œ<span class="hljs-keyword">char</span>ï¼Œ<span class="hljs-keyword">boolean</span>ï¼Œ<span class="hljs-keyword">float</span>)<br>* Stringï¼ŒClassï¼Œæ³¨è§£ç±»å‹ï¼Œæšä¸¾ç±»<br>* ä»¥ä¸Šç±»å‹çš„æ•°ç»„å½¢å¼<br></code></pre></td></tr></table></figure></li></ol><h2 id="3-3-ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£"><a href="#3-3-ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£" class="headerlink" title="3.3 ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£"></a>3.3 ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£</h2><h3 id="3-3-1-å®šä¹‰å’Œæ³¨è§£"><a href="#3-3-1-å®šä¹‰å’Œæ³¨è§£" class="headerlink" title="3.3.1 å®šä¹‰å’Œæ³¨è§£"></a>3.3.1 å®šä¹‰å’Œæ³¨è§£</h3><ol><li><strong>å®šä¹‰ä¸€ä¸ªæ³¨è§£ï¼šBook</strong><ul><li>åŒ…å«å±æ€§ï¼šString value()   ä¹¦å</li><li>åŒ…å«å±æ€§ï¼šdouble price()  ä»·æ ¼ï¼Œé»˜è®¤å€¼ä¸º 100</li><li>åŒ…å«å±æ€§ï¼šString[] authors() å¤šä½ä½œè€…    </li></ul></li><li>ä»£ç å®ç°</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.METHOD,ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Book &#123;<br>    <span class="hljs-function">String <span class="hljs-title">value</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">price</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> 100</span>;<br>    String[] authros();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-3-2-ä½¿ç”¨æ³¨è§£"><a href="#3-3-2-ä½¿ç”¨æ³¨è§£" class="headerlink" title="3.3.2 ä½¿ç”¨æ³¨è§£"></a>3.3.2 ä½¿ç”¨æ³¨è§£</h3><ol><li><strong>å®šä¹‰ç±»åœ¨æˆå‘˜æ–¹æ³•ä¸Šä½¿ç”¨Bookæ³¨è§£</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><br></code></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨æ³¨æ„äº‹é¡¹<ul><li>å¦‚æœå±æ€§æœ‰é»˜è®¤å€¼ï¼Œåˆ™ä½¿ç”¨æ³¨è§£çš„æ—¶å€™ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥ä¸ç”¨èµ‹å€¼ã€‚</li><li>å¦‚æœå±æ€§æ²¡æœ‰é»˜è®¤å€¼ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ³¨è§£æ—¶ä¸€å®šè¦ç»™å±æ€§èµ‹å€¼ã€‚ </li></ul></li></ol><h3 id="3-3-3-ç‰¹æ®Šå±æ€§value"><a href="#3-3-3-ç‰¹æ®Šå±æ€§value" class="headerlink" title="3.3.3 ç‰¹æ®Šå±æ€§value"></a>3.3.3 ç‰¹æ®Šå±æ€§value</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    ç‰¹æ®Šå±æ€§value</span><br><span class="hljs-comment">        * å¦‚æœæ³¨è§£ä¸­åªæœ‰ä¸€ä¸ªå±æ€§ä¸”åå­—å«valueï¼Œåˆ™åœ¨ä½¿ç”¨è¯¥æ³¨è§£æ—¶å¯ä»¥ç›´æ¥ç»™è¯¥å±æ€§èµ‹å€¼ï¼Œè€Œä¸éœ€è¦ç»™å‡ºå±æ€§åã€‚</span><br><span class="hljs-comment">        * å¦‚æœæ³¨è§£ä¸­é™¤äº†valueå±æ€§ä¹‹å¤–è¿˜æœ‰å…¶ä»–å±æ€§ä¸”åªè¦æœ‰ä¸€ä¸ªå±æ€§æ²¡æœ‰é»˜è®¤å€¼ï¼Œåˆ™åœ¨ç»™å±æ€§èµ‹å€¼æ—¶</span><br><span class="hljs-comment">            valueå±æ€§åä¹Ÿä¸èƒ½çœç•¥äº†ã€‚</span><br><span class="hljs-comment">    å°ç»“ï¼šå¦‚æœæ³¨è§£ä¸­åªæœ‰ä¸€ä¸ªå±æ€§æ—¶ï¼Œä¸€èˆ¬éƒ½ä¼šå°†è¯¥å±æ€§åå‘½åä¸ºvalue</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@interface</span> TestA&#123;<br>   String[] value();<br>   <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">age</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> 100</span>;<br>   <span class="hljs-function">String <span class="hljs-title">name</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-meta">@interface</span> TestB&#123;<br>    <span class="hljs-function">String <span class="hljs-title">name</span><span class="hljs-params">()</span></span>;<br>&#125;<br><br><span class="hljs-meta">@TestB(name = &quot;zzz&quot;)</span><br><span class="hljs-meta">@TestA(name = &quot;yyy&quot;,value = &#123;&quot;xxx&quot;,&quot;xxx&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnnotationDemo02</span> </span>&#123;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-4-æ³¨è§£ä¹‹å…ƒæ³¨è§£"><a href="#3-4-æ³¨è§£ä¹‹å…ƒæ³¨è§£" class="headerlink" title="3.4 æ³¨è§£ä¹‹å…ƒæ³¨è§£"></a>3.4 æ³¨è§£ä¹‹å…ƒæ³¨è§£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java">å…ƒæ³¨è§£æ¦‚è¿°<br>    * Javaå®˜æ–¹æä¾›çš„æ³¨è§£<br>    * ç”¨æ¥å®šä¹‰æ³¨è§£çš„æ³¨è§£<br>    * ä»»ä½•å®˜æ–¹æä¾›çš„éå…ƒæ³¨è§£çš„å®šä¹‰éƒ½ä½¿ç”¨åˆ°äº†å…ƒæ³¨è§£ã€‚<br><br>å¸¸ç”¨çš„å…ƒæ³¨è§£<br>    * <span class="hljs-meta">@Target</span><br>        * ä½œç”¨ï¼šç”¨æ¥æ ‡è¯†æ³¨è§£ä½¿ç”¨çš„ä½ç½®ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨è¯¥æ³¨è§£æ ‡è¯†ï¼Œåˆ™è‡ªå®šä¹‰çš„æ³¨è§£å¯ä»¥ä½¿ç”¨åœ¨ä»»æ„ä½ç½®ã€‚<br>        * å¯ä½¿ç”¨çš„å€¼å®šä¹‰åœ¨ElementTypeæšä¸¾ç±»ä¸­ï¼Œå¸¸ç”¨å€¼å¦‚ä¸‹<br>            TYPEï¼Œç±»ï¼Œæ¥å£<br>            FIELD, æˆå‘˜å˜é‡<br>            METHOD, æˆå‘˜æ–¹æ³•<br>            PARAMETER, æ–¹æ³•å‚æ•°<br>            CONSTRUCTOR, æ„é€ æ–¹æ³•<br>            LOCAL_VARIABLE, å±€éƒ¨å˜é‡<br><br>    * <span class="hljs-meta">@Retention</span><br>        * ä½œç”¨ï¼šç”¨æ¥æ ‡è¯†æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸ(æœ‰æ•ˆèŒƒå›´)<br>        * å¯ä½¿ç”¨çš„å€¼å®šä¹‰åœ¨RetentionPolicyæšä¸¾ç±»ä¸­ï¼Œå¸¸ç”¨å€¼å¦‚ä¸‹<br>            * SOURCEï¼šæ³¨è§£åªä½œç”¨åœ¨æºç é˜¶æ®µï¼Œç”Ÿæˆçš„å­—èŠ‚ç æ–‡ä»¶ä¸­ä¸å­˜åœ¨<br>            * CLASSï¼šæ³¨è§£ä½œç”¨åœ¨æºç é˜¶æ®µï¼Œå­—èŠ‚ç æ–‡ä»¶é˜¶æ®µï¼Œè¿è¡Œé˜¶æ®µä¸å­˜åœ¨ï¼Œé»˜è®¤å€¼<br>            * RUNTIMEï¼šæ³¨è§£ä½œç”¨åœ¨æºç é˜¶æ®µï¼Œå­—èŠ‚ç æ–‡ä»¶é˜¶æ®µï¼Œè¿è¡Œé˜¶æ®µ<br></code></pre></td></tr></table></figure><h2 id="3-5-æ³¨è§£è§£æ"><a href="#3-5-æ³¨è§£è§£æ" class="headerlink" title="3.5 æ³¨è§£è§£æ"></a>3.5 æ³¨è§£è§£æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">ä»€ä¹ˆæ˜¯æ³¨è§£è§£æ<br>      * ä½¿ç”¨JavaæŠ€æœ¯è·å¾—æ³¨è§£ä¸Šæ•°æ®çš„è¿‡ç¨‹åˆ™ç§°ä¸ºæ³¨è§£è§£æã€‚<br>  ä¸æ³¨è§£è§£æç›¸å…³çš„æ¥å£<br>      * Annotation: æ³¨è§£ç±»ï¼Œè¯¥ç±»æ˜¯æ‰€æœ‰æ³¨è§£çš„çˆ¶ç±»ã€‚<br>      * AnnotatedElement:è¯¥æ¥å£å®šä¹‰äº†ä¸æ³¨è§£è§£æç›¸å…³çš„æ–¹æ³•<br>           <span class="hljs-function">T <span class="hljs-title">getAnnotation</span><span class="hljs-params">(Class&lt;T&gt; annotationClass)</span> æ ¹æ®æ³¨è§£ç±»å‹è·å¾—å¯¹åº”æ³¨è§£å¯¹è±¡</span><br><span class="hljs-function">           Annotation[]<span class="hljs-title">getAnnotations</span><span class="hljs-params">()</span></span><br><span class="hljs-function">              * è·å¾—å½“å‰å¯¹è±¡ä¸Šä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£ï¼Œè¿”å›æ³¨è§£æ•°ç»„ï¼ŒåŒ…å«çˆ¶ç±»ç»§æ‰¿çš„</span><br><span class="hljs-function">           Annotation[]<span class="hljs-title">getDeclaredAnnotations</span><span class="hljs-params">()</span></span><br><span class="hljs-function">              * è·å¾—å½“å‰å¯¹è±¡ä¸Šä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£ï¼Œè¿”å›æ³¨è§£æ•°ç»„,åªåŒ…å«æœ¬ç±»çš„</span><br><span class="hljs-function">           <span class="hljs-keyword">boolean</span><span class="hljs-title">isAnnotationPresent</span><span class="hljs-params">(Class&lt;Annotation&gt; annotationClass)</span></span><br><span class="hljs-function">              * åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦ä½¿ç”¨äº†æŒ‡å®šçš„æ³¨è§£ï¼Œå¦‚æœä½¿ç”¨äº†åˆ™è¿”å›<span class="hljs-keyword">true</span>ï¼Œå¦åˆ™<span class="hljs-keyword">false</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">      è·å–æ³¨è§£æ•°æ®çš„åŸç†</span><br><span class="hljs-function">          * æ³¨è§£ä½œç”¨åœ¨å“ªä¸ªæˆå‘˜ä¸Šå°±ä¼šå¾—è¯¥æˆå‘˜å¯¹åº”çš„å¯¹è±¡æ¥è·å¾—æ³¨è§£</span><br><span class="hljs-function">              * æ¯”å¦‚æ³¨è§£ä½œç”¨æˆå‘˜æ–¹æ³•ï¼Œåˆ™è¦è·å¾—è¯¥æˆå‘˜æ–¹æ³•å¯¹åº”çš„Methodå¯¹è±¡</span><br><span class="hljs-function">              * æ¯”å¦‚æ³¨è§£ä½œç”¨åœ¨ç±»ä¸Šï¼Œåˆ™è¦è¯¥ç±»çš„Classå¯¹è±¡</span><br><span class="hljs-function">              * æ¯”å¦‚æ³¨è§£ä½œç”¨åœ¨æˆå‘˜å˜é‡ä¸Šï¼Œåˆ™è¦è·å¾—è¯¥æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ã€‚</span><br><span class="hljs-function">          * Field,Method,Constructorï¼ŒClassç­‰ç±»éƒ½æ˜¯å®ç°äº†AnnotatedElementæ¥å£</span><br></code></pre></td></tr></table></figure><h4 id="3-5-4-1-éœ€æ±‚è¯´æ˜"><a href="#3-5-4-1-éœ€æ±‚è¯´æ˜" class="headerlink" title="3.5.4.1 éœ€æ±‚è¯´æ˜"></a>3.5.4.1 éœ€æ±‚è¯´æ˜</h4><ol><li>å®šä¹‰æ³¨è§£Bookï¼Œè¦æ±‚å¦‚ä¸‹ï¼š<ul><li>åŒ…å«å±æ€§ï¼šString value()   ä¹¦å</li><li>åŒ…å«å±æ€§ï¼šdouble price()  ä»·æ ¼ï¼Œé»˜è®¤å€¼ä¸º 100</li><li>åŒ…å«å±æ€§ï¼šString[] authors() å¤šä½ä½œè€…  </li><li>é™åˆ¶æ³¨è§£ä½¿ç”¨çš„ä½ç½®ï¼šç±»å’Œæˆå‘˜æ–¹æ³•ä¸Š</li><li>æŒ‡å®šæ³¨è§£çš„æœ‰æ•ˆèŒƒå›´ï¼šRUNTIME</li></ul></li><li>å®šä¹‰BookStoreç±»ï¼Œåœ¨ç±»å’Œæˆå‘˜æ–¹æ³•ä¸Šä½¿ç”¨Bookæ³¨è§£</li><li>å®šä¹‰TestAnnotationæµ‹è¯•ç±»è·å–Bookæ³¨è§£ä¸Šçš„æ•°æ®</li></ol><h4 id="3-5-4-2-ä»£ç å®ç°"><a href="#3-5-4-2-ä»£ç å®ç°" class="headerlink" title="3.5.4.2 ä»£ç å®ç°"></a>3.5.4.2 ä»£ç å®ç°</h4><ol><li><strong>æ³¨è§£Book</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Target(&#123;ElementType.METHOD,ElementType.TYPE&#125;)</span><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Book &#123;<br>    <span class="hljs-function">String <span class="hljs-title">value</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">price</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> 100</span>;<br>    String[] authros();<br>&#125;<br></code></pre></td></tr></table></figure><ol><li>BookShelfç±»</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Book(value = &quot;çº¢æ¥¼æ¢¦&quot;,authros = &#123;&quot;æ›¹é›ªèŠ¹&quot;&#125;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookShelf</span>  </span>&#123;<br><br>    <span class="hljs-meta">@Book(value = &quot;è¥¿æ¸¸è®°&quot;,authros = &#123;&quot;å´æ‰¿æ©&quot;,&quot;ç™½æ±‚æ©&quot;&#125;,price = 200)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showBook</span><span class="hljs-params">()</span></span>&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol><li><strong>TestAnnotationç±»</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">    ä»€ä¹ˆæ˜¯æ³¨è§£è§£æ</span><br><span class="hljs-comment">        * ä½¿ç”¨JavaæŠ€æœ¯è·å¾—æ³¨è§£ä¸Šæ•°æ®çš„è¿‡ç¨‹åˆ™ç§°ä¸ºæ³¨è§£è§£æã€‚</span><br><span class="hljs-comment">    ä¸æ³¨è§£è§£æç›¸å…³çš„æ¥å£</span><br><span class="hljs-comment">        * Annotation: æ³¨è§£ç±»ï¼Œè¯¥ç±»æ˜¯æ‰€æœ‰æ³¨è§£çš„çˆ¶ç±»ã€‚</span><br><span class="hljs-comment">        * AnnotatedElement:è¯¥æ¥å£å®šä¹‰äº†ä¸æ³¨è§£è§£æç›¸å…³çš„æ–¹æ³•</span><br><span class="hljs-comment">             T getAnnotation(Class&lt;T&gt; annotationClass) æ ¹æ®æ³¨è§£ç±»å‹è·å¾—å¯¹åº”æ³¨è§£å¯¹è±¡</span><br><span class="hljs-comment">             Annotation[]getAnnotations()</span><br><span class="hljs-comment">                * è·å¾—å½“å‰å¯¹è±¡ä¸Šä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£ï¼Œè¿”å›æ³¨è§£æ•°ç»„ï¼ŒåŒ…å«çˆ¶ç±»ç»§æ‰¿çš„</span><br><span class="hljs-comment">             Annotation[]getDeclaredAnnotations()</span><br><span class="hljs-comment">                * è·å¾—å½“å‰å¯¹è±¡ä¸Šä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£ï¼Œè¿”å›æ³¨è§£æ•°ç»„,åªåŒ…å«æœ¬ç±»çš„</span><br><span class="hljs-comment">             booleanisAnnotationPresent(Class&lt;Annotation&gt; annotationClass)</span><br><span class="hljs-comment">                * åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦ä½¿ç”¨äº†æŒ‡å®šçš„æ³¨è§£ï¼Œå¦‚æœä½¿ç”¨äº†åˆ™è¿”å›trueï¼Œå¦åˆ™false</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">        è·å–æ³¨è§£æ•°æ®çš„åŸç†</span><br><span class="hljs-comment">            * æ³¨è§£ä½œç”¨åœ¨å“ªä¸ªæˆå‘˜ä¸Šå°±ä¼šå¾—è¯¥æˆå‘˜å¯¹åº”çš„å¯¹è±¡æ¥è·å¾—æ³¨è§£</span><br><span class="hljs-comment">                * æ¯”å¦‚æ³¨è§£ä½œç”¨æˆå‘˜æ–¹æ³•ï¼Œåˆ™è¦è·å¾—è¯¥æˆå‘˜æ–¹æ³•å¯¹åº”çš„Methodå¯¹è±¡</span><br><span class="hljs-comment">                * æ¯”å¦‚æ³¨è§£ä½œç”¨åœ¨ç±»ä¸Šï¼Œåˆ™è¦è¯¥ç±»çš„Classå¯¹è±¡</span><br><span class="hljs-comment">                * æ¯”å¦‚æ³¨è§£ä½œç”¨åœ¨æˆå‘˜å˜é‡ä¸Šï¼Œåˆ™è¦è·å¾—è¯¥æˆå‘˜å˜é‡å¯¹åº”çš„Fieldå¯¹è±¡ã€‚</span><br><span class="hljs-comment">            * Field,Method,Constructorï¼ŒClassç­‰ç±»éƒ½æ˜¯å®ç°äº†AnnotatedElementæ¥å£</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnnotationDemo04</span> </span>&#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        è·å¾—ç±»ä¸Šä½¿ç”¨çš„æ³¨è§£æ•°æ®</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test02</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = BookShelf.class;<br>        <span class="hljs-comment">// åˆ¤æ–­ç±»ä¸Šæ˜¯å¦ä½¿ç”¨Bookæ³¨è§£</span><br>        <span class="hljs-keyword">if</span>(c.isAnnotationPresent(Book.class))&#123;<br>            <span class="hljs-comment">// æ ¹æ®æ³¨è§£çš„Classå¯¹è±¡è·å¾—å¯¹åº”çš„æ³¨è§£å¯¹è±¡</span><br>            Book annotation = (Book) c.getAnnotation(Book.class);<br>            <span class="hljs-comment">// è·å¾—ä¹¦å</span><br>            System.out.println(annotation.value());<br>            <span class="hljs-comment">// è·å¾—ä½œè€…</span><br>            System.out.println(Arrays.toString(annotation.authros()));<br>            <span class="hljs-comment">// è·å¾—ä»·æ ¼</span><br>            System.out.println(annotation.price());<br>        &#125;<br>        <span class="hljs-comment">// è·å¾—å½“å‰å¯¹è±¡ä¸Šä½¿ç”¨çš„æ‰€æœ‰æ³¨è§£ï¼Œè¿”å›æ³¨è§£æ•°ç»„</span><br>        <span class="hljs-comment">// Annotation[] annotations = c.getAnnotations();</span><br>        Annotation[] annotations = c.getDeclaredAnnotations();<br>        System.out.println(Arrays.toString(annotations));<br>    &#125;<br><br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">       è·å¾—æˆå‘˜æ–¹æ³•ä¸Šæ³¨è§£çš„æ•°æ®</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test01</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = BookShelf.class;<br>        <span class="hljs-comment">// è·å¾—æˆå‘˜æ–¹æ³•å¯¹åº”çš„Methodå¯¹è±¡</span><br>        Method m = c.getMethod(<span class="hljs-string">&quot;showBook&quot;</span>);<br>        <span class="hljs-comment">// æ ¹æ®æ³¨è§£çš„Classå¯¹è±¡è·å¾—å¯¹åº”çš„æ³¨è§£å¯¹è±¡</span><br>        Book annotation = m.getAnnotation(Book.class);<br>        <span class="hljs-comment">// è·å¾—ä¹¦å</span><br>        System.out.println(annotation.value());<br>        <span class="hljs-comment">// è·å¾—ä½œè€…</span><br>        System.out.println(Arrays.toString(annotation.authros()));<br>        <span class="hljs-comment">// è·å¾—ä»·æ ¼</span><br>        System.out.println(annotation.price());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-6-æ³¨è§£æ¡ˆä¾‹"><a href="#3-6-æ³¨è§£æ¡ˆä¾‹" class="headerlink" title="3.6 æ³¨è§£æ¡ˆä¾‹"></a>3.6 æ³¨è§£æ¡ˆä¾‹</h2><h3 id="3-6-1-æ¡ˆä¾‹è¯´æ˜"><a href="#3-6-1-æ¡ˆä¾‹è¯´æ˜" class="headerlink" title="3.6.1 æ¡ˆä¾‹è¯´æ˜"></a>3.6.1 æ¡ˆä¾‹è¯´æ˜</h3><ul><li>æ¨¡æ‹ŸJunitæµ‹è¯•çš„@Test</li></ul><h3 id="3-6-2-æ¡ˆä¾‹åˆ†æ"><a href="#3-6-2-æ¡ˆä¾‹åˆ†æ" class="headerlink" title="3.6.2 æ¡ˆä¾‹åˆ†æ"></a>3.6.2 æ¡ˆä¾‹åˆ†æ</h3><ol><li>æ¨¡æ‹ŸJunitæµ‹è¯•çš„æ³¨é‡Š@Testï¼Œé¦–å…ˆéœ€è¦ç¼–å†™è‡ªå®šä¹‰æ³¨è§£@MyTestï¼Œå¹¶æ·»åŠ å…ƒæ³¨è§£ï¼Œä¿è¯è‡ªå®šä¹‰æ³¨è§£åªèƒ½ä¿®é¥°æ–¹æ³•ï¼Œä¸”åœ¨è¿è¡Œæ—¶å¯ä»¥è·å¾—ã€‚</li><li>ç„¶åç¼–å†™ç›®æ ‡ç±»ï¼ˆæµ‹è¯•ç±»ï¼‰ï¼Œç„¶åç»™ç›®æ ‡æ–¹æ³•ï¼ˆæµ‹è¯•æ–¹æ³•ï¼‰ä½¿ç”¨ @MyTestæ³¨è§£ï¼Œç¼–å†™ä¸‰ä¸ªæ–¹æ³•ï¼Œå…¶ä¸­ä¸¤ä¸ªåŠ ä¸Š@MyTestæ³¨è§£ã€‚</li><li>æœ€åç¼–å†™è°ƒç”¨ç±»ï¼Œä½¿ç”¨mainæ–¹æ³•è°ƒç”¨ç›®æ ‡ç±»ï¼Œæ¨¡æ‹ŸJunitçš„è¿è¡Œï¼Œåªè¦æœ‰@MyTestæ³¨é‡Šçš„æ–¹æ³•éƒ½ä¼šè¿è¡Œã€‚</li></ol><h3 id="3-6-3-æ¡ˆä¾‹ä»£ç "><a href="#3-6-3-æ¡ˆä¾‹ä»£ç " class="headerlink" title="3.6.3 æ¡ˆä¾‹ä»£ç "></a>3.6.3 æ¡ˆä¾‹ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;<br><span class="hljs-keyword">import</span> java.lang.annotation.Retention;<br><span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;<br><span class="hljs-keyword">import</span> java.lang.annotation.Target;<br><br><span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="hljs-meta">@Target(ElementType.METHOD)</span><br><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> MyTest &#123;<br><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestMyTest</span> </span>&#123;<br><br>    <span class="hljs-meta">@MyTest</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tests01</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;test01&quot;</span>);<br>    &#125;<br><br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tests02</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;test02&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@MyTest</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">tests03</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;test03&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> pkxing</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Package</span> com.itheima</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@date</span> 2018/6/23  ä¸‹åˆ9:10</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnnotationDemo05</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// è·å¾—Classå¯¹è±¡</span><br>        Class c = TestMyTest.class;<br>        Object obj = c.newInstance();<br>        <span class="hljs-comment">// è·å¾—æ‰€æœ‰æˆå‘˜æ–¹æ³•</span><br>        Method[] methods = c.getMethods();<br>        <span class="hljs-keyword">for</span>(Method m:methods)&#123;<br>            <span class="hljs-comment">// åˆ¤æ–­mæ–¹æ³•æ˜¯å¦ä½¿ç”¨äº†MyTestæ³¨è§£</span><br>            <span class="hljs-keyword">if</span>(m.isAnnotationPresent(MyTest.class))&#123;<br>                <span class="hljs-comment">// è°ƒç”¨æ–¹æ³•</span><br>                m.invoke(obj);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ç¬¬å››ç« -åŠ¨æ€ä»£ç†"><a href="#ç¬¬å››ç« -åŠ¨æ€ä»£ç†" class="headerlink" title="ç¬¬å››ç«  åŠ¨æ€ä»£ç†"></a>ç¬¬å››ç«  åŠ¨æ€ä»£ç†</h1><h2 id="4-1-ä»£ç†æ¨¡å¼ã€Proxy-Patternã€‘"><a href="#4-1-ä»£ç†æ¨¡å¼ã€Proxy-Patternã€‘" class="headerlink" title="4.1 ä»£ç†æ¨¡å¼ã€Proxy Patternã€‘"></a>4.1 ä»£ç†æ¨¡å¼ã€Proxy Patternã€‘</h2><p>â€‹            ä¸ºä»€ä¹ˆè¦æœ‰â€œä»£ç†â€ï¼Ÿç”Ÿæ´»ä¸­å°±æœ‰å¾ˆå¤šä¾‹å­ï¼Œä¾‹å¦‚å§”æ‰˜ä¸šåŠ¡ç­‰ç­‰ï¼Œ<strong>ä»£ç†å°±æ˜¯è¢«ä»£ç†è€…æ²¡æœ‰èƒ½åŠ›æˆ–è€…ä¸æ„¿æ„å»å®ŒæˆæŸä»¶äº‹æƒ…ï¼Œéœ€è¦æ‰¾ä¸ªäººä»£æ›¿è‡ªå·±å»å®Œæˆè¿™ä»¶äº‹</strong>ï¼Œè¿™æ‰æ˜¯â€œä»£ç†â€å­˜åœ¨çš„åŸå› ã€‚ä¾‹å¦‚ï¼Œæˆ‘ç°åœ¨éœ€è¦å‡ºå›½ï¼Œä½†æ˜¯æˆ‘ä¸æ„¿æ„è‡ªå·±å»åŠç­¾è¯ã€é¢„å®šæœºç¥¨å’Œé…’åº—ï¼ˆè§‰å¾—éº»çƒ¦ ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ‰¾æ—…è¡Œç¤¾å»å¸®æˆ‘åŠï¼Œè¿™æ—¶å€™æ—…è¡Œç¤¾å°±æ˜¯ä»£ç†ï¼Œè€Œæˆ‘è‡ªå·±å°±æ˜¯è¢«ä»£ç†äº†ã€‚</p><h2 id="4-2-åŠ¨æ€ä»£ç†æ¦‚è¿°"><a href="#4-2-åŠ¨æ€ä»£ç†æ¦‚è¿°" class="headerlink" title="4.2  åŠ¨æ€ä»£ç†æ¦‚è¿°"></a>4.2  åŠ¨æ€ä»£ç†æ¦‚è¿°</h2><p>â€‹            åŠ¨æ€ä»£ç†ç®€å•æ¥è¯´æ˜¯ï¼š<strong>æ‹¦æˆªå¯¹çœŸå®å¯¹è±¡æ–¹æ³•çš„ç›´æ¥è®¿é—®ï¼Œå¢å¼ºçœŸå®å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½</strong></p><p>â€‹            åŠ¨æ€ä»£ç†è¯¦ç»†æ¥è¯´æ˜¯ï¼šä»£ç†ç±»åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºçš„ä»£ç†å¯¹è±¡è¢«ç§°ä¸ºåŠ¨æ€ä»£ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç†ç±»å¹¶ä¸æ˜¯åœ¨Javaä»£ç ä¸­å®šä¹‰çš„ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æ ¹æ®æˆ‘ä»¬åœ¨Javaä»£ç ä¸­çš„â€œæŒ‡ç¤ºâ€åŠ¨æ€ç”Ÿæˆçš„ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ æƒ³è·å–å“ªä¸ªå¯¹è±¡çš„ä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å°±ä¼šåŠ¨æ€çš„ä¸ºä½ ç”Ÿæˆè¿™ä¸ªå¯¹è±¡çš„ä»£ç†å¯¹è±¡ã€‚<strong>åŠ¨æ€ä»£ç†å¯ä»¥å¯¹è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•è¿›è¡Œå¢å¼º</strong>ï¼Œ<strong>å¯ä»¥åœ¨ä¸ä¿®æ”¹æ–¹æ³•æºç çš„æƒ…å†µä¸‹ï¼Œå¢å¼ºè¢«ä»£ç†å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½</strong>ï¼Œ<strong>åœ¨æ–¹æ³•æ‰§è¡Œå‰ååšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…</strong>ã€‚åŠ¨æ€ä»£ç†æŠ€æœ¯éƒ½æ˜¯åœ¨æ¡†æ¶ä¸­ä½¿ç”¨å±…å¤šï¼Œä¾‹å¦‚ï¼šStruts1ã€Struts2ã€Springå’ŒHibernateç­‰åæœŸå­¦çš„ä¸€äº›ä¸»æµæ¡†æ¶æŠ€æœ¯ä¸­éƒ½ä½¿ç”¨äº†åŠ¨æ€ä»£ç†æŠ€æœ¯ã€‚</p><h2 id="4-3-æ¡ˆä¾‹å¼•å‡º"><a href="#4-3-æ¡ˆä¾‹å¼•å‡º" class="headerlink" title="4.3 æ¡ˆä¾‹å¼•å‡º"></a>4.3 æ¡ˆä¾‹å¼•å‡º</h2><p>â€‹    ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬è¦å®ç°è¿™æ ·çš„éœ€æ±‚ï¼šåœ¨ä¼ä¸šçš„å¤§å‹ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªä¸šåŠ¡å±‚æ–¹æ³•çš„æ‰§è¡Œï¼Œéƒ½éœ€è¦æœ‰å¯¹åº”çš„æ—¥å¿—è®°å½•ï¼Œæ¯”å¦‚è¿™ä¸ªæ–¹æ³•ä»€ä¹ˆæ—¶å€™è°ƒç”¨å®Œæˆçš„ï¼Œè€—æ—¶å¤šä¹…ç­‰ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›æ—¥å¿—ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ‰§è¡Œçš„æƒ…å†µï¼Œå°¤å…¶æ˜¯åœ¨ç³»ç»Ÿå‡ºç°é”™è¯¯çš„æ—¶å€™ï¼Œè¿™äº›æ—¥å¿—ä¿¡æ¯å°±æ˜¾å¾—å°¤ä¸ºé‡è¦äº†ã€‚ç°åœ¨æœ‰ä¸€ç§å®ç°æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œä¸šåŠ¡å±‚å®ç°ç±»ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SchoolService</span></span>&#123;<br>     <span class="hljs-function">String <span class="hljs-title">login</span><span class="hljs-params">(String loginName, String passWord)</span></span>;<br>    <span class="hljs-function">String <span class="hljs-title">getAllClazzs</span><span class="hljs-params">()</span>ï¼›</span><br><span class="hljs-function">&#125;</span><br><span class="hljs-function"></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">public</span> class SchoolServiceImpl implements SchoolService </span>&#123;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(String loginName, String passWord)</span> </span>&#123;<br><br><span class="hljs-comment">// æ–¹æ³•æ‰§è¡Œçš„å¼€å§‹æ—¶é—´ç‚¹</span><br><span class="hljs-keyword">long</span> startTimer = System.currentTimeMillis();<br><br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">500</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>.equals(loginName) &amp;&amp; <span class="hljs-string">&quot;123456&quot;</span>.equals(passWord))&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ç™»å½•å¼‚å¸¸&quot;</span>);<br>&#125;<br><span class="hljs-keyword">long</span> endTimer = System.currentTimeMillis();<br><span class="hljs-comment">// åœ¨ä»€ä¹ˆæ—¶åˆ»æ‰§è¡Œå®Œï¼ŒèŠ±è´¹äº†å¤šé•¿æ—¶é—´å®Œæˆ</span><br>SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;loginæ–¹æ³•æ‰§è¡Œ-&gt;&quot;</span>+sdf.format(endTimer)+<span class="hljs-string">&quot;ï¼Œè€—æ—¶ï¼š&quot;</span>+(endTimer - startTimer));<br><br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç™»å½•åç§°æˆ–è€…å¯†ç ä¸æ­£ç¡®&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAllClazzs</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-comment">// æ—¶é—´ç‚¹</span><br><span class="hljs-keyword">long</span> startTimer = System.currentTimeMillis();<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">1000</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è¿”å›äº†æ‰€æœ‰çš„ç­çº§(1ç­ï¼Œ2ç­ï¼Œ3ç­)&quot;</span>;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;æŸ¥è¯¢ç­çº§å¼‚å¸¸&quot;</span>);<br>&#125;<span class="hljs-keyword">finally</span>&#123;<br><span class="hljs-keyword">long</span> endTimer = System.currentTimeMillis();<br><span class="hljs-comment">// åœ¨ä»€ä¹ˆæ—¶åˆ»æ‰§è¡Œå®Œï¼ŒèŠ±è´¹äº†å¤šé•¿æ—¶é—´å®Œæˆ</span><br>SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>System.out.println(<span class="hljs-string">&quot;getAllClazzsæ–¹æ³•æ‰§è¡Œ-&gt;&quot;</span>+sdf.format(endTimer)+<span class="hljs-string">&quot;ï¼Œè€—æ—¶ï¼š&quot;</span>+(endTimer - startTimer));<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>.</p><p>â€‹        æˆ‘ä»¬åœ¨ä¸šåŠ¡å±‚çš„æ–¹æ³•æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™éƒ½å»è®°å½•äº†å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´ï¼Œè¿™æ ·è™½ç„¶å¯ä»¥è®°å½•æ¯ä¸ªæ–¹æ³•è¿è¡Œçš„æˆªæ­¢æ—¶é—´å’Œè€—æ—¶æƒ…å†µï¼Œä½†æ˜¯ä»£ç æ˜¾å¾—å¾ˆè‡ƒè‚¿ï¼Œè¿™äº›æ—¥è®°è®°å½•ä»£ç æœ¬èº«ä¹Ÿæ˜¯ä¸ä¸šåŠ¡åŠŸèƒ½æ— å…³çš„ä»£ç ã€‚</p><h2 id="4-4-ä½¿ç”¨åŠ¨æ€ä»£ç†ä¼˜åŒ–ä»£ç "><a href="#4-4-ä½¿ç”¨åŠ¨æ€ä»£ç†ä¼˜åŒ–ä»£ç " class="headerlink" title="4.4 ä½¿ç”¨åŠ¨æ€ä»£ç†ä¼˜åŒ–ä»£ç "></a>4.4 ä½¿ç”¨åŠ¨æ€ä»£ç†ä¼˜åŒ–ä»£ç </h2><p>â€‹    <strong>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</strong></p><p>â€‹        <strong>åŠ¨æ€ä»£ç†å°±æ˜¯è§£å†³æ­¤ç±»é—®é¢˜éå¸¸å¥½çš„å®ç°æ‰‹æ®µï¼Œé€šè¿‡åŠ¨æ€ä»£ç†æˆ‘ä»¬å¯ä»¥ä¸ºè¯¥ä¸šåŠ¡å±‚å®ç°ç±»å¯¹è±¡æä¾›ä¸€ä¸ªåŠ¨æ€çš„ä»£ç†å¯¹è±¡ã€‚è¯¥ä»£ç†å¯¹è±¡ï¼Œå¯ä»¥ä¸ºå®ç°ç±»çš„æ‰€æœ‰æ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå¹¶å¯¹ä»£ç†çš„æ–¹æ³•åŠŸèƒ½è¿›è¡Œå¢å¼ºã€‚ä¹Ÿå°±æ˜¯è¯´åªè¦è°ƒç”¨äº†è¢«ä»£ç†å®ç°ç±»å¯¹è±¡çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„æ‰§è¡Œä¼šå…ˆè¿›å…¥åˆ°ä»£ç†å¯¹è±¡ä¸­å»ï¼Œä»£ç†å¯¹è±¡å¯ä»¥åœ¨è¯¥æ–¹æ³•æ‰§è¡Œå‰è®°å½•å¼€å§‹æ—¶é—´ï¼Œç„¶åå»è§¦å‘è¯¥æ–¹æ³•çš„æ‰§è¡Œï¼Œåœ¨æ–¹æ³•æ‰§è¡Œå®Œæˆä»¥åå†ç”±ä»£ç†å¯¹è±¡å»è®°å½•ç»“æŸæ—¶é—´ç„¶åè®¡ç®—æ—¶é—´å·®ä½œä¸ºæ—¥å¿—è®°å½•ï¼Œå› ä¸ºæ–¹æ³•çš„æ—¥è®°è®°å½•ç”±ä»£ç†å®Œæˆäº†ï¼Œæ‰€ä»¥è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•å°±æ— éœ€è‡ªå·±å•ç‹¬è®°å½•æ—¥å¿—æ“ä½œäº†ã€‚è¿™æ ·å°±äº§ç”Ÿäº†ä¸€ç§éå¸¸å¥½çš„è®¾è®¡æ¨¡å‹ã€‚</strong></p><p>ç°åœ¨æˆ‘ä»¬æ¥ä½¿ç”¨åŠ¨æ€ä»£ç†å†™ä¸€ä¸ªæ—¥å¿—è®°å½•çš„ä»£ç†ç±»ï¼š</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogProxy</span> </span>&#123;<br><span class="hljs-comment">// æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºç”Ÿäº§éœ€è¦è¢«ä»£ç†å¯¹è±¡çš„ä»£ç†å¯¹è±¡ã€‚</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">getProxy</span><span class="hljs-params">(Object obj)</span> </span>&#123;<br><span class="hljs-keyword">return</span> Proxy.newProxyInstance(obj.getClass().getClassLoader(), obj<br>.getClass().getInterfaces(), <span class="hljs-keyword">new</span> InvocationHandler() &#123;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span></span><br><span class="hljs-function"><span class="hljs-keyword">throws</span> Throwable </span>&#123;<br><span class="hljs-comment">// å…ˆè®°å½•å¼€å§‹æ—¶é—´ç‚¹</span><br><span class="hljs-keyword">long</span> startTimer = System.currentTimeMillis();<br><span class="hljs-keyword">try</span> &#123;<br>                       <span class="hljs-comment">// çœŸæ­£å»è§¦å‘è¢«ä»£ç†å¯¹è±¡ä¸­è¯¥æ–¹æ³•çš„æ‰§è¡Œ</span><br><span class="hljs-keyword">return</span> method.invoke(obj, args);<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br><span class="hljs-keyword">long</span> endTimer = System.currentTimeMillis();<br><span class="hljs-comment">// åœ¨ä»€ä¹ˆæ—¶åˆ»æ‰§è¡Œå®Œï¼ŒèŠ±è´¹äº†å¤šé•¿æ—¶é—´å®Œæˆ</span><br>SimpleDateFormat sdf = <span class="hljs-keyword">new</span> SimpleDateFormat(<br><span class="hljs-string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<br>System.out.println(method.getName() + <span class="hljs-string">&quot;æ–¹æ³•æ‰§è¡Œ-&gt;&quot;</span><br>+ sdf.format(endTimer) + <span class="hljs-string">&quot;ï¼Œè€—æ—¶ï¼š&quot;</span><br>+ (endTimer - startTimer));<br>&#125;<br>&#125;<br>&#125;);<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-5-é‡ç‚¹ç±»å’Œæ–¹æ³•"><a href="#4-5-é‡ç‚¹ç±»å’Œæ–¹æ³•" class="headerlink" title="4.5 é‡ç‚¹ç±»å’Œæ–¹æ³•"></a>4.5 é‡ç‚¹ç±»å’Œæ–¹æ³•</h2><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ getProxy æ–¹æ³•å³æ˜¯ç”¨äºè·å–æŸä¸ªå®ç°ç±»å¯¹è±¡çš„ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚åœ¨è¯¥ä»£ç ä¸­ï¼Œå¦‚æœè¦äº†è§£ Java åŠ¨æ€ä»£ç†çš„æœºåˆ¶ï¼Œé¦–å…ˆéœ€è¦äº†è§£ä»¥ä¸‹ç›¸å…³çš„ç±»æˆ–æ¥å£ï¼š</p><p>java.lang.reflect.Proxyï¼šè¿™æ˜¯ Java åŠ¨æ€ä»£ç†æœºåˆ¶çš„ä¸»ç±»ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•æ¥ä¸ºä¸€ç»„æ¥å£çš„å®ç°ç±»åŠ¨æ€åœ°ç”Ÿæˆä»£ç†ç±»åŠå…¶å¯¹è±¡ã€‚</p><p><strong>newProxyInstanceæ–¹æ³•çš„ä¸‰ä¸ªå‚æ•°çš„è¯¦è§£:</strong></p><p>è¯¥æ–¹æ³•ç”¨äºä¸ºæŒ‡å®šç±»è£…è½½å™¨ã€ä¸€ç»„æ¥å£åŠè°ƒç”¨å¤„ç†å™¨ç”ŸæˆåŠ¨æ€ä»£ç†ç±»å®ä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title">newProxyInstance</span><span class="hljs-params">(ClassLoader loader, Class[] interfaces, InvocationHandler h)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">1ã€obj.<span class="hljs-title">getClass</span><span class="hljs-params">()</span>.<span class="hljs-title">getClassLoader</span><span class="hljs-params">()</span>ç›®æ ‡å¯¹è±¡é€šè¿‡getClassæ–¹æ³•è·å–ç±»çš„æ‰€æœ‰ä¿¡æ¯åï¼Œè°ƒç”¨<span class="hljs-title">getClassLoader</span><span class="hljs-params">()</span> æ–¹æ³•æ¥è·å–ç±»åŠ è½½å™¨ã€‚è·å–ç±»åŠ è½½å™¨åï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç±»å‹çš„åŠ è½½å™¨ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå°†ç”Ÿæˆçš„ä»£ç†ç±»åŠ è½½åˆ°JVMå³Javaè™šæ‹Ÿæœºä¸­ï¼Œä»¥ä¾¿è¿è¡Œæ—¶éœ€è¦ï¼ </span><br><span class="hljs-function"></span><br><span class="hljs-function">2ã€obj.<span class="hljs-title">getClass</span><span class="hljs-params">()</span>.<span class="hljs-title">getInterfaces</span><span class="hljs-params">()</span>è·å–è¢«ä»£ç†ç±»çš„æ‰€æœ‰æ¥å£ä¿¡æ¯ï¼Œä»¥ä¾¿äºç”Ÿæˆçš„ä»£ç†ç±»å¯ä»¥å…·æœ‰ä»£ç†ç±»æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚ </span><br><span class="hljs-function"></span><br><span class="hljs-function">3ã€InvocationHandler è¿™æ˜¯è°ƒç”¨å¤„ç†å™¨æ¥å£ï¼Œå®ƒè‡ªå®šä¹‰äº†ä¸€ä¸ª invoke æ–¹æ³•ï¼Œç”¨äºé›†ä¸­å¤„ç†åœ¨åŠ¨æ€ä»£ç†ç±»å¯¹è±¡ä¸Šçš„æ–¹æ³•è°ƒç”¨ï¼Œé€šå¸¸åœ¨è¯¥æ–¹æ³•ä¸­å®ç°å¯¹å§”æ‰˜ç±»æ–¹æ³•çš„å¤„ç†ä»¥åŠè®¿é—®.</span><br></code></pre></td></tr></table></figure><p><strong>invokeæ–¹æ³•çš„å‚æ•°</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span></span><br><span class="hljs-function">1ã€Object proxyç”Ÿæˆçš„ä»£ç†å¯¹è±¡ï¼Œåœ¨è¿™é‡Œä¸æ˜¯ç‰¹åˆ«çš„ç†è§£è¿™ä¸ªå¯¹è±¡ï¼Œä½†æ˜¯ä¸ªäººè®¤ä¸ºæ˜¯å·²ç»åœ¨å†…å­˜ä¸­ç”Ÿæˆçš„proxyå¯¹è±¡ã€‚ </span><br><span class="hljs-function">2ã€Method methodï¼šè¢«ä»£ç†çš„å¯¹è±¡ä¸­è¢«ä»£ç†çš„æ–¹æ³•çš„ä¸€ä¸ªæŠ½è±¡ã€‚</span><br><span class="hljs-function">3ã€Object[] argsï¼šè¢«ä»£ç†æ–¹æ³•ä¸­çš„å‚æ•°ã€‚è¿™é‡Œå› ä¸ºå‚æ•°ä¸ªæ•°ä¸å®šï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªå¯¹è±¡æ•°ç»„æ¥è¡¨ç¤ºã€‚</span><br></code></pre></td></tr></table></figure><p>â€‹    ä»£ç†ç±»å®šä¹‰å®Œæˆä»¥åä¸šåŠ¡å±‚å®ç°ç±»çš„æ–¹æ³•å°±æ— éœ€å†è‡ªå·±ç”³æ˜æ—¥è®°è®°å½•çš„ä»£ç äº†ï¼Œå› ä¸ºä»£ç†å¯¹è±¡ä¼šå¸®åŠ©åšæ—¥å¿—è®°å½•ï¼Œä¿®æ”¹åå®ç°ç±»ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SchoolServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SchoolService</span> </span>&#123;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">login</span><span class="hljs-params">(String loginName, String passWord)</span> </span>&#123;<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">500</span>);<br><span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;admin&quot;</span>.equals(loginName) &amp;&amp; <span class="hljs-string">&quot;123456&quot;</span>.equals(passWord))&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span>;<br>&#125;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;ç™»å½•å¼‚å¸¸&quot;</span>);<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;ç™»å½•åç§°æˆ–è€…å¯†ç ä¸æ­£ç¡®&quot;</span>;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getAllClazzs</span><span class="hljs-params">()</span> </span>&#123;<br><span class="hljs-keyword">try</span> &#123;<br>Thread.sleep(<span class="hljs-number">1000</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;è¿”å›äº†æ‰€æœ‰çš„ç­çº§(1ç­ï¼Œ2ç­ï¼Œ3ç­)&quot;</span>;<br>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;æŸ¥è¯¢ç­çº§å¼‚å¸¸&quot;</span>);<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¼€å§‹ä½¿ç”¨åŠ¨æ€ä»£ç†å»è®¿é—®æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestMain</span> </span>&#123;<br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br><span class="hljs-comment">// è·å–ä¸šåŠ¡å±‚å®ç°ç±»å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œé‚£ä¹ˆä¸šåŠ¡å±‚å®ç°ç±»å¯¹è±¡å°±ä¼šè¢«ä»£ç†äº†</span><br>SchoolService schoolService = (SchoolService) LogProxy.getProxy(<span class="hljs-keyword">new</span> SchoolServiceImpl());<br><br>System.out.println(schoolService.login(<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;1234256&quot;</span>));<br><br>System.out.println(schoolService.getAllClazzs());<br><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>â€‹        æ­¤ä»£ç ä¸­ä¸šåŠ¡å±‚å¯¹è±¡å·²ç»æ˜¯è¢«ä»£ç†çš„äº†ï¼Œé‚£ä¹ˆä»¥åè°ƒç”¨ä¸šåŠ¡å±‚å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„è°ƒç”¨ä¼šå…ˆè¢«ä»£ç†å¯¹è±¡å¤„ç†ï¼Œä»£ç†ä¼šå…ˆè®°å½•æ–¹æ³•æ‰§è¡Œçš„å¼€å§‹æ—¶é—´ï¼Œç„¶åé€šè¿‡method.invoke(obj, args)å»çœŸæ­£è§¦å‘è¯¥æ–¹æ³•çš„æ‰§è¡Œï¼Œæ¥ä¸‹æ¥ä»£ç†å¯¹è±¡è¿›è¡Œæ–¹æ³•ç»“æŸæ—¶é—´çš„è®°å½•å’Œæ—¥å¿—çš„è¾“å‡ºå³å¯ã€‚è¿™æ ·æ•´ä¸ªè¿‡ç¨‹å°±é€šè¿‡ä»£ç†å®Œç¾çš„å®ç°äº†ã€‚</p><h2 id="4-6-æ€»ç»“"><a href="#4-6-æ€»ç»“" class="headerlink" title="4.6 æ€»ç»“"></a>4.6 æ€»ç»“</h2><p>åŠ¨æ€ä»£ç†éå¸¸çš„çµæ´»ï¼Œå¯ä»¥ä¸ºä»»æ„çš„æ¥å£å®ç°ç±»å¯¹è±¡åšä»£ç†</p><p>åŠ¨æ€ä»£ç†å¯ä»¥ä¸ºè¢«ä»£ç†å¯¹è±¡çš„æ‰€æœ‰æ¥å£çš„æ‰€æœ‰æ–¹æ³•åšä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å¯ä»¥åœ¨ä¸æ”¹å˜æ–¹æ³•æºç çš„æƒ…å†µä¸‹ï¼Œå®ç°å¯¹æ–¹æ³•åŠŸèƒ½çš„å¢å¼ºï¼Œ</p><p>åŠ¨æ€ä»£ç†ç±»çš„å­—èŠ‚ç åœ¨ç¨‹åºè¿è¡Œæ—¶ç”±Javaåå°„æœºåˆ¶åŠ¨æ€ç”Ÿæˆï¼Œæ— éœ€ç¨‹åºå‘˜æ‰‹å·¥ç¼–å†™å®ƒçš„æºä»£ç ã€‚<br>åŠ¨æ€ä»£ç†ç±»ä¸ä»…ç®€åŒ–äº†ç¼–ç¨‹å·¥ä½œï¼Œè€Œä¸”æé«˜äº†è½¯ä»¶ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œå› ä¸ºJava åå°„æœºåˆ¶å¯ä»¥ç”Ÿæˆä»»æ„ç±»å‹çš„åŠ¨æ€ä»£ç†ç±»ã€‚</p><p>åŠ¨æ€ä»£ç†åŒæ—¶ä¹Ÿæé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p><p>ç¼ºç‚¹ï¼šåªèƒ½é’ˆå¯¹æ¥å£çš„å®ç°ç±»åšä»£ç†å¯¹è±¡ï¼Œæ™®é€šç±»æ˜¯ä¸èƒ½åšä»£ç†å¯¹è±¡çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>åŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL_Joinä¼˜åŒ–</title>
    <link href="/2021/04/01/MySQL_Join%E4%BC%98%E5%8C%96/"/>
    <url>/2021/04/01/MySQL_Join%E4%BC%98%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="MySQL-Joinä¼˜åŒ–"><a href="#MySQL-Joinä¼˜åŒ–" class="headerlink" title="MySQL_Joinä¼˜åŒ–"></a>MySQL_Joinä¼˜åŒ–</h1><h2 id="1-Simple-Nested-Loop-Join"><a href="#1-Simple-Nested-Loop-Join" class="headerlink" title="1. Simple Nested-Loop Join"></a>1. Simple Nested-Loop Join</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_join_1_20210401.png"></p><ul><li><p>rä¸ºé©±åŠ¨è¡¨ï¼Œsä¸ºåŒ¹é…è¡¨ï¼Œå¯ä»¥çœ‹åˆ°ä»rä¸­åˆ†åˆ«å–å‡ºæ¯ä¸€ä¸ªè®°å½•åŒºåŒ¹é…sè¡¨çš„åˆ—ï¼Œç„¶ååˆå¹¶æ•°æ®ï¼Œå¯¹sè¡¨è¿›è¡Œrè¡¨çš„è¡Œæ•°æ¬¡è®¿é—®ï¼Œå¯¹æ•°æ®åº“å¼€ç®±æ¯”è¾ƒå¤§</p></li><li><p>å»ºè®®å°è¡¨é©±åŠ¨å¤§è¡¨</p></li></ul><h2 id="2-Index-Nested-Loop-Join"><a href="#2-Index-Nested-Loop-Join" class="headerlink" title="2. Index Nested-Loop Join"></a>2. Index Nested-Loop Join</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_join_2_20210401.png"></p><ul><li><p>è¿™ä¸ªè¦æ±‚éé©±åŠ¨è¡¨ï¼ˆsï¼‰ä¸Šæœ‰ç´¢å¼•ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥å‡å°‘æ¯”è¾ƒï¼ŒåŠ é€ŸæŸ¥è¯¢ã€‚</p></li><li><p>åœ¨æŸ¥è¯¢æ—¶ï¼Œé©±åŠ¨è¡¨ï¼ˆrï¼‰ä¼šæ ¹æ®å…³è”å­—æ®µçš„ç´¢å¼•è¿›è¡ŒæŸ¥æ‰¾ï¼Œå½“åœ¨ç´¢å¼•ä¸Šæ‰¾åˆ°ç¬¦åˆçš„å€¼ï¼Œå†å›è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œä¹Ÿå°±æ˜¯åªæœ‰å½“åŒ¹é…åˆ°ç´¢å¼•ä»¥åæ‰ä¼šè¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</p></li><li><p>å¦‚æœéé©±åŠ¨è¡¨ï¼ˆsï¼‰çš„å…³è”é”®æ˜¯ä¸»é”®çš„è¯ï¼Œæ€§èƒ½ä¼šéå¸¸é«˜ï¼Œå¦‚æœä¸æ˜¯ä¸»é”®çš„è¯ï¼Œè¦è¿›è¡Œå¤šæ¬¡å›è¡¨æŸ¥è¯¢ï¼Œå…ˆå…³è”ç´¢å¼•ï¼Œç„¶åæ ¹æ®äºŒçº§ç´¢å¼•çš„ä¸»é”®IDè¿›è¡Œå›è¡¨æ“ä½œï¼Œæ€§èƒ½ä¸Šæ¯”ç´¢å¼•æ˜¯ä¸»é”®è¦æ…¢</p></li></ul><h2 id="3-Block-Nested-Loop-Join"><a href="#3-Block-Nested-Loop-Join" class="headerlink" title="3. Block Nested-Loop Join"></a>3. Block Nested-Loop Join</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_join_3_20210401.png"></p><p>å¦‚æœæœ‰ç´¢å¼•ï¼Œä¼šé€‰å–ç¬¬äºŒç§æ–¹å¼è¿›è¡Œjoinï¼Œä½†å¦‚æœjoinåˆ—æ²¡æœ‰ç´¢å¼•ï¼Œå°±ä¼šé‡‡ç”¨Block Nested-Loop Joinã€‚å¯ä»¥çœ‹åˆ°ä¸­é—´æœ‰ä¸ªjoin bufferç¼“å†²åŒºï¼Œæ˜¯å°†é©±åŠ¨è¡¨çš„æ‰€æœ‰joinç›¸å…³çš„åˆ—éƒ½å…ˆç¼“å­˜åˆ°join bufferä¸­ï¼Œç„¶åæ‰¹é‡äºåŒ¹é…è¡¨è¿›è¡Œæ¯”é…ï¼Œå°†ç¬¬ä¸€ç§å¤šæ¬¡æ¯”è¾ƒåˆå¹¶ä¸ºä¸€æ¬¡ï¼Œé™ä½äº†éé©±åŠ¨è¡¨ï¼ˆsï¼‰çš„è®¿é—®é¢‘ç‡ã€‚é»˜è®¤æƒ…å†µä¸‹join_buffer_size=256Kï¼Œå†æŸ¥æ‰¾çš„æ—¶å€™MySQLä¼šå°†æ‰€æœ‰çš„éœ€è¦çš„åˆ—ç¼“å­˜åˆ°join_bufferå½“ä¸­ï¼ŒåŒ…æ‹¬selectçš„åˆ—ï¼Œè€Œä¸æ˜¯ä»…ä»…åªç¼“å­˜å…³è”åˆ—ã€‚åœ¨ä¸€ä¸ªæœ‰Nä¸ªJOINå…³è”çš„SQLå½“ä¸­ä¼šåœ¨æ‰§è¡Œæ—¶å€™åˆ†é…N-1ä¸ªjoin_bufferã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLçš„MVCCæœºåˆ¶å’Œé”</title>
    <link href="/2021/04/01/MySQL_MVCC%E6%9C%BA%E5%88%B6%E5%92%8C%E9%94%81/"/>
    <url>/2021/04/01/MySQL_MVCC%E6%9C%BA%E5%88%B6%E5%92%8C%E9%94%81/</url>
    
    <content type="html"><![CDATA[<h1 id="MVCCæœºåˆ¶å’Œé”"><a href="#MVCCæœºåˆ¶å’Œé”" class="headerlink" title="MVCCæœºåˆ¶å’Œé”"></a>MVCCæœºåˆ¶å’Œé”</h1><h2 id="1-å½“å‰è¯»å’Œå¿«ç…§è¯»"><a href="#1-å½“å‰è¯»å’Œå¿«ç…§è¯»" class="headerlink" title="1. å½“å‰è¯»å’Œå¿«ç…§è¯»"></a>1. å½“å‰è¯»å’Œå¿«ç…§è¯»</h2><p>MySQLçš„InnoDBå­˜å‚¨å¼•æ“é»˜è®¤äº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯RR(å¯é‡å¤è¯»), æ˜¯é€šè¿‡ â€œè¡Œæ’ä»–é”+MVCCâ€ ä¸€èµ·å®ç°çš„, ä¸ä»…å¯ä»¥ä¿è¯å¯é‡å¤è¯», è¿˜å¯ä»¥<strong>éƒ¨åˆ†</strong>é˜²æ­¢å¹»è¯», è€Œéå®Œå…¨é˜²æ­¢ã€‚ä¸ºä»€ä¹ˆæ˜¯éƒ¨åˆ†é˜²æ­¢å¹»è¯», è€Œä¸æ˜¯å®Œå…¨é˜²æ­¢?</p><ul><li>æ•ˆæœ: åœ¨å¦‚æœäº‹åŠ¡Båœ¨äº‹åŠ¡Aæ‰§è¡Œä¸­, insertäº†ä¸€æ¡æ•°æ®å¹¶æäº¤, äº‹åŠ¡Aå†æ¬¡æŸ¥è¯¢, è™½ç„¶è¯»å–çš„æ˜¯undoä¸­çš„æ—§ç‰ˆæœ¬æ•°æ®(é˜²æ­¢äº†éƒ¨åˆ†å¹»è¯»), ä½†æ˜¯äº‹åŠ¡Aä¸­æ‰§è¡Œupdateæˆ–è€…deleteéƒ½æ˜¯å¯ä»¥æˆåŠŸçš„!!ï¼ˆå¯ä»¥å†ç»“åˆ<a href="#demo">åé¢çš„è§£é‡Š</a>åŠ ä»¥ç†è§£ï¼‰</li><li>å› ä¸ºåœ¨innodbä¸­çš„æ“ä½œå¯ä»¥åˆ†ä¸º<code>å½“å‰è¯»(current read)</code>å’Œ<code>å¿«ç…§è¯»(snapshot read)</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_2_20210401.png"></p><p>innodbåœ¨RRçº§åˆ«ä¸­</p><ul><li><p>å½“å‰è¯»é€šè¿‡record lockå’Œgap lockå®ç°çš„</p></li><li><p>å¿«ç…§è¯»é€šè¿‡MVCCå’Œundologå®ç°çš„</p></li></ul><p>innodbåœ¨å¿«ç…§è¯»çš„æƒ…å†µä¸‹å¹¶æ²¡æœ‰çœŸæ­£çš„é¿å…å¹»è¯», ä½†æ˜¯åœ¨å½“å‰è¯»çš„æƒ…å†µä¸‹é¿å…äº†ä¸å¯é‡å¤è¯»å’Œå¹»è¯»</p><h2 id="2-MVCCæœºåˆ¶"><a href="#2-MVCCæœºåˆ¶" class="headerlink" title="2. MVCCæœºåˆ¶"></a>2. MVCCæœºåˆ¶</h2><blockquote><p>MVCCæ˜¯å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</p></blockquote><p>MVCCå¯ä»¥ä¸»è¦å‚è€ƒæ–‡ç« å¯¹æ¯”ç€çœ‹ï¼š<a href="https://segmentfault.com/a/1190000012650596">https://segmentfault.com/a/1190000012650596</a></p><h3 id="2-1-è¡Œæ•°æ®çš„åé¢ä¸‰ä¸ªå­—æ®µ"><a href="#2-1-è¡Œæ•°æ®çš„åé¢ä¸‰ä¸ªå­—æ®µ" class="headerlink" title="2.1 è¡Œæ•°æ®çš„åé¢ä¸‰ä¸ªå­—æ®µ"></a>2.1 è¡Œæ•°æ®çš„åé¢ä¸‰ä¸ªå­—æ®µ</h3><ul><li><p>InnoDBå­˜å‚¨å¼•æ“åœ¨æ•°æ®åº“æ¯è¡Œæ•°æ®çš„åé¢æ·»åŠ äº†ä¸‰ä¸ªå­—æ®µ</p></li><li><p>innodbå­˜å‚¨å¼•æ“æ¯æ¬¡å†è¿›è¡Œæ•°æ®æ’å…¥çš„æ—¶å€™ï¼Œæ•°æ®å¿…é¡»è¦è·ŸæŸä¸€ä¸ªç´¢å¼•åˆ—ç»‘å®šåœ¨ä¸€èµ·ï¼Œè¿™ä¸ªç´¢å¼•åˆ—æœ‰ä¸€ä¸ªé€‰æ‹©çš„é¡ºåºï¼š ä¸»é”® &gt; å”¯ä¸€é”® &gt; è‡ªåŠ¨ç”Ÿæˆ6å­—èŠ‚çš„rowid</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_1_20210401.png"></p><h3 id="2-2-undologä¿è¯äº†åŸå­æ€§"><a href="#2-2-undologä¿è¯äº†åŸå­æ€§" class="headerlink" title="2.2 undologä¿è¯äº†åŸå­æ€§"></a>2.2 undologä¿è¯äº†åŸå­æ€§</h3><p>äº‹åŠ¡ä¸­æ•°æ®çš„å†å²ç‰ˆæœ¬ä¿å­˜åœ¨undologï¼Œå¯ä»¥é€šè¿‡å›æ»šæŒ‡é’ˆå®ç°äº‹åŠ¡å›æ»š</p><p>äº‹åŠ¡æäº¤åå¯ä»¥æ¸…é™¤æ— æ•ˆçš„å†å²æ•°æ®</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_3_20210401.png"></p><h3 id="2-3-Read-view"><a href="#2-3-Read-view" class="headerlink" title="2.3 Read view"></a>2.3 Read view</h3><p>å½“å‰å­˜åœ¨å¤šä¸ªå†å²ç‰ˆæœ¬æ•°æ®çš„æ—¶å€™ï¼Œä¼šæ¶‰åŠåˆ°ä¸€ä¸ªå¯è§æ€§ç®—æ³•ï¼Œæ¥è®¡ç®—å½“å‰äº‹åŠ¡è¯»å–çš„æ˜¯å“ªä¸€ä¸ªç‰ˆæœ¬çš„å†å²æ•°æ®</p><blockquote><p>read view:</p><p>å½“è¿›è¡Œå¿«ç…§è¯»çš„æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªäº‹åŠ¡idçš„åˆ—è¡¨ï¼Œæ¥ä¿å­˜ä¸åŒçš„ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›æ˜Ÿç³»æ¥åšå¯è§æ€§åˆ¤æ–­</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_4_20210401.png"></p><p>ä¸Šé¢çš„idéƒ½æ˜¯è¡Œæ•°æ®åé¢ä¸‰å­—æ®µä¸­çš„äº‹åŠ¡id</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_5_20210401.png"></p><p>MVCCä¸­éš”ç¦»çº§åˆ«RCå’ŒRRçš„åŒºåˆ«ï¼šåœ¨äº<strong>readviewçš„ç”Ÿæˆæ—¶æœº</strong></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_6_20210401.png"></p><h2 id="3-é”"><a href="#3-é”" class="headerlink" title="3. é”"></a>3. é”</h2><blockquote><p>MySQLé”çš„åˆ†ç±»</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_7_20210401.png"></p><h3 id="3-1-ä¸‰ç§è¡Œé”çš„åŒºåˆ«"><a href="#3-1-ä¸‰ç§è¡Œé”çš„åŒºåˆ«" class="headerlink" title="3.1 ä¸‰ç§è¡Œé”çš„åŒºåˆ«"></a>3.1 ä¸‰ç§è¡Œé”çš„åŒºåˆ«</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL_8_20210401.png"></p><h3 id="3-2-å¹»è¯»"><a href="#3-2-å¹»è¯»" class="headerlink" title="3.2 å¹»è¯»"></a>3.2 å¹»è¯»</h3><p><a id="demo">éƒ¨åˆ†è§£å†³å¹»è¯»çš„ç†è§£</a></p><p>å¦‚æœå…¨æ˜¯å¿«ç…§è¯»ä¸ä¼šå‡ºç°å¹»è¯»ï¼ˆMVCCä¿è¯çš„ï¼‰</p><p>å¦‚æœå…¨æ˜¯å½“å‰è¯»ä¹Ÿæ˜¯ä¸ä¼šå‡ºç°å¹»è¯»çš„ï¼ˆè®°å½•é”å’Œé—´éš™é”ä¿è¯çš„ï¼‰</p><p>ä¸€ä¸ªå®ä¾‹åˆ†æï¼ˆå‡ºç°å¹»è¯»ï¼‰ï¼š</p><ul><li>å½“å‰äº‹åŠ¡1å…ˆå¿«ç…§è¯»ï¼ˆselectï¼‰</li><li>éšåäº‹åŠ¡2åœ¨å½“å‰äº‹åŠ¡1æ‰§è¡Œè¿‡ç¨‹ä¸­æ’å…¥æˆ–è€…åˆ é™¤è¡Œæ•°æ®å¹¶æˆåŠŸæäº¤</li><li>å½“å‰äº‹åŠ¡1åˆæ‰§è¡Œäº†<strong>å½“å‰è¯»</strong>(å¦‚update)ï¼Œå‘ç°çªç„¶çªç„¶å¢åŠ æˆ–è€…å‡å°‘äº†ä¸€è¡Œ</li></ul>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>MVCC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisç¼“å­˜æ•°æ®åº“åŒå†™ä¸ä¸€è‡´</title>
    <link href="/2021/04/01/Redis%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8C%E5%86%99%E4%B8%8D%E4%B8%80%E8%87%B4/"/>
    <url>/2021/04/01/Redis%E7%BC%93%E5%AD%98%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8F%8C%E5%86%99%E4%B8%8D%E4%B8%80%E8%87%B4/</url>
    
    <content type="html"><![CDATA[<h1 id="Redisç¼“å­˜æ•°æ®åº“åŒå†™ä¸ä¸€è‡´"><a href="#Redisç¼“å­˜æ•°æ®åº“åŒå†™ä¸ä¸€è‡´" class="headerlink" title="Redisç¼“å­˜æ•°æ®åº“åŒå†™ä¸ä¸€è‡´"></a>Redisç¼“å­˜æ•°æ®åº“åŒå†™ä¸ä¸€è‡´</h1><p>å­¦ä¹ ç¬”è®°</p><h2 id="1-ç¤ºä¾‹"><a href="#1-ç¤ºä¾‹" class="headerlink" title="1. ç¤ºä¾‹"></a>1. ç¤ºä¾‹</h2><h3 id="1-1-ç¤ºä¾‹ä¸€"><a href="#1-1-ç¤ºä¾‹ä¸€" class="headerlink" title="1.1 ç¤ºä¾‹ä¸€"></a>1.1 ç¤ºä¾‹ä¸€</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_9_20210331.png"></p><p>çº¿ç¨‹ä¸€ï¼šå†™æ•°æ®åº“stock=10ï¼Œä¹‹åå‘ç”Ÿå¡é¡¿æˆ–è€…å»¶è¿Ÿäº†å¾ˆä¹…æ‰æ›´æ–°ç¼“å­˜</p><p>çº¿ç¨‹äºŒï¼šåœ¨çº¿ç¨‹ä¸€ä¹‹åå†™æ•°æ®åº“stock=6ï¼Œç„¶åæ›´æ–°äº†ç¼“å­˜stock=6</p><p>çº¿ç¨‹ä¸€ï¼šå†çº¿ç¨‹äºŒæ›´æ–°ç¼“å­˜ç»“æŸåï¼Œå¡é¡¿æˆ–è€…å»¶è¿Ÿç»“æŸï¼Œæ›´æ–°ç¼“å­˜stock=10</p><p>ç»“æœï¼šå¯¼è‡´æ•°æ®åº“stock=6ï¼Œè€Œç¼“å­˜stock=10</p><p>è§£å†³æ–¹æ³•ï¼šæ›´æ–°æ•°æ®åº“ä¹‹ååˆ é™¤ç¼“å­˜ã€‚</p><p>ä½†æ˜¯ä¾ç„¶æœ‰é—®é¢˜ï¼Œè§ç¤ºä¾‹äºŒ</p><h3 id="1-2-ç¤ºä¾‹äºŒ"><a href="#1-2-ç¤ºä¾‹äºŒ" class="headerlink" title="1.2 ç¤ºä¾‹äºŒ"></a>1.2 ç¤ºä¾‹äºŒ</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_10_20210331.png"></p><p>çº¿ç¨‹ä¸€ï¼šæ›´æ–°æ•°æ®åº“stock=10ï¼Œç„¶ååˆ é™¤ç¼“å­˜</p><p>çº¿ç¨‹ä¸‰ï¼šåœ¨çº¿ç¨‹ä¸€æ›´æ–°åæŸ¥ç¼“å­˜ï¼Œå‘ç°ç¼“å­˜ä¸ºç©ºï¼›äºæ˜¯æŸ¥æ•°æ®åº“ï¼Œå‘ç°ä¸ºstock=10ï¼Œæ­¤æ—¶å‘æˆå¡é¡¿æˆ–è€…å»¶è¿Ÿï¼›</p><p>çº¿ç¨‹äºŒï¼šåœ¨çº¿ç¨‹ä¸‰æŸ¥æ•°æ®åº“ï¼Œæ›´æ–°ç¼“å­˜ä¹‹å‰ï¼Œé‡å†™äº†æ•°æ®åº“stock=6ï¼Œå¹¶åˆ é™¤ç¼“å­˜</p><p>çº¿ç¨‹ä¸‰ï¼šå¡é¡¿æˆ–è€…å»¶è¿Ÿç»“æŸï¼Œæ›´æ–°ç¼“å­˜stock=10</p><p>ç»“æœï¼šå¯¼è‡´ç¼“å­˜stock = 10ï¼Œæ•°æ®åº“stock=6</p><p>æˆ‘ä»¬å¯ä»¥å‘ç°æ›´æ–°æ•°æ®åº“ååˆ é™¤ç¼“å­˜å¹¶æ²¡æœ‰è§£å†³åŒå†™ä¸ä¸€è‡´é—®é¢˜ã€‚</p><p>ä¸€äº›è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p><strong>å»¶è¿ŸåŒåˆ </strong>ï¼ˆå¯é æ€§ä¸é«˜ï¼Œä¸”å¯¼è‡´ååé‡ä¸‹é™ï¼Œä¸æ¨èï¼‰</p><p>æ›´æ–°æ•°æ®åº“ï¼Œç«‹åˆ»åˆ é™¤ç¼“å­˜ï¼Œç„¶åsleepä¸€æ®µæ—¶é—´åå†åˆ ä¸€æ¬¡ç¼“å­˜</p></li><li><p><strong>å†…å­˜é˜Ÿåˆ—</strong>ï¼ˆå¹¶å‘é—®é¢˜ä¸²è¡ŒåŒ–ï¼Œå®ç°å¤æ‚ï¼Œæ€§èƒ½ä¸é«˜ï¼Œä¸æ¨èï¼‰</p><p>æŠŠåŒä¸€ä¸ªå•†å“çš„CRUDæ“ä½œéƒ½æ”¾åœ¨ä¸€ä¸ªé˜Ÿåˆ—é‡Œé¢ä¸²è¡ŒåŒ–æ‰§è¡Œ</p></li><li><p><strong>åˆ†å¸ƒå¼é”</strong>ï¼ˆå¹¶å‘é—®é¢˜ä¸²è¡ŒåŒ–ï¼Œå®ç°ç®€å•ï¼Œæ€§èƒ½ä¸é«˜ï¼Œ<strong>æ¨è</strong>ï¼‰</p><p>å…·ä½“è§æˆ‘çš„ä¸Šä¸€ç¯‡<a href="http://lihengxu.cn/2021/03/31/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/">blog</a></p></li></ul><h2 id="2-è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆ"><a href="#2-è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2. è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆ"></a>2. è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆ</h2><h3 id="2-1-è¯»å†™é”ï¼ˆè¯»å¤šå†™å°‘åœºæ™¯ï¼‰"><a href="#2-1-è¯»å†™é”ï¼ˆè¯»å¤šå†™å°‘åœºæ™¯ï¼‰" class="headerlink" title="2.1 è¯»å†™é”ï¼ˆè¯»å¤šå†™å°‘åœºæ™¯ï¼‰"></a>2.1 è¯»å†™é”ï¼ˆè¯»å¤šå†™å°‘åœºæ™¯ï¼‰</h3><p>åˆ†å¸ƒå¼é”å®ç°ç®€å•ï¼Œä½†æ€§èƒ½æœ‰å¾…ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯»å†™é”æ¥è¿›ä¸€æ­¥æé«˜æ€§èƒ½ï¼Œè¯»å…±äº«ï¼Œå†™äº’æ–¥ï¼ˆæ’ä»–ï¼‰</p><ul><li><p>æŸ¥è¯¢æ–¹æ³•<code>getStock()</code>ä½¿ç”¨è¯»é”</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_11_20210331.png"></p></li><li><p>æ›´æ–°æ–¹æ³•<code>updateStock()</code>ä½¿ç”¨å†™é”</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_12._20210331.png"></p></li><li><p>è¿™ä¸¤ä¸ªè¯»æ”¹æ–¹æ³•æ˜¯äº’æ–¥çš„</p></li><li><p>è¯»å†™é”Redissonçš„åº•å±‚å®ç°</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_13._20210331.png"></p><h3 id="2-2-ç¼“å­˜è®¾ç½®è¶…æ—¶æ¸…é™¤ï¼ˆé€‚ç”¨äºç¼“å­˜ä¸è¿½æ±‚ç»å¯¹ä¸€è‡´ï¼‰"><a href="#2-2-ç¼“å­˜è®¾ç½®è¶…æ—¶æ¸…é™¤ï¼ˆé€‚ç”¨äºç¼“å­˜ä¸è¿½æ±‚ç»å¯¹ä¸€è‡´ï¼‰" class="headerlink" title="2.2 ç¼“å­˜è®¾ç½®è¶…æ—¶æ¸…é™¤ï¼ˆé€‚ç”¨äºç¼“å­˜ä¸è¿½æ±‚ç»å¯¹ä¸€è‡´ï¼‰"></a>2.2 ç¼“å­˜è®¾ç½®è¶…æ—¶æ¸…é™¤ï¼ˆé€‚ç”¨äºç¼“å­˜ä¸è¿½æ±‚ç»å¯¹ä¸€è‡´ï¼‰</h3><p>è¯¦æƒ…é¡µé¢æ˜¾ç¤º100ï¼Œä½†æ˜¯ä¸‹å•åå‘ç°å·²ç»ï¼ˆæ•°æ®åº“åº“å­˜ä¸º0ï¼‰å–å®Œäº†ï¼Œå…¶å®å¹¶ä¸å½±å“ä¸šåŠ¡é€»è¾‘ï¼Œæ‰€ä»¥è®¾ç½®ç¼“å­˜å¤±æ•ˆæ—¶é—´å°±è¡Œäº†ã€‚</p><p>è¯¥æ–¹æ³•æ²¡æœ‰è¾ƒå¥½çš„è§£å†³åŒå†™ä¸ä¸€è‡´é—®é¢˜ï¼Œä½†æ˜¯ç®€å•ï¼Œä¸”æ€§èƒ½è¾ƒå¥½ã€‚</p><h3 id="2-3-åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆè¯»å¤šå†™å¤šçš„åœºæ™¯ï¼‰"><a href="#2-3-åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆè¯»å¤šå†™å¤šçš„åœºæ™¯ï¼‰" class="headerlink" title="2.3 åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆè¯»å¤šå†™å¤šçš„åœºæ™¯ï¼‰"></a>2.3 åˆ†å¸ƒå¼æ•°æ®åº“ï¼ˆè¯»å¤šå†™å¤šçš„åœºæ™¯ï¼‰</h3><p>å¦‚æœå†™å¤šçš„è¯ï¼Œå°±å·²ç»ä¸é€‚åˆç¼“å­˜äº†ï¼Œæ‰€ä»¥ç›´æ¥å°±åœ¨æ•°æ®åº“ä¸Šæ“ä½œäº†</p><p>å¦‚æœMySQLæ‰›ä¸ä½é«˜å¹¶å‘è¯·æ±‚å¯ä»¥é€šè¿‡åˆ†å¸ƒå¼æ•°æ®åº“æ¥æ”¹å–„ï¼Œå¦‚TiDB</p>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisåˆ†å¸ƒå¼é”çš„æ·±å…¥ç†è§£</title>
    <link href="/2021/03/31/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/"/>
    <url>/2021/03/31/Redis%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E7%9A%84%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="Redisåˆ†å¸ƒå¼é”çš„æ·±å…¥ç†è§£"><a href="#Redisåˆ†å¸ƒå¼é”çš„æ·±å…¥ç†è§£" class="headerlink" title="Redisåˆ†å¸ƒå¼é”çš„æ·±å…¥ç†è§£"></a>Redisåˆ†å¸ƒå¼é”çš„æ·±å…¥ç†è§£</h1><p>å­¦ä¹ ç¬”è®°</p><h2 id="1-é«˜å¹¶å‘ä¸‹çš„è¶…å–bug"><a href="#1-é«˜å¹¶å‘ä¸‹çš„è¶…å–bug" class="headerlink" title="1. é«˜å¹¶å‘ä¸‹çš„è¶…å–bug"></a>1. é«˜å¹¶å‘ä¸‹çš„è¶…å–bug</h2><p>å…ˆçœ‹ä¸€ä¸ªç®€å•çš„å‡åº“å­˜ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.redisson<br><span class="hljs-keyword">import</span> ...<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span></span>&#123;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> Redssion redisson;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;/deduct_stock&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deductStock</span><span class="hljs-params">()</span></span>&#123;<br>        <br>        <span class="hljs-keyword">int</span> stock = Integer.parseInt(stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;stock&quot;</span>)); <span class="hljs-comment">// jedis.get(&quot;stock&quot;)</span><br>        <span class="hljs-keyword">if</span>(stock &gt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">int</span> realStock = stock -<span class="hljs-number">1</span>;<br>            stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;stock&quot;</span>, realStock + <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// jedis.set(key, value)</span><br>            System.out.println(<span class="hljs-string">&quot;æ‰£å‡æˆåŠŸï¼Œ å‰©ä½™åº“å­˜ï¼š&quot;</span> + realStock);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ‰£å‡å¤±è´¥ï¼Œ å‰©ä½™åº“å­˜ä¸è¶³&quot;</span>);<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;end&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¹¶å‘é—®é¢˜å¾ˆæ˜æ˜¾</p><p>é¦–å…ˆæˆ‘ä»¬ç”¨ä¼ ç»Ÿçš„synchronizedä»£ç å—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.redisson<br><span class="hljs-keyword">import</span> ...<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span></span>&#123;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> Redssion redisson;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;/deduct_stock&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deductStock</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">// synchronizedä»£ç å—</span><br>        <span class="hljs-keyword">synchronized</span>(<span class="hljs-keyword">this</span>)&#123;<br>            <span class="hljs-keyword">int</span> stock = Integer.parseInt(stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;stock&quot;</span>)); <span class="hljs-comment">// jedis.get(&quot;stock&quot;)</span><br>            <span class="hljs-keyword">if</span>(stock &gt; <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">int</span> realStock = stock -<span class="hljs-number">1</span>;<br>                stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;stock&quot;</span>, realStock + <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// jedis.set(key, value)</span><br>                System.out.println(<span class="hljs-string">&quot;æ‰£å‡æˆåŠŸï¼Œ å‰©ä½™åº“å­˜ï¼š&quot;</span> + realStock);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;æ‰£å‡å¤±è´¥ï¼Œ å‰©ä½™åº“å­˜ä¸è¶³&quot;</span>);<br>            &#125;<br>        &#125;<br>        <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;end&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜¾ç„¶åˆ†å¸ƒå¼éƒ¨ç½²æƒ…å†µä¸‹ä»ç„¶å­˜åœ¨ä¸¥é‡çš„å¹¶å‘é—®é¢˜</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_1_20210331.png"></p><p>åªèƒ½é”ä¸€ä¸ªtomcatæœåŠ¡å™¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡Redisçš„åˆ†å¸ƒå¼é”æ¥è§£å†³å¹¶å‘é—®é¢˜</p><h2 id="2-åˆ†å¸ƒå¼é”çš„ä½¿ç”¨"><a href="#2-åˆ†å¸ƒå¼é”çš„ä½¿ç”¨" class="headerlink" title="2. åˆ†å¸ƒå¼é”çš„ä½¿ç”¨"></a>2. åˆ†å¸ƒå¼é”çš„ä½¿ç”¨</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_2_20210331.png"></p><h3 id="2-1-åŸºæœ¬ä½¿ç”¨ï¼ˆå…¥é—¨ä½¿ç”¨ï¼‰"><a href="#2-1-åŸºæœ¬ä½¿ç”¨ï¼ˆå…¥é—¨ä½¿ç”¨ï¼‰" class="headerlink" title="2.1 åŸºæœ¬ä½¿ç”¨ï¼ˆå…¥é—¨ä½¿ç”¨ï¼‰"></a>2.1 åŸºæœ¬ä½¿ç”¨ï¼ˆå…¥é—¨ä½¿ç”¨ï¼‰</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.redisson<br><span class="hljs-keyword">import</span> ...<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span></span>&#123;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> Redssion redisson;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;/deduct_stock&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deductStock</span><span class="hljs-params">()</span></span>&#123;<br>        String lockKey = <span class="hljs-string">&quot;product_100&quot;</span>;<br>        <span class="hljs-comment">// 1.è®¾ç½®åˆ†å¸ƒå¼é”</span><br>        Boolean result = stringRedisTemplate.opsForValue().setIfAbsent(lockKey, <span class="hljs-string">&quot;xlh&quot;</span>); <span class="hljs-comment">//jedis.setnx(k,v)</span><br>        <br>        <span class="hljs-keyword">if</span>(!result)&#123;<br>            <span class="hljs-comment">// 2.1 å¦‚æœè®¾ç½®ä¸æˆåŠŸï¼Œè¿™è¡¨ç¤ºåˆ«äººåœ¨ä½¿ç”¨</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error_code&quot;</span>;<br>        &#125;<br>        <span class="hljs-comment">// 2.2 å¦‚æœè®¾ç½®æˆåŠŸï¼Œè¿™è¿›è¡Œåº“å­˜æ‰£é™¤æ“ä½œ</span><br>        <span class="hljs-keyword">int</span> stock = Integer.parseInt(stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;stock&quot;</span>)); <span class="hljs-comment">// jedis.get(&quot;stock&quot;)</span><br>        <span class="hljs-keyword">if</span>(stock &gt; <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">int</span> realStock = stock -<span class="hljs-number">1</span>;<br>            stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;stock&quot;</span>, realStock + <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// jedis.set(key, value)</span><br>            System.out.println(<span class="hljs-string">&quot;æ‰£å‡æˆåŠŸï¼Œ å‰©ä½™åº“å­˜ï¼š&quot;</span> + realStock);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;æ‰£å‡å¤±è´¥ï¼Œ å‰©ä½™åº“å­˜ä¸è¶³&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// 3. é‡Šæ”¾é”</span><br>        stringRedisTemplate.delete(lockKey);<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;end&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-2-æ”¹è¿›ä»£ç "><a href="#2-2-æ”¹è¿›ä»£ç " class="headerlink" title="2.2 æ”¹è¿›ä»£ç "></a>2.2 æ”¹è¿›ä»£ç </h3><p>åˆ†æåŸºç¡€ä»£ç ï¼šæ˜¾ç„¶ç³»ç»Ÿåœ¨åŠ é”åæŠ›å¼‚å¸¸ï¼Œæˆ–è€…ä¸­æ–­ï¼Œå°±æ— æ³•é‡Šæ”¾é”</p><p>è§£å†³ï¼š</p><ul><li>æŠ›å¼‚å¸¸ç”¨try-catch-finallyè§£å†³</li><li>ç³»ç»Ÿä¸­æ–­ã€å®•æœºï¼Œå¯ä»¥é€šè¿‡ç»™é”è®¾ç½®å­˜æ´»æ—¶é—´ï¼Œè¶…æ—¶è‡ªåŠ¨è§£é”<font color="FF0000">(æ³¨æ„è¦åœ¨è®¾ç½®é”çš„åŒæ—¶è®¾ç½®ç”Ÿå‘½é•¿åº¦ï¼Œä¿è¯åŸå­æ€§)</font></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.redisson<br><span class="hljs-keyword">import</span> ...<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span></span>&#123;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> Redssion redisson;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;/deduct_stock&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deductStock</span><span class="hljs-params">()</span></span>&#123;<br>        String lockKey = <span class="hljs-string">&quot;product_100&quot;</span>;<br>        <span class="hljs-comment">// 1.è®¾ç½®åˆ†å¸ƒå¼é”</span><br>        <span class="hljs-comment">// Boolean result = stringRedisTemplate.opsForValue().setIfAbsent(lockKey, &quot;xlh&quot;); //jedis.setnx(k,v)</span><br>        <span class="hljs-comment">// stringRedisTemplate.expire(lockKey, 10, TimeUnit.SECONDS); // ç»™é”è®¾ç½®10sçš„æœ‰æ•ˆæ—¶é—´ï¼ˆä½†ä»»ç„¶æœ‰é£é™©åœ¨æ‰§è¡Œæœ¬å¥å‰å®•æœºï¼‰</span><br>        Boolean result = stringRedisTemplate.opsForValue().setIfAbsent(lockKey, <span class="hljs-string">&quot;xlh&quot;</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);<br>        <br>        <span class="hljs-keyword">if</span>(!result)&#123;<br>            <span class="hljs-comment">// 2.1 å¦‚æœè®¾ç½®ä¸æˆåŠŸï¼Œè¿™è¡¨ç¤ºåˆ«äººåœ¨ä½¿ç”¨</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error_code&quot;</span>;<br>        &#125;<br>        <br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-comment">// 2.2 å¦‚æœè®¾ç½®æˆåŠŸï¼Œè¿™è¿›è¡Œåº“å­˜æ‰£é™¤æ“ä½œ</span><br>            <span class="hljs-keyword">int</span> stock = Integer.parseInt(stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;stock&quot;</span>)); <span class="hljs-comment">// jedis.get(&quot;stock&quot;)</span><br>            <span class="hljs-keyword">if</span>(stock &gt; <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">int</span> realStock = stock -<span class="hljs-number">1</span>;<br>                stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;stock&quot;</span>, realStock + <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// jedis.set(key, value)</span><br>                System.out.println(<span class="hljs-string">&quot;æ‰£å‡æˆåŠŸï¼Œ å‰©ä½™åº“å­˜ï¼š&quot;</span> + realStock);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;æ‰£å‡å¤±è´¥ï¼Œ å‰©ä½™åº“å­˜ä¸è¶³&quot;</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span>&#123;<br>             <span class="hljs-comment">// 3. é‡Šæ”¾é”</span><br>        stringRedisTemplate.delete(lockKey);<br>        &#125;<br>       <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;end&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-å†æ¬¡ä¼˜åŒ–"><a href="#2-3-å†æ¬¡ä¼˜åŒ–" class="headerlink" title="2.3 å†æ¬¡ä¼˜åŒ–"></a>2.3 å†æ¬¡ä¼˜åŒ–</h3><ul><li><p>åˆ†æä¼˜åŒ–ä»£ç ï¼šæˆ‘ä»¬å‘ç°æˆ‘ä»¬è®¾ç½®é”çš„æ—¶é•¿æ˜¯å›ºå®šçš„ï¼Œè¿™æ˜¯æœ‰é—®é¢˜çš„</p></li><li><p>ä¸¾ä¸ªä¾‹å­ï¼šè®¾ç½®é”æŒç»­æ—¶é•¿10s</p><ul><li>çº¿ç¨‹aï¼šåŠ é”åï¼Œæ‰§è¡Œäº†15såˆ°é‡Šæ”¾é”ï¼Œé‡Šæ”¾çº¿ç¨‹båŠ çš„é”</li><li>çº¿ç¨‹bï¼šåœ¨11sæ—¶æ¥è®¿é—®ï¼Œå‘ç°æ²¡æœ‰é”ï¼ŒåŠ é”</li></ul><p>å¯ä»¥å‘ç°æœ‰ç€éå¸¸ä¸¥é‡çš„å¹¶å‘é—®é¢˜ï¼Œé”æœ‰å¯èƒ½æ°¸ä¹…å¤±æ•ˆ</p></li><li><p>è§£å†³æ–¹æ³•ï¼š</p><ul><li>ç»™é”çš„valueè®¾ä¸ºå½“å‰clientç‰¹æœ‰çš„å€¼ï¼Œåœ¨é‡Šæ”¾é”åŒ™æ—¶åˆ¤æ–­ï¼Œåªé‡Šæ”¾è‡ªå·±åŠ çš„é”<font color="FF0000">ï¼ˆåˆ¤æ–­å’Œé‡Šæ”¾ä¹Ÿè¦ä¿è¯åŸå­æ€§ï¼Œä¸ç„¶åˆ¤æ–­æˆåŠŸåï¼Œçº¿ç¨‹å¡é¡¿ä¸€ä¸‹å‡ ç‡æå°ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œç„¶ååˆ°çœŸæ­£é‡Šæ”¾é”çš„æ—¶å€™å¯èƒ½é‡Šæ”¾çš„ä¸æ˜¯è‡ªå·±çš„é”ï¼‰</font></li><li>çº¿ç¨‹æ‰§è¡Œæ—¶é—´è¶…æ—¶ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œé€šè¿‡<strong>é”ç»­å‘½</strong>ä¿è¯çº¿ç¨‹æœªç»“æŸæ—¶ï¼Œé”ä¸€ç›´å»¶æ—¶</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.redisson<br><span class="hljs-keyword">import</span> ...<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span></span>&#123;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> Redssion redisson;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;/deduct_stock&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deductStock</span><span class="hljs-params">()</span></span>&#123;<br>        String lockKey = <span class="hljs-string">&quot;product_100&quot;</span>;<br>        <span class="hljs-comment">// ä¸ºå½“å‰çº¿ç¨‹è®¾ç½®ä¸€ä¸ªUUIDç»™é”çš„å€¼ï¼Œç”¨äºåˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±ä¸Šçš„é”ï¼Œé¿å…åˆ é™¤åˆ«äººçš„é”</span><br>        String clientId = UUID.randomUUID().toString();          <br>        Boolean result = stringRedisTemplate.opsForValue().setIfAbsent(lockKey, clientId, <span class="hljs-number">10</span>, TimeUnit.SECONDS);<br>        <br>        <span class="hljs-keyword">if</span>(!result)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error_code&quot;</span>;<br>        &#125;<br>        <br>        <span class="hljs-keyword">try</span>&#123;<br>            <span class="hljs-keyword">int</span> stock = Integer.parseInt(stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;stock&quot;</span>)); <span class="hljs-comment">// jedis.get(&quot;stock&quot;)</span><br>            <span class="hljs-keyword">if</span>(stock &gt; <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">int</span> realStock = stock -<span class="hljs-number">1</span>;<br>                stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;stock&quot;</span>, realStock + <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// jedis.set(key, value)</span><br>                System.out.println(<span class="hljs-string">&quot;æ‰£å‡æˆåŠŸï¼Œ å‰©ä½™åº“å­˜ï¼š&quot;</span> + realStock);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;æ‰£å‡å¤±è´¥ï¼Œ å‰©ä½™åº“å­˜ä¸è¶³&quot;</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span>&#123;<br>            <span class="hljs-comment">// åˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±åŠ çš„é”(ä¿è¯åŸå­æ“ä½œï¼Œæ‰€ä»¥ä¸‹é¢çš„iféœ€è¦ç»§ç»­æ”¹è¿›)</span><br>            <span class="hljs-keyword">if</span>(clientId.equals(stringRedisTemplate.opsForValue().get(lockKey)))<br>        stringRedisTemplate.delete(lockKey);<br>        &#125;<br>       <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;end&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜¾ç„¶é”ç»­å‘½å’Œåˆ¤æ–­/é‡Šæ”¾é”çš„åŸå­æ“ä½œè¿˜æ²¡æœ‰å®ç°</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<a href="https://github.com/redisson">redisson</a>ä¸­é—´ä»¶æ¥å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.redisson<br><span class="hljs-keyword">import</span> ...<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IndexController</span></span>&#123;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> Redssion redisson;<br>    <br>    <span class="hljs-meta">@Autiwired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;/deduct_stock&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">deductStock</span><span class="hljs-params">()</span></span>&#123;<br>        String lockKey = <span class="hljs-string">&quot;product_100&quot;</span>;<br>        <span class="hljs-keyword">if</span>(!result)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;error_code&quot;</span>;<br>        &#125;<br>        <br>        Rlock redissonLock = redisson.getLock(lockKey);<br>        <br>        <span class="hljs-keyword">try</span>&#123;<br>            redissonLock.lock(); <span class="hljs-comment">// setIfAbsent(lockKey, clientId, 10, TimeUnit.SECONDS)</span><br>            <span class="hljs-keyword">int</span> stock = Integer.parseInt(stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;stock&quot;</span>)); <span class="hljs-comment">// jedis.get(&quot;stock&quot;)</span><br>            <span class="hljs-keyword">if</span>(stock &gt; <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">int</span> realStock = stock -<span class="hljs-number">1</span>;<br>                stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;stock&quot;</span>, realStock + <span class="hljs-string">&quot;&quot;</span>); <span class="hljs-comment">// jedis.set(key, value)</span><br>                System.out.println(<span class="hljs-string">&quot;æ‰£å‡æˆåŠŸï¼Œ å‰©ä½™åº“å­˜ï¼š&quot;</span> + realStock);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;æ‰£å‡å¤±è´¥ï¼Œ å‰©ä½™åº“å­˜ä¸è¶³&quot;</span>);<br>            &#125;<br>        &#125; <span class="hljs-keyword">finally</span>&#123;<br>            redissonLock.unlock();<br>        &#125;<br>       <br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;end&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Redissonå®ç°åˆ†å¸ƒå¼é”çš„æµç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_3_20210331.png"></p><h2 id="3-RedissonåŠ é”åˆ†æ"><a href="#3-RedissonåŠ é”åˆ†æ" class="headerlink" title="3. RedissonåŠ é”åˆ†æ"></a>3. RedissonåŠ é”åˆ†æ</h2><p>å‰é¢ä½¿ç”¨äº†redissonä¼˜åŒ–ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ææºç </p><blockquote><p>é€šè¿‡luaè„šæœ¬å®ç°åŸå­æ“ä½œ(redissonä¸­æœ‰ç€å¤§é‡çš„luaè„šæœ¬ä»£ç )</p></blockquote><p>çœ‹çœ‹redissonåº•å±‚çš„åŠ é”ä»£ç ï¼Œå¯ä»¥å‘ç°æ—¶é€šè¿‡Luaè„šæœ¬å®ç°çš„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_4_20210331.png"></p><p>Redisåœ¨2.6æ¨å‡ºäº†è„šæœ¬åŠŸèƒ½ï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨<a href="https://segmentfault.com/a/1190000037518418"><strong>Luaè¯­è¨€</strong></a>ç¼–å†™è„šæœ¬ä¼ åˆ°Redisä¸­æ‰§è¡Œã€‚</p><p>Luaè„šæœ¬çš„å¥½å¤„æœ‰ï¼š</p><ul><li><strong>å‡å°‘ç½‘ç»œå¼€é”€</strong>ï¼š<ul><li>æœ¬æ¥5æ¬¡ç½‘ç»œè¯·æ±‚çš„æ“ä½œï¼Œå¯ä»¥ç”¨ä¸€ä¸ªè¯·æ±‚å®Œæˆï¼ŒåŸå…ˆ5æ¬¡è¯·æ±‚çš„é€»è¾‘æ”¾åœ¨redisæœåŠ¡å™¨ä¸Šå®Œæˆã€‚ä½¿ç”¨è„šæœ¬ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”æ—¶å»¶ã€‚<strong>è¿™ç‚¹å’Œç®¡é“ç±»ä¼¼</strong>ã€‚</li></ul></li><li><strong>åŸå­æ“ä½œ</strong>ï¼š<ul><li>Redisä¼šå°†æ•´ä¸ªè„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œä¸­é—´ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’å…¥ã€‚<strong>ç®¡é“ä¸æ˜¯åŸå­çš„ï¼Œä¸è¿‡redisçš„æ‰¹é‡æ“ä½œå‘½ä»¤ï¼ˆç±»ä¼¼msetï¼‰æ˜¯åŸå­çš„</strong>ã€‚</li></ul></li><li><strong>ä»£æ›¿redisçš„äº‹åŠ¡åŠŸèƒ½</strong>ï¼š<ul><li>redisè‡ªå¸¦çš„äº‹åŠ¡åŠŸèƒ½å¾ˆé¸¡è‚‹ï¼ŒæŠ¥é”™ä¸æ”¯æŒå›æ»šï¼Œè€Œredisçš„luaè„šæœ¬å‡ ä¹å®ç°äº†å¸¸è§„çš„äº‹åŠ¡åŠŸèƒ½ï¼Œæ”¯æŒæŠ¥é”™å›æ»šæ“ä½œï¼Œå®˜æ–¹æ¨èä½¿ç”¨redisçš„äº‹åŠ¡åŠŸèƒ½å¯ä»¥ç”¨redis luaä»£æ›¿ã€‚</li></ul></li></ul><blockquote><p>æ³¨æ„ï¼š</p><p>ä¸è¦å†Luaè„šæœ¬ä¸­å‡ºé™æ­»å¾ªç¯å’Œè€—æ—¶çš„è¿ç®—ï¼Œå¦åˆ™redisä¼šé˜»å¡ï¼Œå°†ä¸æ¥å—å…¶ä»–çš„å‘½ä»¤ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶è¦æ³¨æ„ä¸èƒ½å‡ºé™æ­»å¾ªç¯ï¼Œè€—æ—¶çš„è¿ç®—ã€‚redisæ—¶ä½†è¿›ç¨‹ã€å•çº¿ç¨‹æ‰§è¡Œè„šæœ¬ã€‚ç®¡é“ä¸ä¼šé˜»å¡redisã€‚</p></blockquote><p>åˆå§‹åŒ–<code>internalLockLeaseTime</code>æ˜¯30s</p><p>ç„¶åå¤–é¢æœ‰ä¸€ä¸ªTimerTaskçš„ä»»åŠ¡ï¼Œæ¯è¿‡<code>internalLockLeaseTime/3</code>æ‰§è¡Œä¸€æ¬¡ï¼ˆä¸‹é¢ä¸‰å¼ å›¾æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå‡‘åˆç€çœ‹233ï¼‰</p><p>ä¸‹é¢å°±æ˜¯é€’å½’é”ç»­å‘½</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_6_20210331.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_5_20210331.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_7_20210331.png"></p><h2 id="4-åç»­çš„é—®é¢˜"><a href="#4-åç»­çš„é—®é¢˜" class="headerlink" title="4.  åç»­çš„é—®é¢˜"></a>4.  åç»­çš„é—®é¢˜</h2><p>é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬ä½¿ç”¨redissonæˆåŠŸè§£å†³çš„åˆ†å¸ƒå¼éƒ¨ç½²çš„å¹¶å‘é—®é¢˜ã€‚</p><p>å…¶ä»–çš„é—®é¢˜</p><ul><li>ä¸»ä»Redisé”å¤±æ•ˆé—®é¢˜<ul><li>redisä¸»ä»ç»“æ„ï¼ŒMasterä¸Šäº†é”ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ¥å¾—åŠç»™slaveåŒæ­¥å°±æŒ‚äº†ï¼Œslaveå˜ä¸ºmasterä¹‹åå…¶ä»–çº¿ç¨‹å°±èƒ½è¿›æ¥ï¼Œåˆå‡ºç°å¹¶å‘é—®é¢˜</li></ul></li><li>æ€§èƒ½å¦‚ä½•è¿›ä¸€æ­¥ä¼˜åŒ–<ul><li>åˆ†å¸ƒå¼é”ç›¸å½“äºæ˜¯æŠŠå¹¶å‘é—®é¢˜ä¸²è¡ŒåŒ–äº†ï¼Œæ€§èƒ½å—åˆ°å½±å“</li></ul></li></ul><h3 id="4-1-ä¸»ä»Redisé”å¤±æ•ˆé—®é¢˜"><a href="#4-1-ä¸»ä»Redisé”å¤±æ•ˆé—®é¢˜" class="headerlink" title="4.1 ä¸»ä»Redisé”å¤±æ•ˆé—®é¢˜"></a>4.1 ä¸»ä»Redisé”å¤±æ•ˆé—®é¢˜</h3><blockquote><p>è§£å†³æ–¹æ³•1ï¼šä½¿ç”¨zookeeper</p></blockquote><p><strong>Redis</strong>  vs  <strong>zookeeper</strong> </p><p>CAPåŸåˆ™ï¼šï¼ˆAæ˜¯å¯ç”¨æ€§ï¼ŒCæ˜¯ä¸€è‡´æ€§ï¼‰</p><ul><li>redisæ›´å¤šçš„æ»¡è¶³APï¼Œæ€§èƒ½æ›´å¥½</li><li>zookeeperæ›´å¤šçš„æ»¡è¶³CPï¼Œä¸€è‡´æ€§æ›´å¥½</li></ul><p>zookeeperå¦‚ä½•ä¿æŒæ›´å¥½çš„ä¸€è‡´æ€§çš„ï¼š</p><p>åœ¨é›†ç¾¤ä¸­nodeèŠ‚ç‚¹çš„åˆ†å¸ƒå¼é”åŒæ­¥åˆ°ä¸€åŠä»¥ä¸Šä¹‹åï¼Œæ‰ä¼šå›å¤å®¢æˆ·ç«¯åŠ é”æˆåŠŸï¼ˆè¿‡åŠå†™ï¼‰ï¼›åœ¨masteræŒ‚æ‰ä¹‹åï¼Œä¸€å®šä¼šé€‰ä¸¾åŒæ­¥æˆåŠŸçš„slaveä½œä¸ºæ–°masterã€‚</p><blockquote><p>è§£å†³æ–¹æ³•2ï¼šRedlockï¼ˆä¸æ¨èä½¿ç”¨ï¼Œå¾ˆå¤šå°é—®é¢˜ï¼Œæ¯”å¦‚å›æ»šéº»çƒ¦ï¼Œæ€§èƒ½ä½ä¸‹ï¼‰</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_8_20210331.png"></p><p>redisèŠ‚ç‚¹æ²¡æœ‰ä¸»ä»å…³ç³»ï¼Œè¶…è¿‡ä¸€åŠä»¥ä¸Šçš„åŠ é”æ‰ç®—åŠ é”æˆåŠŸï¼›å…¶ä¸­ä¸€ä¸ªæŒ‚äº†ä¹Ÿä¸ä¼šé”å¤±æ•ˆã€‚</p><h3 id="4-2-æ€§èƒ½ä¼˜åŒ–"><a href="#4-2-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="4.2 æ€§èƒ½ä¼˜åŒ–"></a>4.2 æ€§èƒ½ä¼˜åŒ–</h3><p> ä½¿ç”¨<strong>åˆ†æ®µé”</strong>çš„æ€æƒ³</p><p>æ¯”å¦‚æœ€å¼€å§‹åº“å­˜æ˜¯200ä¸ªåº“å­˜</p><p>æŠŠåº“å­˜åˆ†æˆ10ä¸ªåº“å­˜ï¼Œä¸€ä¸ªkeyå¯ä»¥å­˜20ä¸ªï¼Œå¹¶å‘åº¦æé«˜äº†10å€ã€‚ï¼ˆåº•å±‚æ¯”è¾ƒå¤æ‚ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åŒ…è£…ç±»æ³¨æ„ç‚¹</title>
    <link href="/2021/03/29/%E5%8C%85%E8%A3%85%E7%B1%BB%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9/"/>
    <url>/2021/03/29/%E5%8C%85%E8%A3%85%E7%B1%BB%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9/</url>
    
    <content type="html"><![CDATA[<h1 id="åŒ…è£…ç±»çš„æ³¨æ„ç‚¹"><a href="#åŒ…è£…ç±»çš„æ³¨æ„ç‚¹" class="headerlink" title="åŒ…è£…ç±»çš„æ³¨æ„ç‚¹"></a>åŒ…è£…ç±»çš„æ³¨æ„ç‚¹</h1><p><strong>å‰è¨€</strong>ï¼š</p><p>ä»Šå¤©åœ¨åˆ·<a href="https://leetcode-cn.com/problems/minimum-window-substring/">leetcode76</a>æ—¶å€™é‡åˆ°ä¸€ä¸ªå¥‡æ€ªçš„bugï¼Œå‘ç°æ˜¯ä¸€ä¸ªå¸¸è§çš„ç¬”è¯•è€ƒé¢˜</p><p><strong>è¡¥å……</strong>ï¼š</p><p>2021.05.03 ï¼šåŸç†å…¶å®å°±æ˜¯ä¸€ä¸ªäº«å…ƒæ¨¡å¼çš„åº”ç”¨ï¼Œå…³äºäº«å…ƒæ¨¡å¼åœ¨<a href="http://lihengxu.cn/2021/04/17/JUC/#3%E3%80%81%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F">å¹¶å‘ç¼–ç¨‹ç¬”è®°</a>ä¸­æœ‰è¯¦ç»†è§£é‡Š</p><h2 id="1-bug"><a href="#1-bug" class="headerlink" title="1. bug"></a>1. bug</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">minWindow</span><span class="hljs-params">(String s, String t)</span> </span>&#123;<br>        Map&lt;Character, Integer&gt; window = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        Map&lt;Character, Integer&gt; need = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; t.length(); i++) need.put(t.charAt(i), need.getOrDefault(t.charAt(i), <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);<br><br>        <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>, right = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> valid = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> start = <span class="hljs-number">0</span>, length = Integer.MAX_VALUE;<br>        <span class="hljs-keyword">while</span>(right &lt; s.length())&#123;<br>            <span class="hljs-keyword">char</span> c = s.charAt(right);<br>            <span class="hljs-keyword">if</span>(need.containsKey(c))&#123;<br>                window.put(c, window.getOrDefault(c, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">if</span>(need.get(c) == window.get(c))&#123;<br>                    valid++;<br>                &#125; <br>            &#125;<br>            right++;<br><br>            <br>            <span class="hljs-keyword">while</span>(valid == need.size())&#123;<br>                <br>                <span class="hljs-keyword">if</span>(right - left &lt; length)&#123;<br>                    start = left;<br>                    length = right - left;<br>                &#125;<br><br>                c = s.charAt(left);<br>                <span class="hljs-keyword">if</span>(need.containsKey(c))&#123;<br>                    <span class="hljs-keyword">if</span>(window.get(c) == need.get(c))&#123;<br>                        valid--;<br>                    &#125; <br>                    window.put(c, window.get(c) - <span class="hljs-number">1</span>);<br>                &#125;<br>                left++;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> length == Integer.MAX_VALUE ? <span class="hljs-string">&quot;&quot;</span> : s.substring(start, start + length);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ¬é¢˜æ˜¯æ»‘åŠ¨çª—å£çš„å…¸å‹é¢˜ç›®ï¼Œä½†æ˜¯æˆ‘å‘ç°ï¼Œ<code>valid</code>åœ¨å­—ç¬¦ä¸²è¾ƒå¤§çš„å®ä¾‹æ€»æ˜¯ä¸èƒ½è‡ªå¢ã€‚</p><p>ä¹Ÿå°±æ˜¯åœ¨14è¡Œå’Œ30è¡Œçš„<code>window.get(c) == need.get(c)</code>åˆ¤æ–­å§‹ç»ˆä¸æˆç«‹</p><h2 id="2-Integeræºç åˆ†æ"><a href="#2-Integeræºç åˆ†æ" class="headerlink" title="2. Integeræºç åˆ†æ"></a>2. Integeræºç åˆ†æ</h2><p>é—®é¢˜å‡ºåœ¨IntegeråŒ…è£…ç±»ä¸Šï¼Œå› ä¸ºæˆ‘ä»¬åœ¨hashmapä¸­åªèƒ½å­˜æ”¾åŒ…è£…ç±»ï¼Œä¼šæŠŠæˆ‘ä»¬putçš„intç±»å‹è‡ªåŠ¨è£…ç®±</p><p>æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹åŒ…è£…ç±»çš„ä»£ç ã€‚</p><p>è‡ªåŠ¨è£…ç®±è°ƒç”¨valueOfæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Integer <span class="hljs-title">valueOf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)<br>        <span class="hljs-keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Integer(i);<br>&#125;<br></code></pre></td></tr></table></figure><p>IntegerCache çš„æºç å¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">private</span> <span class="hljs-built_in">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IntegerCache</span> </span>&#123;<br>    <span class="hljs-built_in">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> low = <span class="hljs-number">-128</span>;<br>    <span class="hljs-built_in">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> high;<br>    <span class="hljs-built_in">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">Integer</span> cache[];<br><br>    <span class="hljs-built_in">static</span> &#123;<br>        <span class="hljs-comment">// high value may be configured by property</span><br>        <span class="hljs-keyword">int</span> h = <span class="hljs-number">127</span>;<br>        <span class="hljs-keyword">String</span> integerCacheHighPropValue =<br>            sun.misc.VM.getSavedProperty(<span class="hljs-string">&quot;java.lang.Integer.IntegerCache.high&quot;</span>);<br>        <span class="hljs-keyword">if</span> (integerCacheHighPropValue != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">int</span> i = parseInt(integerCacheHighPropValue);<br>                i = Math.max(i, <span class="hljs-number">127</span>);<br>                <span class="hljs-comment">// Maximum array size is Integer.MAX_VALUE</span><br>                h = Math.min(i, <span class="hljs-keyword">Integer</span>.MAX_VALUE - (-low) <span class="hljs-number">-1</span>);<br>            &#125; <span class="hljs-keyword">catch</span>( NumberFormatException nfe) &#123;<br>                <span class="hljs-comment">// If the property cannot be parsed into an int, ignore it.</span><br>            &#125;<br>        &#125;<br>        high = h;<br><br>        cache = <span class="hljs-keyword">new</span> <span class="hljs-keyword">Integer</span>[(high - low) + <span class="hljs-number">1</span>];<br>        <span class="hljs-keyword">int</span> j = low;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; cache.length; k++)<br>            cache[k] = <span class="hljs-keyword">new</span> <span class="hljs-keyword">Integer</span>(j++);<br><br>        <span class="hljs-comment">// range [-128, 127] must be interned (JLS7 5.1.7)</span><br>        assert IntegerCache.high &gt;= <span class="hljs-number">127</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> IntegerCache() &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿæºç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œåœ¨[IntegerCache.low, IntegerCache.high]ä¹‹é—´çš„intç±»å‹åœ¨è£…ç®±åæ”¾åœ¨IntegerCache.cacheæ•°ç»„é‡Œé¢çš„ï¼Œæ‰€ä»¥åœ¨æ­¤èŒƒå›´ä¹‹é—´çš„Integerçš„å¼•ç”¨æ˜¯ç›¸åŒçš„ï¼Œæ‰€ä»¥åœ¨[-127, 128]èŒƒå›´<code>==</code>çš„åˆ¤æ–­èƒ½å¤Ÿæˆç«‹ï¼Œè€Œè¶…è¿‡ä¹‹å<code>==</code>åˆ¤æ–­å¤±æ•ˆã€‚</p><p>è¡¥å……ï¼š<strong>Double å’Œ Float æ²¡æœ‰ç¼“å­˜æœºåˆ¶ï¼Œéƒ½æ˜¯ç›´æ¥è¿”å›æ–°çš„å¯¹è±¡ï¼›Integerã€Shortã€Byteã€Character æœ‰ç¼“å­˜æœºåˆ¶</strong></p><h2 id="3-debugä»£ç "><a href="#3-debugä»£ç " class="headerlink" title="3. debugä»£ç "></a>3. debugä»£ç </h2><p>é‚£ä¹ˆæˆ‘ä»¬åªè¦æ‹†ç®±æ¯”è¾ƒå°±å¥½äº†ï¼ŒIntegerè½¬intä½¿ç”¨Integerç±»çš„intValueæ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Solution</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">minWindow</span><span class="hljs-params">(String s, String t)</span> </span>&#123;<br>        Map&lt;Character, Integer&gt; window = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        Map&lt;Character, Integer&gt; need = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; t.length(); i++) need.put(t.charAt(i), need.getOrDefault(t.charAt(i), <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);<br><br>        <span class="hljs-keyword">int</span> left = <span class="hljs-number">0</span>, right = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> valid = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">int</span> start = <span class="hljs-number">0</span>, length = Integer.MAX_VALUE;<br>        <span class="hljs-keyword">while</span>(right &lt; s.length())&#123;<br>            <span class="hljs-keyword">char</span> c = s.charAt(right);<br>            <span class="hljs-keyword">if</span>(need.containsKey(c))&#123;<br>                window.put(c, window.getOrDefault(c, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>);<br>                <span class="hljs-comment">// debug</span><br>                <span class="hljs-keyword">if</span>(need.get(c).intValue() == window.get(c).intValue())&#123;<br>                    valid++;<br>                &#125; <br>            &#125;<br>            right++;<br><br>            <span class="hljs-keyword">while</span>(valid == need.size())&#123;<br>                <br>                <span class="hljs-keyword">if</span>(right - left &lt; length)&#123;<br>                    start = left;<br>                    length = right - left;<br>                &#125;<br><br>                c = s.charAt(left);<br>                <span class="hljs-keyword">if</span>(need.containsKey(c))&#123;<br>                    <span class="hljs-comment">// debug</span><br>                    <span class="hljs-keyword">if</span>(window.get(c).intValue() == need.get(c).intValue())&#123;<br>                        valid--;<br>                    &#125; <br>                    window.put(c, window.get(c) - <span class="hljs-number">1</span>);<br>                &#125;<br>                left++;<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> length == Integer.MAX_VALUE ? <span class="hljs-string">&quot;&quot;</span> : s.substring(start, start + length);<br><br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-ç›¸å…³ç»å…¸ç¬”è¯•é¢˜"><a href="#4-ç›¸å…³ç»å…¸ç¬”è¯•é¢˜" class="headerlink" title="4. ç›¸å…³ç»å…¸ç¬”è¯•é¢˜"></a>4. ç›¸å…³ç»å…¸ç¬”è¯•é¢˜</h2><p>è¿™é‡Œå‚è€ƒäº†<a href="https://blog.csdn.net/babycan5/article/details/81942230">å¸–å­</a><sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://blog.csdn.net/babycan5/article/details/81942230">[1]</span></a></sup></p><h3 id="ç¬¬ä¸€é¢˜"><a href="#ç¬¬ä¸€é¢˜" class="headerlink" title="ç¬¬ä¸€é¢˜"></a>ç¬¬ä¸€é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer a = <span class="hljs-number">10</span>;<br>Integer b = <span class="hljs-number">20</span>;<br>Integer c = <span class="hljs-number">30</span>;<br>Integer d = <span class="hljs-number">30</span>;<br>Integer e = <span class="hljs-number">300</span>;<br>Integer f = <span class="hljs-number">300</span>;<br>Integer g = a + b;<br><br>c == d;<br>e == f;<br>c == g;<br>c == (a + b);<br>c.equals(a + b);<br></code></pre></td></tr></table></figure><p>ç»“æœï¼štrueã€falseã€trueã€trueã€true</p><p><strong>ç¬¬ä¸‰ä¸ª</strong>ï¼šç”±äºè¿ç”¨äº†ç®—æœ¯è¿ç®—ç¬¦(+)ï¼Œå› æ­¤å³è¾¹çš„ç®—å¼åœ¨è¿›è¡Œè®¡ç®—ä¹‹å‰ä¼šå…ˆè°ƒç”¨ intVal() æ–¹æ³•è¿›è¡Œæ‹†ç®±ï¼Œåœ¨è¿›è¡Œç›¸åŠ ï¼Œç„¶åå¾—åˆ°çš„ç»“æœ30ä¹‹åï¼Œç”±äºå‰é¢æ˜¯ Integer gï¼Œå› æ­¤è¿˜ä¼šå†è°ƒç”¨ valueOf() æ–¹æ³•è¿›è¡Œè£…ç®±ã€‚ç”±äºæ­¤æ—¶ cache() æ•°ç»„ä¸­å·²ç»æœ‰äº† 30 äº†ï¼Œå› æ­¤ç›´æ¥æŒ‡å‘ç¼“å­˜æ± ä¸­çš„ 30 è¿™ä¸ª Integer å¯¹è±¡ã€‚æ­¤æ—¶ c == g æ¯”è¾ƒçš„è¿˜æ˜¯å¯¹è±¡çš„åœ°å€æ˜¯å¦ç›¸åŒ</p><p><strong>ç¬¬å››ä¸ª</strong>ï¼šç”±äºå³è¾¹æ˜¯ a+bï¼ŒåŒ…å«ç®—æœ¯è¿ç®—ï¼Œå› æ­¤ä¼šè°ƒç”¨ intVal() æ–¹æ³•ï¼Œå°†å·¦è¾¹çš„ c è¿›è¡Œæ‹†ç®±ï¼Œä¹‹ååˆåˆ†åˆ«å¯¹ a å’Œ b è¿›è¡Œæ‹†ç®±ï¼Œå³ä¸€å…±è°ƒç”¨äº†ä¸‰æ¬¡æ‹†ç®±è¿‡ç¨‹ï¼Œ<strong>æœ€åæ¯”è¾ƒçš„æ˜¯æ•°å€¼å¤§å°ï¼Œè€Œä¸æ˜¯åœ°å€</strong></p><p><strong>ç¬¬äº”ä¸ª</strong>ï¼šé€šè¿‡ equals çš„æºç çœ‹åˆ°ï¼Œä¼ å…¥çš„å‚æ•°éœ€è¦æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå’Œ equals æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¸€å®šæ˜¯è£…å®Œç®±ä¹‹åçš„ç»“æœa + b çš„æ—¶å€™ï¼Œa å’Œ b å„è‡ªæ‰§è¡Œ intVal() æ–¹æ³•è¿›è¡Œæ‹†ç®±ï¼Œå®Œæˆç›¸åŠ çš„è®¡ç®—ä¹‹åï¼Œå†å¯¹è®¡ç®—å‡ºçš„ç»“æœæ‰§è¡Œ valueOf() æ–¹æ³•è¿›è¡Œè£…ç®±ï¼Œæ­¤æ—¶å†ä¼ å…¥ equals æ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚equals æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œç›´æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼æ‹†ç®±ä¹‹åçš„ç»“æœï¼Œå³æ¯”è¾ƒçš„æ˜¯æ•°å€¼ï¼Œæœ¬ä¾‹ä¸­ä¸¤ä¸ªæ•°å€¼ç›¸åŒï¼Œæ‰€ä»¥è¾“å‡ºä¸º true</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object obj)</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> Integer) &#123;<br>        <span class="hljs-keyword">return</span> value == ((Integer)obj).intValue();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ç¬¬äºŒé¢˜"><a href="#ç¬¬äºŒé¢˜" class="headerlink" title="ç¬¬äºŒé¢˜"></a>ç¬¬äºŒé¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Integer a = <span class="hljs-number">10</span>;<br>Integer b = <span class="hljs-number">20</span>;<br>Long g = <span class="hljs-number">30L</span>;<br>Long h = <span class="hljs-number">20L</span>;<br><br>g == (a + b);<br>g.equals(a + b);<br>g.equals(a + h);<br></code></pre></td></tr></table></figure><p>ç»“æœï¼štrueã€falseã€true</p><p>å’Œä¸Šé¢ä¸€æ ·ï¼ŒåŒæ ·æ˜¯ä½¿ç”¨æ‹†ç®±ï¼Œç¬¬ä¸€é¢˜æ¯”è¾ƒçš„æ‹†å®Œç®±ä¹‹åçš„å€¼ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒInteger ç±»å‹è°ƒç”¨ Integer.valueOf è¿›è¡Œæ‹†ç®±ï¼Œè€Œ Long ç±»å‹è°ƒç”¨ Long.valueOf è¿›è¡Œæ‹†ç®±</p><p>æœ€åä¸€ä¸ªç»“æœæ˜¯ trueï¼Œå› ä¸º a + h ä¼šä½¿å°çš„ç²¾åº¦è½¬ä¸ºå¤§çš„ç²¾åº¦ï¼Œæœ€ç»ˆçš„ 30 æ˜¯ Long ç±»å‹çš„ï¼Œå› æ­¤ç»“æœæ˜¯ true</p><h3 id="ç¬¬ä¸‰é¢˜"><a href="#ç¬¬ä¸‰é¢˜" class="headerlink" title="ç¬¬ä¸‰é¢˜"></a>ç¬¬ä¸‰é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Double i1 = <span class="hljs-number">100.0</span>;<br>Double i2 = <span class="hljs-number">100.0</span>;<br>Double i3 = <span class="hljs-number">200.0</span>;<br>Double i4 = <span class="hljs-number">200.0</span>;<br><br>i1 == i2<br>i3 == i4<br></code></pre></td></tr></table></figure><p>ç»“æœï¼šfalseã€false</p><p>Doubleæ²¡æœ‰ç¼“å­˜æœºåˆ¶</p><h3 id="ç¬¬å››é¢˜"><a href="#ç¬¬å››é¢˜" class="headerlink" title="ç¬¬å››é¢˜"></a>ç¬¬å››é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Boolean b1 = <span class="hljs-keyword">false</span>;<br>Boolean b2 = <span class="hljs-keyword">false</span>;<br>Boolean b3 = <span class="hljs-keyword">true</span>;<br>Boolean b4 = <span class="hljs-keyword">true</span>;<br><br>b1 == b2<br>b3 == b4<br>b1 == b3<br></code></pre></td></tr></table></figure><p>ç»“æœï¼štrueã€trueã€false</p><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿçœ‹ä¸€ä¸‹ Boolean çš„ valueOf() çš„æºä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Boolean <span class="hljs-title">valueOf</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> b)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> (b ? TRUE : FALSE);<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­çš„ TRUE å’Œ FALSEï¼Œä»£è¡¨ä¸¤ä¸ªé™æ€æˆå‘˜å±æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean TRUE = <span class="hljs-keyword">new</span> Boolean(<span class="hljs-keyword">true</span>);<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Boolean FALSE = <span class="hljs-keyword">new</span> Boolean(<span class="hljs-keyword">false</span>);<br></code></pre></td></tr></table></figure><p>å› æ­¤å¯ä»¥çŸ¥é“äº†ï¼Œæ¯æ¬¡ä¼ å…¥çš„ true æˆ– falseï¼Œéƒ½æ˜¯æŒ‡å‘åŒä¸€ä¸ª Boolean å¯¹è±¡ï¼Œå› æ­¤ä»–ä»¬çš„å¼•ç”¨è‚¯å®šç›¸åŒäº†</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://blog.csdn.net/babycan5/article/details/81942230">https://blog.csdn.net/babycan5/article/details/81942230</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span>leetcode No.76<a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>åŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å¸¸è§æ”»å‡»HTTPåè®®çš„äº”å¤§æ–¹å¼</title>
    <link href="/2021/03/28/HTTP%E5%B8%B8%E8%A7%81%E7%9A%84%E6%94%BB%E5%87%BB%E6%89%8B%E6%AE%B5/"/>
    <url>/2021/03/28/HTTP%E5%B8%B8%E8%A7%81%E7%9A%84%E6%94%BB%E5%87%BB%E6%89%8B%E6%AE%B5/</url>
    
    <content type="html"><![CDATA[<h1 id="å¸¸è§æ”»å‡»HTTPåè®®çš„äº”å¤§æ–¹å¼"><a href="#å¸¸è§æ”»å‡»HTTPåè®®çš„äº”å¤§æ–¹å¼" class="headerlink" title="å¸¸è§æ”»å‡»HTTPåè®®çš„äº”å¤§æ–¹å¼"></a>å¸¸è§æ”»å‡»HTTPåè®®çš„äº”å¤§æ–¹å¼</h1><p><strong>httpåè®®</strong>ä»è¯ç”Ÿè‡³ä»Šä¼´éšç€äº’è”ç½‘èµ°è¿‡äº†ç›¸å½“é•¿çš„å²æœˆï¼Œå°±åœ¨å½“ä¸‹ï¼Œhttpåè®®ä¾æ—§æ˜¯æ­å»ºç½‘ç«™çš„ä¸»æµåè®®ã€‚httpåè®®çš„å­˜åœ¨æœ‰å…¶ç‰¹å®šçš„å†å²æ„ä¹‰ï¼Œä½†æ˜¯é¢å¯¹å¦‚ä»Šæ—¥ç›Šä¸¥å³»çš„å®‰å…¨é—®é¢˜ï¼Œhttpåè®®çš„ä¸å®‰å…¨æ€§ä¹Ÿè¶Šå‘æš´éœ²ï¼Œä¸‹é¢åˆ—ä¸¾å¸¸è§çš„æ”»å‡»httpåè®®çš„äº”å¤§æ–¹å¼ã€‚</p><h2 id="ä¸€-è·¨ç«™è„šæœ¬æ”»å‡»-XSS"><a href="#ä¸€-è·¨ç«™è„šæœ¬æ”»å‡»-XSS" class="headerlink" title="ä¸€.è·¨ç«™è„šæœ¬æ”»å‡»(XSS)"></a>ä¸€.è·¨ç«™è„šæœ¬æ”»å‡»(XSS)</h2><p>è·¨ç«™è„šæœ¬æ”»å‡»(XSSï¼ŒCross-site scripting)æ˜¯æœ€å¸¸è§å’ŒåŸºæœ¬çš„æ”»å‡»WEBç½‘ç«™çš„æ–¹æ³•ã€‚æ”»å‡»è€…åœ¨ç½‘é¡µä¸Šå‘å¸ƒåŒ…å«æ”»å‡»æ€§ä»£ç çš„æ•°æ®ã€‚å½“æµè§ˆè€…çœ‹åˆ°æ­¤ç½‘é¡µæ—¶ï¼Œç‰¹å®šçš„è„šæœ¬å°±ä¼šä»¥æµè§ˆè€…ç”¨æˆ·çš„èº«ä»½å’Œæƒé™æ¥æ‰§è¡Œã€‚é€šè¿‡XSSå¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°ä¿®æ”¹ç”¨æˆ·æ•°æ®ã€çªƒå–ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠé€ æˆå…¶å®ƒç±»å‹çš„æ”»å‡»ï¼Œä¾‹å¦‚CSRFæ”»å‡»ã€‚</p><h2 id="äºŒ-è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»-CSRF"><a href="#äºŒ-è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»-CSRF" class="headerlink" title="äºŒ. è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»(CSRF)"></a>äºŒ. è·¨ç«™è¯·æ±‚ä¼ªé€ æ”»å‡»(CSRF)</h2><p>è·¨ç«™è¯·æ±‚ä¼ªé€ (CSRFï¼ŒCross-site request forgery)æ˜¯å¦ä¸€ç§å¸¸è§çš„æ”»å‡»ã€‚æ”»å‡»è€…é€šè¿‡å„ç§æ–¹æ³•ä¼ªé€ ä¸€ä¸ªè¯·æ±‚ï¼Œæ¨¡ä»¿ç”¨æˆ·æäº¤è¡¨å•çš„è¡Œä¸ºï¼Œä»è€Œè¾¾åˆ°ä¿®æ”¹ç”¨æˆ·çš„æ•°æ®ï¼Œæˆ–è€…æ‰§è¡Œç‰¹å®šä»»åŠ¡çš„ç›®çš„ã€‚ä¸ºäº†å‡å†’ç”¨æˆ·çš„èº«ä»½ï¼ŒCSRFæ”»å‡»å¸¸å¸¸å’ŒXSSæ”»å‡»é…åˆèµ·æ¥åšï¼Œä½†ä¹Ÿå¯ä»¥é€šè¿‡å…¶å®ƒæ‰‹æ®µï¼Œä¾‹å¦‚è¯±ä½¿ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªåŒ…å«æ”»å‡»çš„é“¾æ¥ã€‚</p><h2 id="ä¸‰-Http-Headsæ”»å‡»"><a href="#ä¸‰-Http-Headsæ”»å‡»" class="headerlink" title="ä¸‰.Http Headsæ”»å‡»"></a>ä¸‰.Http Headsæ”»å‡»</h2><p>å‡¡æ˜¯ç”¨æµè§ˆå™¨æŸ¥çœ‹ä»»ä½•WEBç½‘ç«™ï¼Œæ— è®ºä½ çš„WEBç½‘ç«™é‡‡ç”¨ä½•ç§æŠ€æœ¯å’Œæ¡†æ¶ï¼Œéƒ½ç”¨åˆ°äº†HTTPåè®®.HTTPåè®®åœ¨Response headerå’Œcontentä¹‹é—´ï¼Œæœ‰ä¸€ä¸ªç©ºè¡Œï¼Œå³ä¸¤ç»„CRLF(0x0D 0A)å­—ç¬¦ã€‚è¿™ä¸ªç©ºè¡Œæ ‡å¿—ç€headersçš„ç»“æŸå’Œcontentçš„å¼€å§‹ã€‚â€œèªæ˜â€çš„æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚åªè¦æ”»å‡»è€…æœ‰åŠæ³•å°†ä»»æ„å­—ç¬¦â€œæ³¨å…¥â€åˆ°headersä¸­ï¼Œè¿™ç§æ”»å‡»å°±å¯ä»¥å‘ç”Ÿã€‚</p><p>ä»¥ç™»é™†ä¸ºä¾‹:æœ‰è¿™æ ·ä¸€ä¸ªurl:</p><p><a href="http://localhost/login?page=http://localhost/index">http://localhost/login?page=http%3A%2F%2Flocalhost%2Findex</a></p><p>å½“ç™»å½•æˆåŠŸä»¥åï¼Œéœ€è¦é‡å®šå‘å›pageå‚æ•°æ‰€æŒ‡å®šçš„é¡µé¢ã€‚ä¸‹é¢æ˜¯é‡å®šå‘å‘ç”Ÿæ—¶çš„response headers.</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">302</span> Moved Temporarily<br><br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 17 Aug 2010 20:00:29 GMT<br><br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>Apache mod_fcgid/2.3.5 mod_auth_passthrough/2.1 mod_bwlimited/1.4 FrontPage/5.0.2.2635<br><br><span class="hljs-attribute">Location</span><span class="hljs-punctuation">: </span>http://localhost/index<br></code></pre></td></tr></table></figure><p>å‡å¦‚æŠŠURLä¿®æ”¹ä¸€ä¸‹ï¼Œå˜æˆè¿™ä¸ªæ ·å­ï¼š</p><p><a href="http://localhost/login?page=http://localhost/checkout%0D%0A%0D%0A%3Cscript%3Ealert(%27hello%27)%3C/script%3E">http://localhost/login?page=http%3A%2F%2Flocalhost%2Fcheckout%0D%0A%0D%0A%3Cscript%3Ealert%28%27hello%27%29%3C%2Fscript%3E</a></p><p>é‚£ä¹ˆé‡å®šå‘å‘ç”Ÿæ—¶çš„reponseä¼šå˜æˆä¸‹é¢çš„æ ·å­ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">302</span> Moved Temporarily<br><br><span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Tue, 17 Aug 2010 20:00:29 GMT<br><br><span class="hljs-attribute">Server</span><span class="hljs-punctuation">: </span>Apache mod_fcgid/2.3.5 mod_auth_passthrough/2.1 mod_bwlimited/1.4 FrontPage/5.0.2.2635<br><br><span class="hljs-attribute">Location</span><span class="hljs-punctuation">: </span>http://localhost/checkout<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªé¡µé¢å¯èƒ½ä¼šæ„å¤–åœ°æ‰§è¡Œéšè—åœ¨URLä¸­çš„javascriptã€‚ç±»ä¼¼çš„æƒ…å†µä¸ä»…å‘ç”Ÿåœ¨é‡å®šå‘(Location header)ä¸Šï¼Œä¹Ÿæœ‰å¯èƒ½å‘ç”Ÿåœ¨å…¶å®ƒheadersä¸­ï¼Œå¦‚Set-Cookie headerã€‚è¿™ç§æ”»å‡»å¦‚æœæˆåŠŸçš„è¯ï¼Œå¯ä»¥åšå¾ˆå¤šäº‹ï¼Œä¾‹å¦‚ï¼šæ‰§è¡Œè„šæœ¬ã€è®¾ç½®é¢å¤–çš„cookie(Set-Cookie: evil=value)ç­‰ã€‚</p><h2 id="å››-Cookieæ”»å‡»"><a href="#å››-Cookieæ”»å‡»" class="headerlink" title="å››.Cookieæ”»å‡»"></a>å››.Cookieæ”»å‡»</h2><p>é€šè¿‡Java Scriptéå¸¸å®¹æ˜“è®¿é—®åˆ°å½“å‰ç½‘ç«™çš„cookieã€‚ä½ å¯ä»¥æ‰“å¼€ä»»ä½•ç½‘ç«™ï¼Œç„¶ååœ¨æµè§ˆå™¨åœ°å€æ ä¸­è¾“å…¥ï¼šjavascript:alert(doucment.cookie),ç«‹åˆ»å°±å¯ä»¥çœ‹åˆ°å½“å‰ç«™ç‚¹çš„cookie(å¦‚æœæœ‰çš„è¯)ã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹æ€§æ¥å–å¾—ä½ çš„å…³é”®ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå’ŒXSSæ”»å‡»ç›¸é…åˆï¼Œæ”»å‡»è€…åœ¨ä½ çš„æµè§ˆå™¨ä¸Šæ‰§è¡Œç‰¹å®šçš„Java Scriptè„šæœ¬ï¼Œå–å¾—ä½ çš„cookieã€‚å‡è®¾è¿™ä¸ªç½‘ç«™ä»…ä¾èµ–cookieæ¥éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥å‡å†’ä½ çš„èº«ä»½æ¥åšä¸€äº›äº‹æƒ…ã€‚</p><h2 id="äº”-é‡å®šå‘æ”»å‡»"><a href="#äº”-é‡å®šå‘æ”»å‡»" class="headerlink" title="äº”.é‡å®šå‘æ”»å‡»"></a>äº”.é‡å®šå‘æ”»å‡»</h2><p>æœ€å¸¸ç”¨çš„æ”»å‡»æ‰‹æ®µå°±æ˜¯â€œé’“é±¼â€ã€‚é’“é±¼æ”»å‡»è€…ï¼Œé€šå¸¸ä¼šå‘é€ç»™å—å®³è€…ä¸€ä¸ªåˆæ³•é“¾æ¥ï¼Œå½“é“¾æ¥è¢«ç‚¹å‡»æ—¶ï¼Œç”¨æˆ·è¢«å¯¼å‘ä¸€ä¸ªä¼¼æ˜¯è€Œéçš„éæ³•ç½‘ç«™ï¼Œä»è€Œè¾¾åˆ°éª—å–ç”¨æˆ·ä¿¡ä»»ã€çªƒå–ç”¨æˆ·èµ„æ–™çš„ç›®çš„ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>è½¬è½½è‡ªï¼š<a href="https://freessl.wosign.com/1336.html">https://freessl.wosign.com/1336.html</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>CS</category>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CS</tag>
      
      <tag>Network</tag>
      
      <tag>HTTP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SSLçš„åŠ å¯†è¿‡ç¨‹</title>
    <link href="/2021/03/28/SSL%E7%9A%84%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B/"/>
    <url>/2021/03/28/SSL%E7%9A%84%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="SSLçš„åŠ å¯†è¿‡ç¨‹"><a href="#SSLçš„åŠ å¯†è¿‡ç¨‹" class="headerlink" title="SSLçš„åŠ å¯†è¿‡ç¨‹"></a>SSLçš„åŠ å¯†è¿‡ç¨‹</h1><blockquote><p><strong>SSL</strong>ï¼ˆSecure Socket Layerï¼‰å®‰å…¨å¥—æ¥å­—å±‚ï¼š</p><p>SSLé€šè¿‡é‡‡ç”¨æœºå¯†æ€§ã€æ•°æ®å®Œæ•´æ€§ã€æœåŠ¡å™¨é‰´åˆ«å’Œå®¢æˆ·é‰´åˆ«æ¥å¼ºåŒ–TCPï¼Œç»å¸¸ç”¨æ¥ä¸ºå‘ç”Ÿåœ¨HTTPä¹‹ä¸Šçš„äº‹åŠ¡æä¾›å®‰å…¨æ€§ã€‚<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼Œç¬¬8ç« ï¼Œä½¿TCPè¿æ¥å®‰å…¨ï¼šSSL">[1]</span></a></sup></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSL_1_20210328.jpg"></p><p><strong>HTTP + SSL = HTTPS</strong></p><h2 id="1-åŠ å¯†æ–¹æ³•"><a href="#1-åŠ å¯†æ–¹æ³•" class="headerlink" title="1. åŠ å¯†æ–¹æ³•"></a>1. åŠ å¯†æ–¹æ³•</h2><ul><li>å¯¹ç§°åŠ å¯†</li><li>éå¯¹ç§°åŠ å¯†</li></ul><h2 id="2-å…¬é’¥è®¤è¯"><a href="#2-å…¬é’¥è®¤è¯" class="headerlink" title="2. å…¬é’¥è®¤è¯"></a>2. å…¬é’¥è®¤è¯</h2><p>éå¯¹ç§°åŠ å¯†ä¸èƒ½ä¿è¯ä½ è·å¾—çš„å…¬é’¥æ˜¯å¦æ˜¯ä½ è¦è¿›è¡Œé€šä¿¡çš„å®ä½“çš„å…¬é’¥ã€‚</p><p>äºæ˜¯æœ‰äº†<strong>æ•°å­—è¯ä¹¦</strong>çš„æ¦‚å¿µï¼š</p><blockquote><p>æ•°å­—è¯ä¹¦å°±æ˜¯äº’è”ç½‘é€šè®¯ä¸­æ ‡å¿—é€šè®¯å„æ–¹èº«ä»½ä¿¡æ¯çš„ä¸€ä¸²æ•°å­—ï¼Œæä¾›äº†ä¸€ç§åœ¨Internetä¸ŠéªŒè¯é€šä¿¡å®ä½“èº«ä»½çš„æ–¹å¼ï¼Œæ•°å­—è¯ä¹¦ä¸æ˜¯<a href="https://baike.baidu.com/item/%E6%95%B0%E5%AD%97%E8%BA%AB%E4%BB%BD%E8%AF%81">æ•°å­—èº«ä»½è¯</a>ï¼Œè€Œæ˜¯èº«ä»½è®¤è¯æœºæ„ç›–åœ¨æ•°å­—èº«ä»½è¯ä¸Šçš„ä¸€ä¸ªç« æˆ–å°ï¼ˆæˆ–è€…è¯´åŠ åœ¨æ•°å­—èº«ä»½è¯ä¸Šçš„ä¸€ä¸ªç­¾åï¼‰</p></blockquote><p>æ•°å­—è¯ä¹¦å†…å®¹å¤§ä½“å¦‚ä¸‹ï¼š</p><ul><li>ç­¾å‘è¯ä¹¦çš„æœºæ„;</li><li>é²å‹ƒçš„åŠ å¯†ç®—æ³•;</li><li>é²å‹ƒæ‰€ä½¿ç”¨çš„Hashç®—æ³•;</li><li>é²å‹ƒçš„å…¬é’¥;</li><li>è¯ä¹¦åˆ°æœŸæ—¶é—´;</li><li>ç­‰ç­‰;</li></ul><p>æ•°å­—è¯ä¹¦æ˜¯ç”±æƒå¨æœºæ„â€”â€”CAæœºæ„ç»Ÿä¸€æ¥è¿›è¡Œå‘è¡Œï¼Œæˆ‘ä»¬ç»å¯¹ä¿¡ä»»è¿™ä¸ªæœºæ„ï¼Œè‡³äºCAæœºæ„çš„å®‰å…¨æ€§â€¦åæ­£99.99%ä¹‹ä¸‹éƒ½æ˜¯å®‰å…¨çš„ã€‚ğŸ•µ</p><p>ä¸ºäº†é˜²æ­¢ä¸­é—´æœ‰äººå¯¹è¯ä¹¦å†…å®¹è¿›è¡Œæ›´æ”¹ï¼Œæœ‰äº†ä¸€ä¸ª<strong>æ•°å­—ç­¾å</strong>çš„æ¦‚å¿µï¼Œæ‰€è°“çš„æ•°å­—ç­¾åå°±æ˜¯æŠŠä»¥ä¸Šæ‰€æœ‰çš„å†…å®¹åšä¸€ä¸ªHashæ“ä½œï¼Œå¾—åˆ°ä¸€ä¸ªå›ºå®šé•¿åº¦ç„¶åå†ä¼ ç»™é²å‹ƒã€‚ç„¶è€Œå¦‚æœåˆ«äººæˆªå–äº†è¿™ä¸ªè¯ä¹¦ç„¶åæ›´æ”¹å†…å®¹ï¼ŒåŒæ—¶ç”Ÿæˆäº†æ–°çš„Hashå€¼é‚£æ€ä¹ˆåŠï¼Ÿå¤„äºè¿™ä¸ªè€ƒè™‘ï¼ŒCAæœºæ„åœ¨é¢å‘è¿™ä¸ªè¯ä¹¦çš„æ—¶å€™ä¼šç”¨è‡ªå·±çš„ç§é’¥å°†Hashå€¼åŠ å¯†ï¼Œä»è€Œé˜²æ­¢äº†æ•°å­—è¯ä¹¦è¢«ç¯¡æ”¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSL_2_20210328.jpg"></p><h2 id="3-SSLæ¡æ‰‹è¿‡ç¨‹"><a href="#3-SSLæ¡æ‰‹è¿‡ç¨‹" class="headerlink" title="3. SSLæ¡æ‰‹è¿‡ç¨‹"></a>3. SSLæ¡æ‰‹è¿‡ç¨‹</h2><p>å…ˆç”¨è¯­è¨€æ¥é˜è¿°ä¸‹ï¼š</p><ol><li><strong>ç¬¬ä¸€æ­¥</strong>ï¼šçˆ±ä¸½ä¸ç»™å‡ºæ”¯æŒSSLåè®®ç‰ˆæœ¬å·ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯<strong>éšæœºæ•°</strong>ï¼ˆä¸é‡æ•°ï¼‰(Client randomï¼Œè¯·æ³¨æ„è¿™æ˜¯ç¬¬ä¸€ä¸ªéšæœºæ•°)ï¼Œå®¢æˆ·ç«¯æ”¯æŒçš„åŠ å¯†æ–¹æ³•ç­‰ä¿¡æ¯ï¼›</li><li><strong>ç¬¬äºŒæ­¥ï¼š</strong>é²å‹ƒæ”¶åˆ°ä¿¡æ¯åï¼Œç¡®è®¤åŒæ–¹ä½¿ç”¨çš„åŠ å¯†æ–¹æ³•ï¼Œå¹¶è¿”å›æ•°å­—è¯ä¹¦ï¼Œä¸€ä¸ªæœåŠ¡å™¨ç”Ÿæˆçš„<strong>éšæœºæ•°</strong>(Server randomï¼Œæ³¨æ„è¿™æ˜¯ç¬¬äºŒä¸ªéšæœºæ•°)ç­‰ä¿¡æ¯ï¼›</li><li><strong>ç¬¬ä¸‰æ­¥ï¼š</strong>çˆ±ä¸½ä¸ç¡®è®¤æ•°å­—è¯ä¹¦çš„æœ‰æ•ˆæ€§ï¼Œç„¶åç”Ÿæˆä¸€ä¸ªæ–°çš„<strong>éšæœºæ•°</strong>ï¼ˆä¸é‡æ•°ï¼‰(Premaster secret)ï¼Œç„¶åä½¿ç”¨æ•°å­—è¯ä¹¦ä¸­çš„å…¬é’¥ï¼ŒåŠ å¯†è¿™ä¸ªéšæœºæ•°ï¼Œå‘ç»™é²å‹ƒã€‚</li><li><strong>ç¬¬å››æ­¥ï¼š</strong>é²å‹ƒä½¿ç”¨è‡ªå·±çš„ç§é’¥ï¼Œè·å–çˆ±ä¸½ä¸å‘æ¥çš„<strong>éšæœºæ•°</strong>ï¼ˆä¸é‡æ•°ï¼‰(å³Premaster secret)ï¼›(ç¬¬ä¸‰ã€å››æ­¥å°±æ˜¯éå¯¹ç§°åŠ å¯†çš„è¿‡ç¨‹äº†)</li><li><strong>ç¬¬äº”æ­¥ï¼š</strong>çˆ±ä¸½ä¸å’Œé²å‹ƒé€šè¿‡çº¦å®šçš„åŠ å¯†æ–¹æ³•(é€šå¸¸æ˜¯<a href="https://zh.wikipedia.org/wiki/%E9%AB%98%E7%BA%A7%E5%8A%A0%E5%AF%86%E6%A0%87%E5%87%86">AESç®—æ³•</a>)ï¼Œä½¿ç”¨å‰é¢ä¸‰ä¸ªéšæœºæ•°ï¼Œç”Ÿæˆ<strong>å¯¹è¯å¯†é’¥</strong>ï¼ˆMaster Secretï¼ŒMSï¼‰ï¼ŒMSè¢«åˆ‡ç‰‡ä»¥ç”Ÿæˆä¸¤ä¸ªå¯†ç å’Œä¸¤ä¸ªMACå¯†é’¥ã€‚ç”¨æ¥åŠ å¯†æ¥ä¸‹æ¥çš„é€šä¿¡å†…å®¹ï¼›</li><li><strong>æœ€å</strong>ï¼ˆè¡¥å……ï¼‰ï¼šAliceå‘é€æ‰€æœ‰æ¡æ‰‹æŠ¥æ–‡çš„ä¸€ä¸ªMACï¼›Bobå‘é€æ‰€æœ‰æ¡æ‰‹æŠ¥æ–‡çš„ä¸€ä¸ªMACã€‚ï¼ˆç›®çš„æ˜¯é˜²æ­¢ç¬¬ä¸€æ­¥ä¸­æ”¯æŒåŠ å¯†æ–¹æ³•åˆ—è¡¨æ˜¯æ˜æ–‡å‘é€ï¼Œå®¹æ˜“è¢«åˆ é™¤è¾ƒå¼ºç®—æ³•ï¼Œå¼ºåˆ¶é€‰æ‹©è¾ƒå¼±ç®—æ³•ï¼Œé€šè¿‡æœ€åçš„MACçš„ä¸€è‡´æ€§æ¯”è¾ƒæ£€æŸ¥æ˜¯å¦è¢«ç¯¡æ”¹ã€‚ï¼‰</li></ol><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/SSL_3_20210328.png"></p><p>SSLä¸­ï¼š</p><ul><li>ä¸é‡æ•°ï¼šç”¨äºé˜²å¾¡â€œè¿ç»­é‡æ”¾â€ã€‚<ul><li>é¢„é˜²ç¤ºä¾‹ï¼šTrudyç¬¬äºŒå¤©å†’å……Aliceå‘Bobå‘é€å‰ä¸€å¤©Aliceå‘Bobå‘é€çš„ç›¸åŒæŠ¥æ–‡åºåˆ—</li></ul></li><li>åºå·<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼Œç¬¬8ç« ï¼Œä½¿TCPè¿æ¥å®‰å…¨ï¼šSSL">[1]</span></a></sup>ï¼šç”¨äºé˜²å¾¡åœ¨ä¸€ä¸ªè¿›è¡Œä¸­çš„ä¼šè¯ä¸­é‡æ”¾ä¸ªåˆ«åˆ†ç»„ã€‚<ul><li>é¢„é˜²ç¤ºä¾‹ï¼šTrudyä¿˜è·ä¸­é—´çš„ä¸¤ä¸ªæŠ¥æ–‡æ®µï¼Œé¢ å€’æ¬¡åºï¼Œè°ƒæ¢TCPæŠ¥æ–‡æ®µçš„åºå·ï¼ˆæœªè¢«åŠ å¯†ï¼‰</li><li>åºå·åŒ…æ‹¬åœ¨äº†MACçš„è®¡ç®—ä¸­ï¼šMACæ˜¯ ï¼ˆæ•°æ®+MACå¯†é’¥+å½“å‰åºå·ï¼‰çš„æ•£åˆ—</li></ul></li></ul><h2 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4. æ€»ç»“"></a>4. æ€»ç»“</h2><p>æ•´ä¸ªè¿›è¡Œæ•°æ®åŠ å¯†çš„è¿‡ç¨‹ç»“æŸï¼š</p><ul><li>CAæœºæ„é¢å‘æ•°å­—è¯ä¹¦ç»™é²å‹ƒï¼›</li><li>çˆ±ä¸½ä¸å’Œé²å‹ƒè¿›è¡ŒSSLæ¡æ‰‹ï¼Œçˆ±ä¸½ä¸é€šè¿‡æ•°å­—è¯ä¹¦ç¡®å®šé²å‹ƒçš„èº«ä»½ï¼›</li><li>çˆ±ä¸½ä¸å’Œé²å‹ƒä¼ é€’ä¸‰ä¸ªéšæœºæ•°ï¼Œç¬¬ä¸‰ä¸ªéšæœºæ•°é€šè¿‡éå¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡Œä¼ é€’ï¼›</li><li>çˆ±ä¸½ä¸å’Œé²å‹ƒé€šè¿‡ä¸€ä¸ªå¯¹ç§°åŠ å¯†ç®—æ³•ç”Ÿæˆä¸€ä¸ªå¯¹è¯å¯†é’¥ï¼ŒåŠ å¯†æ¥ä¸‹æ¥çš„é€šä¿¡å†…å®¹ã€‚</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>è®¡ç®—æœºç½‘ç»œè‡ªé¡¶å‘ä¸‹æ–¹æ³•ï¼Œç¬¬8ç« ï¼Œä½¿TCPè¿æ¥å®‰å…¨ï¼šSSL<a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://blog.damonare.cn/2017/12/29/SSL%E5%8D%8F%E8%AE%AE%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/#more">https://blog.damonare.cn/2017/12/29/SSL%E5%8D%8F%E8%AE%AE%E4%B9%8B%E6%95%B0%E6%8D%AE%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B%E8%AF%A6%E8%A7%A3/#more</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>CS</category>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CS</tag>
      
      <tag>Network</tag>
      
      <tag>HTTPS</tag>
      
      <tag>SSL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ</title>
    <link href="/2021/03/28/Redis%E9%9B%86%E7%BE%A4%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"/>
    <url>/2021/03/28/Redis%E9%9B%86%E7%BE%A4%E4%B8%8E%E4%BC%81%E4%B8%9A%E7%BA%A7%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    
    <content type="html"><![CDATA[<h1 id="Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"><a href="#Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"></a>Redisé›†ç¾¤ä¸ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ</h1><p>åŸºäº<a href="https://www.bilibili.com/video/BV1CJ411m7Gc">é»‘é©¬Redis</a>çš„è§†é¢‘çš„å­¦ä¹ ç¬”è®°</p><h2 id="1-ä¸»ä»å¤åˆ¶"><a href="#1-ä¸»ä»å¤åˆ¶" class="headerlink" title="1. ä¸»ä»å¤åˆ¶"></a>1. ä¸»ä»å¤åˆ¶</h2><h3 id="1-1-ä¸»ä»å¤åˆ¶ç®€ä»‹"><a href="#1-1-ä¸»ä»å¤åˆ¶ç®€ä»‹" class="headerlink" title="1.1 ä¸»ä»å¤åˆ¶ç®€ä»‹"></a>1.1 ä¸»ä»å¤åˆ¶ç®€ä»‹</h3><h4 id="1-1-1-äº’è”ç½‘â€œä¸‰é«˜â€æ¶æ„"><a href="#1-1-1-äº’è”ç½‘â€œä¸‰é«˜â€æ¶æ„" class="headerlink" title="1.1.1 äº’è”ç½‘â€œä¸‰é«˜â€æ¶æ„"></a>1.1.1 äº’è”ç½‘â€œä¸‰é«˜â€æ¶æ„</h4><ul><li>é«˜å¹¶å‘</li><li>é«˜æ€§èƒ½</li><li>é«˜å¯ç”¨</li></ul><h4 id="1-1-2-å•æœºredisçš„é£é™©å’Œé—®é¢˜"><a href="#1-1-2-å•æœºredisçš„é£é™©å’Œé—®é¢˜" class="headerlink" title="1.1.2 å•æœºredisçš„é£é™©å’Œé—®é¢˜"></a>1.1.2 å•æœºredisçš„é£é™©å’Œé—®é¢˜</h4><ul><li>æœºå™¨æ•…éšœ</li><li>å®¹é‡ç“¶é¢ˆ</li><li>ç»“è®ºï¼š<ul><li>é¿å…å•ç‚¹redisæœåŠ¡å™¨æ•…éšœï¼Œå‡†å¤‡å •èƒæœåŠ¡å™¨äº’è”</li><li>äº’è”æœåŠ¡å™¨ä¿è¯æ•°æ®åŒæ­¥</li><li>å®ç°Redisé«˜å¯ç”¨ï¼Œå®ç°æ•°æ®å†—ä½™å¤‡ä»½</li></ul></li></ul><h4 id="1-1-3-å¤šå°æœåŠ¡å™¨è¿æ¥æ–¹æ¡ˆ"><a href="#1-1-3-å¤šå°æœåŠ¡å™¨è¿æ¥æ–¹æ¡ˆ" class="headerlink" title="1.1.3 å¤šå°æœåŠ¡å™¨è¿æ¥æ–¹æ¡ˆ"></a>1.1.3 å¤šå°æœåŠ¡å™¨è¿æ¥æ–¹æ¡ˆ</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_32_20210327.png"></p><ul><li>æä¾›æ•°æ®æ–¹ï¼šmaster<ul><li>ä¸»æœåŠ¡å™¨ï¼Œä¸»èŠ‚ç‚¹ï¼Œä¸»åº“</li><li>ä¸»å®¢æˆ·ç«¯</li></ul></li><li>æ¥æ”¶æ•°æ®çš„æ–¹ï¼šslave<ul><li>ä»æœåŠ¡å™¨ï¼Œä»èŠ‚ç‚¹ï¼Œä»åº“</li><li>ä»å®¢æˆ·ç«¯</li></ul></li><li>éœ€è¦è§£å†³çš„é—®é¢˜<ul><li><strong>æ•°æ®åŒæ­¥</strong></li></ul></li><li>æ ¸å¿ƒå·¥ä½œ<ul><li>masterçš„æ•°æ®<strong>å¤åˆ¶</strong>åˆ°slaveä¸­</li></ul></li></ul><h4 id="1-1-4-ä¸»ä»å¤åˆ¶"><a href="#1-1-4-ä¸»ä»å¤åˆ¶" class="headerlink" title="1.1.4 ä¸»ä»å¤åˆ¶"></a>1.1.4 ä¸»ä»å¤åˆ¶</h4><p>ä¸»ä»å¤åˆ¶å³å°†masterä¸­çš„æ•°æ®å³æ—¶ã€æœ‰æ•ˆçš„<strong>å¤åˆ¶</strong>åˆ°slaveä¸­</p><p>ç‰¹å¾ï¼šä¸€ä¸ªmasterå¯ä»¥æ‹¥æœ‰å¤šä¸ªslaveï¼Œä¸€ä¸ªslaveåªå¯¹åº”ä¸€ä¸ªmaster</p><p>èŒè´£ï¼š</p><ul><li>master:<ul><li>å†™æ•°æ®</li><li>æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œå°†å‡ºç°å˜åŒ–çš„æ•°æ®è‡ªåŠ¨<strong>åŒæ­¥</strong>åˆ°slave</li><li>è¯»æ•°æ®ï¼ˆå¯å¿½ç•¥ï¼‰</li></ul></li><li>slave:<ul><li>è¯»æ•°æ®</li><li>å†™æ•°æ®ï¼ˆ<strong>ç¦æ­¢</strong>ï¼‰</li></ul></li></ul><h4 id="1-1-5-ä¸»ä»å¤åˆ¶çš„ä½œç”¨"><a href="#1-1-5-ä¸»ä»å¤åˆ¶çš„ä½œç”¨" class="headerlink" title="1.1.5 ä¸»ä»å¤åˆ¶çš„ä½œç”¨"></a>1.1.5 ä¸»ä»å¤åˆ¶çš„ä½œç”¨</h4><ul><li>è¯»å†™åˆ†ç¦»ï¼šmasterå†™ã€slaveè¯»ï¼Œæé«˜æœåŠ¡å™¨çš„è¯»å†™è´Ÿè½½èƒ½åŠ›</li><li>è´Ÿè½½å‡è¡¡ï¼šåŸºäºä¸»ä»ç»“æ„ï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œç”±slaveåˆ†æ‹…masterè´Ÿè½½ï¼Œå¹¶æ ¹æ®éœ€æ±‚çš„å˜åŒ–ï¼Œæ”¹å˜slaveçš„æ•°é‡ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…æ•°æ®è¯»å–è´Ÿè½½ï¼Œå¤§å¤§æé«˜RedisæœåŠ¡å™¨å¹¶å‘é‡ä¸æ•°æ®ååé‡</li><li>æ•…éšœæ¢å¤ï¼šå½“masterå‡ºç°é—®é¢˜æ—¶ï¼Œç”±slaveæä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤</li><li>æ•°æ®å†—ä½™ï¼šå®ç°æ•°æ®çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼</li><li>é«˜å¯ç”¨åŸºçŸ³ï¼šåŸºäºä¸»ä»å¤åˆ¶ï¼Œæ„å»ºå“¨å…µæ¨¡å¼ä¸é›†ç¾¤ï¼Œå®ç°Redisçš„é«˜å¯ç”¨æ–¹æ¡ˆ</li></ul><h3 id="1-2-ä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹"><a href="#1-2-ä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹" class="headerlink" title="1.2 ä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹"></a>1.2 ä¸»ä»å¤åˆ¶å·¥ä½œæµç¨‹</h3><h4 id="1-2-1-æ€»è¿°"><a href="#1-2-1-æ€»è¿°" class="headerlink" title="1.2.1 æ€»è¿°"></a>1.2.1 æ€»è¿°</h4><ul><li>ä¸»ä»å¤åˆ¶è¿‡ç¨‹å¤§ä½“å¯ä»¥åˆ†ä¸º3ä¸ªé˜¶æ®µ<ul><li>å»ºç«‹è¿æ¥é˜¶æ®µï¼ˆå³å‡†å¤‡é˜¶æ®µï¼‰</li><li>æ•°æ®åŒæ­¥é˜¶æ®µ</li><li>å‘½ä»¤ä¼ æ’­é˜¶æ®µ</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_33_20210327.png"></p><h4 id="1-2-2-ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥"><a href="#1-2-2-ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥" class="headerlink" title="1.2.2 ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥"></a>1.2.2 ç¬¬ä¸€é˜¶æ®µï¼šå»ºç«‹è¿æ¥</h4><p>å»ºç«‹slaveåˆ°masterçš„è¿æ¥ï¼Œä½¿masterèƒ½å¤Ÿè¯†åˆ«slaveï¼Œå¹¶ä¿å­˜slaveç«¯å£å·</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_34_20210327.png"></p><p>**ä¸»ä»è¿æ¥ï¼ˆslaveè¿æ¥masterï¼‰ **</p><ul><li><p>æ–¹å¼ä¸€ï¼šå®¢æˆ·ç«¯å‘é€å‘½ä»¤</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">slaveof <span class="hljs-tag">&lt;<span class="hljs-name">masterip</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">masterport</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ–¹å¼äºŒï¼šå¯åŠ¨æœåŠ¡å™¨å‚æ•°</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">redis-server -slaveof <span class="hljs-tag">&lt;<span class="hljs-name">masterip</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">masterport</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ–¹å¼ä¸‰ï¼šæœåŠ¡å™¨é…ç½® ï¼ˆå¸¸ç”¨ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">slaveof <span class="hljs-tag">&lt;<span class="hljs-name">masterip</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">masterport</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>slaveç³»ç»Ÿä¿¡æ¯</p><ul><li>master_link_down_since_seconds</li><li>masterhost</li><li>masterport</li></ul></li><li><p>masterç³»ç»Ÿä¿¡æ¯</p><ul><li>slave_listening_port(å¤šä¸ª)</li></ul></li></ul><p><strong>ä¸»ä»æ–­å¼€è¿æ¥</strong></p><ul><li><p><strong>å®¢æˆ·ç«¯</strong>å‘é€å‘½ä»¤</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">slaveof</span> <span class="hljs-literal">no</span> one<br></code></pre></td></tr></table></figure><ul><li>è¯´æ˜ï¼š slaveæ–­å¼€è¿æ¥åï¼Œ<strong>ä¸ä¼šåˆ é™¤å·²æœ‰æ•°æ®</strong>ï¼Œåªæ˜¯ä¸å†æ¥å—masterå‘é€çš„æ•°æ®</li></ul></li></ul><p><strong>æˆæƒè®¿é—®</strong></p><ul><li><p>masterå®¢æˆ·ç«¯å‘é€å‘½ä»¤è®¾ç½®å¯†ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">requirepass <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>masteré…ç½®æ–‡ä»¶è®¾ç½®å¯†ç </p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">config <span class="hljs-builtin-name">set</span> requirepass &lt;password&gt; <br>config <span class="hljs-builtin-name">get</span> requirepass<br></code></pre></td></tr></table></figure></li><li><p>slaveå®¢æˆ·ç«¯å‘é€å‘½ä»¤è®¾ç½®å¯†ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">auth <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>slaveé…ç½®æ–‡ä»¶è®¾ç½®å¯†ç </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">masterauth <span class="hljs-tag">&lt;<span class="hljs-name">password</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>slaveå¯åŠ¨æœåŠ¡å™¨è®¾ç½®å¯†ç </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">redis-<span class="hljs-keyword">server</span> â€“a &lt;<span class="hljs-keyword">password</span>&gt;<br></code></pre></td></tr></table></figure></li></ul><h4 id="1-2-3-ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åŒæ­¥"><a href="#1-2-3-ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åŒæ­¥" class="headerlink" title="1.2.3 ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åŒæ­¥"></a>1.2.3 ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®åŒæ­¥</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_35_20210327.png"></p><ul><li>å…¨é‡å¤åˆ¶<ul><li>å°†masteræ‰§è¡Œbgsaveä¹‹å‰ï¼Œmasterä¸­æ‰€æœ‰çš„æ•°æ®åŒæ­¥åˆ°slaveä¸­</li></ul></li><li>éƒ¨åˆ†å¤åˆ¶ï¼ˆå¢é‡å¤åˆ¶ï¼‰<ul><li>å°†masteræ‰§è¡Œbgsaveæ“ä½œä¸­ï¼Œæ–°åŠ å…¥çš„æ•°æ®ï¼ˆå¤åˆ¶ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼‰ä¼ ç»™slaveï¼Œslaveé€šè¿‡bgrewriteaofæŒ‡ä»¤æ¥æ¢å¤æ•°æ®</li></ul></li></ul><h5 id="æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜"><a href="#æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜" class="headerlink" title="æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜"></a>æ•°æ®åŒæ­¥é˜¶æ®µmasterè¯´æ˜</h5><ol><li>å¦‚æœmasteræ•°æ®é‡å·¨å¤§ï¼Œæ•°æ®åŒæ­¥é˜¶æ®µåº”<strong>é¿å¼€æµé‡é«˜å³°æœŸ</strong>ï¼Œ<strong>é¿å…</strong>é€ æˆmaster<strong>é˜»å¡</strong>ï¼Œå½±å“ä¸šåŠ¡æ­£å¸¸æ‰§è¡Œ</li><li>å¤åˆ¶ç¼“å†²åŒºå¤§å°è®¾å®šä¸åˆç†ï¼Œä¼šå¯¼è‡´æ•°æ®æº¢å‡ºã€‚å¦‚è¿›è¡Œå…¨é‡å¤åˆ¶å‘¨æœŸå¤ªé•¿ï¼Œè¿›è¡Œéƒ¨åˆ†å¤åˆ¶æ—¶å‘ç°æ•°æ®å·²ç»å­˜åœ¨ä¸¢å¤±çš„æƒ…å†µï¼Œå¿…é¡»è¿›è¡Œç¬¬äºŒæ¬¡å…¨é‡å¤åˆ¶ï¼Œè‡´ä½¿slaveé™·å…¥<strong>æ­»å¾ªç¯</strong>çŠ¶æ€ã€‚</li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># åœ¨masterç«¯ä¿®æ”¹</span><br><span class="hljs-attribute">repl</span>-backlog-size <span class="hljs-number">1</span>mb<br></code></pre></td></tr></table></figure><ol start="3"><li>masterå•æœºå†…å­˜å ç”¨ä¸»æœºå†…å­˜çš„æ¯”ä¾‹ä¸åº”è¿‡å¤§ï¼Œå»ºè®®ä½¿ç”¨50%-70%çš„å†…å­˜ï¼Œç•™ä¸‹30%-50%çš„å†…å­˜ç”¨äºæ‰§ è¡Œbgsaveå‘½ä»¤å’Œåˆ›å»ºå¤åˆ¶ç¼“å†²åŒº</li></ol><h5 id="æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜"><a href="#æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜" class="headerlink" title="æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜"></a>æ•°æ®åŒæ­¥é˜¶æ®µslaveè¯´æ˜</h5><ol><li>ä¸ºé¿å…slaveè¿›è¡Œå…¨é‡å¤åˆ¶ã€éƒ¨åˆ†å¤åˆ¶æ—¶æœåŠ¡å™¨å“åº”é˜»å¡æˆ–æ•°æ®ä¸åŒæ­¥ï¼Œ<strong>å»ºè®®å…³é—­</strong>æ­¤æœŸé—´çš„å¯¹å¤–æœåŠ¡</li></ol><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">slave-serve-stale-data <span class="hljs-literal">yes</span>|<span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure><ol start="2"><li><p>æ•°æ®åŒæ­¥é˜¶æ®µï¼Œmasterå‘é€ç»™slaveä¿¡æ¯å¯ä»¥ç†è§£masteræ˜¯slaveçš„ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œä¸»åŠ¨å‘slaveå‘é€å‘½ä»¤</p></li><li><p>å¤šä¸ªslaveåŒæ—¶å¯¹masterè¯·æ±‚æ•°æ®åŒæ­¥ï¼Œmasterå‘é€çš„RDBæ–‡ä»¶å¢å¤šï¼Œä¼šå¯¹å¸¦å®½é€ æˆå·¨å¤§å†²å‡»ï¼Œå¦‚æœmasterå¸¦å®½ä¸è¶³ï¼Œå› æ­¤æ•°æ®åŒæ­¥éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œé€‚é‡é”™å³°</p></li><li><p>slaveè¿‡å¤šæ—¶ï¼Œå»ºè®®è°ƒæ•´æ‹“æ‰‘ç»“æ„ï¼Œç”±ä¸€ä¸»å¤šä»ç»“æ„å˜ä¸ºæ ‘çŠ¶ç»“æ„ï¼Œä¸­é—´çš„èŠ‚ç‚¹æ—¢æ˜¯masterï¼Œä¹Ÿæ˜¯ slaveã€‚æ³¨æ„ä½¿ç”¨æ ‘çŠ¶ç»“æ„æ—¶ï¼Œç”±äºå±‚çº§æ·±åº¦ï¼Œå¯¼è‡´æ·±åº¦è¶Šé«˜çš„slaveä¸æœ€é¡¶å±‚masteré—´æ•°æ®åŒæ­¥å»¶è¿Ÿè¾ƒå¤§ï¼Œ<strong>æ•°æ®ä¸€è‡´æ€§å˜å·®ï¼Œåº”è°¨æ…é€‰æ‹©</strong></p></li></ol><h4 id="1-2-4-ç¬¬ä¸‰é˜¶æ®µï¼šå‘½ä»¤ä¼ æ’­"><a href="#1-2-4-ç¬¬ä¸‰é˜¶æ®µï¼šå‘½ä»¤ä¼ æ’­" class="headerlink" title="1.2.4 ç¬¬ä¸‰é˜¶æ®µï¼šå‘½ä»¤ä¼ æ’­"></a>1.2.4 ç¬¬ä¸‰é˜¶æ®µï¼šå‘½ä»¤ä¼ æ’­</h4><ul><li>å½“masteræ•°æ®åº“çŠ¶æ€è¢«ä¿®æ”¹åï¼Œå¯¼è‡´ä¸»ä»æœåŠ¡å™¨æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´ï¼Œæ­¤æ—¶éœ€è¦è®©ä¸»ä»æ•°æ®åŒæ­¥åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œ<strong>åŒæ­¥</strong>çš„åŠ¨ä½œç§°ä¸º<strong>å‘½ä»¤ä¼ æ’­</strong></li><li>masterå°†æ¥æ”¶åˆ°çš„æ•°æ®å˜æ›´å‘½ä»¤å‘é€ç»™slaveï¼Œslaveæ¥æ”¶å‘½ä»¤åæ‰§è¡Œå‘½ä»¤</li></ul><h5 id="å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶"><a href="#å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶" class="headerlink" title="å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶"></a>å‘½ä»¤ä¼ æ’­é˜¶æ®µçš„éƒ¨åˆ†å¤åˆ¶</h5><ul><li><p>å‘½ä»¤ä¼ æ’­é˜¶æ®µå‡ºç°äº†æ–­ç½‘ç°è±¡</p><ul><li>ç½‘ç»œé—ªæ–­é—ªè¿ï¼ˆå¿½ç•¥ï¼‰</li><li>çŸ­æ—¶é—´ç½‘ç»œä¸­æ–­ï¼ˆéƒ¨åˆ†å¤åˆ¶ï¼‰</li><li>é•¿æ—¶é—´ç½‘ç»œä¸­æ–­ï¼ˆå…¨é‡å¤åˆ¶ï¼‰</li></ul></li><li><p>éƒ¨åˆ†å¤åˆ¶çš„<font color="FF0000"><strong>ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ </strong></font></p><ul><li>æœåŠ¡å™¨çš„è¿è¡Œ idï¼ˆrun idï¼‰</li><li>ä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒº</li><li>ä¸»ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡</li></ul></li></ul><h5 id="æ ¸å¿ƒä¸€ï¼šæœåŠ¡å™¨è¿è¡ŒIDï¼ˆrunidï¼‰"><a href="#æ ¸å¿ƒä¸€ï¼šæœåŠ¡å™¨è¿è¡ŒIDï¼ˆrunidï¼‰" class="headerlink" title="æ ¸å¿ƒä¸€ï¼šæœåŠ¡å™¨è¿è¡ŒIDï¼ˆrunidï¼‰"></a>æ ¸å¿ƒä¸€ï¼šæœåŠ¡å™¨è¿è¡ŒIDï¼ˆrunidï¼‰</h5><ul><li>æ¦‚å¿µï¼šæœåŠ¡å™¨è¿è¡ŒIDæ˜¯æ¯ä¸€å°æœåŠ¡å™¨æ¯æ¬¡è¿è¡Œçš„èº«ä»½è¯†åˆ«ç ï¼Œä¸€å°æœåŠ¡å™¨å¤šæ¬¡è¿è¡Œå¯ä»¥ç”Ÿæˆå¤šä¸ªè¿è¡Œid</li><li>ç»„æˆï¼šè¿è¡Œidç”±40ä½å­—ç¬¦ç»„æˆï¼Œæ˜¯ä¸€ä¸ªéšæœºçš„åå…­è¿›åˆ¶å­—ç¬¦ <ul><li>ä¾‹å¦‚ï¼šfdc9ff13b9bbaab28db42b3d50f852bb5e3fcdce</li></ul></li><li>ä½œç”¨ï¼šè¿è¡Œidè¢«ç”¨äºåœ¨æœåŠ¡å™¨é—´è¿›è¡Œä¼ è¾“ï¼Œè¯†åˆ«èº«ä»½<ul><li>å¦‚æœæƒ³ä¸¤æ¬¡æ“ä½œå‡å¯¹åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œï¼Œå¿…é¡»æ¯æ¬¡æ“ä½œæºå¸¦å¯¹åº”çš„è¿è¡Œidï¼Œç”¨äºå¯¹æ–¹è¯†åˆ«</li></ul></li><li>å®ç°æ–¹å¼ï¼šè¿è¡Œidåœ¨æ¯å°æœåŠ¡å™¨å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œmasteråœ¨é¦–æ¬¡è¿æ¥slaveæ—¶ï¼Œä¼šå°†è‡ªå·±çš„è¿è¡ŒIDå‘é€ç»™slaveï¼Œslaveä¿å­˜æ­¤IDï¼Œé€šè¿‡<strong>info Server</strong>å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹èŠ‚ç‚¹çš„runid</li></ul><h5 id="æ ¸å¿ƒäºŒï¼šå¤åˆ¶ç¼“å†²åŒº"><a href="#æ ¸å¿ƒäºŒï¼šå¤åˆ¶ç¼“å†²åŒº" class="headerlink" title="æ ¸å¿ƒäºŒï¼šå¤åˆ¶ç¼“å†²åŒº"></a>æ ¸å¿ƒäºŒï¼šå¤åˆ¶ç¼“å†²åŒº</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_36_20210327.png"></p><ul><li><p>æ¦‚å¿µï¼š</p><p>å¤åˆ¶ç¼“å†²åŒºï¼Œåˆåå¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œæ˜¯ä¸€ä¸ª<strong>å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é˜Ÿåˆ—</strong>ï¼Œç”¨äºå­˜å‚¨æœåŠ¡å™¨æ‰§è¡Œè¿‡çš„å‘½ ä»¤ï¼Œæ¯æ¬¡ä¼ æ’­å‘½ä»¤ï¼Œmasteréƒ½ä¼šå°†ä¼ æ’­çš„å‘½ä»¤è®°å½•ä¸‹æ¥ï¼Œå¹¶å­˜å‚¨åœ¨å¤åˆ¶ç¼“å†²åŒº</p></li><li><p>ç”±æ¥ï¼š</p><p>æ¯å°æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå¦‚æœå¼€å¯æœ‰AOFæˆ–è¢«è¿æ¥æˆä¸ºmasterèŠ‚ç‚¹ï¼Œå³åˆ›å»ºå¤åˆ¶ç¼“å†²åŒº</p></li><li><p>ä½œç”¨ï¼š</p><p>ç”¨äºä¿å­˜masteræ”¶åˆ°çš„æ‰€æœ‰æŒ‡ä»¤ï¼ˆä»…å½±å“æ•°æ®å˜æ›´çš„æŒ‡ä»¤ï¼Œä¾‹å¦‚setï¼Œselectï¼‰</p></li><li><p>æ•°æ®æ¥æºï¼š</p><p>å½“masteræ¥æ”¶åˆ°ä¸»å®¢æˆ·ç«¯çš„æŒ‡ä»¤æ—¶ï¼Œé™¤äº†å°†æŒ‡ä»¤æ‰§è¡Œï¼Œä¼šå°†è¯¥æŒ‡ä»¤å­˜å‚¨åˆ°ç¼“å†²åŒºä¸­</p></li><li><p>å¤åˆ¶ç¼“å†²åŒºçš„å·¥ä½œåŸç†ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_37_20210327.png"></p></li></ul><h5 id="æ ¸å¿ƒä¸‰ï¼šä¸»ä»æœåŠ¡å™¨å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰"><a href="#æ ¸å¿ƒä¸‰ï¼šä¸»ä»æœåŠ¡å™¨å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰" class="headerlink" title="æ ¸å¿ƒä¸‰ï¼šä¸»ä»æœåŠ¡å™¨å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰"></a>æ ¸å¿ƒä¸‰ï¼šä¸»ä»æœåŠ¡å™¨å¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰</h5><ul><li>æ¦‚å¿µï¼šä¸€ä¸ªæ•°å­—ï¼Œæè¿°å¤åˆ¶ç¼“å†²åŒºä¸­çš„æŒ‡ä»¤å­—èŠ‚ä½ç½®</li><li>åˆ†ç±»ï¼š<ul><li>masterå¤åˆ¶åç§»é‡ï¼šè®°å½•å‘é€ç»™æ‰€æœ‰slaveçš„æŒ‡ä»¤å­—èŠ‚å¯¹åº”çš„ä½ç½®ï¼ˆå¤šä¸ªï¼‰</li><li>slaveå¤åˆ¶åç§»é‡ï¼šè®°å½•slaveæ¥æ”¶masterå‘é€è¿‡æ¥çš„æŒ‡ä»¤å­—èŠ‚å¯¹åº”çš„ä½ç½®ï¼ˆä¸€ä¸ªï¼‰</li></ul></li><li>æ•°æ®æ¥æºï¼š masterç«¯ï¼šå‘é€ä¸€æ¬¡è®°å½•ä¸€æ¬¡ slaveç«¯ï¼šæ¥æ”¶ä¸€æ¬¡è®°å½•ä¸€æ¬¡</li><li>ä½œç”¨ï¼š<strong>åŒæ­¥ä¿¡æ¯</strong>ï¼Œæ¯”å¯¹masterä¸slaveçš„å·®å¼‚ï¼Œå½“slaveæ–­çº¿åï¼Œæ¢å¤æ•°æ®ä½¿ç”¨</li></ul><h5 id="æ•°æ®åŒæ­¥-å‘½ä»¤ä¼ æ’­é˜¶æ®µå·¥ä½œæµç¨‹"><a href="#æ•°æ®åŒæ­¥-å‘½ä»¤ä¼ æ’­é˜¶æ®µå·¥ä½œæµç¨‹" class="headerlink" title="æ•°æ®åŒæ­¥+å‘½ä»¤ä¼ æ’­é˜¶æ®µå·¥ä½œæµç¨‹"></a>æ•°æ®åŒæ­¥+å‘½ä»¤ä¼ æ’­é˜¶æ®µå·¥ä½œæµç¨‹</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_38_20210327.png"></p><h4 id="1-2-5-å¿ƒè·³æœºåˆ¶"><a href="#1-2-5-å¿ƒè·³æœºåˆ¶" class="headerlink" title="1.2.5 å¿ƒè·³æœºåˆ¶"></a>1.2.5 å¿ƒè·³æœºåˆ¶</h4><ul><li>è¿›å…¥<strong>å‘½ä»¤ä¼ æ’­é˜¶æ®µå€™</strong>ï¼Œmasterä¸slaveé—´éœ€è¦è¿›è¡Œä¿¡æ¯äº¤æ¢ï¼Œä½¿ç”¨å¿ƒè·³æœºåˆ¶è¿›è¡Œç»´æŠ¤ï¼Œå®ç°åŒæ–¹è¿æ¥ä¿æŒåœ¨çº¿</li><li>masterå¿ƒè·³ï¼š<ul><li>æŒ‡ä»¤ï¼šPING</li><li>å‘¨æœŸï¼šç”±repl-ping-slave-periodå†³å®šï¼Œé»˜è®¤10ç§’</li><li>ä½œç”¨ï¼šåˆ¤æ–­slaveæ˜¯å¦åœ¨çº¿</li><li>æŸ¥è¯¢ï¼šINFO replication è·å–slaveæœ€åä¸€æ¬¡è¿æ¥æ—¶é—´é—´éš”ï¼Œlagé¡¹ç»´æŒåœ¨0æˆ–1è§†ä¸ºæ­£å¸¸</li></ul></li><li>slaveå¿ƒè·³ä»»åŠ¡<ul><li>æŒ‡ä»¤ï¼šREPLCONF ACK {offset}</li><li>å‘¨æœŸï¼š1ç§’</li><li>ä½œç”¨1ï¼šæ±‡æŠ¥slaveè‡ªå·±çš„å¤åˆ¶åç§»é‡ï¼Œè·å–æœ€æ–°çš„æ•°æ®å˜æ›´æŒ‡ä»¤</li><li>ä½œç”¨2ï¼šåˆ¤æ–­masteræ˜¯å¦åœ¨çº¿</li></ul></li></ul><h5 id="å¿ƒè·³é˜¶æ®µæ³¨æ„äº‹é¡¹"><a href="#å¿ƒè·³é˜¶æ®µæ³¨æ„äº‹é¡¹" class="headerlink" title="å¿ƒè·³é˜¶æ®µæ³¨æ„äº‹é¡¹"></a>å¿ƒè·³é˜¶æ®µæ³¨æ„äº‹é¡¹</h5><ul><li><p>å½“slaveå¤šæ•°æ‰çº¿ï¼Œæˆ–å»¶è¿Ÿè¿‡é«˜æ—¶ï¼Œmasterä¸ºä¿éšœæ•°æ®ç¨³å®šæ€§ï¼Œå°†æ‹’ç»æ‰€æœ‰ä¿¡æ¯åŒæ­¥æ“ä½œ</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">min</span>-slaves-<span class="hljs-built_in">to</span>-<span class="hljs-built_in">write</span> <span class="hljs-number">2</span> <br><span class="hljs-built_in">min</span>-slaves-<span class="hljs-built_in">max</span>-lag <span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><ul><li>slaveæ•°é‡å°‘äº2ä¸ªï¼Œæˆ–è€…æ‰€æœ‰slaveçš„å»¶è¿Ÿéƒ½å¤§äºç­‰äº10ç§’æ—¶ï¼Œå¼ºåˆ¶å…³é—­masterå†™åŠŸèƒ½ï¼Œåœæ­¢æ•°æ®åŒæ­¥</li></ul></li><li><p>slaveæ•°é‡ç”±slaveå‘é€<strong>REPLCONF ACK</strong>å‘½ä»¤åšç¡®è®¤</p></li><li><p>slaveå»¶è¿Ÿç”±slaveå‘é€<strong>REPLCONF ACK</strong>å‘½ä»¤åšç¡®è®¤</p></li></ul><h4 id="1-2-6-ä¸»ä»å¤åˆ¶å®Œæ•´æµç¨‹"><a href="#1-2-6-ä¸»ä»å¤åˆ¶å®Œæ•´æµç¨‹" class="headerlink" title="1.2.6 ä¸»ä»å¤åˆ¶å®Œæ•´æµç¨‹"></a>1.2.6 ä¸»ä»å¤åˆ¶å®Œæ•´æµç¨‹</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_39_20210327.png"></p><h3 id="1-3-ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜"><a href="#1-3-ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜" class="headerlink" title="1.3 ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜"></a>1.3 ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜</h3><h5 id="é¢‘ç¹çš„å…¨é‡å¤åˆ¶"><a href="#é¢‘ç¹çš„å…¨é‡å¤åˆ¶" class="headerlink" title="é¢‘ç¹çš„å…¨é‡å¤åˆ¶"></a>é¢‘ç¹çš„å…¨é‡å¤åˆ¶</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_40_20210327.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_41_20210327.png"></p><h5 id="ç½‘ç»œä¸­æ–­"><a href="#ç½‘ç»œä¸­æ–­" class="headerlink" title="ç½‘ç»œä¸­æ–­"></a>ç½‘ç»œä¸­æ–­</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_42_20210327_.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_43_20210327.png"></p><h5 id="æ•°æ®ä¸ä¸€è‡´"><a href="#æ•°æ®ä¸ä¸€è‡´" class="headerlink" title="æ•°æ®ä¸ä¸€è‡´"></a>æ•°æ®ä¸ä¸€è‡´</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_44_20210327.png"></p><h2 id="2-å“¨å…µæ¨¡å¼"><a href="#2-å“¨å…µæ¨¡å¼" class="headerlink" title="2. å“¨å…µæ¨¡å¼"></a>2. å“¨å…µæ¨¡å¼</h2><h3 id="2-1-å“¨å…µç®€ä»‹"><a href="#2-1-å“¨å…µç®€ä»‹" class="headerlink" title="2.1 å“¨å…µç®€ä»‹"></a>2.1 å“¨å…µç®€ä»‹</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_45_20210327.png"></p><h3 id="2-2-å“¨å…µçš„å®šä¹‰"><a href="#2-2-å“¨å…µçš„å®šä¹‰" class="headerlink" title="2.2 å“¨å…µçš„å®šä¹‰"></a>2.2 å“¨å…µçš„å®šä¹‰</h3><blockquote><p>å“¨å…µ(sentinel) æ˜¯ä¸€ä¸ª<strong>åˆ†å¸ƒå¼ç³»ç»Ÿ</strong>ï¼Œç”¨äºå¯¹ä¸»ä»ç»“æ„ä¸­çš„æ¯å°æœåŠ¡å™¨è¿›è¡Œ<strong>ç›‘æ§</strong>ï¼Œå½“å‡ºç°æ•…éšœæ—¶é€šè¿‡æŠ•ç¥¨æœºåˆ¶<strong>é€‰æ‹©</strong>æ–°çš„masterå¹¶å°†æ‰€æœ‰slaveè¿æ¥åˆ°æ–°çš„masterã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_46_20210327.png"></p><h3 id="2-3-å“¨å…µçš„ä½œç”¨"><a href="#2-3-å“¨å…µçš„ä½œç”¨" class="headerlink" title="2.3 å“¨å…µçš„ä½œç”¨"></a>2.3 å“¨å…µçš„ä½œç”¨</h3><ul><li>ç›‘æ§<ul><li>ä¸æ–­çš„æ£€æŸ¥masterå’Œslaveæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ masterå­˜æ´»æ£€æµ‹ã€masterä¸slaveè¿è¡Œæƒ…å†µæ£€æµ‹</li></ul></li><li>é€šçŸ¥ï¼ˆæé†’ï¼‰<ul><li>å½“è¢«ç›‘æ§çš„æœåŠ¡å™¨å‡ºç°é—®é¢˜æ—¶ï¼Œå‘å…¶ä»–ï¼ˆå“¨å…µé—´ï¼Œå®¢æˆ·ç«¯ï¼‰å‘é€é€šçŸ¥ã€‚</li></ul></li><li>è‡ªåŠ¨æ•…éšœè½¬ç§»<ul><li>æ–­å¼€masterä¸slaveè¿æ¥ï¼Œé€‰å–ä¸€ä¸ªslaveä½œä¸ºmasterï¼Œå°†å…¶ä»–slaveè¿æ¥åˆ°æ–°çš„masterï¼Œå¹¶å‘ŠçŸ¥å®¢æˆ·ç«¯æ–°çš„æœåŠ¡å™¨åœ°å€</li></ul></li></ul><p><strong>æ³¨æ„ï¼š</strong><br>å“¨å…µä¹Ÿæ˜¯ä¸€å°<strong>redisæœåŠ¡å™¨</strong>ï¼Œåªæ˜¯ä¸æä¾›æ•°æ®æœåŠ¡ é€šå¸¸å“¨å…µé…ç½®æ•°é‡ä¸º<strong>å•æ•°</strong></p><h3 id="2-4-å“¨å…µçš„é…ç½®"><a href="#2-4-å“¨å…µçš„é…ç½®" class="headerlink" title="2.4 å“¨å…µçš„é…ç½®"></a>2.4 å“¨å…µçš„é…ç½®</h3><ul><li><p>é…ç½®ä¸€æ‹–äºŒçš„ä¸»ä»ç»“æ„</p></li><li><p>é…ç½®ä¸‰ä¸ªå“¨å…µï¼ˆé…ç½®ç›¸åŒï¼Œç«¯å£ä¸åŒï¼‰</p><ul><li>å‚çœ‹sentinel.conf</li></ul></li><li><p>å¯åŠ¨å“¨å…µ</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">redis-sentinel sentinelç«¯å£å· <span class="hljs-string">.conf</span><br></code></pre></td></tr></table></figure></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_47_20210327.png"></p><h3 id="2-5-å“¨å…µå·¥ä½œåŸç†"><a href="#2-5-å“¨å…µå·¥ä½œåŸç†" class="headerlink" title="2.5 å“¨å…µå·¥ä½œåŸç†"></a>2.5 å“¨å…µå·¥ä½œåŸç†</h3><p>ä¸»ä»åˆ‡æ¢</p><ul><li>å“¨å…µåœ¨è¿›è¡Œä¸»ä»åˆ‡æ¢è¿‡ç¨‹ä¸­ç»å†ä¸‰ä¸ªé˜¶æ®µ<ul><li>ç›‘æ§</li><li>é€šçŸ¥</li><li>æ•…éšœè½¬ç§»</li></ul></li></ul><h4 id="2-5-1-ç›‘æ§é˜¶æ®µ"><a href="#2-5-1-ç›‘æ§é˜¶æ®µ" class="headerlink" title="2.5.1 ç›‘æ§é˜¶æ®µ"></a>2.5.1 ç›‘æ§é˜¶æ®µ</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_48_20210327.png"></p><ul><li><p>ç”¨äºåŒæ­¥å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€ä¿¡æ¯</p><ul><li><p>è·å–å„ä¸ªsentinelçš„çŠ¶æ€ï¼ˆæ˜¯å¦åœ¨çº¿ï¼‰</p></li><li><p>è·å–masterçš„çŠ¶æ€</p><ul><li><p>masterå±æ€§</p><ul><li><p>runid</p></li><li><p>roleï¼šmaster</p></li></ul></li><li><p>å„ä¸ªslaveçš„è¯¦ç»†ä¿¡æ¯</p></li></ul></li><li><p>è·å–æ‰€æœ‰slaveçš„çŠ¶æ€ï¼ˆæ ¹æ®masterä¸­çš„slaveä¿¡æ¯ï¼‰</p><ul><li>slaveå±æ€§<ul><li>runid</li><li>roleï¼šslave</li><li>master_hostã€master_port</li><li>offset</li><li>â€¦</li></ul></li></ul></li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_49_20210327.png"></p><h4 id="2-5-2-é€šçŸ¥é˜¶æ®µ"><a href="#2-5-2-é€šçŸ¥é˜¶æ®µ" class="headerlink" title="2.5.2 é€šçŸ¥é˜¶æ®µ"></a>2.5.2 é€šçŸ¥é˜¶æ®µ</h4><ul><li>å„ä¸ªå“¨å…µå°†å¾—åˆ°çš„ä¿¡æ¯ç›¸äº’åŒæ­¥ï¼ˆä¿¡æ¯å¯¹ç§°ï¼‰</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_50_20210327.png"></p><h4 id="2-5-3-æ•…éšœè½¬ç§»é˜¶æ®µ"><a href="#2-5-3-æ•…éšœè½¬ç§»é˜¶æ®µ" class="headerlink" title="2.5.3 æ•…éšœè½¬ç§»é˜¶æ®µ"></a>2.5.3 æ•…éšœè½¬ç§»é˜¶æ®µ</h4><h5 id="ç¡®è®¤masterä¸‹çº¿"><a href="#ç¡®è®¤masterä¸‹çº¿" class="headerlink" title="ç¡®è®¤masterä¸‹çº¿"></a>ç¡®è®¤masterä¸‹çº¿</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_51_20210327.png"></p><ul><li>å½“æŸä¸ªå“¨å…µå‘ç°ä¸»æœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œä¼šå°†masterä¸­çš„SentinelRedistanceä¸­çš„masteræ”¹ä¸º<strong>SRI_S_DOWN</strong>ï¼ˆä¸»è§‚ä¸‹çº¿ï¼‰ï¼Œå¹¶é€šçŸ¥å…¶ä»–å“¨å…µï¼Œå‘Šè¯‰ä»–ä»¬å‘ç°masteræŒ‚æ‰äº†ã€‚</li><li>å…¶ä»–å“¨å…µåœ¨æ¥æ”¶åˆ°è¯¥å“¨å…µå‘é€çš„ä¿¡æ¯åï¼Œä¹Ÿä¼šå°è¯•å»è¿æ¥masterï¼Œå¦‚æœè¶…è¿‡åŠæ•°ï¼ˆé…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ï¼‰ç¡®è®¤masteræŒ‚æ‰åï¼Œä¼šå°†masterä¸­çš„SentinelRedistanceä¸­çš„masteræ”¹ä¸º<strong>SRI_O_DOWN</strong>ï¼ˆå®¢è§‚ä¸‹çº¿ï¼‰</li></ul><h5 id="æ¨é€‰å“¨å…µè¿›è¡Œå¤„ç†"><a href="#æ¨é€‰å“¨å…µè¿›è¡Œå¤„ç†" class="headerlink" title="æ¨é€‰å“¨å…µè¿›è¡Œå¤„ç†"></a>æ¨é€‰å“¨å…µè¿›è¡Œå¤„ç†</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_52_20210327.png"></p><ul><li>åœ¨ç¡®è®¤masteræŒ‚æ‰ä»¥åï¼Œä¼šæ¨é€‰å‡ºä¸€ä¸ªå“¨å…µæ¥è¿›è¡Œæ•…éšœè½¬ç§»å·¥ä½œï¼ˆç”±è¯¥å“¨å…µæ¥æŒ‡å®šå“ªä¸ªslaveæ¥åšæ–°çš„masterï¼‰ã€‚</li><li>ç­›é€‰æ–¹å¼æ˜¯å“¨å…µäº’ç›¸å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”å‚ä¸æŠ•ç¥¨ï¼Œç¥¨å¤šè€…å½“é€‰ã€‚</li></ul><h5 id="æŒ‘é€‰æ–°master"><a href="#æŒ‘é€‰æ–°master" class="headerlink" title="æŒ‘é€‰æ–°master"></a>æŒ‘é€‰æ–°master</h5><ul><li>ç”±æ¨é€‰å‡ºæ¥çš„å“¨å…µå¯¹å½“å‰çš„slaveè¿›è¡Œç­›é€‰ï¼Œç­›é€‰æ¡ä»¶æœ‰ï¼š<ul><li>æœåŠ¡å™¨åˆ—è¡¨ä¸­æŒ‘é€‰å¤‡é€‰master<ul><li>åœ¨çº¿çš„</li><li>å“åº”æ…¢çš„</li><li>ä¸åŸmasteræ–­å¼€æ—¶é—´ä¹…çš„</li><li>ä¼˜å…ˆåŸåˆ™<ul><li>ä¼˜å…ˆçº§</li><li>offset</li><li>runid</li></ul></li></ul></li><li>å‘é€æŒ‡ä»¤ï¼ˆ sentinel ï¼‰<ul><li>å‘æ–°çš„masterå‘é€<strong>slaveof no one</strong>(æ–­å¼€ä¸åŸmasterçš„è¿æ¥)</li><li>å‘å…¶ä»–slaveå‘é€slaveof æ–°masterIPç«¯å£ï¼ˆè®©å…¶ä»–slaveä¸æ–°çš„masterç›¸è¿ï¼‰</li></ul></li></ul></li></ul><h4 id="2-5-4-å„é˜¶æ®µçš„æ€»ç»“"><a href="#2-5-4-å„é˜¶æ®µçš„æ€»ç»“" class="headerlink" title="2.5.4 å„é˜¶æ®µçš„æ€»ç»“"></a>2.5.4 å„é˜¶æ®µçš„æ€»ç»“</h4><ul><li>ç›‘æ§<ul><li>åŒæ­¥ä¿¡æ¯</li></ul></li><li>é€šçŸ¥<ul><li>ä¿æŒè”é€š</li></ul></li><li>æ•…éšœè½¬ç§»<ul><li>å‘ç°é—®é¢˜</li><li>ç«é€‰è´Ÿè´£äºº</li><li>ä¼˜é€‰æ–°master</li><li>æ–°masterä¸Šä»»ï¼Œå…¶ä»–slaveåˆ‡æ¢masterï¼ŒåŸmasterä½œä¸ºslaveæ•…éšœæ¢å¤åè¿æ¥</li></ul></li></ul><h2 id="3-é›†ç¾¤"><a href="#3-é›†ç¾¤" class="headerlink" title="3. é›†ç¾¤"></a>3. é›†ç¾¤</h2><h3 id="3-1-é›†ç¾¤ç®€ä»‹"><a href="#3-1-é›†ç¾¤ç®€ä»‹" class="headerlink" title="3.1 é›†ç¾¤ç®€ä»‹"></a>3.1 é›†ç¾¤ç®€ä»‹</h3><h4 id="3-1-1-é›†ç¾¤æ¶æ„"><a href="#3-1-1-é›†ç¾¤æ¶æ„" class="headerlink" title="3.1.1 é›†ç¾¤æ¶æ„"></a>3.1.1 é›†ç¾¤æ¶æ„</h4><ul><li>é›†ç¾¤å°±æ˜¯ä½¿ç”¨ç½‘ç»œå°†è‹¥å¹²å°è®¡ç®—æœº<strong>è”é€š</strong>èµ·æ¥ï¼Œå¹¶æä¾›<strong>ç»Ÿä¸€çš„ç®¡ç†æ–¹å¼</strong>ï¼Œä½¿å…¶å¯¹å¤–å‘ˆç°å•æœºçš„æœåŠ¡æ•ˆæœ</li></ul><h4 id="3-1-2-é›†ç¾¤ä½œç”¨"><a href="#3-1-2-é›†ç¾¤ä½œç”¨" class="headerlink" title="3.1.2 é›†ç¾¤ä½œç”¨"></a>3.1.2 é›†ç¾¤ä½œç”¨</h4><ul><li>åˆ†æ•£å•å°æœåŠ¡å™¨çš„è®¿é—®å‹åŠ›ï¼Œå®ç°<strong>è´Ÿè½½å‡è¡¡</strong></li><li>åˆ†æ•£å•å°æœåŠ¡å™¨çš„å­˜å‚¨å‹åŠ›ï¼Œå®ç°<strong>å¯æ‰©å±•æ€§</strong></li><li><strong>é™ä½</strong>å•å°æœåŠ¡å™¨å®•æœºå¸¦æ¥çš„<strong>ä¸šåŠ¡ç¾éš¾</strong></li></ul><h3 id="3-2-é›†ç¾¤ç»“æ„è®¾è®¡"><a href="#3-2-é›†ç¾¤ç»“æ„è®¾è®¡" class="headerlink" title="3.2 é›†ç¾¤ç»“æ„è®¾è®¡"></a>3.2 é›†ç¾¤ç»“æ„è®¾è®¡</h3><h4 id="3-2-1-æ•°æ®å­˜å‚¨è®¾è®¡"><a href="#3-2-1-æ•°æ®å­˜å‚¨è®¾è®¡" class="headerlink" title="3.2.1 æ•°æ®å­˜å‚¨è®¾è®¡"></a>3.2.1 æ•°æ®å­˜å‚¨è®¾è®¡</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_53_20210328.png"></p><ul><li><p>é€šè¿‡ç®—æ³•è®¾è®¡ï¼Œè®¡ç®—å‡ºkeyåº”è¯¥ä¿å­˜çš„ä½ç½®</p></li><li><p>å°†æ‰€æœ‰çš„å­˜å‚¨ç©ºé—´è®¡åˆ’åˆ‡å‰²æˆ16384ä»½ï¼Œæ¯å°ä¸»æœºä¿å­˜ä¸€éƒ¨åˆ† æ¯ä»½ä»£è¡¨çš„æ˜¯ä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œä¸æ˜¯ä¸€ä¸ªkeyçš„ä¿å­˜ç©ºé—´</p></li><li><p>å°†keyæŒ‰ç…§è®¡ç®—å‡ºçš„ç»“æœæ”¾åˆ°å¯¹åº”çš„å­˜å‚¨ç©ºé—´</p></li><li><p>å¢å¼ºå¯æ‰©å±•æ€§ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_54_20210328.png"></p></li></ul><h4 id="3-2-2-é›†ç¾¤å†…éƒ¨é€šè®¯è®¾è®¡"><a href="#3-2-2-é›†ç¾¤å†…éƒ¨é€šè®¯è®¾è®¡" class="headerlink" title="3.2.2 é›†ç¾¤å†…éƒ¨é€šè®¯è®¾è®¡"></a>3.2.2 é›†ç¾¤å†…éƒ¨é€šè®¯è®¾è®¡</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_55_20210328.png"></p><ul><li>å„ä¸ªæ•°æ®åº“äº’ç›¸è¿é€šï¼Œä¿å­˜å„ä¸ªåº“ä¸­æ§½çš„ç¼–å·æ•°æ®</li><li>ä¸€æ¬¡å‘½ä¸­ï¼Œç›´æ¥è¿”å›</li><li>ä¸€æ¬¡æœªå‘½ä¸­ï¼Œå‘ŠçŸ¥å…·ä½“çš„ä½ç½®ï¼Œkeyå†ç›´æ¥å»æ‰¾å¯¹åº”çš„åº“ä¿å­˜æ•°æ®</li></ul><h4 id="3-2-3-é›†ç¾¤clusteræ­å»º"><a href="#3-2-3-é›†ç¾¤clusteræ­å»º" class="headerlink" title="3.2.3 é›†ç¾¤clusteræ­å»º"></a>3.2.3 é›†ç¾¤clusteræ­å»º</h4><h5 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="headerlink" title="é›†ç¾¤æ­å»º"></a>é›†ç¾¤æ­å»º</h5><ul><li>ä¿®æ”¹ä¸€ä»½redis-6379.conf</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_56_20210328.png"></p><ul><li><p>å¤åˆ¶5ä»½ï¼Œå¹¶ä¿®æ”¹ç«¯å£å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">sed &quot;s/6379/6380/g&quot; redis-6379.conf &gt; redis-6380.conf<br>sed &quot;s/6379/6381/g&quot; redis-6379.conf &gt; redis-6381.conf<br>sed &quot;s/6379/6382/g&quot; redis-6379.conf &gt; redis-6382.conf<br>sed &quot;s/6379/6383/g&quot; redis-6379.conf &gt; redis-6383.conf<br>sed &quot;s/6379/6384/g&quot; redis-6379.conf &gt; redis-6384.conf<br></code></pre></td></tr></table></figure></li><li><p>åˆ†åˆ«åœ¨6ä¸ªå®¢æˆ·ç«¯å¯åŠ¨æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ‰§è¡Œ6æ¬¡</span><br>redis-server é…ç½®æ–‡ä»¶è·¯å¾„<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¯åŠ¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef | grep redis<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_57_20210328.png"></p><p>æœåŠ¡å¼€å¯æ­£å¸¸</p></li><li><p>æŸ¥æ‰¾redis-trib.rbçš„å‘½ä»¤(è¯¥æŒ‡ä»¤æ‰§è¡ŒåŸºäºrubyï¼Œgemï¼Œéœ€è¦å®‰è£…)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ll | grep redis-<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_58_20210328.png"></p></li><li><p>æ‰§è¡Œredis-tribå‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è¯¥å‘½ä»¤åªåœ¨å½“å‰ç›®å½•ä¸‹æœ‰æ•ˆ,--replicasä»£è¡¨é›†ç¾¤ç»“æ„ï¼Œ1è¡¨ç¤ºæ¯ä¸ªmasterè¿æ¥1ä¸ªslave</span><br>./redis-trib.rb create --replicas 1 127.0.0.1ï¼š6379 127.0.0.1ï¼š6380 127.0.0.1ï¼š6381 127.0.0.1ï¼š6382 127.0.0.1ï¼š6383 127.0.0.1ï¼š6384<br><span class="hljs-meta">#</span><span class="bash"> æœ€åè¾“å…¥yes</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_59_20210328.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_60_20210328.png"></p></li><li><p>å®Œæˆè¿è¡Œåï¼Œæ¯ä¸ªnodeæ–‡ä»¶åŠ å…¥äº†ç³Ÿåˆ†é…ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_61_20210328.png"></p></li><li><p>é›†ç¾¤æ­å»ºå®Œæ¯•</p></li></ul><h5 id="é›†ç¾¤è®¾ç½®ä¸è·å–æ•°æ®"><a href="#é›†ç¾¤è®¾ç½®ä¸è·å–æ•°æ®" class="headerlink" title="é›†ç¾¤è®¾ç½®ä¸è·å–æ•°æ®"></a>é›†ç¾¤è®¾ç½®ä¸è·å–æ•°æ®</h5><ul><li>è®¾ç½®æ•°æ®</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ“ä½œé›†ç¾¤</span><br>redis-cli -c<br>set name itheima<br></code></pre></td></tr></table></figure><ul><li>è·å–æ•°æ®</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">redis-cli -c -p 6382<br><span class="hljs-meta">#</span><span class="bash"> å¦‚æœä¸åœ¨6382ç«¯å£ï¼Œä¸‹é¢ä¼šæç¤ºå‘ç”Ÿäº†é‡å®šå‘</span><br>get name<br></code></pre></td></tr></table></figure><h5 id="ä¸»ä»ä¸‹çº¿ä¸ä¸»ä»åˆ‡æ¢"><a href="#ä¸»ä»ä¸‹çº¿ä¸ä¸»ä»åˆ‡æ¢" class="headerlink" title="ä¸»ä»ä¸‹çº¿ä¸ä¸»ä»åˆ‡æ¢"></a>ä¸»ä»ä¸‹çº¿ä¸ä¸»ä»åˆ‡æ¢</h5><ul><li><p>slaveä¸‹çº¿å¯¹åŠŸèƒ½ä¸äº§ç”Ÿå½±å“ï¼Œä¼šæ ‡è®°ä»¥ä¸‹slave</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_62_20210328.png"></p></li><li><p>masterä¸‹çº¿</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_63_20210328.png"></p><p>ä¹‹åslaveä¼šå˜ä¸ºmaster</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</span><br>cluster nodes<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_64_20210328.png"><br>masterä¸Šçº¿åï¼Œå˜ä¸ºslaveï¼Œä¹‹å‰çš„slaveå˜ä¸ºmaster<br><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_65_20210328.png"></p></li></ul><h5 id="é›†ç¾¤é…ç½®æ€»ç»“"><a href="#é›†ç¾¤é…ç½®æ€»ç»“" class="headerlink" title="é›†ç¾¤é…ç½®æ€»ç»“"></a>é›†ç¾¤é…ç½®æ€»ç»“</h5><ul><li><p>è®¾ç½®åŠ å…¥clusterï¼Œæˆä¸ºå…¶ä¸­èŠ‚ç‚¹</p><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript">cluster-enabled <span class="hljs-literal">yes</span> | <span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure></li><li><p>clusteré…ç½®æ–‡ä»¶åï¼Œè¯¥æ–‡ä»¶å±äºè‡ªåŠ¨ç”Ÿæˆï¼Œä»…ç”¨äºå¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶å¹¶æŸ¥è¯¢æ–‡ä»¶å†…å®¹</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">cluster</span>-config-<span class="hljs-keyword">file</span> &lt;filename&gt;<br></code></pre></td></tr></table></figure></li><li><p>èŠ‚ç‚¹æœåŠ¡å“åº”è¶…æ—¶æ—¶é—´ï¼Œç”¨äºåˆ¤å®šè¯¥èŠ‚ç‚¹æ˜¯å¦ä¸‹çº¿æˆ–è€…åˆ‡æ¢ä¸ºä»èŠ‚ç‚¹</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">cluster-<span class="hljs-keyword">node</span><span class="hljs-title">-timeout</span> <span class="hljs-tag">&lt;millseconds&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>masterè¿æ¥çš„slaveæœ€å°æ•°é‡</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">cluster-migration-<span class="hljs-keyword">barrier </span>&lt;<span class="hljs-built_in">count</span>&gt;<br></code></pre></td></tr></table></figure></li></ul><h5 id="clusterèŠ‚ç‚¹æ“ä½œæŒ‡ä»¤æ€»ç»“"><a href="#clusterèŠ‚ç‚¹æ“ä½œæŒ‡ä»¤æ€»ç»“" class="headerlink" title="clusterèŠ‚ç‚¹æ“ä½œæŒ‡ä»¤æ€»ç»“"></a>clusterèŠ‚ç‚¹æ“ä½œæŒ‡ä»¤æ€»ç»“</h5><ul><li><p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">cluster <span class="hljs-keyword">node</span><span class="hljs-title"></span><br></code></pre></td></tr></table></figure></li><li><p>è¿›å…¥ä¸€ä¸ªä»èŠ‚ç‚¹redisï¼Œåˆ‡æ¢å…¶ä¸ºä¸»èŠ‚ç‚¹</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">cluster replicate &lt;master-<span class="hljs-built_in">id</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>å‘ç°ä¸€ä¸ªæ–°èŠ‚ç‚¹ï¼Œæ–°å¢ä¸»èŠ‚ç‚¹</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">cluster</span> meet <span class="hljs-built_in">ip</span>:port<br></code></pre></td></tr></table></figure></li><li><p>å¿½ç•¥ä¸€ä¸ªæ²¡æœ‰soltçš„èŠ‚ç‚¹</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">cluster forget &lt;<span class="hljs-built_in">id</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>æ‰‹åŠ¨æ•…éšœè½¬ç§»</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">cluster failover</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="4-ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"><a href="#4-ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4. ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"></a>4. ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ</h2><h3 id="4-1-ç¼“å­˜é¢„çƒ­"><a href="#4-1-ç¼“å­˜é¢„çƒ­" class="headerlink" title="4.1 ç¼“å­˜é¢„çƒ­"></a>4.1 ç¼“å­˜é¢„çƒ­</h3><h4 id="4-1-1-é—®é¢˜æ’æŸ¥"><a href="#4-1-1-é—®é¢˜æ’æŸ¥" class="headerlink" title="4.1.1 é—®é¢˜æ’æŸ¥"></a>4.1.1 é—®é¢˜æ’æŸ¥</h4><ul><li>è¯·æ±‚æ•°é‡è¾ƒé«˜</li><li>ä¸»ä»ä¹‹é—´æ•°æ®ååé‡è¾ƒå¤§ï¼Œæ•°æ®åŒæ­¥æ“ä½œé¢‘åº¦è¾ƒé«˜</li></ul><h4 id="4-1-2-è§£å†³æ–¹æ¡ˆ"><a href="#4-1-2-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="4.1.2 è§£å†³æ–¹æ¡ˆ"></a>4.1.2 è§£å†³æ–¹æ¡ˆ</h4><ul><li>å‰ç½®å‡†å¤‡å·¥ä½œï¼š<ul><li>æ—¥å¸¸ä¾‹è¡Œç»Ÿè®¡æ•°æ®è®¿é—®è®°å½•ï¼Œç»Ÿè®¡è®¿é—®é¢‘åº¦è¾ƒé«˜çš„çƒ­ç‚¹æ•°æ®</li><li>åˆ©ç”¨LRUæ•°æ®åˆ é™¤ç­–ç•¥ï¼Œæ„å»ºæ•°æ®ç•™å­˜é˜Ÿåˆ— <ul><li>ä¾‹å¦‚ï¼šstormä¸kafkaé…åˆ</li></ul></li></ul></li><li>å‡†å¤‡å·¥ä½œï¼š<ul><li>å°†ç»Ÿè®¡ç»“æœä¸­çš„æ•°æ®åˆ†ç±»ï¼Œæ ¹æ®çº§åˆ«ï¼Œredisä¼˜å…ˆåŠ è½½çº§åˆ«è¾ƒé«˜çš„çƒ­ç‚¹æ•°æ®</li><li>åˆ©ç”¨åˆ†å¸ƒå¼å¤šæœåŠ¡å™¨åŒæ—¶è¿›è¡Œæ•°æ®è¯»å–ï¼Œæé€Ÿæ•°æ®åŠ è½½è¿‡ç¨‹</li><li>çƒ­ç‚¹æ•°æ®ä¸»ä»åŒæ—¶é¢„çƒ­</li></ul></li><li>å®æ–½ï¼š<ul><li>ä½¿ç”¨è„šæœ¬ç¨‹åºå›ºå®šè§¦å‘æ•°æ®é¢„çƒ­è¿‡ç¨‹</li><li>å¦‚æœæ¡ä»¶å…è®¸ï¼Œä½¿ç”¨äº†CDNï¼ˆå†…å®¹åˆ†å‘ç½‘ç»œï¼‰ï¼Œæ•ˆæœä¼šæ›´å¥½</li></ul></li></ul><h4 id="4-1-3-æ€»ç»“"><a href="#4-1-3-æ€»ç»“" class="headerlink" title="4.1.3 æ€»ç»“"></a>4.1.3 æ€»ç»“</h4><p>ç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿå¯åŠ¨å‰ï¼Œæå‰å°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼</p><h3 id="4-2-ç¼“å­˜é›ªå´©"><a href="#4-2-ç¼“å­˜é›ªå´©" class="headerlink" title="4.2 ç¼“å­˜é›ªå´©"></a>4.2 ç¼“å­˜é›ªå´©</h3><h4 id="4-2-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ1ï¼‰"><a href="#4-2-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ1ï¼‰" class="headerlink" title="4.2.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ1ï¼‰"></a>4.2.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ1ï¼‰</h4><ol><li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¿½ç„¶æ•°æ®åº“è¿æ¥é‡æ¿€å¢</li><li>åº”ç”¨æœåŠ¡å™¨æ— æ³•åŠæ—¶å¤„ç†è¯·æ±‚</li><li>å¤§é‡408ï¼Œ500é”™è¯¯é¡µé¢å‡ºç°</li><li>å®¢æˆ·åå¤åˆ·æ–°é¡µé¢è·å–æ•°æ®</li><li>æ•°æ®åº“å´©æºƒ</li><li>åº”ç”¨æœåŠ¡å™¨å´©æºƒ</li><li>é‡å¯åº”ç”¨æœåŠ¡å™¨æ— æ•ˆ</li><li>RedisæœåŠ¡å™¨å´©æºƒ</li><li>Redisé›†ç¾¤å´©æºƒ</li><li>é‡å¯æ•°æ®åº“åå†æ¬¡è¢«ç¬é—´æµé‡æ”¾å€’</li></ol><h4 id="4-2-2-é—®é¢˜æ’æŸ¥"><a href="#4-2-2-é—®é¢˜æ’æŸ¥" class="headerlink" title="4.2.2 é—®é¢˜æ’æŸ¥"></a>4.2.2 é—®é¢˜æ’æŸ¥</h4><ol><li>åœ¨ä¸€ä¸ª<font color="FF0000"><strong>è¾ƒçŸ­</strong></font>çš„æ—¶é—´å†…ï¼Œç¼“å­˜ä¸­<font color="FF0000">è¾ƒå¤š</font>çš„key<font color="FF0000"><strong>é›†ä¸­è¿‡æœŸ</strong></font></li><li>æ­¤å‘¨æœŸå†…è¯·æ±‚è®¿é—®è¿‡æœŸçš„æ•°æ®ï¼Œredisæœªå‘½ä¸­ï¼Œrediså‘æ•°æ®åº“è·å–æ•°æ®</li><li>æ•°æ®åº“åŒæ—¶æ¥æ”¶åˆ°å¤§é‡çš„è¯·æ±‚æ— æ³•åŠæ—¶å¤„ç†</li><li>Rediså¤§é‡è¯·æ±‚è¢«ç§¯å‹ï¼Œå¼€å§‹å‡ºç°è¶…æ—¶ç°è±¡</li><li>æ•°æ®åº“æµé‡æ¿€å¢ï¼Œæ•°æ®åº“å´©æºƒ</li><li>é‡å¯åä»ç„¶é¢å¯¹ç¼“å­˜ä¸­æ— æ•°æ®å¯ç”¨</li><li>RedisæœåŠ¡å™¨èµ„æºè¢«ä¸¥é‡å ç”¨ï¼ŒRedisæœåŠ¡å™¨å´©æºƒ</li><li>Redisé›†ç¾¤å‘ˆç°å´©å¡Œï¼Œé›†ç¾¤ç“¦è§£</li><li>åº”ç”¨æœåŠ¡å™¨æ— æ³•åŠæ—¶å¾—åˆ°æ•°æ®å“åº”è¯·æ±‚ï¼Œæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ•°é‡è¶Šæ¥è¶Šå¤šï¼Œåº”ç”¨æœåŠ¡å™¨å´©æºƒ</li><li>åº”ç”¨æœåŠ¡å™¨ï¼Œredisï¼Œæ•°æ®åº“å…¨éƒ¨é‡å¯ï¼Œæ•ˆæœä¸ç†æƒ³</li></ol><h4 id="4-2-3-é—®é¢˜åˆ†æ"><a href="#4-2-3-é—®é¢˜åˆ†æ" class="headerlink" title="4.2.3 é—®é¢˜åˆ†æ"></a>4.2.3 é—®é¢˜åˆ†æ</h4><ul><li>çŸ­æ—¶é—´èŒƒå›´å†…</li><li>å¤§é‡keyé›†ä¸­è¿‡æœŸ</li></ul><h4 id="4-2-4-è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰"><a href="#4-2-4-è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰" class="headerlink" title="4.2.4 è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰"></a>4.2.4 è§£å†³æ–¹æ¡ˆï¼ˆé“ï¼‰</h4><ol><li><p>æ›´å¤šçš„é¡µé¢é™æ€åŒ–å¤„ç†</p></li><li><p>æ„å»º<strong>å¤šçº§ç¼“å­˜æ¶æ„</strong> </p><ul><li>Nginxç¼“å­˜+redisç¼“å­˜+ehcacheç¼“å­˜</li></ul></li><li><p>æ£€æµ‹Mysqlä¸¥é‡è€—æ—¶ä¸šåŠ¡è¿›è¡Œä¼˜åŒ– </p><ul><li>å¯¹æ•°æ®åº“çš„ç“¶é¢ˆæ’æŸ¥ï¼šä¾‹å¦‚è¶…æ—¶æŸ¥è¯¢ã€è€—æ—¶è¾ƒé«˜äº‹åŠ¡ç­‰</li></ul></li><li><p>ç¾éš¾é¢„è­¦æœºåˆ¶ </p><p>ç›‘æ§redisæœåŠ¡å™¨æ€§èƒ½æŒ‡æ ‡</p><ul><li>CPUå ç”¨ã€CPUä½¿ç”¨ç‡</li><li>å†…å­˜å®¹é‡</li><li>æŸ¥è¯¢å¹³å‡å“åº”æ—¶é—´</li><li>çº¿ç¨‹æ•°</li></ul></li><li><p>é™æµã€é™çº§ </p><ul><li>çŸ­æ—¶é—´èŒƒå›´å†…ç‰ºç‰²ä¸€äº›å®¢æˆ·ä½“éªŒï¼Œé™åˆ¶ä¸€éƒ¨åˆ†è¯·æ±‚è®¿é—®ï¼Œé™ä½åº”ç”¨æœåŠ¡å™¨å‹åŠ›ï¼Œå¾…ä¸šåŠ¡ä½é€Ÿè¿è½¬åå†é€æ­¥æ”¾å¼€è®¿é—®</li></ul></li></ol><h4 id="4-2-5-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"><a href="#4-2-5-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰" class="headerlink" title="4.2.5 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"></a>4.2.5 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰</h4><ol><li>LRUä¸LFUåˆ‡æ¢</li><li>æ•°æ®æœ‰æ•ˆæœŸç­–ç•¥è°ƒæ•´<ul><li>æ ¹æ®ä¸šåŠ¡æ•°æ®æœ‰æ•ˆæœŸè¿›è¡Œ<strong>åˆ†ç±»é”™å³°</strong>ï¼ŒAç±»90åˆ†é’Ÿï¼ŒBç±»80åˆ†é’Ÿï¼ŒCç±»70åˆ†é’Ÿ</li><li>è¿‡æœŸæ—¶é—´ä½¿ç”¨å›ºå®šæ—¶é—´+éšæœºå€¼çš„å½¢å¼ï¼Œ<strong>ç¨€é‡Š</strong>é›†ä¸­åˆ°æœŸçš„keyçš„æ•°é‡</li></ul></li><li><strong>è¶…çƒ­</strong>æ•°æ®ä½¿ç”¨æ°¸ä¹…key</li><li>å®šæœŸç»´æŠ¤ï¼ˆè‡ªåŠ¨+äººå·¥ï¼‰ <ul><li>å¯¹å³å°†è¿‡æœŸæ•°æ®åšè®¿é—®é‡åˆ†æï¼Œç¡®è®¤æ˜¯å¦å»¶æ—¶ï¼Œé…åˆè®¿é—®é‡ç»Ÿè®¡ï¼Œåšçƒ­ç‚¹æ•°æ®çš„å»¶æ—¶</li></ul></li><li>åŠ é” <strong>æ…ç”¨ï¼</strong></li></ol><h4 id="4-2-6-æ€»ç»“"><a href="#4-2-6-æ€»ç»“" class="headerlink" title="4.2.6 æ€»ç»“"></a>4.2.6 æ€»ç»“</h4><p>ç¼“å­˜é›ªå´©å°±æ˜¯<strong>ç¬é—´è¿‡æœŸæ•°æ®é‡å¤ªå¤§</strong>ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚å¦‚èƒ½å¤Ÿ<strong>æœ‰æ•ˆé¿å…è¿‡æœŸæ—¶é—´é›†ä¸­</strong>ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³é›ªå´©ç°è±¡çš„å‡ºç° ï¼ˆçº¦40%ï¼‰ï¼Œé…åˆå…¶ä»–ç­–ç•¥ä¸€èµ·ä½¿ç”¨ï¼Œå¹¶ç›‘æ§æœåŠ¡å™¨çš„è¿è¡Œæ•°æ®ï¼Œæ ¹æ®è¿è¡Œè®°å½•åšå¿«é€Ÿè°ƒæ•´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_66_20210328.png"></p><h3 id="4-3-ç¼“å­˜å‡»ç©¿"><a href="#4-3-ç¼“å­˜å‡»ç©¿" class="headerlink" title="4.3 ç¼“å­˜å‡»ç©¿"></a>4.3 ç¼“å­˜å‡»ç©¿</h3><h4 id="4-3-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ2ï¼‰"><a href="#4-3-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ2ï¼‰" class="headerlink" title="4.3.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ2ï¼‰"></a>4.3.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ2ï¼‰</h4><ol><li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­</li><li>æ•°æ®åº“è¿æ¥é‡<strong>ç¬é—´æ¿€å¢</strong></li><li>RedisæœåŠ¡å™¨æ— å¤§é‡keyè¿‡æœŸ</li><li>Rediså†…å­˜å¹³ç¨³ï¼Œæ— æ³¢åŠ¨</li><li>RedisæœåŠ¡å™¨CPUæ­£å¸¸</li><li><strong>æ•°æ®åº“å´©æºƒ</strong></li></ol><h4 id="4-3-2-é—®é¢˜æ’æŸ¥"><a href="#4-3-2-é—®é¢˜æ’æŸ¥" class="headerlink" title="4.3.2 é—®é¢˜æ’æŸ¥"></a>4.3.2 é—®é¢˜æ’æŸ¥</h4><ol><li>Redisä¸­<font color="FF0000"><strong>æŸä¸ªkeyè¿‡æœŸï¼Œè¯¥keyè®¿é—®é‡å·¨å¤§</strong></font></li><li>å¤šä¸ªæ•°æ®è¯·æ±‚ä»æœåŠ¡å™¨ç›´æ¥å‹åˆ°Redisåï¼Œå‡æœªå‘½ä¸­</li><li>Redisåœ¨çŸ­æ—¶é—´å†…å‘èµ·äº†å¤§é‡å¯¹æ•°æ®åº“ä¸­åŒä¸€æ•°æ®çš„è®¿é—®</li></ol><h4 id="4-3-3-é—®é¢˜åˆ†æ"><a href="#4-3-3-é—®é¢˜åˆ†æ" class="headerlink" title="4.3.3 é—®é¢˜åˆ†æ"></a>4.3.3 é—®é¢˜åˆ†æ</h4><ul><li>å•ä¸ªkeyé«˜çƒ­æ•°æ®</li><li>keyè¿‡æœŸ</li></ul><h4 id="4-3-4-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"><a href="#4-3-4-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰" class="headerlink" title="4.3.4 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"></a>4.3.4 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰</h4><ol><li><p>é¢„å…ˆè®¾å®š</p><p>ä»¥ç”µå•†ä¸ºä¾‹ï¼Œæ¯ä¸ªå•†å®¶æ ¹æ®åº—é“ºç­‰çº§ï¼ŒæŒ‡å®šè‹¥å¹²æ¬¾ä¸»æ‰“å•†å“ï¼Œåœ¨è´­ç‰©èŠ‚æœŸé—´ï¼Œ<strong>åŠ å¤§</strong>æ­¤ç±»ä¿¡æ¯keyçš„<strong>è¿‡æœŸæ—¶é•¿</strong></p><p>æ³¨æ„ï¼šè´­ç‰©èŠ‚ä¸ä»…ä»…æŒ‡å½“å¤©ï¼Œä»¥åŠåç»­è‹¥å¹²å¤©ï¼Œè®¿é—®å³°å€¼å‘ˆç°é€æ¸é™ä½çš„è¶‹åŠ¿</p></li><li><p>ç°åœºè°ƒæ•´</p><ul><li>ç›‘æ§è®¿é—®é‡ï¼Œå¯¹è‡ªç„¶æµé‡æ¿€å¢çš„æ•°æ®å»¶é•¿è¿‡æœŸæ—¶é—´æˆ–è®¾ç½®ä¸ºæ°¸ä¹…æ€§key</li></ul></li><li><p>åå°åˆ·æ–°æ•°æ®</p><ul><li>å¯åŠ¨å®šæ—¶ä»»åŠ¡ï¼Œé«˜å³°æœŸæ¥ä¸´ä¹‹å‰ï¼Œåˆ·æ–°æ•°æ®æœ‰æ•ˆæœŸï¼Œç¡®ä¿ä¸ä¸¢å¤±</li></ul></li><li><p>äºŒçº§ç¼“å­˜</p><ul><li>è®¾ç½®ä¸åŒçš„å¤±æ•ˆæ—¶é—´ï¼Œä¿éšœä¸ä¼šè¢«<font color="FF0000">åŒæ—¶</font>æ·˜æ±°å°±è¡Œ</li></ul></li><li><p>åŠ é” åˆ†å¸ƒå¼é”ï¼Œé˜²æ­¢è¢«å‡»ç©¿ï¼Œä½†æ˜¯è¦æ³¨æ„ä¹Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œ<strong>æ…é‡ï¼</strong></p></li></ol><h4 id="4-3-5-æ€»ç»“"><a href="#4-3-5-æ€»ç»“" class="headerlink" title="4.3.5 æ€»ç»“"></a>4.3.5 æ€»ç»“</h4><p>ç¼“å­˜å‡»ç©¿å°±æ˜¯<strong>å•ä¸ªé«˜çƒ­æ•°æ®è¿‡æœŸçš„ç¬é—´</strong>ï¼Œæ•°æ®è®¿é—®é‡è¾ƒå¤§ï¼Œæœªå‘½ä¸­redisåï¼Œå‘èµ·äº†å¤§é‡å¯¹åŒä¸€æ•°æ®çš„æ•°æ®åº“é—®ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚åº”å¯¹ç­–ç•¥åº”è¯¥åœ¨ä¸šåŠ¡æ•°æ®åˆ†æä¸é¢„é˜²æ–¹é¢è¿›è¡Œï¼Œé…åˆè¿è¡Œç›‘æ§æµ‹è¯•ä¸å³æ—¶è°ƒæ•´ç­–ç•¥ï¼Œæ¯•ç«Ÿå•ä¸ªkeyçš„è¿‡æœŸç›‘æ§éš¾åº¦è¾ƒé«˜ï¼Œé…åˆé›ªå´©å¤„ç†ç­–ç•¥å³å¯</p><h3 id="4-4-ç¼“å­˜ç©¿é€"><a href="#4-4-ç¼“å­˜ç©¿é€" class="headerlink" title="4.4 ç¼“å­˜ç©¿é€"></a>4.4 ç¼“å­˜ç©¿é€</h3><h4 id="4-4-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ3ï¼‰"><a href="#4-4-1-æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ3ï¼‰" class="headerlink" title="4.4.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ3ï¼‰"></a>4.4.1 æ•°æ®åº“æœåŠ¡å™¨å´©æºƒï¼ˆ3ï¼‰</h4><ol><li>ç³»ç»Ÿå¹³ç¨³è¿è¡Œè¿‡ç¨‹ä¸­</li><li>åº”ç”¨æœåŠ¡å™¨æµé‡éšæ—¶é—´å¢é‡è¾ƒå¤§</li><li>RedisæœåŠ¡å™¨å‘½ä¸­ç‡éšæ—¶é—´é€æ­¥é™ä½</li><li>Rediså†…å­˜å¹³ç¨³ï¼Œå†…å­˜æ— å‹åŠ›</li><li>RedisæœåŠ¡å™¨CPUå ç”¨æ¿€å¢</li><li>æ•°æ®åº“æœåŠ¡å™¨å‹åŠ›æ¿€å¢</li><li><strong>æ•°æ®åº“å´©æºƒ</strong></li></ol><h4 id="4-4-2-é—®é¢˜æ’æŸ¥"><a href="#4-4-2-é—®é¢˜æ’æŸ¥" class="headerlink" title="4.4.2 é—®é¢˜æ’æŸ¥"></a>4.4.2 é—®é¢˜æ’æŸ¥</h4><ol><li>Redisä¸­å¤§é¢ç§¯å‡ºé™æœªå‘½ä¸­</li><li>å‡ºç°<font color="FF0000"><strong>éæ­£å¸¸URLè®¿é—®</strong></font></li></ol><h4 id="4-4-3-é—®é¢˜åˆ†æ"><a href="#4-4-3-é—®é¢˜åˆ†æ" class="headerlink" title="4.4.3 é—®é¢˜åˆ†æ"></a>4.4.3 é—®é¢˜åˆ†æ</h4><ul><li>è·å–çš„æ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæ•°æ®åº“æŸ¥è¯¢æœªå¾—åˆ°å¯¹äºæ•°æ®</li><li>Redisè·å–åˆ°nullæ•°æ®æœªè¿›è¡ŒæŒä¹…åŒ–ï¼Œç›´æ¥è¿”å›</li><li>ä¸‹æ¬¡æ­¤ç±»æ•°æ®åˆ°è¾¾é‡å¤ä¸Šè¿°è¿‡ç¨‹</li><li>å‡ºé™é»‘å®¢æ”»å‡»æœåŠ¡å™¨</li></ul><h4 id="4-4-4-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"><a href="#4-4-4-è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰" class="headerlink" title="4.4.4 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰"></a>4.4.4 è§£å†³æ–¹æ¡ˆï¼ˆæœ¯ï¼‰</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_67_20210328.png"></p><h4 id="4-4-5-æ€»ç»“"><a href="#4-4-5-æ€»ç»“" class="headerlink" title="4.4.5 æ€»ç»“"></a>4.4.5 æ€»ç»“</h4><p>ç¼“å­˜åŸºç¡€è®¿é—®äº†ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè·³è¿‡äº†åˆæ³•æ•°æ®çš„redisæ•°æ®ç¼“å­˜é˜¶æ®µï¼Œæ¯æ¬¡è®¿é—®æ•°æ®åº“ï¼Œå¯¼è‡´å¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆå‹åŠ›ã€‚é€šå¸¸æ­¤ç±»æ•°æ®çš„å‡ºç°é‡æ˜¯ä¸€ä¸ªè¾ƒä½å€¼ï¼Œå½“å‡ºç°æ­¤ç±»æƒ…å†µä»¥æ¯’æ”»æ¯’ï¼Œå¹¶å³ä½¿æŠ¥è­¦ã€‚åº”å¯¹ç­–ç•¥åº”è¯¥åœ¨ä¸´æ—¶é¢„æ¡ˆé˜²èŒƒæ–¹é¢å¤šåšæ–‡ç« ã€‚</p><p>ï¼ˆç›®æ ‡å°±æ˜¯æ‹¦åœ¨æœåŠ¡å™¨å¤–é¢ï¼Œç”¨bitmapså°±æ˜¯æ‹¦åˆ°rediså’ŒæœåŠ¡å™¨ä¸­é—´ï¼Œç”¨åŠ å¯†keyå°±æ˜¯æ‹¦åˆ°åº”ç”¨æœåŠ¡å™¨å¤–é¢ï¼‰</p><p>æ— è®ºæ˜¯é»‘åå•è¿˜æ˜¯ç™½åå•ï¼Œéƒ½æ˜¯å¯¹æ•´ä½“ç³»ç»Ÿçš„å‹åŠ›ï¼Œè­¦æŠ¥è§£é™¤åå°½å¿«ç§»é™¤ã€‚</p><h3 id="4-5-æ€§èƒ½æŒ‡æ ‡ç›‘æ§"><a href="#4-5-æ€§èƒ½æŒ‡æ ‡ç›‘æ§" class="headerlink" title="4.5 æ€§èƒ½æŒ‡æ ‡ç›‘æ§"></a>4.5 æ€§èƒ½æŒ‡æ ‡ç›‘æ§</h3><h4 id="4-5-1-ç›‘æ§æŒ‡æ ‡"><a href="#4-5-1-ç›‘æ§æŒ‡æ ‡" class="headerlink" title="4.5.1 ç›‘æ§æŒ‡æ ‡"></a>4.5.1 ç›‘æ§æŒ‡æ ‡</h4><ul><li><p>æ€§èƒ½æŒ‡æ ‡ï¼šPerformance</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_68_20210328.png"></p></li><li><p>å†…å­˜æŒ‡æ ‡ï¼š Memory</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_69_20210328.png"></p></li><li><p>åŸºæœ¬æ´»åŠ¨æŒ‡æ ‡ï¼šBasic acticity</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_70_20210328.png"></p></li><li><p>æŒä¹…æ€§æŒ‡æ ‡ï¼šPersistence</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_71_20210328.png"></p></li><li><p>é”™è¯¯æŒ‡æ ‡ï¼šError</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_72_20210328.png"></p></li></ul><h4 id="4-5-2-ç›‘æ§æ–¹å¼"><a href="#4-5-2-ç›‘æ§æ–¹å¼" class="headerlink" title="4.5.2 ç›‘æ§æ–¹å¼"></a>4.5.2 ç›‘æ§æ–¹å¼</h4><ul><li>å·¥å…·<ul><li>Cloud Insight Redis</li><li>Prometheus</li><li>Redis-stat</li><li>Redis-faina</li><li>RedisLive</li><li>zabbix</li></ul></li><li>å‘½ä»¤<ul><li>benchmark</li><li>redis cli<ul><li>monitor</li><li>showlog</li></ul></li></ul></li></ul><h5 id="benchmark"><a href="#benchmark" class="headerlink" title="benchmark"></a>benchmark</h5><ul><li><p>å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">redis-benchmark [-h ] [-p ] [-c ] [-n &lt;requests]&gt; [-k ]<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_73_20210328.png"></p></li></ul><h5 id="monitor"><a href="#monitor" class="headerlink" title="monitor"></a>monitor</h5><ul><li><p>å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">monitor<br></code></pre></td></tr></table></figure><p>æ‰“å°æœåŠ¡å™¨è°ƒè¯•ä¿¡æ¯</p></li></ul><h5 id="showlog"><a href="#showlog" class="headerlink" title="showlog"></a>showlog</h5><ul><li><p>å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">slowlog [operator]<br></code></pre></td></tr></table></figure><ul><li>getï¼šè·å–æ…¢æŸ¥è¯¢æ—¥å¿—</li><li>lenï¼šè·å–æ…¢æŸ¥è¯¢æ—¥å¿—æ¡ç›®æ•°</li><li>resetï¼šå……å€¼æ…¢æŸ¥è¯¢æ—¥å¿—</li></ul></li><li><p>ç›¸å…³é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">slowlog-log-slower-than 1000 # è®¾ç½®æ…¢æŸ¥è¯¢çš„æ—¶é—´ä¸‹é™ï¼Œå•ä½ms<br>slowlog-max-len 100          # è®¾ç½®æ…¢æŸ¥è¯¢å‘½ä»¤å¯¹åº”çš„æ—¥å¿—æ˜¾ç¤ºé•¿åº¦ï¼Œå•ä½å‘½ä»¤æ•°<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisé«˜çº§</title>
    <link href="/2021/03/27/Redis%E9%AB%98%E7%BA%A7/"/>
    <url>/2021/03/27/Redis%E9%AB%98%E7%BA%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="Redisé«˜çº§"><a href="#Redisé«˜çº§" class="headerlink" title="Redisé«˜çº§"></a>Redisé«˜çº§</h1><p>åŸºäº<a href="https://www.bilibili.com/video/BV1CJ411m7Gc">é»‘é©¬Redis</a>çš„è§†é¢‘çš„å­¦ä¹ ç¬”è®°</p><h2 id="1-Linuxç¯èŠ‚å®‰è£…"><a href="#1-Linuxç¯èŠ‚å®‰è£…" class="headerlink" title="1. Linuxç¯èŠ‚å®‰è£…"></a>1. Linuxç¯èŠ‚å®‰è£…</h2><h3 id="1-1-å®‰è£…"><a href="#1-1-å®‰è£…" class="headerlink" title="1.1 å®‰è£…"></a>1.1 å®‰è£…</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_12_20210326.png"></p><h3 id="1-2-å¯åŠ¨æ–¹å¼"><a href="#1-2-å¯åŠ¨æ–¹å¼" class="headerlink" title="1.2 å¯åŠ¨æ–¹å¼"></a>1.2 å¯åŠ¨æ–¹å¼</h3><ul><li>æ™®é€šé»˜è®¤ç«¯å£å¯åŠ¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> é»˜è®¤ç«¯å£å¼€å¯</span><br>redis-serve<br><span class="hljs-meta">#</span><span class="bash"> é»˜è®¤ç«¯å£è¿æ¥</span><br>redis-cli<br></code></pre></td></tr></table></figure><ul><li>æŒ‡å®šç«¯å£å¯åŠ¨</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ¢ç«¯å£å¯åŠ¨</span><br>redis-server --port 6380<br><span class="hljs-meta">#</span><span class="bash"> è¿æ¥å®¢æˆ·ç«¯æŒ‡å®šç«¯å£è¿æ¥</span><br>redis-cli -p 6380<br></code></pre></td></tr></table></figure><ul><li>æŒ‡å®šé…ç½®æ–‡ä»¶å¯åŠ¨ redis-6379.conf</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">port</span> <span class="hljs-number">6379</span><br><span class="hljs-attribute">daemonize</span> yes<br><span class="hljs-attribute">logfile</span> <span class="hljs-string">&quot;6379.log&quot;</span><br><span class="hljs-attribute">dir</span> /redis-<span class="hljs-number">4</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>/data<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å¯åŠ¨</span><br>redis-server redis-6379.conf<br>redis-server conf/redis-6379.conf<br><span class="hljs-meta">#</span><span class="bash"> è¿æ¥</span><br>redis-cli<br></code></pre></td></tr></table></figure><h2 id="2-æŒä¹…åŒ–"><a href="#2-æŒä¹…åŒ–" class="headerlink" title="2. æŒä¹…åŒ–"></a>2. æŒä¹…åŒ–</h2><h3 id="2-1-åŸºæœ¬ä»‹ç»"><a href="#2-1-åŸºæœ¬ä»‹ç»" class="headerlink" title="2.1 åŸºæœ¬ä»‹ç»"></a>2.1 åŸºæœ¬ä»‹ç»</h3><blockquote><p>ä»€ä¹ˆæ˜¯æŒä¹…åŒ–ï¼š</p></blockquote><p>åˆ©ç”¨æ°¸ä¹…æ€§å­˜å‚¨ä»‹è´¨å°†æ•°æ®è¿›è¡Œä¿å­˜ï¼Œåœ¨ç‰¹å®šçš„æ—¶é—´å°†ä¿å­˜çš„æ•°æ®è¿›è¡Œæ¢å¤çš„å·¥ä½œæœºåˆ¶</p><blockquote><p>ä¸ºä»€ä¹ˆè¦æŒä¹…åŒ–ï¼š</p></blockquote><p>é˜²æ­¢æ•°æ®çš„æ„å¤–ä¸¢å¤±ï¼Œç¡®ä¿æ•°æ®å®‰å…¨</p><blockquote><p>æŒä¹…åŒ–è¿‡ç¨‹ä¿å­˜ä»€ä¹ˆ</p></blockquote><ul><li>å°†å½“å‰<strong>æ•°æ®çŠ¶æ€</strong>è¿›è¡Œä¿å­˜ï¼Œ<strong>å¿«ç…§</strong>å½¢å¼ï¼Œå­˜å‚¨æ•°æ®ç»“æœï¼Œå­˜å‚¨æ ¼å¼ç®€å•ï¼Œå…³æ³¨ç‚¹åœ¨<strong>æ•°æ®</strong></li><li>å°†æ•°æ®çš„<strong>æ“ä½œè¿‡ç¨‹</strong>è¿›è¡Œä¿å­˜ï¼Œ<strong>æ—¥å¿—</strong>å½¢å¼ï¼Œå­˜å‚¨æ“ä½œè¿‡ç¨‹ï¼Œå­˜å‚¨æ ¼å¼å¤æ‚ï¼Œå…³æ³¨ç‚¹åœ¨æ•°æ®çš„æ“ä½œ<strong>è¿‡ç¨‹</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_13_20210326.png"></p><h3 id="2-2-RDB"><a href="#2-2-RDB" class="headerlink" title="2.2 RDB"></a>2.2 RDB</h3><h4 id="2-2-1-RDBå¯åŠ¨æ–¹å¼1â€“saveæŒ‡ä»¤"><a href="#2-2-1-RDBå¯åŠ¨æ–¹å¼1â€“saveæŒ‡ä»¤" class="headerlink" title="2.2.1 RDBå¯åŠ¨æ–¹å¼1â€“saveæŒ‡ä»¤"></a>2.2.1 RDBå¯åŠ¨æ–¹å¼1â€“saveæŒ‡ä»¤</h4><h5 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h5><ul><li><p>å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">save<br></code></pre></td></tr></table></figure></li><li><p>ä½œç”¨</p><p>æ‰‹åŠ¨æ‰§è¡Œä¸€æ¬¡ä¿å­˜æ“ä½œ</p></li></ul><h5 id="ç›¸å…³é…ç½®"><a href="#ç›¸å…³é…ç½®" class="headerlink" title="ç›¸å…³é…ç½®"></a>ç›¸å…³é…ç½®</h5><ul><li>dbfilename dump.rdb<ul><li>è¯´æ˜ï¼šè®¾ç½®æœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤å€¼ä¸º dump.rdb</li><li>ç»éªŒï¼šé€šå¸¸è®¾ç½®ä¸º<font color="0000FF"><strong>dump-</strong></font><font color="FF0000"><strong>ç«¯å£å·</strong></font><font color="0000FF"><strong>.rdb</strong></font></li></ul></li><li>dir<ul><li>è¯´æ˜ï¼šè®¾ç½®å­˜å‚¨.rdbæ–‡ä»¶çš„è·¯å¾„</li><li>ç»éªŒï¼šé€šå¸¸è®¾ç½®æˆå­˜å‚¨ç©ºé—´è¾ƒå¤§çš„ç›®å½•ä¸­ï¼Œç›®å½•åç§°<font color="FF0000"><strong>data</strong></font></li></ul></li><li>rdbcompression yes<ul><li>è¯´æ˜ï¼šè®¾ç½®å­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸º yesï¼Œé‡‡ç”¨ LZF å‹ç¼©</li><li>ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®ä¸ºnoï¼Œå¯ä»¥èŠ‚çœ CPU è¿è¡Œæ—¶é—´ï¼Œä½†ä¼šä½¿å­˜å‚¨çš„æ–‡ä»¶å˜å¤§ï¼ˆå·¨å¤§ï¼‰</li></ul></li><li>rdbchecksum yes<ul><li>è¯´æ˜ï¼šè®¾ç½®æ˜¯å¦è¿›è¡ŒRDBæ–‡ä»¶æ ¼å¼æ ¡éªŒï¼Œè¯¥æ ¡éªŒè¿‡ç¨‹åœ¨å†™æ–‡ä»¶å’Œè¯»æ–‡ä»¶è¿‡ç¨‹å‡è¿›è¡Œ</li><li>ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€ï¼Œå¦‚æœè®¾ç½®ä¸ºnoï¼Œå¯ä»¥èŠ‚çº¦è¯»å†™æ€§è¿‡ç¨‹çº¦10%æ—¶é—´æ¶ˆè€—ï¼Œä½†æ˜¯å­˜å‚¨ä¸€å®šçš„æ•°æ®æŸåé£é™©</li></ul></li></ul><p>é…ç½®åï¼Œconfæ–‡ä»¶å†…å®¹ä¸ºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_14_20210326.png"></p><h5 id="saveæŒ‡ä»¤å·¥ä½œåŸç†"><a href="#saveæŒ‡ä»¤å·¥ä½œåŸç†" class="headerlink" title="saveæŒ‡ä»¤å·¥ä½œåŸç†"></a>saveæŒ‡ä»¤å·¥ä½œåŸç†</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_15_20210326.png"></p><h4 id="2-2-2-RDBå¯åŠ¨æ–¹å¼2â€“bgsaveæŒ‡ä»¤"><a href="#2-2-2-RDBå¯åŠ¨æ–¹å¼2â€“bgsaveæŒ‡ä»¤" class="headerlink" title="2.2.2 RDBå¯åŠ¨æ–¹å¼2â€“bgsaveæŒ‡ä»¤"></a>2.2.2 RDBå¯åŠ¨æ–¹å¼2â€“bgsaveæŒ‡ä»¤</h4><h5 id="å¯åŠ¨-1"><a href="#å¯åŠ¨-1" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h5><ul><li><p>å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">bgsave<br></code></pre></td></tr></table></figure></li><li><p>ä½œç”¨</p><p>æ‰‹åŠ¨å¯åŠ¨åå°ä¿å­˜æ“ä½œï¼Œä½†<strong>ä¸æ˜¯ç«‹å³æ‰§è¡Œ</strong></p></li></ul><h5 id="ç›¸å…³é…ç½®-1"><a href="#ç›¸å…³é…ç½®-1" class="headerlink" title="ç›¸å…³é…ç½®"></a>ç›¸å…³é…ç½®</h5><ul><li><p>dbfilename dump.rdbï¼ˆåŒsaveï¼‰</p></li><li><p>dirï¼ˆåŒsaveï¼‰</p></li><li><p>rdbcompression yesï¼ˆåŒsaveï¼‰</p></li><li><p>rdbchecksum yesï¼ˆåŒsaveï¼‰</p></li><li><p>stop-writes-on-bgsave-error yes</p><ul><li>è¯´æ˜ï¼šåå°å­˜å‚¨è¿‡ç¨‹ä¸­å¦‚æœå‡ºç°é”™è¯¯ç°è±¡ï¼Œæ˜¯å¦åœæ­¢ä¿å­˜ç°è±¡</li><li>ç»éªŒï¼šé€šå¸¸é»˜è®¤ä¸ºå¼€å¯çŠ¶æ€</li></ul></li></ul><h5 id="bgsaveæŒ‡ä»¤å·¥ä½œåŸç†"><a href="#bgsaveæŒ‡ä»¤å·¥ä½œåŸç†" class="headerlink" title="bgsaveæŒ‡ä»¤å·¥ä½œåŸç†"></a>bgsaveæŒ‡ä»¤å·¥ä½œåŸç†</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_16_20210326.png"></p><h4 id="2-2-3-RDBå¯åŠ¨æ–¹å¼3â€“saveé…ç½®"><a href="#2-2-3-RDBå¯åŠ¨æ–¹å¼3â€“saveé…ç½®" class="headerlink" title="2.2.3 RDBå¯åŠ¨æ–¹å¼3â€“saveé…ç½®"></a>2.2.3 RDBå¯åŠ¨æ–¹å¼3â€“saveé…ç½®</h4><h5 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h5><ul><li><p>é…ç½®åˆ°.confæ–‡ä»¶</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">save</span> <span class="hljs-built_in">second</span> changes<br></code></pre></td></tr></table></figure><p>é…ç½®åï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_17_20210326.png"></p></li><li><p>ä½œç”¨</p><p>æ»¡è¶³<strong>é™å®šæ—¶é—´</strong>èŒƒå›´å†…keyçš„å˜åŒ–æ•°é‡è¾¾åˆ°<strong>æŒ‡å®šæ•°é‡</strong>å³è¿›è¡ŒæŒä¹…åŒ–</p></li><li><p>å‚æ•°</p><ul><li>secondï¼šç›‘æ§æ—¶é—´èŒƒå›´</li><li>changesï¼šç›‘æ§keyçš„å˜åŒ–é‡</li></ul></li></ul><h5 id="saveé…ç½®å·¥ä½œåŸç†"><a href="#saveé…ç½®å·¥ä½œåŸç†" class="headerlink" title="saveé…ç½®å·¥ä½œåŸç†"></a>saveé…ç½®å·¥ä½œåŸç†</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_18_20210326.png"></p><p>æ³¨æ„ï¼š</p><ul><li>saveé…ç½®è¦æ ¹æ®å®é™…ä¸šåŠ¡æƒ…å†µè¿›è¡Œè®¾ç½®ï¼Œé¢‘åº¦è¿‡é«˜æˆ–è¿‡ä½éƒ½ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ï¼Œç»“æœå¯èƒ½æ˜¯ç¾éš¾æ€§çš„</li><li>saveé…ç½®ä¸­å¯¹äºsecondä¸changesè®¾ç½®é€šå¸¸å…·æœ‰<strong>äº’è¡¥å¯¹åº”</strong>å…³ç³»ï¼ˆä¸€ä¸ªå¤§ä¸€ä¸ªå°ï¼‰ï¼Œå°½é‡ä¸è¦è®¾ç½®æˆåŒ…å«æ€§å…³ç³»</li><li>saveé…ç½®å¯åŠ¨åæ‰§è¡Œçš„æ˜¯<strong>bgsaveæ“ä½œ</strong></li></ul><h4 id="2-2-4-ä¸‰ç§å¯åŠ¨æ–¹å¼å¯¹æ¯”"><a href="#2-2-4-ä¸‰ç§å¯åŠ¨æ–¹å¼å¯¹æ¯”" class="headerlink" title="2.2.4 ä¸‰ç§å¯åŠ¨æ–¹å¼å¯¹æ¯”"></a>2.2.4 ä¸‰ç§å¯åŠ¨æ–¹å¼å¯¹æ¯”</h4><table><thead><tr><th>æ–¹å¼</th><th>saveæŒ‡ä»¤</th><th>bgsaveæŒ‡ä»¤</th></tr></thead><tbody><tr><td>è¯»å†™</td><td>åŒæ­¥</td><td>å¼‚æ­¥</td></tr><tr><td>é˜»å¡å®¢æˆ·ç«¯æŒ‡ä»¤</td><td>æ˜¯</td><td>å¦</td></tr><tr><td>é¢å¤–å†…å­˜æ¶ˆè€—</td><td>å¦</td><td>æ˜¯</td></tr><tr><td>å¯åŠ¨æ–°çº¿ç¨‹</td><td>å¦</td><td>æ˜¯</td></tr></tbody></table><h4 id="2-2-5-RDBç‰¹æ®Šå¯åŠ¨å½¢å¼ï¼ˆäº†è§£ï¼‰"><a href="#2-2-5-RDBç‰¹æ®Šå¯åŠ¨å½¢å¼ï¼ˆäº†è§£ï¼‰" class="headerlink" title="2.2.5 RDBç‰¹æ®Šå¯åŠ¨å½¢å¼ï¼ˆäº†è§£ï¼‰"></a>2.2.5 RDBç‰¹æ®Šå¯åŠ¨å½¢å¼ï¼ˆäº†è§£ï¼‰</h4><ul><li><p>å…¨é‡å¤åˆ¶</p><p>åœ¨ä¸»ä»å¤åˆ¶ä¸­è¯¦ç»†è®²è§£</p></li><li><p>æœåŠ¡å™¨è¿è¡Œè¿‡ç¨‹ä¸­é‡å¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">debug reload<br></code></pre></td></tr></table></figure></li><li><p>å…³é—­æœåŠ¡å™¨æ—¶æŒ‡å®šä¿å­˜æ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">shutdown save<br></code></pre></td></tr></table></figure></li></ul><h4 id="2-2-6-RDBä¼˜ç¼ºç‚¹"><a href="#2-2-6-RDBä¼˜ç¼ºç‚¹" class="headerlink" title="2.2.6 RDBä¼˜ç¼ºç‚¹"></a>2.2.6 RDBä¼˜ç¼ºç‚¹</h4><ul><li>ä¼˜ç‚¹<ul><li>RDBæ˜¯ä¸€ä¸ªç´§å‡‘å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ<strong>å­˜å‚¨æ•ˆç‡è¾ƒé«˜</strong></li><li>RDBå†…éƒ¨å­˜å‚¨çš„æ˜¯redisåœ¨æŸä¸ªæ—¶é—´ç‚¹çš„æ•°æ®å¿«ç…§ï¼Œéå¸¸é€‚åˆç”¨äº<strong>æ•°æ®å¤‡ä»½ï¼Œå…¨é‡å¤åˆ¶</strong>ç­‰åœºæ™¯</li><li>RDBæ¢å¤æ•°æ®çš„<strong>é€Ÿåº¦</strong>è¦æ¯”AOF<strong>å¿«</strong>å¾ˆå¤š</li><li>åº”ç”¨ï¼šæœåŠ¡å™¨ä¸­æ¯Xå°æ—¶æ‰§è¡Œbgsaveå¤‡ä»½ï¼Œå¹¶å°†RDBæ–‡ä»¶æ‹·è´åˆ°è¿œç¨‹æœºå™¨ä¸­ï¼Œ<strong>ç”¨äºç¾éš¾æ¢å¤</strong></li></ul></li><li>ç¼ºç‚¹<ul><li>RDBæ–¹å¼æ— è®ºæ˜¯æ‰§è¡ŒæŒ‡ä»¤è¿˜æ˜¯åˆ©ç”¨é…ç½®ï¼Œ<strong>æ— æ³•åšåˆ°å®æ—¶æŒä¹…åŒ–</strong>ï¼Œå…·æœ‰è¾ƒå¤§çš„å¯èƒ½æ€§ä¸¢å¤±æ•°æ®</li><li>bgsaveæŒ‡ä»¤æ¯æ¬¡è¿è¡Œè¦æ‰§è¡Œforkæ“ä½œ<strong>åˆ›å»ºå­è¿›ç¨‹</strong>ï¼Œè¦<strong>ç‰ºç‰²</strong>æ‰ä¸€äº›<strong>æ€§èƒ½</strong></li><li>Redisçš„ä¼—å¤šç‰ˆæœ¬ä¸­æœªè¿›è¡ŒRDBæ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬ç»Ÿä¸€ï¼Œæœ‰å¯èƒ½å‡ºç°å„ç‰ˆæœ¬æœåŠ¡ä¹‹é—´æ•°æ®æ ¼å¼<strong>æ— æ³•å…¼å®¹</strong>ç°è±¡</li></ul></li></ul><h3 id="2-3-AOF"><a href="#2-3-AOF" class="headerlink" title="2.3 AOF"></a>2.3 AOF</h3><h4 id="2-3-1-AOFæ¦‚å¿µ"><a href="#2-3-1-AOFæ¦‚å¿µ" class="headerlink" title="2.3.1 AOFæ¦‚å¿µ"></a>2.3.1 AOFæ¦‚å¿µ</h4><ul><li>AOF(append only file)æŒä¹…åŒ–ï¼šä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•<strong>æ¯æ¬¡</strong>å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡ŒAOFæ–‡ä»¶ä¸­å‘½ä»¤ï¼Œä»¥è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚ä¸RDBç›¸æ¯”å¯ä»¥ç®€å•æè¿°ä¸ºæ”¹è®°å½•æ•°æ®ä¸ºè®°å½•æ•°æ®äº§ç”Ÿçš„è¿‡ç¨‹</li><li>AOFçš„ä¸»è¦ä½œç”¨æ˜¯è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯RedisæŒä¹…åŒ–çš„<strong>ä¸»æµ</strong>æ–¹å¼</li></ul><h4 id="2-3-2-AOFå†™æ•°æ®è¿‡ç¨‹"><a href="#2-3-2-AOFå†™æ•°æ®è¿‡ç¨‹" class="headerlink" title="2.3.2 AOFå†™æ•°æ®è¿‡ç¨‹"></a>2.3.2 AOFå†™æ•°æ®è¿‡ç¨‹</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_20_20210326.png"></p><h4 id="2-3-3-AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥-appendfsync"><a href="#2-3-3-AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥-appendfsync" class="headerlink" title="2.3.3 AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥(appendfsync)"></a>2.3.3 AOFå†™æ•°æ®ä¸‰ç§ç­–ç•¥(appendfsync)</h4><ul><li>alwaysï¼ˆæ¯æ¬¡ï¼‰<ul><li>æ¯æ¬¡å†™å…¥æ“ä½œå‡åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œ<font color="0000FF"><strong>æ•°æ®é›¶è¯¯å·®</strong></font>ï¼Œ<font color="FF0000"><strong>æ€§èƒ½è¾ƒä½</strong></font>ï¼Œ<strong>ä¸å»ºè®®ä½¿ç”¨</strong></li></ul></li><li>everysecï¼ˆæ¯ç§’ï¼‰<ul><li>æ¯ç§’å°†ç¼“å†²åŒºä¸­çš„æŒ‡ä»¤åŒæ­¥åˆ°AOFæ–‡ä»¶ä¸­ï¼Œæ•°æ®<font color="0000FF"><strong>å‡†ç¡®æ€§è¾ƒé«˜</strong></font>ï¼Œ<font color="0000FF"><strong>æ€§èƒ½è¾ƒé«˜</strong></font> ï¼Œ<strong>å»ºè®®ä½¿ç”¨</strong>ï¼Œä¹Ÿæ˜¯é»˜è®¤é…ç½®</li><li>åœ¨ç³»ç»Ÿçªç„¶å®•æœºçš„æƒ…å†µä¸‹ä¸¢å¤±1ç§’å†…çš„æ•°æ®</li></ul></li><li>noï¼ˆç³»ç»Ÿæ§åˆ¶ï¼‰<ul><li>ç”±æ“ä½œç³»ç»Ÿæ§åˆ¶æ¯æ¬¡åŒæ­¥åˆ°AOFæ–‡ä»¶çš„å‘¨æœŸï¼Œæ•´ä½“è¿‡ç¨‹<font color="FF0000"><strong>ä¸å¯æ§</strong></font></li></ul></li></ul><h4 id="2-3-4-AOFåŠŸèƒ½å¼€å¯"><a href="#2-3-4-AOFåŠŸèƒ½å¼€å¯" class="headerlink" title="2.3.4 AOFåŠŸèƒ½å¼€å¯"></a>2.3.4 AOFåŠŸèƒ½å¼€å¯</h4><ul><li><p>é…ç½®</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">appendonly</span> <span class="hljs-literal">yes</span>|<span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure><ul><li> ä½œç”¨</li></ul><p>  æ˜¯å¦å¼€å¯AOFæŒä¹…åŒ–åŠŸèƒ½ï¼Œ<strong>é»˜è®¤ä¸ºä¸å¼€å¯çŠ¶æ€</strong></p></li><li><p>é…ç½®</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs coq">appendfsync always|<span class="hljs-type">everysec</span>|<span class="hljs-type">no</span><br></code></pre></td></tr></table></figure><ul><li><p>ä½œç”¨</p><p>AOFå†™æ•°æ®ç­–ç•¥</p></li></ul></li></ul><p>é…ç½®åï¼Œconfé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_19_20210326.png"></p><h4 id="2-3-5-AOFç›¸å…³é…ç½®"><a href="#2-3-5-AOFç›¸å…³é…ç½®" class="headerlink" title="2.3.5 AOFç›¸å…³é…ç½®"></a>2.3.5 AOFç›¸å…³é…ç½®</h4><ul><li><p>é…ç½®</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">appendfilename filename</span><br></code></pre></td></tr></table></figure><ul><li> ä½œç”¨</li></ul><p>  AOFæŒä¹…åŒ–æ–‡ä»¶åï¼Œé»˜è®¤æ–‡ä»¶åä¸ºappendonly.aofï¼Œå»ºè®®é…ç½®ä¸ºappendonly-ç«¯å£å·.aof</p></li><li><p>é…ç½®</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">dir</span><br></code></pre></td></tr></table></figure><ul><li><p>ä½œç”¨</p><p>AOFæŒä¹…åŒ–æ–‡ä»¶ä¿å­˜è·¯å¾„ï¼Œä¸RDBæŒä¹…åŒ–æ–‡ä»¶ä¿æŒä¸€è‡´å³å¯</p></li></ul></li></ul><h4 id="2-3-6-AOFé‡å†™"><a href="#2-3-6-AOFé‡å†™" class="headerlink" title="2.3.6 AOFé‡å†™"></a>2.3.6 AOFé‡å†™</h4><h5 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h5><ul><li>é™ä½ç£ç›˜å ç”¨é‡ï¼Œæé«˜ç£ç›˜åˆ©ç”¨ç‡</li><li>æé«˜æŒä¹…åŒ–æ•ˆç‡ï¼Œé™ä½æŒä¹…åŒ–å†™æ—¶é—´ï¼Œæé«˜IOæ€§èƒ½</li><li>é™ä½æ•°æ®æ¢å¤ç”¨æ—¶ï¼Œæé«˜æ•°æ®æ¢å¤æ•ˆç‡</li></ul><h5 id="è§„åˆ™"><a href="#è§„åˆ™" class="headerlink" title="è§„åˆ™"></a>è§„åˆ™</h5><ul><li>è¿›ç¨‹å†…å·²è¶…æ—¶çš„æ•°æ®ä¸å†å†™å…¥æ–‡ä»¶</li><li>å¿½ç•¥æ— æ•ˆæŒ‡ä»¤ï¼Œé‡å†™æ—¶ä½¿ç”¨è¿›ç¨‹å†…æ•°æ®ç›´æ¥ç”Ÿæˆï¼Œè¿™æ ·æ–°çš„AOFæ–‡ä»¶åªä¿ç•™æœ€ç»ˆæ•°æ®çš„å†™å…¥å‘½ä»¤<ul><li>å¦‚del key1ã€ hdel key2ã€srem key3ã€set key4 111ã€set key4 222ç­‰</li></ul></li><li>å¯¹åŒä¸€æ•°æ®çš„å¤šæ¡å†™å‘½ä»¤åˆå¹¶ä¸ºä¸€æ¡å‘½ä»¤<ul><li>å¦‚lpush list1 aã€lpush list1 bã€ lpush list1 c å¯ä»¥è½¬åŒ–ä¸ºï¼šlpush list1 a b c</li><li>ä¸ºé˜²æ­¢æ•°æ®é‡è¿‡å¤§é€ æˆå®¢æˆ·ç«¯ç¼“å†²åŒºæº¢å‡ºï¼Œå¯¹listã€setã€hashã€zsetç­‰ç±»å‹ï¼Œæ¯æ¡æŒ‡ä»¤æœ€å¤šå†™å…¥64ä¸ªå…ƒç´ </li></ul></li></ul><h5 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h5><ul><li><p>æ‰‹åŠ¨é‡å†™</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">bgrewriteaof</span><br></code></pre></td></tr></table></figure></li><li><p>è‡ªåŠ¨é‡å†™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 1.è§¦å‘æ¡ä»¶è®¾ç½®</span><br><span class="hljs-meta">#</span><span class="bash"> è§¦å‘é‡å†™çš„æœ€å°å¤§å°</span><br>auto-aof-rewrite-min-size size <br><span class="hljs-meta">#</span><span class="bash"> è§¦å‘é‡å†™é¡»è¾¾åˆ°çš„æœ€å°ç™¾åˆ†æ¯”</span> <br>auto-aof-rewrite-percentage percentage<br><br><span class="hljs-meta">#</span><span class="bash"> 2.è§¦å‘æ¯”å¯¹å‚æ•°ï¼ˆ è¿è¡ŒæŒ‡ä»¤info Persistenceè·å–å…·ä½“ä¿¡æ¯ ï¼‰</span><br><span class="hljs-meta">#</span><span class="bash"> å½“å‰.aofçš„æ–‡ä»¶å¤§å°</span><br>aof_current_size <br><span class="hljs-meta">#</span><span class="bash"> åŸºç¡€æ–‡ä»¶å¤§å°</span><br>aof_base_size<br></code></pre></td></tr></table></figure></li><li><p>è‡ªåŠ¨é‡å†™è§¦å‘æ¡ä»¶</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_22_20210326.png"></p></li></ul><h5 id="é‡å†™å·¥ä½œåŸç†"><a href="#é‡å†™å·¥ä½œåŸç†" class="headerlink" title="é‡å†™å·¥ä½œåŸç†"></a>é‡å†™å·¥ä½œåŸç†</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_21_20210326.png"></p><h5 id="é‡å†™å·¥ä½œæµç¨‹"><a href="#é‡å†™å·¥ä½œæµç¨‹" class="headerlink" title="é‡å†™å·¥ä½œæµç¨‹"></a>é‡å†™å·¥ä½œæµç¨‹</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_23_20210326.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_24_20210326.png"></p><h3 id="2-4-RDBä¸AOFçš„åŒºåˆ«"><a href="#2-4-RDBä¸AOFçš„åŒºåˆ«" class="headerlink" title="2.4 RDBä¸AOFçš„åŒºåˆ«"></a>2.4 RDBä¸AOFçš„åŒºåˆ«</h3><table><thead><tr><th>æŒä¹…åŒ–æ–¹å¼</th><th>RDB</th><th>AOF</th></tr></thead><tbody><tr><td>å ç”¨å­˜å‚¨ç©ºé—´</td><td>å°ï¼ˆæ•°æ®çº§ï¼šå‹ç¼©ï¼‰</td><td>å¤§ï¼ˆæŒ‡ä»¤çº§ï¼šé‡å†™ï¼‰</td></tr><tr><td>å­˜å‚¨é€Ÿåº¦</td><td>æ…¢</td><td>å¿«</td></tr><tr><td>æ¢å¤é€Ÿåº¦</td><td>å¿«</td><td>æ…¢</td></tr><tr><td>æ•°æ®å®‰å…¨æ€§</td><td>ä¼šä¸¢å¤±æ•°æ®</td><td>ä¾æ®ç­–ç•¥å†³å®š</td></tr><tr><td>èµ„æºæ¶ˆè€—</td><td>é«˜/é‡é‡çº§</td><td>ä½/è½»é‡çº§</td></tr><tr><td>å¯åŠ¨ä¼˜å…ˆçº§</td><td>ä½</td><td>é«˜</td></tr></tbody></table><h3 id="2-5-RDBä¸AOFçš„é€‰æ‹©"><a href="#2-5-RDBä¸AOFçš„é€‰æ‹©" class="headerlink" title="2.5 RDBä¸AOFçš„é€‰æ‹©"></a>2.5 RDBä¸AOFçš„é€‰æ‹©</h3><ul><li>å¯¹æ•°æ®éå¸¸æ•æ„Ÿï¼Œå»ºè®®ä½¿ç”¨é»˜è®¤çš„AOFæŒä¹…åŒ–æ–¹æ¡ˆ<ul><li>AOFæŒä¹…åŒ–ç­–ç•¥ä½¿ç”¨<strong>everysecond</strong>ï¼Œæ¯ç§’é’Ÿfsyncä¸€æ¬¡ã€‚è¯¥ç­–ç•¥redisä»å¯ä»¥ä¿æŒå¾ˆå¥½çš„å¤„ç†æ€§èƒ½ï¼Œå½“å‡ºç°é—®é¢˜æ—¶ï¼Œæœ€å¤šä¸¢å¤±0-1ç§’å†…çš„æ•°æ®ã€‚</li><li>æ³¨æ„ï¼šç”±äºAOFæ–‡ä»¶<strong>å­˜å‚¨ä½“ç§¯è¾ƒå¤§</strong>ï¼Œä¸”<strong>æ¢å¤é€Ÿåº¦è¾ƒæ…¢</strong></li></ul></li><li>æ•°æ®å‘ˆç°é˜¶æ®µæœ‰æ•ˆæ€§ï¼Œå»ºè®®ä½¿ç”¨RDBæŒä¹…åŒ–æ–¹æ¡ˆ<ul><li>æ•°æ®å¯ä»¥è‰¯å¥½çš„åšåˆ°é˜¶æ®µå†…æ— ä¸¢å¤±ï¼ˆè¯¥é˜¶æ®µæ˜¯å¼€å‘è€…æˆ–è¿ç»´äººå‘˜æ‰‹å·¥ç»´æŠ¤çš„ï¼‰ï¼Œä¸”<strong>æ¢å¤é€Ÿåº¦è¾ƒå¿«</strong>ï¼Œé˜¶æ®µ ç‚¹æ•°æ®æ¢å¤é€šå¸¸é‡‡ç”¨RDBæ–¹æ¡ˆ</li><li>æ³¨æ„ï¼šåˆ©ç”¨RDBå®ç°ç´§å‡‘çš„æ•°æ®æŒä¹…åŒ–ä¼šä½¿Redisé™çš„å¾ˆä½</li></ul></li><li>ç»¼åˆæ¯”å¯¹<ul><li>RDBä¸AOFçš„é€‰æ‹©å®é™…ä¸Šæ˜¯åœ¨åšä¸€ç§æƒè¡¡ï¼Œæ¯ç§éƒ½æœ‰åˆ©æœ‰å¼Š</li><li>å¦‚ä¸èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œå¯¹ä¸šåŠ¡æ•°æ®éå¸¸<strong>æ•æ„Ÿ</strong>ï¼Œé€‰ç”¨<strong>AOF</strong></li><li>å¦‚èƒ½æ‰¿å—æ•°åˆ†é’Ÿä»¥å†…çš„æ•°æ®ä¸¢å¤±ï¼Œä¸”è¿½æ±‚å¤§æ•°æ®é›†çš„<strong>æ¢å¤é€Ÿåº¦</strong>ï¼Œé€‰ç”¨<strong>RDB</strong></li><li><strong>ç¾éš¾æ¢å¤é€‰ç”¨RDB</strong></li><li>åŒä¿é™©ç­–ç•¥ï¼ŒåŒæ—¶å¼€å¯ RDB å’Œ AOFï¼Œé‡å¯åï¼ŒRedisä¼˜å…ˆä½¿ç”¨ AOF æ¥æ¢å¤æ•°æ®ï¼Œé™ä½ä¸¢å¤±æ•°æ®</li></ul></li></ul><h2 id="3-äº‹åŠ¡"><a href="#3-äº‹åŠ¡" class="headerlink" title="3. äº‹åŠ¡"></a>3. äº‹åŠ¡</h2><h3 id="3-1-äº‹åŠ¡ç®€ä»‹"><a href="#3-1-äº‹åŠ¡ç®€ä»‹" class="headerlink" title="3.1 äº‹åŠ¡ç®€ä»‹"></a>3.1 äº‹åŠ¡ç®€ä»‹</h3><blockquote><p>redisäº‹åŠ¡å°±æ˜¯ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„é˜Ÿåˆ—ï¼Œå°†ä¸€ç³»åˆ—é¢„å®šä¹‰å‘½ä»¤<strong>åŒ…è£…æˆä¸€ä¸ªæ•´ä½“</strong>ï¼ˆä¸€ä¸ªé˜Ÿåˆ—ï¼‰ã€‚å½“æ‰§è¡Œæ—¶ï¼Œ<strong>ä¸€æ¬¡æ€§æŒ‰ç…§æ·»åŠ é¡ºåºä¾æ¬¡æ‰§è¡Œ</strong>ï¼Œä¸­é—´ä¸ä¼šè¢«æ‰“æ–­æˆ–è€…å¹²æ‰°</p></blockquote><h3 id="3-2-äº‹åŠ¡åŸºæœ¬æ“ä½œ"><a href="#3-2-äº‹åŠ¡åŸºæœ¬æ“ä½œ" class="headerlink" title="3.2 äº‹åŠ¡åŸºæœ¬æ“ä½œ"></a>3.2 äº‹åŠ¡åŸºæœ¬æ“ä½œ</h3><ul><li><p>å¼€å¯äº‹åŠ¡</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">multi</span><br></code></pre></td></tr></table></figure><ul><li>ä½œç”¨ï¼šä½œè®¾å®šäº‹åŠ¡çš„å¼€å¯ä½ç½®ï¼Œæ­¤æŒ‡ä»¤æ‰§è¡Œåï¼Œåç»­çš„æ‰€æœ‰æŒ‡ä»¤å‡åŠ å…¥åˆ°äº‹åŠ¡ä¸­</li></ul></li><li><p>å–æ¶ˆäº‹åŠ¡</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">discard</span><br></code></pre></td></tr></table></figure><ul><li>ä½œç”¨ç»ˆæ­¢å½“å‰äº‹åŠ¡çš„å®šä¹‰ï¼Œå‘ç”Ÿåœ¨multiä¹‹åï¼Œexecä¹‹å‰</li></ul></li><li><p>æ‰§è¡Œäº‹åŠ¡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">exec</span><br></code></pre></td></tr></table></figure><ul><li>ä½œç”¨ï¼šè®¾å®šäº‹åŠ¡çš„ç»“æŸä½ç½®ï¼ŒåŒæ—¶æ‰§è¡Œäº‹åŠ¡ã€‚<strong>ä¸multiæˆå¯¹å‡ºç°</strong>ï¼Œæˆå¯¹ä½¿ç”¨</li></ul></li></ul><h3 id="3-3-äº‹åŠ¡å·¥ä½œæµç¨‹"><a href="#3-3-äº‹åŠ¡å·¥ä½œæµç¨‹" class="headerlink" title="3.3 äº‹åŠ¡å·¥ä½œæµç¨‹"></a>3.3 äº‹åŠ¡å·¥ä½œæµç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_25_20210326.png"></p><h3 id="3-4-äº‹åŠ¡æ³¨æ„äº‹é¡¹"><a href="#3-4-äº‹åŠ¡æ³¨æ„äº‹é¡¹" class="headerlink" title="3.4 äº‹åŠ¡æ³¨æ„äº‹é¡¹"></a>3.4 äº‹åŠ¡æ³¨æ„äº‹é¡¹</h3><p><strong>å®šä¹‰äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤æ ¼å¼è¾“å…¥é”™è¯¯æ€ä¹ˆåŠï¼Ÿ</strong></p><ul><li>è¯­æ³•é”™è¯¯<ul><li>æŒ‡å‘½ä»¤ä¹¦å†™æ ¼å¼æœ‰è¯¯ ä¾‹å¦‚æ‰§è¡Œäº†ä¸€æ¡ä¸å­˜åœ¨çš„æŒ‡ä»¤</li></ul></li><li>å¤„ç†ç»“æœ<ul><li>å¦‚æœå®šä¹‰çš„äº‹åŠ¡ä¸­æ‰€åŒ…å«çš„å‘½ä»¤å­˜åœ¨è¯­æ³•é”™è¯¯ï¼Œæ•´ä½“äº‹åŠ¡ä¸­<strong>æ‰€æœ‰å‘½ä»¤å‡ä¸ä¼šæ‰§è¡Œ</strong>ã€‚åŒ…æ‹¬é‚£äº›è¯­æ³•æ­£ç¡®çš„å‘½ä»¤</li></ul></li></ul><p><strong>å®šä¹‰äº‹åŠ¡çš„è¿‡ç¨‹ä¸­ï¼Œå‘½ä»¤æ‰§è¡Œå‡ºç°é”™è¯¯æ€ä¹ˆåŠï¼Ÿ</strong></p><ul><li>è¿è¡Œé”™è¯¯<ul><li>æŒ‡å‘½ä»¤<strong>æ ¼å¼æ­£ç¡®</strong>ï¼Œä½†æ˜¯<strong>æ— æ³•æ­£ç¡®çš„æ‰§è¡Œ</strong>ã€‚ä¾‹å¦‚å¯¹listè¿›è¡Œincræ“ä½œ</li></ul></li><li>å¤„ç†ç»“æœ<ul><li>èƒ½å¤Ÿæ­£ç¡®è¿è¡Œçš„å‘½ä»¤ä¼šæ‰§è¡Œï¼Œè¿è¡Œé”™è¯¯çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œ</li></ul></li></ul><p><font color="FF0000"><strong>æ³¨æ„</strong>ï¼šå·²ç»æ‰§è¡Œå®Œæ¯•çš„å‘½ä»¤å¯¹åº”çš„æ•°æ®<strong>ä¸ä¼šè‡ªåŠ¨å›æ»š</strong>ï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªå·±åœ¨ä»£ç ä¸­å®ç°å›æ»šã€‚</font></p><h3 id="3-5-é”"><a href="#3-5-é”" class="headerlink" title="3.5 é”"></a>3.5 é”</h3><h4 id="3-5-1-åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“é”"><a href="#3-5-1-åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“é”" class="headerlink" title="3.5.1 åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“é”"></a>3.5.1 åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“é”</h4><p>ç›‘è§†é”ç±»ä¼¼CASçš„æ€æƒ³ï¼Œå¦‚æœç›‘è§†å¯¹è±¡åœ¨äº‹åŠ¡æ‰§è¡Œå‰è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆå°±ä¸æ‰§è¡Œäº†</p><ul><li><p>å¯¹ key æ·»åŠ ç›‘è§†é”ï¼Œåœ¨æ‰§è¡Œexecå‰å¦‚æœkeyå‘ç”Ÿäº†å˜åŒ–ï¼Œç»ˆæ­¢äº‹åŠ¡æ‰§è¡Œ</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">watch</span> key<span class="hljs-number">1</span>, key<span class="hljs-number">2</span>....<br></code></pre></td></tr></table></figure></li><li><p>å–æ¶ˆå¯¹<strong>æ‰€æœ‰</strong>keyçš„ç›‘è§†</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">unwatch</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="3-5-2åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“åˆ†å¸ƒå¼é”"><a href="#3-5-2åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“åˆ†å¸ƒå¼é”" class="headerlink" title="3.5.2åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“åˆ†å¸ƒå¼é”"></a>3.5.2åŸºäºç‰¹å®šæ¡ä»¶çš„äº‹åŠ¡æ‰§è¡Œâ€“åˆ†å¸ƒå¼é”</h4><p>åˆ†å¸ƒå¼é”ç±»ä¼¼æ‚²è§‚é”çš„æ€æƒ³ï¼Œä½†æ˜¯åªæ˜¯ä¸€ä¸ªæ ‡è®°</p><ul><li><p>ä½¿ç”¨ setnx è®¾ç½®ä¸€ä¸ªå…¬å…±é”</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä¸Šé”</span><br>setnx lock-key value<br><span class="hljs-meta">#</span><span class="bash"> é‡Šæ”¾é”</span><br>del lock-key<br></code></pre></td></tr></table></figure><ul><li>åˆ©ç”¨setnxå‘½ä»¤çš„è¿”å›å€¼ç‰¹å¾ï¼Œæœ‰å€¼ï¼ˆè¢«ä¸Šé”äº†ï¼‰åˆ™è¿”å›è®¾ç½®å¤±è´¥ï¼Œæ— å€¼ï¼ˆæ²¡è¢«ä¸Šé”ï¼‰åˆ™è¿”å›è®¾ç½®æˆåŠŸ</li><li>æ“ä½œå®Œæ¯•é€šè¿‡delæ“ä½œé‡Šæ”¾é”</li></ul></li></ul><p><strong>æ³¨æ„</strong>ï¼šä¸Šè¿°è§£å†³æ–¹æ¡ˆæ˜¯ä¸€ç§<strong>è®¾è®¡æ¦‚å¿µ</strong>ï¼Œä¾èµ–è§„èŒƒä¿éšœï¼Œå…·æœ‰é£é™©æ€§</p><h4 id="3-5-3-åˆ†å¸ƒå¼é”æ”¹è‰¯"><a href="#3-5-3-åˆ†å¸ƒå¼é”æ”¹è‰¯" class="headerlink" title="3.5.3 åˆ†å¸ƒå¼é”æ”¹è‰¯"></a>3.5.3 åˆ†å¸ƒå¼é”æ”¹è‰¯</h4><ul><li><p>ä½¿ç”¨ expire ä¸ºé”keyæ·»åŠ <strong>æ—¶é—´é™å®š</strong>ï¼Œåˆ°æ—¶ä¸é‡Šæ”¾ï¼Œæ”¾å¼ƒé”</p><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cos">expire <span class="hljs-keyword">lock</span>-key seconds<br>pexpire <span class="hljs-keyword">lock</span>-key millisecondsCopy<br></code></pre></td></tr></table></figure></li><li><p>ç”±äºæ“ä½œé€šå¸¸éƒ½æ˜¯å¾®ç§’æˆ–æ¯«ç§’çº§ï¼Œå› æ­¤è¯¥é”å®šæ—¶é—´<strong>ä¸å®œè®¾ç½®è¿‡å¤§</strong>ã€‚å…·ä½“æ—¶é—´éœ€è¦ä¸šåŠ¡æµ‹è¯•åç¡®è®¤ã€‚</p><ul><li>ä¾‹å¦‚ï¼šæŒæœ‰é”çš„æ“ä½œæœ€é•¿æ‰§è¡Œæ—¶é—´127msï¼Œæœ€çŸ­æ‰§è¡Œæ—¶é—´7msã€‚</li><li>æµ‹è¯•ç™¾ä¸‡æ¬¡æœ€é•¿æ‰§è¡Œæ—¶é—´å¯¹åº”å‘½ä»¤çš„æœ€å¤§è€—æ—¶ï¼Œæµ‹è¯•ç™¾ä¸‡æ¬¡ç½‘ç»œå»¶è¿Ÿå¹³å‡è€—æ—¶</li><li>é”æ—¶é—´è®¾å®šæ¨èï¼šæœ€å¤§è€—æ—¶<em>120%+å¹³å‡ç½‘ç»œå»¶è¿Ÿ</em>110%</li><li>å¦‚æœä¸šåŠ¡æœ€å¤§è€—æ—¶&lt;&lt;ç½‘ç»œå¹³å‡å»¶è¿Ÿï¼Œé€šå¸¸ä¸º2ä¸ªæ•°é‡çº§ï¼Œå–å…¶ä¸­å•ä¸ªè€—æ—¶è¾ƒé•¿å³å¯</li></ul></li></ul><h2 id="4-åˆ é™¤ç­–ç•¥"><a href="#4-åˆ é™¤ç­–ç•¥" class="headerlink" title="4. åˆ é™¤ç­–ç•¥"></a>4. åˆ é™¤ç­–ç•¥</h2><h3 id="4-1-æ•°æ®åˆ é™¤ç­–ç•¥"><a href="#4-1-æ•°æ®åˆ é™¤ç­–ç•¥" class="headerlink" title="4.1 æ•°æ®åˆ é™¤ç­–ç•¥"></a>4.1 æ•°æ®åˆ é™¤ç­–ç•¥</h3><ul><li>å®šæ—¶åˆ é™¤</li><li>æƒ°æ€§åˆ é™¤</li><li>å®šæœŸåˆ é™¤</li></ul><h4 id="æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„"><a href="#æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„" class="headerlink" title="æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„"></a>æ—¶æ•ˆæ€§æ•°æ®çš„å­˜å‚¨ç»“æ„</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_26_20210327.png"></p><h4 id="æ•°æ®åˆ é™¤ç­–ç•¥çš„ç›®æ ‡"><a href="#æ•°æ®åˆ é™¤ç­–ç•¥çš„ç›®æ ‡" class="headerlink" title="æ•°æ®åˆ é™¤ç­–ç•¥çš„ç›®æ ‡"></a>æ•°æ®åˆ é™¤ç­–ç•¥çš„ç›®æ ‡</h4><p>åœ¨å†…å­˜å ç”¨ä¸CPUå ç”¨ä¹‹é—´å¯»æ‰¾ä¸€ç§<strong>å¹³è¡¡</strong>ï¼Œé¡¾æ­¤å¤±å½¼éƒ½ä¼šé€ æˆæ•´ä½“redisæ€§èƒ½çš„ä¸‹é™ï¼Œç”šè‡³å¼•å‘æœåŠ¡å™¨å®•æœºæˆ–å†…å­˜æ³„éœ²</p><h3 id="4-2-ä¸‰ç§åˆ é™¤ç­–ç•¥"><a href="#4-2-ä¸‰ç§åˆ é™¤ç­–ç•¥" class="headerlink" title="4.2 ä¸‰ç§åˆ é™¤ç­–ç•¥"></a>4.2 ä¸‰ç§åˆ é™¤ç­–ç•¥</h3><h4 id="4-2-1-å®šæ—¶åˆ é™¤"><a href="#4-2-1-å®šæ—¶åˆ é™¤" class="headerlink" title="4.2.1 å®šæ—¶åˆ é™¤"></a>4.2.1 å®šæ—¶åˆ é™¤</h4><ul><li>åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“keyè®¾ç½®æœ‰è¿‡æœŸæ—¶é—´ï¼Œä¸”è¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶ï¼Œç”±å®šæ—¶å™¨ä»»åŠ¡<strong>ç«‹å³æ‰§è¡Œ</strong>å¯¹é”®çš„åˆ é™¤æ“ä½œ</li><li>ä¼˜ç‚¹ï¼š<strong>èŠ‚çº¦å†…å­˜</strong>ï¼Œåˆ°æ—¶å°±åˆ é™¤ï¼Œå¿«é€Ÿé‡Šæ”¾æ‰ä¸å¿…è¦çš„å†…å­˜å ç”¨</li><li>ç¼ºç‚¹ï¼š<strong>CPUå‹åŠ›å¾ˆå¤§</strong>ï¼Œæ— è®ºCPUæ­¤æ—¶è´Ÿè½½é‡å¤šé«˜ï¼Œå‡å ç”¨CPUï¼Œä¼šå½±å“redisæœåŠ¡å™¨å“åº”æ—¶é—´å’ŒæŒ‡ä»¤ååé‡</li><li>æ€»ç»“ï¼šç”¨å¤„ç†å™¨æ€§èƒ½æ¢å–å­˜å‚¨ç©ºé—´ ï¼ˆ<strong>æ‹¿æ—¶é—´æ¢ç©ºé—´</strong>ï¼‰</li></ul><h4 id="4-2-2-æƒ°æ€§åˆ é™¤"><a href="#4-2-2-æƒ°æ€§åˆ é™¤" class="headerlink" title="4.2.2 æƒ°æ€§åˆ é™¤"></a>4.2.2 æƒ°æ€§åˆ é™¤</h4><ul><li>æ•°æ®åˆ°è¾¾è¿‡æœŸæ—¶é—´ï¼Œä¸åšå¤„ç†ã€‚ç­‰ä¸‹æ¬¡è®¿é—®è¯¥æ•°æ®æ—¶<ul><li>å¦‚æœæœªè¿‡æœŸï¼Œè¿”å›æ•°æ®</li><li>å‘ç°å·²è¿‡æœŸï¼Œåˆ é™¤ï¼Œè¿”å›ä¸å­˜åœ¨</li></ul></li><li>ä¼˜ç‚¹ï¼š<strong>èŠ‚çº¦CPUæ€§èƒ½</strong>ï¼Œå‘ç°å¿…é¡»åˆ é™¤çš„æ—¶å€™æ‰åˆ é™¤</li><li>ç¼ºç‚¹ï¼š<strong>å†…å­˜å‹åŠ›å¾ˆå¤§</strong>ï¼Œå‡ºç°é•¿æœŸå ç”¨å†…å­˜çš„æ•°æ®</li><li>æ€»ç»“ï¼šç”¨å­˜å‚¨ç©ºé—´æ¢å–å¤„ç†å™¨æ€§èƒ½ ï¼ˆ<strong>æ‹¿ç©ºé—´æ¢æ—¶é—´</strong>ï¼‰</li></ul><h4 id="4-2-3-å®šæœŸåˆ é™¤ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰"><a href="#4-2-3-å®šæœŸåˆ é™¤ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰" class="headerlink" title="4.2.3 å®šæœŸåˆ é™¤ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰"></a>4.2.3 å®šæœŸåˆ é™¤ï¼ˆæŠ˜ä¸­æ–¹æ¡ˆï¼‰</h4><ul><li>å‘¨æœŸæ€§è½®è¯¢redisåº“ä¸­çš„æ—¶æ•ˆæ€§æ•°æ®ï¼Œé‡‡ç”¨<strong>éšæœºæŠ½å–çš„ç­–ç•¥</strong>ï¼Œåˆ©ç”¨è¿‡æœŸæ•°æ®å æ¯”çš„æ–¹å¼æ§åˆ¶åˆ é™¤é¢‘åº¦</li><li>ç‰¹ç‚¹1ï¼šCPUæ€§èƒ½å ç”¨è®¾ç½®æœ‰å³°å€¼ï¼Œæ£€æµ‹é¢‘åº¦å¯è‡ªå®šä¹‰è®¾ç½®</li><li>ç‰¹ç‚¹2ï¼šå†…å­˜å‹åŠ›ä¸æ˜¯å¾ˆå¤§ï¼Œé•¿æœŸå ç”¨å†…å­˜çš„å†·æ•°æ®ä¼šè¢«æŒç»­æ¸…ç†</li><li>æ€»ç»“ï¼šå‘¨æœŸæ€§æŠ½æŸ¥å­˜å‚¨ç©ºé—´ ï¼ˆéšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥ï¼‰</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_27_20210327.png"></p><h4 id="4-2-4-åˆ é™¤ç­–ç•¥å¯¹æ¯”"><a href="#4-2-4-åˆ é™¤ç­–ç•¥å¯¹æ¯”" class="headerlink" title="4.2.4 åˆ é™¤ç­–ç•¥å¯¹æ¯”"></a>4.2.4 åˆ é™¤ç­–ç•¥å¯¹æ¯”</h4><table><thead><tr><th>åˆ é™¤ç­–ç•¥</th><th></th><th></th><th></th></tr></thead><tbody><tr><td>å®šæ—¶åˆ é™¤</td><td>èŠ‚çº¦å†…å­˜ï¼Œæ— å ç”¨</td><td>ä¸åˆ†æ—¶æ®µå ç”¨CPUèµ„æºï¼Œé¢‘ç‡é«˜</td><td>æ‹¿æ—¶é—´æ¢ç©ºé—´</td></tr><tr><td>æƒ°æ€§åˆ é™¤</td><td>å†…å­˜å ç”¨ä¸¥é‡</td><td>å»¶æ—¶æ‰§è¡Œï¼ŒCPUåˆ©ç”¨ç‡é«˜</td><td>æ‹¿ç©ºé—´æ¢æ—¶é—´</td></tr><tr><td>å®šæœŸåˆ é™¤</td><td>å†…å­˜å®šæœŸéšæœºæ¸…ç†</td><td>æ¯ç§’èŠ±è´¹å›ºå®šçš„CPUèµ„æºç»´æŠ¤å†…å­˜</td><td>éšæœºæŠ½æŸ¥ï¼Œé‡ç‚¹æŠ½æŸ¥</td></tr></tbody></table><p>rediså†…éƒ¨ä¸€èˆ¬ä½¿ç”¨æƒ°æ€§åˆ é™¤å’Œå®šæœŸåˆ é™¤</p><h3 id="4-3-é€å‡ºç®—æ³•ï¼ˆæ·˜æ±°ç®—æ³•ï¼‰"><a href="#4-3-é€å‡ºç®—æ³•ï¼ˆæ·˜æ±°ç®—æ³•ï¼‰" class="headerlink" title="4.3 é€å‡ºç®—æ³•ï¼ˆæ·˜æ±°ç®—æ³•ï¼‰"></a>4.3 é€å‡ºç®—æ³•ï¼ˆæ·˜æ±°ç®—æ³•ï¼‰</h3><p>**å½“æ–°æ•°æ®è¿›å…¥redisæ—¶ï¼Œå¦‚æœå†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ **</p><ul><li>Redisä½¿ç”¨å†…å­˜å­˜å‚¨æ•°æ®ï¼Œåœ¨æ‰§è¡Œæ¯ä¸€ä¸ªå‘½ä»¤å‰ï¼Œä¼šè°ƒç”¨<strong>freeMemoryIfNeeded()<strong>æ£€æµ‹å†…å­˜æ˜¯å¦å……è¶³ã€‚å¦‚æœå†…å­˜ä¸æ»¡è¶³æ–°åŠ å…¥æ•°æ®çš„æœ€ä½å­˜å‚¨è¦æ±‚ï¼Œredisè¦ä¸´æ—¶åˆ é™¤ä¸€äº›æ•°æ®ä¸ºå½“å‰æŒ‡ä»¤æ¸…ç†å­˜å‚¨ç©ºé—´ã€‚æ¸…ç†æ•°æ®çš„ç­–ç•¥ç§°ä¸º</strong>é€å‡ºç®—æ³•</strong></li><li><strong>æ³¨æ„</strong>ï¼šé€å‡ºæ•°æ®çš„è¿‡ç¨‹ä¸æ˜¯100%èƒ½å¤Ÿæ¸…ç†å‡ºè¶³å¤Ÿçš„å¯ä½¿ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœä¸æˆåŠŸåˆ™åå¤æ‰§è¡Œã€‚å½“å¯¹æ‰€æœ‰æ•°æ®å°è¯•å®Œæ¯•åï¼Œå¦‚æœä¸èƒ½è¾¾åˆ°å†…å­˜æ¸…ç†çš„è¦æ±‚ï¼Œå°†å‡ºç°é”™è¯¯ä¿¡æ¯ã€‚</li></ul><h4 id="4-3-1-å½±å“æ•°æ®é€å‡ºçš„ç›¸å…³é…ç½®"><a href="#4-3-1-å½±å“æ•°æ®é€å‡ºçš„ç›¸å…³é…ç½®" class="headerlink" title="4.3.1 å½±å“æ•°æ®é€å‡ºçš„ç›¸å…³é…ç½®"></a>4.3.1 å½±å“æ•°æ®é€å‡ºçš„ç›¸å…³é…ç½®</h4><ul><li><p>æœ€å¤§å¯ä½¿ç”¨å†…å­˜</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">maxmemory</span><br></code></pre></td></tr></table></figure><p>å ç”¨ç‰©ç†å†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶ã€‚ç”Ÿäº§ç¯å¢ƒä¸­æ ¹æ®éœ€æ±‚è®¾å®šï¼Œé€šå¸¸è®¾ç½®åœ¨50%ä»¥ä¸Šã€‚</p></li><li><p>æ¯æ¬¡é€‰å–å¾…åˆ é™¤æ•°æ®çš„ä¸ªæ•°</p><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">maxmemory-samples</span><br></code></pre></td></tr></table></figure><p>é€‰å–æ•°æ®æ—¶å¹¶ä¸ä¼šå…¨åº“æ‰«æï¼Œå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½æ¶ˆè€—ï¼Œé™ä½è¯»å†™æ€§èƒ½ã€‚å› æ­¤é‡‡ç”¨éšæœºè·å–æ•°æ®çš„æ–¹å¼ä½œä¸ºå¾…æ£€æµ‹åˆ é™¤æ•°æ®</p></li><li><p>åˆ é™¤ç­–ç•¥</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">maxmemory-<span class="hljs-keyword">policy</span><br></code></pre></td></tr></table></figure><p>è¾¾åˆ°æœ€å¤§å†…å­˜åçš„ï¼Œå¯¹è¢«æŒ‘é€‰å‡ºæ¥çš„æ•°æ®è¿›è¡Œåˆ é™¤çš„ç­–ç•¥</p></li><li><p>åˆ é™¤ç­–ç•¥åŒ…æ‹¬ä»¥ä¸‹8ç§ä¸åŒè®¾ç½®ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_28_20210327.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> é…ç½®æ–¹å¼</span><br>maxmemory-policy volatile-lru<br></code></pre></td></tr></table></figure></li></ul><h4 id="4-3-2-æ•°æ®é€å‡ºç­–ç•¥é…ç½®ä¾æ®"><a href="#4-3-2-æ•°æ®é€å‡ºç­–ç•¥é…ç½®ä¾æ®" class="headerlink" title="4.3.2 æ•°æ®é€å‡ºç­–ç•¥é…ç½®ä¾æ®"></a>4.3.2 æ•°æ®é€å‡ºç­–ç•¥é…ç½®ä¾æ®</h4><ul><li>ä½¿ç”¨<strong>INFOå‘½ä»¤</strong>è¾“å‡ºç›‘æ§ä¿¡æ¯ï¼ŒæŸ¥è¯¢ç¼“å­˜ <strong>hit å’Œ miss</strong> çš„æ¬¡æ•°ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒä¼˜Redisé…ç½®</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_29_20210327.png"></p><h2 id="5-æœåŠ¡å™¨åŸºç¡€é…ç½®"><a href="#5-æœåŠ¡å™¨åŸºç¡€é…ç½®" class="headerlink" title="5. æœåŠ¡å™¨åŸºç¡€é…ç½®"></a>5. æœåŠ¡å™¨åŸºç¡€é…ç½®</h2><h3 id="5-1-æœåŠ¡å™¨ç«¯è®¾å®š"><a href="#5-1-æœåŠ¡å™¨ç«¯è®¾å®š" class="headerlink" title="5.1 æœåŠ¡å™¨ç«¯è®¾å®š"></a>5.1 æœåŠ¡å™¨ç«¯è®¾å®š</h3><p>è®¾ç½®åˆ°confæ–‡ä»¶ä¸­</p><ul><li>è®¾ç½®æœåŠ¡å™¨ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œ</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">daemonize</span> <span class="hljs-literal">yes</span> | <span class="hljs-literal">no</span><br></code></pre></td></tr></table></figure><ul><li>ç»‘å®šä¸»æœºåœ°å€</li></ul><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">bind</span> <span class="hljs-number">127.0.0.1</span><br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®æœåŠ¡å™¨ç«¯å£å·</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">port</span> <span class="hljs-number">6379</span><br></code></pre></td></tr></table></figure><ul><li>è®¾ç½®æ•°æ®åº“æ•°é‡</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">database</span> <span class="hljs-number">16</span><br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_30_20210327.png"></p><h3 id="5-2-æ—¥å¿—é…ç½®"><a href="#5-2-æ—¥å¿—é…ç½®" class="headerlink" title="5.2 æ—¥å¿—é…ç½®"></a>5.2 æ—¥å¿—é…ç½®</h3><ul><li>è®¾ç½®æœåŠ¡å™¨ä»¥æŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«</li></ul><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">loglevel <span class="hljs-keyword">debug</span>|<span class="hljs-keyword">verbose</span>|<span class="hljs-keyword">notice</span>|<span class="hljs-built_in">warning</span><br></code></pre></td></tr></table></figure><ul><li>æ—¥å¿—è®°å½•æ–‡ä»¶å</li></ul><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">logfile ç«¯å£å·.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šæ—¥å¿—çº§åˆ«å¼€å‘æœŸè®¾ç½®ä¸ºverboseå³å¯ï¼Œç”Ÿäº§ç¯å¢ƒä¸­é…ç½®ä¸ºnoticeï¼Œç®€åŒ–æ—¥å¿—è¾“å‡ºé‡ï¼Œé™ä½å†™æ—¥å¿—IOçš„é¢‘ç‡</p><h3 id="5-3-å®¢æˆ·ç«¯é…ç½®"><a href="#5-3-å®¢æˆ·ç«¯é…ç½®" class="headerlink" title="5.3 å®¢æˆ·ç«¯é…ç½®"></a>5.3 å®¢æˆ·ç«¯é…ç½®</h3><ul><li>è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ— é™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥è¾¾åˆ°ä¸Šé™ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">maxclients</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><ul><li>å®¢æˆ·ç«¯é—²ç½®ç­‰å¾…æœ€å¤§æ—¶é•¿ï¼Œè¾¾åˆ°æœ€å¤§å€¼åå…³é—­è¿æ¥ã€‚å¦‚éœ€å…³é—­è¯¥åŠŸèƒ½ï¼Œè®¾ç½®ä¸º0</li></ul><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">timeout</span> <span class="hljs-number">300</span><br></code></pre></td></tr></table></figure><h3 id="5-4-å¤šæœåŠ¡å™¨å¿«æ·é…ç½®"><a href="#5-4-å¤šæœåŠ¡å™¨å¿«æ·é…ç½®" class="headerlink" title="5.4 å¤šæœåŠ¡å™¨å¿«æ·é…ç½®"></a>5.4 å¤šæœåŠ¡å™¨å¿«æ·é…ç½®</h3><ul><li>å¯¼å…¥å¹¶åŠ è½½æŒ‡å®šé…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œç”¨äºå¿«é€Ÿèˆ¹èˆ°rediså…¬å…±é…ç½®è¾ƒå¤šçš„rediså®ä¾‹é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç»´æŠ¤</li></ul><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">include</span> <span class="hljs-regexp">/path/</span>server-ç«¯å£å·.conf<br></code></pre></td></tr></table></figure><h2 id="6-é«˜çº§æ•°æ®ç±»å‹"><a href="#6-é«˜çº§æ•°æ®ç±»å‹" class="headerlink" title="6. é«˜çº§æ•°æ®ç±»å‹"></a>6. é«˜çº§æ•°æ®ç±»å‹</h2><h3 id="6-1-Bitmaps"><a href="#6-1-Bitmaps" class="headerlink" title="6.1 Bitmaps"></a>6.1 Bitmaps</h3><h4 id="6-1-1-åŸºç¡€æ“ä½œ"><a href="#6-1-1-åŸºç¡€æ“ä½œ" class="headerlink" title="6.1.1 åŸºç¡€æ“ä½œ"></a>6.1.1 åŸºç¡€æ“ä½œ</h4><ul><li><p>è·å–æŒ‡å®škeyå¯¹åº”åç§»é‡ä¸Šçš„bitå€¼</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">getbit key <span class="hljs-built_in">offset</span><br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®æŒ‡å®škeyå¯¹åº”åç§»é‡ä¸Šçš„bitå€¼ï¼Œvalueåªèƒ½æ˜¯1æˆ–0</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs applescript">setbit key <span class="hljs-built_in">offset</span> value<br></code></pre></td></tr></table></figure></li></ul><h4 id="6-1-2-æ‰©å±•æ“ä½œ"><a href="#6-1-2-æ‰©å±•æ“ä½œ" class="headerlink" title="6.1.2 æ‰©å±•æ“ä½œ"></a>6.1.2 æ‰©å±•æ“ä½œ</h4><ul><li><p>å¯¹æŒ‡å®škeyæŒ‰ä½è¿›è¡Œäº¤ã€å¹¶ã€éã€å¼‚æˆ–æ“ä½œï¼Œå¹¶å°†ç»“æœ<strong>ä¿å­˜åˆ°destKey</strong>ä¸­</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bitop</span> op destKey key<span class="hljs-number">1</span><span class="hljs-meta"> [key2...]</span><br></code></pre></td></tr></table></figure><ul><li>andï¼šäº¤</li><li>orï¼šå¹¶</li><li>notï¼šé</li><li>xorï¼šå¼‚æˆ–</li></ul></li><li><p>ç»Ÿè®¡æŒ‡å®škeyä¸­1çš„æ•°é‡</p><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xquery">bitcount<span class="hljs-built_in"> key</span> [<span class="hljs-keyword">start</span> <span class="hljs-keyword">end</span>]<br></code></pre></td></tr></table></figure></li></ul><h3 id="6-2-HyperLogLog"><a href="#6-2-HyperLogLog" class="headerlink" title="6.2 HyperLogLog"></a>6.2 HyperLogLog</h3><h4 id="6-2-1-åŸºæ•°"><a href="#6-2-1-åŸºæ•°" class="headerlink" title="6.2.1 åŸºæ•°"></a>6.2.1 åŸºæ•°</h4><ul><li>åŸºæ•°æ˜¯æ•°æ®é›†<strong>å»é‡åå…ƒç´ ä¸ªæ•°</strong></li><li>HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ï¼Œè¿ç”¨äº†LogLogçš„ç®—æ³•</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_31_20210327.png"></p><h4 id="6-2-2-åŸºæœ¬æ“ä½œ"><a href="#6-2-2-åŸºæœ¬æ“ä½œ" class="headerlink" title="6.2.2 åŸºæœ¬æ“ä½œ"></a>6.2.2 åŸºæœ¬æ“ä½œ</h4><ul><li><p>æ·»åŠ æ•°æ®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pfadd</span> key element<span class="hljs-number">1</span>, element<span class="hljs-number">2</span>...<br></code></pre></td></tr></table></figure></li><li><p>ç»Ÿè®¡æ•°æ®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pfcount</span> key<span class="hljs-number">1</span> key<span class="hljs-number">2</span>....<br></code></pre></td></tr></table></figure></li><li><p>åˆå¹¶æ•°æ®</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pfmerge</span> destkey sourcekey<span class="hljs-meta"> [sourcekey...]</span><br></code></pre></td></tr></table></figure></li></ul><h4 id="6-2-3-ç›¸å…³è¯´æ˜"><a href="#6-2-3-ç›¸å…³è¯´æ˜" class="headerlink" title="6.2.3 ç›¸å…³è¯´æ˜"></a>6.2.3 ç›¸å…³è¯´æ˜</h4><ul><li>ç”¨äºè¿›è¡ŒåŸºæ•°ç»Ÿè®¡ï¼Œ<strong>ä¸æ˜¯é›†åˆï¼Œä¸ä¿å­˜æ•°æ®</strong>ï¼Œåªè®°å½•æ•°é‡è€Œä¸æ˜¯å…·ä½“æ•°æ®</li><li>æ ¸å¿ƒæ˜¯åŸºæ•°ä¼°ç®—ç®—æ³•ï¼Œæœ€ç»ˆæ•°å€¼<strong>å­˜åœ¨ä¸€å®šè¯¯å·®</strong></li><li>è¯¯å·®èŒƒå›´ï¼šåŸºæ•°ä¼°è®¡çš„ç»“æœæ˜¯ä¸€ä¸ªå¸¦æœ‰ 0.81% æ ‡å‡†é”™è¯¯çš„è¿‘ä¼¼å€¼</li><li><strong>è€—ç©ºé—´æå°</strong>ï¼Œæ¯ä¸ªhyperloglog keyå ç”¨äº†12Kçš„å†…å­˜ç”¨äºæ ‡è®°åŸºæ•°</li><li>pfaddå‘½ä»¤ä¸æ˜¯ä¸€æ¬¡æ€§åˆ†é…12Kå†…å­˜ä½¿ç”¨ï¼Œä¼šéšç€åŸºæ•°çš„å¢åŠ å†…å­˜<strong>é€æ¸å¢å¤§</strong></li><li>Pfmergeå‘½ä»¤<strong>åˆå¹¶åå ç”¨</strong>çš„å­˜å‚¨ç©ºé—´ä¸º<strong>12K</strong>ï¼Œæ— è®ºåˆå¹¶ä¹‹å‰æ•°æ®é‡å¤šå°‘</li></ul><h3 id="6-3-GEO"><a href="#6-3-GEO" class="headerlink" title="6.3 GEO"></a>6.3 GEO</h3><h4 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h4><ul><li><p>æ·»åŠ åæ ‡ç‚¹</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">geoadd key longitude latitude member <span class="hljs-comment">[longitude latitude member ...]</span> <br>georadius key longitude latitude radius m|km|ft|mi <span class="hljs-comment">[withcoord]</span> <span class="hljs-comment">[withdist]</span> <span class="hljs-comment">[withhash]</span> <span class="hljs-comment">[count count]</span><br></code></pre></td></tr></table></figure></li><li><p>è·å–åæ ‡ç‚¹</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">geopos <span class="hljs-built_in">key</span> <span class="hljs-built_in">member</span> [<span class="hljs-built_in">member</span> ...] <br>georadiusbymember <span class="hljs-built_in">key</span> <span class="hljs-built_in">member</span> <span class="hljs-built_in">radius</span> m|km|ft|mi [withcoord] [withdist] [withhash] [count count]<br></code></pre></td></tr></table></figure></li><li><p>è®¡ç®—åæ ‡ç‚¹è·ç¦»</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">geodist <span class="hljs-built_in">key</span> member1 member2 [unit] <br>geohash <span class="hljs-built_in">key</span> <span class="hljs-built_in">member</span> [<span class="hljs-built_in">member</span> ...]<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RedisåŸºç¡€</title>
    <link href="/2021/03/26/Redis%E5%9F%BA%E7%A1%80/"/>
    <url>/2021/03/26/Redis%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="RedisåŸºç¡€"><a href="#RedisåŸºç¡€" class="headerlink" title="RedisåŸºç¡€"></a>RedisåŸºç¡€</h1><p>å­¦ä¹ Javawebæ—¶ï¼Œå­¦ä¹ è¿‡Redisçš„åŸºæœ¬ä½¿ç”¨ï¼Œå­¦ä¹ <a href="https://www.bilibili.com/video/BV1CJ411m7Gc">é»‘é©¬Redis</a>è¿›é˜¶å†…å®¹é¡ºå¸¦å¤ä¹ ä¸€ä¸‹åŸºç¡€ï¼Œæ•´ç†æœ¬å­¦ä¹ ç¬”è®°</p><h2 id="1-å…¥é—¨"><a href="#1-å…¥é—¨" class="headerlink" title="1. å…¥é—¨"></a>1. å…¥é—¨</h2><h3 id="1-1-NoSQLç®€ä»‹"><a href="#1-1-NoSQLç®€ä»‹" class="headerlink" title="1.1 NoSQLç®€ä»‹"></a>1.1 NoSQLç®€ä»‹</h3><p>NoSQLï¼šå³Not-OnlySQLï¼ˆæ³›æŒ‡éå…³ç³»æ€§æ•°æ®åº“ï¼‰ï¼Œä½œä¸ºå…³ç³»å‹æ•°æ®åº“çš„è¡¥å……</p><p>ä½œç”¨ï¼šåº”å¯¹åŸºäºæµ·é‡æ•°æ®å’Œæµ·é‡ç”¨æˆ·çš„æ•°æ®å¤„ç†ã€‚</p><p>ç‰¹å¾ï¼š</p><ul><li>å¯æ‰©å®¹ï¼Œå¯ä¼¸å±•</li><li>å¤§æ•°æ®é‡ä¸‹é«˜æ€§èƒ½</li><li>çµæ´»çš„æ•°æ®æ¨¡å‹</li><li>é«˜å¯ç”¨</li></ul><p>å¸¸è§çš„NoSQLæ•°æ®åº“ï¼š</p><ul><li><font color="FF0000"><strong>Redis</strong></font></li><li>memcache</li><li>HBase</li><li>MongoDB</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_2_20210325.png"></p><h3 id="1-2-Redisç®€ä»‹"><a href="#1-2-Redisç®€ä»‹" class="headerlink" title="1.2 Redisç®€ä»‹"></a>1.2 Redisç®€ä»‹</h3><blockquote><p>æ¦‚å¿µï¼šRedisï¼ˆREmote DIctionary Serverï¼‰æ˜¯ç”¨Cè¯­è¨€å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„é«˜æ€§èƒ½é”®å€¼å¯¹ï¼ˆkey-valueï¼‰æ•°æ®åº“ã€‚</p></blockquote><p>ç‰¹å¾ï¼š</p><ul><li>æ•°æ®ä¹‹é—´æ²¡æœ‰å¿…ç„¶çš„è”ç³»</li><li>å†…éƒ¨é‡‡ç”¨äº†å•çº¿ç¨‹æœºåˆ¶è¿›è¡Œå·¥ä½œ</li><li>é«˜æ€§èƒ½</li><li>å¤šæ•°æ®ç±»å‹æ”¯æŒ<ul><li>String</li><li>list</li><li>hash</li><li>set</li><li>sorted_set</li></ul></li><li>æŒä¹…åŒ–æ”¯æŒï¼Œå¯ä»¥è¿›è¡Œæ•°æ®ç¾éš¾æ¢å¤</li></ul><p>åº”ç”¨ï¼š</p><ul><li>çƒ­ç‚¹æ•°æ®åŠ é€ŸæŸ¥è¯¢ï¼ˆçƒ­ç‚¹èµ„è®¯ï¼Œçƒ­ç‚¹å•†å“ï¼‰</li><li>ä»»åŠ¡é˜Ÿåˆ—ï¼ˆç§’æ€ï¼‰</li><li>å³ä½¿ä¿¡æ¯æŸ¥è¯¢ï¼ˆæ’è¡Œæ¦œï¼‰</li><li>æ—¶æ•ˆæ€§ä¹ æ€§æ§åˆ¶ï¼ˆéªŒè¯ç ï¼‰</li><li>åˆ†å¸ƒå¼æ•°æ®å…±äº«ï¼ˆåˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„sessionåˆ†ç¦»ï¼‰</li><li>æ¶ˆæ¯é˜Ÿåˆ—</li><li>åˆ†å¸ƒå¼é”</li></ul><h3 id="1-3-Rediså¸¸ç”¨æŒ‡ä»¤"><a href="#1-3-Rediså¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="1.3 Rediså¸¸ç”¨æŒ‡ä»¤"></a>1.3 Rediså¸¸ç”¨æŒ‡ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å¯åŠ¨å®¹å™¨</span><br>docker run -d -p 6379:6379 -it  --name=&quot;myredis&quot;  redis<br><span class="hljs-meta">#</span><span class="bash"> è¾“å…¥å¯†ç ï¼š</span><br>auth å¯†ç <br><span class="hljs-meta">#</span><span class="bash"> è¿›å…¥rediså®¹å™¨</span><br>docker exec -it myredis  redis-cli<br><span class="hljs-meta">#</span><span class="bash"> é€€å‡º</span><br>quit<br>exit<br><span class="hljs-meta">#</span><span class="bash"> æ¸…å±</span><br>clear<br><span class="hljs-meta">#</span><span class="bash"> è·å–å¸®åŠ©, å¯ä»¥ä½¿ç”¨Tabé”®æ¥åˆ‡æ¢</span><br>help å‘½ä»¤åç§°<br>help @ç»„å<br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®/è·å–æ•°æ®</span><br>set name xlh<br>get name<br></code></pre></td></tr></table></figure><h2 id="2-æ•°æ®ç±»å‹"><a href="#2-æ•°æ®ç±»å‹" class="headerlink" title="2. æ•°æ®ç±»å‹"></a>2. æ•°æ®ç±»å‹</h2><p>redisæ•°æ®å­˜å‚¨æ ¼å¼</p><ul><li>redisè‡ªèº«æ˜¯ä¸€ä¸ªmapï¼Œå…¶ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯é‡‡ç”¨çš„<font color="FF0000">keyï¼švalue</font>çš„å½¢å¼å­˜å‚¨[^1]</li><li>æ•°æ®ç±»å‹æŒ‡çš„æ˜¯valueéƒ¨åˆ†çš„ç±»å‹ï¼Œkeyéƒ¨åˆ†éƒ½æ˜¯String</li></ul><h3 id="2-1-String"><a href="#2-1-String" class="headerlink" title="2.1 String"></a>2.1 String</h3><h4 id="2-1-1-åŸºæœ¬æ“ä½œ"><a href="#2-1-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.1.1 åŸºæœ¬æ“ä½œ"></a>2.1.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®String</span><br>set key value<br>mset key1 value1 key2 value2...<br><br><span class="hljs-meta">#</span><span class="bash"> å¾—åˆ°String</span><br>get key <br>mget key1 key2...<br><span class="hljs-meta">#</span><span class="bash"> è·å–å­—ç¬¦ä¸²é•¿åº¦</span><br>strlen key<br><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤String</span><br>del key<br><br><span class="hljs-meta">#</span><span class="bash"> å‘å­—ç¬¦ä¸²çš„åé¢è¿½åŠ å­—ç¬¦ï¼Œå¦‚æœæœ‰å°±è¡¥åœ¨åé¢ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»º</span><br>append key value<br></code></pre></td></tr></table></figure><h4 id="2-1-2-å•-å¤šæŒ‡ä»¤å¯¹æ¯”"><a href="#2-1-2-å•-å¤šæŒ‡ä»¤å¯¹æ¯”" class="headerlink" title="2.1.2 å•/å¤šæŒ‡ä»¤å¯¹æ¯”"></a>2.1.2 å•/å¤šæŒ‡ä»¤å¯¹æ¯”</h4><ul><li>å•æŒ‡ä»¤å¯¹æ¯”å¤šæŒ‡ä»¤ï¼ˆå¯¹äºå¤šæŒ‡ä»¤ï¼Œå¦‚æœæ‰§è¡Œäº‹é—´è¿‡é•¿å¯¹äºå•çº¿ç¨‹æ“ä½œæ—¶ä¸é€‚ç”¨çš„ï¼Œæ³¨æ„åŠæ—¶åˆ‡å‰²ï¼‰</li></ul><h4 id="2-1-3-æ‹“å±•æ“ä½œ"><a href="#2-1-3-æ‹“å±•æ“ä½œ" class="headerlink" title="2.1.3 æ‹“å±•æ“ä½œ"></a>2.1.3 æ‹“å±•æ“ä½œ</h4><ul><li><p>Stringä½œä¸ºæ•°å€¼çš„æ“ä½œ</p><ul><li>stringåœ¨rediså†…éƒ¨å­˜å‚¨é»˜è®¤å°±æ˜¯ä¸€ä¸ª<strong>å­—ç¬¦ä¸²</strong>ï¼Œå½“é‡åˆ°å¢å‡ç±»æ“ä½œincrï¼Œdecræ—¶ä¼š<strong>è½¬æˆæ•°å€¼å‹</strong>è¿›è¡Œè®¡ç®—ã€‚</li><li>redisæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯<strong>åŸå­æ€§</strong>çš„ï¼Œé‡‡ç”¨<strong>å•çº¿ç¨‹</strong>å¤„ç†æ‰€æœ‰ä¸šåŠ¡ï¼Œå‘½ä»¤æ˜¯ä¸€ä¸ªä¸€ä¸ªæ‰§è¡Œçš„ï¼Œå› æ­¤æ— éœ€è€ƒè™‘å¹¶å‘å¸¦æ¥çš„æ•°æ®å½±å“ã€‚</li><li>æ³¨æ„ï¼š<font color="FF0000">æŒ‰æ•°å€¼è¿›è¡Œæ“ä½œçš„æ•°æ®ï¼Œå¦‚æœåŸå§‹æ•°æ®ä¸èƒ½è½¬æˆæ•°å€¼ï¼Œæˆ–è¶…è¶Šäº†redis æ•°å€¼ä¸Šé™èŒƒå›´ï¼Œå°†æŠ¥é”™ã€‚</font> 9223372036854775807ï¼ˆjavaä¸­longå‹æ•°æ®æœ€å¤§å€¼ï¼ŒLong.MAX_VALUEï¼‰</li></ul><p><strong>tipsï¼š</strong></p><ul><li>redisç”¨äºæ§åˆ¶æ•°æ®åº“è¡¨ä¸»é”®idï¼Œä¸ºæ•°æ®åº“è¡¨ä¸»é”®<strong>æä¾›ç”Ÿæˆç­–ç•¥</strong>ï¼Œä¿éšœæ•°æ®åº“è¡¨çš„ä¸»é”®<strong>å”¯ä¸€æ€§</strong></li><li>æ­¤æ–¹æ¡ˆé€‚ç”¨äºæ‰€æœ‰æ•°æ®åº“ï¼Œä¸”æ”¯æŒæ•°æ®åº“é›†ç¾¤</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å¢é•¿æŒ‡ä»¤ï¼Œåªæœ‰å½“valueä¸ºæ•°å­—æ—¶æ‰èƒ½å¢é•¿</span><br>incr key  <br>incrby key increment  <br>incrbyfloat key increment <br><br><span class="hljs-meta">#</span><span class="bash"> å‡å°‘æŒ‡ä»¤ï¼Œæœ‰å½“valueä¸ºæ•°å­—æ—¶æ‰èƒ½å‡å°‘</span><br>decr key  <br>decrby key increment<br></code></pre></td></tr></table></figure><ul><li><strong>æŒ‡å®šç”Ÿå‘½å‘¨æœŸ</strong><ul><li>redis æ§åˆ¶æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œé€šè¿‡æ•°æ®æ˜¯å¦å¤±æ•ˆæ§åˆ¶ä¸šåŠ¡è¡Œä¸ºï¼Œé€‚ç”¨äºæ‰€æœ‰å…·æœ‰æ—¶æ•ˆæ€§é™å®šæ§åˆ¶çš„æ“ä½œ</li></ul></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œå•ä½ ç§’</span><br>setex key seconds value<br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®æ•°æ®çš„ç”Ÿå‘½å‘¨æœŸï¼Œå•ä½ æ¯«ç§’</span><br>psetex key milliseconds value<br></code></pre></td></tr></table></figure><h4 id="2-1-4-Stringç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"><a href="#2-1-4-Stringç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.1.4 Stringç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"></a>2.1.4 Stringç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_3_20210325.png"></p><ul><li><p>keyçš„è®¾ç½®çº¦å®š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_4_20210326.png"></p></li></ul><h3 id="2-2-Hash"><a href="#2-2-Hash" class="headerlink" title="2.2 Hash"></a>2.2 Hash</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_5_20210326.png"></p><ul><li>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå¯¹ä¸€ç³»åˆ—å­˜å‚¨çš„æ•°æ®è¿›è¡Œç¼–ç»„ï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œå…¸å‹åº”ç”¨å­˜å‚¨å¯¹è±¡ä¿¡æ¯</li><li>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªé”®å€¼å¯¹æ•°æ®</li><li>hashç±»å‹ï¼šåº•å±‚ä½¿ç”¨å“ˆå¸Œè¡¨ç»“æ„å®ç°æ•°æ®å­˜å‚¨</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_6_20210325.png"></p><h4 id="2-2-1-åŸºæœ¬æ“ä½œ"><a href="#2-2-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.2.1 åŸºæœ¬æ“ä½œ"></a>2.2.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ’å…¥ï¼ˆå¦‚æœå·²å­˜åœ¨åŒåçš„fieldï¼Œä¼šè¢«è¦†ç›–ï¼‰</span><br>hset key field value<br>hmset key field1 value1 field2 value2...<br><br><span class="hljs-meta">#</span><span class="bash"> å–å‡º</span><br>hget key field<br>hgetall key<br><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤</span><br>hdel key field1 field2...<br><br><span class="hljs-meta">#</span><span class="bash"> è·å–fieldæ•°é‡</span><br>hlen key<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹æ˜¯å¦å­˜åœ¨</span><br>hexists key field<br></code></pre></td></tr></table></figure><h4 id="2-2-2-æ‹“å±•æ“ä½œ"><a href="#2-2-2-æ‹“å±•æ“ä½œ" class="headerlink" title="2.2.2 æ‹“å±•æ“ä½œ"></a>2.2.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è·å–å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰çš„å­—æ®µåæˆ–å­—æ®µå€¼</span> <br>hkeys key<br>hvals key<br><br><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®æŒ‡å®šå­—æ®µçš„æ•°å€¼æ•°æ®å¢åŠ æŒ‡å®šèŒƒå›´çš„å€¼</span> <br>hincrby key field increment <br>hdecrby key field increment<br><br><span class="hljs-meta">#</span><span class="bash"> æ’å…¥ï¼ˆå¦‚æœå·²å­˜åœ¨åŒåçš„fieldï¼Œä¸ä¼šè¢«è¦†ç›–ï¼‰</span><br>hsetnx key field value<br></code></pre></td></tr></table></figure><h4 id="2-2-3-hashç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"><a href="#2-2-3-hashç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.2.3 hashç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"></a>2.2.3 hashç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</h4><ul><li>hashç±»å‹ä¸‹çš„value<strong>åªèƒ½å­˜å‚¨å­—ç¬¦ä¸²</strong>ï¼Œä¸å…è®¸å­˜å‚¨å…¶ä»–æ•°æ®ç±»å‹ï¼Œ<strong>ä¸å­˜åœ¨åµŒå¥—ç°è±¡</strong>ã€‚å¦‚æœæ•°æ®æœªè·å–åˆ°ï¼Œ å¯¹åº”çš„å€¼ä¸ºï¼ˆnilï¼‰</li><li>æ¯ä¸ª hash å¯ä»¥å­˜å‚¨ 2^32 - 1 ä¸ªé”®å€¼</li><li>hashç±»å‹ååˆ†è´´è¿‘å¯¹è±¡çš„æ•°æ®å­˜å‚¨å½¢å¼ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»æ·»åŠ åˆ é™¤å¯¹è±¡å±æ€§ã€‚ä½†hashè®¾è®¡åˆè¡·ä¸æ˜¯ä¸ºäº†å­˜å‚¨å¤§é‡å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œ<strong>åˆ‡è®°ä¸å¯æ»¥ç”¨</strong>ï¼Œæ›´<strong>ä¸å¯ä»¥å°†hashä½œä¸ºå¯¹è±¡åˆ—è¡¨ä½¿ç”¨</strong></li><li>hgetall æ“ä½œå¯ä»¥è·å–å…¨éƒ¨å±æ€§ï¼Œå¦‚æœå†…éƒ¨fieldè¿‡å¤šï¼Œéå†æ•´ä½“<strong>æ•°æ®æ•ˆç‡å°±å¾ˆä¼šä½</strong>ï¼Œæœ‰å¯èƒ½æˆä¸ºæ•°æ®è®¿é—®ç“¶é¢ˆ</li></ul><h3 id="2-3-List"><a href="#2-3-List" class="headerlink" title="2.3 List"></a>2.3 List</h3><ul><li>æ•°æ®å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤šä¸ªæ•°æ®ï¼Œå¹¶å¯¹æ•°æ®è¿›å…¥å­˜å‚¨ç©ºé—´çš„é¡ºåºè¿›è¡ŒåŒºåˆ†</li><li>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šä¸€ä¸ªå­˜å‚¨ç©ºé—´ä¿å­˜å¤šä¸ªæ•°æ®ï¼Œä¸”é€šè¿‡æ•°æ®å¯ä»¥ä½“ç°è¿›å…¥é¡ºåº</li><li>listç±»å‹ï¼šä¿å­˜å¤šä¸ªæ•°æ®ï¼Œåº•å±‚ä½¿ç”¨åŒå‘é“¾è¡¨å­˜å‚¨ç»“æ„å®ç°</li><li><strong>å…ƒç´ æœ‰åºï¼Œä¸”å¯é‡</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_8_20210326.png"></p><h4 id="2-3-1-åŸºæœ¬æ“ä½œ"><a href="#2-3-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.3.1 åŸºæœ¬æ“ä½œ"></a>2.3.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ·»åŠ ä¿®æ”¹æ•°æ®,lpushä¸ºä»å·¦è¾¹æ·»åŠ ï¼Œrpushä¸ºä»å³è¾¹æ·»åŠ </span><br>lpush key value1 value2 value3...<br>rpush key value1 value2 value3...<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹æ•°æ®, ä»å·¦è¾¹å¼€å§‹å‘å³æŸ¥çœ‹. å¦‚æœä¸çŸ¥é“listæœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œendçš„å€¼å¯ä»¥ä¸º-1,ä»£è¡¨å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ </span><br><span class="hljs-meta">#</span><span class="bash"> lpushå…ˆè¿›çš„å…ƒç´ æ”¾åœ¨æœ€å,rpushå…ˆè¿›çš„å…ƒç´ æ”¾åœ¨æœ€å‰é¢</span><br>lrange key start end<br><span class="hljs-meta">#</span><span class="bash"> å–å‡ºå¯¹åº”ç´¢å¼•çš„å…ƒç´ </span><br>lindex key index<br><span class="hljs-meta">#</span><span class="bash"> å¾—åˆ°é•¿åº¦</span><br>llen key<br><br><span class="hljs-meta">#</span><span class="bash"> è·å–å¹¶ç§»é™¤å…ƒç´ ï¼ˆä»listå·¦è¾¹æˆ–è€…å³è¾¹ç§»é™¤ï¼‰</span><br>lpop key<br>rpop key<br></code></pre></td></tr></table></figure><h4 id="2-3-2-æ‹“å±•æ“ä½œ"><a href="#2-3-2-æ‹“å±•æ“ä½œ" class="headerlink" title="2.3.2 æ‹“å±•æ“ä½œ"></a>2.3.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è§„å®šæ—¶é—´å†…è·å–å¹¶ç§»é™¤æ•°æ®,b=block,ç»™å®šä¸€ä¸ªæ—¶é—´ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…æ”¾å…¥äº†å…ƒç´ ï¼Œå°±ç§»é™¤</span><br>blpop key1 key2... timeout<br>brpop key1 key2... timeout<br><br><span class="hljs-meta">#</span><span class="bash"> ç§»é™¤æŒ‡å®šå…ƒç´  count:ç§»é™¤çš„ä¸ªæ•° value:ç§»é™¤çš„å€¼ã€‚ ç§»é™¤å¤šä¸ªç›¸åŒå…ƒç´ æ—¶ï¼Œä»å·¦è¾¹å¼€å§‹ç§»é™¤</span><br>lrem key count value<br></code></pre></td></tr></table></figure><h4 id="2-3-3-listç±»å‹æ•°æ®æ“ä½œæ³¨æ„äº‹é¡¹"><a href="#2-3-3-listç±»å‹æ•°æ®æ“ä½œæ³¨æ„äº‹é¡¹" class="headerlink" title="2.3.3 listç±»å‹æ•°æ®æ“ä½œæ³¨æ„äº‹é¡¹"></a>2.3.3 listç±»å‹æ•°æ®æ“ä½œæ³¨æ„äº‹é¡¹</h4><ul><li>listä¸­ä¿å­˜çš„æ•°æ®éƒ½æ˜¯stringç±»å‹çš„ï¼Œæ•°æ®æ€»å®¹é‡æ˜¯æœ‰é™çš„ï¼Œæœ€å¤š2^32 - 1 ä¸ªå…ƒç´  (4294967295)ã€‚</li><li>listå…·æœ‰ç´¢å¼•çš„æ¦‚å¿µï¼Œä½†æ˜¯æ“ä½œæ•°æ®æ—¶é€šå¸¸ä»¥<strong>é˜Ÿåˆ—</strong>çš„å½¢å¼è¿›è¡Œå…¥é˜Ÿå‡ºé˜Ÿ(rpush, rpop)æ“ä½œï¼Œæˆ–ä»¥<strong>æ ˆ</strong>çš„å½¢å¼è¿›è¡Œå…¥æ ˆå‡ºæ ˆ(lpush, lpop)æ“ä½œ</li><li>è·å–å…¨éƒ¨æ•°æ®æ“ä½œç»“æŸç´¢å¼•è®¾ç½®ä¸º-1 (å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ )</li><li>listå¯ä»¥å¯¹æ•°æ®è¿›è¡Œåˆ†é¡µæ“ä½œï¼Œé€šå¸¸ç¬¬ä¸€é¡µçš„ä¿¡æ¯æ¥è‡ªäºlistï¼Œç¬¬2é¡µåŠæ›´å¤šçš„ä¿¡æ¯é€šè¿‡æ•°æ®åº“çš„å½¢å¼åŠ è½½</li></ul><h3 id="2-4-Set"><a href="#2-4-Set" class="headerlink" title="2.4 Set"></a>2.4 Set</h3><ul><li>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šå­˜å‚¨å¤§é‡æ•°æ®ï¼Œåœ¨æŸ¥è¯¢æ–¹é¢æä¾›æ›´é«˜çš„æ•ˆç‡</li><li>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šèƒ½å¤Ÿä¿å­˜å¤§é‡çš„æ•°æ®ï¼Œé«˜æ•ˆçš„å†…éƒ¨å­˜å‚¨æœºåˆ¶ï¼Œä¾¿äºæŸ¥è¯¢</li><li>setç±»å‹ï¼šä¸hashå­˜å‚¨ç»“æ„å®Œå…¨ç›¸åŒï¼Œä»…å­˜é”®ï¼Œä¸å­˜å€¼ï¼ˆnilï¼‰ï¼Œå¹¶ä¸”å€¼æ—¶ä¸å…è®¸é‡å¤çš„</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_7_20210325.png"></p><h4 id="2-4-1-åŸºæœ¬æ“ä½œ"><a href="#2-4-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.4.1 åŸºæœ¬æ“ä½œ"></a>2.4.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ·»åŠ å…ƒç´ </span><br>sadd key member1 member2...<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹å…ƒç´ </span><br>smembers key<br><br><span class="hljs-meta">#</span><span class="bash"> ç§»é™¤å…ƒç´ </span><br>srem key member<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹å…ƒç´ ä¸ªæ•°</span><br>scard key<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨</span><br>sismember key member<br></code></pre></td></tr></table></figure><h4 id="2-4-2-æ‹“å±•æ“ä½œ"><a href="#2-4-2-æ‹“å±•æ“ä½œ" class="headerlink" title="2.4.2 æ‹“å±•æ“ä½œ"></a>2.4.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ä»<span class="hljs-built_in">set</span>ä¸­ä»»æ„é€‰å‡ºcountä¸ªå…ƒç´ </span><br>srandmember key count<br><br><span class="hljs-meta">#</span><span class="bash"> ä»<span class="hljs-built_in">set</span>ä¸­ä»»æ„é€‰å‡ºcountä¸ªå…ƒç´ å¹¶ç§»é™¤</span><br>spop key count<br><br><span class="hljs-meta">#</span><span class="bash"> æ±‚ä¸¤ä¸ªé›†åˆçš„äº¤é›†ã€å¹¶é›†ã€å·®é›†</span><br>sinter key1 key2...<br>sunion key1 key2...<br>sdiff key1 key2...<br><br><span class="hljs-meta">#</span><span class="bash"> æ±‚ä¸¤ä¸ª<span class="hljs-built_in">set</span>çš„äº¤é›†ã€å¹¶é›†ã€å·®é›†ï¼Œå¹¶æ”¾å…¥å¦ä¸€ä¸ª<span class="hljs-built_in">set</span>ä¸­</span><br>sinterstore destination key1 key2...<br>sunionstore destination key1 key2...<br>sdiffstore destination key1 key2...<br><br><span class="hljs-meta">#</span><span class="bash"> æ±‚æŒ‡å®šå…ƒç´ ä»åŸé›†åˆæ”¾å…¥ç›®æ ‡é›†åˆä¸­</span><br>smove source destination key<br></code></pre></td></tr></table></figure><h4 id="2-4-3-Setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"><a href="#2-4-3-Setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.4.3 Setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"></a>2.4.3 Setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</h4><ul><li>setç±»å‹ä¸å…è®¸æ•°æ®é‡å¤ï¼Œå¦‚æœæ·»åŠ çš„æ•°æ®åœ¨setä¸­å·²ç»å­˜åœ¨ï¼Œå°†åªä¿ç•™ä¸€ä»½</li><li>setè™½ç„¶ä¸hashçš„å­˜å‚¨ç»“æ„ç›¸åŒï¼Œä½†æ˜¯æ— æ³•å¯åŠ¨hashä¸­å­˜å‚¨å€¼çš„ç©ºé—´</li></ul><h3 id="2-5-Sorted-set"><a href="#2-5-Sorted-set" class="headerlink" title="2.5 Sorted_set"></a>2.5 Sorted_set</h3><ul><li>æ–°çš„å­˜å‚¨éœ€æ±‚ï¼šæ•°æ®æ’åºæœ‰åˆ©äºæ•°æ®çš„æœ‰æ•ˆå±•ç¤ºï¼Œéœ€è¦æä¾›ä¸€ç§å¯ä»¥æ ¹æ®è‡ªèº«ç‰¹å¾è¿›è¡Œ<strong>æ’åº</strong>çš„æ–¹å¼</li><li>éœ€è¦çš„å­˜å‚¨ç»“æ„ï¼šæ–°çš„å­˜å‚¨æ¨¡å‹ï¼Œå¯ä»¥ä¿å­˜<strong>å¯æ’åº</strong>çš„æ•°æ®</li><li>sorted_setç±»å‹ï¼šåœ¨setçš„å­˜å‚¨ç»“æ„åŸºç¡€ä¸Šæ·»åŠ å¯æ’åºå­—æ®µ</li><li><strong>ä¸é‡ä½†æœ‰åºï¼ˆscoreï¼‰</strong></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_9_20210326.png"></p><h4 id="2-5-1-åŸºæœ¬æ“ä½œ"><a href="#2-5-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="2.5.1 åŸºæœ¬æ“ä½œ"></a>2.5.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ’å…¥å…ƒç´ , éœ€è¦æŒ‡å®šscore(ç”¨äºæ’åº)</span><br>zadd key score1 member1 score2 member2<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹å…ƒç´ (scoreå‡åº), å½“æœ«å°¾æ·»åŠ withscoreæ—¶ï¼Œä¼šå°†å…ƒç´ çš„scoreä¸€èµ·æ‰“å°å‡ºæ¥</span><br>zrange key start end [withscore]<br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹å…ƒç´ (scoreé™åº), å½“æœ«å°¾æ·»åŠ withscoreæ—¶ï¼Œä¼šå°†å…ƒç´ çš„scoreä¸€èµ·æ‰“å°å‡ºæ¥</span><br>zrevrange key start end [withscore]<br><br><span class="hljs-meta">#</span><span class="bash"> ç§»é™¤å…ƒç´ </span><br>zrem key member1 member2...<br><br><span class="hljs-meta">#</span><span class="bash"> æŒ‰æ¡ä»¶è·å–æ•°æ®, å…¶ä¸­offsetä¸ºç´¢å¼•å¼€å§‹ä½ç½®ï¼Œcountä¸ºè·å–çš„æ•°ç›®</span><br>zrangebyscore key min max [withscore] [limit offset count]<br>zrevrangebyscore key max min [withscore] [limit offset count]<br><br><span class="hljs-meta">#</span><span class="bash"> æŒ‰æ¡ä»¶ç§»é™¤å…ƒç´ </span><br>zremrangebyrank key start end<br>zremrangebyscore key min max<br><span class="hljs-meta">#</span><span class="bash"> æŒ‰ç…§ä»å¤§åˆ°å°çš„é¡ºåºç§»é™¤countä¸ªå€¼</span><br>zpopmax key [count]<br><span class="hljs-meta">#</span><span class="bash"> æŒ‰ç…§ä»å°åˆ°å¤§çš„é¡ºåºç§»é™¤countä¸ªå€¼</span><br>zpopmin key [count]<br><br><span class="hljs-meta">#</span><span class="bash"> è·å¾—å…ƒç´ ä¸ªæ•°</span><br>zcard key<br><br><span class="hljs-meta">#</span><span class="bash"> è·å¾—å…ƒç´ åœ¨èŒƒå›´å†…çš„ä¸ªæ•°</span><br>zcount min max<br><br><span class="hljs-meta">#</span><span class="bash"> æ±‚äº¤é›†ã€å¹¶é›†å¹¶æ”¾å…¥destinationä¸­, å…¶ä¸­numkey1ä¸ºè¦å»äº¤é›†æˆ–å¹¶é›†é›†åˆçš„æ•°ç›®</span><br>zinterstore destination numkeys key1 key2...<br>zunionstore destination numkeys key1 key2...<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong></p><ul><li>minä¸maxç”¨äºé™å®šæœç´¢æŸ¥è¯¢çš„<strong>æ¡ä»¶</strong></li><li>startä¸stopç”¨äºé™å®š<strong>æŸ¥è¯¢èŒƒå›´</strong>ï¼Œä½œç”¨äºç´¢å¼•ï¼Œè¡¨ç¤ºå¼€å§‹å’Œç»“æŸç´¢å¼•</li><li>offsetä¸countç”¨äºé™å®šæŸ¥è¯¢èŒƒå›´ï¼Œä½œç”¨äºæŸ¥è¯¢ç»“æœï¼Œè¡¨ç¤º<strong>å¼€å§‹ä½ç½®</strong>å’Œ<strong>æ•°æ®æ€»é‡</strong></li></ul><h4 id="2-5-2-æ‹“å±•æ“ä½œ"><a href="#2-5-2-æ‹“å±•æ“ä½œ" class="headerlink" title="2.5.2 æ‹“å±•æ“ä½œ"></a>2.5.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹æŸä¸ªå…ƒç´ çš„ç´¢å¼•(æ’å)</span><br>zrank key member<br>zrevrank key member<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹æŸä¸ªå…ƒç´ ç´¢å¼•çš„å€¼</span><br>zscore key member<br><span class="hljs-meta">#</span><span class="bash"> å¢åŠ æŸä¸ªå…ƒç´ ç´¢å¼•çš„å€¼</span><br>zincrby key increment member<br></code></pre></td></tr></table></figure><h4 id="2-5-3-sorted-setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"><a href="#2-5-3-sorted-setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹" class="headerlink" title="2.5.3 sorted_setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹"></a>2.5.3 sorted_setç±»å‹æ•°æ®æ“ä½œçš„æ³¨æ„äº‹é¡¹</h4><ul><li>scoreä¿å­˜çš„æ•°æ®å­˜å‚¨ç©ºé—´æ˜¯64ä½ï¼Œå¦‚æœæ˜¯æ•´æ•°èŒƒå›´æ˜¯-9007199254740992~9007199254740992</li><li>scoreä¿å­˜çš„æ•°æ®ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒç²¾åº¦çš„doubleå€¼ï¼ŒåŸºäºåŒç²¾åº¦æµ®ç‚¹æ•°çš„ç‰¹å¾ï¼Œ<strong>å¯èƒ½ä¼šä¸¢å¤±ç²¾åº¦</strong>ï¼Œä½¿ç”¨æ—¶å€™è¦<strong>æ…é‡</strong></li><li>sorted_set åº•å±‚å­˜å‚¨è¿˜æ˜¯<strong>åŸºäºset</strong>ç»“æ„çš„ï¼Œå› æ­¤æ•°æ®<strong>ä¸èƒ½é‡å¤</strong>ï¼Œå¦‚æœé‡å¤æ·»åŠ ç›¸åŒçš„æ•°æ®ï¼Œscoreå€¼å°†è¢«åå¤è¦†ç›–ï¼Œ<strong>ä¿ç•™æœ€åä¸€æ¬¡</strong>ä¿®æ”¹çš„ç»“æœ</li></ul><h2 id="3-é€šç”¨æŒ‡ä»¤"><a href="#3-é€šç”¨æŒ‡ä»¤" class="headerlink" title="3. é€šç”¨æŒ‡ä»¤"></a>3. é€šç”¨æŒ‡ä»¤</h2><h3 id="3-1-key-ç‰¹å¾"><a href="#3-1-key-ç‰¹å¾" class="headerlink" title="3.1 key ç‰¹å¾"></a>3.1 key ç‰¹å¾</h3><ul><li>keyæ˜¯ä¸€ä¸ª<strong>å­—ç¬¦ä¸²</strong>ï¼Œé€šè¿‡keyè·å–redisä¸­ä¿å­˜çš„æ•°æ®</li></ul><h3 id="3-2-keyé€šç”¨æ“ä½œ"><a href="#3-2-keyé€šç”¨æ“ä½œ" class="headerlink" title="3.2 keyé€šç”¨æ“ä½œ"></a>3.2 keyé€šç”¨æ“ä½œ</h3><h4 id="3-2-1-åŸºæœ¬æ“ä½œ"><a href="#3-2-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="3.2.1 åŸºæœ¬æ“ä½œ"></a>3.2.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹keyæ˜¯å¦å­˜åœ¨</span><br>exists key<br><br><span class="hljs-meta">#</span><span class="bash"> åˆ é™¤key</span><br>del key<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹keyçš„ç±»å‹</span><br>type key<br></code></pre></td></tr></table></figure><h4 id="3-2-2-æ‹“å±•æ“ä½œ"><a href="#3-2-2-æ‹“å±•æ“ä½œ" class="headerlink" title="3.2.2 æ‹“å±•æ“ä½œ"></a>3.2.2 æ‹“å±•æ“ä½œ</h4><ul><li>æ—¶æ•ˆæ€§æ“ä½œ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> è®¾ç½®ç”Ÿå‘½å‘¨æœŸ</span><br>expire key seconds<br>pexpire key milliseconds<br><span class="hljs-meta">#</span><span class="bash"> Linuxä¸‹ä½¿ç”¨æ—¶é—´æˆ³è®¾ç½®æœ‰æ•ˆäº‹ä»¶</span><br>expireat key timestamp<br>pexpireat key milliseconds-timestamp<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹æœ‰æ•ˆæ—¶é—´, å¦‚æœæœ‰æœ‰æ•ˆæ—¶é—´åˆ™è¿”å›å‰©ä½™æœ‰æ•ˆæ—¶é—´, å¦‚æœä¸ºæ°¸ä¹…æœ‰æ•ˆï¼Œåˆ™è¿”å›-1, å¦‚æœKeyä¸å­˜åœ¨åˆ™è¿”å›-2</span><br>ttl key<br>pttl key<br><br><span class="hljs-meta">#</span><span class="bash"> å°†æœ‰æ—¶é™çš„æ•°æ®è®¾ç½®ä¸ºæ°¸ä¹…æœ‰æ•ˆ</span><br>persist key<br></code></pre></td></tr></table></figure><ul><li>æŸ¥è¯¢æ“ä½œ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ ¹æ®keyæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ•°æ®</span><br>keys pattern<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_10_20210326.png"></p><ul><li>å…¶ä»–æ“ä½œ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> é‡å‘½åkeyï¼Œä¸ºäº†é¿å…è¦†ç›–å·²æœ‰æ•°æ®ï¼Œå°½é‡å°‘å»ä¿®æ”¹å·²æœ‰keyçš„åå­—ï¼Œå¦‚æœè¦ä½¿ç”¨æœ€å¥½ä½¿ç”¨renamenx</span><br>rename key newKey<br>renamenx key newKey<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹æ‰€æœ‰å…³äºkeyçš„æ“ä½œ, å¯ä»¥ä½¿ç”¨Tabå¿«é€Ÿåˆ‡æ¢</span><br>help @generic<br></code></pre></td></tr></table></figure><h3 id="3-3-æ•°æ®åº“çš„é€šç”¨æŒ‡ä»¤"><a href="#3-3-æ•°æ®åº“çš„é€šç”¨æŒ‡ä»¤" class="headerlink" title="3.3 æ•°æ®åº“çš„é€šç”¨æŒ‡ä»¤"></a>3.3 æ•°æ®åº“çš„é€šç”¨æŒ‡ä»¤</h3><p>keyé‡å¤çš„é—®é¢˜</p><ul><li>keyæ—¶ç¨‹åºå‘˜å®šä¹‰çš„</li><li>redisä½¿ç”¨ä¸­æ•°æ®é‡ä¸æ–­å¢åŠ ï¼Œkeyä¹Ÿä¼šä¸æ–­å¢å¤š</li><li>æ•°æ®éƒ¨åˆ†ç§ç±»ï¼Œç±»åˆ«æ··åœ¨åœ¨ä¸€èµ·å®¹æ˜“é‡å¤æˆ–å†²çª</li></ul><p>è§£å†³ï¼šæ•°æ®åº“</p><ul><li>Redisä¸ºæ¯ä¸ªæœåŠ¡æä¾›æœ‰16ä¸ªæ•°æ®åº“ï¼Œç¼–å·ä»0åˆ°15</li><li>æ¯ä¸ªæ•°æ®åº“ä¹‹é—´çš„æ•°æ®ç›¸äº’ç‹¬ç«‹</li></ul><h4 id="3-3-1-åŸºæœ¬æ“ä½œ"><a href="#3-3-1-åŸºæœ¬æ“ä½œ" class="headerlink" title="3.3.1 åŸºæœ¬æ“ä½œ"></a>3.3.1 åŸºæœ¬æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åˆ‡æ¢æ•°æ®åº“ 0~15</span><br>select index<br><br><span class="hljs-meta">#</span><span class="bash"> å…¶ä»–æ“ä½œ</span><br>quit<br>ping<br>echo massage<br></code></pre></td></tr></table></figure><h4 id="3-3-2-æ‹“å±•æ“ä½œ"><a href="#3-3-2-æ‹“å±•æ“ä½œ" class="headerlink" title="3.3.2 æ‹“å±•æ“ä½œ"></a>3.3.2 æ‹“å±•æ“ä½œ</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> ç§»åŠ¨æ•°æ®, å¿…é¡»ä¿è¯ç›®çš„æ•°æ®åº“ä¸­æ²¡æœ‰è¯¥æ•°æ®</span><br>mov key db<br><br><span class="hljs-meta">#</span><span class="bash"> æŸ¥çœ‹è¯¥åº“ä¸­æ•°æ®æ€»é‡</span><br>dbsize<br></code></pre></td></tr></table></figure><h2 id="4-Jedis"><a href="#4-Jedis" class="headerlink" title="4. Jedis"></a>4. Jedis</h2><ul><li>Javaè¯­è¨€è¿æ¥redisçš„æœåŠ¡<ul><li>Jedis</li><li>SpringData Redis</li><li>Lettuce</li></ul></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/Redis_11_20210326.png"></p><ul><li><strong>JAVA</strong>æ“ä½œRediséœ€è¦å¯¼å…¥jaræˆ–å¼•å…¥Mavenä¾èµ–</li></ul><h3 id="4-1-Javaæ“ä½œredisçš„æ­¥éª¤"><a href="#4-1-Javaæ“ä½œredisçš„æ­¥éª¤" class="headerlink" title="4.1 Javaæ“ä½œredisçš„æ­¥éª¤"></a>4.1 Javaæ“ä½œredisçš„æ­¥éª¤</h3><ul><li>è¿æ¥Redis</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å‚æ•°ä¸ºRedisæ‰€åœ¨çš„ipåœ°å€å’Œç«¯å£å·</span><br>Jedis jedis = <span class="hljs-keyword">new</span> Jedis(String host, <span class="hljs-keyword">int</span> port)<br></code></pre></td></tr></table></figure><ul><li>æ“ä½œRedis</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æ“ä½œredisçš„æŒ‡ä»¤å’Œredisæœ¬èº«çš„æŒ‡ä»¤å‡ ä¹ä¸€è‡´</span><br>jedis.set(String key, String value);<br></code></pre></td></tr></table></figure><ul><li>æ–­å¼€è¿æ¥</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">jedis.close();<br></code></pre></td></tr></table></figure><ul><li>å¸¸è§„æ¼”ç¤ºTest</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.jedis.test;<br><br><span class="hljs-keyword">import</span> cn.itcast.jedis.util.JedisPoolUtils;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><span class="hljs-keyword">import</span> java.util.Set;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * jedisçš„æµ‹è¯•ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JedisTest</span> </span>&#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¿«é€Ÿå…¥é—¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//1. è·å–è¿æ¥</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">6379</span>);<br>        <span class="hljs-comment">//2. æ“ä½œ</span><br>        jedis.set(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>        <span class="hljs-comment">//3. å…³é—­è¿æ¥</span><br>        jedis.close();<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * string æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//1. è·å–è¿æ¥</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis();<span class="hljs-comment">//å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br>        <span class="hljs-comment">//2. æ“ä½œ</span><br>        <span class="hljs-comment">//å­˜å‚¨</span><br>        jedis.set(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&quot;zhangsan&quot;</span>);<br>        <span class="hljs-comment">//è·å–</span><br>        String username = jedis.get(<span class="hljs-string">&quot;username&quot;</span>);<br>        System.out.println(username);<br>        <span class="hljs-comment">//å¯ä»¥ä½¿ç”¨setex()æ–¹æ³•å­˜å‚¨å¯ä»¥æŒ‡å®šè¿‡æœŸæ—¶é—´çš„ key value</span><br>        jedis.setex(<span class="hljs-string">&quot;activecode&quot;</span>,<span class="hljs-number">20</span>,<span class="hljs-string">&quot;hehe&quot;</span>);<span class="hljs-comment">//å°†activecodeï¼šheheé”®å€¼å¯¹å­˜å…¥redisï¼Œå¹¶ä¸”20ç§’åè‡ªåŠ¨åˆ é™¤è¯¥é”®å€¼å¯¹</span><br>        <span class="hljs-comment">//3. å…³é—­è¿æ¥</span><br>        jedis.close();<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * hash æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//1. è·å–è¿æ¥</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis();<span class="hljs-comment">//å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br>        <span class="hljs-comment">//2. æ“ä½œ</span><br>        <span class="hljs-comment">// å­˜å‚¨hash</span><br>        jedis.hset(<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;lisi&quot;</span>);<br>        jedis.hset(<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-string">&quot;23&quot;</span>);<br>        jedis.hset(<span class="hljs-string">&quot;user&quot;</span>,<span class="hljs-string">&quot;gender&quot;</span>,<span class="hljs-string">&quot;female&quot;</span>);<br>        <span class="hljs-comment">// è·å–hash</span><br>        String name = jedis.hget(<span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(name);<br>        <span class="hljs-comment">// è·å–hashçš„æ‰€æœ‰mapä¸­çš„æ•°æ®</span><br>        Map&lt;String, String&gt; user = jedis.hgetAll(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-comment">// keyset</span><br>        Set&lt;String&gt; keySet = user.keySet();<br>        <span class="hljs-keyword">for</span> (String key : keySet) &#123;<br>            <span class="hljs-comment">//è·å–value</span><br>            String value = user.get(key);<br>            System.out.println(key + <span class="hljs-string">&quot;:&quot;</span> + value);<br>        &#125;<br>        <span class="hljs-comment">//3. å…³é—­è¿æ¥</span><br>        jedis.close();<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * list æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test4</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//1. è·å–è¿æ¥</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis();<span class="hljs-comment">//å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br>        <span class="hljs-comment">//2. æ“ä½œ</span><br>        <span class="hljs-comment">// list å­˜å‚¨</span><br>        jedis.lpush(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>);<span class="hljs-comment">//ä»å·¦è¾¹å­˜</span><br>        jedis.rpush(<span class="hljs-string">&quot;mylist&quot;</span>,<span class="hljs-string">&quot;a&quot;</span>,<span class="hljs-string">&quot;b&quot;</span>,<span class="hljs-string">&quot;c&quot;</span>);<span class="hljs-comment">//ä»å³è¾¹å­˜</span><br>        <span class="hljs-comment">// list èŒƒå›´è·å–</span><br>        List&lt;String&gt; mylist = jedis.lrange(<span class="hljs-string">&quot;mylist&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>        System.out.println(mylist);<br>        <span class="hljs-comment">// list å¼¹å‡º</span><br>        String element1 = jedis.lpop(<span class="hljs-string">&quot;mylist&quot;</span>);<span class="hljs-comment">//c</span><br>        System.out.println(element1);<br>        <br>        String element2 = jedis.rpop(<span class="hljs-string">&quot;mylist&quot;</span>);<span class="hljs-comment">//c</span><br>        System.out.println(element2);<br>        <span class="hljs-comment">// list èŒƒå›´è·å–</span><br>        List&lt;String&gt; mylist2 = jedis.lrange(<span class="hljs-string">&quot;mylist&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>        System.out.println(mylist2);<br>        <span class="hljs-comment">//3. å…³é—­è¿æ¥</span><br>        jedis.close();<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * set æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test5</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//1. è·å–è¿æ¥</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis();<span class="hljs-comment">//å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br>        <span class="hljs-comment">//2. æ“ä½œ</span><br>        <span class="hljs-comment">// set å­˜å‚¨</span><br>        jedis.sadd(<span class="hljs-string">&quot;myset&quot;</span>,<span class="hljs-string">&quot;java&quot;</span>,<span class="hljs-string">&quot;php&quot;</span>,<span class="hljs-string">&quot;c++&quot;</span>);<br>        <span class="hljs-comment">// set è·å–</span><br>        Set&lt;String&gt; myset = jedis.smembers(<span class="hljs-string">&quot;myset&quot;</span>);<br>        System.out.println(myset);<br>        <span class="hljs-comment">//3. å…³é—­è¿æ¥</span><br>        jedis.close();<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * sortedset æ•°æ®ç»“æ„æ“ä½œ</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test6</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//1. è·å–è¿æ¥</span><br>        Jedis jedis = <span class="hljs-keyword">new</span> Jedis();<span class="hljs-comment">//å¦‚æœä½¿ç”¨ç©ºå‚æ„é€ ï¼Œé»˜è®¤å€¼ &quot;localhost&quot;,6379ç«¯å£</span><br>        <span class="hljs-comment">//2. æ“ä½œ</span><br>        <span class="hljs-comment">// sortedset å­˜å‚¨</span><br>        jedis.zadd(<span class="hljs-string">&quot;mysortedset&quot;</span>,<span class="hljs-number">3</span>,<span class="hljs-string">&quot;äºšç‘Ÿ&quot;</span>);<br>        jedis.zadd(<span class="hljs-string">&quot;mysortedset&quot;</span>,<span class="hljs-number">30</span>,<span class="hljs-string">&quot;åè£”&quot;</span>);<br>        jedis.zadd(<span class="hljs-string">&quot;mysortedset&quot;</span>,<span class="hljs-number">55</span>,<span class="hljs-string">&quot;å­™æ‚Ÿç©º&quot;</span>);<br>        <span class="hljs-comment">// sortedset è·å–</span><br>        Set&lt;String&gt; mysortedset = jedis.zrange(<span class="hljs-string">&quot;mysortedset&quot;</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">1</span>);<br>        System.out.println(mysortedset);<br>        <span class="hljs-comment">//3. å…³é—­è¿æ¥</span><br>        jedis.close();<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * jedisè¿æ¥æ± ä½¿ç”¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test7</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//0.åˆ›å»ºä¸€ä¸ªé…ç½®å¯¹è±¡</span><br>        JedisPoolConfig config = <span class="hljs-keyword">new</span> JedisPoolConfig();<br>        config.setMaxTotal(<span class="hljs-number">50</span>);<br>        config.setMaxIdle(<span class="hljs-number">10</span>);<br>        <span class="hljs-comment">//1.åˆ›å»ºJedisè¿æ¥æ± å¯¹è±¡</span><br>        JedisPool jedisPool = <span class="hljs-keyword">new</span> JedisPool(config,<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">6379</span>);<br>        <span class="hljs-comment">//2.è·å–è¿æ¥</span><br>        Jedis jedis = jedisPool.getResource();<br>        <span class="hljs-comment">//3. ä½¿ç”¨</span><br>        jedis.set(<span class="hljs-string">&quot;hehe&quot;</span>,<span class="hljs-string">&quot;heihei&quot;</span>);<br>        <span class="hljs-comment">//4. å…³é—­ å½’è¿˜åˆ°è¿æ¥æ± ä¸­</span><br>        jedis.close();;<br><br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * jedisè¿æ¥æ± å·¥å…·ç±»ä½¿ç”¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test8</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-comment">//é€šè¿‡è¿æ¥æ± å·¥å…·ç±»è·å–</span><br>        Jedis jedis = JedisPoolUtils.getJedis();<br>        <span class="hljs-comment">//3. ä½¿ç”¨</span><br>        jedis.set(<span class="hljs-string">&quot;hello&quot;</span>,<span class="hljs-string">&quot;world&quot;</span>);<br>        <span class="hljs-comment">//4. å…³é—­ å½’è¿˜åˆ°è¿æ¥æ± ä¸­</span><br>        jedis.close();;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="4-2-Jediså·¥å…·ç±»æŠ½å–"><a href="#4-2-Jediså·¥å…·ç±»æŠ½å–" class="headerlink" title="4.2 Jediså·¥å…·ç±»æŠ½å–"></a>4.2 Jediså·¥å…·ç±»æŠ½å–</h3><ul><li>redis.properties(é…ç½®æ–‡ä»¶)</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">host</span>=<span class="hljs-string">127.0.0.1</span><br><span class="hljs-attr">port</span>=<span class="hljs-string">6379</span><br><span class="hljs-attr">maxTotal</span>=<span class="hljs-string">50</span><br><span class="hljs-attr">maxIdle</span>=<span class="hljs-string">10</span><br></code></pre></td></tr></table></figure><ul><li>JedisPoolUtilså·¥å…·ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.jedis.util;<br><br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.util.Properties;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> JedisPoolå·¥å…·ç±»</span><br><span class="hljs-comment">    åŠ è½½é…ç½®æ–‡ä»¶ï¼Œé…ç½®è¿æ¥æ± çš„å‚æ•°</span><br><span class="hljs-comment">    æä¾›è·å–è¿æ¥çš„æ–¹æ³•</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JedisPoolUtils</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> JedisPool jedisPool;<br><br>    <span class="hljs-keyword">static</span>&#123;<br>        <span class="hljs-comment">//è¯»å–é…ç½®æ–‡ä»¶</span><br>        InputStream is = JedisPoolUtils.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;jedis.properties&quot;</span>);<br>        <span class="hljs-comment">//åˆ›å»ºPropertieså¯¹è±¡</span><br>        Properties pro = <span class="hljs-keyword">new</span> Properties();<br>        <span class="hljs-comment">//å…³è”æ–‡ä»¶</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            pro.load(is);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-comment">//è·å–æ•°æ®ï¼Œè®¾ç½®åˆ°JedisPoolConfigä¸­</span><br>        JedisPoolConfig config = <span class="hljs-keyword">new</span> JedisPoolConfig();<br>        <br>config.setMaxTotal(Integer.parseInt(pro.getProperty(<span class="hljs-string">&quot;maxTotal&quot;</span>)));<br>        config.setMaxIdle(Integer.parseInt(pro.getProperty(<span class="hljs-string">&quot;maxIdle&quot;</span>)));<br><br>        <span class="hljs-comment">//åˆå§‹åŒ–JedisPool</span><br>        jedisPool = <span class="hljs-keyword">new</span> JedisPool(config,pro.getProperty(<span class="hljs-string">&quot;host&quot;</span>),Integer.parseInt(pro.getProperty(<span class="hljs-string">&quot;port&quot;</span>)));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–è¿æ¥æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Jedis <span class="hljs-title">getJedis</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span> jedisPool.getResource();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
      <tag>Jedis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è…¾è®¯å¤©ç¾å¼€å‘å®ä¹ ä¸€é¢</title>
    <link href="/2021/03/26/%E9%9D%A2%E8%AF%95%E5%A4%8D%E7%9B%98%EF%BC%9A%E8%85%BE%E8%AE%AF%E5%A4%A9%E7%BE%8E%E4%B8%80%E9%9D%A2/"/>
    <url>/2021/03/26/%E9%9D%A2%E8%AF%95%E5%A4%8D%E7%9B%98%EF%BC%9A%E8%85%BE%E8%AE%AF%E5%A4%A9%E7%BE%8E%E4%B8%80%E9%9D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="è…¾è®¯å¤©ç¾å®ä¹ ä¸€é¢"><a href="#è…¾è®¯å¤©ç¾å®ä¹ ä¸€é¢" class="headerlink" title="è…¾è®¯å¤©ç¾å®ä¹ ä¸€é¢"></a>è…¾è®¯å¤©ç¾å®ä¹ ä¸€é¢</h1><p>è‡ªæˆ‘ä»‹ç»</p><p>é¡¹ç›®ä»‹ç»</p><p>ä½ ä¼šC++ä¹ˆï¼Œä¼šä¸€äº›è„šæœ¬è¯­è¨€ä¹ˆï¼Ÿ</p><h2 id="1-å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ"><a href="#1-å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="1.å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ"></a>1.å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„åŒºåˆ«ï¼Ÿ</h2><p>â€œè¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½â€ï¼Œå…·ä½“çœ‹ <a href="http://blog.csdn.net/bing_bing/article/details/8093552">http://blog.csdn.net/bing_bing/article/details/8093552</a></p><table><thead><tr><th>ç»´åº¦</th><th>å¤šè¿›ç¨‹</th><th>å¤šçº¿ç¨‹</th><th>æ€»ç»“</th></tr></thead><tbody><tr><td>æ•°æ®å…±äº«ã€åŒæ­¥</td><td>æ•°æ®æ˜¯åˆ†å¼€çš„:å…±äº«å¤æ‚ï¼Œéœ€è¦ç”¨IPC;åŒæ­¥ç®€å•</td><td>å¤šçº¿ç¨‹å…±äº«è¿›ç¨‹æ•°æ®ï¼šå…±äº«ç®€å•ï¼›åŒæ­¥å¤æ‚</td><td>å„æœ‰ä¼˜åŠ¿</td></tr><tr><td>å†…å­˜ã€CPU</td><td>å ç”¨å†…å­˜å¤šã€åˆ‡æ¢å¤æ‚ã€CPUåˆ©ç”¨ç‡ä½</td><td>å ç”¨å†…å­˜å°‘ï¼Œåˆ‡æ¢ç®€å•ï¼ŒCPUåˆ©ç”¨ç‡é«˜</td><td>çº¿ç¨‹å ä¼˜</td></tr><tr><td>åˆ›å»ºé”€æ¯ã€åˆ‡æ¢</td><td>åˆ›å»ºé”€æ¯ã€åˆ‡æ¢å¤æ‚ï¼Œé€Ÿåº¦æ…¢</td><td>åˆ›å»ºé”€æ¯ã€åˆ‡æ¢ç®€å•ï¼Œé€Ÿåº¦å¿«</td><td>çº¿ç¨‹å ä¼˜</td></tr><tr><td>ç¼–ç¨‹è°ƒè¯•</td><td>ç¼–ç¨‹ç®€å•ï¼Œè°ƒè¯•ç®€å•</td><td>ç¼–ç¨‹å¤æ‚ï¼Œè°ƒè¯•å¤æ‚</td><td>è¿›ç¨‹å ä¼˜</td></tr><tr><td>å¯é æ€§</td><td>è¿›ç¨‹é—´ä¸ä¼šç›¸äº’å½±å“</td><td>ä¸€ä¸ªçº¿ç¨‹æŒ‚æ‰å°†å¯¼è‡´æ•´ä¸ªè¿›ç¨‹æŒ‚æ‰</td><td>è¿›ç¨‹å ä¼˜</td></tr><tr><td>åˆ†å¸ƒå¼</td><td>é€‚åº”äºå¤šæ ¸ã€å¤šæœºåˆ†å¸ƒ ï¼›å¦‚æœä¸€å°æœºå™¨ä¸å¤Ÿï¼Œæ‰©å±•åˆ°å¤šå°æœºå™¨æ¯”è¾ƒç®€å•</td><td>é€‚åº”äºå¤šæ ¸åˆ†å¸ƒ</td><td>è¿›ç¨‹å ä¼˜</td></tr></tbody></table><p>çº¿ç¨‹å’Œè¿›ç¨‹é—´çš„æ¯”è¾ƒ</p><table><thead><tr><th>å­è¿›ç¨‹ç»§æ‰¿çˆ¶è¿›ç¨‹çš„å±æ€§ï¼š</th><th>å­çº¿ç¨‹ç»§æ‰¿ä¸»çº¿ç¨‹çš„å±æ€§ï¼š</th></tr></thead><tbody><tr><td>å®é™…ç”¨æˆ·IDï¼Œå®é™…ç»„IDï¼Œæœ‰æ•ˆç”¨æˆ·IDï¼Œæœ‰æ•ˆç»„IDï¼›é™„åŠ ç»„IDï¼›<br/>è¿›ç¨‹ç»„IDï¼›<br/>ä¼šè¯IDï¼›<br/>æ§åˆ¶ç»ˆç«¯ï¼›<br/>è®¾ç½®ç”¨æˆ·IDæ ‡å¿—å’Œè®¾ç½®ç»„IDæ ‡å¿—ï¼›<br/>å½“å‰å·¥ä½œç›®å½•ï¼›<br/>æ ¹ç›®å½•ï¼›<br/>æ–‡ä»¶æ¨¡å¼åˆ›å»ºå±è”½å­—ï¼ˆumaskï¼‰ï¼›<br/>ä¿¡å·å±è”½å’Œå®‰æ’ï¼›<br/>é’ˆå¯¹ä»»ä¸€æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„åœ¨æ‰§è¡Œæ—¶å…³é—­ï¼ˆclose-on-execï¼‰æ ‡å¿—ï¼›<br/>ç¯å¢ƒï¼›<br/>è¿æ¥çš„å…±äº«å­˜å‚¨æ®µï¼›<br/>å­˜å‚¨æ˜ å°„ï¼›<br/>èµ„æºé™åˆ¶ï¼›</td><td>è¿›ç¨‹ä¸­çš„æ‰€æœ‰ä¿¡æ¯å¯¹è¯¥è¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å…±äº«çš„ï¼›<br/>å¯æ‰§è¡Œçš„ç¨‹åºæ–‡æœ¬;<br/>ç¨‹åºçš„å…¨å±€å†…å­˜ï¼›<br/>å †å†…å­˜ï¼›<br/>æ ˆï¼›<br/>æ–‡ä»¶æè¿°ç¬¦ï¼›<br/>ä¿¡å·çš„å¤„ç†æ˜¯è¿›ç¨‹ä¸­æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼ˆæ³¨æ„ï¼šå¦‚æœä¿¡å·çš„é»˜è®¤å¤„ç†æ˜¯ç»ˆæ­¢è¯¥è¿›ç¨‹é‚£ä¹ˆå³æ˜¯æŠŠä¿¡å·ä¼ ç»™æŸä¸ªçº¿ç¨‹ä¹Ÿä¸€æ ·ä¼šå°†è¿›ç¨‹æ€æ‰ï¼‰ï¼›</td></tr><tr><td>çˆ¶å­è¿›ç¨‹ä¹‹é—´çš„åŒºåˆ«ï¼š</td><td>å­çº¿ç¨‹ç‰¹æœ‰çš„ï¼š</td></tr><tr><td>forkçš„è¿”å›å€¼(=0å­è¿›ç¨‹)ï¼›<br/>è¿›ç¨‹IDä¸åŒï¼›<br/>ä¸¤ä¸ªè¿›ç¨‹å…·æœ‰ä¸åŒçš„çˆ¶è¿›ç¨‹IDï¼›<br/>å­è¿›ç¨‹çš„tms_utime,tms_stime,tms_cutimeä»¥åŠtms_ustimeå‡è¢«è®¾ç½®ä¸º0;<br/>ä¸ç»§æ‰¿çˆ¶è¿›ç¨‹è®¾ç½®çš„æ–‡ä»¶é”ï¼›<br/>å­è¿›ç¨‹çš„æœªå¤„ç†é—¹é’Ÿè¢«æ¸…é™¤ï¼›<br/>å­è¿›ç¨‹çš„æœªå¤„ç†ä¿¡å·é›†è®¾ç½®ä¸ºç©ºé›†ï¼›</td><td>çº¿ç¨‹ID;<br/>ä¸€ç»„å¯„å­˜å™¨å€¼ï¼›<br/>æ ˆï¼›<br/>è°ƒåº¦ä¼˜å…ˆçº§å’Œç­–ç•¥ï¼›<br/>ä¿¡å·å±è”½å­—ï¼›<br/>errnoå˜é‡ï¼›<br/>çº¿ç¨‹ç§æœ‰æ•°æ®ï¼›</td></tr></tbody></table><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95_tx_1.png"></p><h2 id="2-linuxäº†è§£ä¹ˆï¼Œselectã€pollã€epollçš„åŒºåˆ«ï¼Ÿ"><a href="#2-linuxäº†è§£ä¹ˆï¼Œselectã€pollã€epollçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="2.linuxäº†è§£ä¹ˆï¼Œselectã€pollã€epollçš„åŒºåˆ«ï¼Ÿ"></a>2.linuxäº†è§£ä¹ˆï¼Œselectã€pollã€epollçš„åŒºåˆ«ï¼Ÿ</h2><p><a href="https://zhuanlan.zhihu.com/p/272891398?utm_source=wechat_timeline">https://zhuanlan.zhihu.com/p/272891398?utm_source=wechat_timeline</a></p><h2 id="3-è¿›ç¨‹é—´å¦‚ä½•é€šä¿¡çš„ï¼Ÿ"><a href="#3-è¿›ç¨‹é—´å¦‚ä½•é€šä¿¡çš„ï¼Ÿ" class="headerlink" title="3.è¿›ç¨‹é—´å¦‚ä½•é€šä¿¡çš„ï¼Ÿ"></a>3.è¿›ç¨‹é—´å¦‚ä½•é€šä¿¡çš„ï¼Ÿ</h2><ul><li>ç®¡é“</li><li>æœ‰åç®¡é“</li><li>æ¶ˆæ¯é˜Ÿåˆ—</li><li>ä¿¡å·</li><li>ä¿¡å·é‡</li><li>å…±äº«å†…å­˜</li><li>å¥—æ¥å­—socket</li></ul><h2 id="4-ä½ äº†è§£è®¾è®¡æ¨¡å¼ä¹ˆï¼Ÿå•ä¾‹æ¨¡å¼æœ‰å“ªä¸¤ç§å®ç°ï¼Ÿå“ªä¸€ç§æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"><a href="#4-ä½ äº†è§£è®¾è®¡æ¨¡å¼ä¹ˆï¼Ÿå•ä¾‹æ¨¡å¼æœ‰å“ªä¸¤ç§å®ç°ï¼Ÿå“ªä¸€ç§æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ" class="headerlink" title="4.ä½ äº†è§£è®¾è®¡æ¨¡å¼ä¹ˆï¼Ÿå•ä¾‹æ¨¡å¼æœ‰å“ªä¸¤ç§å®ç°ï¼Ÿå“ªä¸€ç§æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"></a>4.ä½ äº†è§£è®¾è®¡æ¨¡å¼ä¹ˆï¼Ÿå•ä¾‹æ¨¡å¼æœ‰å“ªä¸¤ç§å®ç°ï¼Ÿå“ªä¸€ç§æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</h2><p><font color="FF0000">é¥¿æ±‰æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‡’æ±‰æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„æ‰€ä»¥éœ€è¦åŒé‡æ£€æŸ¥ã€‚åŒé‡æ£€æŸ¥ä¿è¯äº†æ‡’æ±‰çš„çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½ä¼šæœ‰æ‰€æŸè€—ã€‚</font></p><h2 id="5-ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5.ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>5.ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>æ’å¥½åºçš„æ•°æ®ç»“æ„ï¼ˆInnoDBæ˜¯B+Treeï¼‰</p><h2 id="6-å¯¹äºäº‹åŠ¡çš„äº†è§£ï¼Ÿæ€ä¹ˆå®ç°çš„-ï¼Ÿï¼ˆå›ç­”äº†äº‹åŠ¡çš„ç‰¹æ€§ï¼Œå®ç°åŸç†ï¼‰"><a href="#6-å¯¹äºäº‹åŠ¡çš„äº†è§£ï¼Ÿæ€ä¹ˆå®ç°çš„-ï¼Ÿï¼ˆå›ç­”äº†äº‹åŠ¡çš„ç‰¹æ€§ï¼Œå®ç°åŸç†ï¼‰" class="headerlink" title="6.å¯¹äºäº‹åŠ¡çš„äº†è§£ï¼Ÿæ€ä¹ˆå®ç°çš„ ï¼Ÿï¼ˆå›ç­”äº†äº‹åŠ¡çš„ç‰¹æ€§ï¼Œå®ç°åŸç†ï¼‰"></a>6.å¯¹äºäº‹åŠ¡çš„äº†è§£ï¼Ÿæ€ä¹ˆå®ç°çš„ ï¼Ÿï¼ˆå›ç­”äº†äº‹åŠ¡çš„ç‰¹æ€§ï¼Œå®ç°åŸç†ï¼‰</h2><p>ACIDï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95_tx_2.png"></p><h2 id="7-MySQLæœ‰ç¼“å­˜ä¹ˆï¼Ÿ"><a href="#7-MySQLæœ‰ç¼“å­˜ä¹ˆï¼Ÿ" class="headerlink" title="7.MySQLæœ‰ç¼“å­˜ä¹ˆï¼Ÿ"></a>7.MySQLæœ‰ç¼“å­˜ä¹ˆï¼Ÿ</h2><p>ï¼ˆä¸ªäººçœ‹æ³•ï¼šå…¶å®æ•°æ®åº“æŸ¥è¯¢ç¼“å­˜ä¸€èˆ¬éƒ½ç”¨redisï¼Œmysql8.0åéƒ½è¢«ç§»é™¤äº†ï¼Œå†åŠ ä¸Šæˆ‘çœ‹javaguideè¯´mysqlç¼“å†²ä¸å¤ªå®ç”¨ï¼Œæˆ‘å°±æ²¡ä»”ç»†çœ‹ï¼Œæˆ‘å›ç­”çš„è¯´è¿™ä¸ªä¸æ˜¯ä¸å¸¸ç”¨ä¹ˆï¼Œå›æƒ³èµ·æ¥æ„Ÿè§‰æœ‰ç‚¹å°´å°¬ã€‚ï¼‰</p><p>è¯¦ç»†è§£æè§ï¼š<a href="https://blog.csdn.net/weixin_34275734/article/details/89624537">https://blog.csdn.net/weixin_34275734/article/details/89624537</a></p><h2 id="8-ç¼“å­˜ç½®æ¢ç®—æ³•æœ‰å“ªäº›ï¼ˆé—®çš„mysqlï¼Œç”±äºä¸çŸ¥é“å°±å›ç­”osçš„é¡µé¢ç½®æ¢ç®—æ³•ï¼‰ï¼Ÿ"><a href="#8-ç¼“å­˜ç½®æ¢ç®—æ³•æœ‰å“ªäº›ï¼ˆé—®çš„mysqlï¼Œç”±äºä¸çŸ¥é“å°±å›ç­”osçš„é¡µé¢ç½®æ¢ç®—æ³•ï¼‰ï¼Ÿ" class="headerlink" title="8.ç¼“å­˜ç½®æ¢ç®—æ³•æœ‰å“ªäº›ï¼ˆé—®çš„mysqlï¼Œç”±äºä¸çŸ¥é“å°±å›ç­”osçš„é¡µé¢ç½®æ¢ç®—æ³•ï¼‰ï¼Ÿ"></a>8.ç¼“å­˜ç½®æ¢ç®—æ³•æœ‰å“ªäº›ï¼ˆé—®çš„mysqlï¼Œç”±äºä¸çŸ¥é“å°±å›ç­”osçš„é¡µé¢ç½®æ¢ç®—æ³•ï¼‰ï¼Ÿ</h2><p>æŸ¥è¯äº†ä»¥ä¸‹å¥½åƒæ˜¯ä¸€æ ·çš„FIFOï¼ŒLRUï¼ŒLFU</p><h2 id="9-B-Treeã€çº¢é»‘æ ‘ã€hashè¡¨çš„ä½¿ç”¨åœºæ™¯åŒºåˆ«-ï¼Ÿ"><a href="#9-B-Treeã€çº¢é»‘æ ‘ã€hashè¡¨çš„ä½¿ç”¨åœºæ™¯åŒºåˆ«-ï¼Ÿ" class="headerlink" title="9.B+Treeã€çº¢é»‘æ ‘ã€hashè¡¨çš„ä½¿ç”¨åœºæ™¯åŒºåˆ« ï¼Ÿ"></a>9.B+Treeã€çº¢é»‘æ ‘ã€hashè¡¨çš„ä½¿ç”¨åœºæ™¯åŒºåˆ« ï¼Ÿ</h2><p>B+Treeå’Œçº¢é»‘æ ‘çš„å¯¹æ¯”ï¼š</p><ol><li><a href="https://blog.csdn.net/zcf9916/article/details/84915506">https://blog.csdn.net/zcf9916/article/details/84915506</a></li><li><a href="https://blog.csdn.net/ljfirst/article/details/112506408">https://blog.csdn.net/ljfirst/article/details/112506408</a></li></ol><p>hashè¡¨ï¼š</p><p>åŒºé—´æŸ¥æ‰¾å¯è¡Œæ€§ä¸º0</p><p>å¦‚æœæ•°æ®é‡éå¸¸åºå¤§ï¼Œé“¾è¡¨è¿‡é•¿ä¾ç„¶å¯¼è‡´æŸ¥æ‰¾æ•ˆç‡è¿‡ä½ï¼Œä¸”IOæ•ˆç‡ä½ä¸‹</p><h2 id="10-æœ‰å“ªäº›æ’åºç®—æ³•ï¼Œå¤æ‚åº¦æ€ä¹ˆæ ·ï¼Ÿï¼ˆåŸç†å’Œæ—¶é—´å¤æ‚åº¦ï¼‰"><a href="#10-æœ‰å“ªäº›æ’åºç®—æ³•ï¼Œå¤æ‚åº¦æ€ä¹ˆæ ·ï¼Ÿï¼ˆåŸç†å’Œæ—¶é—´å¤æ‚åº¦ï¼‰" class="headerlink" title="10.æœ‰å“ªäº›æ’åºç®—æ³•ï¼Œå¤æ‚åº¦æ€ä¹ˆæ ·ï¼Ÿï¼ˆåŸç†å’Œæ—¶é—´å¤æ‚åº¦ï¼‰"></a>10.æœ‰å“ªäº›æ’åºç®—æ³•ï¼Œå¤æ‚åº¦æ€ä¹ˆæ ·ï¼Ÿï¼ˆåŸç†å’Œæ—¶é—´å¤æ‚åº¦ï¼‰</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95_tx_3.png"></p><h2 id="11-ä½ å¦‚æœå­¦ä¹ C-å¤§æ¦‚éœ€è¦å¤šå°‘æ—¶é—´ï¼Ÿ"><a href="#11-ä½ å¦‚æœå­¦ä¹ C-å¤§æ¦‚éœ€è¦å¤šå°‘æ—¶é—´ï¼Ÿ" class="headerlink" title="11.ä½ å¦‚æœå­¦ä¹ C++å¤§æ¦‚éœ€è¦å¤šå°‘æ—¶é—´ï¼Ÿ"></a>11.ä½ å¦‚æœå­¦ä¹ C++å¤§æ¦‚éœ€è¦å¤šå°‘æ—¶é—´ï¼Ÿ</h2><p>é¢..</p><h2 id="æœ€åä¸€ä¸ªç¯èŠ‚ï¼šå¯¹é¢è¯•å®˜æé—®"><a href="#æœ€åä¸€ä¸ªç¯èŠ‚ï¼šå¯¹é¢è¯•å®˜æé—®" class="headerlink" title="æœ€åä¸€ä¸ªç¯èŠ‚ï¼šå¯¹é¢è¯•å®˜æé—®"></a>æœ€åä¸€ä¸ªç¯èŠ‚ï¼šå¯¹é¢è¯•å®˜æé—®</h2><p>ä½ ä»¬éƒ¨é—¨æœ‰Javaå¼€å‘çš„å²—ä½ä¹ˆ</p><p>å›ç­”ï¼šæ²¡æœ‰ï¼Œå…¨éƒ¨éƒ½æ˜¯C++å¼€å‘</p>]]></content>
    
    
    <categories>
      
      <category>Interview</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Interview</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œæ€»ç»“</title>
    <link href="/2021/03/23/%E8%AE%A1%E7%BD%91/"/>
    <url>/2021/03/23/%E8%AE%A1%E7%BD%91/</url>
    
    <content type="html"><![CDATA[<h1 id="è®¡ç®—æœºç½‘ç»œæ€»ç»“"><a href="#è®¡ç®—æœºç½‘ç»œæ€»ç»“" class="headerlink" title="è®¡ç®—æœºç½‘ç»œæ€»ç»“"></a>è®¡ç®—æœºç½‘ç»œæ€»ç»“</h1><p>æœ¬å¤ä¹ æ€»ç»“å®Œå…¨å‚è€ƒæ•™ç ”å®¤å¸ˆå§ï¼ˆæ©˜å­å§ï¼‰çš„ç¬”è®°å’ŒJavaGuideæ€»ç»“<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://app.yinxiang.com/fx/4ed295dd-ff19-4200-b401-47bdd265d0f8">[1]</span></a></sup><sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="JavaGuideé¢è¯•çªè¢­v4.0ï¼Œè®¡ç®—æœºç½‘ç»œ">[2]</span></a></sup>ä»¥åŠå°‘é‡çš„è¡¥å……</p><h2 id="1-OSIä¸TCP-IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½-éƒ½æœ‰å“ªäº›åè®®"><a href="#1-OSIä¸TCP-IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½-éƒ½æœ‰å“ªäº›åè®®" class="headerlink" title="1. OSIä¸TCP/IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½,éƒ½æœ‰å“ªäº›åè®®?"></a>1. OSIä¸TCP/IPå„å±‚çš„ç»“æ„ä¸åŠŸèƒ½,éƒ½æœ‰å“ªäº›åè®®?</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_1_network.png"></p><h3 id="1-1-åº”ç”¨å±‚"><a href="#1-1-åº”ç”¨å±‚" class="headerlink" title="1.1 åº”ç”¨å±‚"></a>1.1 åº”ç”¨å±‚</h3><h4 id="1-1-1-åº”ç”¨å±‚"><a href="#1-1-1-åº”ç”¨å±‚" class="headerlink" title="1.1.1 åº”ç”¨å±‚"></a>1.1.1 åº”ç”¨å±‚</h4><blockquote><p><strong>åº”ç”¨å±‚</strong>ï¼šç›´æ¥ä¸ºç”¨æˆ·çš„åº”ç”¨è¿›ç¨‹æä¾›ç½‘ç»œæœåŠ¡ã€‚</p></blockquote><p><strong>åº”ç”¨å±‚åè®®</strong>ï¼š å¯¹äºä¸åŒçš„ç½‘ç»œåº”ç”¨éœ€è¦ä¸åŒçš„åº”ç”¨å±‚åè®®ã€‚é€šä¿—çš„æ¥è®²å°±æ˜¯åº”ç”¨å±‚ä¼šå€ŸåŠ©TCPã€UDPåè®®åœ¨å„ç§å„æ ·çš„ç¨‹åºä¹‹é—´ä¼ é€’æ•°æ®ï¼ˆé‚®ä»¶ã€æ–‡ä»¶ç­‰ç­‰ï¼‰è¿™æ—¶å€™åƒåº”ç”¨å±‚åè®®å°±å¯ä»¥è§„å®šè¿™äº›æ•°æ®çš„æ ¼å¼è¦æ»¡è¶³ä»€ä¹ˆå½¢å¼ã€‚</p><p>åœ¨äº’è”ç½‘ä¸­åº”ç”¨å±‚åè®®å¾ˆå¤šï¼Œå¦‚</p><ul><li>åŸŸåç³»ç»Ÿ<strong>DNS</strong></li></ul><blockquote><p>åŸŸåç³»ç»ŸDNSï¼š</p><p>æ˜¯å› ç‰¹ç½‘çš„ä¸€é¡¹æ ¸å¿ƒæœåŠ¡ï¼Œä»–ä½œä¸ºå¯ä»¥å°†åŸŸåå’ŒIPåœ°å€ç›¸äº’æ˜ å°„çš„ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œèƒ½å¤Ÿä½¿äººæ›´æ–¹ä¾¿çš„è®¿é—®äº’è”ç½‘ï¼Œä¸ç”¨å»è®°ä½èƒ½å¤ŸèƒŒæå…¶ç›´æ¥è¯»å–çš„IPæ•°ä¸²ã€‚</p></blockquote><ul><li>æ”¯æŒä¸‡ç»´ç½‘åº”ç”¨çš„ <strong>HTTP</strong>åè®®</li></ul><blockquote><p>HTTPåè®®: </p><p>è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼ŒHyperText Transfer Protocol)æ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚æ‰€æœ‰çš„ WWWï¼ˆä¸‡ç»´ç½‘ï¼‰ æ–‡ä»¶éƒ½å¿…é¡»éµå®ˆè¿™ä¸ªæ ‡å‡†ã€‚è®¾è®¡ HTTP æœ€åˆçš„ç›®çš„æ˜¯ä¸ºäº†æä¾›ä¸€ç§å‘å¸ƒå’Œæ¥æ”¶ HTML é¡µé¢çš„æ–¹æ³•ã€‚</p></blockquote><ul><li>æ”¯æŒç”µå­é‚®ä»¶çš„ <strong>SMTP</strong>åè®®</li><li>æ–‡ä»¶ä¼ è¾“ <strong>FTP</strong>ç­‰ç­‰</li></ul><p>æˆ‘ä»¬æŠŠåº”ç”¨å±‚äº¤äº’çš„æ•°æ®å•å…ƒç§°ä¸ºæŠ¥æ–‡ã€‚</p><h4 id="1-1-2-è¡¨ç¤ºå±‚"><a href="#1-1-2-è¡¨ç¤ºå±‚" class="headerlink" title="1.1.2 è¡¨ç¤ºå±‚"></a>1.1.2 è¡¨ç¤ºå±‚</h4><blockquote><p><strong>è¡¨ç¤ºå±‚</strong>ï¼šåœ¨æ»¡è¶³ç”¨æˆ·éœ€æ±‚çš„åŸºç¡€ä¸Šï¼Œå°½å¯èƒ½çš„èŠ‚çœä¼ è¾“è´¹ç”¨è€Œè®¾ç½®çš„ï¼Œè¡¨ç¤ºå±‚å¯¹ä¸Šå±‚æ•°æ®æˆ–ä¿¡æ¯è¿›è¡Œå˜æ¢ä»¥ä¿è¯ä¸€ä¸ªä¸»æœºåº”ç”¨å±‚ä¿¡æ¯å¯ä»¥è¢«å¦ä¸€ä¸ªä¸»æœºçš„åº”ç”¨ç¨‹åºç†è§£ã€‚</p></blockquote><p>è¡¨ç¤ºå±‚çš„<strong>æ•°æ®è½¬æ¢</strong>åŒ…æ‹¬:</p><ul><li><p>æ•°æ®åŠ å¯†</p></li><li><p>æ•°æ®å‹ç¼©</p></li><li><p>æ•°æ®æ ¼å¼è½¬æ¢ç­‰ã€‚</p></li></ul><p>æ¯”å¦‚ä¼ è¾“å‹ç¼©æ–‡ä»¶ï¼Œjpegæˆ–è€…åŠ å¯†æ–‡ä»¶ç­‰æ ¼å¼ã€‚</p><h4 id="1-1-3-ä¼šè¯å±‚"><a href="#1-1-3-ä¼šè¯å±‚" class="headerlink" title="1.1.3 ä¼šè¯å±‚"></a>1.1.3 ä¼šè¯å±‚</h4><blockquote><p>ä¼šè¯å±‚ï¼š<strong>ç®¡ç†</strong>ä¸»æœºä¹‹é—´çš„<strong>ä¼šè¯è¿›ç¨‹</strong>ï¼Œå³è´Ÿè´£å»ºç«‹ã€ç®¡ç†ã€ç»ˆæ­¢è¿›ç¨‹ä¹‹é—´çš„ä¼šè¯ã€‚</p></blockquote><h3 id="1-2-è¿è¾“å±‚"><a href="#1-2-è¿è¾“å±‚" class="headerlink" title="1.2 è¿è¾“å±‚"></a>1.2 è¿è¾“å±‚</h3><blockquote><p><strong>è¿è¾“å±‚</strong>ï¼šä¸ºåº”ç”¨è¿›ç¨‹ä¹‹é—´æä¾›ç«¯åˆ°ç«¯çš„é€»è¾‘é€šè®¯ã€‚</p></blockquote><h4 id="1-2-1-è¿è¾“å±‚åè®®â­"><a href="#1-2-1-è¿è¾“å±‚åè®®â­" class="headerlink" title="1.2.1 è¿è¾“å±‚åè®®â­"></a>1.2.1 è¿è¾“å±‚åè®®â­</h4><p><font color="FF0000"><strong>è¿è¾“å±‚åè®®</strong></font>:  IPåè®®æ˜¯<strong>ä¸»æœºä¹‹é—´</strong>çš„é€šä¿¡ï¼ŒTCPå’ŒUDPæ˜¯è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚</p><ul><li><p>ä¼ è¾“æ§åˆ¶åè®® <strong>TCP</strong>ï¼ˆTransmission Control Protocolï¼‰</p><p>æä¾›é¢å‘è¿æ¥çš„ï¼Œå¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡</p><ul><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¦ä¿æŒä¸€ä¸ªä¼šè¯ç›´åˆ°ä¼ è¾“ç»“æŸ</li><li>åˆ†æ®µä¼ è¾“å»ºç«‹ä¼šè¯å¯é ä¼ è¾“æµé‡æ§åˆ¶ï¼ˆå‘é€çª—å£å¤§å°æ ¹æ®æ¥æ”¶çª—å£å¤§å°ç¡®å®šï¼‰</li><li>æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ï¼Œå…¨åŒå·¥</li><li>æ¯ä¸€æ¡TCPè¿æ¥æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼ˆå¥—æ¥å­—ï¼šIP+ç«¯å£å·ï¼‰</li></ul></li><li><p>ç”¨æˆ·æ•°æ®åè®® <strong>UDP</strong>ï¼ˆUser Datagram Protocolï¼‰</p><p>æä¾›æ— è¿æ¥çš„ï¼Œå°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡</p><ul><li>ä¸ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§</li><li>ä¸åˆ†æ®µ</li><li> æ”¯æŒä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€é€šä¿¡</li></ul></li><li><p>TCPå’ŒUDPå¯¹æ¯”<a href="3.TCP/UDP åè®®çš„åŒºåˆ«â­">è§é—®é¢˜ä¸‰</a></p></li></ul><h4 id="1-2-2-æœ¬å±‚åŠ ç«¯å£å·"><a href="#1-2-2-æœ¬å±‚åŠ ç«¯å£å·" class="headerlink" title="1.2.2 æœ¬å±‚åŠ ç«¯å£å·"></a>1.2.2 æœ¬å±‚åŠ ç«¯å£å·</h4><p>å¸¸è§ç«¯å£ï¼š</p><ul><li><p>FTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰ï¼š20ï¼Œ21â€”â€”å…¶ä¸­20ç«¯å£ç”¨äºä¼ è¾“æ•°æ®ï¼Œ21ç«¯å£ç”¨äºå‘½ä»¤æ§åˆ¶ï¼›</p></li><li><p>Telnetï¼ˆè¿œç¨‹ç™»å½•åè®®ï¼‰ï¼š23ï¼›</p></li><li><p>DNSï¼ˆåŸŸåè§£ææœåŠ¡ï¼‰ï¼š53ï¼›</p></li><li><p>TFTPï¼ˆç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼‰ï¼š69ï¼›</p></li><li><p>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰ï¼š80</p></li></ul><h4 id="1-2-3-ä¼ è¾“å±‚è¿›è¡Œå·®é”™æ£€æµ‹"><a href="#1-2-3-ä¼ è¾“å±‚è¿›è¡Œå·®é”™æ£€æµ‹" class="headerlink" title="1.2.3 ä¼ è¾“å±‚è¿›è¡Œå·®é”™æ£€æµ‹"></a>1.2.3 ä¼ è¾“å±‚è¿›è¡Œå·®é”™æ£€æµ‹</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_2_network.png"></p><h3 id="1-3-ç½‘ç»œå±‚"><a href="#1-3-ç½‘ç»œå±‚" class="headerlink" title="1.3 ç½‘ç»œå±‚"></a>1.3 ç½‘ç»œå±‚</h3><blockquote><p><strong>ç½‘ç»œå±‚</strong>ï¼ˆç½‘é™…å±‚/IPå±‚ï¼‰ï¼šåœ¨è®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œé€šä¿¡çš„ä¸¤ä¸ªè®¡ç®—æœºä¹‹é—´å¯èƒ½ä¼šç»è¿‡å¾ˆå¤šä¸ªæ•°æ®é“¾è·¯ï¼Œä¹Ÿå¯èƒ½è¿˜è¦ç»è¿‡å¾ˆå¤šé€šä¿¡å­ç½‘ã€‚ç½‘ç»œå±‚çš„ä»»åŠ¡å°±æ˜¯é€‰æ‹©åˆé€‚çš„ç½‘é—´è·¯ç”±å’Œäº¤æ¢ç»“ç‚¹ï¼Œ ç¡®ä¿æ•°æ®åŠæ—¶ä¼ é€ã€‚(<strong>è·¯å¾„é€‰æ‹©ã€è·¯ç”±åŠé€»è¾‘å¯»å€</strong>)</p></blockquote><ul><li><p><strong>åè®®</strong>ï¼šARP IP ICMP IGMP(ARPä¸ºIPæä¾›æœåŠ¡ï¼ŒIPä¸ºICMPå’ŒIGMPæä¾›æœåŠ¡ï¼‰</p><ul><li>ç”±äºç½‘ç»œå±‚ä½¿ç”¨ <font color="FF0000"><strong>IP åè®®</strong></font>ï¼Œå› æ­¤åˆ†ç»„ä¹Ÿå« IP æ•°æ®æŠ¥ ï¼Œç®€ç§°<strong>æ•°æ®æŠ¥</strong></li><li>æ— è®ºæ˜¯å“ªä¸€å±‚çš„æ•°æ®å•å…ƒéƒ½å¯ä»¥ç¬¼ç»Ÿçš„ç”¨â€åˆ†ç»„â€œè¡¨ç¤ºï¼Œä¸»è¦ä¸è¦æ··æ·†â€ç”¨æˆ·æ•°æ®åŒ…UDPâ€œå’Œç½‘ç»œå±‚çš„â€IPæ•°æ®æŠ¥â€œ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_3_network.png"></p></li><li><p><strong>ç‰¹ç‚¹</strong>ï¼šç½‘ç»œå±‚ä¸ç®¡å‘çš„é¡ºåºä¹Ÿä¸ç®¡ä¸¢æ•°æ®ä¸ï¼ˆå¯¹æ–¹ä¼ è¾“å±‚è´Ÿè´£ï¼‰ï¼Œæ ¹æ®ç›®æ ‡åœ°å€é€‰æ‹©åˆé€‚è·¯å¾„è½¬å‘ã€‚</p></li><li><p><strong>æœ¬å±‚åŠ æºIPåœ°å€ä¸ç›®æ ‡IPåœ°å€ï¼Œæ„æˆIPæ•°æ®æŠ¥ã€‚</strong> <strong>IPåè®®éå¸¸ç®€å•ï¼Œä»…ä»…æä¾›ä¸å¯é ã€æ— è¿æ¥çš„ä¼ é€æœåŠ¡</strong>ã€‚ IPåè®®åˆ¶å®šäº†ä¸€å¥—ç½‘ç»œåœ°å€ï¼Œä¹Ÿå°±æ˜¯IPåœ°å€ï¼Œæ ¹æ®IPåè®®èƒ½å¤ŸåŒºåˆ†ä¸¤å°ä¸»æœºæ˜¯å¦åŒå±ä¸€ä¸ªç½‘ç»œï¼ˆå­ç½‘ï¼‰ã€‚</p></li><li><p><font color="FF0000"><strong>è·¯ç”±å™¨å·¥ä½œåœ¨ç½‘ç»œå±‚</strong></font>ï¼Œåœ¨ä¸åŒç½‘æ®µè½¬å‘æ•°æ®ã€‚</p></li></ul><h3 id="1-4-æ•°æ®é“¾è·¯å±‚"><a href="#1-4-æ•°æ®é“¾è·¯å±‚" class="headerlink" title="1.4 æ•°æ®é“¾è·¯å±‚"></a>1.4 æ•°æ®é“¾è·¯å±‚</h3><blockquote><p>æ•°æ®é“¾è·¯å±‚ï¼šæ•°æ®ä¼ è¾“ï¼Œæ€»æ˜¯åœ¨ä¸€æ®µä¸€æ®µçš„é“¾è·¯ä¸Šä¼ é€çš„ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨ä¸“é—¨çš„é“¾è·¯å±‚çš„åè®®ã€‚ </p></blockquote><ul><li><p>åœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æ—¶ï¼Œæ•°æ®é“¾è·¯å±‚å°†ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„ <strong>IP æ•°æ®æŠ¥ç»„è£…æˆå¸§</strong>ï¼Œè¿›è¡Œä¼ é€ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼ˆåŒæ­¥ä¿¡æ¯ï¼Œåœ°å€ä¿¡æ¯ï¼Œå·®é”™æ§åˆ¶ç­‰ï¼‰ã€‚</p></li><li><p>åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œæ§åˆ¶ä¿¡æ¯ä½¿æ¥æ”¶ç«¯èƒ½å¤ŸçŸ¥é“ä¸€ä¸ªå¸§ä»å“ªä¸ªæ¯”ç‰¹å¼€å§‹å’Œåˆ°å“ªä¸ªæ¯”ç‰¹ç»“æŸã€‚è¿™æ ·ï¼Œæ•°æ®é“¾è·¯å±‚åœ¨æ”¶åˆ°ä¸€ä¸ªå¸§åï¼Œå°±å¯ä»ä¸­æå‡ºæ•°æ®éƒ¨åˆ†ï¼Œä¸Šäº¤ç»™ç½‘ç»œå±‚ã€‚ </p></li><li><p>å°è£…æˆå¸§ï¼ˆå¸§å¤´ã€å¸§å°¾ã€ç‰©ç†åœ°å€ã€æ ¡éªŒå€¼ï¼‰ é€æ˜ä¼ è¾“ï¼ˆå­—èŠ‚å¡«å……æ³•ï¼Œä¼ è¾“æ•°æ®å‡ºç°æ§åˆ¶å­—ç¬¦å‰é¢æ’å…¥ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ï¼‰ å·®é”™æ ¡éªŒï¼ˆå¾ªç¯å†—ä½™æ£€éªŒCRCï¼‰</p></li></ul><blockquote><p><strong>æ•°æ®é“¾è·¯å±‚åè®®</strong>(äº†è§£)ï¼š</p></blockquote><ul><li><p>PPPï¼ˆç‚¹åˆ°ç‚¹ä¿¡é“ï¼‰ ï¼ˆæ‹¨å·ç”µè¯çº¿æ¥å…¥å› ç‰¹ç½‘å°±æ˜¯PPPï¼‰</p></li><li><p>CSMA/CD(å¸¦å†²çªæ£€æµ‹çš„è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®åè®®ï¼‰ï¼ˆä½¿ç”¨å¹¿æ’­ä¿¡é“ï¼‰ï¼ˆå±€åŸŸç½‘ï¼‰  </p></li><li><p>å¤šè·¯è®¿é—®ï¼šå¤šä¸ªè®¾å¤‡å¯ä»¥åŒæ—¶è®¿é—®ä»‹è´¨ï¼ˆå¤šä¸ªè®¾å¤‡åœ¨åŒä¸€ä¿¡é“å‘é€ä¿¡å·åè®®ï¼‰ï¼Œä¸€ä¸ªè®¾å¤‡å‘é€çš„å¸§ä¹Ÿå¯ä»¥è¢«å¤šä¸ªè®¾å¤‡æ¥æ”¶ã€‚  </p></li><li><p>è½½æ³¢ç›‘å¬ï¼šæ¯ä¸€ä¸ªè®¾å¤‡å‘é€æ•°æ®å‰ï¼Œå¯¹ä¿¡é“ä¾¦å¬ï¼Œç©ºé—²æ‰å¯ä»¥å‘é€ï¼Œå¦‚æœæœ‰å…¶ä»–è®¾å¤‡æ­£åœ¨å‘æš‚æ—¶ä¸å‘é¿å…ç¢°æ’ã€‚</p></li><li><p>ç¢°æ’æ£€æµ‹ï¼šè®¾å¤‡è¾¹å‘æ•°æ®è¾¹æ£€æµ‹ä¿¡é“ä¸Šç”µå‹å¤§å°ï¼Œä¸€æ—¦å‡ºç°ç¢°æ’ï¼Œç«‹å³åœæ­¢å‘é€ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åå†å‘ã€‚ è¿™ä¸ªåè®®åªèƒ½<strong>åŠåŒå·¥</strong>é€šä¿¡ã€‚</p></li></ul><blockquote><p><strong>ä»¥å¤ªç½‘</strong>ï¼ˆ å…¨çƒä½¿ç”¨æœ€å¹¿æ³›çš„å±€åŸŸç½‘æŠ€æœ¯ï¼‰æ‹“æ‰‘ç»“æ„ä¸ºæ€»çº¿å‹</p></blockquote><p>ä»¥å¤ªç½‘çš„æ ‡å‡†<a href="https://baike.baidu.com/item/%E6%8B%93%E6%89%91">æ‹“æ‰‘</a>ç»“æ„ä¸º<a href="https://baike.baidu.com/item/%E6%80%BB%E7%BA%BF%E5%9E%8B%E6%8B%93%E6%89%91">æ€»çº¿å‹æ‹“æ‰‘</a>ï¼Œä½†ç›®å‰çš„å¿«é€Ÿä»¥å¤ªç½‘ä¸ºäº†å‡å°‘å†²çªï¼Œå°†èƒ½æé«˜çš„ç½‘ç»œé€Ÿåº¦å’Œä½¿ç”¨æ•ˆç‡æœ€å¤§åŒ–ï¼Œä½¿ç”¨äº¤æ¢æœºæ¥è¿›è¡Œç½‘ç»œè¿æ¥å’Œç»„ç»‡ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä»¥å¤ªç½‘çš„æ‹“æ‰‘ç»“æ„å°±æˆäº†<a href="https://baike.baidu.com/item/%E6%98%9F%E5%9E%8B">æ˜Ÿå‹</a>ï¼›ä½†åœ¨é€»è¾‘ä¸Šï¼Œä»¥å¤ªç½‘ä»ç„¶ä½¿ç”¨æ€»çº¿å‹æ‹“æ‰‘å’Œ<a href="https://baike.baidu.com/item/CSMA%2FCD">CSMA/CD</a>ï¼ˆCarrier Sense Multiple Access/Collision Detectionï¼Œå³è½½æ³¢å¤šé‡è®¿é—®/ç¢°æ’ä¾¦æµ‹ï¼‰çš„æ€»çº¿æŠ€æœ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_4_network.png"></p><blockquote><p>ç½‘æ¡¥äº¤æ¢æœºï¼šç½‘æ¡¥è®¾å¤‡ï¼ˆå¯ä»¥è¿æ¥é›†çº¿å™¨ï¼‰</p></blockquote><p>ç½‘æ¡¥æ—¢æœ‰è¿‡æ»¤å¸§çš„åŠŸèƒ½ã€‚å½“ç½‘æ¡¥æ”¶åˆ°ä¸€ä¸ªå¸§çš„æ—¶å€™ï¼Œå¹¶ä¸æ˜¯åƒæ‰€æœ‰æ¥å£å‘æ­¤å¸§ï¼Œè€Œæ˜¯å…ˆæ£€æŸ¥æ­¤å¸§çš„ç›®çš„MACåœ°å€ï¼Œç„¶åå†ç¡®å®šè¯¥å¸§è½¬å‘åˆ°å“ªä¸€ä¸ªæ¥å£ã€‚</p><ul><li><p>ç½‘æ¡¥å£è¶Šæ¥è¶Šå¤šäº†å°±å˜æˆäº†äº¤æ¢æœºï¼ˆç›´æ¥è¿è®¡ç®—æœºï¼‰</p></li><li><p>äº¤æ¢æœºå‰èº«ä¸ºç½‘æ¡¥</p></li><li><p>äº¤æ¢æœºå£å¯ä»¥å­˜å‚¨è½¬å‘ï¼ŒåŸºäºMACåœ°å€è½¬å‘ï¼Œé€šè¿‡å­¦ä¹ æ„å»ºMACåœ°å€è¡¨</p></li></ul><p><strong>æœ¬å±‚åŠ MACåœ°å€</strong></p><h3 id="1-5-ç‰©ç†å±‚"><a href="#1-5-ç‰©ç†å±‚" class="headerlink" title="1.5 ç‰©ç†å±‚"></a>1.5 ç‰©ç†å±‚</h3><blockquote><p>ç‰©ç†å±‚ï¼šå®ç°ä¸»æœºå’Œç½‘ç»œä¹‹é—´çš„ç‰©ç†è¿æ¥ï¼Œè§„å®šä¸€äº›ä¸ä¼ è¾“åª’ä½“æ¥å£æœ‰å…³çš„ä¸€äº›ç‰¹æ€§ã€‚</p></blockquote><ul><li><p>åœ¨ç‰©ç†å±‚ä¸Šä¼ é€æ¯”ç‰¹æµ</p></li><li><p>é¢‘åˆ†å¤ç”¨ï¼Œæ—¶åˆ†å¤ç”¨</p></li></ul><blockquote><p>é›†çº¿å™¨ï¼šå¤šæ¥å£è½¬å‘å™¨ï¼Œå·¥ä½œåœ¨ç‰©ç†å±‚</p></blockquote><h3 id="1-6-æ€»ç»“"><a href="#1-6-æ€»ç»“" class="headerlink" title="1.6 æ€»ç»“"></a>1.6 æ€»ç»“</h3><p>å‘é€ç«¯ï¼š</p><ul><li><p>åº”ç”¨ç¨‹åºå‡†å¤‡ä¼ è¾“çš„æ–‡ä»¶</p></li><li><p>ä¼ è¾“å±‚  å°†æ–‡ä»¶åˆ†æ®µ å¹¶ç¼–å·</p></li><li><p>ç½‘ç»œå±‚  æ·»åŠ ç›®æ ‡IPåœ°å€æºIPåœ°å€</p></li><li><p>æ•°æ®é“¾è·¯å±‚  ä¸¤ç§æƒ…å†µ</p><p>ä½¿ç”¨è‡ªå·±çš„å­ç½‘æ©ç  åˆ¤æ–­è‡ªå·±åœ¨é‚£ä¸ªç½‘æ®µ</p><p>ä½¿ç”¨è‡ªå·±çš„å­ç½‘æ©ç  åˆ¤æ–­ç›®æ ‡åœ°å€åœ¨å“ªä¸ªç½‘æ®µ</p><ul><li>å¦‚æœæ˜¯åŒä¸€ä¸ªç½‘æ®µ arpåè®®å¹¿æ’­è§£æç›®æ ‡IPåœ°å€çš„MAC</li><li>å¦‚æœä¸æ˜¯åŒä¸€ä¸ªç½‘æ®µ åˆ™macå†™ç½‘å…³åœ°å€</li></ul></li></ul><hr><p>ä¸€äº›å¸®åŠ©ç†è§£çš„è§£é‡Šï¼š</p><ul><li><p>ARPå‘é€çš„å¹¿æ’­åŒ…ï¼Œç›®æ ‡MACæ˜¯å…¨1ï¼ˆ48ä½ï¼‰ï¼Œäº¤æ¢æœºä¼šç»™æ‰€æœ‰å‡ºå£è½¬å‘ã€‚å¾—åˆ°MACåœ°å€åä¼šç¼“å­˜ï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¸å’Œç›®æ ‡åœ°å€é€šä¿¡äº†ï¼Œè¿™ä¸ªç¼“å­˜ä¼šåˆ é™¤æ‰ã€‚</p></li><li><p>äº¤æ¢æœºæ ¹æ®macåœ°å€è½¬å‘æ•°æ®</p></li><li><p>æ¯ä¸ªè®¡ç®—æœºé…æœ‰ç½‘å…³ï¼ˆçŸ¥é“è‡ªå·±æ‰€åœ¨å­ç½‘çš„è·¯ç”±ç½‘å£åœ°å€ï¼‰</p></li><li><p>ç‚¹åˆ°ç‚¹ä¿¡é“ï¼Œç‰©ç†å±‚åœ°å€å›ºå®šä¸ºFFï¼ˆå› ä¸ºåªèƒ½è¿™ä¸ªä¼ ç»™å¯¹æ–¹ï¼Œä¸ç”¨çœ‹åœ°å€ï¼‰</p></li><li><p>IPåœ°å€å†³å®šäº†æ•°æ®çš„èµ·ç‚¹ä¸ç»ˆç‚¹ï¼ŒMACåœ°å€å†³å®šäº†æœ¬ç‚¹å’Œä¸‹ä¸€è·³ç»™è°</p></li><li><p>é›†çº¿å™¨ï¼š</p><p>åªè´Ÿè´£æŠŠæ¯”ç‰¹æµä¼ å‡ºå»ï¼Œå¹¶å¯¹ä¿¡å·è¿›è¡ŒåŠ å¼ºï¼Œå±äºç‰©ç†å±‚è®¾å¤‡ï¼ˆä¸ç½‘çº¿å·®ä¸å¤šï¼Œåªè®¤æ¯”ç‰¹æµï¼‰</p></li><li><p>äº¤æ¢æœºï¼ˆä¸€ä¸ªç½‘æ®µå†…è½¬ç»™å…¶ä»–è®¡ç®—æœºè¿˜æ˜¯è·¯ç”±å™¨ï¼‰ï¼š</p><p>æ”¶å®Œæ¯”ç‰¹æµï¼Œå­˜å‚¨ï¼Œçœ‹ç›®æ ‡macåœ°å€ï¼Œé€‰æ‹©å‡ºå£ï¼Œå·¥ä½œåœ¨ç¬¬äºŒå±‚æ•°æ®é“¾è·¯å±‚è®¾å¤‡ï¼Œå­˜å‚¨è½¬å‘ï¼ˆåªèƒ½çœ‹æ‡‚macåœ°å€çœ‹ä¸æ‡‚IPåœ°å€ï¼‰</p></li><li><p>è·¯ç”±å™¨ï¼š</p><p>æœ‰ç½‘å¡ï¼ˆæ¥å£ï¼‰æ¥æ”¶æ¯”ç‰¹æµï¼Œå¯ä»¥çœ‹æ‡‚macï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯ç»™è‡ªå·±ï¼Œç„¶åä¼šæŠŠmacåœ°å€å»æ‰ï¼Œå‰©ä¸‹IPæ•°æ®æŠ¥ï¼Œæ ¹æ®æ•°æ®æŠ¥çš„ç›®æ ‡åœ°å€æŒ‰ç…§è·¯ç”±è¡¨é€‰æ‹©å‡ºå£ï¼ˆè·¯ç”±å™¨çœ‹ä¸æ‡‚å…·ä½“ä¼ çš„æ•°æ®ï¼‰ï¼Œå‡ºå£å†™ä¸Šæ–°çš„MACåœ°å€ï¼Œä¸ºä¸‰å±‚è®¾å¤‡ç½‘ç»œè®¾å¤‡</p><p>è·¯ç”±å™¨â€“ç½‘å…³â€“äº¤æ¢æœºä¸‰å±‚ç»“æ„ï¼š</p><p>çŸ¥é“IPåœ°å€ï¼Œæƒ³çŸ¥é“å…·ä½“æ˜¯å“ªä¸ªç‰©ç†PCæœº</p><ul><li>é¦–å…ˆè¦é€šè¿‡IPåœ°å€çš„ç½‘æ®µæŸ¥æ‰¾åˆ°æ˜¯å“ªä¸ªç½‘å…³çš„</li><li>ç„¶ååœ¨ç½‘å…³ARPè¡¨ä¸­æŸ¥æ‰¾macåœ°å€å’Œäº¤æ¢æœºä½ç½®</li><li>ç„¶åé€šè¿‡MACè¡¨æŸ¥æ‰¾åˆ°ç‰©ç†PCæœºã€‚</li><li>å³IPåœ°å€-ç½‘å…³-MACåœ°å€-äº¤æ¢æœº-port-PCæœº</li></ul><blockquote><p><strong>macè¡¨</strong>ï¼šè®°å½•äº¤æ¢æœºæ¥å£ï¼ˆç«¯å£ï¼‰å’Œç»ˆç«¯MACçš„å¯¹åº”å…³ç³»ï¼Œå³è¯´æ˜äº¤æ¢æœºå“ªä¸ªç«¯å£å’Œç»ˆç«¯çš„å“ªä¸ªMACåœ°å€å¯¹åº”ï¼ŒæŒ‡çš„æ˜¯ç‰©ç†å±‚é¢çš„è¿æ¥å…³ç³»ï¼Œå­˜åœ¨äºäº¤æ¢æœºå½“ä¸­ã€‚</p><p><strong>ARPç¼“å­˜è¡¨</strong>ï¼šè®°å½•ä¸»æœºçš„IPåœ°å€å’ŒMACåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œå¯¹äºåŒä¸€å°PCæœºï¼ŒIPåœ°å€æ˜¯å¯å˜çš„ï¼Œä½†æ˜¯MACåœ°å€æ˜¯ç‰©ç†ç½‘å¡çš„åœ°å€ï¼Œæ˜¯ç½‘å¡ç‰¹æœ‰çš„ä¿¡æ¯ï¼Œæ˜¯ä¸å¯å˜çš„ã€‚è¿™ä¸ªç¼“å­˜è¡¨ä¸€èˆ¬ä¸å­˜åœ¨äº¤æ¢æœºé‡Œé¢ï¼Œè€Œæ˜¯åœ¨äº¤æ¢æœºä¸Šä¸€å±‚çš„ä»ªå™¨ä¸­ï¼Œå³ç½‘å…³ä¸­ã€‚è¿™ä¸ªè¡¨é‡Œé¢åªèƒ½çŸ¥é“IPåœ°å€å’ŒMACçš„å¯¹åº”å…³ç³»ï¼Œä»¥åŠåœ¨å“ªä¸ªäº¤æ¢æœºä¸Šè¿æ¥ç€ï¼Œå¹¶ä¸èƒ½çŸ¥é“åœ¨äº¤æ¢æœºçš„å“ªä¸ªç«¯å£ï¼Œéœ€è¦å’Œmacè¡¨ç›¸ç»“åˆæ‰èƒ½çŸ¥é“ã€‚</p><p><strong>è·¯ç”±è¡¨</strong>ï¼šè®°å½•è·¯ç”±å™¨æŒæ¡çš„æ‰€æœ‰ç›®çš„åœ°ç½‘æ®µï¼Œä»¥åŠåˆ°è¾¾è¿™äº›ç›®çš„çš„æœ€ä½³è·¯å¾„</p></blockquote></li><li><p>å·¥ä½œåœ¨å“ªä¸€å±‚æŒ‡çš„æœ€é«˜èƒ½çœ‹æ‡‚é‚£ä¸€å±‚çš„å†…å®¹</p></li><li><p>å¯¹æ–¹ç‰©ç†å±‚æ”¶åˆ°æ¯”ç‰¹æµåï¼Œæ•°æ®é“¾è·¯å±‚çœ‹ç›®æ ‡macåœ°å€æ˜¯ç»™è‡ªå·±çš„ï¼Œç„¶ååˆ°ç½‘ç»œå±‚å»æ‰macåœ°å€å‰©ä¸‹IPæ•°æ®æŠ¥ï¼Œç„¶åæ•°æ®æŠ¥æŠŠIPåœ°å€å»æ‰ï¼ˆIPåœ°å€ï¼‰ç»™ä¼ è¾“å±‚ï¼Œä¼ è¾“å±‚æ’åºæ£€æŸ¥ä¸¢åŒ…åç»™åº”ç”¨å±‚</p></li></ul><hr><p>ç—…æ¯’æ˜¯ä¸€ä¸ªä»£ç ï¼Œä¹Ÿä¼šåˆ†æ®µä¼ ï¼Œè·¯ç”±å™¨åªèƒ½çœ‹åˆ°æ¯ä¸€æ®µæ‰€ä»¥ä¸­ä¸äº†ç—…æ¯’ï¼Œäº¤æ¢æœºä»¥åŠé›†çº¿å™¨ä¹Ÿä¸ä¼š</p><h3 id="1-7-TCP-IPåè®®æœ‰äº†è§£å—ï¼Ÿ"><a href="#1-7-TCP-IPåè®®æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="1.7 TCP/IPåè®®æœ‰äº†è§£å—ï¼Ÿ"></a>1.7 TCP/IPåè®®æœ‰äº†è§£å—ï¼Ÿ</h3><p>TCP/IP åè®®ä¸æ˜¯TCP å’ŒIP è¿™ä¸¤ä¸ªåè®®çš„åˆç§°ï¼Œè€Œæ˜¯æŒ‡å› ç‰¹ç½‘æ•´ä¸ªTCP/IP åè®®æ—ï¼Œæ˜¯ä¸€ç³»åˆ—ç½‘ç»œåè®®çš„æ€»ç§°ã€‚</p><p>TCP/IPåè®®æ¨¡å‹åœ¨OSIä¸ƒå±‚æ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡åˆå¹¶çš„æ–¹å¼ï¼Œç®€åŒ–ä¸º<strong>å››å±‚</strong>ï¼Œåˆ†åˆ«ä¸º</p><ul><li><strong>åº”ç”¨å±‚</strong></li><li><strong>ä¼ è¾“å±‚</strong></li><li><strong>ç½‘ç»œå±‚</strong></li><li><strong>é“¾è·¯å±‚</strong></li></ul><h2 id="2-TCP-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹â­"><a href="#2-TCP-ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹â­" class="headerlink" title="2. TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹â­"></a>2. TCP ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹â­</h2><p>TCPåè®®æ˜¯ä¸€ç§å¯é çš„åè®®ï¼Œåœ¨æ­£å¼ä¼ è¾“æ•°æ®ä¹‹å‰å¿…é¡»é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥å¹¶ä¸”äº’ç›¸äº¤æ¢çª—å£å¤§å°ã€‚åœ¨ä¼ è¾“ç»“æŸä¹‹åï¼Œé€šè¿‡å››æ¬¡æŒ¥æ‰‹æ¥ç¡®è®¤åŒæ–¹éƒ½ç»“æŸæ•°æ®äº¤äº’ã€‚</p><h3 id="2-1-ä¸‰æ¬¡æ¡æ‰‹"><a href="#2-1-ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="2.1 ä¸‰æ¬¡æ¡æ‰‹"></a>2.1 ä¸‰æ¬¡æ¡æ‰‹</h3><ul><li><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šä¸»æœºA å‘é€synï¼1,éšæœºäº§ç”Ÿseq=x(å¦‚1234567) çš„æ•°æ®åŒ…åˆ°æœåŠ¡å™¨ï¼Œä¸»æœºBç”±SYN=1 çŸ¥é“ï¼ŒA è¦æ±‚å»ºç«‹è”æœºï¼›</p></li><li><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼š ä¸»æœºB æ”¶åˆ°è¯·æ±‚åè¦ç¡®è®¤è”æœºä¿¡æ¯ï¼Œ å‘A å‘é€ack=( ä¸»æœºA çš„seq+1),syn=1,ack=1,éšæœºäº§ç”Ÿseq=y(å¦‚7654321ï¼‰ çš„åŒ…</p></li><li><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šä¸»æœºA æ”¶åˆ°åæ£€æŸ¥ackæ˜¯å¦æ­£ç¡®ï¼Œå³ç¬¬ä¸€æ¬¡å‘é€çš„seq +1,ä»¥åŠä½ç ACKæ˜¯å¦ä¸º1ï¼Œè‹¥æ­£ç¡®ï¼Œä¸»æœºA ä¼šå†å‘é€ack =(ä¸»æœºB çš„seq+1),ACK=1ï¼Œä¸»æœºB æ”¶åˆ°åç¡®è®¤</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_5_network.png"></p><p><strong>åºåˆ—å·</strong>ï¼šTCPç¼“å­˜ä¸­å­—èŠ‚æµåˆ†æ•°æ®æ®µå‘ï¼Œåºå·æ˜¯è¿™ä¸ªæ•°æ®æ®µçš„ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯æ•´ä¸ªæ–‡ä»¶çš„ç¬¬å‡ ä¸ªå­—èŠ‚ï¼ˆ å¦‚æœä¼ è¾“çš„æ•°æ®å­—èŠ‚ä¸º0ï¼Œå³åªæœ‰é¦–éƒ¨ï¼Œé‚£åºåˆ—å·è¿˜å¢åŠ å—ï¼Ÿå½“syn æˆ– finè¢«ç½®1ï¼Œè™½ç„¶æŠ¥æ–‡é‡Œé•¿åº¦ä¸º0ï¼ˆåº”ç”¨å±‚çš„æ•°æ®å«æŠ¥æ–‡ï¼‰ï¼Œè®¡ç®—ackæ—¶æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå…¶é•¿åº¦ä¸º1ã€‚å…¶ä»–æƒ…å†µï¼ˆå¦‚åªæœ‰ackï¼‰ä¸å¢åŠ ï¼‰</p><p><strong>SYN åŒæ­¥åºåˆ—ç¼–å·</strong>(Synchronize Sequence Numbers) æ˜¯ TCP/IP å»ºç«‹è¿æ¥æ—¶ä½¿ç”¨çš„<strong>æ¡æ‰‹ä¿¡å·</strong>ã€‚</p><p><strong>ç¡®è®¤å·ack</strong>ï¼šæ ¹æ®æ”¶åˆ°çš„æ•°æ®åŒ…çš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œç»™ä¿¡å·è¯´ä¸‹ä¸€ä¸ªè¯¥å‘å“ªä¸ªå­—èŠ‚äº†ï¼Œè¿™ä¸ªç¡®è®¤å·å°±æ˜¯ä¸‹ä¸€ä¸ªè¯¥å‘å¾—å­—èŠ‚å·</p><p><strong>ACK</strong>ï¼š0ç¡®è®¤å·æ— æ•ˆï¼Œ1ç¡®è®¤å·æœ‰æ•ˆ</p><blockquote><p>çŠ¶æ€å˜åŒ–:</p><ul><li><p>å®¢æˆ·ç«¯: Close-&gt;SYN_SENT-&gt;ESTABLISHED</p></li><li><p>æœåŠ¡ç«¯: Close-&gt;Listen-&gt;SYN_RCVD-&gt;EATABLISHED</p></li></ul></blockquote><h3 id="2-2-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ"><a href="#2-2-ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ" class="headerlink" title="2.2 ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ"></a>2.2 ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ</h3><p>ä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯å»ºç«‹å¯é çš„é€šä¿¡ä¿¡é“ï¼Œä¸»è¦çš„ç›®çš„å°±æ˜¯åŒæ–¹ç¡®è®¤è‡ªå·±ä¸å¯¹æ–¹çš„å‘é€ä¸æ¥æ”¶æ˜¯æ­£å¸¸çš„ã€‚ <strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼š<font color="FF0000"><strong>è®©åŒæ–¹éƒ½è¯å®å¯¹æ–¹èƒ½å‘æ”¶</strong></font>ã€‚</p><ul><li><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šClient ä»€ä¹ˆéƒ½ä¸èƒ½ç¡®è®¤ï¼›Server ç¡®è®¤äº†å¯¹æ–¹å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸</p></li><li><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šClient ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Server ç¡®è®¤äº†ï¼šå¯¹æ–¹å‘é€æ­£å¸¸ï¼Œè‡ªå·±æ¥æ”¶æ­£å¸¸</p></li><li><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šClient ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼›Server ç¡®è®¤äº†ï¼šè‡ªå·±å‘é€ã€æ¥æ”¶æ­£å¸¸ï¼Œå¯¹æ–¹å‘é€ã€æ¥æ”¶æ­£å¸¸</p></li></ul><p>æ‰€ä»¥ä¸‰æ¬¡æ¡æ‰‹å°±èƒ½ç¡®è®¤åŒå‘æ”¶å‘åŠŸèƒ½éƒ½æ­£å¸¸ï¼Œç¼ºä¸€ä¸å¯ã€‚</p><h3 id="2-3-ä¸¤æ¬¡æ¡æ‰‹å¯ä»¥ä¹ˆï¼Ÿ"><a href="#2-3-ä¸¤æ¬¡æ¡æ‰‹å¯ä»¥ä¹ˆï¼Ÿ" class="headerlink" title="2.3 ä¸¤æ¬¡æ¡æ‰‹å¯ä»¥ä¹ˆï¼Ÿ"></a>2.3 ä¸¤æ¬¡æ¡æ‰‹å¯ä»¥ä¹ˆï¼Ÿ</h3><p>ä¸å¯ä»¥</p><blockquote><p>å‡å¦‚åªæœ‰å‰é¢ä¸¤æ¬¡æ¡æ‰‹ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åœ¨æ¥æ”¶åˆ°ç¬¬ä¸€æ¬¡æ¡æ‰‹ä¿¡å·ï¼Œå‘å‡ºç¬¬äºŒæ¬¡æ¡æ‰‹ä¿¡å·åå°±ä¼šå¼€å§‹å·¥ä½œã€‚</p></blockquote><ol><li>æœåŠ¡å™¨è§’åº¦ï¼šå¯èƒ½å®¢æˆ·ç«¯å‘é€çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹è¯·æ±‚ä¼ è¾“è¿‡ç¨‹ä¸­é˜»å¡ï¼Œå®¢æˆ·ç«¯ä¼šå†æ¬¡å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¿™ä¸ªæ—¶å€™æœåŠ¡å™¨å…ˆåæ¥æ”¶åˆ°ä¸¤æ¬¡è¯·æ±‚ï¼Œå¹¶æŒç»­ç­‰ä¸¤ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å‘é€æ•°æ®ï¼Œå…¶å®åªæœ‰ä¸€ä¸ªï¼ŒæœåŠ¡ç«¯å´æœ‰ä¸¤ä¸ªå“åº”ï¼Œæç«¯æƒ…å†µå¯èƒ½Nä¸ªï¼Œä¼šé€ æˆèµ„æºæµªè´¹ã€‚</li><li>å®¢æˆ·ç«¯è§’åº¦ï¼šå‡å¦‚å‘é€å»ºç«‹è¿æ¥çš„è¯·æ±‚é˜»å¡ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´å‘ç°æ²¡å›å¤ï¼Œç„¶åå†å‘ä¸€ä¸ªï¼ˆè¿™æ¬¡å¾ˆå¿«åˆ°è¾¾ï¼‰ï¼Œç„¶åç»™ç¡®è®¤ä¹Ÿå¾ˆå¿«ï¼Œ å°±å¼€å§‹å‘æ•°æ®ã€‚è¿‡äº†ä¸€ä¼šç¬¬ä¸€ä¸ªé˜»å¡çš„å»ºç«‹è¿æ¥çš„è¯·æ±‚ä¹Ÿåˆ°äº†ï¼Œå†ç»™ä¸€ä¸ªç¡®è®¤ç»™Aï¼Œç»“æœAä¸è®¤äº†ï¼Œåˆšå·²ç»æ”¶åˆ°ç¡®è®¤äº†ï¼Œå°±ä¸ç†äº†ï¼Œç„¶åBå°±å¾—ç­‰ç€ä¼ æ•°æ®ï¼ˆæ²¡æ”¶åˆ°æ•°æ®è¿‡ä¸€æ®µå°±é‡Šæ”¾äº†ï¼‰ï¼Œä¼šé€ æˆèµ„æºæµªè´¹ï¼Œæ‰€ä»¥éœ€è¦ç¬¬ä¸‰ä¸ªæ•°æ®åŒ…çš„ç¡®è®¤</li></ol><h3 id="2-4-ç¬¬2æ¬¡æ¡æ‰‹ä¼ å›äº†ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å›SYNï¼Ÿ"><a href="#2-4-ç¬¬2æ¬¡æ¡æ‰‹ä¼ å›äº†ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å›SYNï¼Ÿ" class="headerlink" title="2.4 ç¬¬2æ¬¡æ¡æ‰‹ä¼ å›äº†ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å›SYNï¼Ÿ"></a>2.4 ç¬¬2æ¬¡æ¡æ‰‹ä¼ å›äº†ACKï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä¼ å›SYNï¼Ÿ</h3><p>æ¥æ”¶ç«¯ä¼ å›å‘é€ç«¯æ‰€å‘é€çš„ACKæ˜¯ä¸ºäº†å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œæˆ‘æ¥æ”¶åˆ°çš„ä¿¡æ¯ç¡®å®å°±æ˜¯ä½ æ‰€å‘é€çš„ä¿¡å·äº†ï¼Œè¿™è¡¨æ˜ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„é€šä¿¡æ˜¯æ­£å¸¸çš„ã€‚</p><p>è€Œå›ä¼ SYNåˆ™æ˜¯ä¸ºäº†å»ºç«‹å¹¶ç¡®è®¤ä»æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯çš„é€šä¿¡ï¼Œè¿˜è¦å®¢æˆ·ç«¯ç¡®è®¤æˆ‘çš„å‘é€æ˜¯å¦æ­£å¸¸ï¼ˆSYN=1äº†ackæ‰ä¸ºseq+1ï¼‰ã€‚</p><h3 id="2-5-å››æ¬¡æŒ¥æ‰‹"><a href="#2-5-å››æ¬¡æŒ¥æ‰‹" class="headerlink" title="2.5 å››æ¬¡æŒ¥æ‰‹"></a>2.5 å››æ¬¡æŒ¥æ‰‹</h3><ul><li><p>ç¬¬ä¸€æ¬¡ï¼šä¸»æœºA è¯·æ±‚æ–­å¼€è¿æ¥ å‘é€FIN=1 seq=uåï¼Œè¿›å…¥ç»ˆæ­¢ç­‰å¾…çŠ¶æ€1ï¼Œ </p></li><li><p>ç¬¬äºŒæ¬¡ï¼š æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚åº”ç­”ï¼šACK=1,ack=u+1,seq=vï¼Œç„¶åæœåŠ¡å™¨B å°±è¿›å…¥å…³é—­ç­‰å¾…çŠ¶æ€ï¼Œæ­¤æ—¶TCP æœåŠ¡å™¨è¿›ç¨‹å°±é€šçŸ¥é«˜å±‚åº”ç”¨è¿›ç¨‹ï¼Œå› è€Œä»A åˆ°B çš„è¿æ¥å°±é‡Šæ”¾äº†ã€‚æ­¤æ—¶æ˜¯â€œåŠå…³é—­â€çŠ¶æ€ã€‚å³A ä¸å¯ä»¥å‘é€ç»™Bï¼Œä½†æ˜¯B å¯ä»¥å‘é€ç»™Aã€‚</p></li><li><p>ç¬¬ä¸‰æ¬¡ï¼šæ­¤æ—¶ï¼Œè‹¥B æ²¡æœ‰æ•°æ®æŠ¥è¦å‘é€ç»™A äº†ï¼Œå…¶åº”ç”¨è¿›ç¨‹å°±é€šçŸ¥TCP é‡Šæ”¾è¿æ¥ï¼Œ æœåŠ¡ç«¯è¯·æ±‚æ–­å¼€è¿æ¥ï¼šFIN=1ï¼ŒACK=1,seq=w,ack=u+1ï¼Œå¹¶ç­‰å¾…ç¡®è®¤ã€‚</p></li><li><p>ç¬¬å››æ¬¡ï¼š å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯çš„è¯·æ±‚åº”ç­”ï¼š ACK=1ï¼Œseq=u+1ï¼Œack=w+1ï¼ŒA è¿›å…¥æ—¶é—´ç­‰å¾…ï¼Œæ³¨æ„ï¼Œæ­¤æ—¶TCP è¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾æ‰ï¼Œç„¶åç»è¿‡æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨è®¾ç½®çš„2MSL åï¼ŒA æ‰è¿›å…¥åˆ°å…³é—­çŠ¶æ€ã€‚</p></li></ul><p>ï¼ˆFINï¼šfinishï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_6_network.png"></p><blockquote><p>çŠ¶æ€å˜åŒ–ï¼š</p><p>å®¢æˆ·ç«¯ï¼šESTABLISHED-&gt;FIN_WAIT_1-&gt;FIN_WAIT_2-&gt;TIME_WAIT-&gt;CLOSE</p><p>æœåŠ¡ç«¯ï¼šESTABLISHED-&gt;CLOSE_WAIT-&gt; LAST_ACK-&gt;CLOSE</p></blockquote><h3 id="2-7-ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ"><a href="#2-7-ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ" class="headerlink" title="2.7 ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ"></a>2.7 ä¸ºä»€ä¹ˆè¦å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæœåŠ¡ç«¯å“åº”æ–­å¼€è¿æ¥çš„è¯·æ±‚æ—¶ï¼Œå…¶<font color="FF0000"><strong>ACKå’ŒFINåŒ…å¹¶ä¸æ˜¯ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯çš„</strong></font>ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡ç”±å®¢æˆ·ç«¯-&gt;æœåŠ¡ç«¯çš„FINä¿¡å·è¡¨ç¤ºçš„æ˜¯å®¢æˆ·ç«¯æƒ³è¦æ–­å¼€è¿æ¥ã€‚æœåŠ¡ç«¯å…ˆç»™å‡ºACKç¡®è®¤ä¿¡å·ï¼Œè¡¨ç¤ºå·²ç»æ”¶åˆ°FINè¯·æ±‚ï¼Œç„¶åå½“è‡ªå·±ä¹Ÿå¯ä»¥ç»“æŸçš„æ—¶å€™ï¼Œå†æ¬¡å‘é€FINä¿¡å·ï¼Œæ‰€ä»¥éœ€è¦æŒ¥æ‰‹äº¤äº’éœ€è¦å››æ¬¡ã€‚</p><p>ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥åœ¨æ•°æ®ä¼ é€ç»“æŸåå‘å‡ºè¿æ¥é‡Šæ”¾çš„é€šçŸ¥ï¼Œå¾…å¯¹æ–¹ç¡®è®¤åè¿›å…¥åŠå…³é—­çŠ¶æ€ã€‚å½“å¦ä¸€æ–¹ä¹Ÿæ²¡æœ‰æ•°æ®å†å‘é€çš„æ—¶å€™ï¼Œåˆ™å‘å‡ºè¿æ¥é‡Šæ”¾é€šçŸ¥ï¼Œå¯¹æ–¹ç¡®è®¤åå°±å®Œå…¨å…³é—­äº†TCPè¿æ¥ã€‚</p><h3 id="2-8-å››æ¬¡æŒ¥æ‰‹ä¸»åŠ¨æ–¹ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL"><a href="#2-8-å››æ¬¡æŒ¥æ‰‹ä¸»åŠ¨æ–¹ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL" class="headerlink" title="2.8 å››æ¬¡æŒ¥æ‰‹ä¸»åŠ¨æ–¹ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL?"></a>2.8 å››æ¬¡æŒ¥æ‰‹ä¸»åŠ¨æ–¹ä¸ºä»€ä¹ˆéœ€è¦ç­‰å¾…2MSL?</h3><p>ä¸»åŠ¨å…³é—­æ–¹åœ¨æ”¶åˆ°è¢«åŠ¨ä¸€æ–¹å‘å‡ºçš„FINä¿¡å·ï¼Œä¼šç«‹é©¬å‘é€ACKç¡®è®¤ä¿¡å·ï¼Œä¹‹åçŠ¶æ€è½¬å˜ä¸ºTIME_WAITï¼Œç­‰å¾…2MSLåæ‰ä¼šè¿›å…¥CLOSEçŠ¶æ€ã€‚</p><blockquote><p>MSLï¼ˆMaximum Segment Lifetimeï¼‰ï¼š </p><p>è¡¨ç¤ºæœ€å¤§æŠ¥æ–‡ç”Ÿå­˜å‘¨æœŸï¼Œä»»ä½•æŠ¥æ–‡åœ¨ç½‘ç»œä¸Šå­˜åœ¨çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æŠ¥æ–‡å°†è¢«ä¸¢å¼ƒã€‚ï¼ˆ å»å‘ACKæ¶ˆæ¯æœ€å¤§å­˜æ´»æ—¶é—´ï¼ˆMSL) + æ¥å‘FINæ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´(MSL)=2MSLï¼‰</p></blockquote><p>Clientç«¯ç­‰å¾…äº†2MSLåä¾ç„¶æ²¡æœ‰æ”¶åˆ°å›å¤ï¼Œåˆ™è¯æ˜Serverç«¯å·²æ­£å¸¸å…³é—­ï¼Œé‚£å¥½ï¼Œæˆ‘Clientç«¯ä¹Ÿå¯ä»¥å…³é—­è¿æ¥äº†ï¼Œ ä¸»åŠ¨å…³é—­æ–¹éœ€è¦ç­‰å¾…2MSLæ˜¯ä¸ºäº†ï¼Œ<font color="FF0000"><strong>é˜²æ­¢æœ€åä¸€æ¬¡ACKæ²¡æœ‰è¢«æ­£ç¡®çš„ä¼ ç»™è¢«åŠ¨æ–¹ï¼Œè¢«åŠ¨å…³é—­æ–¹ä¼šå†æ¬¡å‘é€ç¬¬ä¸‰æ¬¡çš„FINä¿¡å·</strong></font>ã€‚ï¼ˆè‹¥é‡å‘çš„åˆæ²¡åˆ°ï¼Œå®¢æˆ·ç«¯å°±å…³é—­äº†ï¼Œserveræœ€åå°±ä¼šå¼‚å¸¸å…³é—­è¿æ¥ï¼ŒæŠŠé“¾æ¥é”™è¯¯é—®é¢˜æŠ¥å‘Šç»™é«˜å±‚ï¼‰</p><h3 id="2-9-å·²ç»å»ºç«‹è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯æ•…éšœæ€ä¹ˆåŠï¼Ÿ"><a href="#2-9-å·²ç»å»ºç«‹è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯æ•…éšœæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="2.9 å·²ç»å»ºç«‹è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯æ•…éšœæ€ä¹ˆåŠï¼Ÿ"></a>2.9 å·²ç»å»ºç«‹è¿æ¥ï¼Œä½†å®¢æˆ·ç«¯æ•…éšœæ€ä¹ˆåŠï¼Ÿ</h3><p>TCPè¿˜è®¾æœ‰ä¸€ä¸ª<strong>ä¿æ´»è®¡æ—¶å™¨</strong>ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æœå‡ºç°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹å»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚</p><p>æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯<strong>è®¾ç½®ä¸º2å°æ—¶</strong>ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”<strong>75</strong>ç§’å‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€<strong>10ä¸ªæ¢æµ‹æŠ¥æ–‡</strong>ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚</p><h2 id="3-TCP-UDP-åè®®çš„åŒºåˆ«â­"><a href="#3-TCP-UDP-åè®®çš„åŒºåˆ«â­" class="headerlink" title="3.TCP/UDP åè®®çš„åŒºåˆ«â­"></a>3.TCP/UDP åè®®çš„åŒºåˆ«â­</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_7_network.png"></p><ul><li>TCPåè®®è¿›è¡Œæ•°æ®é€šä¿¡ä¹‹å‰éœ€è¦<strong>ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</strong>ï¼ŒUDPåè®®ä¸éœ€è¦å»ºç«‹è¿æ¥å³å¯å‘é€æ•°æ®ã€‚</li><li>TCPæœ‰<strong>ç¡®è®¤</strong>æœºåˆ¶ï¼Œä¸¢åŒ…å¯ä»¥é‡å‘ï¼Œä¿è¯æ•°æ®çš„æ­£ç¡®æ€§ï¼›UDPä¸ä¿è¯æ­£ç¡®æ€§ï¼Œåªæ˜¯å•çº¯çš„è´Ÿè´£å‘é€æ•°æ®åŒ…ã€‚<strong>ä¼ è¾“å¯é æ€§</strong>åŒºåˆ«</li><li>TCPåè®®å¯èƒ½ä¼šå¯¹å¤§æ•°æ®åŒ…è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶ä¸”åœ¨æ¥æ”¶æ–¹è¿›è¡Œé‡ç»„æ•°æ®åŒ…æ“ä½œï¼›UDPåè®®æ˜¯é¢å‘æŠ¥æ–‡çš„ï¼Œä¸ä¼šè¿›è¡Œåˆ†ç‰‡å’Œé‡ç»„ï¼Œæ‰€ä»¥éœ€è¦æ³¨æ„ä¼ è¾“çš„æŠ¥æ–‡å¤§å°ã€‚</li><li>ç½‘ç»œåŒ…ä¸­çš„TCPå¤´éƒ¨ä¸º20ä¸ªå­—èŠ‚ï¼›UDPå¤´éƒ¨åªæœ‰8ä¸ªå­—èŠ‚ã€‚</li></ul><blockquote><p>UDPï¼ˆä¸€èˆ¬ç”¨äºå³æ—¶é€šä¿¡ï¼‰ï¼Œæ¯”å¦‚ï¼š QQ è¯­éŸ³ã€ QQ è§†é¢‘ ã€ç›´æ’­ã€å±å¹•å¹¿æ’­ã€DNSã€å¤šæ’­ç­‰ç­‰</p><p>TCP æä¾›é¢å‘è¿æ¥çš„æœåŠ¡ã€‚åœ¨ä¼ é€æ•°æ®ä¹‹å‰å¿…é¡»å…ˆå»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ é€ç»“æŸåè¦é‡Šæ”¾è¿æ¥ã€‚ TCP ä¸€èˆ¬ç”¨äºæ–‡ä»¶ä¼ è¾“ã€å‘é€å’Œæ¥æ”¶é‚®ä»¶ã€è¿œç¨‹ç™»å½•ç­‰åœºæ™¯ã€‚</p></blockquote><h3 id="3-1-ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åŒ…æ‹¬å“ªäº›æœ‰äº†è§£å—ï¼Ÿ"><a href="#3-1-ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åŒ…æ‹¬å“ªäº›æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="3.1 ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åŒ…æ‹¬å“ªäº›æœ‰äº†è§£å—ï¼Ÿ"></a>3.1 ä¸€ä¸ªç½‘ç»œæ•°æ®åŒ…åŒ…æ‹¬å“ªäº›æœ‰äº†è§£å—ï¼Ÿ</h3><p>ç½‘ç»œæ•°æ®åŒ…ä¸€èˆ¬åŒ…æ‹¬å¤´éƒ¨å’Œæ•°æ®éƒ¨åˆ†ï¼Œåœ¨TCPåè®®ä¸­ï¼Œè¦å‘é€çš„æ•°æ®ç»è¿‡TCPæ¨¡å—æ·»åŠ TCPå¤´éƒ¨ï¼›ç„¶åIPæ¨¡å—æ·»åŠ IPå¤´éƒ¨å’ŒMACå¤´éƒ¨ï¼ˆé“¾è·¯å±‚ï¼‰ï¼›ç„¶ååœ¨æœ€å‰é¢åŠ ä¸ŠæŠ¥å¤´/èµ·å§‹å¸§åˆ†ç•Œç¬¦ä»¥åŠæœ«å°¾å‡å¦‚FCSï¼ˆå¸§æ ¡éªŒåºåˆ—ï¼‰ï¼Œè¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªå®Œæˆçš„æ•°æ®åŒ…ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_8_network.png"></p><h3 id="3-2-æ¯ä¸€å±‚çš„æ•°æ®å«ä»€ä¹ˆåå­—ï¼Ÿ"><a href="#3-2-æ¯ä¸€å±‚çš„æ•°æ®å«ä»€ä¹ˆåå­—ï¼Ÿ" class="headerlink" title="3.2 æ¯ä¸€å±‚çš„æ•°æ®å«ä»€ä¹ˆåå­—ï¼Ÿ"></a>3.2 æ¯ä¸€å±‚çš„æ•°æ®å«ä»€ä¹ˆåå­—ï¼Ÿ</h3><p>æˆ‘ä»¬æŠŠåº”ç”¨å±‚äº¤äº’çš„æ•°æ®å•å…ƒç§°ä¸ºæŠ¥æ–‡</p><p>ä¼ è¾“å±‚ï¼šTCPå«æŠ¥æ–‡æ®µï¼ŒUDPå«ç”¨æˆ·æ•°æ®æŠ¥</p><p>ç½‘ç»œå±‚ï¼šæŠŠè¿è¾“å±‚çš„æŠ¥æ–‡æ®µæˆ–è€…ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„æˆ–è€…åŒ…ï¼Œä¹Ÿå«IPæ•°æ®æŠ¥ï¼ˆæ•°æ®æŠ¥ï¼‰</p><p>é“¾è·¯å±‚ï¼šå¸§</p><p>ç‰©ç†å±‚ï¼šæ¯”ç‰¹æµ</p><h3 id="3-3-TCPåè®®ä¸­çš„æ•°æ®åŒ…åˆ†ç‰‡ä¸é‡ç»„åŠŸèƒ½æœ‰äº†è§£å—ï¼Ÿ"><a href="#3-3-TCPåè®®ä¸­çš„æ•°æ®åŒ…åˆ†ç‰‡ä¸é‡ç»„åŠŸèƒ½æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="3.3 TCPåè®®ä¸­çš„æ•°æ®åŒ…åˆ†ç‰‡ä¸é‡ç»„åŠŸèƒ½æœ‰äº†è§£å—ï¼Ÿ"></a>3.3 TCPåè®®ä¸­çš„æ•°æ®åŒ…åˆ†ç‰‡ä¸é‡ç»„åŠŸèƒ½æœ‰äº†è§£å—ï¼Ÿ</h3><p>å½“TCPä¼ è¾“çš„æ•°æ®åŒ…æ¯”è¾ƒå¤§æ—¶ï¼Œåœ¨å‘é€æ–¹ä¼šè¿›è¡Œåˆ†ç‰‡ï¼Œåœ¨æ¥æ”¶æ–¹è¿›è¡Œæ•°æ®åŒ…çš„é‡ç»„ã€‚</p><ul><li><p>å‘é€æ–¹ï¼š</p><p>å°†æ•°æ®åŒ…åˆ†ä¸ºå¤šä¸ª<strong>TCPå¤´éƒ¨+æ•°æ®åŒ…</strong>çš„ç»„åˆï¼ŒTCPå¤´éƒ¨ä¸­å­˜ç€ä¸åŒçš„<strong>æ•°æ®åºå·</strong>ï¼›ä¹‹åå°†å¤šä¸ªç»„åˆäº¤ç”±IPæ¨¡å—ï¼Œ<strong>ç»Ÿä¸€æ·»åŠ IPå¤´éƒ¨å’ŒMACå¤´éƒ¨</strong>ï¼ŒIPå¤´éƒ¨çš„<strong>IDå·</strong>è®¾ä¸ºç»Ÿä¸€çš„ã€‚</p></li><li><p>æ¥æ”¶æ–¹ï¼š</p><p>IPæ¨¡å—å…·æœ‰åˆ†ç‰‡é‡ç»„çš„åŠŸèƒ½ï¼Œå¦‚æœæ¥æ”¶åˆ°çš„åŒ…æ˜¯ç»è¿‡åˆ†ç‰‡çš„ï¼Œé‚£ä¹ˆIPæ¨¡å—ä¼šå°†å®ƒä»¬è¿˜åŸæˆåŸå§‹çš„åŒ…ã€‚åˆ†ç‰‡çš„åŒ…ä¼šåœ¨<strong>IPå¤´éƒ¨</strong>çš„æ ‡å¿—å­—æ®µä¸­è¿›è¡Œæ ‡è®°ï¼Œå½“æ”¶åˆ°åˆ†ç‰‡çš„åŒ…æ—¶ï¼ŒIPæ¨¡å—ä¼šå°†å…¶æš‚æ—¶å­˜åœ¨å†…éƒ¨çš„å†…å­˜ç©ºé—´ä¸­ï¼Œç„¶åç­‰å¾…IPå¤´éƒ¨ä¸­<strong>å…·æœ‰ç›¸åŒIDçš„åŒ…</strong>å…¨éƒ¨åˆ°è¾¾ã€‚æ­¤å¤–ï¼ŒIPå¤´éƒ¨è¿˜æœ‰ä¸€ä¸ª<strong>åˆ†ç‰‡åç§»é‡</strong>çš„å­—æ®µï¼Œå®ƒè¡¨ç¤ºå½“å‰åˆ†ç‰‡åœ¨æ•´ä¸ªåŒ…ä¸­æ‰€å¤„çš„ä½ç½®ã€‚æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œåœ¨æ‰€æœ‰çš„åˆ†ç‰‡å…¨éƒ¨æ”¶åˆ°ä¹‹åï¼Œå°±å¯ä»¥å°†å®ƒä»¬è¿˜åŸæˆåŸå§‹çš„åŒ…ã€‚</p></li></ul><blockquote><p>é“¾è·¯å±‚MTU(Maximum Transmission Unit)ï¼šæ¯ä¸€ç§ç‰©ç†ç½‘ç»œéƒ½ä¼šè§„å®šé“¾è·¯å±‚æ•°æ®å¸§çš„æœ€å¤§é•¿åº¦ã€‚IPåè®®åœ¨ä¼ è¾“æ•°æ®åŒ…æ—¶ï¼Œè‹¥IPæ•°æ®æŠ¥åŠ ä¸Šæ•°æ®å¸§å¤´éƒ¨åé•¿åº¦å¤§äºMTUï¼Œåˆ™å°†æ•°æ®æŠ¥æ–‡åˆ†ä¸ºè‹¥å¹²åˆ†ç‰‡è¿›è¡Œä¼ è¾“ï¼Œå¹¶åœ¨ç›®æ ‡ç³»ç»Ÿä¸­è¿›è¡Œé‡ç»„ã€‚</p></blockquote><blockquote><p>MSSï¼šæ˜¯TCPæ•°æ®åŒ…æ¯æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æŠ¥æ–‡åˆ†æ®µã€‚</p></blockquote><h3 id="3-4-TCPç²˜åŒ…"><a href="#3-4-TCPç²˜åŒ…" class="headerlink" title="3.4 TCPç²˜åŒ…"></a>3.4 TCPç²˜åŒ…</h3><p>TCPç²˜åŒ…æ˜¯æŒ‡ä¸€ç§å‘é€æ–¹å‘é€çš„æ•°æ®åŒ…åœ¨æ¥æ”¶æ–¹çš„ç¼“å†²åŒºä¸­ç²˜æˆäº†ä¸€åŒ…ï¼Œä¹Ÿå°±æ˜¯å‡ºç°äº†æ•°æ®åŒ…é¦–å°¾ç›¸æ¥çš„ç°è±¡ã€‚</p><ul><li><p>äº§ç”ŸåŸå› ï¼šä¸»è¦æ˜¯å‘é€æ–¹ä½¿ç”¨äº†Nagleç®—æ³•ï¼Œæˆ–è€…æ¥æ”¶æ–¹çš„å¤„ç†é€Ÿåº¦å°äºæ•°æ®åŒ…çš„æ¥æ”¶é€Ÿåº¦ï¼Œå¯¼è‡´æ¥æ”¶ç¼“å†²åŒºä¸­æ¶ˆæ¯å †ç§¯ã€‚</p></li><li><p>è§£å†³æ–¹æ³•ï¼šå¯ä»¥é€šè¿‡å…³é—­Nagleç®—æ³•æˆ–è€…è§„å®šæ¯ä¸ªæ•°æ®åŒ…çš„å…·ä½“æ ¼å¼å’Œé•¿åº¦ï¼Œåœ¨æ¥æ”¶æ–¹çš„åº”ç”¨å±‚æ¥è¿›è¡Œåˆ¤æ–­</p></li></ul><p>è¿˜æœ‰UDPæ˜¯ä¸ä¼šäº§ç”Ÿç²˜åŒ…ç°è±¡çš„ï¼Œå› ä¸ºæ•°æ®åŒ…ä¹‹é—´å…·æœ‰æ˜ç¡®çš„æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œã€‚</p><h2 id="4-TCP-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼ˆå¦‚ä½•ç”¨UDPå®ç°å¯é ä¼ è¾“ï¼‰"><a href="#4-TCP-åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼ˆå¦‚ä½•ç”¨UDPå®ç°å¯é ä¼ è¾“ï¼‰" class="headerlink" title="4. TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼ˆå¦‚ä½•ç”¨UDPå®ç°å¯é ä¼ è¾“ï¼‰"></a>4. TCP åè®®å¦‚ä½•ä¿è¯å¯é ä¼ è¾“ï¼ˆå¦‚ä½•ç”¨UDPå®ç°å¯é ä¼ è¾“ï¼‰</h2><ul><li><p><strong>ç¡®è®¤</strong>ï¼š</p><p>TCPé¦–éƒ¨çš„ç¡®è®¤å·æ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚å‘é€æ–¹ç¼“å­˜åŒºä¼šç»§ç»­å­˜å‚¨å“ªäº›å·²å‘é€ä½†æ˜¯æœªæ”¶åˆ°ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œä»¥ä¾¿é‡ä¼ ã€‚</p><p>TCPé»˜è®¤ä½¿ç”¨<strong>ç´¯è®¡ç¡®è®¤</strong>ï¼Œå³æ¥æ”¶æ–¹ä¸å¿…å¯¹æ”¶åˆ°çš„åˆ†ç»„é€ä¸ªå‘é€ç¡®è®¤ï¼Œè€Œæ˜¯åœ¨æ”¶åˆ°å‡ ä¸ªåˆ†ç»„åï¼Œå¯¹<strong>æŒ‰åº</strong>åˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„å‘é€ç¡®è®¤ï¼ˆä¸­é—´æ²¡åˆ°çš„å¯èƒ½ä¸¢äº†ä¹Ÿå¯èƒ½é˜»å¡è¿˜æ²¡åˆ°ï¼‰ï¼Œè¿™å°±è¡¨ç¤ºåˆ°è¿™ä¸ªåˆ†ç»„ä¸ºæ­¢çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²ç»æ­£ç¡®æ”¶åˆ°äº†ã€‚ï¼ˆä½†æ˜¯ä¸ä¼šç«‹å³å‘é€è¿™ä¸ªç¡®è®¤å·çš„æ•°æ®åŒ…ï¼Œå› ä¸ºå…¶æœ‰å¯èƒ½åªæ˜¯é˜»å¡äº†è¿˜èƒ½åˆ°ï¼Œä¼šç­‰åˆ°è¿™ä¸ªæŠ¥æ–‡æ®µè®¾ç½®çš„é‡ä¼ æ—¶é—´åˆ°äº†è¿˜æ²¡æ”¶åˆ°ç¡®è®¤å°±é‡ä¼ ï¼‰</p></li><li><p><strong>é‡ä¼ ï¼š</strong>ä¸¤ç§äº‹ä»¶ä¼šå¯¼è‡´TCPå¯¹æŠ¥æ–‡æ®µçš„é‡ä¼ ï¼šè¶…æ—¶å’Œå†—ä½™ACKã€‚</p><ul><li>è¶…æ—¶ï¼šTCPæ¯å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µï¼Œå°±å¯¹è¿™ä¸ªæŠ¥æ–‡æ®µè®¾ç½®ä¸€æ¬¡è®¡æ—¶å™¨ï¼Œè®¡æ—¶å™¨è®¾ç½®çš„é‡ä¼ æ—¶é—´åˆ°æœŸä½†è¿˜æœªæ”¶åˆ°ç¡®è®¤ï¼Œå°±é‡ä¼ ã€‚  </li><li>å†—ä½™ACKï¼šè¶…æ—¶è§¦å‘é‡ä¼ çš„å‘¨æœŸå¾€å¾€å¤ªé•¿ã€‚TCPè§„å®šæ¯å½“æ¯”æœŸæœ›åºå·æ›´å¤§çš„å¤±åºæŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œå°±å‘é€ä¸€ä¸ªå†—ä½™ACKï¼ˆå†æ¬¡ç¡®è®¤æŸä¸ªæŠ¥æ–‡æ®µçš„ACKï¼Œä¹‹å‰å·²ç»æ”¶åˆ°è¿‡ï¼‰ï¼ŒTCPè§„å®šå½“å‘é€æ–¹æ¥æ”¶åˆ°å¯¹åŒä¸€æŠ¥æ–‡æ®µçš„3ä¸ªå†—ä½™ACKæ—¶ï¼Œå¯ä»¥è®¤ä¸ºè¿™ä¸ªæŠ¥æ–‡æ®µå·²ç»ä¸¢å¤±ï¼Œç«‹å³æ‰§è¡Œé‡ä¼ ï¼Œä¹Ÿç§°<strong>å¿«é€Ÿé‡ä¼ </strong>ã€‚</li></ul></li><li><p><strong>åºåˆ—å·</strong>ï¼šTCP ç»™ æ¯ä¸ªå­—èŠ‚çš„æ•°æ®éƒ½è¿›è¡Œäº†ç¼–å·ï¼Œå³åºåˆ—å·ã€‚ </p><p>TCPä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œæ¯æ¬¡æ¥æ”¶æ–¹æ”¶åˆ°æ•°æ®åï¼Œéƒ½ä¼šå¯¹ä¼ è¾“æ–¹è¿›è¡Œç¡®è®¤åº”ç­”ï¼Œ ä¹Ÿå°±æ˜¯å‘é€ACKæŠ¥æ–‡ã€‚è¿™ä¸ªACKæŠ¥æ–‡å½“ä¸­å¸¦æœ‰å¯¹åº”çš„ç¡®è®¤åºåˆ—å·ï¼Œå‘Šè¯‰å‘é€æ–¹ï¼Œæ¥æ”¶åˆ°äº†å“ªäº›æ•°æ®ï¼Œä¸‹ä¸€æ¬¡çš„æ•°æ®ä»å“ªé‡Œå‘ï¼ˆå¯¹ä¸¢åŒ…çš„ä¼šé‡ä¼ ï¼‰ã€‚æ¥æ”¶æ–¹æ ¹æ®ç¼–å·ä¼šä¸¢å¼ƒé‡å¤ç¼–å·çš„æ•°æ®ï¼ˆå¦‚è¶…æ—¶é‡ä¼ ä¸­è‹¥æ˜¯å› ä¸ºåº”ç­”ä¿¡å·ä¸¢å¤±ï¼Œåˆ™ä¼šå†ä¼ é‡å¤çš„æ•°æ®ï¼‰ï¼ŒæŠŠæœ‰åºæ•°æ®ä¼ é€ç»™åº”ç”¨å±‚ã€‚</p></li><li><p><strong>æ ¡éªŒå’Œ</strong>ï¼š ç›®çš„æ˜¯æ£€æµ‹æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­çš„ä»»ä½•å˜åŒ–ã€‚å¦‚æœæ”¶åˆ°æ®µçš„æ£€éªŒå’Œæœ‰å·®é”™ï¼ŒTCP å°†ä¸¢å¼ƒè¿™ä¸ªæŠ¥æ–‡æ®µå’Œä¸ç¡®è®¤æ”¶åˆ°æ­¤æŠ¥æ–‡æ®µã€‚</p></li></ul><blockquote><p>æ ¡éªŒå’Œçš„è®¡ç®—æ–¹å¼ï¼šåœ¨æ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œå°†å‘é€çš„æ•°æ®æ®µéƒ½å½“åšä¸€ä¸ª16ä½çš„æ•´æ•°ã€‚å°†è¿™äº›æ•´æ•°åŠ èµ·æ¥ã€‚å¹¶ä¸”å‰é¢çš„è¿›ä½ä¸èƒ½ä¸¢å¼ƒï¼Œè¡¥åœ¨åé¢ï¼Œæœ€åå–åï¼Œå¾—åˆ°æ ¡éªŒå’Œã€‚</p><p>å‘é€æ–¹ï¼šåœ¨å‘é€æ•°æ®ä¹‹å‰è®¡ç®—æ£€éªŒå’Œï¼Œå¹¶è¿›è¡Œæ ¡éªŒå’Œçš„å¡«å……ã€‚ </p><p>æ¥æ”¶æ–¹ï¼šæ”¶åˆ°æ•°æ®åï¼Œå¯¹æ•°æ®ä»¥åŒæ ·çš„æ–¹å¼è¿›è¡Œè®¡ç®—ï¼Œæ±‚å‡ºæ ¡éªŒå’Œï¼Œä¸å‘é€æ–¹çš„è¿›è¡Œæ¯”å¯¹ </p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_9_network.png"></p><blockquote><p>å¦‚æœæ¥æ”¶æ–¹æ¯”å¯¹æ ¡éªŒå’Œä¸å‘é€æ–¹ä¸ä¸€è‡´ï¼Œæ•°æ®ä¸€å®šä¼ è¾“æœ‰è¯¯ã€‚</p><p>å¦‚æœæ¥æ”¶æ–¹æ¯”å¯¹æ ¡éªŒå’Œä¸å‘é€æ–¹ä¸€è‡´ï¼Œæ•°æ®ä¸ä¸€å®šä¼ è¾“æˆåŠŸã€‚</p></blockquote><p>æ­¤å¤–ï¼ŒTCPåè®®è¿˜é€šè¿‡</p><ul><li><p>æµé‡æ§åˆ¶</p></li><li><p>æ‹¥å¡æ§åˆ¶</p></li><li><p>ARQåè®®</p></li></ul><p>ä¿è¯ä¼ è¾“çš„å¯é æ€§ã€‚</p><h3 id="4-1-TCP-æµé‡æ§åˆ¶"><a href="#4-1-TCP-æµé‡æ§åˆ¶" class="headerlink" title="4.1 TCP æµé‡æ§åˆ¶"></a>4.1 TCP æµé‡æ§åˆ¶</h3><p>TCP è¿æ¥çš„æ¯ä¸€æ–¹éƒ½æœ‰å›ºå®šå¤§å°çš„ç¼“å†²ç©ºé—´ï¼ŒTCPçš„æ¥æ”¶ç«¯åªå…è®¸å‘é€ç«¯å‘é€æ¥æ”¶ç«¯ç¼“å†²åŒºèƒ½æ¥çº³çš„æ•°æ®ã€‚å½“æ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†å‘é€æ–¹çš„æ•°æ®ï¼Œèƒ½æç¤ºå‘é€æ–¹é™ä½å‘é€çš„é€Ÿç‡ï¼Œé˜²æ­¢åŒ…ä¸¢å¤±ã€‚ </p><p>TCP åˆ©ç”¨æ»‘åŠ¨çª—å£å®ç°æµé‡æ§åˆ¶ï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹é˜¶æ®µï¼ŒåŒæ–¹äº’ç›¸å°†è‡ªå·±çš„<strong>æ•°æ®æ¥æ”¶ç¼“å†²æ± å¤§å°</strong>å‘Šè¯‰å¯¹æ–¹ã€‚ <strong>æ¥æ”¶æ–¹æœ‰å³æ—¶çª—å£</strong>ï¼ˆæ»‘åŠ¨çª—å£ï¼‰ï¼Œ çª—å£å¤§å°çš„å†…å®¹ å®é™…ä¸Šæ˜¯æ¥æ”¶ç«¯æ¥æ”¶æ•°æ®ç¼“å†²åŒºçš„å‰©ä½™å¤§å°ï¼Œè€Œä¸”æ¥æ”¶ç«¯ä¼šåœ¨ç¡®è®¤åº”ç­”å‘é€ACKæŠ¥æ–‡æ—¶ï¼Œå°†è‡ªå·±çš„å³æ—¶çª—å£å¤§å°å¡«å…¥ï¼Œå¹¶è·ŸéšACKæŠ¥æ–‡ä¸€èµ·å‘é€è¿‡å»ã€‚åœ¨å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå½“æ¥æ”¶ç¼“å†²æ± çš„å¤§å°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¦ç»™å¯¹æ–¹å‘é€æ›´æ–°çª—å£å¤§å°çš„é€šçŸ¥ã€‚ å‘é€æ–¹æ ¹æ®ACKæŠ¥æ–‡é‡Œçš„çª—å£å¤§å°çš„å€¼çš„æ”¹å˜è¿›è€Œæ”¹å˜è‡ªå·±çš„å‘é€é€Ÿåº¦ï¼Œ å¦‚æœæ¥æ”¶åˆ°çª—å£å¤§å°çš„å€¼ä¸º0ï¼Œé‚£ä¹ˆå‘é€æ–¹å°†åœæ­¢å‘é€æ•°æ®ã€‚å¹¶å®šæœŸçš„å‘æ¥æ”¶ç«¯å‘é€çª—å£æ¢æµ‹æ•°æ®æ®µï¼Œè®©æ¥æ”¶ç«¯æŠŠçª—å£å¤§å°å‘Šè¯‰å‘é€ç«¯ã€‚</p><p>é‚£ä¹ˆ<strong>å‘é€æ–¹</strong>å°±å¯ä»¥ç»´æŠ¤ä¸€ä¸ªç§°ä¸º<strong>æ¥æ”¶çª—å£</strong>çš„å˜é‡å®ç°æµé‡æ§åˆ¶ã€‚</p><h3 id="4-2-TCP-æ‹¥å¡æ§åˆ¶"><a href="#4-2-TCP-æ‹¥å¡æ§åˆ¶" class="headerlink" title="4.2 TCP æ‹¥å¡æ§åˆ¶"></a>4.2 TCP æ‹¥å¡æ§åˆ¶</h3><p>é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚</p><p>å‘é€æ–¹ç»´æŒä¸€ä¸ªæ‹¥å¡çª—å£cwndçš„çŠ¶æ€å˜é‡ï¼Œæ‹¥å¡çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ï¼Œåªè¦ç½‘ç»œæ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å†å¢å¤§ä¸€äº›ï¼Œä»¥ä¾¿æŠŠæ›´å¤šçš„åˆ†ç»„å‘é€å‡ºå»ã€‚ä½†åªè¦ç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å‡å°ä¸€äº›ï¼Œä»¥å‡å°‘æ³¨å…¥åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ã€‚</p><blockquote><p>å‘é€çª—å£çš„ä¸Šé™ä¸ºæ¥æ”¶çª—å£å’Œæ‹¥å¡çª—å£ä¸­è¾ƒå°çš„ä¸€ä¸ªã€‚</p></blockquote><p><strong>æ‹¥å¡æ§åˆ¶ä¸æµé‡æ§åˆ¶çš„åŒºåˆ«ï¼š</strong></p><ul><li>æ‹¥å¡æ§åˆ¶æ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°æ‰€æœ‰çš„ä¸»æœºï¼Œæ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸é™ä½ç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚</li><li>æµé‡æ§åˆ¶å¾€å¾€æ˜¯ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æ§åˆ¶ï¼Œæ˜¯ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ã€‚æµé‡æ§åˆ¶æ‰€è¦åšåˆ°çš„å°±æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿç‡ï¼Œä»¥ä¾¿ä½¿æ¥æ”¶ç«¯æ¥å¾—åŠæ¥æ”¶ã€‚</li></ul><p>TCPçš„æ‹¥å¡æ§åˆ¶é‡‡ç”¨äº†å››ç§ç®—æ³•ï¼Œå³ <strong>æ…¢å¼€å§‹</strong> ã€ <strong>æ‹¥å¡é¿å…</strong> ã€<strong>å¿«é‡ä¼ </strong> å’Œ <strong>å¿«æ¢å¤</strong></p><ul><li><p><strong>æ…¢å¼€å§‹ï¼š</strong> æ…¢å¼€å§‹ç®—æ³•çš„æ€è·¯æ˜¯å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æœç«‹å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¼•èµ·ç½‘ç»œé˜»å¡ï¼Œå› ä¸ºç°åœ¨è¿˜ä¸çŸ¥é“ç½‘ç»œçš„è´Ÿè·æƒ…å†µã€‚ç»éªŒè¡¨æ˜ï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆæ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯ç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚cwndåˆå§‹å€¼ä¸º1ï¼ˆæœ€å¤§ä¸€ä¸ªæŠ¥æ–‡æ®µçš„é•¿åº¦ï¼‰ï¼Œæ¯ç»è¿‡ä¸€ä¸ªä¼ æ’­è½®æ¬¡ï¼ˆå³å¾€è¿”æ—¶é—´ï¼‰ï¼ŒcwndåŠ å€ï¼ŒæŒ‡æ•°å‹å¢é•¿ï¼Œä¸€ç›´åˆ°è§„å®šçš„æ…¢å¼€å§‹é—¨é™ï¼Œç„¶åæ”¹ç”¨æ‹¥å¡é¿å…ç®—æ³•ã€‚</p></li><li><p><strong>æ‹¥å¡é¿å…ï¼š</strong> æ‹¥å¡é¿å…ç®—æ³•çš„æ€è·¯æ˜¯è®©æ‹¥å¡çª—å£cwndç¼“æ…¢å¢å¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´RTTå°±æŠŠå‘é€æ”¾çš„cwndåŠ 1ï¼ŒæŒ‰ç…§çº¿æ€§å¢é•¿ã€‚ï¼ˆå³åŠ æ³•å¢å¤§ï¼‰ã€‚å½“å‡ºç°ä¸€æ¬¡è¶…æ—¶ï¼ˆç½‘ç»œæ‹¥å¡æ—¶ï¼‰ã€‚ä»¤æ…¢å¼€å§‹é—¨é™ä¸ºå½“å‰cwndçš„ä¸€åŠï¼Œcwndé‡ç½®ä¸º1ï¼Œæ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼ˆå³ä¹˜æ³•å‡å°ï¼‰</p></li><li><p><strong>å¿«é‡ä¼ ä¸å¿«æ¢å¤FRRï¼š</strong></p><ul><li>å¿«é‡ä¼ ï¼šä½¿ç”¨å†—ä½™ACKæ¥æ£€æµ‹ä¸¢åŒ…çš„å‘ç”Ÿã€‚å†—ä½™ACKä¹Ÿç”¨äºç½‘ç»œæ‹¥å¡çš„æ£€æµ‹ï¼ˆä¸¢åŒ…å½“ç„¶æ„å‘³ç€ç½‘ç»œå¯èƒ½å‡ºç°äº†æ‹¥å¡ï¼‰ã€‚</li><li>å¿«æ¢å¤ï¼šæ”¶åˆ°ä¸‰ä¸ªå†—ä½™ACKï¼Œæ‰§è¡Œä¹˜æ³•å‡å°ï¼ŒæŠŠæ…¢å¼€å§‹é—¨é™å‡ä¸ºå½“å‰cwndçš„ä¸€åŠï¼Œä½†æ˜¯cwndä¸ç½®ä¸º1ï¼Œç½®ä¸ºæ–°çš„æ…¢å¼€å§‹é—¨é™å€¼ï¼ˆå³å‡åŠï¼‰ï¼Œç„¶åæ‰§è¡ŒåŠ æ³•å¢å¤§ã€‚ç”±äºè·³è¿‡äº†cwndä»1å¼€å§‹çš„æ…¢å¼€å§‹è¿‡ç¨‹æ‰€ä»¥ç§°ä¸ºå¿«æ¢å¤ã€‚</li></ul></li></ul><p><strong>å°ç»“</strong>ï¼šå½“å‘é€æ–¹æ£€æµ‹åˆ°è¶…æ—¶çš„æ—¶å€™ï¼Œé‡‡ç”¨æ…¢å¼€å§‹+æ‹¥å¡é¿å…ï¼Œå½“å‘é€æ–¹æ¥æ”¶åˆ°å†—ä½™ACKæ—¶ï¼Œé‡‡ç”¨å¿«é‡ä¼ +å¿«æ¢å¤</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_10_network.png"></p><h3 id="4-3-ARQåè®®"><a href="#4-3-ARQåè®®" class="headerlink" title="4.3 ARQåè®®"></a>4.3 ARQåè®®</h3><p><strong>è‡ªåŠ¨é‡ä¼ è¯·æ±‚</strong>ï¼ˆAutomatic Repeat-reQuestï¼ŒARQï¼‰æ˜¯OSIæ¨¡å‹ä¸­<strong>æ•°æ®é“¾è·¯å±‚å’Œä¼ è¾“å±‚</strong>çš„é”™è¯¯çº æ­£åè®®ä¹‹ä¸€ã€‚ä½¿ç”¨äº†<strong>ç¡®è®¤å’Œè¶…æ—¶</strong>çš„ä¸¤ä¸ªæœºåˆ¶ã€‚</p><p>ARQåŒ…æ‹¬ï¼š</p><ul><li>åœæ­¢ç­‰å¾…ARQåè®®</li><li>è¿ç»­ARQåè®®ã€‚</li></ul><blockquote><p>åœæ­¢ç­‰å¾…ARQåè®®</p></blockquote><ul><li><p>åœæ­¢ç­‰å¾…åè®®ï¼šæ¯å‘å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹ç¡®è®¤ï¼ˆå›å¤ACKï¼‰ã€‚å¦‚æœè¿‡äº†ä¸€æ®µæ—¶é—´ï¼ˆè¶…æ—¶æ—¶é—´åï¼‰ï¼Œè¿˜æ˜¯æ²¡æœ‰æ”¶åˆ° ACK ç¡®è®¤ï¼Œè¯´æ˜æ²¡æœ‰å‘é€æˆåŠŸï¼Œéœ€è¦é‡æ–°å‘é€ï¼Œç›´åˆ°æ”¶åˆ°ç¡®è®¤åå†å‘ä¸‹ä¸€ä¸ªåˆ†ç»„ï¼›</p></li><li><p>åœ¨åœæ­¢ç­‰å¾…åè®®ä¸­ï¼Œè‹¥æ¥æ”¶æ–¹æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ï¼›</p></li><li><p>ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>ä¼˜ç‚¹ï¼š ç®€å•</li><li>ç¼ºç‚¹ï¼š ä¿¡é“åˆ©ç”¨ç‡ä½ï¼Œç­‰å¾…æ—¶é—´é•¿</li></ul></li><li><p>å‡ ç§å…·ä½“æƒ…å†µï¼š</p><ul><li><p>æ— å·®é”™æƒ…å†µ:</p><p>å‘é€æ–¹å‘é€åˆ†ç»„,æ¥æ”¶æ–¹åœ¨è§„å®šæ—¶é—´å†…æ”¶åˆ°,å¹¶ä¸”å›å¤ç¡®è®¤.å‘é€æ–¹å†æ¬¡å‘é€ã€‚</p></li><li><p>å‡ºç°å·®é”™æƒ…å†µï¼ˆè¶…æ—¶é‡ä¼ ï¼‰:</p><p>åœæ­¢ç­‰å¾…åè®®ä¸­è¶…æ—¶é‡ä¼ æ˜¯æŒ‡åªè¦è¶…è¿‡ä¸€æ®µæ—¶é—´ä»ç„¶æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±é‡ä¼ å‰é¢å‘é€è¿‡çš„åˆ†ç»„ï¼ˆè®¤ä¸ºåˆšæ‰å‘é€è¿‡çš„åˆ†ç»„ä¸¢å¤±äº†ï¼‰ã€‚å› æ­¤æ¯å‘é€å®Œä¸€ä¸ªåˆ†ç»„éœ€è¦è®¾ç½®ä¸€ä¸ªè¶…æ—¶è®¡æ—¶å™¨ï¼Œå…¶é‡ä¼ æ—¶é—´åº”æ¯”æ•°æ®åœ¨åˆ†ç»„ä¼ è¾“çš„å¹³å‡å¾€è¿”æ—¶é—´æ›´é•¿ä¸€äº›ã€‚è¿™ç§è‡ªåŠ¨é‡ä¼ æ–¹å¼å¸¸ç§°ä¸º è‡ªåŠ¨é‡ä¼ è¯·æ±‚ ARQ ã€‚å¦å¤–åœ¨åœæ­¢ç­‰å¾…åè®®ä¸­è‹¥æ”¶åˆ°é‡å¤åˆ†ç»„ï¼Œå°±ä¸¢å¼ƒè¯¥åˆ†ç»„ï¼Œä½†åŒæ—¶è¿˜è¦å‘é€ç¡®è®¤ã€‚</p></li><li><p>ç¡®è®¤ä¸¢å¤±å’Œç¡®è®¤è¿Ÿåˆ°</p><ul><li>ç¡®è®¤ä¸¢å¤± ï¼šç¡®è®¤æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸¢å¤±ã€‚å½“Aå‘é€M1æ¶ˆæ¯ï¼ŒBæ”¶åˆ°åï¼ŒBå‘Aå‘é€äº†ä¸€ä¸ªM1ç¡®è®¤æ¶ˆæ¯ï¼Œä½†å´åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±ã€‚è€ŒAå¹¶ä¸çŸ¥é“ï¼Œåœ¨è¶…æ—¶è®¡æ—¶è¿‡åï¼ŒAé‡ä¼ M1æ¶ˆæ¯ï¼ŒBå†æ¬¡æ”¶åˆ°è¯¥æ¶ˆæ¯åé‡‡å–ä»¥ä¸‹ä¸¤ç‚¹æªæ–½ï¼š1. ä¸¢å¼ƒè¿™ä¸ªé‡å¤çš„M1æ¶ˆæ¯ï¼Œä¸å‘ä¸Šå±‚äº¤ä»˜ã€‚ 2. å‘Aå‘é€ç¡®è®¤æ¶ˆæ¯ã€‚ï¼ˆä¸ä¼šè®¤ä¸ºå·²ç»å‘é€è¿‡äº†ï¼Œå°±ä¸å†å‘é€ã€‚Aèƒ½é‡ä¼ ï¼Œå°±è¯æ˜Bçš„ç¡®è®¤æ¶ˆæ¯ä¸¢å¤±ï¼‰ã€‚</li><li>ç¡®è®¤è¿Ÿåˆ° ï¼šç¡®è®¤æ¶ˆæ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¿Ÿåˆ°ã€‚Aå‘é€M1æ¶ˆæ¯ï¼ŒBæ”¶åˆ°å¹¶å‘é€ç¡®è®¤ã€‚åœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯ï¼ŒAé‡ä¼ M1æ¶ˆæ¯ï¼ŒBä»ç„¶æ”¶åˆ°å¹¶ç»§ç»­å‘é€ç¡®è®¤æ¶ˆæ¯ï¼ˆBæ”¶åˆ°äº†2ä»½M1ï¼‰ã€‚æ­¤æ—¶Aæ”¶åˆ°äº†Bç¬¬äºŒæ¬¡å‘é€çš„ç¡®è®¤æ¶ˆæ¯ã€‚æ¥ç€å‘é€å…¶ä»–æ•°æ®ã€‚è¿‡äº†ä¸€ä¼šï¼ŒAæ”¶åˆ°äº†Bç¬¬ä¸€æ¬¡å‘é€çš„å¯¹M1çš„ç¡®è®¤æ¶ˆæ¯ï¼ˆAä¹Ÿæ”¶åˆ°äº†2ä»½ç¡®è®¤æ¶ˆæ¯ï¼‰ã€‚å¤„ç†å¦‚ä¸‹ï¼š1. Aæ”¶åˆ°é‡å¤çš„ç¡®è®¤åï¼Œç›´æ¥ä¸¢å¼ƒã€‚2. Bæ”¶åˆ°é‡å¤çš„M1åï¼Œä¹Ÿç›´æ¥ä¸¢å¼ƒé‡å¤çš„M1ã€‚</li></ul></li></ul></li></ul><blockquote><p>è¿ç»­ ARQ åè®®</p></blockquote><p>å¯æé«˜ä¿¡é“åˆ©ç”¨ç‡ã€‚å‘é€æ–¹ç»´æŒä¸€ä¸ªå‘é€çª—å£ï¼Œå‡¡ä½äºå‘é€çª—å£å†…çš„åˆ†ç»„å¯è¿ç»­å‘é€å‡ºå»ï¼Œè€Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹ç¡®è®¤ã€‚æ¥æ”¶æ–¹ä¸€èˆ¬é‡‡ç”¨ç´¯ç§¯ç¡®è®¤ï¼Œä¹Ÿå°±æ˜¯è¯´æ¥å—æ–¹ä¸å¿…å¯¹æ¥æ”¶åˆ°çš„æ¯ä¸€ä¸ªåˆ†ç»„éƒ½è¿›è¡Œç¡®è®¤ï¼Œè€Œæ˜¯å¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åä¸€ä¸ªåˆ†ç»„è¿›è¡Œç¡®è®¤ï¼ˆè¿‡ä¸€æ®µæ—¶é—´ç¡®è®¤ä¸€æ¬¡ï¼Œå‘é€æ–¹å…¶å®æ˜¯æŒ‰ç…§é¡ºåºå‘é€çš„ï¼Œå¯èƒ½ç”±äºç½‘ç»œåŸå› ï¼ŒåŒ…åˆ°è¾¾çš„é¡ºåºä¸ä¸€è‡´ï¼‰ï¼Œè€Œå‘é€æ–¹æ¯æ¥æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œçª—å£å°±å‘å‰æ»‘åŠ¨ä¸€å®šè·ç¦»ã€‚</p><ul><li>ä¼˜ç¼ºç‚¹ï¼š<ul><li>ä¼˜ç‚¹ï¼š ä¿¡é“åˆ©ç”¨ç‡é«˜ï¼Œå®¹æ˜“å®ç°ï¼Œå³ä½¿ç¡®è®¤ä¸¢å¤±ï¼Œä¹Ÿä¸å¿…é‡ä¼ ã€‚</li><li>ç¼ºç‚¹ï¼š ä¸èƒ½å‘å‘é€æ–¹åæ˜ å‡ºæ¥æ”¶æ–¹å·²ç»æ­£ç¡®æ”¶åˆ°çš„æ‰€æœ‰åˆ†ç»„çš„ä¿¡æ¯ã€‚ æ¯”å¦‚ï¼šå‘é€æ–¹å‘é€äº† 5æ¡ æ¶ˆæ¯ï¼Œä¸­é—´ç¬¬ä¸‰æ¡ä¸¢å¤±ï¼ˆ3å·ï¼‰ï¼Œè¿™æ—¶æ¥æ”¶æ–¹åªèƒ½å¯¹å‰ä¸¤ä¸ªå‘é€ç¡®è®¤ã€‚å‘é€æ–¹æ— æ³•çŸ¥é“åä¸‰ä¸ªåˆ†ç»„çš„ä¸‹è½ï¼Œè€Œåªå¥½æŠŠåä¸‰ä¸ªå…¨éƒ¨é‡ä¼ ä¸€æ¬¡ã€‚è¿™ä¹Ÿå« Go-Back-Nï¼ˆå›é€€ Nï¼‰ï¼Œè¡¨ç¤ºéœ€è¦é€€å›æ¥é‡ä¼ å·²ç»å‘é€è¿‡çš„ N ä¸ªæ¶ˆæ¯ã€‚</li></ul></li></ul><h2 id="5-åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€-â€”-gt-æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹"><a href="#5-åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€-â€”-gt-æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹" class="headerlink" title="5. åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€ â€”&gt; æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹"></a>5. åœ¨æµè§ˆå™¨ä¸­è¾“å…¥urlåœ°å€ â€”&gt; æ˜¾ç¤ºä¸»é¡µçš„è¿‡ç¨‹</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_11_network.png"></p><blockquote><p>ä¸Šå›¾æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œè¯·æ³¨æ„ï¼Œæ˜¯OSPFä¸æ˜¯OPSFã€‚ </p><p>OSPFï¼ˆOpen Shortest Path Fitstï¼‰å¼€æ”¾æœ€çŸ­è·¯å¾„ä¼˜å…ˆåè®®,æ˜¯ç”±Internetå·¥ç¨‹ä»»åŠ¡ç»„å¼€å‘çš„è·¯ç”±é€‰æ‹©åè®®</p></blockquote><p>æ€»ä½“æ¥è¯´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªè¿‡ç¨‹:</p><ol><li><p><strong>DNSè§£æ</strong></p><blockquote><p>åŸŸåè§£é‡Šï¼š<a href="http://www.baidu.com/">www.baidu.com</a>.</p></blockquote><ul><li>ä»¥æœ€å³è¾¹è‹±æ–‡.å¼€å§‹ï¼Œç§°ä¸ºåŸŸåçš„æ ¹ï¼šæ³¨æ„æœ€åä¸€ä¸ªcomçš„åé¢æœ‰ç‚¹è¿™ä¸ªå°±æ˜¯æ ¹ï¼Œå®é™…ç”¨çš„æ—¶å€™æœ€ååŠ ä¸åŠ ç‚¹éƒ½è¡Œ</li><li>.ä¸‹é¢è¿™ä¸ªåç§°å°±ä¸ºé¡¶çº§åŸŸåï¼Œä»£è¡¨æœåŠ¡å™¨/ç½‘ç«™çš„æ€§è´¨ï¼š<ul><li>comï¼ˆå•†ä¸šæ€§è´¨ï¼‰ </li><li>eduï¼ˆæ•™è‚²æ€§è´¨ï¼‰ </li><li>netï¼ˆæä¾›ä¿¡æ¯ï¼‰</li><li>cnï¼ˆä¸­å›½ï¼‰ </li><li>orgï¼ˆç»„ç»‡ï¼‰ </li><li>govï¼ˆæ”¿åºœéƒ¨é—¨ï¼‰</li></ul></li><li>äºŒçº§åŸŸåï¼šè‡ªå·±ç”³è¯·ï¼Œæ¯”å¦‚baidu   å®Œå…¨é™å®šåŸŸåï¼šFQDNï¼Œæ¯”å¦‚<a href="http://www.baidu.com/">www.baidu.com</a>ï¼ˆåé¢çš„<a href="http://baidu.com/">baidu.com</a>å·²ç»å…¨çƒå”¯ä¸€ï¼‰</li><li>ä¸‰çº§åŸŸåï¼š<a href="http://kkk.baidu.com/">kkk.baidu.com</a>çš„kkkå°±æ˜¯ç¬¬ä¸‰çº§ï¼Œä¹Ÿå¯ä»¥å››çº§äº”çº§ã€‚ä¸€èˆ¬ç½‘ç«™ä¹ æƒ¯ç”¨wwwï¼Œä¹Ÿæœ‰<a href="http://mail.baidu.com/">mail.baidu.com</a>,ä¹Ÿå¯ä»¥<a href="http://wwww.baidu.com/">wwww.baidu.com</a>ä»£è¡¨ä¸€ä¸ªåŸŸåä¸‹çš„ä¸åŒæœåŠ¡å™¨ï¼Œåªè¦å¯¹åº”çš„IPé…æ­£ç¡®å°±å¯ä»¥  è°·æ­Œå…¬å¸çš„DNSæœåŠ¡å™¨0.0.0.0 ç”µä¿¡å…¬å¸çš„DNSæœåŠ¡å™¨222.222.222.222ï¼‰</li></ul><blockquote><p>å®¢æˆ·ç«¯æµè§ˆå™¨é€šè¿‡DNSè§£æåˆ°åŸŸåçš„IPåœ°å€ã€‚</p></blockquote><p>åŸŸåè§£æçš„è¿‡ç¨‹ï¼š</p><ul><li><p>è¿­ä»£æŸ¥è¯¢ï¼š</p><p>é¦–å…ˆåœ¨æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸­æŸ¥è¯¢IPåœ°å€ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œæœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨å‘é€è¯·æ±‚, æ ¹DNSæœåŠ¡å™¨ï¼Œä¸è´Ÿè´£å…·ä½“çš„åŸŸåè§£æï¼Œä½†æ˜¯ä»–çŸ¥é“è´Ÿè´£è§£æé¡¶çº§åŸŸåçš„æœåŠ¡å™¨IPï¼ˆçŸ¥é“å“ªä¸ªDNSæœåŠ¡å™¨è´Ÿè´£å“ªä¸€å—çš„åŸŸåè§£æï¼‰ï¼Œä¼šè¿”å›è¿™ä¸ªIPã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ªIPåï¼Œè”ç³»è´Ÿè´£è§£æè¯¥é¡¶çº§åŸŸåçš„æœåŠ¡å™¨ï¼Œè¿™ä¸ªé¡¶çº§åŸŸåçš„æœåŠ¡å™¨å¦‚æœè‡ªå·±æ— æ³•è§£æå°±æ‰¾ç®¡ç†è¿™ä¸ªäºŒçº§åŸŸåè§£æçš„æœåŠ¡å™¨IPåœ°å€ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œç„¶åæœ¬åœ°åŸŸåæœåŠ¡å™¨å°±å»è”ç³»è¿™ä¸ªæœåŠ¡å™¨ç›´åˆ°è§£ææˆåŠŸä¸ºæ­¢ï¼Œå¹¶æŠŠè¿™ä¸ªIPç¼“å­˜åˆ°æœ¬åœ°ï¼Œä¾›ä¸‹æ¬¡æŸ¥è¯¢ä½¿ç”¨ã€‚</p></li><li><p>è½¬å‘æŸ¥è¯¢ï¼šï¼ˆé€’å½’ï¼‰</p><p>DNS æœåŠ¡å™¨å¯ä½¿ç”¨å…¶è‡ªèº«çš„èµ„æºè®°å½•ä¿¡æ¯ç¼“å­˜æ¥åº”ç­”æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»£è¡¨è¯·æ±‚å®¢æˆ·æœºæ¥æŸ¥è¯¢æˆ–è”ç³»å…¶ä»– DNS æœåŠ¡å™¨ï¼Œä»¥å®Œå…¨è§£æè¯¥åç§°ï¼Œå¹¶éšåå°†åº”ç­”è¿”å›è‡³å®¢æˆ·æœºã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé€’å½’ã€‚</p><p>è‹¥æœ‰å¤šä¸ªåˆé€‚çš„æœåŠ¡å™¨ï¼ŒDNSæœåŠ¡å™¨å¯ä»¥è¿”å›ä¸€ä¸ªè·Ÿç”¨æˆ·æœ€æ¥è¿‘çš„ç‚¹çš„IPåœ°å€ç»™ç”¨æˆ·ã€‚ï¼ˆDNSè´Ÿè½½å‡è¡¡ï¼‰</p></li></ul></li><li><p><strong>å»ºç«‹TCPè¿æ¥</strong></p><p>åœ¨æ‹¿åˆ°åŸŸåå¯¹åº”çš„IPåœ°å€åï¼Œä¼šä»¥éšæœºç«¯å£ï¼ˆ1024~~65535ï¼‰å‘WEBæœåŠ¡å™¨ç¨‹åº80ç«¯å£å‘èµ·TCPçš„è¿æ¥è¯·æ±‚ï¼Œå¯¹äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„TCPé“¾æ¥ï¼Œå¿…ç„¶è¦è¯´çš„å°±æ˜¯ä¸‰æ¬¡æ¡æ‰‹ã€‚</p></li><li><p><strong>æµè§ˆå™¨å‘WEBæœåŠ¡å™¨å‘èµ·Httpè¯·æ±‚</strong></p><p>å»ºç«‹TCPè¿æ¥ä¹‹åï¼Œå‘èµ·HTTPè¯·æ±‚çš„è¿‡ç¨‹å°±æ˜¯æ„å»ºHTTPè¯·æ±‚æŠ¥æ–‡å¹¶é€šè¿‡TCPåè®®å‘é€åˆ°æœåŠ¡å™¨æŒ‡å®šç«¯å£ï¼ˆHTTP80ç«¯å£ï¼‰</p><ul><li><strong>ä¼ è¾“å±‚</strong> æŠŠHTTPä¼šè¯è¯·æ±‚åˆ†æˆæŠ¥æ–‡æ®µï¼Œæ·»åŠ æºå’Œç›®çš„ç«¯å£ï¼Œå¦‚æœåŠ¡å™¨ä½¿ç”¨80ç«¯å£ç›‘å¬å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯ç”±ç³»ç»Ÿéšæœºé€‰æ‹©ä¸€ä¸ªç«¯å£å¦‚5000ï¼Œä¸æœåŠ¡å™¨è¿›è¡Œäº¤æ¢ï¼ŒæœåŠ¡å™¨æŠŠç›¸åº”çš„è¯·æ±‚è¿”å›ç»™å®¢æˆ·ç«¯çš„5000ç«¯å£ã€‚ </li><li><strong>ç½‘ç»œå±‚ï¼š</strong>æ·»åŠ æºIPå’Œç›®æ ‡IPã€‚ </li><li><strong>é“¾è·¯å±‚ï¼š</strong>å®¢æˆ·ç«¯çš„é“¾è·¯å±‚ï¼Œå‘é€ARPè¯·æ±‚æŸ¥æ‰¾ä¸‹ä¸€è·³MACï¼Œè·¨ç½‘æ®µæ˜¯ç½‘å…³çš„MAC</li><li>HTTPè¯·æ±‚æŠ¥æ–‡ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š<ul><li>è¯·æ±‚è¡Œï¼ˆ å¸¸ç”¨çš„æ–¹æ³•æœ‰: GET, POST, PUT, DELETE, OPTIONS, HEADï¼‰</li><li>è¯·æ±‚å¤´ï¼ˆ HTTPè¯·æ±‚å¤´ä¸­å¯ä»¥çœ‹åˆ°å½“å‰è¯·æ±‚æ”¯æŒçš„è¯­è¨€ï¼Œå‹ç¼©æ ¼å¼ï¼Œç¼–ç æ ¼å¼ä»¥åŠä½•ç§ç±»å‹çš„è¿”å›æ–‡ä»¶ï¼ŒConnectionä»¥åŠCookieï¼ŒContent-Typeç­‰ä¿¡æ¯ï¼‰</li><li>è¯·æ±‚æ­£æ–‡ï¼ˆ å½“ä½¿ç”¨POST, PUTç­‰æ–¹æ³•æ—¶ï¼Œé€šå¸¸éœ€è¦å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€’æ•°æ®ã€‚è¿™äº›æ•°æ®å°±å‚¨å­˜åœ¨è¯·æ±‚æ­£æ–‡ä¸­ï¼‰ã€‚</li></ul></li></ul></li><li><p><strong>æœåŠ¡å™¨ç«¯å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡</strong></p><ul><li><p>æœåŠ¡å™¨ç«¯æ”¶åˆ°è¯·æ±‚åçš„ç”±webæœåŠ¡å™¨ï¼ˆå¦‚ Tomcatï¼‰å¤„ç†è¯·æ±‚ã€‚webæœåŠ¡å™¨è§£æç”¨æˆ·è¯·æ±‚ï¼ŒçŸ¥é“äº†éœ€è¦è°ƒåº¦å“ªäº›èµ„æºæ–‡ä»¶ï¼Œå†é€šè¿‡ç›¸åº”çš„è¿™äº›èµ„æºæ–‡ä»¶å¤„ç†ç”¨æˆ·è¯·æ±‚å’Œå‚æ•°ï¼Œå¹¶è°ƒç”¨æ•°æ®åº“ä¿¡æ¯ï¼Œæœ€åå°†ç»“æœé€šè¿‡webæœåŠ¡å™¨è¿”å›ç»™æµè§ˆå™¨å®¢æˆ·ç«¯ã€‚</p></li><li><p>HTTPå“åº”æŠ¥æ–‡ä¹Ÿæ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆ: </p><ul><li>çŠ¶æ€ç ï¼ˆ<a href="7. å¸¸è§HTTPçŠ¶æ€ç ">å¦‚ä¸‹è¿°é—®é¢˜</a>ï¼‰</li><li>å“åº”æŠ¥å¤´</li><li>å“åº”æŠ¥æ–‡ï¼ˆ æœåŠ¡å™¨è¿”å›ç»™æµè§ˆå™¨çš„æ–‡æœ¬ä¿¡æ¯ï¼Œé€šå¸¸HTML, CSS, JS, å›¾ç‰‡ç­‰æ–‡ä»¶å°±æ”¾åœ¨è¿™ä¸€éƒ¨åˆ†ï¼‰ã€‚</li></ul></li></ul></li><li><p><strong>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</strong></p><p>æµè§ˆå™¨æ˜¯ä¸€ä¸ªè¾¹è§£æè¾¹æ¸²æŸ“çš„è¿‡ç¨‹ã€‚é¦–å…ˆæµè§ˆå™¨è§£æHTMLæ–‡ä»¶æ„å»ºDOMæ ‘ï¼Œç„¶åè§£æCSSæ–‡ä»¶æ„å»ºæ¸²æŸ“æ ‘ï¼Œç­‰åˆ°æ¸²æŸ“æ ‘æ„å»ºå®Œæˆåï¼Œæµè§ˆå™¨å¼€å§‹å¸ƒå±€æ¸²æŸ“æ ‘å¹¶å°†å…¶ç»˜åˆ¶åˆ°å±å¹•ä¸Šã€‚</p></li></ol><ol start="6"><li><p><strong>å…³é—­TCPé“¾æ¥</strong></p><p>å››æ¬¡æŒ¥æ‰‹</p></li></ol><h2 id="6-Getå’ŒPoståŒºåˆ«"><a href="#6-Getå’ŒPoståŒºåˆ«" class="headerlink" title="6. Getå’ŒPoståŒºåˆ«"></a>6. Getå’ŒPoståŒºåˆ«</h2><ul><li><p>Getä¸€èˆ¬æ˜¯ä»æœåŠ¡å™¨ä¸Šè¯·æ±‚æ•°æ®ï¼ŒPostä¸€èˆ¬æ˜¯å‘æœåŠ¡å™¨ä¼ é€æ•°æ®ã€‚</p></li><li><p>GETè¯·æ±‚ä¹Ÿå¯ä¼ å‚åˆ°åå°ï¼Œä½†æ˜¯å…¶å‚æ•°åœ¨æµè§ˆå™¨çš„åœ°å€æ çš„urlä¸­å¯è§ï¼Œæ‰€ä»¥éšç§æ€§å®‰å…¨æ€§è¾ƒå·®ï¼Œä¸”å‚æ•°é•¿åº¦ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ã€‚ POSTè¯·æ±‚ä¼ é€’å‚æ•°æ”¾åœ¨Request bodyä¸­ï¼Œä¸ä¼šåœ¨urlä¸­æ˜¾ç¤ºï¼Œæ¯”GETè¦å®‰å…¨ï¼Œä¸”å‚æ•°é•¿åº¦æ— é™åˆ¶ã€‚</p></li><li><p>GETè¯·æ±‚åˆ·æ–°æµè§ˆå™¨æˆ–å›é€€æ—¶æ²¡æœ‰å½±å“ï¼ŒPOSTå›é€€æ—¶ä¼šé‡æ–°æäº¤æ•°æ®è¯·æ±‚ã€‚</p></li><li><p>GET è¯·æ±‚å¯è¢«æµè§ˆå™¨ä¸»åŠ¨ç¼“å­˜ï¼Œ POST è¯·æ±‚ä¸ä¼šé™¤éæ‰‹åŠ¨è®¾ç½®  GET è¯·æ±‚ä¿ç•™åœ¨æµè§ˆå™¨å†å²è®°å½•ä¸­ï¼Œ å¯è¢«æ”¶è—ä¸ºä¹¦ç­¾ï¼› POST è¯·æ±‚ä¸ä¼šä¿ç•™åœ¨æµè§ˆå™¨å†å²è®°å½•ä¸­ï¼Œ  POST ä¸èƒ½è¢«æ”¶è—ä¸ºä¹¦ç­¾</p></li><li><p>GET åªæ¥å—ASCIIå­—ç¬¦ï¼Œ  POSTæ”¯æŒå¤šç§ç¼–ç æ–¹å¼</p></li><li><p>GETäº§ç”Ÿä¸€ä¸ªTCPæ•°æ®åŒ…ï¼Œ æµè§ˆå™¨ä¼šæŠŠhttp headerå’Œdataä¸€å¹¶å‘é€å‡ºå»ï¼ŒæœåŠ¡å™¨å“åº”200ï¼ˆè¿”å›æ•°æ®ï¼‰ï¼›POSTäº§ç”Ÿä¸¤ä¸ªTCPæ•°æ®åŒ…ï¼Œ æµè§ˆå™¨å…ˆå‘é€headerï¼ŒæœåŠ¡å™¨å“åº”100 continueï¼Œæµè§ˆå™¨å†å‘é€dataï¼ŒæœåŠ¡å™¨å“åº”200 okï¼ˆè¿”å›æ•°æ®ï¼‰ï¼ˆ å¹¶ä¸æ˜¯æ‰€æœ‰æµè§ˆå™¨éƒ½ä¼šåœ¨POSTä¸­å‘é€ä¸¤æ¬¡åŒ…ï¼ŒFirefoxå°±åªå‘é€ä¸€æ¬¡ï¼‰ã€‚</p></li></ul><blockquote><p>HTTPæ˜¯åŸºäºTCP/IPçš„å…³äºæ•°æ®å¦‚ä½•åœ¨ä¸‡ç»´ç½‘ä¸­å¦‚ä½•é€šä¿¡çš„åè®®ï¼Œ HTTPçš„åº•å±‚æ˜¯TCP/IPã€‚æ‰€ä»¥GETå’ŒPOSTçš„åº•å±‚ä¹Ÿæ˜¯TCP/IPï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒGET/POSTéƒ½æ˜¯TCPé“¾æ¥ã€‚</p></blockquote><h2 id="7-å¸¸è§HTTPçŠ¶æ€ç "><a href="#7-å¸¸è§HTTPçŠ¶æ€ç " class="headerlink" title="7. å¸¸è§HTTPçŠ¶æ€ç "></a>7. å¸¸è§HTTPçŠ¶æ€ç </h2><p>1xxï¼šè¡¨ç¤ºé€šçŸ¥ä¿¡æ¯ï¼Œä¾‹å¦‚è¡¨ç¤ºæ”¶åˆ°æˆ–è€…æ˜¯æ­£åœ¨å¤„ç†ï¼ˆä¸´æ—¶å“åº”ï¼‰</p><p>2xxï¼šè¡¨ç¤ºæˆåŠŸï¼Œä¾‹å¦‚è¡¨ç¤ºæ¥å—æˆ–çŸ¥é“äº†</p><p>3xxï¼šè¡¨ç¤ºé‡å®šå‘ï¼Œä¾‹å¦‚è¡¨ç¤ºå®Œæˆè¯·æ±‚è¿˜éœ€è¦é‡‡å–è¿›ä¸€æ­¥çš„è¡ŒåŠ¨</p><p>4xxï¼šè¡¨ç¤ºå®¢æˆ·ç«¯çš„å·®é”™ï¼Œä¾‹å¦‚è¡¨ç¤ºè¯·æ±‚ä¸­æœ‰è¯­æ³•é”™è¯¯æˆ–ä¸èƒ½å®Œæˆ</p><p>5xxï¼šè¡¨ç¤ºæœåŠ¡å™¨ç«¯çš„å·®é”™ï¼šä¾‹å¦‚è¡¨ç¤ºæœåŠ¡å™¨å¤±æ•ˆæ— æ³•å®Œæˆè¯·æ±‚</p><h2 id="8-HTTPåè®®å’Œå„ç§åè®®çš„å…³ç³»"><a href="#8-HTTPåè®®å’Œå„ç§åè®®çš„å…³ç³»" class="headerlink" title="8. HTTPåè®®å’Œå„ç§åè®®çš„å…³ç³»"></a>8. HTTPåè®®å’Œå„ç§åè®®çš„å…³ç³»</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_12_network.png"></p><h2 id="9-HTTPé•¿è¿æ¥-çŸ­è¿æ¥"><a href="#9-HTTPé•¿è¿æ¥-çŸ­è¿æ¥" class="headerlink" title="9. HTTPé•¿è¿æ¥,çŸ­è¿æ¥"></a>9. HTTPé•¿è¿æ¥,çŸ­è¿æ¥</h2><p><a href="https://www.cnblogs.com/gotodsp/p/6366163.html">ã€ŠHTTPé•¿è¿æ¥ã€çŸ­è¿æ¥ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿã€‹</a><sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://www.cnblogs.com/gotodsp/p/6366163.html">[3]</span></a></sup></p><p>åœ¨HTTP/1.0ä¸­é»˜è®¤ä½¿ç”¨çŸ­è¿æ¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ¯è¿›è¡Œä¸€æ¬¡HTTPæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä»»åŠ¡ç»“æŸå°±ä¸­æ–­è¿æ¥ã€‚å½“å®¢æˆ·ç«¯æµè§ˆå™¨è®¿é—®çš„æŸä¸ªHTMLæˆ–å…¶ä»–ç±»å‹çš„Webé¡µä¸­åŒ…å«æœ‰å…¶ä»–çš„Webèµ„æºï¼ˆå¦‚JavaScriptæ–‡ä»¶ã€å›¾åƒæ–‡ä»¶ã€CSSæ–‡ä»¶ç­‰ï¼‰ï¼Œæ¯é‡åˆ°è¿™æ ·ä¸€ä¸ªWebèµ„æºï¼Œæµè§ˆå™¨å°±ä¼šé‡æ–°å»ºç«‹ä¸€ä¸ªHTTPä¼šè¯ã€‚</p><p>è€Œä»HTTP/1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œç”¨ä»¥ä¿æŒè¿æ¥ç‰¹æ€§ã€‚ä½¿ç”¨é•¿è¿æ¥çš„HTTPåè®®ï¼Œä¼šåœ¨å“åº”å¤´åŠ å…¥è¿™è¡Œä»£ç ï¼š</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">Connection:</span><span class="hljs-meta">keep</span>-alive<br></code></pre></td></tr></table></figure><p>åœ¨ä½¿ç”¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ç”¨äºä¼ è¾“HTTPæ•°æ®çš„TCPè¿æ¥ä¸ä¼šå…³é—­ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨æ—¶ï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ã€‚Keep-Aliveä¸ä¼šæ°¸ä¹…ä¿æŒè¿æ¥ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿æŒæ—¶é—´ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æœåŠ¡å™¨è½¯ä»¶ï¼ˆå¦‚Apacheï¼‰ä¸­è®¾å®šè¿™ä¸ªæ—¶é—´ã€‚å®ç°é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒé•¿è¿æ¥ã€‚</p><blockquote><p>HTTPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯TCPåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚</p></blockquote><p>é•¿è¿æ¥å¯ä»¥çœå»è¾ƒå¤šçš„TCPå»ºç«‹å’Œå…³é—­çš„æ“ä½œï¼Œå‡å°‘æµªè´¹ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚ åœ¨é•¿è¿æ¥çš„åº”ç”¨åœºæ™¯ä¸‹ï¼Œclientç«¯ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å…³é—­å®ƒä»¬ä¹‹é—´çš„è¿æ¥ï¼ŒClientä¸serverä¹‹é—´çš„è¿æ¥å¦‚æœä¸€ç›´ä¸å…³é—­çš„è¯ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œéšç€å®¢æˆ·ç«¯è¿æ¥è¶Šæ¥è¶Šå¤šï¼Œserveræ—©æ™šæœ‰æ‰›ä¸ä½çš„æ—¶å€™ï¼Œè¿™æ—¶å€™serverç«¯éœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥ï¼Œå¦‚å…³é—­ä¸€äº›é•¿æ—¶é—´æ²¡æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿçš„è¿æ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›æ¶æ„è¿æ¥å¯¼è‡´serverç«¯æœåŠ¡å—æŸã€‚ </p><p>çŸ­è¿æ¥å¯¹äºæœåŠ¡å™¨æ¥è¯´ç®¡ç†è¾ƒä¸ºç®€å•ï¼Œå­˜åœ¨çš„è¿æ¥éƒ½æ˜¯æœ‰ç”¨çš„è¿æ¥ï¼Œä¸éœ€è¦é¢å¤–çš„æ§åˆ¶æ‰‹æ®µã€‚ä½†å¦‚æœå®¢æˆ·è¯·æ±‚é¢‘ç¹ï¼Œå°†åœ¨TCPçš„å»ºç«‹å’Œå…³é—­æ“ä½œä¸Šæµªè´¹æ—¶é—´å’Œå¸¦å®½ã€‚</p><ul><li><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><strong>çŸ­é“¾æ¥</strong>ï¼šåƒWEBç½‘ç«™çš„httpæœåŠ¡ä¸€èˆ¬éƒ½ç”¨çŸ­é“¾æ¥</li></ul><p>åŸå› ï¼šé•¿è¿æ¥å¯¹äºæœåŠ¡ç«¯æ¥è¯´ä¼šè€—è´¹ä¸€å®šçš„èµ„æºï¼Œè€ŒåƒWEBç½‘ç«™è¿™ä¹ˆé¢‘ç¹çš„æˆåƒä¸Šä¸‡ç”šè‡³ä¸Šäº¿å®¢æˆ·ç«¯çš„è¿æ¥ç”¨çŸ­è¿æ¥ä¼šæ›´çœä¸€äº›èµ„æºï¼Œå¦‚æœç”¨é•¿è¿æ¥ï¼Œè€Œä¸”åŒæ—¶æœ‰æˆåƒä¸Šä¸‡çš„ç”¨æˆ·ï¼Œå¦‚æœæ¯ä¸ªç”¨æˆ·éƒ½å ç”¨ä¸€ä¸ªè¿æ¥çš„è¯ï¼Œé‚£å¯æƒ³è€ŒçŸ¥å§ã€‚æ‰€ä»¥å¹¶å‘é‡å¤§ï¼Œä½†æ¯ä¸ªç”¨æˆ·æ— éœ€é¢‘ç¹æ“ä½œæƒ…å†µä¸‹éœ€ç”¨çŸ­è¿å¥½ã€‚</p><ul><li><strong>é•¿è¿æ¥</strong>ï¼šå¤šç”¨äºæ“ä½œé¢‘ç¹ï¼Œç‚¹å¯¹ç‚¹çš„é€šè®¯ï¼Œè€Œä¸”è¿æ¥æ•°ä¸èƒ½å¤ªå¤šæƒ…å†µ</li></ul></li></ul><h2 id="10-HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®-å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€-ï¼ˆCookieå’ŒSessionï¼‰"><a href="#10-HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®-å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€-ï¼ˆCookieå’ŒSessionï¼‰" class="headerlink" title="10. HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®,å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€?ï¼ˆCookieå’ŒSessionï¼‰"></a>10. HTTPæ˜¯ä¸ä¿å­˜çŠ¶æ€çš„åè®®,å¦‚ä½•ä¿å­˜ç”¨æˆ·çŠ¶æ€?ï¼ˆCookieå’ŒSessionï¼‰</h2><p>HTTP æ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€ï¼Œå³æ— çŠ¶æ€åè®®ã€‚ä¹Ÿå°±æ˜¯è¯´ HTTP åè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ã€‚ </p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨cookieå’Œsessionæ¥ä¿æŒä¼šè¯çŠ¶æ€ï¼Œ</p><ul><li><p>ä¼šè¯ï¼šä¸€æ¬¡ä¼šè¯ä¸­åŒ…å«å¤šæ¬¡è¯·æ±‚å’Œå“åº”</p></li><li><p>ä¸€æ¬¡ä¼šè¯ï¼šæµè§ˆå™¨ç¬¬ä¸€æ¬¡ç»™æœåŠ¡å™¨èµ„æºå‘é€è¯·æ±‚ï¼Œä¼šè¯å»ºç«‹ï¼Œç›´åˆ°æœ‰ä¸€æ–¹æ–­å¼€ä¸ºæ­¢ã€‚</p></li></ul><blockquote><p>cookieå’ŒsessionåŠŸèƒ½å°±æ˜¯åœ¨ä¸€æ¬¡ä¼šè¯çš„èŒƒå›´å†…çš„å¤šæ¬¡è¯·æ±‚é—´ï¼Œå…±äº«æ•°æ®ã€‚</p></blockquote><ul><li><p>å®¢æˆ·ç«¯ä¼šè¯æŠ€æœ¯ï¼šCookieï¼Œå°†æ•°æ®ä¿å­˜åˆ°å®¢æˆ·ç«¯æµè§ˆå™¨ï¼ˆcookieä¸€èˆ¬ç”¨äºå­˜å‡ºå°‘é‡çš„ä¸å¤ªæ•æ„Ÿçš„æ•°æ®æˆ–æ˜¯åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹ï¼Œå®ŒæˆæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯çš„èº«ä»½è¯†åˆ«ï¼‰ï¼›</p></li><li><p>æœåŠ¡å™¨ç«¯ä¼šè¯æŠ€æœ¯ï¼šSessionï¼Œå°†æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯çš„å¯¹è±¡ä¸­ï¼ŒSessionçš„å®ç°æ˜¯ä¾èµ–äºCookieçš„ã€‚ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°è¯·æ±‚å¤„ç†åå¯ä»¥ç”Ÿæˆä¸€ä¸ªsessionIdï¼Œå¹¶ä¸”å°†sessionIdå­˜å…¥cookieä¸­è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œå°†sessionçš„å†…å®¹å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šã€‚åœ¨ä¸‹ä¸€æ¬¡çš„è¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯å¸¦ç€cookieæ¥è¯·æ±‚æœåŠ¡å™¨ï¼ŒæœåŠ¡ç«¯ä»cookieä¸­å–å‡ºsessionIdï¼Œå®ç°äº†ç”¨æˆ·ä¼šè¯çŠ¶æ€çš„ä¿æŒã€‚è¿™æ ·åšæœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯å°†ä¸€äº›ä¸œè¥¿å­˜åœ¨äº†æœåŠ¡å™¨ä¸Šï¼Œåœ¨ç”¨æˆ·é‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å®¹é‡ä¼šä¸è¶³ã€‚</p></li></ul><p>å®é™…æƒ…å†µä¸­ï¼Œç»å¸¸æ˜¯å°†æ‰€éœ€è¦çš„ä¼šè¯çŠ¶æ€ï¼Œæ¯”å¦‚è¯´ç™»å½•æ€ç›´æ¥å­˜å…¥cookieå¹¶ä¸”è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ç›´æ¥å–å‡ºcookieä¸­çš„ä¿¡æ¯å’Œå‚æ•°ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œä¿æŒHTTPä¼šè¯çŠ¶æ€ã€‚</p><p>åœ¨æœåŠ¡ç«¯ä¿å­˜ Session çš„æ–¹æ³•å¾ˆå¤šï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯å†…å­˜å’Œæ•°æ®åº“(æ¯”å¦‚æ˜¯ä½¿ç”¨å†…å­˜æ•°æ®åº“redisä¿å­˜)ã€‚</p><blockquote><p>Cookie è¢«ç¦ç”¨æ€ä¹ˆåŠ?</p></blockquote><p>æœ€å¸¸ç”¨çš„å°±æ˜¯åˆ©ç”¨ URL é‡å†™æŠŠ Session ID ç›´æ¥é™„åŠ åœ¨URLè·¯å¾„çš„åé¢ã€‚</p><p>å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒCookieæˆ–ç”¨æˆ·é˜»æ­¢äº†æ‰€æœ‰Cookieï¼Œå¯ä»¥æŠŠä¼šè¯IDé™„åŠ åœ¨HTMLé¡µé¢ä¸­æ‰€æœ‰çš„URLä¸Šï¼Œè¿™äº›é¡µé¢ä½œä¸ºå“åº”å‘é€ç»™å®¢æˆ·ã€‚è¿™æ ·ï¼Œå½“ç”¨æˆ·å•å‡»URLæ—¶ï¼Œä¼šè¯IDè¢«è‡ªåŠ¨ä½œä¸ºè¯·æ±‚è¡Œçš„ä¸€éƒ¨åˆ†è€Œä¸æ˜¯ä½œä¸ºå¤´è¡Œå‘é€å›æœåŠ¡å™¨ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºURLé‡å†™(URL rewriting)ã€‚</p><p>å‚è€ƒå›ç­”ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/cs_13_network.png"></p><h2 id="11-Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ-å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#11-Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ-å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="11. Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>11. Cookieçš„ä½œç”¨æ˜¯ä»€ä¹ˆ?å’ŒSessionæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>Cookie æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯(æµè§ˆå™¨ç«¯)ï¼ŒSession æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ã€‚</p><p>Sessionæ²¡æœ‰æ•°æ®å¤§å°é™åˆ¶ï¼ŒCookieæœ‰ã€‚</p><p>ç›¸å¯¹ Cookie æ¥è¯´ Session å®‰å…¨æ€§æ›´é«˜ã€‚å¦‚æœè¦åœ¨ Cookie ä¸­å­˜å‚¨ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œä¸è¦ç›´æ¥å†™å…¥ Cookie ä¸­ï¼Œæœ€å¥½èƒ½å°† Cookie ä¿¡æ¯åŠ å¯†ç„¶åä½¿ç”¨åˆ°çš„æ—¶å€™å†å»æœåŠ¡å™¨ç«¯è§£å¯†ã€‚</p><h2 id="12-HTTP-1-0å’ŒHTTP-1-1çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#12-HTTP-1-0å’ŒHTTP-1-1çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="12. HTTP 1.0å’ŒHTTP 1.1çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>12. HTTP 1.0å’ŒHTTP 1.1çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><ol><li>åœ¨HTTP/1.0ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥ï¼ŒHTTP 1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ã€‚ </li><li><strong>é”™è¯¯çŠ¶æ€å“åº”ç </strong> :åœ¨HTTP1.1ä¸­æ–°å¢äº†24ä¸ªé”™è¯¯çŠ¶æ€å“åº”ç ï¼Œå¦‚409ï¼ˆConflictï¼‰è¡¨ç¤ºè¯·æ±‚çš„èµ„æºä¸èµ„æºçš„å½“å‰çŠ¶æ€å‘ç”Ÿå†²çªï¼›410ï¼ˆGoneï¼‰è¡¨ç¤ºæœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºè¢«æ°¸ä¹…æ€§çš„åˆ é™¤ã€‚</li><li><strong>ç¼“å­˜å¤„ç†</strong> :åœ¨HTTP1.0ä¸­ä¸»è¦ä½¿ç”¨headeré‡Œçš„If-Modified-Since,Expiresæ¥åšä¸ºç¼“å­˜åˆ¤æ–­çš„æ ‡å‡†ï¼ŒHTTP1.1åˆ™å¼•å…¥äº†æ›´å¤šçš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ä¾‹å¦‚Entity tagï¼ŒIf-Unmodified-Since, If-Match, If-None-Matchç­‰æ›´å¤šå¯ä¾›é€‰æ‹©çš„ç¼“å­˜å¤´æ¥æ§åˆ¶ç¼“å­˜ç­–ç•¥ã€‚</li><li><strong>å¸¦å®½ä¼˜åŒ–åŠç½‘ç»œè¿æ¥çš„ä½¿ç”¨</strong> :HTTP1.0ä¸­ï¼Œå­˜åœ¨ä¸€äº›æµªè´¹å¸¦å®½çš„ç°è±¡ï¼Œä¾‹å¦‚å®¢æˆ·ç«¯åªæ˜¯éœ€è¦æŸä¸ªå¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒæœåŠ¡å™¨å´å°†æ•´ä¸ªå¯¹è±¡é€è¿‡æ¥äº†ï¼Œå¹¶ä¸”ä¸æ”¯æŒæ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼ŒHTTP1.1åˆ™åœ¨è¯·æ±‚å¤´å¼•å…¥äº†rangeå¤´åŸŸï¼Œå®ƒå…è®¸åªè¯·æ±‚èµ„æºçš„æŸä¸ªéƒ¨åˆ†ï¼Œå³è¿”å›ç æ˜¯206ï¼ˆPartial Contentï¼‰ï¼Œè¿™æ ·å°±æ–¹ä¾¿äº†å¼€å‘è€…è‡ªç”±çš„é€‰æ‹©ä»¥ä¾¿äºå……åˆ†åˆ©ç”¨å¸¦å®½å’Œè¿æ¥ã€‚</li></ol><h2 id="13-URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ"><a href="#13-URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ" class="headerlink" title="13. URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?"></a>13. URIå’ŒURLçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h2><ul><li>URI(Uniform Resource Identifier) æ˜¯ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦ï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€ä¸ªèµ„æºã€‚ URIå°±æ˜¯åœ¨æŸä¸€è§„åˆ™ä¸‹èƒ½æŠŠä¸€ä¸ªèµ„æºç‹¬ä¸€æ— äºŒåœ°æ ‡è¯†å‡ºæ¥ã€‚å¦‚ï¼šèº«ä»½è¯</li><li>URL(Uniform Resource Location) æ˜¯ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼Œå¯ä»¥æä¾›è¯¥èµ„æºçš„è·¯å¾„ã€‚å®ƒæ˜¯ä¸€ç§å…·ä½“çš„ URIï¼Œå³ URLå°±æ˜¯ç”¨å®šä½çš„æ–¹å¼å®ç°çš„URIã€‚ å¯è®¤ä¸ºç”±4éƒ¨åˆ†ç»„æˆï¼šåè®®ã€ä¸»æœºã€ç«¯å£ã€è·¯å¾„   http:localhost:8080/index.jsp ( å¯¹äºç°åœ¨ç½‘å€æˆ‘æ›´å€¾å‘äºå«å®ƒURLï¼Œæ¯•ç«Ÿå®ƒæä¾›äº†èµ„æºçš„ä½ç½®ä¿¡æ¯)  å¦‚ï¼šå…·ä½“ä½å€</li></ul><p>â€‹    URLæ˜¯ä¸€ç§å…·ä½“çš„URIï¼Œå®ƒä¸ä»…å”¯ä¸€æ ‡è¯†èµ„æºï¼Œè€Œä¸”è¿˜æä¾›äº†å®šä½è¯¥èµ„æºçš„ä¿¡æ¯ã€‚</p><h2 id="14-HTTP-å’Œ-HTTPS-çš„åŒºåˆ«ï¼Ÿ"><a href="#14-HTTP-å’Œ-HTTPS-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="14. HTTP å’Œ HTTPS çš„åŒºåˆ«ï¼Ÿ"></a>14. HTTP å’Œ HTTPS çš„åŒºåˆ«ï¼Ÿ</h2><ol><li>ç«¯å£ ï¼šHTTPçš„URLç”±â€œhttp://â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£80ï¼Œè€ŒHTTPSçš„URLç”±â€œhttps://â€èµ·å§‹ä¸”é»˜è®¤ä½¿ç”¨ç«¯å£443ã€‚</li><li>å®‰å…¨æ€§å’Œèµ„æºæ¶ˆè€—ï¼š <ul><li>HTTPåè®®è¿è¡Œåœ¨TCPä¹‹ä¸Šï¼Œæ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½æ˜¯æ˜æ–‡ã€‚  </li><li>HTTPSæ˜¯è¿è¡Œåœ¨SSL/TLSä¹‹ä¸Šçš„HTTPåè®®ï¼ŒSSL/TLS è¿è¡Œåœ¨TCPä¹‹ä¸Šã€‚ï¼ˆ HTTPSåè®®åœ¨HTTPçš„åŸºç¡€ä¸ŠåŠ å…¥äº†SSLï¼ˆå®‰å…¨å¥—æ¥å­—å±‚ï¼‰åè®®ï¼ŒSSLé€æ¸æ¼”å˜ä¸ºäº†TLSåè®®ï¼Œä½†æ˜¯ä¸šç•Œä¹ æƒ¯ä»ç„¶ç§°å…¶ä¸ºSSLåè®®ã€‚ï¼‰æ‰€æœ‰ä¼ è¾“çš„å†…å®¹éƒ½ç»è¿‡åŠ å¯†ï¼ŒåŠ å¯†é‡‡ç”¨å¯¹ç§°åŠ å¯†ï¼Œä½†å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”¨æœåŠ¡å™¨æ–¹çš„è¯ä¹¦è¿›è¡Œäº†éå¯¹ç§°åŠ å¯†ã€‚æ‰€ä»¥è¯´ï¼ŒHTTP å®‰å…¨æ€§æ²¡æœ‰ HTTPSé«˜ï¼Œä½†æ˜¯ HTTPS æ¯”HTTPè€—è´¹æ›´å¤šæœåŠ¡å™¨èµ„æºã€‚</li></ul></li></ol><ul><li>å¯¹ç§°åŠ å¯†ï¼šå¯†é’¥åªæœ‰ä¸€ä¸ªï¼ŒåŠ å¯†è§£å¯†ä¸ºåŒä¸€ä¸ªå¯†ç ï¼Œä¸”åŠ è§£å¯†é€Ÿåº¦å¿«ï¼›</li><li>éå¯¹ç§°åŠ å¯†ï¼šå¯†é’¥æˆå¯¹å‡ºç°ï¼ˆä¸”æ ¹æ®å…¬é’¥æ— æ³•æ¨çŸ¥ç§é’¥ï¼Œæ ¹æ®ç§é’¥ä¹Ÿæ— æ³•æ¨çŸ¥å…¬é’¥ï¼‰ï¼ŒåŠ å¯†è§£å¯†ä½¿ç”¨ä¸åŒå¯†é’¥ï¼ˆå…¬é’¥åŠ å¯†éœ€è¦ç§é’¥è§£å¯†ï¼Œç§é’¥åŠ å¯†éœ€è¦å…¬é’¥è§£å¯†ï¼‰ï¼Œç›¸å¯¹å¯¹ç§°åŠ å¯†é€Ÿåº¦è¾ƒæ…¢ã€‚</li></ul><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://app.yinxiang.com/fx/4ed295dd-ff19-4200-b401-47bdd265d0f8">https://app.yinxiang.com/fx/4ed295dd-ff19-4200-b401-47bdd265d0f8</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span>JavaGuideé¢è¯•çªè¢­v4.0ï¼Œè®¡ç®—æœºç½‘ç»œ<a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://www.cnblogs.com/gotodsp/p/6366163.html">https://www.cnblogs.com/gotodsp/p/6366163.html</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>CS</category>
      
      <category>Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CS</tag>
      
      <tag>Network</tag>
      
      <tag>HTTP</tag>
      
      <tag>HTTPS</tag>
      
      <tag>TCP</tag>
      
      <tag>UDP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>BIO_AIO_NIOåŒºåˆ«</title>
    <link href="/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/"/>
    <url>/2021/03/18/BIO_AIO_NIO%E5%8C%BA%E5%88%AB/</url>
    
    <content type="html"><![CDATA[<h1 id="BIO-AIO-NIOåŒºåˆ«"><a href="#BIO-AIO-NIOåŒºåˆ«" class="headerlink" title="BIO_AIO_NIOåŒºåˆ«"></a>BIO_AIO_NIOåŒºåˆ«</h1><blockquote><p>ç®€å•å¯¹æ¯”ï¼š</p><ul><li>BIO å°±æ˜¯ä¼ ç»Ÿçš„ <a href="https://link.zhihu.com/?target=http://java.io/">java.io</a> åŒ…ï¼Œå®ƒæ˜¯åŸºäºæµæ¨¡å‹å®ç°çš„ï¼Œäº¤äº’çš„æ–¹å¼æ˜¯<strong>åŒæ­¥ã€é˜»å¡</strong>æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¯»å…¥è¾“å…¥æµæˆ–è€…è¾“å‡ºæµæ—¶ï¼Œåœ¨è¯»å†™åŠ¨ä½œå®Œæˆä¹‹å‰ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨æ—¶å¯é çš„çº¿æ€§é¡ºåºã€‚å®ƒçš„æœ‰ç‚¹å°±æ˜¯ä»£ç æ¯”è¾ƒç®€å•ã€ç›´è§‚ï¼›ç¼ºç‚¹å°±æ˜¯ IO çš„æ•ˆç‡å’Œæ‰©å±•æ€§å¾ˆä½ï¼Œå®¹æ˜“æˆä¸ºåº”ç”¨æ€§èƒ½ç“¶é¢ˆã€‚</li><li>NIO æ˜¯ Java 1.4 å¼•å…¥çš„ java.nio åŒ…ï¼Œæä¾›äº† Channelã€Selectorã€Buffer ç­‰æ–°çš„æŠ½è±¡ï¼Œå¯ä»¥æ„å»ºå¤šè·¯å¤ç”¨çš„ã€<strong>åŒæ­¥éé˜»å¡</strong> IO ç¨‹åºï¼ŒåŒæ—¶æä¾›äº†æ›´æ¥è¿‘æ“ä½œç³»ç»Ÿåº•å±‚é«˜æ€§èƒ½çš„æ•°æ®æ“ä½œæ–¹å¼ã€‚</li><li>AIO æ˜¯ Java 1.7 ä¹‹åå¼•å…¥çš„åŒ…ï¼Œæ˜¯ NIO çš„å‡çº§ç‰ˆæœ¬ï¼Œæä¾›äº†<strong>å¼‚æ­¥éå µå¡çš„ IO</strong> æ“ä½œæ–¹å¼ï¼Œæ‰€ä»¥äººä»¬å«å®ƒ AIOï¼ˆAsynchronous IOï¼‰ï¼Œå¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</li></ul></blockquote><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>é—®é¢˜çš„å…³é”®å…¶å®å°±æ˜¯ç†è§£åŒæ­¥/å¼‚æ­¥ã€é˜»å¡/éé˜»å¡çš„å«ä¹‰ã€‚</p><p>æœ€åˆæˆ‘çœ‹äº†å¾ˆå¤šblogä»¥åŠä¸€äº›æ‰€è°“çš„é¢è¯•è€ƒé¢˜è®²è§£è§†é¢‘ï¼Œä»¥ä¸ºç†è§£äº†åŒæ­¥/å¼‚æ­¥ã€é˜»å¡/éé˜»å¡çš„å«ä¹‰ï¼Œä½†å…¶å®è¶Šæƒ³è¶Šç»ä¸èµ·æ¨æ•²</p><p>æ¯”å¦‚ä¸‹é¢çš„ä¸€äº›ç†è§£ï¼ˆæˆ‘è®¤ä¸ºæ˜¯ä¸å¯¹çš„ï¼‰ï¼š</p><blockquote><p><del>åŒæ­¥å’Œå¼‚æ­¥ï¼ˆé’ˆå¯¹è¯·æ±‚ï¼‰ï¼Œé˜»å¡å’Œéé˜»å¡ï¼ˆé’ˆå¯¹å®¢æˆ·ç«¯ï¼‰</del></p><p><del>åœ¨ç½‘ç»œè¯·æ±‚ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šå‘å‡ºä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡ç«¯</del></p><ol><li><del>å®¢æˆ·ç«¯å‘äº†è¯·æ±‚åï¼Œå°±ä¸€ç›´ç­‰ç€æœåŠ¡ç«¯çš„è¿”å›ç›¸åº”ã€‚ å®¢æˆ·ç«¯ï¼šé˜»å¡ã€‚ è¯·æ±‚ï¼šåŒæ­¥</del></li><li><del>å®¢æˆ·ç«¯å‘äº†è¯·æ±‚åï¼Œå°±å»å¹²åˆ«çš„äº‹æƒ…äº†ï¼Œæ—¶ä¸æ—¶æ¥æ£€æŸ¥æœåŠ¡ç«¯æ˜¯å¦ç»™å‡ºäº†å“åº”ã€‚ å®¢æˆ·ç«¯ï¼šéé˜»å¡ã€‚ è¯·æ±‚ï¼š åŒæ­¥ã€‚</del></li><li><del>æ¢æˆå¼‚æ­¥è¯·æ±‚åï¼Œå®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åï¼Œå°±ååœ¨æ¤…å­ä¸Šï¼Œç­‰ç€æœåŠ¡ç«¯çš„è¿”å›ç›¸åº”ã€‚ å®¢æˆ·ç«¯ï¼šé˜»å¡ã€‚ è¯·æ±‚ï¼šå¼‚æ­¥ã€‚</del></li><li><del>å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚åï¼Œå°±å»å¹²åˆ«çš„äº‹æƒ…äº†ï¼Œç­‰åˆ°æœåŠ¡ç«¯ç»™å‡ºå“åº”åï¼Œå†æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚ å®¢æˆ·ç«¯ï¼šé˜»å¡ã€‚ è¯·æ±‚ï¼šå¼‚æ­¥ã€‚</del></li></ol></blockquote><p>åƒè¿™æ ·ä¸¾é€šä¿—çš„ä¾‹å­æ¥è¯´æ˜è¿™å‡ ä¸ªæ¦‚å¿µï¼Œé€šå¸¸éƒ½ç»ä¸èµ·æ¨æ•²ï¼ŒåŸå› åœ¨äºï¼Œä¾‹å­ä¸­ç¼ºå°‘äº†ä¸€ä¸ªâ€œæ“ä½œç³»ç»Ÿâ€çº§åˆ«çš„è°ƒåº¦è€…ã€‚</p><ul><li><p>é˜»å¡éé˜»å¡æ˜¯è·Ÿè¿›ç¨‹/çº¿ç¨‹ä¸¥å¯†ç›¸å…³çš„ï¼Œè€Œè¿›ç¨‹/çº¿ç¨‹åˆæ˜¯ä¾èµ–äºæ“ä½œç³»ç»Ÿå­˜åœ¨çš„ï¼Œæ‰€ä»¥è‡ªç„¶ä¸èƒ½è„±ç¦»æ“ä½œç³»ç»Ÿæ¥è®¨è®ºé˜»å¡éé˜»å¡ã€‚</p></li><li><p>åŒæ­¥/å¼‚æ­¥ä¹Ÿæ˜¯è·Ÿä»»åŠ¡æµç›¸å…³çš„ï¼Œæ‰€ä»¥ä¸¾ä¾‹å­å¿…é¡»è€ƒè™‘åˆ°å¹¶å‘çš„ä»»åŠ¡æµï¼Œä¸ç„¶ï¼Œè‚¯å®šå¾ˆéš¾ä¸¾å‡ºæ°å½“çš„ä¾‹å­çš„ã€‚</p></li></ul><p>æœ¬æ–‡çš„è®¨è®ºï¼š</p><ul><li><p>é™å®šLinuxç¯å¢ƒä¸‹çš„network IOä½œä¸ºèƒŒæ™¯æ¥è®¨è®ºåŒæ­¥/å¼‚æ­¥ã€é˜»å¡/éé˜»å¡çš„ç†è§£ã€‚<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label=" UNIXÂ® Network Programming Volume 1, Third Edition: The Sockets Networkingï¼ŒRichard Stevensï¼Œ6.2èŠ‚ I/O Models">[1]</span></a></sup><sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://blog.csdn.net/historyasamirror/article/details/5778378">[2]</span></a></sup><sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://zhuanlan.zhihu.com/p/112810033">[4]</span></a></sup></p></li><li><p>è®¨è®ºJavaä¸­å¯¹åº”çš„ç¼–ç¨‹æ¨¡å‹</p></li><li><p>å¯¹æ¯”BIO/NIOçš„åŒºåˆ«<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://zhuanlan.zhihu.com/p/83597838">[3]</span></a></sup></p></li></ul><h2 id="1-Linuxä¸‹çš„äº”ç§I-Oæ¨¡å‹"><a href="#1-Linuxä¸‹çš„äº”ç§I-Oæ¨¡å‹" class="headerlink" title="1.  Linuxä¸‹çš„äº”ç§I/Oæ¨¡å‹"></a>1.  Linuxä¸‹çš„äº”ç§I/Oæ¨¡å‹</h2><p>Stevensåœ¨æ–‡ç« ä¸­ä¸€å…±æ¯”è¾ƒäº†äº”ç§IO Modelï¼š</p><ul><li>blocking IO</li><li>nonblocking IO</li><li>IO multiplexing</li><li>signal driven IO</li><li>asynchronous IO</li></ul><p>ç”±äºsignal driven IOåœ¨å®é™…ä¸­å¹¶ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥åªæåŠå‰©ä¸‹çš„å››ç§IO Modelã€‚</p><blockquote><p>IOå‘ç”Ÿæ—¶æ¶‰åŠçš„å¯¹è±¡å’Œæ­¥éª¤:</p><ul><li>å¯¹äºä¸€ä¸ªnetwork IO (è¿™é‡Œæˆ‘ä»¬ä»¥readä¸¾ä¾‹)ï¼Œå®ƒä¼šæ¶‰åŠåˆ°ä¸¤ä¸ªç³»ç»Ÿå¯¹è±¡:<ul><li>ä¸€ä¸ªæ˜¯è°ƒç”¨è¿™ä¸ªIOçš„process (or thread)</li><li>å¦ä¸€ä¸ªå°±æ˜¯ç³»ç»Ÿå†…æ ¸(kernel)</li></ul></li><li>å½“ä¸€ä¸ªreadæ“ä½œå‘ç”Ÿæ—¶ï¼Œå®ƒä¼šç»å†ä¸¤ä¸ªé˜¶æ®µï¼š<br>   1 ç­‰å¾…æ•°æ®å‡†å¤‡ (Waiting for the data to be ready)<br>   2 å°†æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°è¿›ç¨‹ä¸­ (Copying the data from the kernel to the process)</li><li>è®°ä½è¿™ä¸¤ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºè¿™äº›IO Modelçš„åŒºåˆ«å°±æ˜¯åœ¨ä¸¤ä¸ªé˜¶æ®µä¸Šå„æœ‰ä¸åŒçš„æƒ…å†µã€‚</li></ul></blockquote><h3 id="1-1-é˜»å¡I-Oï¼ˆblocking-I-Oï¼‰"><a href="#1-1-é˜»å¡I-Oï¼ˆblocking-I-Oï¼‰" class="headerlink" title="1.1 é˜»å¡I/Oï¼ˆblocking I/Oï¼‰"></a>1.1 é˜»å¡I/Oï¼ˆblocking I/Oï¼‰</h3><p>åœ¨linuxä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹æ‰€æœ‰çš„socketéƒ½æ˜¯blockingï¼Œä¸€ä¸ªå…¸å‹çš„è¯»æ“ä½œæµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·:</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/1_blockingIO.png"></p><ul><li><p>ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡æ•°æ®</p><p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†recvfromè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œkernelå°±å¼€å§‹äº†IOçš„ç¬¬ä¸€ä¸ªé˜¶æ®µï¼šå‡†å¤‡æ•°æ®ã€‚å¯¹äºnetwork ioæ¥è¯´ï¼Œå¾ˆå¤šæ—¶å€™æ•°æ®åœ¨ä¸€å¼€å§‹è¿˜æ²¡æœ‰åˆ°è¾¾ï¼ˆæ¯”å¦‚ï¼Œè¿˜æ²¡æœ‰æ”¶åˆ°ä¸€ä¸ªå®Œæ•´çš„UDPåŒ…ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™kernelå°±è¦ç­‰å¾…è¶³å¤Ÿçš„æ•°æ®åˆ°æ¥ã€‚è€Œåœ¨ç”¨æˆ·è¿›ç¨‹è¿™è¾¹ï¼Œæ•´ä¸ªè¿›ç¨‹ä¼šè¢«é˜»å¡ã€‚</p></li><li><p>ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®æ‹·è´</p><p>å½“kernelä¸€ç›´ç­‰åˆ°æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå®ƒå°±ä¼šå°†æ•°æ®ä»kernelä¸­æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œç„¶åkernelè¿”å›ç»“æœï¼Œç”¨æˆ·è¿›ç¨‹æ‰è§£é™¤blockçš„çŠ¶æ€ï¼Œé‡æ–°è¿è¡Œèµ·æ¥ã€‚</p></li></ul><p>æ‰€ä»¥ï¼Œblocking IOçš„ç‰¹ç‚¹å°±æ˜¯åœ¨IOæ‰§è¡Œçš„ä¸¤ä¸ªé˜¶æ®µéƒ½è¢«blockäº†ã€‚ä»¥ä¸‹æ˜¯javaå®ç°çš„æœåŠ¡å™¨bioä»£ç ï¼ˆéœ€è¦æŒæ¡ï¼‰ï¼Œæ³¨æ„é˜»å¡æ–¹æ³•é˜»å¡çš„ç¬¬ä¸€ä¸ªé˜¶æ®µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// BIOé˜»å¡ä»£ç </span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerTcpSocket</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] bytes = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span>];<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ExecutorService executorService = Executors.newCachedThreadPool();<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 1.åˆ›å»ºä¸€ä¸ªServerSocketè¿æ¥</span><br>            <span class="hljs-keyword">final</span> ServerSocket serverSocket = <span class="hljs-keyword">new</span> ServerSocket();<br>            <span class="hljs-comment">// 2.ç»‘å®šç«¯å£å·</span><br>            serverSocket.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br>            <span class="hljs-comment">// 3.å½“å‰çº¿ç¨‹æ”¾å¼ƒcpuèµ„æºç­‰å¾…è·å–æ•°æ®</span><br>            System.out.println(<span class="hljs-string">&quot;ç­‰å¾…è·å–æ•°æ®...&quot;</span>);<br>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                <span class="hljs-keyword">final</span> Socket socket = serverSocket.accept(); <span class="hljs-comment">// é˜»å¡æ–¹æ³•</span><br>                executorService.execute(<span class="hljs-keyword">new</span> Runnable() &#123;<br>                    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span> </span>&#123;<br>                        <span class="hljs-keyword">try</span> &#123;<br>                            System.out.println(<span class="hljs-string">&quot;è·å–åˆ°æ•°æ®...&quot;</span>);<br>                            <span class="hljs-comment">// 4.è¯»å–æ•°æ®</span><br>                            <span class="hljs-keyword">int</span> read = socket.getInputStream().read(bytes); <span class="hljs-comment">// ä¼šé˜»å¡</span><br>                            String result = <span class="hljs-keyword">new</span> String(bytes);<br>                            System.out.println(result);<br>                        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><br>                        &#125;<br>                    &#125;<br>                &#125;);<br><br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>åº”ç”¨ç¨‹åº</strong>æƒ³è¦è¯»å–æ•°æ®å°±ä¼šè°ƒç”¨<code>recvfrom</code>,è€Œ<code>recvfrom</code>ä¼šé€šçŸ¥OSæ¥æ‰§è¡Œï¼ŒOSå°±ä¼šåˆ¤æ–­<strong>æ•°æ®æŠ¥æ˜¯å¦å‡†å¤‡å¥½</strong>(æ¯”å¦‚åˆ¤æ–­æ˜¯å¦æ”¶åˆ°äº†ä¸€ä¸ªå®Œæ•´çš„UDPæŠ¥æ–‡ï¼Œå¦‚æœæ”¶åˆ°UDPæŠ¥æ–‡ä¸å®Œæ•´ï¼Œé‚£ä¹ˆå°±ç»§ç»­ç­‰å¾…)ã€‚å½“æ•°æ®åŒ…å‡†å¤‡å¥½äº†ä¹‹åï¼ŒOSå°±ä¼š<strong>å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</strong>(å› ä¸ºæˆ‘ä»¬çš„ç”¨æˆ·ç¨‹åºåªèƒ½è·å–ç”¨æˆ·ç©ºé—´çš„å†…å­˜ï¼Œæ— æ³•ç›´æ¥è·å–å†…æ ¸ç©ºé—´çš„å†…å­˜)ã€‚æ‹·è´å®Œæˆä¹‹å<code>socket.read()</code>å°±ä¼šè§£é™¤é˜»å¡ï¼Œå¹¶å¾—åˆ°readçš„ç»“æœã€‚</p><h3 id="1-2-éé˜»å¡ï¼ˆNon-Blocking-IOï¼‰"><a href="#1-2-éé˜»å¡ï¼ˆNon-Blocking-IOï¼‰" class="headerlink" title="1.2 éé˜»å¡ï¼ˆNon-Blocking IOï¼‰"></a>1.2 éé˜»å¡ï¼ˆNon-Blocking IOï¼‰</h3><p>linuxä¸‹ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®socketä½¿å…¶å˜ä¸ºnon-blockingã€‚å½“å¯¹ä¸€ä¸ªnon-blocking socketæ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œæµç¨‹æ˜¯è¿™ä¸ªæ ·å­ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/2_nonblockingIO.png"></p><ul><li><p>ç¬¬ä¸€é˜¶æ®µï¼šå‡†å¤‡æ•°æ®</p><p>ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“ç”¨æˆ·è¿›ç¨‹å‘å‡ºreadæ“ä½œæ—¶ï¼Œå¦‚æœkernelä¸­çš„æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œé‚£ä¹ˆå®ƒå¹¶ä¸ä¼šblockç”¨æˆ·è¿›ç¨‹ï¼Œè€Œæ˜¯ç«‹åˆ»è¿”å›ä¸€ä¸ªerrorã€‚ä»ç”¨æˆ·è¿›ç¨‹è§’åº¦è®² ï¼Œå®ƒå‘èµ·ä¸€ä¸ªreadæ“ä½œåï¼Œå¹¶ä¸éœ€è¦ç­‰å¾…ï¼Œè€Œæ˜¯é©¬ä¸Šå°±å¾—åˆ°äº†ä¸€ä¸ªç»“æœã€‚ç”¨æˆ·è¿›ç¨‹åˆ¤æ–­ç»“æœæ˜¯ä¸€ä¸ªerroræ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®è¿˜æ²¡æœ‰å‡†å¤‡å¥½ï¼Œäºæ˜¯å®ƒå¯ä»¥å†æ¬¡å‘é€readæ“ä½œã€‚</p></li><li><p>ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®æ‹·è´</p><p>ä¸€æ—¦kernelä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œå¹¶ä¸”åˆå†æ¬¡æ”¶åˆ°äº†ç”¨æˆ·è¿›ç¨‹çš„system callï¼Œé‚£ä¹ˆå®ƒé©¬ä¸Šå°±å°†æ•°æ®æ‹·è´åˆ°äº†ç”¨æˆ·å†…å­˜ï¼Œç„¶åè¿”å›ã€‚</p></li></ul><p>æ‰€ä»¥ï¼Œç”¨æˆ·è¿›ç¨‹å…¶å®æ˜¯éœ€è¦ä¸æ–­çš„ä¸»åŠ¨è¯¢é—®kernelæ•°æ®å¥½äº†æ²¡æœ‰ã€‚ä¸€å®šè¦æ³¨æ„è¿™ä¸ªåœ°æ–¹ï¼Œ<strong>Non-Blockingè¿˜æ˜¯ä¼šé˜»å¡çš„</strong>ã€‚</p><p>ä»¥ä¸‹æ˜¯javaå®ç°çš„æœåŠ¡å™¨bioä»£ç ï¼ˆéœ€è¦æŒæ¡ï¼‰ï¼Œæ³¨æ„æ•°æ®å‡†å¤‡é˜¶æ®µæ˜¯éé˜»å¡æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// NIOéé˜»å¡å¼ä»£ç </span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ServerNioTcpSocket</span> </span>&#123;<br>    <span class="hljs-keyword">static</span> ByteBuffer byteBuffer = ByteBuffer.allocate(<span class="hljs-number">512</span>);<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 1.åˆ›å»ºä¸€ä¸ªServerSocketChannelè¿æ¥</span><br>            <span class="hljs-keyword">final</span> ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();<br>            <span class="hljs-comment">// 2.ç»‘å®šç«¯å£å·</span><br>            serverSocketChannel.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8080</span>));<br>            <span class="hljs-comment">// è®¾ç½®ä¸ºéé˜»å¡å¼</span><br>            serverSocketChannel.configureBlocking(<span class="hljs-keyword">false</span>);<br>            <span class="hljs-comment">// éé˜»å¡å¼</span><br>            SocketChannel socketChannel = serverSocketChannel.accept(); <br>            <span class="hljs-keyword">if</span> (socketChannel != <span class="hljs-keyword">null</span>) &#123;<br>                <span class="hljs-keyword">int</span> j = socketChannel.read(byteBuffer);  <span class="hljs-comment">// æ­¤å¤„ä¸ä¼šé˜»å¡</span><br>                <span class="hljs-keyword">if</span> (j &gt; <span class="hljs-number">0</span>) &#123;<br>                    <span class="hljs-keyword">byte</span>[] bytes = Arrays.copyOf(byteBuffer.array(), byteBuffer.limit());<br>                    System.out.println(<span class="hljs-string">&quot;è·å–åˆ°æ•°æ®&quot;</span> + <span class="hljs-keyword">new</span> String(bytes));<br>                &#125;<br>            &#125;<br>            System.out.println(<span class="hljs-string">&quot;ç¨‹åºæ‰§è¡Œå®Œæ¯•..&quot;</span>);<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>NIOä¸­æä¾›äº†é›†ä¸­Channelï¼š<code>ServerSocketChannelï¼›SocketChannelï¼›FileChannelï¼›</code> <code>DatagramChannel</code>åªæœ‰<code>FileChannel</code>æ— æ³•è®¾ç½®æˆéé˜»å¡æ¨¡å¼ï¼Œå…¶ä»–Channeléƒ½å¯ä»¥è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚</p><p>å½“è®¾ç½®ä¸ºéé˜»å¡åï¼Œæˆ‘ä»¬çš„<code>socket.read()</code>æ–¹æ³•å°±ä¼šç«‹å³å¾—åˆ°ä¸€ä¸ªè¿”å›ç»“æœ(æˆåŠŸ or å¤±è´¥)ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿”å›ç»“æœæ‰§è¡Œä¸åŒçš„é€»è¾‘ï¼Œæ¯”å¦‚åœ¨å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›å…¶ä»–çš„äº‹æƒ…ã€‚ä½†äº‹å®ä¸Šè¿™ç§æ–¹å¼ä¹Ÿæ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨è½®è¯¢æ–¹æ³•åŒºä¸€ç›´é—®OSï¼šâ€œæˆ‘çš„æ•°æ®å¥½äº†æ²¡å•Šâ€ã€‚ç¬¬ä¸€ä¸ªä»£ç æ˜¯è¯¥çº¿ç¨‹ä¸æ–­çš„è½®è¯¢ï¼Œç¬¬äºŒä¸ªä»£ç æ˜¯ä½¿ç”¨selectorå®ç°è½®è¯¢ç­‰å¾…æœ‰æ•ˆè¯·æ±‚ã€‚</p><p>NIO ä¸ä¼šåœ¨<code>recvfrom</code>ä¹Ÿå°±æ˜¯<code>socket.read()</code>æ—¶å€™é˜»å¡ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šåœ¨<strong>å°†æ•°æ®ä»å†…æ ¸ç©ºé—´æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´</strong>é˜»å¡ã€‚</p><h3 id="1-3-I-Oå¤ç”¨-IO-multiplexing"><a href="#1-3-I-Oå¤ç”¨-IO-multiplexing" class="headerlink" title="1.3 I/Oå¤ç”¨ IO multiplexing"></a>1.3 I/Oå¤ç”¨ IO multiplexing</h3><p>IO multiplexingè¿™ä¸ªè¯å¯èƒ½æœ‰ç‚¹é™Œç”Ÿï¼Œä½†æ˜¯å¦‚æœæˆ‘è¯´selectï¼Œepollï¼Œå¤§æ¦‚å°±éƒ½èƒ½æ˜ç™½äº†ã€‚</p><p>æœ‰äº›åœ°æ–¹ä¹Ÿç§°è¿™ç§IOæ–¹å¼ä¸ºevent driven IOã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œselect/epollçš„å¥½å¤„å°±åœ¨äºå•ä¸ªprocesså°±å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¿æ¥çš„IOã€‚</p><p>å®ƒçš„åŸºæœ¬åŸç†å°±æ˜¯select/epollè¿™ä¸ªfunctionä¼šä¸æ–­çš„è½®è¯¢æ‰€è´Ÿè´£çš„æ‰€æœ‰socketï¼Œå½“æŸä¸ªsocketæœ‰æ•°æ®åˆ°è¾¾äº†ï¼Œå°±é€šçŸ¥ç”¨æˆ·è¿›ç¨‹ã€‚å®ƒçš„æµç¨‹å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/2_IOmultiplexing.png"></p><p>è¿™é‡Œç”¨javaçš„NIOç¤ºæ„select</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœåŠ¡ç«¯ä»£ç </span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NIOServer</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç«¯å£è¿›è¡Œç›‘å¬çš„æœåŠ¡Socketé€šé“ï¼Œå¹¶è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼</span><br>        ServerSocketChannel ssc = ServerSocketChannel.open();<br>        <span class="hljs-comment">// å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ‰èƒ½å¾€selectorä¸Šæ³¨å†Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œselectoræ¨¡å¼ç”­è¯´å°±æ˜¯éé˜»å¡æ¨¡å¼</span><br>        ssc.configureBlocking(<span class="hljs-keyword">false</span>); <br>        ssc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8888</span>));<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨selector</span><br>        Selector selector = selector.open();<br>        <span class="hljs-comment">// æŠŠServerSocketChannelæ³¨å†Œåˆ°selectorä¸Šï¼Œå¹¶ä¸”selectorå¯¹å®¢æˆ·ç«¯acceptè¿æ¥æ“ä½œæ„Ÿå…´è¶£</span><br>        ssc.register(selector, SelectionKey.OP_ACCEPT);<br><br>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;ç­‰å¾…äº‹ä»¶å‘ç”Ÿ...&quot;</span>);<br>            <span class="hljs-comment">// è½®è¯¢ç›‘å¬channelé‡Œé¢çš„keyï¼Œselectæ˜¯é˜»å¡çš„ï¼Œacceptä¹Ÿæ˜¯é˜»å¡çš„</span><br>            <span class="hljs-keyword">int</span> select = selector.select(); <br><br>            System.out.println(<span class="hljs-string">&quot;äº‹ä»¶å‘ç”Ÿäº†...&quot;</span>);<br>            <span class="hljs-comment">// æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¢«è½®è¯¢ç›‘å¬åˆ°</span><br>            Iterator&lt;SelectionKey&gt; it = selector.selectionKeys().iterator();<br>            <span class="hljs-keyword">while</span>(it.hasNext())&#123;<br>                SelectionKey key = it.next();<br>                <span class="hljs-comment">// åˆ é™¤æœ¬æ¬¡å·²å¤„ç†çš„keyï¼Œ é˜²æ­¢ä¸‹æ¬¡selecté‡å¤å¤„ç†</span><br>                it.remove();<br>                handle(key);<br>            &#125;      <br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handle</span><span class="hljs-params">(SelectionKey key)</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>        <span class="hljs-keyword">if</span>(key.isAcceptable())&#123;<br>            System.out.println(<span class="hljs-string">&quot;æœ‰å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶å‘ç”Ÿäº†...&quot;</span>);<br>            ServerSocketChannel ssc = (ServerSocketChannel) key.channel();<br>            <span class="hljs-comment">// NIOéé˜»å¡ä½“ç°:æ­¤å¤„acceptæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œä½†æ˜¯è¿™é‡Œå› ä¸ºå‘ç”Ÿäº†è¿æ¥äº‹ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¼šé©¬ä¸Šæ‰§è¡Œå®Œï¼Œä¸ä¼šé˜»å¡</span><br>            <span class="hljs-comment">// å¤„ç†å®Œè¿æ¥è¯·æ±‚ä¸ä¼šç»§ç»­ç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®å‘é€</span><br>            SocketChannel sc = ssc.accept();<br>            sc.configureBlocking(<span class="hljs-keyword">false</span>);<br>            <span class="hljs-comment">// é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹è¯»äº‹ä»¶æ„Ÿå…´è¶£</span><br>            sc.register(selector, SelectionKey.OP_READ); <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isReadable())&#123;<br>            System.out.println(<span class="hljs-string">&quot;æœ‰å®¢æˆ·ç«¯æ•°æ®å¯è¯»äº‹ä»¶å‘ç”Ÿäº†...&quot;</span>);<br>            SocketChannel sc = (SocketChannel) key.channel();<br>            ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);<br>            <span class="hljs-comment">// NIOéé˜»å¡ä½“ç°ï¼šé¦–å…ˆreadæ–¹æ³•ä¸ä¼šé˜»å¡ï¼Œå…¶æ¬¡è¿™ç§äº‹ä»¶å“åº”æ¨¡å‹ï¼Œå½“è°ƒç”¨åˆ°readæ–¹æ³•æ—¶è‚¯å®šæ—¶å‘ç”Ÿäº†å®¢æˆ·ç«¯å‘é€æ•°æ®çš„äº‹ä»¶</span><br>            <span class="hljs-keyword">int</span> len = sc.read(buffer);<br>            <span class="hljs-keyword">if</span>(len != -<span class="hljs-number">1</span>)&#123;<br>                System.out.println(<span class="hljs-string">&quot;è¯»å–åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®:&quot;</span> + <span class="hljs-keyword">new</span> String(buffer.array(), <span class="hljs-number">0</span>, len));<br>            &#125;<br>            ByteBuffer bufferToWrite = ByteBuffer.wrap(<span class="hljs-string">&quot;HelloClient&quot;</span>.getBytes());<br>            sc.write(bufferToWrite);<br>            key.interestOps(SelectionKey.OP_READ | SelectionKey.OP_WRITE);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(key.isWritable) &#123;<br>            SocketChannel sc = (SocketChannel) key.channel();<br>            System.out.println(<span class="hljs-string">&quot;writeäº‹ä»¶...&quot;</span>);<br>            <span class="hljs-comment">// NIOäº‹ä»¶è§¦å‘æ˜¯æ°´å¹³è§¦å‘</span><br>            <span class="hljs-comment">// ä½¿ç”¨Javaçš„NIOç¼–ç¨‹æ—¶ï¼Œåœ¨æ²¡æœ‰æ•°æ®å¯ä»¥å¾€å¤–å†™çš„æ—¶å€™è¦å–æ¶ˆå†™äº‹ä»¶</span><br>            <span class="hljs-comment">// åœ¨æœ‰æ•°æ®å¾€å¤–å†™çš„æ—¶å€™åœ¨æ³¨å†Œå†™äº‹ä»¶</span><br>            key.interestOps(SelectionKey.OP_READ);<br>            <span class="hljs-comment">// sc.close();</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨äº†selectï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šè¢«blockï¼Œè€ŒåŒæ—¶ï¼Œkernelä¼šâ€œç›‘è§†â€æ‰€æœ‰selectè´Ÿè´£çš„socketï¼Œå½“ä»»ä½•ä¸€ä¸ªsocketä¸­çš„æ•°æ®å‡†å¤‡å¥½äº†ï¼Œselectå°±ä¼šè¿”å›ã€‚è¿™ä¸ªæ—¶å€™ç”¨æˆ·è¿›ç¨‹å†è°ƒç”¨readæ“ä½œï¼Œå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·è¿›ç¨‹ã€‚</p><p>è¿™ä¸ªå›¾å’Œblocking IOçš„å›¾å…¶å®å¹¶æ²¡æœ‰å¤ªå¤§çš„ä¸åŒï¼Œäº‹å®ä¸Šï¼Œè¿˜æ›´å·®ä¸€äº›ã€‚å› ä¸ºè¿™é‡Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªsystem call (select å’Œ recvfrom)ï¼Œè€Œblocking IOåªè°ƒç”¨äº†ä¸€ä¸ªsystem call (recvfrom)ã€‚ä½†æ˜¯ï¼Œç”¨selectçš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªconnectionã€‚</p><blockquote><p>å¤šè¯´ä¸€å¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¤„ç†çš„è¿æ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨select/epollçš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨multi-threading + blocking IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚select/epollçš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚</p></blockquote><p>åœ¨IO multiplexing Modelä¸­ï¼Œå®é™…ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„processå…¶å®æ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡processæ˜¯è¢«selectè¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚</p><h3 id="1-4-å¼‚æ­¥I-O-Asynchronous-IO"><a href="#1-4-å¼‚æ­¥I-O-Asynchronous-IO" class="headerlink" title="1.4 å¼‚æ­¥I/O(Asynchronous IO)"></a>1.4 å¼‚æ­¥I/O(Asynchronous IO)</h3><p>linuxä¸‹çš„asynchronous IOå…¶å®ç”¨å¾—å¾ˆå°‘(æ‰€ä»¥è¿™é‡Œå°±ä¸è´´AIOçš„javaä»£ç äº†ï¼Œä¸€èˆ¬ä¸è¦æ±‚æŒæ¡ï¼‰ã€‚å…ˆçœ‹ä¸€ä¸‹å®ƒçš„æµç¨‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/3_AsynchronousIO.png"></p><p>ç”¨æˆ·è¿›ç¨‹å‘èµ·readæ“ä½œä¹‹åï¼Œç«‹åˆ»å°±å¯ä»¥å¼€å§‹å»åšå…¶å®ƒçš„äº‹ã€‚</p><p>è€Œå¦ä¸€æ–¹é¢ï¼Œä»kernelçš„è§’åº¦ï¼Œå½“å®ƒå—åˆ°ä¸€ä¸ªasynchronous readä¹‹åï¼Œé¦–å…ˆå®ƒä¼šç«‹åˆ»è¿”å›ï¼Œæ‰€ä»¥ä¸ä¼šå¯¹ç”¨æˆ·è¿›ç¨‹äº§ç”Ÿä»»ä½•blockã€‚ç„¶åï¼Œkernelä¼šç­‰å¾…æ•°æ®å‡†å¤‡å®Œæˆï¼Œç„¶åå°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ï¼Œå½“è¿™ä¸€åˆ‡éƒ½å®Œæˆä¹‹åï¼Œkernelä¼šç»™ç”¨æˆ·è¿›ç¨‹å‘é€ä¸€ä¸ªsignalï¼Œå‘Šè¯‰å®ƒreadæ“ä½œå®Œæˆäº†ã€‚</p><p>Asynchronous IOè°ƒç”¨ä¸­æ˜¯çœŸæ­£çš„æ— é˜»å¡ï¼Œå…¶ä»–IO modelä¸­å¤šå°‘ä¼šæœ‰ç‚¹é˜»å¡ã€‚</p><h3 id="1-5-åŸºäºå››ä¸ªæ¨¡å‹ï¼Œå¯¹blockingå’Œnon-blockingï¼Œsynchronous-IOå’Œasynchronous-IOçš„ç†è§£"><a href="#1-5-åŸºäºå››ä¸ªæ¨¡å‹ï¼Œå¯¹blockingå’Œnon-blockingï¼Œsynchronous-IOå’Œasynchronous-IOçš„ç†è§£" class="headerlink" title="1.5 åŸºäºå››ä¸ªæ¨¡å‹ï¼Œå¯¹blockingå’Œnon-blockingï¼Œsynchronous IOå’Œasynchronous IOçš„ç†è§£"></a>1.5 åŸºäºå››ä¸ªæ¨¡å‹ï¼Œå¯¹blockingå’Œnon-blockingï¼Œsynchronous IOå’Œasynchronous IOçš„ç†è§£</h3><p>å…¶å®æ˜¯POSIXçš„å®šä¹‰æ˜¯è¿™æ ·å­çš„ï¼š</p><ul><li><p>A synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes;</p></li><li><p>An asynchronous I/O operation does not cause the requesting process to be blocked;</p></li></ul><p>æ ¸å¿ƒåŒºåˆ«æ˜¯ï¼šsynchronous IOåšâ€IO operationâ€çš„æ—¶å€™ä¼šå°†processé˜»å¡</p><ol><li><p>blocking IOï¼Œnon-blocking IOï¼ŒIO multiplexingéƒ½å±äºsynchronous IOã€‚</p></li><li><p>è€Œasynchronous IO,å½“è¿›ç¨‹å‘èµ·IO æ“ä½œä¹‹åï¼Œå°±ç›´æ¥è¿”å›å†ä¹Ÿä¸ç†ç¬äº†ï¼Œç›´åˆ°kernelå‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰è¿›ç¨‹è¯´IOå®Œæˆã€‚åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹å®Œå…¨æ²¡æœ‰è¢«blockã€‚</p></li></ol><blockquote><p>æœ‰äººå¯èƒ½ä¼šè¯´ï¼Œnon-blocking IOå¹¶æ²¡æœ‰è¢«blockå•Šã€‚è¿™é‡Œæœ‰ä¸ªéå¸¸â€œç‹¡çŒ¾â€çš„åœ°æ–¹ï¼Œå®šä¹‰ä¸­æ‰€æŒ‡çš„â€IO operationâ€æ˜¯æŒ‡çœŸå®çš„IOæ“ä½œï¼Œå°±æ˜¯ä¾‹å­ä¸­çš„recvfromè¿™ä¸ªsystem callã€‚non-blocking IOåœ¨æ‰§è¡Œrecvfromè¿™ä¸ªsystem callçš„æ—¶å€™ï¼Œå¦‚æœkernelçš„æ•°æ®æ²¡æœ‰å‡†å¤‡å¥½ï¼Œè¿™æ—¶å€™ä¸ä¼šblockè¿›ç¨‹ã€‚ä½†æ˜¯ï¼Œå½“kernelä¸­æ•°æ®å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œrecvfromä¼šå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹æ˜¯è¢«blockäº†ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹æ˜¯è¢«blockçš„ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/4_ComparisonOfTheFiveIO.png"></p><p>ç»è¿‡ä¸Šé¢çš„ä»‹ç»ï¼Œä¼šå‘ç°non-blocking IOå’Œasynchronous IOçš„åŒºåˆ«è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚åœ¨non-blocking IOä¸­ï¼Œè™½ç„¶è¿›ç¨‹å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸ä¼šè¢«blockï¼Œä½†æ˜¯å®ƒä»ç„¶è¦æ±‚è¿›ç¨‹å»ä¸»åŠ¨çš„checkï¼Œå¹¶ä¸”å½“æ•°æ®å‡†å¤‡å®Œæˆä»¥åï¼Œä¹Ÿéœ€è¦è¿›ç¨‹ä¸»åŠ¨çš„å†æ¬¡è°ƒç”¨recvfromæ¥å°†æ•°æ®æ‹·è´åˆ°ç”¨æˆ·å†…å­˜ã€‚è€Œasynchronous IOåˆ™å®Œå…¨ä¸åŒã€‚å®ƒå°±åƒæ˜¯ç”¨æˆ·è¿›ç¨‹å°†æ•´ä¸ªIOæ“ä½œäº¤ç»™äº†ä»–äººï¼ˆkernelï¼‰å®Œæˆï¼Œç„¶åä»–äººåšå®Œåå‘ä¿¡å·é€šçŸ¥ã€‚åœ¨æ­¤æœŸé—´ï¼Œç”¨æˆ·è¿›ç¨‹ä¸éœ€è¦å»æ£€æŸ¥IOæ“ä½œçš„çŠ¶æ€ï¼Œä¹Ÿä¸éœ€è¦ä¸»åŠ¨çš„å»æ‹·è´æ•°æ®ã€‚</p><h3 id="1-6-selectï¼Œpollï¼ŒepollåŒºåˆ«"><a href="#1-6-selectï¼Œpollï¼ŒepollåŒºåˆ«" class="headerlink" title="1.6 selectï¼Œpollï¼ŒepollåŒºåˆ«"></a>1.6 selectï¼Œpollï¼ŒepollåŒºåˆ«</h3><p>çŸ¥ä¹è¿™ç¯‡æ–‡ç« æŠŠåº•å±‚è®²å¾—å¾ˆæ¸…æ¥šï¼ˆä¸€å…±ä¸‰ç¯‡ï¼‰ï¼š<a href="https://zhuanlan.zhihu.com/p/64746509">https://zhuanlan.zhihu.com/p/64746509</a></p><p>ä»–ä»¬æ˜¯NIOä¸­å¤šè·¯å¤ç”¨çš„ä¸‰ç§å®ç”¨æœºåˆ¶ï¼ˆåº•å±‚æ˜¯ä¸‰ä¸ªC++çš„APIï¼‰ï¼Œæ˜¯ç”±Linuxæ“ä½œç³»ç»Ÿæä¾›çš„ã€‚</p><p>Unixï¼ŒLinuxæ“ä½œç³»ç»Ÿçš„ä¸€äº›åŸºæœ¬çŸ¥è¯†ï¼š</p><ul><li><p>ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ï¼šæ“ä½œç³»ç»Ÿä¸ºäº†ä¿æŠ¤ç³»ç»Ÿå®‰å…¨ï¼Œå°†å†…æ ¸åˆ’åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·ç©ºé—´ï¼Œä¸€ä¸ªæ˜¯å†…æ ¸ç©ºé—´ã€‚ç”¨æˆ·ç©ºé—´ä¸èƒ½ç›´æ¥è®¿é—®åº•å±‚çš„ç¡¬ä»¶è®¾å¤‡ï¼Œå¿…é¡»é€šè¿‡å†…æ ¸ç©ºé—´</p></li><li><p>æ–‡ä»¶æè¿°ç¬¦File Descriptorï¼ˆFDï¼‰ï¼šæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå½¢å¼ä¸Šæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå®é™…ä¸Šæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ã€‚æŒ‡å‘å†…æ ¸ä¸­ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹ç»´æŠ¤è¿›ç¨‹æ‰€æ‰“å¼€çš„æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå†…æ ¸å°±ä¼šå‘è¿›ç¨‹è¿”å›ä¸€ä¸ªFDã€‚</p></li></ul><blockquote><p>selectæœºåˆ¶ï¼šä¼šç»´æŠ¤ä¸€ä¸ªFDçš„é›†åˆfd_setã€‚å°†fd_setä»ç”¨æˆ·ç©ºé—´å¤åˆ¶åˆ°å†…æ ¸ç©ºé—´ï¼Œæ¿€æ´»socketã€‚ï¼ˆfd_setæ˜¯ä¸€ä¸ªæ•°ç»„ç»“æ„ï¼Œæ‹·è´å¤§å°å—é™åˆ¶ x64æœ€å¤§2048ï¼‰</p><p>pollæœºåˆ¶ï¼šå’Œselectæœºåˆ¶å·®ä¸å¤šçš„ã€‚å°†fd_setç»“æ„è¿›è¡Œäº†ä¼˜åŒ–ï¼ŒFDé›†åˆå¤§å°çªç ´äº†æ“ä½œç³»ç»Ÿé™åˆ¶ã€‚ï¼ˆpollfdç»“æ„æ¥ä»£æ›¿fd_setï¼Œé€šè¿‡é“¾è¡¨å®ç°çš„ï¼‰</p><p>Epollæœºåˆ¶ï¼šEvent Pollä¸åœ¨æ‰«ææ‰€æœ‰çš„FDï¼Œåªå°†ç”¨æˆ·å…³å¿ƒçš„FDçš„äº‹ä»¶å­˜æ”¾åˆ°å†…æ ¸çš„ä¸€ä¸ªäº‹ä»¶è¡¨å½“ä¸­ã€‚å¯ä»¥å‡å°‘ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ä¹‹é—´éœ€è¦æ‹·è´çš„æ•°æ®ã€‚</p></blockquote><table><thead><tr><th></th><th>æ“ä½œæ–¹å¼</th><th>åº•å±‚å®ç°</th><th>æœ€å¤§è¿æ¥æ•°</th><th>IOæ•ˆç‡</th></tr></thead><tbody><tr><td>selectï¼ˆ1984ï¼‰</td><td>éå†</td><td>æ•°ç»„</td><td>å—é™äºå†…æ ¸</td><td>ä¸€èˆ¬</td></tr><tr><td>pollï¼ˆ1997ï¼‰</td><td>éå†</td><td>é“¾è¡¨</td><td>æ— ä¸Šé™</td><td>ä¸€èˆ¬</td></tr><tr><td>epollï¼ˆ2002ï¼‰</td><td>äº‹ä»¶å›è°ƒ</td><td>çº¢é»‘æ ‘</td><td>æ— ä¸Šé™</td><td>é«˜</td></tr></tbody></table><p>Java NIOå½“ä¸­æ˜¯ä½¿ç”¨å“ªä¸€ç§æœºåˆ¶ï¼Ÿ</p><p>åŸºäºå†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥æŸ¥çœ‹DefaultSelectorProvideræºç ï¼š</p><ul><li><p>windowsä¸‹ï¼ŒWindowsSelectorProviderã€‚</p></li><li><p>Linuxä¸‹ï¼Œå†…æ ¸2.6ç‰ˆæœ¬ä»¥ä¸Šï¼Œå°±æ˜¯EpollSelectorProviderï¼Œå¦åˆ™å°±æ˜¯é»˜è®¤çš„PollSelectorProviderã€‚</p></li></ul><h2 id="2-Javaçš„IOç¼–ç¨‹æ¨¡å‹"><a href="#2-Javaçš„IOç¼–ç¨‹æ¨¡å‹" class="headerlink" title="2. Javaçš„IOç¼–ç¨‹æ¨¡å‹"></a>2. Javaçš„IOç¼–ç¨‹æ¨¡å‹</h2><blockquote><p>BIO åŒæ­¥é˜»å¡IOã€‚ å¯é æ€§å·®ï¼Œååé‡ä½ï¼Œé€‚ç”¨äºè¿æ¥æ¯”è¾ƒå°‘ä¸”æ¯”è¾ƒå›ºå®šçš„åœºæ™¯ã€‚JDK1.4ä¹‹å‰å”¯ä¸€çš„é€‰æ‹©ã€‚</p><p>ç¼–ç¨‹æ¨¡å‹æœ€ç®€å•ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_BIO%E7%BB%93%E6%9E%841.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// å¤ä¹ é»‘é©¬æ–‡ä»¶ä¸Šä¼ çš„æœåŠ¡ç«¯BIOä»£ç </span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileUpload_Server</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;æœåŠ¡å™¨ å¯åŠ¨..... &quot;</span>);<br>        <span class="hljs-comment">// 1. åˆ›å»ºæœåŠ¡ç«¯ServerSocket</span><br>        ServerSocket serverSocket = <span class="hljs-keyword">new</span> ServerSocket(<span class="hljs-number">6666</span>);<br>        <span class="hljs-comment">// 2. å¾ªç¯æ¥æ”¶,å»ºç«‹è¿æ¥</span><br>        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>            Socket accept = serverSocket.accept(); <span class="hljs-comment">// é˜»å¡æ–¹æ³•</span><br>            <span class="hljs-comment">/*</span><br><span class="hljs-comment">            3. socketå¯¹è±¡äº¤ç»™å­çº¿ç¨‹å¤„ç†,è¿›è¡Œè¯»å†™æ“ä½œ</span><br><span class="hljs-comment">            Runnableæ¥å£ä¸­,åªæœ‰ä¸€ä¸ªrunæ–¹æ³•,ä½¿ç”¨lambdaè¡¨è¾¾å¼ç®€åŒ–æ ¼å¼</span><br><span class="hljs-comment">            */</span><br>            <span class="hljs-keyword">new</span> Thread(() â€&gt; &#123;<br>                <span class="hljs-keyword">try</span> (<br>                    <span class="hljs-comment">//3.1 è·å–è¾“å…¥æµå¯¹è±¡</span><br>                    BufferedInputStream bis = <span class="hljs-keyword">new</span> BufferedInputStream(accept.getInputStream());<br>                    <span class="hljs-comment">//3.2 åˆ›å»ºè¾“å‡ºæµå¯¹è±¡, ä¿å­˜åˆ°æœ¬åœ° .</span><br>                    FileOutputStream fis = <span class="hljs-keyword">new</span> FileOutputStream(System.currentTimeMillis() +<br>                    <span class="hljs-string">&quot;.jpg&quot;</span>);<br>                    BufferedOutputStream bos = <span class="hljs-keyword">new</span> BufferedOutputStream(fis);) &#123;<br>                    <span class="hljs-comment">// 3.3 è¯»å†™æ•°æ®</span><br>                    <span class="hljs-keyword">byte</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1024</span> * <span class="hljs-number">8</span>];<br>                    <span class="hljs-keyword">int</span> len;<br>                    <span class="hljs-keyword">while</span> ((len = bis.read(b)) != â€<span class="hljs-number">1</span>) &#123;<br>                        bos.write(b, <span class="hljs-number">0</span>, len);<br>                    &#125;<br>                    <span class="hljs-comment">//4. å…³é—­ èµ„æº</span><br>                    bos.close();<br>                    bis.close();<br>                    accept.close();<br>                    System.out.println(<span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å·²ä¿å­˜&quot;</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;).start();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœä¸æ´»è·ƒçš„è¿æ¥é€æ¸å¢å¤šï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ…¢æ…¢çš„ä¹Ÿéƒ½å¼€å§‹é˜»å¡ç­‰å¾…IOï¼Œçº¿ç¨‹æ± é‡ŒçœŸæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°ä¼šè¶Šæ¥è¶Šå°‘ï¼Œå½“çº¿ç¨‹æ± å¤„ç†ä¸è¿‡æ¥æ—¶ï¼Œä¼šæ”¾ç½®åˆ°çº¿ç¨‹æ± é…ç½®çš„BlockingQueueä¸­ï¼Œé˜Ÿåˆ—å¡æ»¡åï¼Œæ…¢æ…¢çš„çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°ç›®ä¼šé€æ¸è¾¾åˆ°çº¿ç¨‹æ± é…ç½®çš„maximumPoolSizeï¼Œå¦‚æœå†å¤„ç†ä¸è¿‡æ¥ï¼Œæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>æœ€ç»ˆä¼šå¯¼è‡´è¯·æ±‚æ— æ³•åŠæ—¶å¤„ç†ã€‚</code></p><p>è¿™æ ·å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œå‡è®¾æœ‰çº¿ç¨‹æ± corePoolSizeè®¾ç½®ä¸º100ï¼Œåªè¦æœ‰100ä¸ªä¸æ´»è·ƒçš„è¿æ¥æ­£åœ¨é˜»å¡è¯»å†™IOï¼Œå°±ä¼šæŠŠå‰corePoolSizeçº¿ç¨‹éƒ½é˜»å¡ä½ï¼Œåç»­çš„è¯·æ±‚å°±æ— æ³•åŠæ—¶å¤„ç†ã€‚</p><blockquote><p>NIO åŒæ­¥éé˜»å¡IOã€‚ å¯é æ€§æ¯”è¾ƒå¥½ï¼Œååé‡ä¹Ÿæ¯”è¾ƒé«˜ï¼Œé€‚ç”¨äºè¿æ¥æ¯”è¾ƒå¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰ã€‚ä¾‹å¦‚èŠå¤©å®¤ã€‚JDK1.4å¼€å§‹æ”¯æŒã€‚ï¼ˆåº”ç”¨æœ€å¹¿ï¼‰</p><p>ç¼–ç¨‹æ¨¡å‹æœ€å¤æ‚ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_NIO%E7%BB%93%E6%9E%84.png"></p><p>NIOéé˜»å¡ä½“ç°:</p><ul><li>acceptæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œä½†æ˜¯è¿™é‡Œå› ä¸ºå‘ç”Ÿäº†è¿æ¥äº‹ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¼šé©¬ä¸Šæ‰§è¡Œå®Œï¼Œä¸ä¼šé˜»å¡</li><li>é¦–å…ˆreadæ–¹æ³•ä¸ä¼šé˜»å¡ï¼Œå…¶æ¬¡è¿™ç§äº‹ä»¶å“åº”æ¨¡å‹ï¼Œå½“è°ƒç”¨åˆ°readæ–¹æ³•æ—¶è‚¯å®šæ—¶å‘ç”Ÿäº†å®¢æˆ·ç«¯å‘é€æ•°æ®çš„äº‹ä»¶</li></ul><p>(æˆ‘çš„ä¸€äº›çœ‹æ³•ï¼Œjavaçš„NIOå°±æ˜¯Linuxä¸­IOå¤ç”¨å’ŒNIOä¸¤ä¸ªæ¨¡å‹çš„ç»“åˆ)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœåŠ¡ç«¯ä»£ç </span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NIOServer</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç«¯å£è¿›è¡Œç›‘å¬çš„æœåŠ¡Socketé€šé“ï¼Œå¹¶è®¾ç½®ä¸ºéé˜»å¡æ–¹å¼</span><br>        ServerSocketChannel ssc = ServerSocketChannel.open();<br>        <span class="hljs-comment">// å¿…é¡»é…ç½®ä¸ºéé˜»å¡æ‰èƒ½å¾€selectorä¸Šæ³¨å†Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œselectoræ¨¡å¼ç”­è¯´å°±æ˜¯éé˜»å¡æ¨¡å¼</span><br>        ssc.configureBlocking(<span class="hljs-keyword">false</span>); <br>        ssc.bind(<span class="hljs-keyword">new</span> InetSocketAddress(<span class="hljs-number">8888</span>));<br>        <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé€‰æ‹©å™¨selector</span><br>        Selector selector = selector.open();<br>        <span class="hljs-comment">// æŠŠServerSocketChannelæ³¨å†Œåˆ°selectorä¸Šï¼Œå¹¶ä¸”selectorå¯¹å®¢æˆ·ç«¯acceptè¿æ¥æ“ä½œæ„Ÿå…´è¶£</span><br>        ssc.register(selector, SelectionKey.OP_ACCEPT);<br><br>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>            System.out.println(<span class="hljs-string">&quot;ç­‰å¾…äº‹ä»¶å‘ç”Ÿ...&quot;</span>);<br>            <span class="hljs-comment">// è½®è¯¢ç›‘å¬channelé‡Œé¢çš„keyï¼Œselectæ˜¯é˜»å¡çš„ï¼Œacceptä¹Ÿæ˜¯é˜»å¡çš„</span><br>            <span class="hljs-keyword">int</span> select = selector.select(); <br><br>            System.out.println(<span class="hljs-string">&quot;äº‹ä»¶å‘ç”Ÿäº†...&quot;</span>);<br>            <span class="hljs-comment">// æœ‰å®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¢«è½®è¯¢ç›‘å¬åˆ°</span><br>            Iterator&lt;SelectionKey&gt; it = selector.selectionKeys().iterator();<br>            <span class="hljs-keyword">while</span>(it.hasNext())&#123;<br>                SelectionKey key = it.next();<br>                <span class="hljs-comment">// åˆ é™¤æœ¬æ¬¡å·²å¤„ç†çš„keyï¼Œ é˜²æ­¢ä¸‹æ¬¡selecté‡å¤å¤„ç†</span><br>                it.remove();<br>                handle(key);<br>            &#125;      <br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handle</span><span class="hljs-params">(SelectionKey key)</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;<br>        <span class="hljs-keyword">if</span>(key.isAcceptable())&#123;<br>            System.out.println(<span class="hljs-string">&quot;æœ‰å®¢æˆ·ç«¯è¿æ¥äº‹ä»¶å‘ç”Ÿäº†...&quot;</span>);<br>            ServerSocketChannel ssc = (ServerSocketChannel) key.channel();<br>            <span class="hljs-comment">// NIOéé˜»å¡ä½“ç°:æ­¤å¤„acceptæ–¹æ³•æ˜¯é˜»å¡çš„ï¼Œä½†æ˜¯è¿™é‡Œå› ä¸ºå‘ç”Ÿäº†è¿æ¥äº‹ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•ä¼šé©¬ä¸Šæ‰§è¡Œå®Œï¼Œä¸ä¼šé˜»å¡</span><br>            <span class="hljs-comment">// å¤„ç†å®Œè¿æ¥è¯·æ±‚ä¸ä¼šç»§ç»­ç­‰å¾…å®¢æˆ·ç«¯çš„æ•°æ®å‘é€</span><br>            SocketChannel sc = ssc.accept();<br>            sc.configureBlocking(<span class="hljs-keyword">false</span>);<br>            <span class="hljs-comment">// é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹è¯»äº‹ä»¶æ„Ÿå…´è¶£</span><br>            sc.register(selector, SelectionKey.OP_READ); <br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.isReadable())&#123;<br>            System.out.println(<span class="hljs-string">&quot;æœ‰å®¢æˆ·ç«¯æ•°æ®å¯è¯»äº‹ä»¶å‘ç”Ÿäº†...&quot;</span>);<br>            SocketChannel sc = (SocketChannel) key.channel();<br>            ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);<br>            <span class="hljs-comment">// NIOéé˜»å¡ä½“ç°ï¼šé¦–å…ˆreadæ–¹æ³•ä¸ä¼šé˜»å¡ï¼Œå…¶æ¬¡è¿™ç§äº‹ä»¶å“åº”æ¨¡å‹ï¼Œå½“è°ƒç”¨åˆ°readæ–¹æ³•æ—¶è‚¯å®šæ—¶å‘ç”Ÿäº†å®¢æˆ·ç«¯å‘é€æ•°æ®çš„äº‹ä»¶</span><br>            <span class="hljs-keyword">int</span> len = sc.read(buffer);<br>            <span class="hljs-keyword">if</span>(len != -<span class="hljs-number">1</span>)&#123;<br>                System.out.println(<span class="hljs-string">&quot;è¯»å–åˆ°å®¢æˆ·ç«¯å‘é€çš„æ•°æ®:&quot;</span> + <span class="hljs-keyword">new</span> String(buffer.array(), <span class="hljs-number">0</span>, len));<br>            &#125;<br>            ByteBuffer bufferToWrite = ByteBuffer.wrap(<span class="hljs-string">&quot;HelloClient&quot;</span>.getBytes());<br>            sc.write(bufferToWrite);<br>            key.interestOps(SelectionKey.OP_READ | SelectionKey.OP_WRITE);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(key.isWritable) &#123;<br>            SocketChannel sc = (SocketChannel) key.channel();<br>            System.out.println(<span class="hljs-string">&quot;writeäº‹ä»¶...&quot;</span>);<br>            <span class="hljs-comment">// NIOäº‹ä»¶è§¦å‘æ˜¯æ°´å¹³è§¦å‘</span><br>            <span class="hljs-comment">// ä½¿ç”¨Javaçš„NIOç¼–ç¨‹æ—¶ï¼Œåœ¨æ²¡æœ‰æ•°æ®å¯ä»¥å¾€å¤–å†™çš„æ—¶å€™è¦å–æ¶ˆå†™äº‹ä»¶</span><br>            <span class="hljs-comment">// åœ¨æœ‰æ•°æ®å¾€å¤–å†™çš„æ—¶å€™åœ¨æ³¨å†Œå†™äº‹ä»¶</span><br>            key.interestOps(SelectionKey.OP_READ);<br>            <span class="hljs-comment">// sc.close();</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>AIO å¼‚æ­¥éé˜»å¡IOã€‚è§£å†³äº†æœåŠ¡ç«¯éœ€è¦ä¸€ç›´å®ˆç€çº¿ç¨‹çš„é—®é¢˜ï¼Œå¯é æ€§æ˜¯æœ€å¥½çš„ï¼Œååé‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ï¼Œé€‚ç”¨äºè¿æ¥æ¯”è¾ƒå¤šä¸”æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰ã€‚ ä¾‹å¦‚ç›¸å†ŒæœåŠ¡å™¨ã€‚ JDK7å¼€å§‹æ”¯æŒã€‚</p><p>ç¼–ç¨‹æ¨¡å‹æ¯”è¾ƒç®€å•ï¼Œä½†éœ€è¦æ“ä½œç³»ç»Ÿæ¥æ”¯æŒå¼‚æ­¥æœåŠ¡ã€‚</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_AIO%E7%BB%93%E6%9E%84.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// æœåŠ¡ç«¯ä»£ç (äº†è§£)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AIOServer</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;<br>        <span class="hljs-keyword">final</span> AsynchronousServerSocketChannel serverChannel = AsynchronousServerSocketChannel.open().bind(<span class="hljs-keyword">new</span> InewSocketAddress(<span class="hljs-number">9000</span>));<br>        <br>        serverChannel.accept(<span class="hljs-keyword">null</span>, <span class="hljs-keyword">new</span> CompletionHander&lt;AsynchronousServerSocketChannel, Object&gt;())&#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">completed</span><span class="hljs-params">(AsynchronousServerSocketChannel socketChannel, Object attachment)</span></span>&#123;<br>                <span class="hljs-keyword">try</span>&#123;<br>                    <span class="hljs-comment">// å†æ¬¡æ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼Œå¦‚æœä¸å†™è¿™ä¸€è¡Œä»£ç åé¢çš„å®¢æˆ·ç«¯è¿æ¥ä¸ä¸ŠæœåŠ¡å™¨ç«¯</span><br>                    serverChannel.accept(attachment, <span class="hljs-keyword">this</span>);<br>                    System.out.println(socketChannel.getRemoteAddress());<br>                    ByteBuffer buffer = ByteBuffer.allocate(<span class="hljs-number">1024</span>);<br>                    socketChannel.read(buffer, buffer, <span class="hljs-keyword">new</span> CompletionHandler&lt;Integer, ByteBuffer&gt;()&#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">completed</span><span class="hljs-params">(Integer result, ByteBuffer buffer)</span></span>&#123;<br>                            buffer.flip();<br>                            System.out.println(<span class="hljs-keyword">new</span> String(buffer.array(), <span class="hljs-number">0</span>, result));<br>                            socketChannel.write(ByteBuffer.wrap(<span class="hljs-string">&quot;HelloClient&quot;</span>.getBytes()));<br>                        &#125;<br>                        <br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">failed</span><span class="hljs-params">(Throwable exc, ByteBuffer buffer)</span> </span>&#123;exc.printStackTrace();&#125;<br>                    &#125;);<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">failed</span><span class="hljs-params">(Throwable exc, ByteBuffer buffer)</span> </span>&#123;exc.printStackTrace();&#125;<br>        &#125;);<br>        <br>        Thread.sleep(Integer.MAX_VALUE);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="3-BIO-NIOåŒºåˆ«"><a href="#3-BIO-NIOåŒºåˆ«" class="headerlink" title="3. BIO/NIOåŒºåˆ«"></a>3. BIO/NIOåŒºåˆ«</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/4_%E5%AF%B9%E6%AF%94.png"></p><h2 id="4-BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯"><a href="#4-BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯" class="headerlink" title="4. BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯"></a>4. BIOã€NIOã€AIOé€‚ç”¨åœºæ™¯</h2><ul><li>BIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®æ¯”è¾ƒå°ä¸”å›ºå®šçš„æ¶æ„ï¼Œè¿™ç§æ–¹å¼å¯¹æœåŠ¡å™¨èµ„æºè¦æ±‚æ¯”è¾ƒé«˜ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼ŒJDK1.4ä»¥å‰çš„å”¯ä¸€é€‰æ‹©ã€‚</li><li>NIOæ–¹å¼é€‚ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒçŸ­ï¼ˆè½»æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚èŠå¤©æœåŠ¡å™¨ï¼Œå¹¶å‘å±€é™äºåº”ç”¨ä¸­ï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ã€‚</li><li>AIOæ–¹å¼ä½¿ç”¨äºè¿æ¥æ•°ç›®å¤šä¸”è¿æ¥æ¯”è¾ƒé•¿ï¼ˆé‡æ“ä½œï¼‰çš„æ¶æ„ï¼Œæ¯”å¦‚ç›¸å†ŒæœåŠ¡å™¨ï¼Œå……åˆ†è°ƒç”¨OSå‚ä¸å¹¶å‘æ“ä½œï¼Œç¼–ç¨‹æ¯”è¾ƒå¤æ‚ï¼ŒJDK7å¼€å§‹æ”¯æŒã€‚</li></ul><h2 id="5-Java-NIOçš„3ä¸ªæ ¸å¿ƒç»„ä»¶"><a href="#5-Java-NIOçš„3ä¸ªæ ¸å¿ƒç»„ä»¶" class="headerlink" title="5. Java NIOçš„3ä¸ªæ ¸å¿ƒç»„ä»¶"></a>5. Java NIOçš„3ä¸ªæ ¸å¿ƒç»„ä»¶</h2><blockquote><p>NIOé‡ç‚¹:</p><p>Channelï¼ˆé€šé“ï¼‰ï¼ŒBufferï¼ˆç¼“å†²åŒºï¼‰ï¼ŒSelectorï¼ˆé€‰æ‹©å™¨ï¼‰ä¸‰ä¸ªç±»ä¹‹é—´çš„å…³ç³»</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/7_NIO%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8.png"></p><blockquote><p>ç®€å•è§£é‡Šï¼š</p></blockquote><ul><li><p>æ¯ä¸€ä¸ªchannelå¯¹åº”ä¸€ä¸ªbufferç¼“å†²åŒºã€‚</p></li><li><p>channelä¼šæ³¨å†Œåˆ°selectorã€‚</p></li><li><p>selectorä¼šæ ¹æ®channelä¸Šå‘ç”Ÿçš„è¯»å†™äº‹ä»¶ï¼Œå°†è¯·æ±‚äº¤ç”±æŸä¸€ä¸ªç©ºé—²çº¿ç¨‹å¤„ç†ã€‚</p></li><li><p>selectorå¯¹åº”ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹ã€‚</p></li><li><p>bufferå’Œchanneléƒ½æ˜¯å¯è¯»å¯å†™çš„ã€‚</p></li></ul><h3 id="5-1-ç¼“å†²åŒºBuffer"><a href="#5-1-ç¼“å†²åŒºBuffer" class="headerlink" title="5.1 ç¼“å†²åŒºBuffer"></a>5.1 ç¼“å†²åŒºBuffer</h3><p>Bufferæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚å®ƒåŒ…å«ä¸€äº›è¦å†™å…¥æˆ–è€…è¯»å‡ºçš„æ•°æ®ã€‚åœ¨é¢å‘æµçš„I/Oä¸­ï¼Œå¯ä»¥å°†æ•°æ®å†™å…¥æˆ–è€…å°†æ•°æ®ç›´æ¥è¯»åˆ°Streamå¯¹è±¡ä¸­ã€‚</p><p>åœ¨NIOä¸­ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯ç”¨ç¼“å†²åŒºå¤„ç†ã€‚è¿™ä¹Ÿå°±æœ¬æ–‡ä¸Šé¢è°ˆåˆ°çš„IOæ˜¯é¢å‘æµçš„ï¼ŒNIOæ˜¯é¢å‘ç¼“å†²åŒºçš„ã€‚</p><p>ç¼“å†²åŒºå®è´¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé€šå¸¸å®ƒæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼ˆByteBufferï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ç±»çš„æ•°ç»„ã€‚ä½†æ˜¯ä¸€ä¸ªç¼“å†²åŒºä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç¼“å†²åŒºæä¾›äº†å¯¹æ•°æ®çš„ç»“æ„åŒ–è®¿é—®ä»¥åŠç»´æŠ¤è¯»å†™ä½ç½®ï¼ˆlimitï¼‰ç­‰ä¿¡æ¯ã€‚</p><p>æœ€å¸¸ç”¨çš„ç¼“å†²åŒºæ˜¯ByteBufferï¼Œä¸€ä¸ªByteBufferæä¾›äº†ä¸€ç»„åŠŸèƒ½äºæ“ä½œbyteæ•°ç»„ã€‚é™¤äº†ByteBufferï¼Œè¿˜æœ‰å…¶ä»–çš„ä¸€äº›ç¼“å†²åŒºï¼Œäº‹å®ä¸Šï¼Œæ¯ä¸€ç§JavaåŸºæœ¬ç±»å‹ï¼ˆé™¤äº†Booleanï¼‰éƒ½å¯¹åº”ä¸€ç§ç¼“å†²åŒºï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li>ByteBufferï¼šå­—èŠ‚ç¼“å†²åŒº</li><li>CharBuffer:å­—ç¬¦ç¼“å†²åŒº</li><li>ShortBufferï¼šçŸ­æ•´å‹ç¼“å†²åŒº</li><li>IntBufferï¼šæ•´å‹ç¼“å†²åŒº</li><li>LongBuffer:é•¿æ•´å‹ç¼“å†²åŒº</li><li>FloatBufferï¼šæµ®ç‚¹å‹ç¼“å†²åŒº</li><li>DoubleBufferï¼šåŒç²¾åº¦æµ®ç‚¹å‹ç¼“å†²åŒº</li></ul><h3 id="5-2-é€šé“Channel"><a href="#5-2-é€šé“Channel" class="headerlink" title="5.2 é€šé“Channel"></a>5.2 é€šé“Channel</h3><p>Channelæ˜¯ä¸€ä¸ªé€šé“ï¼Œå¯ä»¥é€šè¿‡å®ƒè¯»å–å’Œå†™å…¥æ•°æ®ï¼Œä»–å°±åƒè‡ªæ¥æ°´ç®¡ä¸€æ ·ï¼Œç½‘ç»œæ•°æ®é€šè¿‡Channelè¯»å–å’Œå†™å…¥ã€‚</p><p>é€šé“å’Œæµä¸åŒä¹‹å¤„åœ¨äºé€šé“æ˜¯åŒå‘çš„ï¼Œæµåªæ˜¯åœ¨ä¸€ä¸ªæ–¹å‘ç§»åŠ¨ï¼Œè€Œä¸”é€šé“å¯ä»¥ç”¨äºè¯»ï¼Œå†™æˆ–è€…åŒæ—¶ç”¨äºè¯»å†™ã€‚</p><p>å› ä¸ºChannelæ˜¯å…¨åŒå·¥çš„ï¼Œæ‰€ä»¥å®ƒæ¯”æµæ›´å¥½åœ°æ˜ å°„åº•å±‚æ“ä½œç³»ç»Ÿçš„APIï¼Œç‰¹åˆ«æ˜¯åœ¨UNIXç½‘ç»œç¼–ç¨‹ä¸­ï¼Œåº•å±‚æ“ä½œç³»ç»Ÿçš„é€šé“éƒ½æ˜¯å…¨åŒå·¥çš„ï¼ŒåŒæ—¶æ”¯æŒè¯»å’Œå†™ã€‚</p><p>Channelæœ‰å››ç§å®ç°ï¼š</p><ul><li>FileChannel:æ˜¯ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚</li><li>DatagramChannel:ä»UDPç½‘ç»œä¸­è¯»å–æˆ–è€…å†™å…¥æ•°æ®ã€‚</li><li>SocketChannel:ä»TCPç½‘ç»œä¸­è¯»å–æˆ–è€…å†™å…¥æ•°æ®ã€‚</li><li>ServerSocketChannel:å…è®¸ä½ ç›‘å¬æ¥è‡ªTCPçš„è¿æ¥ï¼Œå°±åƒæœåŠ¡å™¨ä¸€æ ·ã€‚æ¯ä¸€ä¸ªè¿æ¥éƒ½ä¼šæœ‰ä¸€ä¸ªSocketChanneläº§ç”Ÿã€‚</li></ul><h3 id="5-3-å¤šè·¯å¤ç”¨å™¨Selector"><a href="#5-3-å¤šè·¯å¤ç”¨å™¨Selector" class="headerlink" title="5.3 å¤šè·¯å¤ç”¨å™¨Selector"></a>5.3 å¤šè·¯å¤ç”¨å™¨Selector</h3><p>Selectoré€‰æ‹©å™¨å¯ä»¥ç›‘å¬å¤šä¸ªChannelé€šé“æ„Ÿå…´è¶£çš„äº‹æƒ…(readã€writeã€accept(æœåŠ¡ç«¯æ¥æ”¶)ã€connectï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªChannelï¼ŒèŠ‚çœçº¿ç¨‹åˆ‡æ¢ä¸Šä¸‹æ–‡çš„èµ„æºæ¶ˆè€—ã€‚Selectoråªèƒ½ç®¡ç†éé˜»å¡çš„é€šé“ï¼ŒFileChannelæ˜¯é˜»å¡çš„ï¼Œæ— æ³•ç®¡ç†ã€‚</p><p><strong>å…³é”®å¯¹è±¡</strong></p><ul><li>Selectorï¼šé€‰æ‹©å™¨å¯¹è±¡ï¼Œé€šé“æ³¨å†Œã€é€šé“ç›‘å¬å¯¹è±¡å’ŒSelectorç›¸å…³ã€‚</li><li>SelectorKeyï¼šé€šé“ç›‘å¬å…³é”®å­—ï¼Œé€šè¿‡å®ƒæ¥ç›‘å¬é€šé“çŠ¶æ€ã€‚</li></ul><p><strong>ç›‘å¬æ³¨å†Œ</strong></p><p>ç›‘å¬æ³¨å†Œåœ¨Selector</p><blockquote><p>socketChannel.register(selector, SelectionKey.OP_READ);</p></blockquote><p><strong>ç›‘å¬çš„äº‹ä»¶æœ‰</strong></p><ul><li>OP_ACCEPT: æ¥æ”¶å°±ç»ªï¼ŒserviceSocketChannelä½¿ç”¨çš„</li><li>OP_READ: è¯»å–å°±ç»ªï¼ŒsocketChannelä½¿ç”¨</li><li>OP_WRITE: å†™å…¥å°±ç»ªï¼ŒsocketChannelä½¿ç”¨</li><li>OP_CONNECT: è¿æ¥å°±ç»ªï¼ŒsocketChannelä½¿ç”¨</li></ul><h3 id="5-4-NIOçš„ä¸€äº›åº”ç”¨å’Œæ¡†æ¶"><a href="#5-4-NIOçš„ä¸€äº›åº”ç”¨å’Œæ¡†æ¶" class="headerlink" title="5.4 NIOçš„ä¸€äº›åº”ç”¨å’Œæ¡†æ¶"></a>5.4 NIOçš„ä¸€äº›åº”ç”¨å’Œæ¡†æ¶</h3><p>ä¾‹å¦‚ï¼šDubbo(æœåŠ¡æ¡†æ¶)ï¼Œå°±é»˜è®¤ä½¿ç”¨Nettyä½œä¸ºåŸºç¡€é€šä¿¡ç»„ä»¶ï¼Œç”¨äºå®ç°å„è¿›ç¨‹èŠ‚ç‚¹ä¹‹é—´çš„å†…éƒ¨é€šä¿¡ã€‚</p><p>Jettyã€Minaã€Nettyã€Dubboã€ZooKeeperç­‰éƒ½æ˜¯åŸºäºNIOæ–¹å¼å®ç°</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>UNIXÂ® Network Programming Volume 1, Third Edition: The Sockets Networkingï¼ŒRichard Stevensï¼Œ6.2èŠ‚ I/O Models<a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://blog.csdn.net/historyasamirror/article/details/5778378">https://blog.csdn.net/historyasamirror/article/details/5778378</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://zhuanlan.zhihu.com/p/83597838">https://zhuanlan.zhihu.com/p/83597838</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span><a href="https://zhuanlan.zhihu.com/p/112810033">https://zhuanlan.zhihu.com/p/112810033</a><a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>IO</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Network</tag>
      
      <tag>IO</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLå¹¶å‘æ—¶ç»å…¸çš„æ­»é”åŠè§£å†³æ–¹æ³•</title>
    <link href="/2021/03/15/MySQL%E5%B9%B6%E5%8F%91%E6%97%B6%E7%BB%8F%E5%85%B8%E5%B8%B8%E8%A7%81%E7%9A%84%E6%AD%BB%E9%94%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <url>/2021/03/15/MySQL%E5%B9%B6%E5%8F%91%E6%97%B6%E7%BB%8F%E5%85%B8%E5%B8%B8%E8%A7%81%E7%9A%84%E6%AD%BB%E9%94%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="MySQLå¹¶å‘æ—¶ç»å…¸çš„æ­»é”åŠè§£å†³æ–¹æ³•"><a href="#MySQLå¹¶å‘æ—¶ç»å…¸çš„æ­»é”åŠè§£å†³æ–¹æ³•" class="headerlink" title="MySQLå¹¶å‘æ—¶ç»å…¸çš„æ­»é”åŠè§£å†³æ–¹æ³•"></a>MySQLå¹¶å‘æ—¶ç»å…¸çš„æ­»é”åŠè§£å†³æ–¹æ³•</h1><h2 id="1-MySQLéƒ½æœ‰é”åˆ†ç±»"><a href="#1-MySQLéƒ½æœ‰é”åˆ†ç±»" class="headerlink" title="1. MySQLéƒ½æœ‰é”åˆ†ç±»"></a>1. MySQLéƒ½æœ‰é”åˆ†ç±»</h2><blockquote><p>MySQLæœ‰ä¸‰ç§é”çš„çº§åˆ«ï¼šé¡µçº§ã€è¡¨çº§ã€è¡Œçº§ã€‚</p></blockquote><ul><li><p>è¡¨çº§é”ï¼šå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜,å¹¶å‘åº¦æœ€ä½ã€‚</p></li><li><p>è¡Œçº§é”ï¼šå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</p></li><li><p>é¡µé¢é”ï¼šå¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬</p></li></ul><blockquote><p>ç®—æ³•</p></blockquote><ul><li><p>Next-KeyLocksé”ï¼ŒåŒæ—¶é”ä½è®°å½•(æ•°æ®)ï¼Œå¹¶ä¸”é”ä½è®°å½•å‰é¢çš„Gap   </p></li><li><p>Gapé”ï¼Œä¸é”è®°å½•ï¼Œä»…ä»…è®°å½•å‰é¢çš„Gap</p></li><li><p>Recordlocké”ï¼ˆé”æ•°æ®ï¼Œä¸é”Gapï¼‰</p></li></ul><p>æ€»ç»“ï¼šæ‰€ä»¥å…¶å® Next-KeyLocks = Gapé” + Recordlocké”</p><h2 id="2-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šé€ æˆæ­»é”"><a href="#2-ä»€ä¹ˆæƒ…å†µä¸‹ä¼šé€ æˆæ­»é”" class="headerlink" title="2. ä»€ä¹ˆæƒ…å†µä¸‹ä¼šé€ æˆæ­»é”"></a>2. ä»€ä¹ˆæƒ…å†µä¸‹ä¼šé€ æˆæ­»é”</h2><blockquote><p>æ‰€è°“æ­»é”<DeadLock>: </p><p>æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­,<br>å› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡,è‹¥æ— å¤–åŠ›ä½œç”¨,å®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å».<br>æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”,è¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹.<br>è¡¨çº§é”ä¸ä¼šäº§ç”Ÿæ­»é”.æ‰€ä»¥è§£å†³æ­»é”ä¸»è¦è¿˜æ˜¯é’ˆå¯¹äºæœ€å¸¸ç”¨çš„InnoDB.</p></blockquote><p>æ­»é”çš„å…³é”®åœ¨äºï¼š<strong>ä¸¤ä¸ª(æˆ–ä»¥ä¸Š)çš„SessionåŠ é”çš„é¡ºåºä¸ä¸€è‡´</strong>ã€‚</p><p>é‚£ä¹ˆå¯¹åº”çš„è§£å†³æ­»é”é—®é¢˜çš„å…³é”®å°±æ˜¯ï¼šè®©ä¸åŒçš„sessionåŠ é”æœ‰æ¬¡åº</p><h2 id="3-ä¸€äº›å¸¸è§çš„æ­»é”æ¡ˆä¾‹"><a href="#3-ä¸€äº›å¸¸è§çš„æ­»é”æ¡ˆä¾‹" class="headerlink" title="3.  ä¸€äº›å¸¸è§çš„æ­»é”æ¡ˆä¾‹"></a>3.  ä¸€äº›å¸¸è§çš„æ­»é”æ¡ˆä¾‹</h2><h3 id="3-1-æ¡ˆä¾‹ä¸€"><a href="#3-1-æ¡ˆä¾‹ä¸€" class="headerlink" title="3.1 æ¡ˆä¾‹ä¸€"></a>3.1 æ¡ˆä¾‹ä¸€</h3><p>éœ€æ±‚ï¼šå°†æŠ•èµ„çš„é’±æ‹†æˆå‡ ä»½éšæœºåˆ†é…ç»™å€Ÿæ¬¾äººã€‚</p><p>èµ·åˆä¸šåŠ¡ç¨‹åºæ€è·¯æ˜¯è¿™æ ·çš„ï¼š</p><p>æŠ•èµ„äººæŠ•èµ„åï¼Œå°†é‡‘é¢éšæœºåˆ†ä¸ºå‡ ä»½ï¼Œç„¶åéšæœºä»å€Ÿæ¬¾äººè¡¨é‡Œé¢é€‰å‡ ä¸ªï¼Œç„¶åé€šè¿‡ä¸€æ¡æ¡select for update å»æ›´æ–°å€Ÿæ¬¾äººè¡¨é‡Œé¢çš„ä½™é¢ç­‰ã€‚</p><p>æŠ½è±¡å‡ºæ¥å°±æ˜¯ä¸€ä¸ªsessioné€šè¿‡forå¾ªç¯ä¼šæœ‰å‡ æ¡å¦‚ä¸‹çš„è¯­å¥ï¼š</p><p>Select * from xxx where id=â€™éšæœºidâ€™ for update</p><p>åŸºæœ¬æ¥è¯´ï¼Œç¨‹åºå¼€å¯åä¸ä¸€ä¼šå°±æ­»é”ã€‚</p><p>è¿™å¯ä»¥æ˜¯è¯´æœ€ç»å…¸çš„æ­»é”æƒ…å½¢äº†ã€‚</p><p>ä¾‹å¦‚ä¸¤ä¸ªç”¨æˆ·åŒæ—¶æŠ•èµ„ï¼ŒAç”¨æˆ·é‡‘é¢éšæœºåˆ†ä¸º2ä»½ï¼Œåˆ†ç»™å€Ÿæ¬¾äºº1ï¼Œ2</p><p>Bç”¨æˆ·é‡‘é¢éšæœºåˆ†ä¸º2ä»½ï¼Œåˆ†ç»™å€Ÿæ¬¾äºº2ï¼Œ1</p><p>ç”±äºåŠ é”çš„é¡ºåºä¸ä¸€æ ·ï¼Œæ­»é”å½“ç„¶å¾ˆå¿«å°±å‡ºç°äº†ã€‚</p><p><strong>å¯¹äºè¿™ä¸ªé—®é¢˜çš„æ”¹è¿›å¾ˆç®€å•ï¼Œç›´æ¥æŠŠæ‰€æœ‰åˆ†é…åˆ°çš„å€Ÿæ¬¾äººç›´æ¥ä¸€æ¬¡é”ä½å°±è¡Œäº†ã€‚</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">Select * from xxx where id in (xx,xx,xx) for update<br></code></pre></td></tr></table></figure><p>åœ¨iné‡Œé¢çš„åˆ—è¡¨å€¼mysqlæ˜¯ä¼šè‡ªåŠ¨ä»å°åˆ°å¤§æ’åºï¼ŒåŠ é”ä¹Ÿæ˜¯ä¸€æ¡æ¡ä»å°åˆ°å¤§åŠ çš„é”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ä¾‹å¦‚ï¼ˆä»¥ä¸‹ä¼šè¯idä¸ºä¸»é”®ï¼‰ï¼š<br><br>Session1:<br><br>mysql&gt; select * from t3 where id in (8,9) for update;<br><br>+----+--------+------+---------------------+<br><br>| id | course | name | ctime               |<br><br>+----+--------+------+---------------------+<br><br>|  8 | WA     | f    | 2016-03-02 11:36:30 |<br><br>|  9 | JX     | f    | 2016-03-01 11:36:30 |<br><br>+----+--------+------+---------------------+<br><br>2 rows in set (0.04 sec)<br><br> <br><br> <br><br>Session2:<br><br>select * from t3 where id in (10,8,5) for update;<br><br>é”ç­‰å¾…ä¸­â€¦â€¦<br><br>å…¶å®è¿™ä¸ªæ—¶å€™id&#x3D;10è¿™æ¡è®°å½•æ²¡æœ‰è¢«é”ä½çš„ï¼Œä½†id&#x3D;5çš„è®°å½•å·²ç»è¢«é”ä½äº†ï¼Œé”çš„ç­‰å¾…åœ¨id&#x3D;8çš„è¿™é‡Œã€‚<br><br> <br><br>ä¸ä¿¡è¯·çœ‹<br><br>Session3:<br><br>mysql&gt; select * from t3 where id&#x3D;5 for update;<br><br>é”ç­‰å¾…ä¸­<br><br> <br><br>Session4:<br><br>mysql&gt; select * from t3 where id&#x3D;10 for update;<br><br>+----+--------+------+---------------------+<br><br>| id | course | name | ctime               |<br><br>+----+--------+------+---------------------+<br><br>| 10 | JB     | g    | 2016-03-10 11:45:05 |<br><br>+----+--------+------+---------------------+<br><br>1 row in set (0.00 sec)<br><br> <br><br>åœ¨å…¶å®ƒsessionä¸­id&#x3D;5æ˜¯åŠ ä¸äº†é”çš„ï¼Œä½†æ˜¯id&#x3D;10æ˜¯å¯ä»¥åŠ ä¸Šé”çš„ã€‚<br></code></pre></td></tr></table></figure><h3 id="3-2-æ¡ˆä¾‹äºŒ"><a href="#3-2-æ¡ˆä¾‹äºŒ" class="headerlink" title="3.2 æ¡ˆä¾‹äºŒ"></a>3.2 æ¡ˆä¾‹äºŒ</h3><p>åœ¨å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šåšè¿™ç±»çš„åˆ¤æ–­éœ€æ±‚ï¼šæ ¹æ®å­—æ®µå€¼æŸ¥è¯¢ï¼ˆæœ‰ç´¢å¼•ï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥ï¼›å¦åˆ™æ›´æ–°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs mysql">ä»¥idä¸ºä¸»é”®ä¸ºä¾‹ï¼Œç›®å‰è¿˜æ²¡æœ‰id&#x3D;22çš„è¡Œ<br><br>Session1:<br><br>select * from t3 where id&#x3D;22 for update;<br><br>Empty set (0.00 sec)<br><br> <br><br>session2:<br><br>select * from t3 where id&#x3D;23  for update;<br><br>Empty set (0.00 sec)<br><br> <br><br>Session1:<br><br>insert into t3 values(22,&#39;ac&#39;,&#39;a&#39;,now());<br><br>é”ç­‰å¾…ä¸­â€¦â€¦<br><br> <br><br>Session2:<br><br>insert into t3 values(23,&#39;bc&#39;,&#39;b&#39;,now());<br><br>ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction<br></code></pre></td></tr></table></figure><p>å½“å¯¹<font color="FF0000">å­˜åœ¨çš„è¡Œ</font>è¿›è¡Œé”çš„æ—¶å€™(ä¸»é”®)ï¼Œmysqlå°±åªæœ‰è¡Œé”ã€‚</p><p>å½“å¯¹<font color="FF0000">æœªå­˜åœ¨çš„è¡Œ</font>è¿›è¡Œé”çš„æ—¶å€™(å³ä½¿æ¡ä»¶ä¸ºä¸»é”®)ï¼Œmysqlæ˜¯ä¼šé”ä½ä¸€æ®µèŒƒå›´ï¼ˆæœ‰Gapé”ï¼‰</p><blockquote><p>é”ä½çš„èŒƒå›´ä¸ºï¼š</p><p>(æ— ç©·å°æˆ–å°äºè¡¨ä¸­é”ä½idçš„æœ€å¤§å€¼ï¼Œæ— ç©·å¤§æˆ–å¤§äºè¡¨ä¸­é”ä½idçš„æœ€å°å€¼)</p></blockquote><p>å¦‚ï¼šå¦‚æœè¡¨ä¸­ç›®å‰æœ‰å·²æœ‰çš„idä¸ºï¼ˆ11 ï¼Œ 12ï¼‰</p><p>é‚£ä¹ˆå°±é”ä½ï¼ˆ12ï¼Œæ— ç©·å¤§ï¼‰</p><p>å¦‚æœè¡¨ä¸­ç›®å‰å·²æœ‰çš„idä¸ºï¼ˆ11 ï¼Œ 30ï¼‰</p><p>é‚£ä¹ˆå°±é”ä½ï¼ˆ11ï¼Œ30ï¼‰</p><p><strong>å¯¹äºè¿™ç§æ­»é”çš„è§£å†³åŠæ³•æ˜¯ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">insert into t3(xx,xx) on duplicate key update xx&#x3D;&#39;XX&#39;;<br></code></pre></td></tr></table></figure><p>ç”¨mysqlç‰¹æœ‰çš„è¯­æ³•æ¥è§£å†³æ­¤é—®é¢˜ã€‚å› ä¸ºinsertè¯­å¥å¯¹äºä¸»é”®æ¥è¯´ï¼Œæ’å…¥çš„è¡Œä¸ç®¡æœ‰æ²¡æœ‰å­˜åœ¨ï¼Œéƒ½ä¼šåªæœ‰è¡Œé”ã€‚</p><h3 id="3-3-æ¡ˆä¾‹ä¸‰"><a href="#3-3-æ¡ˆä¾‹ä¸‰" class="headerlink" title="3.3 æ¡ˆä¾‹ä¸‰"></a>3.3 æ¡ˆä¾‹ä¸‰</h3><p>ç›´æ¥ä¸Šæƒ…æ™¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql&gt; select * from t3 where id&#x3D;9 for update;<br><br>+----+--------+------+---------------------+<br><br>| id | course | name | ctime               |<br><br>+----+--------+------+---------------------+<br><br>|  9 | JX     | f    | 2016-03-01 11:36:30 |<br><br>+----+--------+------+---------------------+<br><br>1 row in set (0.00 sec)<br><br> <br><br>Session2:<br><br>mysql&gt; select * from t3 where id&lt;20 for update;<br><br>é”ç­‰å¾…ä¸­<br><br> <br><br>Session1:<br><br>mysql&gt; insert into t3 values(7,&#39;ae&#39;,&#39;a&#39;,now());<br><br>ERROR 1213 (40001): Deadlock found when trying to get lock; try restarting transaction<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªè·Ÿæ¡ˆä¾‹ä¸€å…¶å®ƒæ˜¯å·®ä¸å¤šçš„æƒ…å†µï¼Œåªæ˜¯session1ä¸æŒ‰å¸¸ç†å‡ºç‰Œäº†ï¼Œ</p><p>Session2åœ¨ç­‰å¾…Session1çš„id=9çš„é”ï¼Œsession2åˆæŒäº†1åˆ°8çš„é”ï¼ˆæ³¨æ„9åˆ°19çš„èŒƒå›´å¹¶æ²¡æœ‰è¢«session2é”ä½ï¼‰ï¼Œæœ€åï¼Œsession1åœ¨æ’å…¥æ–°è¡Œæ—¶åˆå¾—ç­‰å¾…session2,æ•…æ­»é”å‘ç”Ÿäº†ã€‚</p><p>è¿™ç§ä¸€èˆ¬æ˜¯åœ¨ä¸šåŠ¡éœ€æ±‚ä¸­åŸºæœ¬ä¸ä¼šå‡ºç°ï¼Œå› ä¸ºä½ é”ä½äº†id=9ï¼Œå´åˆæƒ³æ’å…¥id=7çš„è¡Œï¼Œè¿™å°±æœ‰ç‚¹è·³äº†ï¼Œå½“ç„¶è‚¯å®šä¹Ÿæœ‰è§£å†³çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯é‡ç†ä¸šåŠ¡éœ€æ±‚ï¼Œé¿å…è¿™æ ·çš„å†™æ³•ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.cnblogs.com/zejin2008/p/5262751.html%E8%BD%AC%E8%BD%BD%E8%AF%A5%E6%96%87">https://www.cnblogs.com/zejin2008/p/5262751.htmlè½¬è½½è¯¥æ–‡</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDEA æ–­ç‚¹è°ƒè¯•æŠ€å·§</title>
    <link href="/2021/03/15/IDEA%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95/"/>
    <url>/2021/03/15/IDEA%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95/</url>
    
    <content type="html"><![CDATA[<h1 id="IDEA-æ–­ç‚¹è°ƒè¯•æŠ€å·§"><a href="#IDEA-æ–­ç‚¹è°ƒè¯•æŠ€å·§" class="headerlink" title="IDEA æ–­ç‚¹è°ƒè¯•æŠ€å·§"></a>IDEA æ–­ç‚¹è°ƒè¯•æŠ€å·§</h1><p>ç®€å•è®°å½•ä¸€ä¸‹IDEAæœ€å¸¸ç”¨åˆ°çš„debugæ–¹å¼<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://www.bilibili.com/video/BV1ur4y1P7SV?">[1]</span></a></sup></p><h1 id="1-è¡Œæ–­ç‚¹"><a href="#1-è¡Œæ–­ç‚¹" class="headerlink" title="1. è¡Œæ–­ç‚¹"></a>1. è¡Œæ–­ç‚¹</h1><p>æ™®é€šåœ¨å·¦ä¾§æ‰“çš„æ–­ç‚¹å°±æ˜¯è¡Œæ–­ç‚¹</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/1_%E8%A1%8C%E6%96%AD%E7%82%B9.png"></p><h1 id="2-è¯¦ç»†æ–­ç‚¹-æºæ–­ç‚¹"><a href="#2-è¯¦ç»†æ–­ç‚¹-æºæ–­ç‚¹" class="headerlink" title="2. è¯¦ç»†æ–­ç‚¹ | æºæ–­ç‚¹"></a>2. è¯¦ç»†æ–­ç‚¹ | æºæ–­ç‚¹</h1><p>æŒ‰ä½<code>shift</code>é”®åŠ ä¸Šé¼ æ ‡ç‚¹å‡»ä»£ç å·¦ä¾§å‡ºç°ä¸‹å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/2_%E8%A1%8C%E6%96%AD%E7%82%B9.png"></p><ul><li><p>å¦‚æœæˆ‘ä»¬åªå‹¾é€‰Enabledï¼Œå†ç‚¹å‡»å³ä¸‹è§’doneï¼Œåˆ™è°ƒè¯•æ•ˆæœå¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/3_%E8%A1%8C%E6%96%AD%E7%82%B9.png"></p><ul><li>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥æ–­ç‚¹å¹¶æ²¡æœ‰æŒ‚èµ·ï¼Œåªæ˜¯æ‰“å‡ºæ–­ç‚¹æ‰€è§¦å‘çš„ä½ç½®ï¼ˆå…·ä½“çš„ç±»åŠæ‰€åœ¨æ–¹æ³•ï¼‰</li></ul></li><li><p>å‹¾é€‰Suspendï¼ˆæŒ‚èµ·ï¼‰å’ŒAllï¼Œå†ç‚¹å‡»å³doneï¼Œå®é™…å°±æ˜¯æ‰“äº†æ™®é€šè¡Œæ–­ç‚¹ï¼Œå…¨éƒ¨çº¿ç¨‹éƒ½ä¼šåœæ­¢</p></li><li><p>å‹¾é€‰Suspendï¼ˆæŒ‚èµ·ï¼‰å’ŒThreadï¼Œå†ç‚¹å‡»doneï¼Œåªæœ‰<strong>å½“å‰çº¿ç¨‹æ‰ä¼šåœ¨è¯¥æ–­ç‚¹åœæ­¢</strong></p></li><li><p>conditionä¸­å¯ä»¥æ·»åŠ ä¸€äº›if elseæ¡ä»¶åˆ¤æ–­ï¼Œä½†è§¦å‘æ¡ä»¶æ‰ä¼šåœæ­¢ï¼ˆé«˜é˜¶ç”¨æ³•ï¼‰</p></li></ul><h1 id="3-æ–¹æ³•æ–­ç‚¹-æ¥å£è·³è½¬å®ç°ç±»"><a href="#3-æ–¹æ³•æ–­ç‚¹-æ¥å£è·³è½¬å®ç°ç±»" class="headerlink" title="3. æ–¹æ³•æ–­ç‚¹ | æ¥å£è·³è½¬å®ç°ç±»"></a>3. æ–¹æ³•æ–­ç‚¹ | æ¥å£è·³è½¬å®ç°ç±»</h1><ul><li><p>æ–¹æ³•æ–­ç‚¹æ—¢åœ¨æ–¹æ³•å·¦ä¾§æ‰“çš„æ–­ç‚¹ï¼Œå¦‚ä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/4_%E8%A1%8C%E6%96%AD%E7%82%B9.png"></p><ul><li><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œè¯¥æ–­ç‚¹åœ¨è¿›å…¥æ–¹æ³•ç¬¬ä¸€å¥å’Œæ–¹æ³•è¿”å›çš„æœ€åä¸€å¥éƒ½ä¼šåœæ­¢</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_%E6%96%B9%E6%B3%95%E6%96%AD%E7%82%B9.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_%E6%96%B9%E6%B3%95%E6%96%AD%E7%82%B92.png"></p></li></ul></li></ul><ul><li><p>å¦‚æœæ˜¯åœ¨æ¥å£çš„æ–¹æ³•æ‰“æ–¹æ³•æ–­ç‚¹ï¼Œåˆ™ä¼šè·³è½¬åˆ°ç›¸åº”çš„å®ç°ç±»çš„æ–¹æ³•ç¬¬ä¸€å¥å’Œè¿”å›å‡ºåœæ­¢</p><ul><li>å› æ­¤å½“æˆ‘ä»¬ä¸çŸ¥é“å…·ä½“æ˜¯å“ªä¸€ä¸ªå®ç°ç±»æ—¶å¯ä»¥ç›´æ¥åœ¨æ¥å£æ‰“æ–¹æ³•æ–­ç‚¹</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_%E6%96%B9%E6%B3%95%E6%96%AD%E7%82%B93.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/5_%E6%96%B9%E6%B3%95%E6%96%AD%E7%82%B94.png"></p></li></ul><h1 id="4-å¼‚å¸¸æ–­ç‚¹-å…¨å±€æ•è·"><a href="#4-å¼‚å¸¸æ–­ç‚¹-å…¨å±€æ•è·" class="headerlink" title="4. å¼‚å¸¸æ–­ç‚¹ | å…¨å±€æ•è·"></a>4. å¼‚å¸¸æ–­ç‚¹ | å…¨å±€æ•è·</h1><p>ç‚¹å‡»å·¦ä¸‹çš„æ–­ç‚¹å›¾æ ‡å¦‚å›¾</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_%E5%BC%82%E5%B8%B8%E6%96%AD%E7%82%B9.png"></p><p>åˆ™ä¼šæ˜¾ç¤ºè¿™ä¹ˆä¸€ä¸ªç•Œé¢</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_%E5%BC%82%E5%B8%B8%E6%96%AD%E7%82%B92.png"></p><p>å…ˆé€‰ä¸­Exception Breakpointsï¼Œåœ¨ç‚¹å·¦ä¸ŠåŠ å·æ·»åŠ </p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_%E5%BC%82%E5%B8%B8%E6%96%AD%E7%82%B93.png"></p><p>å†é€‰ä¸­ç¬¬ä¸‰é¡¹</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_%E5%BC%82%E5%B8%B8%E6%96%AD%E7%82%B94.png"></p><p>é‚£ä¹ˆå¯ä»¥å†å¼¹å‡ºçª—å£æœç´¢ä½ æƒ³è¦å…¨å±€æ•è·çš„å¼‚å¸¸æ–­ç‚¹ï¼Œä¹Ÿå¯ä»¥æœç´¢ä½ è‡ªå·±å®šä¹‰çš„å¼‚å¸¸</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_%E5%BC%82%E5%B8%B8%E6%96%AD%E7%82%B95.png"></p><p>æœ€åæ·»åŠ å¹¶ç‚¹å‡»doneç¡®è®¤</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_%E5%BC%82%E5%B8%B8%E6%96%AD%E7%82%B96.png"></p><p>é‚£ä¹ˆåœ¨debugæ—¶å°±èƒ½æ•è·åˆ°å¼‚å¸¸å¹¶åœä¸‹</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/6_%E5%BC%82%E5%B8%B8%E6%96%AD%E7%82%B97.png"></p><h1 id="5-å­—æ®µæ–­ç‚¹-è¯»å†™ç›‘æ§"><a href="#5-å­—æ®µæ–­ç‚¹-è¯»å†™ç›‘æ§" class="headerlink" title="5. å­—æ®µæ–­ç‚¹ | è¯»å†™ç›‘æ§"></a>5. å­—æ®µæ–­ç‚¹ | è¯»å†™ç›‘æ§</h1><p>åœ¨ç±»çš„æˆå‘˜å˜é‡å·¦ä¾§æ‰“æ–­ç‚¹</p><p>å¯ä»¥ç›‘æ§è¿™ä¸ªæˆå‘˜æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå€¼çš„å˜åŒ–</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/7_%E5%AD%97%E6%AE%B5%E6%96%AD%E7%82%B9.png"></p><p>ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹debugçš„æ•ˆæœ</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/7_%E5%AD%97%E6%AE%B5%E6%96%AD%E7%82%B92.png"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å­—æ®µæ–­ç‚¹åœ¨ç›‘æ§çš„æŸä¸€ä¸ªå­—æ®µæŸä¸€ä¸ªå±æ€§å€¼ä¸€æ—¦å‘ç”Ÿå†™çš„æ“ä½œï¼Œæ”¹å˜äº†å®ƒçš„å€¼å°±ä¼šè§¦å‘åœé¡¿ã€‚</p><h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="https://www.bilibili.com/video/BV1ur4y1P7SV">https://www.bilibili.com/video/BV1ur4y1P7SV</a>?<a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>IDE</category>
      
      <category>IDEA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>IDEA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLé«˜çº§</title>
    <link href="/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/"/>
    <url>/2021/03/12/MySQL%E9%AB%98%E7%BA%A7/</url>
    
    <content type="html"><![CDATA[<h1 id="MySQLé«˜çº§"><a href="#MySQLé«˜çº§" class="headerlink" title="MySQLé«˜çº§"></a>MySQLé«˜çº§</h1><p>åŸºäº<a href="https://www.bilibili.com/video/BV12b411K7Zu?p=179">MySQLé«˜çº§</a>çš„å­¦ä¹ ç¬”è®°ï¼Œç”±äºæœ‰äº›è®²å¾—ä¸å¤Ÿå…¨ï¼Œåšäº†éƒ¨åˆ†è¡¥å……<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://www.bilibili.com/video/BV12b411K7Zu?p=179">[2]</span></a></sup></p><blockquote><p>å†…å®¹è¯´æ˜ï¼š</p><p>MySQL æ˜¯ç›®å‰æœ€æµè¡Œçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåœ¨ WEB åº”ç”¨æ–¹é¢ MySQL ä¹Ÿæ˜¯ç›®å‰æœ€å¥½çš„ RDBMS åº”ç”¨è½¯ä»¶ä¹‹ä¸€ã€‚éšç€æ·˜å®å»IOE(å»é™¤IBMå°å‹æœºã€Oracleæ•°æ®åº“åŠEMCå­˜å‚¨è®¾å¤‡)åŒ–çš„æ¨è¿›ï¼ŒMySQL æ•°æ®åº“åœ¨å½“å‰çš„äº’è”ç½‘åº”ç”¨ä¸­å˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚</p><p>åŒ…æ‹¬çš„MySQL é«˜çº§çŸ¥è¯†ï¼šç´¢å¼•ï¼Œå¦‚ä½•é¿å…ç´¢å¼•å¤±æ•ˆï¼Œç´¢å¼•ä¼˜åŒ–ç­–ç•¥ï¼Œinnodbå’Œmyisamå­˜å‚¨å¼•æ“ï¼ŒMySQLé”æœºåˆ¶ï¼Œé…ç½®MySQLä¸»ä»å¤åˆ¶ï¼Œexplainã€show profileã€æ…¢æŸ¥è¯¢æ—¥å¿—ç­‰æ—¥å¸¸SQLè¯Šæ–­å’Œæ€§èƒ½åˆ†æç­–ç•¥ã€‚</p></blockquote><h2 id="1-MySQLçš„æ¶æ„ä»‹ç»"><a href="#1-MySQLçš„æ¶æ„ä»‹ç»" class="headerlink" title="1.MySQLçš„æ¶æ„ä»‹ç»"></a>1.MySQLçš„æ¶æ„ä»‹ç»</h2><h3 id="1-1-MySQLç®€ä»‹"><a href="#1-1-MySQLç®€ä»‹" class="headerlink" title="1.1 MySQLç®€ä»‹"></a>1.1 MySQLç®€ä»‹</h3><ul><li><p>æ¦‚è¿°ï¼šå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»ŸRDBMS</p></li><li><p>é«˜çº§MySQLï¼šå®Œæ•´çš„mysqlä¼˜åŒ–éœ€è¦å¾ˆæ·±çš„åŠŸåº•ï¼Œå¤§å…¬å¸æœ‰ä¸“é—¨çš„DBA</p><ul><li><p>æ•°æ®åº“å†…éƒ¨ç»“æ„å’ŒåŸç†</p></li><li><p>æ•°æ®åº“å»ºæ¨¡ä¼˜åŒ–</p></li><li><p>æ•°æ®åº“ç´¢å¼•å»ºç«‹</p></li><li><p>SQLè¯­å¥ä¼˜åŒ–</p></li><li><p>SQLç¼–ç¨‹</p></li><li><p>mysqlæœåŠ¡å™¨å®‰è£…é…ç½®</p></li><li><p>æ•°æ®åº“çš„æ€§èƒ½ç›‘æ§åˆ†æä¸ç³»ç»Ÿä¼˜åŒ–</p></li><li><p>å„ç§å‚æ•°å¸¸é‡è®¾å®š</p></li><li><p>ä¸»ä»å¤åˆ¶</p></li><li><p>åˆ†å¸ƒå¼æ¶æ„æ­å»ºã€å‚ç›´åˆ‡å‰²å’Œæ°´å¹³åˆ‡å‰²</p></li><li><p>æ•°æ®è¿ç§»</p></li><li><p>å®¹ç¾å¤‡ä»½å’Œæ¢å¤</p></li><li><p>shellæˆ–pythonç­‰è„šæœ¬è¯­è¨€å¼€å‘</p></li><li><p>å¯¹å¼€æºæ•°æ®åº“è¿›è¡ŒäºŒæ¬¡å¼€å‘</p></li></ul></li></ul><h3 id="1-2-MysqlLinuxç‰ˆçš„å®‰è£…ï¼ˆmysql5-5ï¼‰"><a href="#1-2-MysqlLinuxç‰ˆçš„å®‰è£…ï¼ˆmysql5-5ï¼‰" class="headerlink" title="1.2 MysqlLinuxç‰ˆçš„å®‰è£…ï¼ˆmysql5.5ï¼‰"></a>1.2 MysqlLinuxç‰ˆçš„å®‰è£…ï¼ˆmysql5.5ï¼‰</h3><ul><li>ä¸‹è½½åœ°å€ï¼š</li></ul><p>å®˜ç½‘ä¸‹è½½åœ°å€ï¼š<a href="http://dev.mysql.com/downloads/mysql/">http://dev.mysql.com/downloads/mysql/</a>     </p><ul><li><p>æ‹·è´&amp;è§£å‹ç¼©</p></li><li><p>æ£€æŸ¥å·¥ä½œ</p><ul><li><p>æ£€æŸ¥æ˜¯å¦å®‰è£…è¿‡mysql</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> æ‰§è¡Œå®‰è£…å‘½ä»¤å‰ï¼Œå…ˆæ‰§è¡ŒæŸ¥è¯¢å‘½ä»¤</span><br>rpm -qa|grep mysql<br><span class="hljs-meta">#</span><span class="bash"> å¦‚æœå­˜åœ¨mysql-libsçš„æ—§ç‰ˆæœ¬åŒ…å¦‚ä¸‹ï¼šè¯·å…ˆæ‰§è¡Œå¸è½½å‘½ä»¤</span><br>rpm -e --nodeps  mysql-libs  <br></code></pre></td></tr></table></figure></li><li><p>ç”±äºmysqlå®‰è£…è¿‡ç¨‹ä¸­ï¼Œä¼šé€šè¿‡mysqlç”¨æˆ·åœ¨/tmpç›®å½•ä¸‹æ–°å»ºtmp_dbæ–‡ä»¶ï¼Œæ‰€ä»¥è¯·ç»™/tmpè¾ƒå¤§çš„æƒé™æ‰§è¡Œ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">chmod -R 777 /tmp<br></code></pre></td></tr></table></figure></li></ul></li><li><p>å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> åœ¨mysqlçš„å®‰è£…æ–‡ä»¶ç›®å½•ä¸‹æ‰§è¡Œï¼š</span><br>rpm -ivh MySQL-server-5.5.54-1.linux2.6.x86_64.rpmrpm -ivh MySQL-client-5.5.54-1.linux2.6.x86_64.rpm <br></code></pre></td></tr></table></figure></li></ul><ul><li><p>æŸ¥çœ‹MySQLå®‰è£…ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mysqladmin --version<br></code></pre></td></tr></table></figure></li><li><p>mysqlæœåŠ¡çš„å¯+åœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">service mysql start<br>ps -ef|grep mysql # æŸ¥çœ‹æœåŠ¡æ˜¯å¦å¼€å¯<br>service mysql stop<br></code></pre></td></tr></table></figure></li><li><p>é¦–æ¬¡ç™»é™†</p><p>å®‰è£…å®Œæˆåä¼šæç¤ºå‡ºå¦‚ä¸‹çš„æç¤ºï¼šåœ¨mysqlé¦–æ¬¡ç™»å½•å‰è¦ç»™ root è´¦å·è®¾ç½®å¯†ç  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> å¯åŠ¨æœåŠ¡åï¼Œæ‰§è¡Œå‘½ä»¤</span> <br>/usr/bin/mysqladmin -u root  password &#x27;123123&#x27;<br><span class="hljs-meta">#</span><span class="bash"> ç™»å½•</span> <br>mysql -uroot -p123123  <br></code></pre></td></tr></table></figure></li><li><p>è‡ªå¯åŠ¨æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">chkconfig mysql on # è®¾ç½®å¼€æœºè‡ªå¯åŠ¨<br>chkconfig --list | grep mysql<br>ntsysv # çœ‹åˆ°[*]mysqlè¿™ä¸€è¡Œï¼Œè¡¨ç¤ºå¼€æœºåä¼šè‡ªå¯åŠ¨mysql<br></code></pre></td></tr></table></figure></li><li><p>mysqlçš„å®‰è£…ä½ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -ef|grep mysql # åœ¨linuxä¸‹æŸ¥çœ‹å®‰è£…ç›®å½•<br></code></pre></td></tr></table></figure><p> å‚æ•°è·¯å¾„è§£é‡Šå¤‡æ³¨</p><ul><li><p>basedir:  /usr/bin ç›¸å…³å‘½ä»¤ç›®å½•mysqladmin mysqldumpç­‰å‘½ä»¤</p></li><li><p>datadir: /var/lib/mysql/ mysqlæ•°æ®åº“æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ </p></li><li><p>plugin-dir: /usr/lib64/mysql/pluginmysqlæ’ä»¶å­˜æ”¾è·¯å¾„</p></li><li><p>log-error: /var/lib/mysql/jack.atguigu.errmysqlé”™è¯¯æ—¥å¿—è·¯å¾„</p></li><li><p>pid-file: /var/lib/mysql/jack.atguigu.pidè¿›ç¨‹pidæ–‡ä»¶</p></li><li><p>socket:/var/lib/mysql/mysql.sockæœ¬åœ°è¿æ¥æ—¶ç”¨çš„unixå¥—æ¥å­—æ–‡ä»¶</p></li><li><p>/usr/share/mysql é…ç½®æ–‡ä»¶ç›®å½•mysqlè„šæœ¬åŠé…ç½®æ–‡ä»¶</p></li><li><p>/etc/init.d/mysqlæœåŠ¡å¯åœç›¸å…³è„šæœ¬ </p></li></ul></li><li><p>mysqlä¿®æ”¹å­—ç¬¦é›†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> 1. æŸ¥çœ‹å­—ç¬¦é›†è®¾ç½®</span><br>show variables like &#x27;character%&#x27;;<br>show variables like &#x27;%char%&#x27;;<br><span class="hljs-meta">#</span><span class="bash"> é»˜è®¤çš„æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½ç”¨äº†latin1ï¼Œæ‰€ä»¥ä¼šä¹±ç </span><br><br><span class="hljs-meta">#</span><span class="bash"> 2. ä¿®æ”¹my.cnf</span><br><span class="hljs-meta">#</span><span class="bash"> åœ¨/usr/share/mysql/ ä¸­æ‰¾åˆ°my.cnfçš„é…ç½®æ–‡ä»¶ï¼Œæ‹·è´å…¶ä¸­çš„my-huge.cnf åˆ°/etc/, å¹¶å‘½åä¸ºmy.cnf mysql</span><br><span class="hljs-meta">#</span><span class="bash"> ä¼˜å…ˆé€‰ä¸­/etc/ä¸‹çš„é…ç½®æ–‡ä»¶ç„¶åä¿®æ”¹my.cnf:</span><br>[client]<br>default-character-set=utf8<br>[mysqld]<br>character_set_server=utf8character_set_client=utf8collation-server=utf8_general_ci<br>[mysql]<br>default-character-set=utf8<br><br><span class="hljs-meta">#</span><span class="bash"> 3. é‡æ–°å¯åŠ¨mysql</span><br><span class="hljs-meta">#</span><span class="bash"> ä½†æ˜¯åŸåº“çš„è®¾å®šä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå‚æ•°ä¿®æ”¹ä¹‹å¯¹æ–°å»ºçš„æ•°æ®åº“ç”Ÿæ•ˆ</span> <br><br><span class="hljs-meta">#</span><span class="bash"> 4. å·²ç”Ÿæˆçš„åº“è¡¨å­—ç¬¦é›†å¦‚ä½•å˜æ›´ä¿®æ”¹æ•°æ®åº“çš„å­—ç¬¦é›†</span><br>alter database mytest character set &#x27;utf8&#x27;;<br><span class="hljs-meta">#</span><span class="bash"> ä¿®æ”¹æ•°æ®è¡¨çš„å­—ç¬¦é›†</span><br>alter table user convert to  character set &#x27;utf8&#x27;; <br>ä½†æ˜¯åŸæœ‰çš„æ•°æ®å¦‚æœæ˜¯ç”¨é&#x27;utf8&#x27;ç¼–ç çš„è¯ï¼Œæ•°æ®æœ¬èº«ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚     <br></code></pre></td></tr></table></figure></li></ul><h3 id="1-3-mysqlé…ç½®æ–‡ä»¶"><a href="#1-3-mysqlé…ç½®æ–‡ä»¶" class="headerlink" title="1.3 mysqlé…ç½®æ–‡ä»¶"></a>1.3 mysqlé…ç½®æ–‡ä»¶</h3><p>  ï¼ˆå…ˆå¤§è‡´äº†è§£ï¼Œæ··ä¸ªçœ¼ç†Ÿï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_1_mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png"></p><h3 id="1-4-mysqlé€»è¾‘æ¡†æ¶ç®€ä»‹"><a href="#1-4-mysqlé€»è¾‘æ¡†æ¶ç®€ä»‹" class="headerlink" title="1.4 mysqlé€»è¾‘æ¡†æ¶ç®€ä»‹"></a>1.4 mysqlé€»è¾‘æ¡†æ¶ç®€ä»‹</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_2_mysql%E9%80%BB%E8%BE%91%E6%A1%86%E6%9E%B6.png"></p><blockquote><p>å’Œå…¶å®ƒæ•°æ®åº“ç›¸æ¯”ï¼ŒMySQLæœ‰ç‚¹ä¸ä¼—ä¸åŒï¼Œ<strong>å®ƒçš„æ¶æ„å¯ä»¥åœ¨å¤šç§ä¸åŒåœºæ™¯ä¸­åº”ç”¨å¹¶å‘æŒ¥è‰¯å¥½ä½œç”¨</strong>ã€‚</p><p>ä¸»è¦ä½“ç°åœ¨å­˜å‚¨å¼•æ“çš„æ¶æ„ä¸Šï¼Œ<strong>æ’ä»¶å¼çš„å­˜å‚¨å¼•æ“æ¶æ„</strong>å°†æŸ¥è¯¢å¤„ç†å’Œå…¶å®ƒçš„ç³»ç»Ÿä»»åŠ¡ä»¥åŠæ•°æ®çš„å­˜å‚¨æå–ç›¸åˆ†ç¦»ã€‚</p><p>è¿™ç§æ¶æ„å¯ä»¥æ ¹æ®ä¸šåŠ¡çš„éœ€æ±‚å’Œå®é™…éœ€è¦é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“</p></blockquote><ul><li><p>è¿æ¥å±‚ </p><p>æœ€ä¸Šå±‚æ˜¯ä¸€äº›å®¢æˆ·ç«¯å’Œè¿æ¥æœåŠ¡ï¼ŒåŒ…å«æœ¬åœ°socké€šä¿¡å’Œå¤§å¤šæ•°åŸºäºå®¢æˆ·ç«¯/æœåŠ¡ç«¯å·¥å…·å®ç°çš„ç±»ä¼¼äºtcp/ipçš„é€šä¿¡ã€‚ä¸»è¦å®Œæˆä¸€äº›ç±»ä¼¼äºè¿æ¥å¤„ç†ã€æˆæƒè®¤è¯ã€åŠç›¸å…³çš„å®‰å…¨æ–¹æ¡ˆã€‚åœ¨è¯¥å±‚ä¸Šå¼•å…¥äº†çº¿ç¨‹æ± çš„æ¦‚å¿µï¼Œä¸ºé€šè¿‡è®¤è¯å®‰å…¨æ¥å…¥çš„å®¢æˆ·ç«¯æä¾›çº¿ç¨‹ã€‚åŒæ ·åœ¨è¯¥å±‚ä¸Šå¯ä»¥å®ç°åŸºäºSSLçš„å®‰å…¨é“¾æ¥ã€‚æœåŠ¡å™¨ä¹Ÿä¼šä¸ºå®‰å…¨æ¥å…¥çš„æ¯ä¸ªå®¢æˆ·ç«¯éªŒè¯å®ƒæ‰€å…·æœ‰çš„æ“ä½œæƒé™ã€‚ </p></li><li><p>æœåŠ¡å±‚</p><ol><li>Management Serveices &amp; Utilitiesï¼š ç³»ç»Ÿç®¡ç†å’Œæ§åˆ¶å·¥å…· </li><li>SQL Interface: SQLæ¥å£   æ¥å—ç”¨æˆ·çš„SQLå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç”¨æˆ·éœ€è¦æŸ¥è¯¢çš„ç»“æœã€‚æ¯”å¦‚select fromå°±æ˜¯è°ƒç”¨SQL Interface</li><li>Parser: è§£æå™¨    SQLå‘½ä»¤ä¼ é€’åˆ°è§£æå™¨çš„æ—¶å€™ä¼šè¢«è§£æå™¨éªŒè¯å’Œè§£æã€‚</li><li> Optimizer: æŸ¥è¯¢ä¼˜åŒ–å™¨ã€‚   SQLè¯­å¥åœ¨æŸ¥è¯¢ä¹‹å‰ä¼šä½¿ç”¨æŸ¥è¯¢ä¼˜åŒ–å™¨å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚   ç”¨ä¸€ä¸ªä¾‹å­å°±å¯ä»¥ç†è§£ï¼š select uid,name from user where gender= 1;   ä¼˜åŒ–å™¨æ¥å†³å®šå…ˆæŠ•å½±è¿˜æ˜¯å…ˆè¿‡æ»¤ã€‚</li><li>Cacheå’ŒBufferï¼š æŸ¥è¯¢ç¼“å­˜ã€‚   å¦‚æœæŸ¥è¯¢ç¼“å­˜æœ‰å‘½ä¸­çš„æŸ¥è¯¢ç»“æœï¼ŒæŸ¥è¯¢è¯­å¥å°±å¯ä»¥ç›´æ¥å»æŸ¥è¯¢ç¼“å­˜ä¸­å–æ•°æ®ã€‚   è¿™ä¸ªç¼“å­˜æœºåˆ¶æ˜¯ç”±ä¸€ç³»åˆ—å°ç¼“å­˜ç»„æˆçš„ã€‚æ¯”å¦‚è¡¨ç¼“å­˜ï¼Œè®°å½•ç¼“å­˜ï¼Œkeyç¼“å­˜ï¼Œæƒé™ç¼“å­˜ç­‰    ç¼“å­˜æ˜¯è´Ÿè´£è¯»ï¼Œç¼“å†²è´Ÿè´£å†™ã€‚</li></ol></li><li><p>å¼•æ“å±‚ </p><p>å­˜å‚¨å¼•æ“å±‚ï¼Œå­˜å‚¨å¼•æ“çœŸæ­£çš„è´Ÿè´£äº†MySQLä¸­æ•°æ®çš„å­˜å‚¨å’Œæå–ï¼ŒæœåŠ¡å™¨é€šè¿‡APIä¸å­˜å‚¨å¼•æ“è¿›è¡Œé€šä¿¡ã€‚ä¸åŒçš„å­˜å‚¨å¼•æ“å…·æœ‰çš„åŠŸèƒ½ä¸åŒï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€è¦è¿›è¡Œé€‰å–ã€‚åé¢ä»‹ç»MyISAMå’ŒInnoDB </p></li><li><p>å­˜å‚¨å±‚ </p><p>æ•°æ®å­˜å‚¨å±‚ï¼Œä¸»è¦æ˜¯å°†æ•°æ®å­˜å‚¨åœ¨è¿è¡Œäºè£¸è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šï¼Œå¹¶å®Œæˆä¸å­˜å‚¨å¼•æ“çš„äº¤äº’ã€‚</p></li></ul><h3 id="1-5-mysqlå­˜å‚¨å¼•æ“"><a href="#1-5-mysqlå­˜å‚¨å¼•æ“" class="headerlink" title="1.5 mysqlå­˜å‚¨å¼•æ“"></a>1.5 mysqlå­˜å‚¨å¼•æ“</h3><h4 id="1-5-1-æŸ¥çœ‹å‘½ä»¤"><a href="#1-5-1-æŸ¥çœ‹å‘½ä»¤" class="headerlink" title="1.5.1 æŸ¥çœ‹å‘½ä»¤"></a>1.5.1 æŸ¥çœ‹å‘½ä»¤</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> çœ‹ä½ çš„mysqlç°åœ¨å·²æä¾›ä»€ä¹ˆå­˜å‚¨å¼•æ“</span><br>show engines; <br><span class="hljs-meta">#</span><span class="bash"> çœ‹ä½ çš„mysqlå½“å‰é»˜è®¤çš„å­˜å‚¨å¼•æ“:</span>  <br>show variables like &#x27;%storage_engine%&#x27;; <br></code></pre></td></tr></table></figure><h4 id="1-5-2-MyISAMå’ŒInnoDB"><a href="#1-5-2-MyISAMå’ŒInnoDB" class="headerlink" title="1.5.2  MyISAMå’ŒInnoDB"></a>1.5.2  <font color=#FF0000><strong>MyISAMå’ŒInnoDB</strong></font></h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_3_InnoDB%E5%92%8CMyISAM.png"></p><h4 id="1-5-3-å„ä¸ªå­˜å‚¨å¼•æ“ä»‹ç»"><a href="#1-5-3-å„ä¸ªå­˜å‚¨å¼•æ“ä»‹ç»" class="headerlink" title="1.5.3 å„ä¸ªå­˜å‚¨å¼•æ“ä»‹ç»"></a>1.5.3 å„ä¸ªå­˜å‚¨å¼•æ“ä»‹ç»</h4><ol><li><strong>InnoDB</strong>å­˜å‚¨å¼•æ“ï¼šInnoDBæ˜¯MySQLçš„é»˜è®¤äº‹åŠ¡å‹å¼•æ“ï¼Œå®ƒè¢«è®¾è®¡ç”¨æ¥å¤„ç†å¤§é‡çš„çŸ­æœŸ(short-lived)äº‹åŠ¡ã€‚é™¤éæœ‰éå¸¸ç‰¹åˆ«çš„åŸå› éœ€è¦ä½¿ç”¨å…¶ä»–çš„å­˜å‚¨å¼•æ“ï¼Œå¦åˆ™åº”è¯¥ä¼˜å…ˆè€ƒè™‘InnoDBå¼•æ“ã€‚è¡Œçº§é”ï¼Œé€‚åˆé«˜å¹¶å‘æƒ…å†µ </li><li><strong>MyISAM</strong>å­˜å‚¨å¼•æ“ï¼šMyISAMæä¾›äº†å¤§é‡çš„ç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¨æ–‡ç´¢å¼•ã€å‹ç¼©ã€ç©ºé—´å‡½æ•°(GIS)ç­‰ï¼Œä½†MyISAMä¸æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”(myisamæ”¹è¡¨æ—¶ä¼šå°†æ•´ä¸ªè¡¨å…¨é”ä½)ï¼Œæœ‰ä¸€ä¸ªæ¯«æ— ç–‘é—®çš„ç¼ºé™·å°±æ˜¯å´©æºƒåæ— æ³•å®‰å…¨æ¢å¤ã€‚ </li><li>Archiveå¼•æ“ï¼šArchiveå­˜å‚¨å¼•æ“åªæ”¯æŒINSERTå’ŒSELECTæ“ä½œï¼Œåœ¨MySQL5.1ä¹‹å‰ä¸æ”¯æŒç´¢å¼•ã€‚Archiveè¡¨é€‚åˆæ—¥å¿—å’Œæ•°æ®é‡‡é›†ç±»åº”ç”¨ã€‚é€‚åˆä½è®¿é—®é‡å¤§æ•°æ®ç­‰æƒ…å†µã€‚æ ¹æ®è‹±æ–‡çš„æµ‹è¯•ç»“è®ºæ¥çœ‹ï¼ŒArchiveè¡¨æ¯”MyISAMè¡¨è¦å°å¤§çº¦75%ï¼Œæ¯”æ”¯æŒäº‹åŠ¡å¤„ç†çš„InnoDBè¡¨å°å¤§çº¦83%ã€‚ </li><li>Blackholeå¼•æ“ï¼šBlackholeå¼•æ“æ²¡æœ‰å®ç°ä»»ä½•å­˜å‚¨æœºåˆ¶ï¼Œå®ƒä¼šä¸¢å¼ƒæ‰€æœ‰æ’å…¥çš„æ•°æ®ï¼Œä¸åšä»»ä½•ä¿å­˜ã€‚ä½†æœåŠ¡å™¨ä¼šè®°å½•Blackholeè¡¨çš„æ—¥å¿—ï¼Œæ‰€ä»¥å¯ä»¥ç”¨äºå¤åˆ¶æ•°æ®åˆ°å¤‡åº“ï¼Œæˆ–è€…ç®€å•åœ°è®°å½•åˆ°æ—¥å¿—ã€‚ä½†è¿™ç§åº”ç”¨æ–¹å¼ä¼šç¢°åˆ°å¾ˆå¤šé—®é¢˜ï¼Œå› æ­¤å¹¶ä¸æ¨èã€‚ </li><li>CSVå¼•æ“ï¼šCSVå¼•æ“å¯ä»¥å°†æ™®é€šçš„CSVæ–‡ä»¶ä½œä¸ºMySQLçš„è¡¨æ¥å¤„ç†ï¼Œä½†ä¸æ”¯æŒç´¢å¼•ã€‚CSVå¼•æ“å¯ä»¥ä½œä¸ºä¸€ç§æ•°æ®äº¤æ¢çš„æœºåˆ¶ï¼Œéå¸¸æœ‰ç”¨ã€‚CSVå­˜å‚¨çš„æ•°æ®ç›´æ¥å¯ä»¥åœ¨æ“ä½œç³»ç»Ÿé‡Œï¼Œç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæˆ–è€…excelè¯»å–ã€‚ </li><li>Memoryå¼•æ“ï¼šå¦‚æœéœ€è¦å¿«é€Ÿåœ°è®¿é—®æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®ä¸ä¼šè¢«ä¿®æ”¹ï¼Œé‡å¯ä»¥åä¸¢å¤±ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œé‚£ä¹ˆä½¿ç”¨Memoryè¡¨æ˜¯éå¸¸æœ‰ç”¨ã€‚Memoryè¡¨è‡³å°‘æ¯”MyISAMè¡¨è¦å¿«ä¸€ä¸ªæ•°é‡çº§ã€‚(ä½¿ç”¨ä¸“ä¸šçš„å†…å­˜æ•°æ®åº“æ›´å¿«ï¼Œå¦‚redis) </li><li>Federatedå¼•æ“ï¼šFederatedå¼•æ“æ˜¯è®¿é—®å…¶ä»–MySQLæœåŠ¡å™¨çš„ä¸€ä¸ªä»£ç†ï¼Œå°½ç®¡è¯¥å¼•æ“çœ‹èµ·æ¥æä¾›äº†ä¸€ç§å¾ˆå¥½çš„è·¨æœåŠ¡å™¨çš„çµæ´»æ€§ï¼Œä½†ä¹Ÿç»å¸¸å¸¦æ¥é—®é¢˜ï¼Œå› æ­¤é»˜è®¤æ˜¯ç¦ç”¨çš„ã€‚ </li></ol><h4 id="1-5-4-é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ª"><a href="#1-5-4-é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ª" class="headerlink" title="1.5.4 é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ª"></a>1.5.4 é˜¿é‡Œå·´å·´ã€æ·˜å®ç”¨å“ªä¸ª</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_4_%E9%98%BF%E9%87%8C%E4%BD%BF%E7%94%A8%E7%9A%84%E5%93%AA%E4%B8%AA.png"></p><h2 id="2-ç´¢å¼•ä¼˜åŒ–åˆ†æ"><a href="#2-ç´¢å¼•ä¼˜åŒ–åˆ†æ" class="headerlink" title="2.  ç´¢å¼•ä¼˜åŒ–åˆ†æ"></a>2.  ç´¢å¼•ä¼˜åŒ–åˆ†æ</h2><h3 id="2-1-æ€§èƒ½ä¸‹é™SQLæ…¢-æ‰§è¡Œæ—¶é—´é•¿-ç­‰å¾…æ—¶é—´é•¿"><a href="#2-1-æ€§èƒ½ä¸‹é™SQLæ…¢-æ‰§è¡Œæ—¶é—´é•¿-ç­‰å¾…æ—¶é—´é•¿" class="headerlink" title="2.1 æ€§èƒ½ä¸‹é™SQLæ…¢ æ‰§è¡Œæ—¶é—´é•¿ ç­‰å¾…æ—¶é—´é•¿"></a>2.1 æ€§èƒ½ä¸‹é™SQLæ…¢ æ‰§è¡Œæ—¶é—´é•¿ ç­‰å¾…æ—¶é—´é•¿</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_5_%E6%80%A7%E8%83%BD%E4%B8%8B%E9%99%8Dsql%E6%85%A2%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4%E9%95%BF%E7%AD%89%E5%BE%85%E6%97%B6%E9%97%B4%E9%95%BF.png"></p><h3 id="2-2-å¸¸è§é€šç”¨çš„joinæŸ¥è¯¢"><a href="#2-2-å¸¸è§é€šç”¨çš„joinæŸ¥è¯¢" class="headerlink" title="2.2 å¸¸è§é€šç”¨çš„joinæŸ¥è¯¢"></a>2.2 å¸¸è§é€šç”¨çš„joinæŸ¥è¯¢</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_6_%E5%B8%B8%E8%A7%81%E7%9A%84join%E6%9F%A5%E8%AF%A2.png"></p><ul><li><p>SQLè§£æï¼šæœºè¯»é¡ºåºï¼ˆå…ˆfromï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_7_SQL%E8%A7%A3%E6%9E%90.png"></p></li><li><p>Joinå›¾ï¼ˆé‡ç‚¹ï¼ŒåŸºæœ¬åŠŸä¸€å®šè¦è®°ä½ï¼‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_8_join%E5%9B%BEx.png"></p></li></ul><h3 id="2-3-ç´¢å¼•ç®€ä»‹"><a href="#2-3-ç´¢å¼•ç®€ä»‹" class="headerlink" title="2.3 ç´¢å¼•ç®€ä»‹"></a>2.3 ç´¢å¼•ç®€ä»‹</h3><h4 id="2-3-1-ç´¢å¼•æ˜¯ä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰"><a href="#2-3-1-ç´¢å¼•æ˜¯ä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰" class="headerlink" title="2.3.1 ç´¢å¼•æ˜¯ä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰"></a>2.3.1 ç´¢å¼•æ˜¯ä»€ä¹ˆï¼ˆé‡ç‚¹ï¼‰</h4><blockquote><p>MySQLå®˜æ–¹å¯¹ç´¢å¼•çš„å®šä¹‰ä¸ºï¼šç´¢å¼•ï¼ˆIndexï¼‰æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ã€‚</p></blockquote><ul><li><p><strong>ç´¢å¼•çš„æœ¬è´¨</strong>ï¼šç´¢å¼•æ˜¯<font color=#FF0000>æ•°æ®ç»“æ„</font></p></li><li><p>ç´¢å¼•çš„ç›®çš„ï¼šåœ¨äºæé«˜æŸ¥è¯¢æ•ˆç‡</p><p>å¯ä»¥ç±»æ¯”å­—å…¸ï¼Œå¦‚æœè¦æŸ¥â€œmysqlâ€è¿™ä¸ªå•è¯ï¼Œæˆ‘ä»¬è‚¯å®šéœ€è¦å®šä½åˆ°må­—æ¯ï¼Œç„¶åä»ä¸‹å¾€ä¸‹æ‰¾åˆ°yå­—æ¯ï¼Œå†æ‰¾åˆ°å‰©ä¸‹çš„sqlã€‚å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦aâ€”-zï¼Œå¦‚æœæˆ‘æƒ³æ‰¾åˆ°Javaå¼€å¤´çš„å•è¯å‘¢ï¼Ÿæˆ–è€…Oracleå¼€å¤´çš„å•è¯å‘¢ï¼Ÿæ˜¯ä¸æ˜¯è§‰å¾—å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œè¿™ä¸ªäº‹æƒ…æ ¹æœ¬æ— æ³•å®Œæˆï¼Ÿ</p></li><li><p>ç®€å•ç†è§£ï¼š <font color=#FF0000><strong>ç´¢å¼•æ˜¯æ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„</strong></font> </p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_10_%E7%B4%A2%E5%BC%95%E8%AF%A6%E8%A7%A32.png"></p><ul><li>äºŒå‰æ ‘å¼Šç«¯ä¹‹ä¸€ï¼šäºŒå‰æ ‘å¾ˆå¯èƒ½ä¼šå‘ç”Ÿä¸¤è¾¹ä¸å¹³è¡¡çš„æƒ…å†µã€‚</li><li>B-TREEï¼š(B:balance) ä¼šè‡ªåŠ¨æ ¹æ®ä¸¤è¾¹çš„æƒ…å†µè‡ªåŠ¨è°ƒèŠ‚ï¼Œä½¿ä¸¤ç«¯æ— é™è¶‹è¿‘äºå¹³è¡¡çŠ¶æ€ã€‚å¯ä»¥ä½¿æ€§èƒ½æœ€ç¨³å®šã€‚(myisamä½¿ç”¨çš„æ–¹å¼)  </li><li>B-TREEå¼Šç«¯ï¼š(æ’å…¥/ä¿®æ”¹æ“ä½œå¤šæ—¶ï¼ŒB-TREEä¼šä¸æ–­è°ƒæ•´å¹³è¡¡ï¼Œæ¶ˆè€—æ€§èƒ½)ä»ä¾§é¢è¯´æ˜äº†ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚</li><li>B+TREEï¼šInnodb æ‰€ä½¿ç”¨çš„ç´¢å¼•</li></ul></li><li><p><font color=#FF0000><strong>æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡æ˜ï¼Œéƒ½æ˜¯æŒ‡Bæ ‘(å¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸ä¸€å®šæ˜¯äºŒå‰çš„)ç»“æ„ç»„ç»‡çš„ç´¢å¼•</strong></font>ã€‚å…¶ä¸­èšé›†ç´¢å¼•ï¼Œæ¬¡è¦ç´¢å¼•ï¼Œè¦†ç›–ç´¢å¼•ï¼Œå¤åˆç´¢å¼•ï¼Œå‰ç¼€ç´¢å¼•ï¼Œå”¯ä¸€ç´¢å¼•é»˜è®¤éƒ½æ˜¯ä½¿ç”¨B+æ ‘ç´¢å¼•ï¼Œç»Ÿç§°ç´¢å¼•ã€‚å½“ç„¶ï¼Œé™¤äº†B+æ ‘è¿™ç§ç±»å‹çš„ç´¢å¼•ä¹‹å¤–ï¼Œè¿˜æœ‰å“ˆç¨€ç´¢å¼•(hash index)ç­‰ã€‚</p></li></ul><h4 id="2-3-2-ç´¢å¼•çš„ä¼˜åŠ¿"><a href="#2-3-2-ç´¢å¼•çš„ä¼˜åŠ¿" class="headerlink" title="2.3.2 ç´¢å¼•çš„ä¼˜åŠ¿"></a>2.3.2 ç´¢å¼•çš„ä¼˜åŠ¿</h4><ul><li>ç±»ä¼¼å¤§å­¦å›¾ä¹¦é¦†å»ºä¹¦ç›®ç´¢å¼•ï¼Œæé«˜æ•°æ®æ£€ç´¢çš„æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“çš„IOæˆæœ¬</li><li>é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œé™ä½æ•°æ®æ’åºçš„æˆæœ¬ï¼Œé™ä½äº†CPUçš„æ¶ˆè€—</li></ul><h4 id="2-3-3-ç´¢å¼•çš„åŠ£åŠ¿"><a href="#2-3-3-ç´¢å¼•çš„åŠ£åŠ¿" class="headerlink" title="2.3.3 ç´¢å¼•çš„åŠ£åŠ¿"></a>2.3.3 ç´¢å¼•çš„åŠ£åŠ¿</h4><ul><li><p>å®é™…ä¸Šç´¢å¼•ä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œè¯¥è¡¨ä¿å­˜äº†ä¸»é”®ä¸ç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ï¼Œæ‰€ä»¥ç´¢å¼•åˆ—ä¹Ÿæ˜¯è¦<strong>å ç”¨ç©ºé—´</strong>çš„</p></li><li><p>è™½ç„¶ç´¢å¼•å¤§å¤§<strong>æé«˜äº†æŸ¥è¯¢é€Ÿåº¦</strong>ï¼ŒåŒæ—¶å´ä¼š<strong>é™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦</strong>ï¼Œå¦‚å¯¹è¡¨è¿›è¡ŒINSERTã€UPDATEå’ŒDELETEã€‚å› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQLä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯</p></li><li><p><font color=#FF0000><strong>ç´¢å¼•åªæ˜¯æé«˜æ•ˆç‡çš„ä¸€ä¸ªå› ç´ ï¼Œå¦‚æœä½ çš„MySQLæœ‰å¤§æ•°æ®é‡çš„è¡¨ï¼Œå°±éœ€è¦èŠ±æ—¶é—´ç ”ç©¶å»ºç«‹æœ€ä¼˜ç§€çš„ç´¢å¼•ï¼Œæˆ–ä¼˜åŒ–æŸ¥è¯¢è¯­å¥</strong></font></p></li></ul><h4 id="2-3-4-ç´¢å¼•çš„åˆ†ç±»"><a href="#2-3-4-ç´¢å¼•çš„åˆ†ç±»" class="headerlink" title="2.3.4 ç´¢å¼•çš„åˆ†ç±»"></a>2.3.4 ç´¢å¼•çš„åˆ†ç±»</h4><h5 id="2-3-4-1-å•å€¼ç´¢å¼•"><a href="#2-3-4-1-å•å€¼ç´¢å¼•" class="headerlink" title="2.3.4.1 å•å€¼ç´¢å¼•"></a>2.3.4.1 å•å€¼ç´¢å¼•</h5><blockquote><p>å³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•</p></blockquote><h5 id="2-3-4-2-å”¯ä¸€ç´¢å¼•"><a href="#2-3-4-2-å”¯ä¸€ç´¢å¼•" class="headerlink" title="2.3.4.2 å”¯ä¸€ç´¢å¼•"></a>2.3.4.2 å”¯ä¸€ç´¢å¼•</h5><blockquote><p>ç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼</p></blockquote><h5 id="2-3-4-3-å¤åˆç´¢å¼•"><a href="#2-3-4-3-å¤åˆç´¢å¼•" class="headerlink" title="2.3.4.3 å¤åˆç´¢å¼•"></a>2.3.4.3 å¤åˆç´¢å¼•</h5><blockquote><p>å³ä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—</p></blockquote><h5 id="2-3-4-4-ä¸»é”®ç´¢å¼•"><a href="#2-3-4-4-ä¸»é”®ç´¢å¼•" class="headerlink" title="2.3.4.4 ä¸»é”®ç´¢å¼•"></a>2.3.4.4 ä¸»é”®ç´¢å¼•</h5><blockquote><p>è®¾å®šä¸ºä¸»é”®åæ•°æ®åº“ä¼šè‡ªåŠ¨å»ºç«‹ç´¢å¼•ï¼Œinnodbä¸ºèšç°‡ï¼ˆèšé›†ï¼‰ç´¢å¼•</p><p>å› ä¸ºInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«è¦æŒ‰ä¸»é”®èšé›†ï¼Œæ‰€ä»¥InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢ã€‚</p></blockquote><h5 id="2-3-4-5-åŸºæœ¬è¯­æ³•"><a href="#2-3-4-5-åŸºæœ¬è¯­æ³•" class="headerlink" title="2.3.4.5 åŸºæœ¬è¯­æ³•"></a>2.3.4.5 åŸºæœ¬è¯­æ³•</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1. åˆ›å»º<br>CREATE [UNIQUE] INDEX indexName ON mytable(columnname(length))<br>ALTER mytable ADD  [UNIQUE ]  INDEX [indexName] ON (columnname(length)) <br><br># 2. åˆ é™¤<br>DROP INDEX [indexName] ON mytable<br><br># 3. æŸ¥çœ‹<br>SHOW INDEX FROM table_name\G<br><br># 4. ä½¿ç”¨ALTERå‘½ä»¤<br># æœ‰å››ç§æ–¹å¼æ¥æ·»åŠ æ•°æ®è¡¨çš„ç´¢å¼•ï¼š<br>ALTER TABLE tbl_name ADD PRIMARY KEY (column_list) # è¯¥è¯­å¥æ·»åŠ ä¸€ä¸ªä¸»é”®ï¼Œè¿™æ„å‘³ç€ç´¢å¼•å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä¸”ä¸èƒ½ä¸ºNULLã€‚<br>ALTER TABLE tbl_name ADD UNIQUE index_name (column_list) # è¿™æ¡è¯­å¥åˆ›å»ºç´¢å¼•çš„å€¼å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼ˆé™¤äº†NULLå¤–ï¼ŒNULLå¯èƒ½ä¼šå‡ºç°å¤šæ¬¡<br>ALTER TABLE tbl_name ADD INDEX index_name (column_list) # æ·»åŠ æ™®é€šç´¢å¼•ï¼Œç´¢å¼•å€¼å¯å‡ºç°å¤šæ¬¡ã€‚<br>ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list) #è¯¥è¯­å¥æŒ‡å®šäº†ç´¢å¼•ä¸º FULLTEXT ï¼Œç”¨äºå…¨æ–‡ç´¢å¼•ã€‚ <br></code></pre></td></tr></table></figure><h4 id="2-3-5-mysqlç´¢å¼•ç»“æ„â­"><a href="#2-3-5-mysqlç´¢å¼•ç»“æ„â­" class="headerlink" title="2.3.5 mysqlç´¢å¼•ç»“æ„â­"></a>2.3.5 mysqlç´¢å¼•ç»“æ„â­</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_11_%E7%B4%A2%E5%BC%95%E7%BB%93%E6%9E%84.png"></p><ul><li><p>B-Tree<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">[1]</span></a></sup></p><p>ä¸ºäº†æè¿°B-Treeï¼Œé¦–å…ˆå®šä¹‰ä¸€æ¡æ•°æ®è®°å½•ä¸ºä¸€ä¸ªäºŒå…ƒç»„[key, data]ï¼Œkeyä¸ºè®°å½•çš„é”®å€¼ï¼Œå¯¹äºä¸åŒæ•°æ®è®°å½•ï¼Œkeyæ˜¯äº’ä¸ç›¸åŒçš„ï¼›dataä¸ºæ•°æ®è®°å½•é™¤keyå¤–çš„æ•°æ®ã€‚é‚£ä¹ˆB-Treeæ˜¯æ»¡è¶³ä¸‹åˆ—æ¡ä»¶çš„æ•°æ®ç»“æ„ï¼š</p><ul><li>dä¸ºå¤§äº1çš„ä¸€ä¸ªæ­£æ•´æ•°ï¼Œç§°ä¸ºB-Treeçš„åº¦ã€‚</li><li>hä¸ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œç§°ä¸ºB-Treeçš„é«˜åº¦ã€‚</li><li>æ¯ä¸ªéå¶å­èŠ‚ç‚¹ç”±n-1ä¸ªkeyå’Œnä¸ªæŒ‡é’ˆç»„æˆï¼Œå…¶ä¸­d&lt;=n&lt;=2dã€‚</li><li>æ¯ä¸ªå¶å­èŠ‚ç‚¹æœ€å°‘åŒ…å«ä¸€ä¸ªkeyå’Œä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€å¤šåŒ…å«2d-1ä¸ªkeyå’Œ2dä¸ªæŒ‡é’ˆï¼Œå¶èŠ‚ç‚¹çš„æŒ‡é’ˆå‡ä¸ºnull ã€‚</li><li>æ‰€æœ‰å¶èŠ‚ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦ï¼Œç­‰äºæ ‘é«˜hã€‚</li><li>keyå’ŒæŒ‡é’ˆäº’ç›¸é—´éš”ï¼ŒèŠ‚ç‚¹ä¸¤ç«¯æ˜¯æŒ‡é’ˆã€‚</li><li>ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„keyä»å·¦åˆ°å³éé€’å‡æ’åˆ—ã€‚</li><li>æ‰€æœ‰èŠ‚ç‚¹ç»„æˆæ ‘ç»“æ„ã€‚</li><li>æ¯ä¸ªæŒ‡é’ˆè¦ä¹ˆä¸ºnullï¼Œè¦ä¹ˆæŒ‡å‘å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeæœ€å·¦è¾¹ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå°äºv(key_1)ï¼Œå…¶ä¸­v(key_1)ä¸ºnodeçš„ç¬¬ä¸€ä¸ªkeyçš„å€¼ã€‚</li><li>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeæœ€å³è¾¹ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå¤§äºv(key_m)ï¼Œå…¶ä¸­v(key_m)ä¸ºnodeçš„æœ€åä¸€ä¸ªkeyçš„å€¼ã€‚</li><li>å¦‚æœæŸä¸ªæŒ‡é’ˆåœ¨èŠ‚ç‚¹nodeçš„å·¦å³ç›¸é‚»keyåˆ†åˆ«æ˜¯key_iå’Œkey{i+1}ä¸”ä¸ä¸ºnullï¼Œåˆ™å…¶æŒ‡å‘èŠ‚ç‚¹çš„æ‰€æœ‰keyå°äºv(key{i+1})ä¸”å¤§äºv(key_i)</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_12_B-Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%86.png"></p><p>ç”±äºB-Treeçš„ç‰¹æ€§ï¼Œåœ¨B-Treeä¸­æŒ‰keyæ£€ç´¢æ•°æ®çš„ç®—æ³•éå¸¸ç›´è§‚ï¼šé¦–å…ˆä»æ ¹èŠ‚ç‚¹è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™è¿”å›å¯¹åº”èŠ‚ç‚¹çš„dataï¼Œå¦åˆ™å¯¹ç›¸åº”åŒºé—´çš„æŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹é€’å½’è¿›è¡ŒæŸ¥æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°èŠ‚ç‚¹æˆ–æ‰¾åˆ°nullæŒ‡é’ˆï¼Œå‰è€…æŸ¥æ‰¾æˆåŠŸï¼Œåè€…æŸ¥æ‰¾å¤±è´¥ã€‚B-Treeä¸ŠæŸ¥æ‰¾ç®—æ³•çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">BTree_Search(node, key) &#123;<br>    <span class="hljs-keyword">if</span>(node == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    foreach(node.key)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(node.key[i] == key) <span class="hljs-keyword">return</span> node.data[i];<br>            <span class="hljs-keyword">if</span>(node.key[i] &gt; key) <span class="hljs-keyword">return</span> BTree_Search(point[i]-&gt;node);<br>    &#125;<br>    <span class="hljs-keyword">return</span> BTree_Search(point[i+<span class="hljs-number">1</span>]-&gt;node);<br>&#125;<br>data = BTree_Search(root, my_key);<br></code></pre></td></tr></table></figure><p>å…³äºB-Treeæœ‰ä¸€ç³»åˆ—æœ‰è¶£çš„æ€§è´¨ï¼Œä¾‹å¦‚ä¸€ä¸ªåº¦ä¸ºdçš„B-Treeï¼Œè®¾å…¶ç´¢å¼•Nä¸ªkeyï¼Œåˆ™å…¶æ ‘é«˜hçš„ä¸Šé™ä¸ºlogd((N+1)/2)logd((N+1)/2)ï¼Œæ£€ç´¢ä¸€ä¸ªkeyï¼Œå…¶æŸ¥æ‰¾èŠ‚ç‚¹ä¸ªæ•°çš„æ¸è¿›å¤æ‚åº¦ä¸ºO(logdN)O(logdN)ã€‚ä»è¿™ç‚¹å¯ä»¥çœ‹å‡ºï¼ŒB-Treeæ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆç‡çš„ç´¢å¼•æ•°æ®ç»“æ„ã€‚</p><p>å¦å¤–ï¼Œç”±äºæ’å…¥åˆ é™¤æ–°çš„æ•°æ®è®°å½•ä¼šç ´åB-Treeçš„æ€§è´¨ï¼Œå› æ­¤åœ¨æ’å…¥åˆ é™¤æ—¶ï¼Œéœ€è¦å¯¹æ ‘è¿›è¡Œä¸€ä¸ªåˆ†è£‚ã€åˆå¹¶ã€è½¬ç§»ç­‰æ“ä½œä»¥ä¿æŒB-Treeæ€§è´¨ï¼Œæœ¬æ–‡ä¸æ‰“ç®—å®Œæ•´è®¨è®ºB-Treeè¿™äº›å†…å®¹ï¼Œå› ä¸ºå·²ç»æœ‰è®¸å¤šèµ„æ–™è¯¦ç»†è¯´æ˜äº†B-Treeçš„æ•°å­¦æ€§è´¨åŠæ’å…¥åˆ é™¤ç®—æ³•ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥åœ¨æœ¬æ–‡æœ«çš„å‚è€ƒæ–‡çŒ®ä¸€æ æ‰¾åˆ°ç›¸åº”çš„èµ„æ–™è¿›è¡Œé˜…è¯»ã€‚</p></li><li><p>B+Tree<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">[1]</span></a></sup></p><p>B-Treeæœ‰è®¸å¤šå˜ç§ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯B+Treeï¼Œä¾‹å¦‚MySQLå°±æ™®éä½¿ç”¨B+Treeå®ç°å…¶ç´¢å¼•ç»“æ„ã€‚</p><p>ä¸B-Treeç›¸æ¯”ï¼ŒB+Treeæœ‰ä»¥ä¸‹ä¸åŒç‚¹ï¼š</p><ul><li><p>æ¯ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆä¸Šé™ä¸º2dè€Œä¸æ˜¯2d+1ã€‚</p></li><li><p>å†…èŠ‚ç‚¹ä¸å­˜å‚¨dataï¼Œåªå­˜å‚¨keyï¼›å¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æŒ‡é’ˆã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%863.png"></p><p>ç”±äºå¹¶ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½å…·æœ‰ç›¸åŒçš„åŸŸï¼Œå› æ­¤B+Treeä¸­å¶èŠ‚ç‚¹å’Œå†…èŠ‚ç‚¹ä¸€èˆ¬å¤§å°ä¸åŒã€‚è¿™ç‚¹ä¸B-Treeä¸åŒï¼Œè™½ç„¶B-Treeä¸­ä¸åŒèŠ‚ç‚¹å­˜æ”¾çš„keyå’ŒæŒ‡é’ˆå¯èƒ½æ•°é‡ä¸ä¸€è‡´ï¼Œä½†æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„åŸŸå’Œä¸Šé™æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥åœ¨å®ç°ä¸­B-Treeå¾€å¾€å¯¹æ¯ä¸ªèŠ‚ç‚¹ç”³è¯·åŒç­‰å¤§å°çš„ç©ºé—´ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼ŒB+Treeæ¯”B-Treeæ›´é€‚åˆå®ç°å¤–å­˜å‚¨ç´¢å¼•ç»“æ„ï¼Œå…·ä½“åŸå› ä¸å¤–å­˜å‚¨å™¨åŸç†åŠè®¡ç®—æœºå­˜å–åŸç†æœ‰å…³ã€‚</p></li><li><p>å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B+Tree<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">[1]</span></a></sup></p><p>ä¸€èˆ¬åœ¨æ•°æ®åº“ç³»ç»Ÿæˆ–æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨çš„B+Treeç»“æ„éƒ½åœ¨ç»å…¸B+Treeçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¢åŠ äº†é¡ºåºè®¿é—®æŒ‡é’ˆ</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%862.png"></p><p>åœ¨B+Treeçš„æ¯ä¸ªå¶å­èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰é¡ºåºè®¿é—®æŒ‡é’ˆçš„B+Treeã€‚åšè¿™ä¸ªä¼˜åŒ–çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œä¾‹å¦‚å›¾4ä¸­å¦‚æœè¦æŸ¥è¯¢keyä¸ºä»18åˆ°49çš„æ‰€æœ‰æ•°æ®è®°å½•ï¼Œå½“æ‰¾åˆ°18åï¼Œåªéœ€é¡ºç€èŠ‚ç‚¹å’ŒæŒ‡é’ˆé¡ºåºéå†å°±å¯ä»¥ä¸€æ¬¡æ€§è®¿é—®åˆ°æ‰€æœ‰æ•°æ®èŠ‚ç‚¹ï¼Œæå¤§æé«˜äº†åŒºé—´æŸ¥è¯¢æ•ˆç‡ã€‚</p></li><li><p>ä¸ºä»€ä¹ˆä½¿ç”¨B-Treeï¼ˆB+Treeï¼‰<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">[1]</span></a></sup></p><p>çº¢é»‘æ ‘ç­‰æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°ç´¢å¼•ï¼Œä½†æ˜¯æ–‡ä»¶ç³»ç»ŸåŠæ•°æ®åº“ç³»ç»Ÿæ™®éé‡‡ç”¨B-/+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œç»“åˆè®¡ç®—æœºç»„æˆåŸç†ç›¸å…³çŸ¥è¯†è®¨è®ºB-/+Treeä½œä¸ºç´¢å¼•çš„ç†è®ºåŸºç¡€</p><p>è€ƒè™‘åˆ°<strong>ä¸»å­˜å­˜å–åŸç†</strong>ï¼Œ<strong>ç£ç›˜å­˜å–åŸç†</strong>ï¼Œ<strong>å±€éƒ¨æ€§åŸç†ä¸ç£ç›˜é¢„è¯»</strong>è¯¦ç»†è§<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">[1]</span></a></sup></p><ul><li><p>ä¸€èˆ¬ä½¿ç”¨ç£ç›˜I/Oæ¬¡æ•°è¯„ä»·ç´¢å¼•ç»“æ„çš„ä¼˜åŠ£ã€‚</p></li><li><p>å…ˆä»B-Treeåˆ†æï¼Œæ ¹æ®B-Treeçš„å®šä¹‰ï¼Œå¯çŸ¥æ£€ç´¢ä¸€æ¬¡æœ€å¤šéœ€è¦è®¿é—®hä¸ªèŠ‚ç‚¹ã€‚æ•°æ®åº“ç³»ç»Ÿçš„è®¾è®¡è€…å·§å¦™åˆ©ç”¨äº†ç£ç›˜é¢„è¯»åŸç†ï¼Œå°†ä¸€ä¸ªèŠ‚ç‚¹çš„å¤§å°è®¾ä¸ºç­‰äºä¸€ä¸ªé¡µï¼Œè¿™æ ·æ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦ä¸€æ¬¡I/Oå°±å¯ä»¥å®Œå…¨è½½å…¥ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œåœ¨å®é™…å®ç°B-Treeè¿˜éœ€è¦ä½¿ç”¨å¦‚ä¸‹æŠ€å·§ï¼š</p><blockquote><p>æ¯æ¬¡æ–°å»ºèŠ‚ç‚¹æ—¶ï¼Œç›´æ¥ç”³è¯·ä¸€ä¸ªé¡µçš„ç©ºé—´ï¼Œè¿™æ ·å°±ä¿è¯ä¸€ä¸ªèŠ‚ç‚¹ç‰©ç†ä¸Šä¹Ÿå­˜å‚¨åœ¨ä¸€ä¸ªé¡µé‡Œï¼ŒåŠ ä¹‹è®¡ç®—æœºå­˜å‚¨åˆ†é…éƒ½æ˜¯æŒ‰é¡µå¯¹é½çš„ï¼Œå°±å®ç°äº†ä¸€ä¸ªnodeåªéœ€ä¸€æ¬¡I/Oã€‚</p></blockquote></li><li><p><font color=#FF0000><strong>B-Treeä¸­ä¸€æ¬¡æ£€ç´¢æœ€å¤šéœ€è¦h-1æ¬¡I/Oï¼ˆæ ¹èŠ‚ç‚¹å¸¸é©»å†…å­˜ï¼‰ï¼Œæ¸è¿›å¤æ‚åº¦ä¸º$O(h)=O(logdN)$ã€‚ä¸€èˆ¬å®é™…åº”ç”¨ä¸­ï¼Œå‡ºåº¦dæ˜¯éå¸¸å¤§çš„æ•°å­—ï¼Œé€šå¸¸è¶…è¿‡100ï¼Œå› æ­¤héå¸¸å°ï¼ˆé€šå¸¸ä¸è¶…è¿‡3ï¼‰</strong></font></p></li><li><p>ç»¼ä¸Šæ‰€è¿°ï¼Œç”¨B-Treeä½œä¸ºç´¢å¼•ç»“æ„æ•ˆç‡æ˜¯éå¸¸é«˜çš„</p></li><li><p>çº¢é»‘æ ‘è¿™ç§ç»“æ„ï¼Œhæ˜æ˜¾è¦æ·±çš„å¤šã€‚ç”±äºé€»è¾‘ä¸Šå¾ˆè¿‘çš„èŠ‚ç‚¹ï¼ˆçˆ¶å­ï¼‰ç‰©ç†ä¸Šå¯èƒ½å¾ˆè¿œï¼Œæ— æ³•åˆ©ç”¨å±€éƒ¨æ€§ï¼Œæ‰€ä»¥çº¢é»‘æ ‘çš„I/Oæ¸è¿›å¤æ‚åº¦ä¹Ÿä¸ºO(h)ï¼Œæ•ˆç‡æ˜æ˜¾æ¯”B-Treeå·®å¾ˆå¤š</p></li></ul></li></ul><ul><li><p>B+Treeé€‚åˆå¤–å­˜ç´¢å¼•çš„åŸå› <sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">[1]</span></a></sup>ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+Tree%E6%A3%80%E7%B4%A2%E5%8E%9F%E7%90%864.png"></p></li></ul><ul><li>B+Treeçš„ç´¢å¼•idä¸ºä»€ä¹ˆè®¾ç½®ä¸ºè‡ªå¢æœ‰ç›Šäºç´¢å¼•ç»´æŠ¤<ul><li>å¯ä»¥é¿å…<strong>é¡µåˆ†è£‚</strong>å’Œ<strong>é¡µåˆå¹¶</strong></li></ul></li></ul><ul><li><p>MyISAMç´¢å¼•å®ç°<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">[1]</span></a></sup></p><ul><li>MyISAMå¼•æ“ä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„dataåŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ã€‚ä¸‹å›¾æ˜¯MyISAMç´¢å¼•çš„åŸç†å›¾ï¼š</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeMyISAM%E5%8E%9F%E7%90%861.png"></p><blockquote><p>è¿™é‡Œè®¾è¡¨ä¸€å…±æœ‰ä¸‰åˆ—ï¼Œå‡è®¾æˆ‘ä»¬ä»¥Col1ä¸ºä¸»é”®ï¼Œåˆ™å›¾8æ˜¯ä¸€ä¸ªMyISAMè¡¨çš„ä¸»ç´¢å¼•ï¼ˆPrimary keyï¼‰ç¤ºæ„ã€‚å¯ä»¥çœ‹å‡ºMyISAMçš„ç´¢å¼•æ–‡ä»¶ä»…ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚åœ¨MyISAMä¸­ï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•è¦æ±‚keyæ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„keyå¯ä»¥é‡å¤ã€‚å¦‚æœæˆ‘ä»¬åœ¨Col2ä¸Šå»ºç«‹ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼Œåˆ™æ­¤ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeMyISAM%E5%8E%9F%E7%90%862.png"></p><p>åŒæ ·ä¹Ÿæ˜¯ä¸€é¢—B+Treeï¼ŒdataåŸŸä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚å› æ­¤ï¼ŒMyISAMä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§B+Treeæœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„Keyå­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶dataåŸŸçš„å€¼ï¼Œç„¶åä»¥dataåŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚</p><blockquote><p>MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸InnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚</p></blockquote></li></ul><ul><li><p>InnoDBç´¢å¼•å®ç°<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">[1]</span></a></sup></p><ul><li><p>è™½ç„¶InnoDBä¹Ÿä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†å…·ä½“å®ç°æ–¹å¼å´ä¸MyISAMæˆªç„¶ä¸åŒã€‚</p></li><li><p>ç¬¬ä¸€ä¸ªé‡å¤§åŒºåˆ«æ˜¯InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚ä»ä¸Šæ–‡çŸ¥é“ï¼ŒMyISAMç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚è€Œåœ¨InnoDBä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹dataåŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„keyæ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤InnoDBè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeInnoDB%E5%8E%9F%E7%90%861.png"></p><blockquote><p>ä¸Šå›¾æ˜¯InnoDBä¸»ç´¢å¼•ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æ•°æ®æ–‡ä»¶ï¼‰çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ç§ç´¢å¼•å«åšèšé›†ç´¢å¼•ã€‚å› ä¸ºInnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«è¦æŒ‰ä¸»é”®èšé›†ï¼Œæ‰€ä»¥InnoDBè¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆMyISAMå¯ä»¥æ²¡æœ‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™MySQLç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™MySQLè‡ªåŠ¨ä¸ºInnoDBè¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º6ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢ã€‚</p></blockquote><ul><li><p>ç¬¬äºŒä¸ªä¸MyISAMç´¢å¼•çš„ä¸åŒæ˜¯InnoDBçš„è¾…åŠ©ç´¢å¼•dataåŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚æ¢å¥è¯è¯´ï¼ŒInnoDBçš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸ºdataåŸŸã€‚ä¾‹å¦‚ä¸‹å›¾ä¸ºå®šä¹‰åœ¨Col3ä¸Šçš„ä¸€ä¸ªè¾…åŠ©ç´¢å¼•</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_13_B+TreeInnoDB%E5%8E%9F%E7%90%862.png"></p><p>è¿™é‡Œä»¥è‹±æ–‡å­—ç¬¦çš„ASCIIç ä½œä¸ºæ¯”è¾ƒå‡†åˆ™ã€‚èšé›†ç´¢å¼•è¿™ç§å®ç°æ–¹å¼ä½¿å¾—æŒ‰ä¸»é”®çš„æœç´¢ååˆ†é«˜æ•ˆï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•è·å¾—ä¸»é”®ï¼Œç„¶åç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢è·å¾—è®°å½•ã€‚</p><p>äº†è§£ä¸åŒå­˜å‚¨å¼•æ“çš„ç´¢å¼•å®ç°æ–¹å¼å¯¹äºæ­£ç¡®ä½¿ç”¨å’Œä¼˜åŒ–ç´¢å¼•éƒ½éå¸¸æœ‰å¸®åŠ©ï¼Œä¾‹å¦‚çŸ¥é“äº†InnoDBçš„ç´¢å¼•å®ç°åï¼Œå°±å¾ˆå®¹æ˜“æ˜ç™½ä¸ºä»€ä¹ˆä¸å»ºè®®ä½¿ç”¨è¿‡é•¿çš„å­—æ®µä½œä¸ºä¸»é”®ï¼Œå› ä¸ºæ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»ç´¢å¼•ï¼Œè¿‡é•¿çš„ä¸»ç´¢å¼•ä¼šä»¤è¾…åŠ©ç´¢å¼•å˜å¾—è¿‡å¤§ã€‚å†ä¾‹å¦‚ï¼Œç”¨éå•è°ƒçš„å­—æ®µä½œä¸ºä¸»é”®åœ¨InnoDBä¸­ä¸æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºInnoDBæ•°æ®æ–‡ä»¶æœ¬èº«æ˜¯ä¸€é¢—B+Treeï¼Œéå•è°ƒçš„ä¸»é”®ä¼šé€ æˆåœ¨æ’å…¥æ–°è®°å½•æ—¶æ•°æ®æ–‡ä»¶ä¸ºäº†ç»´æŒB+Treeçš„ç‰¹æ€§è€Œé¢‘ç¹çš„åˆ†è£‚è°ƒæ•´ï¼Œååˆ†ä½æ•ˆï¼Œè€Œä½¿ç”¨è‡ªå¢å­—æ®µä½œä¸ºä¸»é”®åˆ™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p></li></ul></li></ul><blockquote><p>INNODBçš„äºŒçº§ç´¢å¼•ä¸ä¸»é”®ç´¢å¼•æœ‰å¾ˆå¤§çš„ä¸åŒã€‚InnoDBçš„äºŒçº§ç´¢å¼•çš„å¶å­åŒ…å«ä¸»é”®å€¼ï¼Œè€Œä¸æ˜¯è¡ŒæŒ‡é’ˆ(row pointers)ï¼Œè¿™å‡å°äº†ç§»åŠ¨æ•°æ®æˆ–è€…æ•°æ®é¡µé¢åˆ†è£‚æ—¶ç»´æŠ¤äºŒçº§ç´¢å¼•çš„å¼€é”€ï¼Œå› ä¸ºInnoDBä¸éœ€è¦æ›´æ–°ç´¢å¼•çš„è¡ŒæŒ‡é’ˆã€‚</p></blockquote><ul><li><p><font color="FF0000">èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«</font><sup id="fnref:10" class="footnote-ref"><a href="#fn:10" rel="footnote"><span class="hint--top hint--rounded" aria-label="ã€Šæ•°æ®åº“åŸç†ã€‹">[10]</span></a></sup></p><p>èšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±æ˜¯æ•°æ®èŠ‚ç‚¹ï¼Œè€Œéèšç°‡ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä»ç„¶æ˜¯ç´¢å¼•èŠ‚ç‚¹ï¼Œåªä¸è¿‡æœ‰æŒ‡å‘å¯¹åº”æ•°æ®å—çš„æŒ‡é’ˆã€‚è¯¦ç»†è§è¿™ç¯‡<a href="https://blog.csdn.net/alexdamiao/article/details/51934917">åšå®¢</a></p><ul><li>InnoDBæŒ‰èšç°‡ç´¢å¼•çš„å½¢å¼å­˜å‚¨æ•°æ®</li><li>MyISAMæŒ‰ç…§éèšç°‡ç´¢å¼•çš„å½¢å¼å­˜å‚¨æ•°æ®</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_50_%E8%81%9A%E7%B0%87%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95.png"></p></li><li><p><a id="å›è¡¨">å›è¡¨</a></p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_51_%E8%81%9A%E7%B0%87%E5%92%8C%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95.png"></p><h4 id="2-3-6-å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•"><a href="#2-3-6-å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•" class="headerlink" title="2.3.6 å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•"></a>2.3.6 å“ªäº›æƒ…å†µéœ€è¦åˆ›å»ºç´¢å¼•</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_14_%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png"></p><h4 id="2-3-7-å“ªäº›æƒ…å†µä¸éœ€è¦åˆ›å»ºç´¢å¼•"><a href="#2-3-7-å“ªäº›æƒ…å†µä¸éœ€è¦åˆ›å»ºç´¢å¼•" class="headerlink" title="2.3.7 å“ªäº›æƒ…å†µä¸éœ€è¦åˆ›å»ºç´¢å¼•"></a>2.3.7 å“ªäº›æƒ…å†µä¸éœ€è¦åˆ›å»ºç´¢å¼•</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_15_%E4%B8%8D%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png"></p><p>å…³äº<strong>2.3.7.4</strong>çš„åˆ¤æ–­å…¬å¼ï¼š<img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_16_%E4%B8%8D%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5.png"></p><h3 id="2-4-ç´¢å¼•æ€§èƒ½åˆ†æ"><a href="#2-4-ç´¢å¼•æ€§èƒ½åˆ†æ" class="headerlink" title="2.4 ç´¢å¼•æ€§èƒ½åˆ†æ"></a>2.4 ç´¢å¼•æ€§èƒ½åˆ†æ</h3><h4 id="2-4-1-MySQL-Query-Optimizer"><a href="#2-4-1-MySQL-Query-Optimizer" class="headerlink" title="2.4.1 MySQL Query Optimizer"></a>2.4.1 MySQL Query Optimizer</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_17_mysqlQueryOptimizer.png"></p><h4 id="2-4-2-MySQLå¸¸è§ç“¶é¢ˆ"><a href="#2-4-2-MySQLå¸¸è§ç“¶é¢ˆ" class="headerlink" title="2.4.2 MySQLå¸¸è§ç“¶é¢ˆ"></a>2.4.2 MySQLå¸¸è§ç“¶é¢ˆ</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_18_mysql%E5%B8%B8%E8%A7%81%E7%93%B6%E9%A2%88.png"></p><h4 id="2-4-3-Explain"><a href="#2-4-3-Explain" class="headerlink" title="2.4.3 Explain"></a>2.4.3 <font color=#FF0000><strong>Explain</strong></font></h4><h5 id="2-4-3-1-Explainæ˜¯ä»€ä¹ˆ"><a href="#2-4-3-1-Explainæ˜¯ä»€ä¹ˆ" class="headerlink" title="2.4.3.1 Explainæ˜¯ä»€ä¹ˆ"></a>2.4.3.1 Explainæ˜¯ä»€ä¹ˆ</h5><blockquote><p>ä½¿ç”¨EXPLAINå…³é”®å­—å¯ä»¥æ¨¡æ‹Ÿä¼˜åŒ–å™¨æ‰§è¡ŒSQLæŸ¥è¯¢è¯­å¥ï¼Œä»è€ŒçŸ¥é“MySQLæ˜¯å¦‚ä½•å¤„ç†ä½ çš„SQLè¯­å¥çš„ã€‚åˆ†æä½ çš„æŸ¥è¯¢è¯­å¥æˆ–æ˜¯è¡¨ç»“æ„çš„æ€§èƒ½ç“¶é¢ˆ</p></blockquote><p>å®˜ç½‘ä»‹ç»: <a href="http://dev.mysql.com/doc/refman/5.5/en/explain-output.html">http://dev.mysql.com/doc/refman/5.5/en/explain-output.html</a></p><h5 id="2-4-3-2-Explainèƒ½å¹²å˜›"><a href="#2-4-3-2-Explainèƒ½å¹²å˜›" class="headerlink" title="2.4.3.2 Explainèƒ½å¹²å˜›"></a>2.4.3.2 Explainèƒ½å¹²å˜›</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_19_explain%E8%83%BD%E5%B9%B2%E5%98%9B.png"></p><h5 id="2-4-3-3-Explainæ€ä¹ˆç”¨"><a href="#2-4-3-3-Explainæ€ä¹ˆç”¨" class="headerlink" title="2.4.3.3 Explainæ€ä¹ˆç”¨"></a>2.4.3.3 Explainæ€ä¹ˆç”¨</h5><blockquote><p>Explain + SQLè¯­å¥</p></blockquote><ul><li><p>æ‰§è¡Œè®¡åˆ’åŒ…å«çš„ä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_20_explain%E6%80%8E%E4%B9%88%E7%94%A8.png"></p></li></ul><h5 id="2-4-3-4-Explainæ‰§è¡Œè®¡åˆ’å„å­—æ®µè§£é‡Š"><a href="#2-4-3-4-Explainæ‰§è¡Œè®¡åˆ’å„å­—æ®µè§£é‡Š" class="headerlink" title="2.4.3.4 Explainæ‰§è¡Œè®¡åˆ’å„å­—æ®µè§£é‡Š"></a>2.4.3.4 Explainæ‰§è¡Œè®¡åˆ’å„å­—æ®µè§£é‡Š</h5><ul><li><p>id â­ï¼š</p><ul><li><p>å«ä¹‰ï¼šselectæŸ¥è¯¢çš„åºåˆ—å·ï¼ŒåŒ…å«ä¸€ç»„æ•°å­—ï¼Œè¡¨ç¤ºæŸ¥è¯¢ä¸­æ‰§è¡Œselectå­å¥æˆ–æ“ä½œè¡¨çš„<strong>é¡ºåº</strong></p></li><li><p>ä¸‰ç§æƒ…å†µï¼š</p><ul><li><p>idç›¸åŒï¼šæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹</p></li><li><p>idä¸åŒï¼šå¦‚æœæ˜¯å­æŸ¥è¯¢ï¼Œidçš„åºå·ä¼šé€’å¢ï¼Œ<font color=#FF0000><strong>idå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜</strong></font>ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ</p></li><li><p>idç›¸åŒ/ä¸åŒï¼ŒåŒæ—¶å­˜åœ¨ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_21_id3.png"></p><p>è¡ç”Ÿè¡¨ = derived2 â€“&gt; derived + 2 </p><p>ï¼ˆ2 è¡¨ç¤ºç”± id =2 çš„æŸ¥è¯¢è¡ç”Ÿå‡ºæ¥çš„è¡¨ã€‚type è‚¯å®šæ˜¯ all ï¼Œå› ä¸ºè¡ç”Ÿçš„è¡¨æ²¡æœ‰å»ºç«‹ç´¢å¼•ï¼‰</p></li></ul></li></ul></li></ul><ul><li><p>select_typeï¼š</p><ul><li><p>åŒ…å«ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_22_select_type.png"></p></li><li><p>æŸ¥è¯¢çš„ç±»å‹ï¼š</p><p>ä¸»è¦æ˜¯ç”¨äºåŒºåˆ«ï¼šæ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰çš„å¤æ‚æŸ¥è¯¢</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_23_select_type.png"></p></li></ul></li></ul><ul><li>tableï¼šæ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„</li></ul><ul><li><p>typeâ­ï¼š</p><ul><li><p>åŒ…å«ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_24_type.png"></p></li><li><p> typeæ˜¾ç¤ºçš„æ˜¯è®¿é—®ç±»å‹ï¼Œæ˜¯è¾ƒä¸ºé‡è¦çš„ä¸€ä¸ªæŒ‡æ ‡</p></li><li><p><font color=#FF0000><strong>ç»“æœå€¼ä»æœ€å¥½åˆ°æœ€åä¾æ¬¡æ˜¯</strong></font>ï¼š</p><p>(system &gt; const &gt; eq_ref &gt; ref &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; range(å°½é‡ä¿è¯) &gt; index &gt; ALL )</p><p><font color=#FF0000><strong>ç®€åŒ–ç‰ˆï¼ˆè®°ä½ï¼‰</strong></font>ï¼š<strong>system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</strong> ä¸€èˆ¬æ¥è¯´ï¼Œå¾—ä¿è¯æŸ¥è¯¢è‡³å°‘è¾¾åˆ°rangeçº§åˆ«ï¼Œæœ€å¥½èƒ½è¾¾åˆ°refã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_25_type.png"></p></li></ul></li></ul><ul><li>possible_keysï¼š<ul><li>æ˜¾ç¤ºå¯èƒ½åº”ç”¨åœ¨è¿™å¼ è¡¨ä¸­çš„ç´¢å¼•ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªã€‚</li><li>æŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œ<font color=#FF0000><strong>ä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢å®é™…ä½¿ç”¨</strong></font></li></ul></li></ul><ul><li>keyâ­ï¼š<ul><li>å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€‚å¦‚æœä¸ºNULLï¼Œåˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ã€ç´¢å¼•å¤±æ•ˆ</li><li><font color=#0000FF><strong>æŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å’ŒæŸ¥è¯¢çš„selectå­—æ®µé‡å </strong></font></li></ul></li></ul><ul><li>key_lenï¼š<ul><li>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ã€‚ä¸æŸå¤±ç²¾åº¦æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½ </li><li>key_lenå­—æ®µèƒ½å¤Ÿå¸®ä½ æ£€æŸ¥æ˜¯å¦å……åˆ†çš„åˆ©ç”¨ä¸Šäº†ç´¢å¼•</li></ul></li></ul><ul><li>refï¼š<ul><li>æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</li></ul></li></ul><ul><li>rowsâ­ï¼š<ul><li>rowsåˆ—æ˜¾ç¤ºMySQLè®¤ä¸ºå®ƒæ‰§è¡ŒæŸ¥è¯¢æ—¶å¿…é¡»æ£€æŸ¥çš„è¡Œæ•°ã€‚</li><li>è¶Šå°‘è¶Šå¥½</li></ul></li></ul><ul><li>Extraâ­ï¼š<ul><li><p>åŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—ä¸­æ˜¾ç¤ºä½†ååˆ†é‡è¦çš„é¢å¤–ä¿¡æ¯</p></li><li><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_26_Extra.png"></p></li><li><p><font color=#0000FF><strong>è¦†ç›–ç´¢å¼•</strong></font>ï¼šç´¢å¼•æ˜¯é«˜æ•ˆæ‰¾åˆ°è¡Œçš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½†æ˜¯ä¸€èˆ¬æ•°æ®åº“ä¹Ÿèƒ½ä½¿ç”¨ç´¢å¼•æ‰¾åˆ°ä¸€ä¸ªåˆ—çš„æ•°æ®ï¼Œå› æ­¤å®ƒä¸å¿…è¯»å–æ•´ä¸ªè¡Œã€‚æ¯•ç«Ÿç´¢å¼•å¶å­èŠ‚ç‚¹å­˜å‚¨äº†å®ƒä»¬ç´¢å¼•çš„æ•°æ®; å½“èƒ½é€šè¿‡è¯»å–ç´¢å¼•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ•°æ®ï¼Œé‚£å°±ä¸éœ€è¦è¯»å–è¡Œäº†ã€‚</p><p>â‘ ä¸€ä¸ªç´¢å¼• </p><p>â‘¡åŒ…å«äº†(æˆ–è¦†ç›–äº†)[selectå­å¥]ä¸æŸ¥è¯¢æ¡ä»¶[Whereå­å¥]ä¸­ </p><p>â‘¢æ‰€æœ‰éœ€è¦çš„å­—æ®µå°±å«åš<font color=#FF0000><strong>è¦†ç›–ç´¢å¼•</strong></font>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_27_%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95.png"></p><p><strong>ç†è§£</strong>ï¼š     </p><blockquote><p>select id , name from t_xxx where age=18;   </p><p>æœ‰ä¸€ä¸ªç»„åˆç´¢å¼• idx_id_name_age_xxx åŒ…å«äº†(è¦†ç›–äº†) id,name,ageä¸‰ä¸ªå­—æ®µã€‚æŸ¥è¯¢æ—¶ç›´æ¥å°†å»ºç«‹äº†ç´¢å¼•çš„åˆ—è¯»å–å‡ºæ¥äº†ï¼Œè€Œä¸éœ€è¦å»æŸ¥æ‰¾æ‰€åœ¨è¡Œçš„å…¶ä»–æ•°æ®, æ‰€ä»¥å¾ˆé«˜æ•ˆã€‚</p></blockquote><p>(ä¸ªäººè®¤ä¸ºï¼šåœ¨æ•°æ®é‡è¾ƒå¤§ï¼Œå›ºå®šå­—æ®µæŸ¥è¯¢æƒ…å†µå¤šæ—¶å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚)</p></li></ul></li></ul><h3 id="2-5-æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5 æŸ¥è¯¢ä¼˜åŒ–"></a>2.5 æŸ¥è¯¢ä¼˜åŒ–</h3><h4 id="2-5-1-ç´¢å¼•ä¼˜åŒ–"><a href="#2-5-1-ç´¢å¼•ä¼˜åŒ–" class="headerlink" title="2.5.1 ç´¢å¼•ä¼˜åŒ–"></a>2.5.1 ç´¢å¼•ä¼˜åŒ–</h4><h5 id="2-5-1-1-ç´¢å¼•åˆ†æ"><a href="#2-5-1-1-ç´¢å¼•åˆ†æ" class="headerlink" title="2.5.1.1 ç´¢å¼•åˆ†æ"></a>2.5.1.1 ç´¢å¼•åˆ†æ</h5><ul><li><p><a href="https://www.bilibili.com/video/BV12b411K7Zu?p=209">å•è¡¨åˆ†ææ¡ˆä¾‹</a></p></li><li><p><a href="https://www.bilibili.com/video/BV12b411K7Zu?p=210">å¤šè¡¨åˆ†ææ¡ˆä¾‹</a></p></li><li><p><a href="https://www.bilibili.com/video/BV12b411K7Zu?p=211">ä¸‰è¡¨åˆ†ææ¡ˆä¾‹</a></p><ul><li>å°½å¯èƒ½å‡å°‘Joinè¯­å¥çš„NextedLoopçš„å¾ªç¯æ€»æ¬¡æ•°ï¼šæ°¸è¿œç”¨å°ç»“æœé›†é©±åŠ¨å¤§ç»“æœé›†</li><li>ä¼˜å…ˆä¼˜åŒ–NestedLoopçš„å†…å±‚å¾ªç¯</li><li><font color=#FF0000><strong>ä¿è¯Joinè¯­å¥ä¸­è¢«é©±åŠ¨è¡¨ä¸ŠJoinæ¡ä»¶çš„å­—æ®µå·²ç»è¢«ç´¢å¼•</strong></font></li><li>å½“æ— æ³•ä¿è¯è¢«é©±åŠ¨è¡¨çš„Joinæ¡ä»¶å­—æ®µè¢«ç´¢å¼•ä¸”å†…å­˜å……è¶³çš„å‰æä¸‹ï¼Œä¸è¦å¤ªåå•¬JoinBufferçš„è®¾ç½®</li></ul></li></ul><h5 id="2-5-1-2-ç´¢å¼•å¤±æ•ˆ"><a href="#2-5-1-2-ç´¢å¼•å¤±æ•ˆ" class="headerlink" title="2.5.1.2 ç´¢å¼•å¤±æ•ˆ"></a>2.5.1.2 <font color=#FF0000><strong>ç´¢å¼•å¤±æ•ˆ</strong></font></h5><ul><li><font color=#FF0000><strong>è”åˆç´¢å¼•åœ¨B+Treeä¸Šçš„å­˜å‚¨ç»“æ„åŠæ•°æ®æŸ¥æ‰¾æ–¹å¼.</strong></font> â­ï¼Œå…·ä½“å‚è€ƒ<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://blog.csdn.net/feichitianxia/article/details/107997795">[3]</span></a></sup>ï¼ˆåŸºäºåº•å±‚å»ç†è§£ç´¢å¼•å¤±æ•ˆï¼‰<ul><li>è¿™é‡Œè´´ä¸€ä¸ªç®€å•çš„è”åˆç´¢å¼•çš„ç»“æ„å›¾ï¼Œå…·ä½“çœ‹ä¸Šé¢çš„å¸–å­</li><li><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_30_%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%92%8C%E6%9F%A5%E6%89%BE%E6%96%B9%E5%BC%8F.png"></li></ul></li><li>ç´¢å¼•å¤±æ•ˆæ¡ˆä¾‹</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_28_%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88.png"></p><ul><li><p>å°æ€»ç»“ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_29_%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E5%B0%8F%E6%80%BB%E7%BB%93.png"></p></li><li><p>ï¼ˆè¡¥å……ï¼‰è¦†ç›–ç´¢å¼•ã€æœ€å·¦åŒ¹é…ã€ç´¢å¼•ä¸‹æ¨çš„ç†è§£â­</p><ul><li><p><a href="#å›è¡¨">å›è¡¨</a>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from table where name&#x3D;zhansan;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡æŸ¥è¯¢nameçš„B+Treeï¼Œæ ¹æ®é‚£ä¹ˆè·å–åˆ°ä¸»é”®idï¼Œç„¶åå†æ ¹æ®idå»idçš„B+Treeæ‰¾åˆ°è¡Œè®°å½•ï¼Œè¿™ä¸ªå›è¡¨è¿‡ç¨‹ä¼šå¯¼è‡´IOæ¬¡æ•°å˜å¤šã€‚</p></li><li><p>è¦†ç›–ç´¢å¼•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select id,name from table where name&#x3D;zhansan;<br></code></pre></td></tr></table></figure><p>åœ¨è¿›è¡Œæ£€ç´¢æ˜¯ï¼Œç›´æ¥æ›´å…·é‚£ä¹ˆå»nameçš„B+Treeè·å–åˆ°idï¼Œnameä¸¤åˆ—çš„å€¼ï¼Œä¸éœ€è¦å›è¡¨ï¼Œæ•ˆç‡é«˜ï¼Œåº”è¯¥å°½å¯èƒ½å¤šçš„ä½¿ç”¨ç´¢å¼•è¦†ç›–æ¥ä»£æ›¿å›è¡¨ï¼Œæ‰€ä»¥æœ‰æ—¶å€™ï¼Œåœ¨å¤æ‚çš„sqlä¸­ï¼Œå¯ä»¥è€ƒè™‘å°†ä¸ç›¸å…³çš„åˆ—éƒ½è®¾ç½®ä¸ºç´¢å¼•åˆ—</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select id,name,age from table where name&#x3D;zhangsan;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œnameï¼Œageä½œä¸ºä¸€ä¸ªè”åˆç´¢å¼•</p></li><li><p>æœ€å·¦åŒ¹é…ï¼š</p><p>æœ‰ä¸€ä¸ªè¡¨ï¼šidï¼Œnameï¼Œageï¼Œgenderï¼ˆidæ˜¯ä¸»é”®ï¼Œnameï¼Œageæ˜¯è”åˆç´¢å¼•ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from table where name&#x3D;?           # ç¬¦åˆ<br>select * from table where name&#x3D;? and age&#x3D;? # ç¬¦åˆ<br>select * from table where age&#x3D;? &#x3D; name&#x3D;?   # ä¼˜åŒ–å™¨ä¼šä¼˜åŒ–,ä½¿å…¶ç¬¦åˆæœ€å·¦åŒ¹é…<br>select * from table where age&#x3D;?            # ä¸ç¬¦åˆ<br></code></pre></td></tr></table></figure></li><li><p>ç´¢å¼•ä¸‹æ¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from table where name&#x3D;? and age&#x3D;?<br></code></pre></td></tr></table></figure><ul><li>åœ¨æ²¡æœ‰ç´¢å¼•ä¸‹æ¨ä¹‹å‰ï¼Œå…ˆæ ¹æ®nameå»å­˜å‚¨å¼•æ“ä¸­æ‹‰å–ç¬¦åˆç»“æ„çš„æ•°æ®ï¼Œè¿”å›åˆ°serverå±‚ï¼Œåœ¨serverå±‚ä¸­å¯¹ageçš„æ¡ä»¶è¿›è¡Œè¿‡æ»¤</li><li>æœ‰äº†ç´¢å¼•ä¸‹æ¨ä¹‹åï¼Œæ ¹æ®nameï¼Œageä¸¤ä¸ªæ¡ä»¶ç›´æ¥ä»å­˜å‚¨å¼•æ“ä¸­æ‹‰å»ç»“æœï¼Œä¸éœ€è¦å†serverå±‚åšæ¡ä»¶è¿‡æ»¤</li><li>mysql5.7ç‰ˆæœ¬ä¹‹åé»˜è®¤å¼€å¯</li></ul></li></ul></li></ul><h5 id="2-5-1-3-ä¸€èˆ¬æ€§å»ºè®®"><a href="#2-5-1-3-ä¸€èˆ¬æ€§å»ºè®®" class="headerlink" title="2.5.1.3 ä¸€èˆ¬æ€§å»ºè®®"></a>2.5.1.3 ä¸€èˆ¬æ€§å»ºè®®</h5><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_31_%E7%B4%A2%E5%BC%95%E4%B8%80%E8%88%AC%E6%80%A7%E5%BB%BA%E8%AE%AE2.png"></p><h5 id="2-5-1-4-ä¼˜åŒ–å£è¯€"><a href="#2-5-1-4-ä¼˜åŒ–å£è¯€" class="headerlink" title="2.5.1.4 ä¼˜åŒ–å£è¯€"></a>2.5.1.4 ä¼˜åŒ–å£è¯€</h5><p>å»ºè®®ç†è§£ï¼Œä¸ç”¨èƒŒ</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_32_%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%8F%A3%E8%AF%80.png"></p><h4 id="2-5-2-æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-2-æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5.2 æŸ¥è¯¢ä¼˜åŒ–"></a>2.5.2 æŸ¥è¯¢ä¼˜åŒ–</h4><blockquote><p>å¯¹äºæ•°æ®åº“åˆ†æ</p><ol><li>è§‚å¯Ÿï¼Œè‡³å°‘è·‘ä¸€å¤©ï¼Œçœ‹çœ‹ç”Ÿäº§çš„æ…¢SQLæƒ…å†µã€‚</li><li>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œè®¾ç½®é˜ˆå€¼ï¼Œæ¯”å¦‚è¶…è¿‡5ç§’é’Ÿçš„å°±æ˜¯æ…¢SQLï¼Œå¹¶å°†å®ƒæŠ“å–å‡ºæ¥ã€‚</li><li>explain+æ…¢SQLåˆ†æ</li><li>show profile</li><li>è¿ç»´ç»ç† or DBAæ¥è¿›è¡ŒSQLæ•°æ®åº“æœåŠ¡å™¨çš„å‚æ•°è°ƒä¼˜</li></ol></blockquote><p><strong>æ€»ç»“</strong>ï¼š</p><ul><li>æ…¢æŸ¥è¯¢å¼€å¯å¹¶æ•è·</li><li>explain+æ…¢SQLåˆ†æ</li><li>show profileæŸ¥è¯¢SQLå†MySQLæœåŠ¡å™¨é‡Œé¢çš„æ‰§è¡Œç»†èŠ‚å’Œç”Ÿå‘½å‘¨æœŸæƒ…å†µ</li><li>SQLæ•°æ®åº“æœåŠ¡å™¨å‚æ•°è°ƒä¼˜</li></ul><p>å…³äºä¸‹é¢2.5.2.1å’Œ2.5.2.3çš„ä¼˜åŒ–åŸç†è§æˆ‘åé¢å†™çš„<a href="http://lihengxu.cn/2021/04/01/MySQL_Join%E4%BC%98%E5%8C%96/">Joinä¼˜åŒ–</a></p><h5 id="2-5-2-1-å°è¡¨é©±åŠ¨å¤§è¡¨"><a href="#2-5-2-1-å°è¡¨é©±åŠ¨å¤§è¡¨" class="headerlink" title="2.5.2.1 å°è¡¨é©±åŠ¨å¤§è¡¨"></a>2.5.2.1 å°è¡¨é©±åŠ¨å¤§è¡¨</h5><ul><li><p>ç±»ä¼¼åµŒå¥—å¾ªç¯Nested Loop</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_33_%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96.png"></p></li><li><p>in/exists</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_33_%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%962.png"></p></li></ul><h5 id="2-5-2-2-order-byå…³é”®å­—ä¼˜åŒ–"><a href="#2-5-2-2-order-byå…³é”®å­—ä¼˜åŒ–" class="headerlink" title="2.5.2.2 order byå…³é”®å­—ä¼˜åŒ–"></a>2.5.2.2 order byå…³é”®å­—ä¼˜åŒ–</h5><blockquote><p>å°½é‡ä½¿ç”¨Indexæ–¹å¼æ’åº,é¿å…ä½¿ç”¨FileSortæ–¹å¼æ’åº</p></blockquote><ul><li><p>MySQLæ”¯æŒäºŒç§æ–¹å¼çš„æ’åºï¼ŒFileSortå’ŒIndex</p><ul><li>Indexæ•ˆç‡é«˜.å®ƒæŒ‡MySQLæ‰«æç´¢å¼•æœ¬èº«å®Œæˆæ’åºã€‚</li></ul></li><li><p>FileSortæ–¹å¼æ•ˆç‡è¾ƒä½ã€‚</p></li></ul><blockquote><p>å°½å¯èƒ½åœ¨ç´¢å¼•åˆ—ä¸Šå®Œæˆæ’åºæ“ä½œï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€</p></blockquote><ul><li>ORDER BYæ»¡è¶³ä¸¤æƒ…å†µï¼Œä¼šä½¿ç”¨Indexæ–¹å¼æ’åº<ul><li>ORDER BY è¯­å¥ä½¿ç”¨ç´¢å¼•æœ€å·¦å‰åˆ—</li><li>ä½¿ç”¨Whereå­å¥ä¸Order BYå­å¥æ¡ä»¶åˆ—ç»„åˆæ»¡è¶³ç´¢å¼•æœ€å·¦å‰åˆ—</li><li>whereå­å¥ä¸­å¦‚æœå‡ºç°ç´¢å¼•çš„èŒƒå›´æŸ¥è¯¢(å³explainä¸­å‡ºç°range)ä¼šå¯¼è‡´order by ç´¢å¼•å¤±æ•ˆã€‚</li></ul></li></ul><ul><li><p>å°æ€»ç»“ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_35_orderby%E4%BC%98%E5%8C%96%E6%80%BB%E7%BB%93.png"></p></li></ul><blockquote><p>å¦‚æœä¸åœ¨ç´¢å¼•åˆ—ä¸Šï¼Œfilesortæœ‰ä¸¤ç§ç®—æ³•ï¼š</p><p>mysqlå°±è¦å¯åŠ¨<strong>åŒè·¯æ’åº</strong>å’Œ<strong>å•è·¯æ’åº</strong></p></blockquote><ul><li>åŒè·¯æ’åº<ul><li>MySQL 4.1ä¹‹å‰æ˜¯ä½¿ç”¨åŒè·¯æ’åº,å­—é¢æ„æ€å°±æ˜¯ä¸¤æ¬¡æ‰«æç£ç›˜ï¼Œæœ€ç»ˆå¾—åˆ°æ•°æ®ï¼Œ<br>è¯»å–è¡ŒæŒ‡é’ˆå’Œorderbyåˆ—ï¼Œå¯¹ä»–ä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«æå·²ç»æ’åºå¥½çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§åˆ—è¡¨ä¸­çš„å€¼é‡æ–°ä»åˆ—è¡¨ä¸­è¯»å–å¯¹åº”çš„æ•°æ®è¾“å‡º</li><li>ä»ç£ç›˜å–æ’åºå­—æ®µï¼Œåœ¨bufferè¿›è¡Œæ’åºï¼Œå†ä»ç£ç›˜å–å…¶ä»–å­—æ®µã€‚ï¼ˆä¸¤æ¬¡ï¼‰</li><li><strong>ç¼ºç‚¹</strong>ï¼šå–ä¸€æ‰¹æ•°æ®ï¼Œè¦å¯¹ç£ç›˜è¿›è¡Œäº†ä¸¤æ¬¡æ‰«æï¼Œä¼—æ‰€å‘¨çŸ¥ï¼ŒI\Oæ˜¯å¾ˆè€—æ—¶çš„ï¼Œæ‰€ä»¥åœ¨mysql4.1ä¹‹åï¼Œå‡ºç°äº†ç¬¬äºŒç§æ”¹è¿›çš„ç®—æ³•ï¼Œå°±æ˜¯å•è·¯æ’åºã€‚</li></ul></li></ul><ul><li>å•è·¯æ’åº<ul><li>ä»ç£ç›˜è¯»å–æŸ¥è¯¢éœ€è¦çš„æ‰€æœ‰åˆ—ï¼ŒæŒ‰ç…§order byåˆ—åœ¨bufferå¯¹å®ƒä»¬è¿›è¡Œæ’åºï¼Œç„¶åæ‰«ææ’åºåçš„åˆ—è¡¨è¿›è¡Œè¾“å‡ºï¼Œ</li><li>å®ƒçš„æ•ˆç‡æ›´å¿«ä¸€äº›ï¼Œé¿å…äº†ç¬¬äºŒæ¬¡è¯»å–æ•°æ®ã€‚å¹¶ä¸”æŠŠéšæœºIOå˜æˆäº†é¡ºåºIO,ä½†æ˜¯å®ƒä¼šä½¿ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œå› ä¸ºå®ƒæŠŠæ¯ä¸€è¡Œéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­äº†ã€‚</li><li>ç»“è®ºåŠå¼•ç”³å‡ºçš„é—®é¢˜ï¼š<ul><li>ç»“è®ºï¼šç”±äºå•è·¯æ˜¯åå‡ºçš„ï¼Œæ€»ä½“è€Œè¨€å¥½è¿‡åŒè·¯</li><li>é—®é¢˜ï¼šåœ¨sort_bufferä¸­ï¼Œæ–¹æ³•Bæ¯”æ–¹æ³•Aè¦å¤šå ç”¨å¾ˆå¤šç©ºé—´ï¼Œå› ä¸ºæ–¹æ³•Bæ˜¯æŠŠæ‰€æœ‰å­—æ®µéƒ½å–å‡º, æ‰€ä»¥æœ‰å¯èƒ½å–å‡ºçš„æ•°æ®çš„æ€»å¤§å°è¶…å‡ºäº†sort_bufferçš„å®¹é‡ï¼Œå¯¼è‡´æ¯æ¬¡åªèƒ½å–sort_bufferå®¹é‡å¤§å°çš„æ•°æ®ï¼Œè¿›è¡Œæ’åºï¼ˆåˆ›å»ºtmpæ–‡ä»¶ï¼Œå¤šè·¯åˆå¹¶ï¼‰ï¼Œæ’å®Œå†å–å–sort_bufferå®¹é‡å¤§å°ï¼Œå†æ’â€¦â€¦ä»è€Œå¤šæ¬¡I/Oã€‚æœ¬æ¥æƒ³çœä¸€æ¬¡I/Oæ“ä½œï¼Œåè€Œå¯¼è‡´äº†å¤§é‡çš„I/Oæ“ä½œï¼Œåè€Œå¾—ä¸å¿å¤±ã€‚</li></ul></li></ul></li></ul><ul><li><p>ä¼˜åŒ–ç­–ç•¥</p><ul><li><p>å¢å¤§sort_buffer_sizeå‚æ•°çš„è®¾ç½®</p></li><li><p>å¢å¤§max_length_for_sort_dataå‚æ•°çš„è®¾ç½®</p></li><li><p>å»æ‰select åé¢ä¸éœ€è¦çš„å­—æ®µ</p></li><li><p>ä»¥ä¸Šç­–ç•¥å¯¹åº”çš„åŸå› ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_34_orderby%E4%BC%98%E5%8C%96.png"></p></li></ul></li></ul><h5 id="2-5-2-3-group-byå…³é”®å­—ä¼˜åŒ–"><a href="#2-5-2-3-group-byå…³é”®å­—ä¼˜åŒ–" class="headerlink" title="2.5.2.3 group byå…³é”®å­—ä¼˜åŒ–"></a>2.5.2.3 group byå…³é”®å­—ä¼˜åŒ–</h5><ul><li>group byå®è´¨æ˜¯å…ˆæ’åºåè¿›è¡Œåˆ†ç»„ï¼Œéµç…§ç´¢å¼•å»ºçš„æœ€ä½³å·¦å‰ç¼€</li><li>å½“æ— æ³•ä½¿ç”¨ç´¢å¼•åˆ—ï¼Œå¢å¤§max_length_for_sort_dataå‚æ•°çš„è®¾ç½®+å¢å¤§sort_buffer_sizeå‚æ•°çš„è®¾ç½®</li><li>whereé«˜äºhavingï¼Œèƒ½å†™åœ¨whereé™å®šçš„æ¡ä»¶å°±ä¸è¦å»havingé™å®šäº†ã€‚</li></ul><h5 id="2-5-2-4-å…³è”æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-2-4-å…³è”æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5.2.4 å…³è”æŸ¥è¯¢ä¼˜åŒ–"></a>2.5.2.4 å…³è”æŸ¥è¯¢ä¼˜åŒ–</h5><ul><li>ä¿è¯è¢«é©±åŠ¨è¡¨çš„joinå­—æ®µå·²ç»è¢«ç´¢å¼•</li><li>left join æ—¶ï¼Œé€‰æ‹©å°è¡¨ä½œä¸ºé©±åŠ¨è¡¨ï¼Œå¤§è¡¨ä½œä¸ºè¢«é©±åŠ¨è¡¨</li><li>inner join æ—¶ï¼Œmysqlä¼šè‡ªå·±å¸®ä½ æŠŠå°ç»“æœé›†çš„è¡¨é€‰ä¸ºé©±åŠ¨è¡¨</li><li>å­æŸ¥è¯¢å°½é‡ä¸è¦æ”¾åœ¨è¢«é©±åŠ¨è¡¨ï¼Œæœ‰å¯èƒ½ä½¿ç”¨ä¸åˆ°ç´¢å¼•</li></ul><h5 id="2-5-2-5-å­æŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-2-5-å­æŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5.2.5 å­æŸ¥è¯¢ä¼˜åŒ–"></a>2.5.2.5 å­æŸ¥è¯¢ä¼˜åŒ–</h5><ul><li>æœ‰ç´¢å¼•çš„æƒ…å†µä¸‹ ç”¨ inner join æ˜¯æœ€å¥½çš„ å…¶æ¬¡æ˜¯ in ï¼Œexistsæœ€ç³Ÿç³• </li><li>æ— ç´¢å¼•çš„æƒ…å†µä¸‹ç”¨ å°è¡¨é©±åŠ¨å¤§è¡¨ å› ä¸ºjoin æ–¹å¼éœ€è¦distinct ï¼Œæ²¡æœ‰ç´¢å¼•distinctæ¶ˆè€—æ€§èƒ½è¾ƒå¤§ æ‰€ä»¥ existsæ€§èƒ½æœ€ä½³ inå…¶æ¬¡ joinæ€§èƒ½æœ€å·®</li><li>æ— ç´¢å¼•çš„æƒ…å†µä¸‹å¤§è¡¨é©±åŠ¨å°è¡¨in å’Œ exists çš„æ€§èƒ½åº”è¯¥æ˜¯æ¥è¿‘çš„ éƒ½æ¯”è¾ƒç³Ÿç³• existsç¨å¾®å¥½ä¸€ç‚¹ è¶…ä¸è¿‡5%   ä½†æ˜¯inner join ç”±äºä½¿ç”¨äº† join buffer æ‰€ä»¥å¿«å¾ˆå¤šå¦‚æœleft join åˆ™æœ€æ…¢ </li></ul><h5 id="2-5-2-6-åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–"><a href="#2-5-2-6-åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–" class="headerlink" title="2.5.2.6 åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–"></a>2.5.2.6 åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># ä¼˜åŒ–å‰<br>EXPLAIN SELECT SQL_NO_CACHE * FROM emp ORDER BY deptno  LIMIT 10000,40<br># ä¼˜åŒ–å<br>EXPLAIN SELECT SQL_NO_CACHE * FROM emp INNER JOIN (SELECT id FROM emp e ORDER BY deptno LIMIT 10000,40) a ON a.id&#x3D;emp.id<br></code></pre></td></tr></table></figure><ul><li><p>å…ˆåˆ©ç”¨è¦†ç›–ç´¢å¼•æŠŠè¦å–çš„æ•°æ®è¡Œçš„ä¸»é”®å–åˆ°ï¼Œç„¶åå†ç”¨è¿™ä¸ªä¸»é”®åˆ—ä¸æ•°æ®è¡¨åšå…³è”ï¼ˆæŸ¥è¯¢çš„æ•°æ®é‡å°äº†ï¼‰</p></li><li><p>å®è·µè¯æ˜ï¼š </p><p>â‘ ã€order by åçš„å­—æ®µï¼ˆXXXï¼‰æœ‰ç´¢å¼• </p><p>â‘¡ã€sql ä¸­æœ‰ limit æ—¶ï¼Œ  å½“ select id æˆ– XXXå­—æ®µç´¢å¼•åŒ…å«å­—æ®µæ—¶ ï¼Œæ˜¾ç¤º using index  å½“ select åçš„å­—æ®µå«æœ‰ bouder by å­—æ®µç´¢å¼•ä¸åŒ…å«çš„å­—æ®µæ—¶ï¼Œå°†æ˜¾ç¤º using filesort </p></li></ul><h5 id="2-5-2-7-å»é‡ä¼˜åŒ–"><a href="#2-5-2-7-å»é‡ä¼˜åŒ–" class="headerlink" title="2.5.2.7 å»é‡ä¼˜åŒ–"></a>2.5.2.7 å»é‡ä¼˜åŒ–</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># å°†äº§ç”Ÿé‡å¤æ•°æ®<br>select kcdz from t_mall_sku where id in( 3,4,5,6,8 )<br><br># ä½¿ç”¨ distinct å…³é”®å­—å»é‡æ¶ˆè€—æ€§èƒ½ä¼˜åŒ–<br>select distinct kcdz from t_mall_sku where id in( 3,4,5,6,8 )<br><br># èƒ½å¤Ÿåˆ©ç”¨åˆ°ç´¢å¼•<br>select  kcdz from t_mall_sku where id in( 3,4,5,6,8 )  group by kcdz <br></code></pre></td></tr></table></figure><ul><li><p>å°½é‡ä¸è¦ä½¿ç”¨ distinct å…³é”®å­—å»é‡</p></li><li><p>group byèƒ½å»é‡ä¸”åˆ©ç”¨ç´¢å¼•</p></li></ul><h2 id="3-æŸ¥è¯¢æˆªå–åˆ†æ"><a href="#3-æŸ¥è¯¢æˆªå–åˆ†æ" class="headerlink" title="3. æŸ¥è¯¢æˆªå–åˆ†æ"></a>3. æŸ¥è¯¢æˆªå–åˆ†æ</h2><h3 id="3-1-æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#3-1-æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="3.1 æ…¢æŸ¥è¯¢æ—¥å¿—"></a>3.1 æ…¢æŸ¥è¯¢æ—¥å¿—</h3><h4 id="3-1-1-æ…¢æŸ¥è¯¢æ—¥å¿—ä»‹ç»"><a href="#3-1-1-æ…¢æŸ¥è¯¢æ—¥å¿—ä»‹ç»" class="headerlink" title="3.1.1 æ…¢æŸ¥è¯¢æ—¥å¿—ä»‹ç»"></a>3.1.1 æ…¢æŸ¥è¯¢æ—¥å¿—ä»‹ç»</h4><ul><li><p>MySQLçš„æ…¢æŸ¥è¯¢æ—¥å¿—æ˜¯MySQLæä¾›çš„ä¸€ç§æ—¥å¿—è®°å½•ï¼Œå®ƒç”¨æ¥è®°å½•åœ¨MySQLä¸­å“åº”æ—¶é—´è¶…è¿‡é˜€å€¼çš„è¯­å¥ï¼Œå…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡long_query_timeå€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚ </p></li><li><p>å…·ä½“æŒ‡è¿è¡Œæ—¶é—´è¶…è¿‡long_query_timeå€¼çš„SQLï¼Œåˆ™ä¼šè¢«è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ã€‚long_query_timeçš„é»˜è®¤å€¼ä¸º10ï¼Œæ„æ€æ˜¯è¿è¡Œ10ç§’ä»¥ä¸Šçš„è¯­å¥ã€‚ </p></li><li><p>ç”±ä»–æ¥æŸ¥çœ‹å“ªäº›SQLè¶…å‡ºäº†æˆ‘ä»¬çš„æœ€å¤§å¿è€æ—¶é—´å€¼ï¼Œæ¯”å¦‚ä¸€æ¡sqlæ‰§è¡Œè¶…è¿‡5ç§’é’Ÿï¼Œæˆ‘ä»¬å°±ç®—æ…¢SQLï¼Œå¸Œæœ›èƒ½æ”¶é›†è¶…è¿‡5ç§’çš„sqlï¼Œç»“åˆä¹‹å‰explainè¿›è¡Œå…¨é¢åˆ†æã€‚ </p></li></ul><h4 id="3-1-2-æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨"><a href="#3-1-2-æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨" class="headerlink" title="3.1.2 æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨"></a>3.1.2 æ…¢æŸ¥è¯¢æ—¥å¿—ä½¿ç”¨</h4><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒMySQLæ•°æ®åº“æ²¡æœ‰å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥è®¾ç½®è¿™ä¸ªå‚æ•°ã€‚å½“ç„¶ï¼Œå¦‚æœä¸æ˜¯è°ƒä¼˜éœ€è¦çš„è¯ï¼Œä¸€èˆ¬ä¸å»ºè®®å¯åŠ¨è¯¥å‚æ•°ï¼Œå› ä¸ºå¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—ä¼šæˆ–å¤šæˆ–å°‘å¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“ã€‚æ…¢æŸ¥è¯¢æ—¥å¿—æ”¯æŒå°†æ—¥å¿—è®°å½•å†™å…¥æ–‡ä»¶</p></blockquote><ul><li><p>æŸ¥çœ‹æ˜¯å¦å¼€å¯åŠå¦‚ä½•å¼€å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># æŸ¥çœ‹<br>SHOW VARIABLES LIKE &#39;%slow_query_log%&#39;;<br># è®¾ç½®å¼€å¯ï¼Œåªå¯¹å½“å‰æ•°æ®åº“ç”Ÿæ•ˆ<br>set global slow_query_log&#x3D;1;<br></code></pre></td></tr></table></figure></li><li><p>é‚£ä¹ˆå¼€å¯äº†æ…¢æŸ¥è¯¢æ—¥å¿—åï¼Œä»€ä¹ˆæ ·çš„SQLæ‰ä¼šè®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—é‡Œé¢å‘¢ï¼Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_36_%E6%85%A2%E6%9F%A5%E8%AF%A2%E8%AE%B0%E5%BD%95%E5%88%B0%E7%9A%84sql.png"></p></li></ul><ul><li><p>æŸ¥çœ‹å½“å‰å¤šå°‘ç§’ç®—æ…¢, ä»¥åŠä¿®æ”¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># æŸ¥çœ‹<br>SHOW VARIABLES LIKE &#39;long_query_time%&#39;;<br># è®¾ç½®<br>set global long_query_time&#x3D;1;<br># éœ€è¦é‡æ–°è¿æ¥æˆ–æ–°å¼€ä¸€ä¸ªä¼šè¯æ‰èƒ½çœ‹åˆ°ä¿®æ”¹å€¼<br>SHOW VARIABLES LIKE &#39;long_query_time%&#39;;<br><br># æ”¹å˜å½“å‰sessionå˜é‡<br>set session long_query_time&#x3D;1;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥è¯¢å½“å‰ç³»ç»Ÿä¸­æœ‰å¤šå°‘æ¡æ…¢æŸ¥è¯¢è®°å½•</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show global status like &#39;%Slow_queries%&#39;;  <br></code></pre></td></tr></table></figure></li></ul><h4 id="3-1-3-æ—¥å¿—åˆ†æå·¥å…·mysqldumpslow"><a href="#3-1-3-æ—¥å¿—åˆ†æå·¥å…·mysqldumpslow" class="headerlink" title="3.1.3 æ—¥å¿—åˆ†æå·¥å…·mysqldumpslow"></a>3.1.3 æ—¥å¿—åˆ†æå·¥å…·mysqldumpslow</h4><ul><li><p>å·¥ä½œå¸¸ç”¨å‚è€ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># å¾—åˆ°è¿”å›è®°å½•é›†æœ€å¤šçš„10ä¸ªSQL<br>mysqldumpslow -s r -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;atguigu-slow.log<br># å¾—åˆ°è®¿é—®æ¬¡æ•°æœ€å¤šçš„10ä¸ªSQL<br>mysqldumpslow -s c -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;atguigu-slow.log<br># å¾—åˆ°æŒ‰ç…§æ—¶é—´æ’åºçš„å‰10æ¡é‡Œé¢å«æœ‰å·¦è¿æ¥çš„æŸ¥è¯¢è¯­å¥<br>mysqldumpslow -s t -t 10 -g &quot;left join&quot; &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;atguigu-slow.log<br># å¦å¤–å»ºè®®åœ¨ä½¿ç”¨è¿™äº›å‘½ä»¤æ—¶ç»“åˆ | å’Œmore ä½¿ç”¨ ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°çˆ†å±æƒ…å†µ<br>mysqldumpslow -s r -t 10 &#x2F;var&#x2F;lib&#x2F;mysql&#x2F;atguigu-slow.log | more<br></code></pre></td></tr></table></figure></li><li><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_37_mysqldumpslow.png"></p></li></ul><h3 id="3-2-æ‰¹é‡æ•°æ®è„šæœ¬"><a href="#3-2-æ‰¹é‡æ•°æ®è„šæœ¬" class="headerlink" title="3.2 æ‰¹é‡æ•°æ®è„šæœ¬"></a>3.2 æ‰¹é‡æ•°æ®è„šæœ¬</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_38_%E6%89%B9%E9%87%8F%E6%95%B0%E6%8D%AE%E8%84%9A%E6%9C%AC.png"></p><ul><li><p>åˆ›å»ºå‡½æ•°ï¼Œå‡å¦‚æŠ¥é”™ï¼šThis function has none of DETERMINISTICâ€¦â€¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># ç”±äºå¼€å¯è¿‡æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œå› ä¸ºæˆ‘ä»¬å¼€å¯äº† bin-log, æˆ‘ä»¬å°±å¿…é¡»ä¸ºæˆ‘ä»¬çš„functionæŒ‡å®šä¸€ä¸ªå‚æ•°ã€‚<br>show variables like &#39;log_bin_trust_function_creators&#39;;<br>set global log_bin_trust_function_creators&#x3D;1;<br><br># è¿™æ ·æ·»åŠ äº†å‚æ•°ä»¥åï¼Œå¦‚æœmysqldé‡å¯ï¼Œä¸Šè¿°å‚æ•°åˆä¼šæ¶ˆå¤±ï¼Œæ°¸ä¹…æ–¹æ³•ï¼š<br># windowsä¸‹: my.ini[mysqld]åŠ ä¸Šlog_bin_trust_function_creators&#x3D;1<br># linuxä¸‹: &#x2F;etc&#x2F;my.cnfä¸‹my.cnf[mysqld]åŠ ä¸Šlog_bin_trust_function_creators&#x3D;1<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå‡½æ•°,ä¿è¯æ¯æ¡æ•°æ®éƒ½ä¸åŒ</p><ul><li><p>éšæœºäº§ç”Ÿå­—ç¬¦ä¸²</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER $$<br>CREATE FUNCTION rand_string(n INT) RETURNS VARCHAR(255)<br>BEGIN    ##æ–¹æ³•å¼€å§‹ <br>DECLARE chars_str VARCHAR(100) DEFAULT   &#39;abcdefghijklmnopqrstuvwxyzABCDEFJHIJKLMNOPQRSTUVWXYZ&#39;;  ##å£°æ˜ä¸€ä¸ª å­—ç¬¦çªœé•¿åº¦ä¸º 100 çš„å˜é‡ chars_str ,é»˜è®¤å€¼  <br>DECLARE return_str VARCHAR(255) DEFAULT &#39;&#39;; DECLARE i INT DEFAULT 0;  ##å¾ªç¯å¼€å§‹<br>WHILE i &lt; n DO   <br>SET return_str &#x3D;CONCAT(return_str,SUBSTRING(chars_str,FLOOR(1+RAND()*52),1));##concat è¿æ¥å‡½æ•°  ï¼Œsubstring(a,index,length) ä»indexå¤„å¼€å§‹æˆªå–<br>SET i &#x3D; i + 1;<br>END WHILE;<br>RETURN return_str;<br>END $$ <br># å‡å¦‚è¦åˆ é™¤<br># drop function rand_string;<br></code></pre></td></tr></table></figure></li><li><p>éšæœºäº§ç”Ÿéƒ¨é—¨ç¼–å·</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER $$<br>CREATE FUNCTION rand_num( ) RETURNS INT(5)<br>BEGIN    <br>DECLARE i INT DEFAULT 0;<br>SET i &#x3D; FLOOR(100+RAND()*10);<br>RETURN i;<br>END $$  <br># å‡å¦‚è¦åˆ é™¤<br># drop function rand_num;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>åˆ›å»ºå­˜å‚¨è¿‡ç¨‹</p><ul><li><p>æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹(å¾€empè¡¨æ·»åŠ éšæœºæ•°æ®)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER $$<br>CREATE PROCEDURE insert_emp10000(IN START INT(10),IN max_num INT(10))<br>BEGIN  <br>DECLARE i INT DEFAULT 0;   #set autocommit &#x3D;0 æŠŠautocommitè®¾ç½®æˆ0  ï¼›æé«˜æ‰§è¡Œæ•ˆç‡ <br>SET autocommit &#x3D; 0;     <br>REPEAT  ##é‡å¤ <br>SET i &#x3D; i + 1;   <br>INSERT INTO emp10000 (empno, ename ,job ,mgr ,hiredate ,sal ,comm ,deptno ) VALUES ((START+i) ,rand_string(6),&#39;SALESMAN&#39;,0001,CURDATE(),FLOOR(1+RAND()*20000),FLOOR(1+RAND()*1000),rand_num());   <br>UNTIL i &#x3D; max_num   ##ç›´åˆ°  ä¸Šé¢ä¹Ÿæ˜¯ä¸€ä¸ªå¾ªç¯<br>END REPEAT;  ##æ»¡è¶³æ¡ä»¶åç»“æŸå¾ªç¯ <br>COMMIT;   ##æ‰§è¡Œå®Œæˆåä¸€èµ·æäº¤ <br>END $$ <br># åˆ é™¤<br># DELIMITER ;<br># drop PROCEDURE insert_emp; <br></code></pre></td></tr></table></figure></li><li><p>æ’å…¥æ•°æ®çš„å­˜å‚¨è¿‡ç¨‹(å¾€deptè¡¨æ·»åŠ éšæœºæ•°æ®)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€deptè¡¨æ·»åŠ éšæœºæ•°æ®<br>DELIMITER $$<br>CREATE PROCEDURE insert_dept(IN START INT(10),IN max_num INT(10))<br>BEGIN  <br>DECLARE i INT DEFAULT 0;<br>SET autocommit &#x3D; 0;     <br>REPEAT   <br>SET i &#x3D; i + 1;   <br>INSERT INTO dept (deptno ,dname,loc ) VALUES (START +i ,rand_string(10),rand_string(8));   <br>UNTIL i &#x3D; max_num   <br>END REPEAT;   <br>COMMIT;   <br>END $$  <br>#åˆ é™¤<br># DELIMITER ; #å°† ç»“æŸæ ‡å¿—æ¢å› ;<br># drop PROCEDURE insert_dept;<br></code></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>è°ƒç”¨å­˜å‚¨è¿‡ç¨‹</p><ul><li><p>dept</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DELIMITER ; #å°† ç»“æŸæ ‡å¿—æ¢å› ;<br>CALL insert_dept(100,10); <br></code></pre></td></tr></table></figure></li><li><p>emp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼Œå¾€empè¡¨æ·»åŠ 50ä¸‡æ¡æ•°æ®<br>DELIMITER ;    #å°† ç»“æŸæ ‡å¿—æ¢å› ;<br>CALL insert_emp(100001,500000);  <br>CALL insert_emp10000(100001,10000);    <br></code></pre></td></tr></table></figure></li></ul></li></ul><h3 id="3-3-Show-Profile"><a href="#3-3-Show-Profile" class="headerlink" title="3.3 Show Profile"></a>3.3 Show Profile</h3><h4 id="3-3-1-ä»‹ç»"><a href="#3-3-1-ä»‹ç»" class="headerlink" title="3.3.1 ä»‹ç»"></a>3.3.1 ä»‹ç»</h4><blockquote><p>æ˜¯ä»€ä¹ˆï¼šæ˜¯mysqlæä¾›å¯ä»¥ç”¨æ¥åˆ†æå½“å‰ä¼šè¯ä¸­è¯­å¥æ‰§è¡Œçš„èµ„æºæ¶ˆè€—æƒ…å†µã€‚å¯ä»¥ç”¨äºSQLçš„è°ƒä¼˜çš„æµ‹é‡</p></blockquote><h4 id="3-3-2-å®˜ç½‘ä»‹ç»"><a href="#3-3-2-å®˜ç½‘ä»‹ç»" class="headerlink" title="3.3.2 å®˜ç½‘ä»‹ç»"></a>3.3.2 å®˜ç½‘ä»‹ç»</h4><p>å®˜ç½‘ï¼š<a href="http://dev.mysql.com/doc/refman/5.5/en/show-profile.html">http://dev.mysql.com/doc/refman/5.5/en/show-profile.html</a></p><h4 id="3-3-3-é»˜è®¤è®¾ç½®"><a href="#3-3-3-é»˜è®¤è®¾ç½®" class="headerlink" title="3.3.3 é»˜è®¤è®¾ç½®"></a>3.3.3 é»˜è®¤è®¾ç½®</h4><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°å¤„äºå…³é—­çŠ¶æ€ï¼Œå¹¶ä¿å­˜æœ€è¿‘15æ¬¡çš„è¿è¡Œç»“æœ</p></blockquote><h4 id="3-3-4-åˆ†ææ­¥éª¤"><a href="#3-3-4-åˆ†ææ­¥éª¤" class="headerlink" title="3.3.4 åˆ†ææ­¥éª¤"></a>3.3.4 åˆ†ææ­¥éª¤</h4><ul><li><p>çœ‹çœ‹å½“å‰çš„mysqlç‰ˆæœ¬æ˜¯å¦æ”¯æŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">Show variables like &#39;profiling&#39;; #  é»˜è®¤æ˜¯å…³é—­ï¼Œä½¿ç”¨å‰éœ€è¦å¼€å¯    <br>set profiling&#x3D;1;  #  å¼€å¯<br></code></pre></td></tr></table></figure></li><li><p>è¿è¡ŒSQL</p></li><li><p>æŸ¥çœ‹ç»“æœï¼Œshow profilesï¼›</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles.png"></p></li><li><p>è¯Šæ–­SQLï¼Œshow profile cpu,block io for query  n  (nä¸ºä¸Šä¸€æ­¥å‰é¢çš„é—®é¢˜SQLæ•°å­—å·ç );</p><ul><li><p>æŸ¥è¯¢å‘½ä»¤çš„å‚æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles%E8%AF%8A%E6%96%AD2.png"></p></li><li><p>æŸ¥è¯¢ç»“æœ</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_39_showprofiles%E8%AF%8A%E6%96%AD.png"></p></li></ul></li></ul><ul><li><p>æ—¥å¸¸å¼€å‘éœ€è¦æ³¨æ„çš„ç»“è®º</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_40_showprofiles%E8%AF%8A%E6%96%AD%E6%B3%A8%E6%84%8F%E7%9A%84%E7%BB%93%E8%AE%BA.png"></p><ul><li><p>åˆ›å»ºä¸´æ—¶è¡¨çš„æ€§èƒ½è€—è´¹ç¤ºä¾‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_40_showprofiles%E8%AF%8A%E6%96%AD%E6%B3%A8%E6%84%8F%E7%9A%84%E7%BB%93%E8%AE%BA2.png"></p></li></ul></li></ul><h3 id="3-4-å…¨å±€æŸ¥è¯¢æ—¥å¿—"><a href="#3-4-å…¨å±€æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="3.4 å…¨å±€æŸ¥è¯¢æ—¥å¿—"></a>3.4 å…¨å±€æŸ¥è¯¢æ—¥å¿—</h3><h4 id="3-4-1-é…ç½®å¯ç”¨"><a href="#3-4-1-é…ç½®å¯ç”¨" class="headerlink" title="3.4.1 é…ç½®å¯ç”¨"></a>3.4.1 é…ç½®å¯ç”¨</h4><p>åœ¨mysqlçš„my.cnfä¸­ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># å¼€å¯</span><br><span class="hljs-attr">general_log</span>=<span class="hljs-number">1</span>  <br><span class="hljs-comment"># è®°å½•æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„</span><br><span class="hljs-attr">general_log_file</span>=/path/logfile<br><span class="hljs-comment"># è¾“å‡ºæ ¼å¼</span><br><span class="hljs-attr">log_output</span>=FILE<br></code></pre></td></tr></table></figure><h4 id="3-4-2-ç¼–ç å¯ç”¨"><a href="#3-4-2-ç¼–ç å¯ç”¨" class="headerlink" title="3.4.2 ç¼–ç å¯ç”¨"></a>3.4.2 ç¼–ç å¯ç”¨</h4><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_41_%E5%85%A8%E5%B1%80%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E7%BC%96%E7%A0%81%E5%90%AF%E7%94%A8.png"></p><blockquote><p><font color=#FF0000><strong>ç‰¹åˆ«çš„ï¼šå°½é‡ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒå¼€å¯è¿™ä¸ªåŠŸèƒ½</strong></font></p></blockquote><h2 id="4-MySQLé”æœºåˆ¶"><a href="#4-MySQLé”æœºåˆ¶" class="headerlink" title="4. MySQLé”æœºåˆ¶"></a>4. MySQLé”æœºåˆ¶</h2><h3 id="4-1-æ¦‚è¿°"><a href="#4-1-æ¦‚è¿°" class="headerlink" title="4.1 æ¦‚è¿°"></a>4.1 æ¦‚è¿°</h3><blockquote><p>é”æ˜¯è®¡ç®—æœºåè°ƒå¤šä¸ªè¿›ç¨‹æˆ–çº¿ç¨‹å¹¶å‘è®¿é—®æŸä¸€èµ„æºçš„æœºåˆ¶ã€‚ åœ¨æ•°æ®åº“ä¸­ï¼Œé™¤ä¼ ç»Ÿçš„è®¡ç®—èµ„æºï¼ˆå¦‚CPUã€RAMã€I/Oç­‰ï¼‰çš„äº‰ç”¨ä»¥å¤–ï¼Œæ•°æ®ä¹Ÿæ˜¯ä¸€ç§ä¾›è®¸å¤šç”¨æˆ·å…±äº«çš„èµ„æºã€‚å¦‚ä½•ä¿è¯æ•°æ®å¹¶å‘è®¿é—®çš„ä¸€è‡´æ€§ã€æœ‰æ•ˆæ€§æ˜¯æ‰€æœ‰æ•°æ®åº“å¿…é¡»è§£å†³çš„ä¸€ä¸ªé—®é¢˜ï¼Œé”å†²çªä¹Ÿæ˜¯å½±å“æ•°æ®åº“å¹¶å‘è®¿é—®æ€§èƒ½çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œé”å¯¹æ•°æ®åº“è€Œè¨€æ˜¾å¾—å°¤å…¶é‡è¦ï¼Œä¹Ÿæ›´åŠ å¤æ‚ã€‚</p></blockquote><h3 id="4-2-é”çš„åˆ†ç±»"><a href="#4-2-é”çš„åˆ†ç±»" class="headerlink" title="4.2 é”çš„åˆ†ç±»"></a>4.2 é”çš„åˆ†ç±»</h3><h4 id="4-2-1-ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»-å†™ï¼‰åˆ†"><a href="#4-2-1-ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»-å†™ï¼‰åˆ†" class="headerlink" title="4.2.1 ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»\å†™ï¼‰åˆ†"></a>4.2.1 ä»å¯¹æ•°æ®æ“ä½œçš„ç±»å‹ï¼ˆè¯»\å†™ï¼‰åˆ†</h4><ul><li>è¯»é”(å…±äº«é”)ï¼šé’ˆå¯¹åŒä¸€ä»½æ•°æ®ï¼Œå¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œè€Œä¸ä¼šäº’ç›¸å½±å“ã€‚</li><li>å†™é”(æ’å®ƒé”)ï¼šå½“å‰å†™æ“ä½œæ²¡æœ‰å®Œæˆå‰ï¼Œå®ƒä¼šé˜»æ–­å…¶ä»–å†™é”å’Œè¯»é”ã€‚</li></ul><h4 id="4-2-2-ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†"><a href="#4-2-2-ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†" class="headerlink" title="4.2.2 ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†"></a>4.2.2 ä»å¯¹æ•°æ®æ“ä½œçš„ç²’åº¦åˆ†</h4><ul><li>è¡¨é”</li><li>è¡Œé”</li></ul><h3 id="4-3-ä¸‰é”"><a href="#4-3-ä¸‰é”" class="headerlink" title="4.3 ä¸‰é”"></a>4.3 ä¸‰é”</h3><h4 id="4-3-1-è¡¨é”ï¼ˆåè¯»ï¼‰"><a href="#4-3-1-è¡¨é”ï¼ˆåè¯»ï¼‰" class="headerlink" title="4.3.1 è¡¨é”ï¼ˆåè¯»ï¼‰"></a>4.3.1 è¡¨é”ï¼ˆåè¯»ï¼‰</h4><blockquote><p>ç‰¹ç‚¹ï¼šåå‘MyISAMå­˜å‚¨å¼•æ“ï¼Œå¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›æ— æ­»é”ï¼›é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜,å¹¶å‘åº¦æœ€ä½ã€‚</p></blockquote><ul><li><p>æ‰‹åŠ¨åŠ è¯»å†™é”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">lock tabel è¡¨å read(write), è¡¨å2 read(write), ...;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹è¡¨ä¸ŠåŠ è¿‡çš„é”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show open tables;<br></code></pre></td></tr></table></figure></li><li><p>é‡Šæ”¾è¡¨é”</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">unlock tables;<br></code></pre></td></tr></table></figure></li><li><p>æ€»ç»“</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_42_%E8%A1%A8%E9%94%81.png"></p><p>è¡¥å……ï¼šåŠ è¯»é”çš„sessionä¹Ÿä¸èƒ½ä¿®æ”¹åŠ è¯»é”çš„è¡¨ã€‚</p><p><font color=#FF0000><strong>ç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯è¯»é”ä¼šé˜»å¡å†™ï¼Œä½†æ˜¯ä¸ä¼šå µå¡è¯»ã€‚è€Œå†™é”åˆ™ä¼šæŠŠè¯»å’Œå†™éƒ½å µå¡</strong></font></p></li><li><p>å¦‚ä½•åˆ†æè¡¨é”å®š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_43_%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E8%A1%A8%E9%94%81%E5%AE%9A.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_43_%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E8%A1%A8%E9%94%81%E5%AE%9A2.png"></p></li></ul><h4 id="4-3-2-è¡Œé”ï¼ˆåå†™ï¼‰"><a href="#4-3-2-è¡Œé”ï¼ˆåå†™ï¼‰" class="headerlink" title="4.3.2 è¡Œé”ï¼ˆåå†™ï¼‰"></a>4.3.2 è¡Œé”ï¼ˆåå†™ï¼‰</h4><blockquote><p>ç‰¹ç‚¹ï¼š</p><ol><li>åå‘InnoDBå­˜å‚¨å¼•æ“ï¼Œå¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šå‡ºç°æ­»é”ï¼›é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½,å¹¶å‘åº¦ä¹Ÿæœ€é«˜ã€‚</li><li>InnoDBä¸MyISAMçš„æœ€å¤§ä¸åŒæœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯æ”¯æŒäº‹åŠ¡ï¼ˆTRANSACTIONï¼‰ï¼›äºŒæ˜¯é‡‡ç”¨äº†è¡Œçº§é”</li></ol></blockquote><ul><li><p>è¡Œé”æ”¯æŒäº‹åŠ¡ï¼Œ<a href="http://lihengxu.cn/2021/03/08/MySQL%E5%9F%BA%E7%A1%80/#5-TCL%E8%AF%AD%E8%A8%80">å¤ä¹ åˆçº§éƒ¨åˆ†çŸ¥è¯†â­</a></p><ul><li><p>é‡ç‚¹:äº‹åŠ¡ç‰¹æ€§ã€å¹¶å‘äº‹åŠ¡å¯¼è‡´çš„é—®é¢˜ã€äº‹åŠ¡éš”ç¦»çº§åˆ«ç­‰</p></li><li><p>è¡¥å……ï¼šå¹¶å‘äº‹åŠ¡å¯¼è‡´çš„é—®é¢˜ï¼ˆæ›´æ–°ä¸¢å¤±ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_44_%E6%9B%B4%E6%96%B0%E4%B8%A2%E5%A4%B1.png"></p></li></ul></li></ul><ul><li><p><font color=#FF0000><strong>æ— ç´¢å¼•(æˆ–è€…ç´¢å¼•å¤±æ•ˆ)è¡Œé”å‡çº§ä¸ºè¡¨é”</strong></font></p></li><li><p>é—´éš™é”çš„å±å®³</p><ul><li><p><strong>é—´éš™é”</strong>: </p><p>å½“æˆ‘ä»¬ç”¨èŒƒå›´æ¡ä»¶è€Œä¸æ˜¯ç›¸ç­‰æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œå¹¶è¯·æ±‚å…±äº«æˆ–æ’ä»–é”æ—¶ï¼ŒInnoDBä¼šç»™ç¬¦åˆæ¡ä»¶çš„å·²æœ‰æ•°æ®è®°å½•çš„ç´¢å¼•é¡¹åŠ é”ï¼›å¯¹äºé”®å€¼åœ¨æ¡ä»¶èŒƒå›´å†…ä½†å¹¶ä¸å­˜åœ¨çš„è®°å½•ï¼Œå«åšâ€œé—´éš™ï¼ˆGAP)â€ï¼ŒInnoDBä¹Ÿä¼šå¯¹è¿™ä¸ªâ€œé—´éš™â€åŠ é”ï¼Œè¿™ç§é”æœºåˆ¶å°±æ˜¯æ‰€è°“çš„é—´éš™é”ï¼ˆGAP Lockï¼‰ã€‚ </p></li><li><p><strong>å±å®³</strong>:</p><p>å› ä¸ºQueryæ‰§è¡Œè¿‡ç¨‹ä¸­é€šè¿‡è¿‡èŒƒå›´æŸ¥æ‰¾çš„è¯ï¼Œä»–ä¼šé”å®šæ•´ä¸ªèŒƒå›´å†…æ‰€æœ‰çš„ç´¢å¼•é”®å€¼ï¼Œå³ä½¿è¿™ä¸ªé”®å€¼å¹¶ä¸å­˜åœ¨ã€‚é—´éš™é”æœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„å¼±ç‚¹ï¼Œå°±æ˜¯å½“é”å®šä¸€ä¸ªèŒƒå›´é”®å€¼ä¹‹åï¼Œå³ä½¿æŸäº›ä¸å­˜åœ¨çš„é”®å€¼ä¹Ÿä¼šè¢«æ— è¾œçš„é”å®šï¼Œè€Œé€ æˆåœ¨é”å®šçš„æ—¶å€™æ— æ³•æ’å…¥é”å®šé”®å€¼èŒƒå›´å†…çš„ä»»ä½•æ•°æ®ã€‚åœ¨æŸäº›åœºæ™¯ä¸‹è¿™å¯èƒ½ä¼šå¯¹æ€§èƒ½é€ æˆå¾ˆå¤§çš„å±å®³</p></li></ul></li><li><p><font color=#FF0000><strong>[é¢è¯•é¢˜] å¸¸è€ƒå¦‚ä½•é”å®šä¸€è¡Œ</strong></font></p><p>äº‹åŠ¡æ˜¾ç¤ºåŠ é”<sup id="fnref:9" class="footnote-ref"><a href="#fn:9" rel="footnote"><span class="hint--top hint--rounded" aria-label="https://blog.csdn.net/qq_33033819/article/details/106445880">[9]</span></a></sup></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql">##åœ¨ MySQL 5.7 ä¸­<br>å…±äº«é”ï¼ˆSï¼‰ï¼šSELECT * FROM table_name WHERE ... LOCK IN SHARE MODE<br>æ’ä»–é”ï¼ˆXï¼‰ï¼šSELECT * FROM table_name WHERE ... FOR UPDATE<br><br>##åœ¨ MySQL 8.0 ä¸­<br>å…±äº«é”ï¼ˆSï¼‰ï¼šSELECT * FROM table_name WHERE ... FOR SHARE<br>æ’ä»–é”ï¼ˆXï¼‰ï¼šSELECT * FROM table_name WHERE ... FOR UPDATE[NOWAIT|SKIP LOCKED]<br>--NOWAIT:å‘ç°æœ‰é”ç­‰å¾…åä¼šç«‹å³è¿”å›é”™è¯¯ï¼Œä¸ç”¨ç­‰å¾…é”è¶…æ—¶åæŠ¥é”™ã€‚<br>--SKIP LOCKED:è·³è¿‡è¢«é”å®šçš„è¡Œï¼Œç›´æ¥æ›´æ–°å…¶ä»–è¡Œï¼Œä½†æ˜¯è¿™æ ·è¦æ³¨æ„æ˜¯å¦ä¼šé€ æˆæ›´æ–°ç»“æœä¸ç¬¦åˆé¢„æœŸã€‚<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_45_%E9%9D%A2%E8%AF%95%E9%A2%98.png"></p></li></ul><ul><li><p>Innodbå­˜å‚¨å¼•æ“ç”±äºå®ç°äº†è¡Œçº§é”å®šï¼Œè™½ç„¶åœ¨é”å®šæœºåˆ¶çš„å®ç°æ–¹é¢æ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—å¯èƒ½æ¯”è¡¨çº§é”å®šä¼šè¦æ›´é«˜ä¸€äº›ï¼Œä½†æ˜¯åœ¨æ•´ä½“å¹¶å‘å¤„ç†èƒ½åŠ›æ–¹é¢è¦è¿œè¿œä¼˜äºMyISAMçš„è¡¨çº§é”å®šçš„ã€‚å½“ç³»ç»Ÿå¹¶å‘é‡è¾ƒé«˜çš„æ—¶å€™ï¼ŒInnodbçš„æ•´ä½“æ€§èƒ½å’ŒMyISAMç›¸æ¯”å°±ä¼šæœ‰æ¯”è¾ƒæ˜æ˜¾çš„ä¼˜åŠ¿äº†ã€‚ </p></li><li><p>ä½†æ˜¯ï¼ŒInnodbçš„è¡Œçº§é”å®šåŒæ ·ä¹Ÿæœ‰å…¶è„†å¼±çš„ä¸€é¢ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸å½“çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šè®©Innodbçš„æ•´ä½“æ€§èƒ½è¡¨ç°ä¸ä»…ä¸èƒ½æ¯”MyISAMé«˜ï¼Œç”šè‡³å¯èƒ½ä¼šæ›´å·®ã€‚</p></li><li><p>å¦‚ä½•åˆ†æè¡Œé”å®š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_47_%E8%A1%8C%E9%94%81%E5%AE%9A%E5%88%86%E6%9E%903.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_47_%E8%A1%8C%E9%94%81%E5%AE%9A%E5%88%86%E6%9E%902.png"></p></li></ul><ul><li>ä¼˜åŒ–å»ºè®®ï¼š<ul><li>å°½å¯èƒ½è®©æ‰€æœ‰æ•°æ®æ£€ç´¢éƒ½é€šè¿‡ç´¢å¼•æ¥å®Œæˆï¼Œé¿å…æ— ç´¢å¼•è¡Œé”å‡çº§ä¸ºè¡¨é”</li><li>å°½å¯èƒ½è¾ƒå°‘æ£€ç´¢æ¡ä»¶ï¼Œé¿å…é—´éš™é”</li><li>å°½é‡æ§åˆ¶äº‹åŠ¡å¤§å°ï¼Œå‡å°‘é”å®šèµ„æºé‡å’Œæ—¶é—´é•¿åº¦</li><li>é”ä½æŸè¡Œåï¼Œå°½é‡ä¸è¦å»è°ƒåˆ«çš„è¡Œæˆ–è¡¨ï¼Œèµ¶ç´§å¤„ç†è¢«é”ä½çš„è¡Œç„¶åé‡Šæ”¾æ‰é”</li><li>æ¶‰åŠç›¸åŒè¡¨çš„äº‹åŠ¡ï¼Œå¯¹äºè°ƒç”¨è¡¨çš„é¡ºåºå°½é‡ä¿æŒä¸€è‡´</li><li>åœ¨ä¸šåŠ¡ç¯å¢ƒå…è®¸çš„æƒ…å†µä¸‹,å°½å¯èƒ½ä½çº§åˆ«äº‹åŠ¡éš”ç¦»</li></ul></li></ul><h4 id="4-3-2-é¡µé”ï¼ˆäº†è§£ï¼‰"><a href="#4-3-2-é¡µé”ï¼ˆäº†è§£ï¼‰" class="headerlink" title="4.3.2 é¡µé”ï¼ˆäº†è§£ï¼‰"></a>4.3.2 é¡µé”ï¼ˆäº†è§£ï¼‰</h4><blockquote><p>å¼€é”€å’ŒåŠ é”æ—¶é—´ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼›</p><p>ä¼šå‡ºç°æ­»é”ï¼›</p><p>é”å®šç²’åº¦ç•Œäºè¡¨é”å’Œè¡Œé”ä¹‹é—´ï¼Œå¹¶å‘åº¦ä¸€èˆ¬ã€‚</p></blockquote><h2 id="5-ä¸»ä»å¤åˆ¶â­"><a href="#5-ä¸»ä»å¤åˆ¶â­" class="headerlink" title="5. ä¸»ä»å¤åˆ¶â­"></a>5. ä¸»ä»å¤åˆ¶â­</h2><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_48_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6.png"></p><h3 id="5-1-å¤åˆ¶çš„åŸºæœ¬åŸç†"><a href="#5-1-å¤åˆ¶çš„åŸºæœ¬åŸç†" class="headerlink" title="5.1 å¤åˆ¶çš„åŸºæœ¬åŸç†"></a>5.1 å¤åˆ¶çš„åŸºæœ¬åŸç†</h3><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E9%AB%98%E7%BA%A7_49_%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86.png"></p><h3 id="5-2-å¤åˆ¶çš„åŸºæœ¬åŸåˆ™"><a href="#5-2-å¤åˆ¶çš„åŸºæœ¬åŸåˆ™" class="headerlink" title="5.2 å¤åˆ¶çš„åŸºæœ¬åŸåˆ™"></a>5.2 å¤åˆ¶çš„åŸºæœ¬åŸåˆ™</h3><ul><li>æ¯ä¸ªslaveåªæœ‰ä¸€ä¸ªmaster</li><li>æ¯ä¸ªslaveåªèƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æœåŠ¡å™¨ID</li><li>æ¯ä¸ªmasterå¯ä»¥æœ‰å¤šä¸ªsalve</li></ul><h3 id="5-3-å¤åˆ¶çš„æœ€å¤§é—®é¢˜"><a href="#5-3-å¤åˆ¶çš„æœ€å¤§é—®é¢˜" class="headerlink" title="5.3 å¤åˆ¶çš„æœ€å¤§é—®é¢˜"></a>5.3 å¤åˆ¶çš„æœ€å¤§é—®é¢˜</h3><blockquote><p>å»¶æ—¶</p></blockquote><h3 id="5-4-ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®"><a href="#5-4-ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®" class="headerlink" title="5.4 ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®"></a>5.4 ä¸€ä¸»ä¸€ä»å¸¸è§é…ç½®</h3><ul><li><p>mysqlç‰ˆæœ¬ä¸€è‡´ä¸”åå°ä»¥æœåŠ¡è¿è¡Œ</p></li><li><p>ä¸»ä»éƒ½é…ç½®åœ¨[mysqld]ç»“ç‚¹ä¸‹ï¼Œéƒ½æ˜¯å°å†™</p></li><li><p>ä¸»æœºä¿®æ”¹my.inié…ç½®æ–‡ä»¶</p><ul><li>[å¿…é¡»]ä¸»æœåŠ¡å™¨å”¯ä¸€ID<ul><li>server-id=1</li></ul></li></ul></li><li><p>[å¿…é¡»]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</p><ul><li><p>log-bin=è‡ªå·±æœ¬åœ°çš„è·¯å¾„/data/mysqlbin</p><ul><li>log-bin=D:/devSoft/MySQLServer5.5/data/mysqlbin</li></ul></li><li><p>[å¯é€‰]å¯ç”¨é”™è¯¯æ—¥å¿—</p><ul><li>log-err=è‡ªå·±æœ¬åœ°çš„è·¯å¾„/data/mysqlerr</li></ul></li><li><p>log-err=D:/devSoft/MySQLServer5.5/data/mys</p></li><li><p>[å¯é€‰]æ ¹ç›®å½•</p></li><li><p>basedir=â€è‡ªå·±æœ¬åœ°è·¯å¾„â€</p><ul><li>basedir=â€D:/devSoft/MySQLServer5.5/â€œ</li></ul></li></ul></li><li><p>[å¯é€‰]ä¸´æ—¶ç›®å½•</p><ul><li><p>tmpdir=â€è‡ªå·±æœ¬åœ°è·¯å¾„â€</p></li><li><p>tmpdir=â€D:/devSoft/MySQLServer5.5/â€œ</p></li><li><p>[å¯é€‰]æ•°æ®ç›®å½•</p><ul><li>datadir=â€è‡ªå·±æœ¬åœ°è·¯å¾„/Data/â€œ</li><li>datadir=â€D:/devSoft/MySQLServer5.5/Data/â€œ</li></ul></li></ul></li><li><p>read-only=0 </p><ul><li><p>ä¸»æœºï¼Œè¯»å†™éƒ½å¯ä»¥</p></li><li><p>[å¯é€‰]è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“</p></li><li><p>binlog-ignore-db=mysql</p></li><li><p>[å¯é€‰]è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“</p><ul><li>binlog-do-db=éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—</li></ul></li></ul></li><li><p>ä»æœºä¿®æ”¹my.cnfé…ç½®æ–‡ä»¶</p><ul><li>[å¿…é¡»]ä»æœåŠ¡å™¨å”¯ä¸€ID</li><li>[å¯é€‰]å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—</li></ul></li><li><p>å› ä¿®æ”¹è¿‡é…ç½®æ–‡ä»¶ï¼Œè¯·ä¸»æœº+ä»æœºéƒ½é‡å¯åå°mysqlæœåŠ¡</p></li><li><p>ä¸»æœºä»æœºéƒ½å…³é—­é˜²ç«å¢™</p><ul><li>windowsæ‰‹åŠ¨å…³é—­</li><li>å…³é—­è™šæ‹Ÿæœºlinuxé˜²ç«å¢™    service iptables stop</li></ul></li><li><p>åœ¨Windowsä¸»æœºä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒslave</p><ul><li><p>åœ¨ä¸»æœºmysqlä¸­æ‰§è¡Œæˆæƒå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.æˆæƒ<br>GRANT REPLICATION SLAVE ON *.* TO &#39;zhangsan&#39;@&#39;ä»æœºå™¨æ•°æ®åº“IP&#39; IDENTIFIED BY &#39;123456&#39;;<br># 2.æ‰§è¡Œç»“æŸååˆ·æ–°<br>flush privileges;<br># 3.æŸ¥è¯¢ä¸»æœºçŠ¶æ€<br>show master status;<br># 4.è®°å½•ä¸‹Fileå’ŒPositionçš„å€¼<br># 5.æ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨MYSQLï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–<br></code></pre></td></tr></table></figure></li></ul></li><li><p>åœ¨Linuxä»æœºä¸Šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº</p><ul><li><p>åœ¨ä»æœºmysqlä¸­æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CHANGE MASTER TO MASTER_HOST&#x3D;&#39;ä¸»æœºIP&#39;,<br>MASTER_USER&#x3D;&#39;zhangsan&#39;,<br>MASTER_PASSWORD&#x3D;&#39;123456&#39;,<br>MASTER_LOG_FILE&#x3D;&#39;Fileåå­—&#39;,MASTER_LOG_POS&#x3D;Positionæ•°å­—;<br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">start slave;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ä»æœºçŠ¶æ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">show slave status\G<br></code></pre></td></tr></table></figure><p>ä¸‹é¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸ!</p><p>Slave_IO_Running: Yes</p><p>Slave_SQL_Running: Yes</p></li></ul></li></ul><ul><li><p>ä¸»æœºæ–°å»ºåº“ã€æ–°å»ºè¡¨ã€insertè®°å½•ï¼Œä»æœºå¤åˆ¶</p></li><li><p>å¦‚ä½•åœæ­¢ä»æœåŠ¡å¤åˆ¶åŠŸèƒ½</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">stop slave;<br></code></pre></td></tr></table></figure><p>æ³¨æ„åœæ­¢åï¼Œé‡æ–°æˆæƒéœ€è¦é‡æ–°æŸ¥çœ‹ä¸»æœºçŠ¶æ€ï¼Œè®°å½•ä¸‹Fileå’ŒPositionçš„å€¼</p></li></ul><h2 id="å‚è€ƒèµ„æ–™ï¼š"><a href="#å‚è€ƒèµ„æ–™ï¼š" class="headerlink" title="å‚è€ƒèµ„æ–™ï¼š"></a>å‚è€ƒèµ„æ–™ï¼š</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span><a href="http://blog.codinglabs.org/articles/theory-of-mysql-index.html">http://blog.codinglabs.org/articles/theory-of-mysql-index.html</a><a href="#fnref:1" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><a href="https://www.bilibili.com/video/BV12b411K7Zu?p=179">https://www.bilibili.com/video/BV12b411K7Zu?p=179</a><a href="#fnref:2" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><a href="https://blog.csdn.net/feichitianxia/article/details/107997795">https://blog.csdn.net/feichitianxia/article/details/107997795</a><a href="#fnref:3" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:4" class="footnote-text"><span>Baron Scbwartzç­‰ è‘—ï¼Œç‹å°ä¸œç­‰ è¯‘ï¼›é«˜æ€§èƒ½MySQLï¼ˆHigh Performance MySQLï¼‰ï¼›ç”µå­å·¥ä¸šå‡ºç‰ˆç¤¾ï¼Œ2010<a href="#fnref:4" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:5" class="footnote-text"><span>Michael Kofler è‘—ï¼Œæ¨æ™“äº‘ç­‰ è¯‘ï¼›MySQL5æƒå¨æŒ‡å—ï¼ˆThe Definitive Guide to MySQL5ï¼‰ï¼›äººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾ï¼Œ2006<a href="#fnref:5" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:6" class="footnote-text"><span>D Comer, Ubiquitous B-tree; ACM Computing Surveys (CSUR), 1979<a href="#fnref:6" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:7" class="footnote-text"><span>Codd, E. F. (1970). â€œA relational model of data for large shared data banksâ€. Communications of the ACM, , Vol. 13, No. 6, pp. 377-387<a href="#fnref:7" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:8" class="footnote-text"><span>MySQL5.1å‚è€ƒæ‰‹å†Œ - <a href="http://dev.mysql.com/doc/refman/5.1/zh/index.html">http://dev.mysql.com/doc/refman/5.1/zh/index.html</a><a href="#fnref:8" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:9" class="footnote-text"><span><a href="https://blog.csdn.net/qq_33033819/article/details/106445880">https://blog.csdn.net/qq_33033819/article/details/106445880</a><a href="#fnref:9" rev="footnote" class="footnote-backref"> â†©</a></span></span></li><li><span id="fn:10" class="footnote-text"><span>ã€Šæ•°æ®åº“åŸç†ã€‹<a href="#fnref:10" rev="footnote" class="footnote-backref"> â†©</a></span></span></li></ol></div></section>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JDBC</title>
    <link href="/2021/03/12/MySQL_JDBC/"/>
    <url>/2021/03/12/MySQL_JDBC/</url>
    
    <content type="html"><![CDATA[<h1 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h1><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>åœ¨Javaä¸­ï¼Œæ•°æ®åº“å­˜å–æŠ€æœ¯å¯åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š</p><ul><li><p><strong>JDBC</strong>ç›´æ¥è®¿é—®æ•°æ®åº“</p></li><li><p><strong>JDO</strong>æŠ€æœ¯ï¼ˆJava Data Objectï¼‰</p></li><li><p>ç¬¬ä¸‰æ–¹O/Rå·¥å…·ï¼Œå¦‚Hibernate, Mybatis ç­‰</p></li></ul><p><strong>JDBC</strong>æ˜¯javaè®¿é—®æ•°æ®åº“çš„åŸºçŸ³ï¼ŒJDO, Hibernateç­‰åªæ˜¯æ›´å¥½çš„å°è£…äº†JDBCã€‚</p><h3 id="1-1-JDBCä»‹ç»"><a href="#1-1-JDBCä»‹ç»" class="headerlink" title="1.1 JDBCä»‹ç»"></a>1.1 JDBCä»‹ç»</h3><blockquote><p> JDBC(Java Database Connectivity)æ˜¯ä¸€ä¸ª<strong>ç‹¬ç«‹äºç‰¹å®šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼ˆDBMSï¼‰ã€é€šç”¨çš„SQLæ•°æ®åº“å­˜å–å’Œæ“ä½œçš„å…¬å…±æ¥å£</strong>ï¼ˆä¸€ç»„APIï¼‰ï¼Œå®šä¹‰äº†ç”¨æ¥è®¿é—®æ•°æ®åº“çš„æ ‡å‡†Javaç±»åº“ï¼Œä½¿ç”¨è¿™ä¸ªç±»åº“å¯ä»¥ä»¥ä¸€ç§æ ‡å‡†çš„æ–¹æ³•ã€æ–¹ä¾¿åœ°è®¿é—®æ•°æ®åº“èµ„æº</p></blockquote><p><strong>ä½œç”¨</strong>ï¼š</p><ul><li><p>JDBCä¸ºè®¿é—®ä¸åŒçš„æ•°æ®åº“æä¾›äº†ä¸€ç§<strong>ç»Ÿä¸€çš„é€”å¾„</strong>ï¼Œä¸ºå¼€å‘è€…å±è”½äº†ä¸€äº›ç»†èŠ‚é—®é¢˜ã€‚</p></li><li><p>JDBCçš„ç›®æ ‡æ˜¯ä½¿Javaç¨‹åºå‘˜ä½¿ç”¨JDBCå¯ä»¥è¿æ¥ä»»ä½•<strong>æä¾›äº†JDBCé©±åŠ¨ç¨‹åº</strong>çš„æ•°æ®åº“ç³»ç»Ÿï¼Œè¿™æ ·å°±ä½¿å¾—ç¨‹åºå‘˜æ— éœ€å¯¹ç‰¹å®šçš„æ•°æ®åº“ç³»ç»Ÿçš„ç‰¹ç‚¹æœ‰è¿‡å¤šçš„äº†è§£ï¼Œä»è€Œå¤§å¤§ç®€åŒ–å’ŒåŠ å¿«äº†å¼€å‘è¿‡ç¨‹ã€‚</p></li></ul><p>å¦‚æœæ²¡æœ‰JDBCï¼Œé‚£ä¹ˆJavaç¨‹åºè®¿é—®æ•°æ®åº“æ—¶æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JDBC_1.png"></p><p>è€Œé€šè¿‡JDBCå¯ä»¥å¦‚ä¸‹è®¿é—®ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JDBC_2.png"></p><blockquote><p>æ€»ç»“ï¼š</p><p>JDBCæ˜¯SUNå…¬å¸æä¾›ä¸€å¥—ç”¨äºæ•°æ®åº“æ“ä½œçš„æ¥å£APIï¼ŒJavaç¨‹åºå‘˜åªéœ€è¦é¢å‘è¿™å¥—æ¥å£ç¼–ç¨‹å³å¯ã€‚ä¸åŒçš„æ•°æ®åº“å‚å•†ï¼Œéœ€è¦é’ˆå¯¹è¿™å¥—æ¥å£ï¼Œæä¾›ä¸åŒå®ç°ã€‚ä¸åŒçš„å®ç°çš„é›†åˆï¼Œå³ä¸ºä¸åŒæ•°æ®åº“çš„é©±åŠ¨ã€‚</p></blockquote><h3 id="1-2-JDBC-API"><a href="#1-2-JDBC-API" class="headerlink" title="1.2 JDBC API"></a>1.2 JDBC API</h3><p>JDBC APIæ˜¯ä¸€ç³»åˆ—çš„æ¥å£ï¼Œå®ƒç»Ÿä¸€å’Œè§„èŒƒäº†åº”ç”¨ç¨‹åºä¸æ•°æ®åº“çš„è¿æ¥ã€æ‰§è¡ŒSQLè¯­å¥ï¼Œå¹¶åˆ°å¾—åˆ°è¿”å›ç»“æœç­‰å„ç±»æ“ä½œã€‚å£°æ˜åœ¨java.sqlä¸javax.sqlåŒ…ä¸­</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JDBC_3.png"></p><h3 id="1-3-JDBCç¨‹åºç¼–å†™æ­¥éª¤"><a href="#1-3-JDBCç¨‹åºç¼–å†™æ­¥éª¤" class="headerlink" title="1.3  JDBCç¨‹åºç¼–å†™æ­¥éª¤"></a>1.3  JDBCç¨‹åºç¼–å†™æ­¥éª¤</h3><ul><li>æ³¨å†Œé©±åŠ¨</li><li>è·å–è¿æ¥</li><li>æ‰§è¡Œå¢åˆ æ”¹æŸ¥</li><li>é‡Šæ”¾èµ„æº</li></ul><h2 id="2-å¿«é€Ÿä½¿ç”¨JDBC"><a href="#2-å¿«é€Ÿä½¿ç”¨JDBC" class="headerlink" title="2. å¿«é€Ÿä½¿ç”¨JDBC"></a>2. å¿«é€Ÿä½¿ç”¨JDBC</h2><h3 id="2-1-æ­¥éª¤"><a href="#2-1-æ­¥éª¤" class="headerlink" title="2.1 æ­¥éª¤"></a>2.1 æ­¥éª¤</h3><ol><li>å¯¼å…¥é©±åŠ¨jaråŒ… mysql-connector-java-5.1.37-bin.jar <a href="http://dev.mysql.com/downloads/">MySQLçš„é©±åŠ¨ä¸‹è½½åœ°å€</a></li><li>å¤åˆ¶mysql-connector-java-5.1.37-bin.jaråˆ°é¡¹ç›®çš„libsç›®å½•ä¸‹</li><li>å³é”®â€“&gt;Add As Library</li><li>æ³¨å†Œé©±åŠ¨</li><li>è·å–æ•°æ®åº“è¿æ¥å¯¹è±¡ Connection</li><li>å®šä¹‰sql</li><li>è·å–æ‰§è¡Œsqlè¯­å¥çš„å¯¹è±¡ Statement</li><li>æ‰§è¡Œsqlï¼Œæ¥å—è¿”å›ç»“æœ</li><li>å¤„ç†ç»“æœ</li><li>é‡Šæ”¾èµ„æº</li></ol><h3 id="2-2-ä»£ç "><a href="#2-2-ä»£ç " class="headerlink" title="2.2 ä»£ç "></a>2.2 ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * JDBCå¿«é€Ÿå…¥é—¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcDemo1</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br><br>        <span class="hljs-comment">//1. å¯¼å…¥é©±åŠ¨jaråŒ…</span><br>        <span class="hljs-comment">//2.æ³¨å†Œé©±åŠ¨</span><br>        <span class="hljs-comment">// Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</span><br>        <span class="hljs-comment">//3.è·å–æ•°æ®åº“è¿æ¥å¯¹è±¡</span><br>        <span class="hljs-comment">// Connection conn = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/db3&quot;, &quot;root&quot;, &quot;root&quot;);</span><br>        Connection conn = DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql:///db3&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>);<br>        <span class="hljs-comment">//4.å®šä¹‰sqlè¯­å¥</span><br>        <span class="hljs-comment">//String sql = &quot;update account set balance = 2000 where id = 1&quot;;</span><br>        String sql = <span class="hljs-string">&quot;update account set balance = 2000&quot;</span>;<br>        <span class="hljs-comment">//5.è·å–æ‰§è¡Œsqlçš„å¯¹è±¡ Statement</span><br>        Statement stmt = conn.createStatement();<br>        <span class="hljs-comment">//6.æ‰§è¡Œsql</span><br>        <span class="hljs-keyword">int</span> count = stmt.executeUpdate(sql);<br>        <span class="hljs-comment">//7.å¤„ç†ç»“æœ</span><br>        System.out.println(count);<br>        <span class="hljs-comment">//8.é‡Šæ”¾èµ„æº</span><br>        stmt.close();<br>        conn.close();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-3-è¯¦è§£å„ä¸ªå¯¹è±¡ï¼š"><a href="#2-3-è¯¦è§£å„ä¸ªå¯¹è±¡ï¼š" class="headerlink" title="2.3 è¯¦è§£å„ä¸ªå¯¹è±¡ï¼š"></a>2.3 è¯¦è§£å„ä¸ªå¯¹è±¡ï¼š</h3><h4 id="2-3-1-DriverManagerï¼šé©±åŠ¨ç®¡ç†å¯¹è±¡"><a href="#2-3-1-DriverManagerï¼šé©±åŠ¨ç®¡ç†å¯¹è±¡" class="headerlink" title="2.3.1 DriverManagerï¼šé©±åŠ¨ç®¡ç†å¯¹è±¡"></a>2.3.1 DriverManagerï¼šé©±åŠ¨ç®¡ç†å¯¹è±¡</h4><ul><li><p>åŠŸèƒ½</p><ul><li><p>æ³¨å†Œé©±åŠ¨ï¼šå‘Šè¯‰ç¨‹åºè¯¥ä½¿ç”¨å“ªä¸€ä¸ªæ•°æ®åº“é©±åŠ¨jar</p><p>static void registerDriver(Driver driver) :æ³¨å†Œä¸ç»™å®šçš„é©±åŠ¨ç¨‹åº DriverManager</p><p>å†™ä»£ç ä½¿ç”¨ï¼š  Class.forName(â€œcom.mysql.jdbc.Driverâ€); </p><p>é€šè¿‡åå°„ï¼ŒåŠ è½½ä¸æ³¨å†Œé©±åŠ¨ç±»ï¼Œ<strong>è§£è€¦åˆï¼ˆä¸ç›´æ¥ä¾èµ–ï¼‰</strong></p><p>é€šè¿‡æŸ¥çœ‹æºç å‘ç°ï¼šåœ¨com.mysql.jdbc.Driverç±»ä¸­å­˜åœ¨é™æ€ä»£ç å—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-keyword">static</span> &#123;<br>  <span class="hljs-keyword">try</span> &#123;<br>  java.sql.DriverManager.registerDriver(<span class="hljs-keyword">new</span> Driver());<br>  &#125; <span class="hljs-keyword">catch</span> (SQLException E) &#123;<br>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">&quot;Can&#x27;t register driver!&quot;</span>);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šmysql5ä¹‹åçš„é©±åŠ¨jaråŒ…å¯ä»¥çœç•¥æ³¨å†Œé©±åŠ¨çš„æ­¥éª¤</p></li><li><p>è·å–æ•°æ®åº“è¿æ¥ï¼š</p><ul><li><p>æ–¹æ³•ï¼šstatic Connection getConnection(String url, String user, String password)</p></li><li><p>å‚æ•°ï¼š</p><p><strong>JDBC URL</strong> ç”¨äºæ ‡è¯†ä¸€ä¸ªè¢«æ³¨å†Œçš„é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ç¨‹åºç®¡ç†å™¨é€šè¿‡è¿™ä¸ª URL é€‰æ‹©æ­£ç¡®çš„é©±åŠ¨ç¨‹åºï¼Œä»è€Œå»ºç«‹åˆ°æ•°æ®åº“çš„è¿æ¥ã€‚JDBC URLçš„æ ‡å‡†ç”±åè®®ï¼Œå­åè®®ï¼Œå­åç§°ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå„éƒ¨åˆ†é—´ç”¨å†’å·åˆ†éš”ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JDBC_4.png"></p><p>å‚æ•°urlï¼šæŒ‡å®šè¿æ¥çš„è·¯å¾„</p><ol><li>è¯­æ³•ï¼šjdbc:mysql://ipåœ°å€(åŸŸå):ç«¯å£å·/æ•°æ®åº“åç§°</li><li>ä¾‹å­ï¼šjdbc:mysql://localhost:3306/db3</li><li>ç»†èŠ‚ï¼šå¦‚æœè¿æ¥çš„æ˜¯æœ¬æœºmysqlæœåŠ¡å™¨ï¼Œå¹¶ä¸”mysqlæœåŠ¡é»˜è®¤ç«¯å£æ˜¯3306ï¼Œåˆ™urlå¯ä»¥ç®€å†™ä¸ºï¼šjdbc:mysql:///æ•°æ®åº“åç§°</li></ol><p>userï¼šç”¨æˆ·å<br>passwordï¼šå¯†ç </p></li></ul></li></ul></li></ul><h4 id="2-3-2-Connectionï¼šæ•°æ®åº“è¿æ¥å¯¹è±¡"><a href="#2-3-2-Connectionï¼šæ•°æ®åº“è¿æ¥å¯¹è±¡" class="headerlink" title="2.3.2 Connectionï¼šæ•°æ®åº“è¿æ¥å¯¹è±¡"></a>2.3.2 Connectionï¼šæ•°æ®åº“è¿æ¥å¯¹è±¡</h4><ul><li><p>åŠŸèƒ½</p><ul><li>è·å–æ‰§è¡Œsql çš„å¯¹è±¡</li><li>Statement createStatement()</li><li>PreparedStatement prepareStatement(String sql) </li></ul></li><li><p>ç®¡ç†äº‹åŠ¡ï¼š</p><ul><li>å¼€å¯äº‹åŠ¡ï¼šsetAutoCommit(boolean autoCommit) ï¼šè°ƒç”¨è¯¥æ–¹æ³•è®¾ç½®å‚æ•°ä¸ºfalseï¼Œå³å¼€å¯äº‹åŠ¡</li><li>æäº¤äº‹åŠ¡ï¼šcommit()</li><li>å›æ»šäº‹åŠ¡ï¼šrollback()</li></ul></li></ul><h4 id="2-3-3-Statementï¼šæ‰§è¡Œsqlçš„å¯¹è±¡"><a href="#2-3-3-Statementï¼šæ‰§è¡Œsqlçš„å¯¹è±¡" class="headerlink" title="2.3.3 Statementï¼šæ‰§è¡Œsqlçš„å¯¹è±¡"></a>2.3.3 Statementï¼šæ‰§è¡Œsqlçš„å¯¹è±¡</h4><ul><li><p>æ‰§è¡Œsql</p><ul><li>boolean execute(String sql) ï¼šå¯ä»¥æ‰§è¡Œä»»æ„çš„sql äº†è§£</li><li>int executeUpdate(String sql) ï¼šæ‰§è¡ŒDMLï¼ˆinsertã€updateã€deleteï¼‰è¯­å¥ã€DDL(createï¼Œalterã€drop)è¯­å¥</li><li>ResultSet executeQuery(String sql)  ï¼šæ‰§è¡ŒDQLï¼ˆselect)è¯­å¥</li><li>PreparedStatement prepareStatement(String sql) </li></ul></li><li><p>ä»£ç : å¯¹accountè¡¨å®Œæˆå¢åˆ æ”¹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Statement stmt = <span class="hljs-keyword">null</span>;<br>        Connection conn = <span class="hljs-keyword">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1. æ³¨å†Œé©±åŠ¨</span><br>            Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>            <span class="hljs-comment">//2. å®šä¹‰sql(å¢åˆ æ”¹)</span><br>            String sql = <span class="hljs-string">&quot;insert into account values(null,&#x27;ç‹äº”&#x27;,3000)&quot;</span>;<br>            <span class="hljs-comment">//String sql  = &quot;update account set balance = 1500 where id = 3&quot;;</span><br>            <span class="hljs-comment">//String sql  = &quot;delete from account where id = 3&quot;;</span><br>            <span class="hljs-comment">//3.è·å–Connectionå¯¹è±¡</span><br>            conn = DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql:///db3&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;root&quot;</span>);<br>            <span class="hljs-comment">//4.è·å–æ‰§è¡Œsqlçš„å¯¹è±¡ Statement</span><br>            stmt = conn.createStatement();<br>            <span class="hljs-comment">//5.æ‰§è¡Œsql</span><br>            <span class="hljs-keyword">int</span> count = stmt.executeUpdate(sql);<span class="hljs-comment">//å½±å“çš„è¡Œæ•°</span><br>            <span class="hljs-comment">//6.å¤„ç†ç»“æœ</span><br>            System.out.println(count);<br>            <span class="hljs-keyword">if</span>(count &gt; <span class="hljs-number">0</span>)&#123;<br>                System.out.println(<span class="hljs-string">&quot;æ·»åŠ æˆåŠŸï¼&quot;</span>);<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                System.out.println(<span class="hljs-string">&quot;æ·»åŠ å¤±è´¥ï¼&quot;</span>);<br>            &#125;<br><br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">//stmt.close();</span><br>            <span class="hljs-comment">//7. é‡Šæ”¾èµ„æº</span><br>            <span class="hljs-comment">//é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸</span><br>            <span class="hljs-keyword">if</span>(stmt != <span class="hljs-keyword">null</span>)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    stmt.close();<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(conn != <span class="hljs-keyword">null</span>)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    conn.close();<br>                &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¼€å¯äº‹åŠ¡ï¼šsetAutoCommit(boolean autoCommit) ï¼šè°ƒç”¨è¯¥æ–¹æ³•è®¾ç½®å‚æ•°ä¸ºfalseï¼Œå³å¼€å¯äº‹åŠ¡</li><li>æäº¤äº‹åŠ¡ï¼šcommit()</li><li>å›æ»šäº‹åŠ¡ï¼šrollback()</li></ul></li></ul><h4 id="2-3-4-ResultSetï¼šç»“æœé›†å¯¹è±¡-å°è£…æŸ¥è¯¢ç»“æœ"><a href="#2-3-4-ResultSetï¼šç»“æœé›†å¯¹è±¡-å°è£…æŸ¥è¯¢ç»“æœ" class="headerlink" title="2.3.4 ResultSetï¼šç»“æœé›†å¯¹è±¡,å°è£…æŸ¥è¯¢ç»“æœ"></a>2.3.4 ResultSetï¼šç»“æœé›†å¯¹è±¡,å°è£…æŸ¥è¯¢ç»“æœ</h4><ul><li><p>boolean next(): æ¸¸æ ‡å‘ä¸‹ç§»åŠ¨ä¸€è¡Œï¼Œåˆ¤æ–­å½“å‰è¡Œæ˜¯å¦æ˜¯æœ€åä¸€è¡Œæœ«å°¾(æ˜¯å¦æœ‰æ•°æ®)ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›falseï¼Œå¦‚æœä¸æ˜¯åˆ™è¿”å›true</p></li><li><p>getXxx(å‚æ•°):è·å–æ•°æ®</p><ul><li> Xxxï¼šä»£è¡¨æ•°æ®ç±»å‹   å¦‚ï¼š int getInt() ,    String getString()</li><li>å‚æ•°ï¼š<ol><li>intï¼šä»£è¡¨åˆ—çš„ç¼–å·, ä»1å¼€å§‹   å¦‚: getString(1)</li><li>Stringï¼šä»£è¡¨åˆ—åç§°, å¦‚: getDouble(â€œbalanceâ€)</li></ol></li></ul></li><li><p>æ³¨æ„ï¼š</p><ul><li><p>ä½¿ç”¨æ­¥éª¤ï¼š</p><ul><li>æ¸¸æ ‡å‘ä¸‹ç§»åŠ¨ä¸€è¡Œ</li><li>åˆ¤æ–­æ˜¯å¦æœ‰æ•°æ®</li><li>è·å–æ•°æ®</li></ul></li><li><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">while</span>(rs.next())&#123;<br><span class="hljs-comment">//è·å–æ•°æ®</span><br><span class="hljs-keyword">int</span> id = rs.getInt(<span class="hljs-number">1</span>);<br>String name = rs.getString(<span class="hljs-string">&quot;name&quot;</span>);<br><span class="hljs-keyword">double</span> balance = rs.getDouble(<span class="hljs-number">3</span>);<br>System.out.println(id + <span class="hljs-string">&quot;---&quot;</span> + name + <span class="hljs-string">&quot;---&quot;</span> + balance);<br>&#125;<br></code></pre></td></tr></table></figure></li></ul></li></ul><h4 id="2-3-5-PreparedStatementï¼šæ‰§è¡Œsqlçš„å¯¹è±¡"><a href="#2-3-5-PreparedStatementï¼šæ‰§è¡Œsqlçš„å¯¹è±¡" class="headerlink" title="2.3.5 PreparedStatementï¼šæ‰§è¡Œsqlçš„å¯¹è±¡"></a>2.3.5 PreparedStatementï¼šæ‰§è¡Œsqlçš„å¯¹è±¡</h4><ul><li><p>SQLæ³¨å…¥é—®é¢˜: åœ¨æ‹¼æ¥sqlæ—¶, æœ‰ä¸€äº›sqlçš„ç‰¹æ®Šå…³é”®å­—å‚ä¸å­—ç¬¦ä¸²çš„æ‹¼æ¥, ä¼šé€ æˆå®‰å…¨æ€§é—®é¢˜ </p><ul><li>è¾“å…¥ç”¨æˆ·éšä¾¿ï¼Œè¾“å…¥å¯†ç ï¼šaâ€™ or â€˜aâ€™ = â€˜a</li><li>sqlï¼šselect * from user where username = â€˜fhdsjkfâ€™ and password = â€˜aâ€™ or â€˜aâ€™ = â€˜aâ€™ </li></ul></li><li><p>è§£å†³sqlæ³¨å…¥é—®é¢˜ï¼šä½¿ç”¨PreparedStatementå¯¹è±¡æ¥è§£å†³</p></li><li><p>é¢„ç¼–è¯‘çš„SQLï¼šå‚æ•°ä½¿ç”¨ ? ä½œä¸ºå ä½ç¬¦</p></li><li><p>æ­¥éª¤:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ä½¿ç”¨PreparedStatementå®ç°ç™»å½•æ–¹æ³•</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">login</span><span class="hljs-params">(String username ,String password)</span></span>&#123;<br>    <span class="hljs-keyword">if</span>(username == <span class="hljs-keyword">null</span> || password == <span class="hljs-keyword">null</span>)&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>    &#125;<br>    <span class="hljs-comment">//è¿æ¥æ•°æ®åº“åˆ¤æ–­æ˜¯å¦ç™»å½•æˆåŠŸ</span><br>    Connection conn = <span class="hljs-keyword">null</span>;<br>    PreparedStatement pstmt =  <span class="hljs-keyword">null</span>;<br>    ResultSet rs = <span class="hljs-keyword">null</span>;<br>    <span class="hljs-comment">//1.è·å–è¿æ¥</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        conn =  JDBCUtils.getConnection();<br>        <span class="hljs-comment">//2.å®šä¹‰sql</span><br>        String sql = <span class="hljs-string">&quot;select * from user where username = ? and password = ?&quot;</span>;<br>        <span class="hljs-comment">//3.è·å–æ‰§è¡Œsqlçš„å¯¹è±¡</span><br>        pstmt = conn.prepareStatement(sql);<br>        <span class="hljs-comment">//ç»™?èµ‹å€¼</span><br>        pstmt.setString(<span class="hljs-number">1</span>,username);<br>        pstmt.setString(<span class="hljs-number">2</span>,password);<br>        <span class="hljs-comment">//4.æ‰§è¡ŒæŸ¥è¯¢,ä¸éœ€è¦ä¼ é€’sql</span><br>        rs = pstmt.executeQuery();<br>        <span class="hljs-comment">//5.åˆ¤æ–­</span><br>        <span class="hljs-comment">/* if(rs.next())&#123;//å¦‚æœæœ‰ä¸‹ä¸€è¡Œï¼Œåˆ™è¿”å›true</span><br><span class="hljs-comment">                return true;</span><br><span class="hljs-comment">            &#125;else&#123;</span><br><span class="hljs-comment">                return false;</span><br><span class="hljs-comment">            &#125;*/</span><br>        <span class="hljs-keyword">return</span> rs.next();<span class="hljs-comment">//å¦‚æœæœ‰ä¸‹ä¸€è¡Œï¼Œåˆ™è¿”å›true</span><br><br>    &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>        e.printStackTrace();<br>    &#125;<span class="hljs-keyword">finally</span> &#123;<br>        JDBCUtils.close(rs,pstmt,conn);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>æ³¨æ„ï¼šåæœŸéƒ½ä¼šä½¿ç”¨PreparedStatementæ¥å®Œæˆå¢åˆ æ”¹æŸ¥çš„æ‰€æœ‰æ“ä½œ</p><ul><li>å¯ä»¥é˜²æ­¢SQLæ³¨å…¥</li><li>æ•ˆç‡æ›´é«˜</li></ul></li></ul><h3 id="2-4-PreparedStatement-Statement-å¯¹æ¯”"><a href="#2-4-PreparedStatement-Statement-å¯¹æ¯”" class="headerlink" title="2.4 PreparedStatement/Statement å¯¹æ¯”"></a>2.4 PreparedStatement/Statement å¯¹æ¯”</h3><blockquote><p><strong>Blobç±»å‹çš„æ•°æ®</strong> (äº†è§£)</p><ol><li>BLOB (binary large object)ï¼ŒäºŒè¿›åˆ¶å¤§å¯¹è±¡ï¼ŒBLOBå¸¸å¸¸æ˜¯æ•°æ®åº“ä¸­ç”¨æ¥å­˜å‚¨äºŒè¿›åˆ¶æ–‡ä»¶çš„å­—æ®µç±»å‹ã€‚</li><li>æ’å…¥BLOBç±»å‹çš„æ•°æ®å¿…é¡»ä½¿ç”¨PreparedStatementï¼Œå› ä¸ºBLOBç±»å‹çš„æ•°æ®æ— æ³•ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥å†™çš„ã€‚</li><li>MySQLçš„å››ç§BLOBç±»å‹(é™¤äº†åœ¨å­˜å‚¨çš„æœ€å¤§ä¿¡æ¯é‡ä¸Šä¸åŒå¤–ï¼Œä»–ä»¬æ˜¯ç­‰åŒçš„)</li><li>å®é™…ä½¿ç”¨ä¸­æ ¹æ®éœ€è¦å­˜å…¥çš„æ•°æ®å¤§å°å®šä¹‰ä¸åŒçš„BLOBç±»å‹ã€‚</li></ol><p>æ³¨æ„ï¼šå¦‚æœå­˜å‚¨çš„æ–‡ä»¶è¿‡å¤§ï¼Œæ•°æ®åº“çš„æ€§èƒ½ä¼šä¸‹é™</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JDBC_5.png"></p><p><strong>ä¸¤è€…åŒºåˆ«</strong></p><ul><li><p>ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§. Statementçš„sqlæ‹¼æ¥æ˜¯ä¸ªéš¾é¢˜ã€‚</p></li><li><p>PreparedStatement å¯ä»¥é˜²æ­¢ SQL æ³¨å…¥</p></li><li><p>PreparedStatement å¯ä»¥å¤„ç†Blobç±»å‹çš„æ•°æ®</p></li><li><p>PreparedStatement èƒ½æœ€å¤§å¯èƒ½æé«˜æ€§èƒ½</p><ul><li><p>Oracleå’ŒPostgreSQL8æ˜¯è¿™æ ·ï¼Œä½†æ˜¯å¯¹äºMySQLä¸ä¸€å®šæ¯”Statementé«˜</p></li><li><p>DBServerä¼šå¯¹é¢„ç¼–è¯‘è¯­å¥æä¾›æ€§èƒ½ä¼˜åŒ–ã€‚å› ä¸ºé¢„ç¼–è¯‘è¯­å¥æœ‰å¯èƒ½è¢«é‡å¤è°ƒç”¨ï¼Œæ‰€ä»¥è¯­å¥åœ¨è¢«DBServerçš„ç¼–è¯‘å™¨ç¼–è¯‘åçš„æ‰§è¡Œä»£ç è¢«ç¼“å­˜ä¸‹æ¥ï¼Œé‚£ä¹ˆä¸‹æ¬¡è°ƒç”¨æ—¶åªè¦æ˜¯ç›¸åŒçš„é¢„ç¼–è¯‘è¯­å¥å°±ä¸éœ€è¦ç¼–è¯‘ï¼Œåªè¦å°†å‚æ•°ç›´æ¥ä¼ å…¥ç¼–è¯‘è¿‡çš„è¯­å¥æ‰§è¡Œä»£ç ä¸­å°±ä¼šå¾—åˆ°æ‰§è¡Œ</p></li></ul></li></ul><h2 id="3-JDBCUtils-æŠ½å–JDBCå·¥å…·ç±»"><a href="#3-JDBCUtils-æŠ½å–JDBCå·¥å…·ç±»" class="headerlink" title="3. JDBCUtils: æŠ½å–JDBCå·¥å…·ç±»"></a>3. JDBCUtils: æŠ½å–JDBCå·¥å…·ç±»</h2><ul><li><p>ç›®çš„ï¼šç®€åŒ–ä¹¦å†™</p></li><li><p>åˆ†æï¼š</p><ol><li><p>æ³¨å†Œé©±åŠ¨ä¹ŸæŠ½å–</p></li><li><p>æŠ½å–ä¸€ä¸ªæ–¹æ³•è·å–è¿æ¥å¯¹è±¡</p><ul><li><p>éœ€æ±‚ï¼šä¸æƒ³ä¼ é€’å‚æ•°ï¼ˆéº»çƒ¦ï¼‰ï¼Œè¿˜å¾—ä¿è¯å·¥å…·ç±»çš„é€šç”¨æ€§ã€‚</p></li><li><p>è§£å†³ï¼šé…ç½®æ–‡ä»¶</p><p> jdbc.properties<br> url=<br> user=<br> password=</p></li></ul></li></ol><ul><li>æŠ½å–ä¸€ä¸ªæ–¹æ³•é‡Šæ”¾èµ„æº</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * JDBCå·¥å…·ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCUtils</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String url;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String user;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String password;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String driver;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–‡ä»¶çš„è¯»å–ï¼Œåªéœ€è¦è¯»å–ä¸€æ¬¡å³å¯æ‹¿åˆ°è¿™äº›å€¼ã€‚ä½¿ç”¨é™æ€ä»£ç å—</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">static</span>&#123;<br>        <span class="hljs-comment">//è¯»å–èµ„æºæ–‡ä»¶ï¼Œè·å–å€¼ã€‚</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1. åˆ›å»ºPropertiesé›†åˆç±»ã€‚</span><br>            Properties pro = <span class="hljs-keyword">new</span> Properties();<br><br>            <span class="hljs-comment">//è·å–srcè·¯å¾„ä¸‹çš„æ–‡ä»¶çš„æ–¹å¼---&gt;ClassLoader ç±»åŠ è½½å™¨</span><br>            ClassLoader classLoader = JDBCUtils.class.getClassLoader();<br>            URL res  = classLoader.getResource(<span class="hljs-string">&quot;jdbc.properties&quot;</span>);<br>            String path = res.getPath();<br>           <span class="hljs-comment">// System.out.println(path);///D:/IdeaProjects/itcast/out/production/day04_jdbc/jdbc.properties</span><br>            <span class="hljs-comment">//2. åŠ è½½æ–‡ä»¶</span><br>           <span class="hljs-comment">// pro.load(new FileReader(&quot;D:\\IdeaProjects\\itcast\\day04_jdbc\\src\\jdbc.properties&quot;));</span><br>            pro.load(<span class="hljs-keyword">new</span> FileReader(path));<br><br>            <span class="hljs-comment">//3. è·å–æ•°æ®ï¼Œèµ‹å€¼</span><br>            url = pro.getProperty(<span class="hljs-string">&quot;url&quot;</span>);<br>            user = pro.getProperty(<span class="hljs-string">&quot;user&quot;</span>);<br>            password = pro.getProperty(<span class="hljs-string">&quot;password&quot;</span>);<br>            driver = pro.getProperty(<span class="hljs-string">&quot;driver&quot;</span>);<br>            <span class="hljs-comment">//4. æ³¨å†Œé©±åŠ¨</span><br>            Class.forName(driver);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–è¿æ¥</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿æ¥å¯¹è±¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br><br>        <span class="hljs-keyword">return</span> DriverManager.getConnection(url, user, password);<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é‡Šæ”¾èµ„æº</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> stmt</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> conn</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(Statement stmt,Connection conn)</span></span>&#123;<br>        <span class="hljs-keyword">if</span>( stmt != <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                stmt.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">if</span>( conn != <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                conn.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é‡Šæ”¾èµ„æº</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> stmt</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> conn</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(ResultSet rs,Statement stmt, Connection conn)</span></span>&#123;<br>        <span class="hljs-keyword">if</span>( rs != <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                rs.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>( stmt != <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                stmt.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>( conn != <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                conn.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="4-JDBCæ§åˆ¶äº‹åŠ¡"><a href="#4-JDBCæ§åˆ¶äº‹åŠ¡" class="headerlink" title="4. JDBCæ§åˆ¶äº‹åŠ¡"></a>4. JDBCæ§åˆ¶äº‹åŠ¡</h2><ol><li><p>äº‹åŠ¡ï¼šä¸€ä¸ªåŒ…å«å¤šä¸ªæ­¥éª¤çš„ä¸šåŠ¡æ“ä½œã€‚å¦‚æœè¿™ä¸ªä¸šåŠ¡æ“ä½œè¢«äº‹åŠ¡ç®¡ç†ï¼Œåˆ™è¿™å¤šä¸ªæ­¥éª¤è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ã€‚</p></li><li><p>æ“ä½œï¼š</p><ol><li>å¼€å¯äº‹åŠ¡</li><li>æäº¤äº‹åŠ¡</li><li>å›æ»šäº‹åŠ¡</li></ol></li><li><p>ä½¿ç”¨Connectionå¯¹è±¡æ¥ç®¡ç†äº‹åŠ¡</p><ul><li>å¼€å¯äº‹åŠ¡ï¼šsetAutoCommit(boolean autoCommit) ï¼šè°ƒç”¨è¯¥æ–¹æ³•è®¾ç½®å‚æ•°ä¸ºfalseï¼Œå³å¼€å¯äº‹åŠ¡<ul><li>åœ¨æ‰§è¡Œsqlä¹‹å‰å¼€å¯äº‹åŠ¡</li></ul></li><li>æäº¤äº‹åŠ¡ï¼šcommit() <ul><li>å½“æ‰€æœ‰sqléƒ½æ‰§è¡Œå®Œæäº¤äº‹åŠ¡</li></ul></li><li>å›æ»šäº‹åŠ¡ï¼šrollback() <ul><li>åœ¨catchä¸­å›æ»šäº‹åŠ¡</li></ul></li></ul></li><li><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * äº‹åŠ¡æ“ä½œ</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCDemo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Connection conn = <span class="hljs-keyword">null</span>;<br>        PreparedStatement pstmt1 = <span class="hljs-keyword">null</span>;<br>        PreparedStatement pstmt2 = <span class="hljs-keyword">null</span>;<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.è·å–è¿æ¥</span><br>            conn = JDBCUtils.getConnection();<br>            <span class="hljs-comment">//å¼€å¯äº‹åŠ¡</span><br>            conn.setAutoCommit(<span class="hljs-keyword">false</span>);<br><br>            <span class="hljs-comment">//2.å®šä¹‰sql</span><br>            <span class="hljs-comment">//2.1 å¼ ä¸‰ - 500</span><br>            String sql1 = <span class="hljs-string">&quot;update account set balance = balance - ? where id = ?&quot;</span>;<br>            <span class="hljs-comment">//2.2 æå›› + 500</span><br>            String sql2 = <span class="hljs-string">&quot;update account set balance = balance + ? where id = ?&quot;</span>;<br>            <span class="hljs-comment">//3.è·å–æ‰§è¡Œsqlå¯¹è±¡</span><br>            pstmt1 = conn.prepareStatement(sql1);<br>            pstmt2 = conn.prepareStatement(sql2);<br>            <span class="hljs-comment">//4. è®¾ç½®å‚æ•°</span><br>            pstmt1.setDouble(<span class="hljs-number">1</span>,<span class="hljs-number">500</span>);<br>            pstmt1.setInt(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>);<br><br>            pstmt2.setDouble(<span class="hljs-number">1</span>,<span class="hljs-number">500</span>);<br>            pstmt2.setInt(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>);<br>            <span class="hljs-comment">//5.æ‰§è¡Œsql</span><br>            pstmt1.executeUpdate();<br>            <span class="hljs-comment">// æ‰‹åŠ¨åˆ¶é€ å¼‚å¸¸</span><br>            <span class="hljs-keyword">int</span> i = <span class="hljs-number">3</span>/<span class="hljs-number">0</span>;<br><br>            pstmt2.executeUpdate();<br>            <span class="hljs-comment">//æäº¤äº‹åŠ¡</span><br>            conn.commit();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">//äº‹åŠ¡å›æ»š</span><br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">if</span>(conn != <span class="hljs-keyword">null</span>) &#123;<br>                    conn.rollback();<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e1) &#123;<br>                e1.printStackTrace();<br>            &#125;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            JDBCUtils.close(pstmt1,conn);<br>            JDBCUtils.close(pstmt2,<span class="hljs-keyword">null</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><h2 id="5-æ‰¹å¤„ç†"><a href="#5-æ‰¹å¤„ç†" class="headerlink" title="5. æ‰¹å¤„ç†"></a>5. æ‰¹å¤„ç†</h2><p>å½“éœ€è¦æˆæ‰¹æ’å…¥æˆ–è€…æ›´æ–°è®°å½•æ—¶ã€‚å¯ä»¥é‡‡ç”¨Javaçš„æ‰¹é‡æ›´æ–°æœºåˆ¶ï¼Œè¿™ä¸€æœºåˆ¶å…è®¸å¤šæ¡è¯­å¥ä¸€æ¬¡æ€§æäº¤ç»™æ•°æ®åº“æ‰¹é‡å¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹æ¯”å•ç‹¬æäº¤å¤„ç†æ›´æœ‰æ•ˆç‡ã€‚</p><blockquote><p> æ³¨æ„:</p><ol><li>ä¸æ˜¯æ‰€ç”¨ç‰ˆæœ¬çš„mysqléƒ½æ”¯æŒ</li><li><strong>JDBC</strong>è¿æ¥MySQLæ—¶ï¼Œå¦‚æœè¦ä½¿ç”¨æ‰¹å¤„ç†åŠŸèƒ½ï¼Œè¯·å†urä¸­åŠ å‚æ•°?rewriteBatchedStatements=true</li><li><strong>PreparedStatement</strong>ä½œæ‰¹å¤„ç†æ’å…¥æ—¶ä½¿ç”¨valuesï¼ˆä½¿ç”¨valueæ²¡æœ‰æ•ˆæœï¼‰</li></ol></blockquote><h3 id="5-1-JDBCçš„æ‰¹é‡å¤„ç†è¯­å¥åŒ…æ‹¬ä¸‹é¢æ–¹æ³•ï¼š"><a href="#5-1-JDBCçš„æ‰¹é‡å¤„ç†è¯­å¥åŒ…æ‹¬ä¸‹é¢æ–¹æ³•ï¼š" class="headerlink" title="5.1 JDBCçš„æ‰¹é‡å¤„ç†è¯­å¥åŒ…æ‹¬ä¸‹é¢æ–¹æ³•ï¼š"></a>5.1 JDBCçš„æ‰¹é‡å¤„ç†è¯­å¥åŒ…æ‹¬ä¸‹é¢æ–¹æ³•ï¼š</h3><ul><li><p><strong>addBatch</strong>()ï¼šæ·»åŠ éœ€è¦æ‰¹é‡å¤„ç†çš„SQLè¯­å¥æˆ–å‚æ•°</p></li><li><p><strong>executeBatch</strong>()ï¼šæ‰§è¡Œæ‰¹é‡å¤„ç†è¯­å¥ï¼›</p></li><li><p><strong>clearBatch</strong>():æ¸…ç©ºæ‰¹å¤„ç†åŒ…çš„è¯­å¥</p></li></ul><h3 id="5-2-æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥çš„ä¸¤ç§æƒ…å†µ"><a href="#5-2-æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥çš„ä¸¤ç§æƒ…å†µ" class="headerlink" title="5.2 æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥çš„ä¸¤ç§æƒ…å†µ"></a>5.2 æ‰¹é‡æ‰§è¡ŒSQLè¯­å¥çš„ä¸¤ç§æƒ…å†µ</h3><ul><li><p>å¤šæ¡SQLè¯­å¥çš„æ‰¹é‡å¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">...<br>Statement st = conn.createStatement();<br>st.addBatch(sql1);<br>st.addBatch(sql2);<br>...<br>st.addBatch(sqln);<br>st.executeBatch();<br>st.clearBatch();<br>...<br></code></pre></td></tr></table></figure></li><li><p><strong>ä¸€ä¸ªSQLè¯­å¥çš„æ‰¹é‡ä¼ å‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java">...<br>PreparedStatement pst = conn.prepareStatement(sql);<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">100</span>; i &lt; <span class="hljs-number">1001</span>; i++)&#123;<br>pst.setInt(<span class="hljs-number">1</span>, i);<br>...<br>pst.addBatch();<br>&#125;<br>pst.executeBatch();<br>st.clearBatch();<br>...<br></code></pre></td></tr></table></figure></li></ul><h2 id="6-Blobç±»å‹æ•°æ®çš„è¯»å†™ï¼ˆäº†è§£ï¼‰"><a href="#6-Blobç±»å‹æ•°æ®çš„è¯»å†™ï¼ˆäº†è§£ï¼‰" class="headerlink" title="6. Blobç±»å‹æ•°æ®çš„è¯»å†™ï¼ˆäº†è§£ï¼‰"></a>6. Blobç±»å‹æ•°æ®çš„è¯»å†™ï¼ˆäº†è§£ï¼‰</h2><ul><li><p>MySQLä¸­ï¼ŒBLOBæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å¤§å‹å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥å­˜å‚¨å¤§é‡æ•°æ®çš„å®¹å™¨ï¼Œå®ƒèƒ½å®¹çº³ä¸åŒå¤§å°çš„æ•°æ®ã€‚</p></li><li><p>MySQLçš„å››ç§BLOBç±»å‹(é™¤äº†åœ¨å­˜å‚¨çš„æœ€å¤§ä¿¡æ¯é‡ä¸Šä¸åŒå¤–ï¼Œä»–ä»¬æ˜¯ç­‰åŒçš„)</p></li><li><p>å®é™…ä½¿ç”¨ä¸­æ ¹æ®éœ€è¦å­˜å…¥çš„æ•°æ®å¤§å°å®šä¹‰ä¸åŒçš„BLOBç±»å‹ã€‚</p></li><li><p> éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¦‚æœå­˜å‚¨çš„æ–‡ä»¶è¿‡å¤§ï¼Œæ•°æ®åº“çš„æ€§èƒ½ä¼šä¸‹é™</p></li></ul><p>å†™å…¥ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JDBC_6.png"></p><p>è¯»å–ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JDBC_7.png"></p><h2 id="7-æ•°æ®åº“è¿æ¥æ± "><a href="#7-æ•°æ®åº“è¿æ¥æ± " class="headerlink" title="7. æ•°æ®åº“è¿æ¥æ± "></a>7. æ•°æ®åº“è¿æ¥æ± </h2><ol><li><p>æ¦‚å¿µï¼šå…¶å®å°±æ˜¯ä¸€ä¸ªå®¹å™¨(é›†åˆ)ï¼Œå­˜æ”¾æ•°æ®åº“è¿æ¥çš„å®¹å™¨ã€‚</p><p> å½“ç³»ç»Ÿåˆå§‹åŒ–å¥½åï¼Œå®¹å™¨è¢«åˆ›å»ºï¼Œå®¹å™¨ä¸­ä¼šç”³è¯·ä¸€äº›è¿æ¥å¯¹è±¡ï¼Œå½“ç”¨æˆ·æ¥è®¿é—®æ•°æ®åº“æ—¶ï¼Œä»å®¹å™¨ä¸­è·å–è¿æ¥å¯¹è±¡ï¼Œç”¨æˆ·è®¿é—®å®Œä¹‹åï¼Œä¼šå°†è¿æ¥å¯¹è±¡å½’è¿˜ç»™å®¹å™¨ã€‚</p></li><li><p>å¥½å¤„ï¼š</p><ul><li><p>èŠ‚çº¦èµ„æº</p></li><li><p>ç”¨æˆ·è®¿é—®é«˜æ•ˆ</p></li></ul></li><li><p>å®ç°ï¼š</p></li></ol><ul><li><p>æ ‡å‡†æ¥å£ï¼šDataSource   javax.sqlåŒ…ä¸‹çš„</p><p>æ–¹æ³•ï¼š</p><ul><li>è·å–è¿æ¥ï¼šgetConnection()</li><li>å½’è¿˜è¿æ¥ï¼šConnection.close()ã€‚å¦‚æœè¿æ¥å¯¹è±¡Connectionæ˜¯ä»è¿æ¥æ± ä¸­è·å–çš„ï¼Œé‚£ä¹ˆè°ƒç”¨Connection.close()æ–¹æ³•ï¼Œåˆ™ä¸ä¼šå†å…³é—­è¿æ¥äº†ã€‚è€Œæ˜¯å½’è¿˜è¿æ¥</li></ul></li><li><p>ä¸€èˆ¬æˆ‘ä»¬ä¸å»å®ç°å®ƒï¼Œæœ‰æ•°æ®åº“å‚å•†æ¥å®ç°</p><ul><li>C3P0ï¼šæ•°æ®åº“è¿æ¥æ± æŠ€æœ¯</li><li>Druidï¼šæ•°æ®åº“è¿æ¥æ± å®ç°æŠ€æœ¯ï¼Œç”±é˜¿é‡Œå·´å·´æä¾›çš„</li></ul></li></ul><ol start="4"><li>C3P0ï¼šæ•°æ®åº“è¿æ¥æ± æŠ€æœ¯</li></ol><ul><li>æ­¥éª¤ï¼š</li></ul><ol><li><p>å¯¼å…¥jaråŒ… (ä¸¤ä¸ª) c3p0-0.9.5.2.jar mchange-commons-java-0.2.12.jar ï¼Œ</p><ul><li>ä¸è¦å¿˜è®°å¯¼å…¥æ•°æ®åº“é©±åŠ¨jaråŒ…</li></ul></li><li><p>å®šä¹‰é…ç½®æ–‡ä»¶ï¼š</p><ul><li>åç§°ï¼š c3p0.properties æˆ–è€… c3p0-config.xml</li><li>è·¯å¾„ï¼šç›´æ¥å°†æ–‡ä»¶æ”¾åœ¨srcç›®å½•ä¸‹å³å¯ã€‚</li></ul></li><li><p>åˆ›å»ºæ ¸å¿ƒå¯¹è±¡ æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ ComboPooledDataSource</p></li><li><p>è·å–è¿æ¥ï¼š getConnection</p></li></ol><ul><li>ä»£ç ï¼š</li></ul>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * c3p0çš„æ¼”ç¤º</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C3P0Demo</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-comment">//1.åˆ›å»ºæ•°æ®åº“è¿æ¥æ± å¯¹è±¡</span><br>        DataSource ds  = <span class="hljs-keyword">new</span> ComboPooledDataSource();<br>        <span class="hljs-comment">//2. è·å–è¿æ¥å¯¹è±¡</span><br>        Connection conn = ds.getConnection();<br>        <span class="hljs-comment">//3. æ‰“å°</span><br>        System.out.println(conn);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ol start="5"><li>Druidï¼šæ•°æ®åº“è¿æ¥æ± å®ç°æŠ€æœ¯ï¼Œç”±é˜¿é‡Œå·´å·´æä¾›çš„<ol><li>æ­¥éª¤ï¼š<ol><li>å¯¼å…¥jaråŒ… druid-1.0.9.jar</li><li>å®šä¹‰é…ç½®æ–‡ä»¶ï¼š<ul><li>æ˜¯propertieså½¢å¼çš„</li><li>å¯ä»¥å«ä»»æ„åç§°ï¼Œå¯ä»¥æ”¾åœ¨ä»»æ„ç›®å½•ä¸‹</li></ul></li><li>åŠ è½½é…ç½®æ–‡ä»¶ã€‚Properties</li><li>è·å–æ•°æ®åº“è¿æ¥æ± å¯¹è±¡ï¼šé€šè¿‡å·¥å‚æ¥æ¥è·å–  DruidDataSourceFactory</li><li>è·å–è¿æ¥ï¼šgetConnection</li></ol></li></ol><ul><li>ä»£ç ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java">  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * Druidæ¼”ç¤º</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidDemo</span> </span>&#123;<br>      <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;<br>          <span class="hljs-comment">//1.å¯¼å…¥jaråŒ…</span><br>        <span class="hljs-comment">//2.å®šä¹‰é…ç½®æ–‡ä»¶</span><br>        <span class="hljs-comment">//3.åŠ è½½é…ç½®æ–‡ä»¶</span><br>        Properties pro = <span class="hljs-keyword">new</span> Properties();<br>        InputStream is = DruidDemo.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;druid.properties&quot;</span>);<br>        pro.load(is);<br>        <span class="hljs-comment">//4.è·å–è¿æ¥æ± å¯¹è±¡</span><br>        DataSource ds = DruidDataSourceFactory.createDataSource(pro);<br>        <span class="hljs-comment">//5.è·å–è¿æ¥</span><br>        Connection conn = ds.getConnection();<br>        System.out.println(conn);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ul><ol start="2"><li>å®šä¹‰å·¥å…·ç±»<ol><li>å®šä¹‰ä¸€ä¸ªç±» JDBCUtils</li><li>æä¾›é™æ€ä»£ç å—åŠ è½½é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–è¿æ¥æ± å¯¹è±¡</li><li>æä¾›æ–¹æ³•<ol><li>è·å–è¿æ¥æ–¹æ³•ï¼šé€šè¿‡æ•°æ®åº“è¿æ¥æ± è·å–è¿æ¥</li><li>é‡Šæ”¾èµ„æº</li><li>è·å–è¿æ¥æ± çš„æ–¹æ³•</li></ol></li><li>ä»£ç ï¼š<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Druidè¿æ¥æ± çš„å·¥å…·ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JDBCUtils</span> </span>&#123;<br><br>    <span class="hljs-comment">//1.å®šä¹‰æˆå‘˜å˜é‡ DataSource</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> DataSource ds ;<br><br>    <span class="hljs-keyword">static</span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//1.åŠ è½½é…ç½®æ–‡ä»¶</span><br>            Properties pro = <span class="hljs-keyword">new</span> Properties();<br>            pro.load(JDBCUtils.class.getClassLoader().getResourceAsStream(<span class="hljs-string">&quot;druid.properties&quot;</span>));<br>            <span class="hljs-comment">//2.è·å–DataSource</span><br>            ds = DruidDataSourceFactory.createDataSource(pro);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–è¿æ¥</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>        <span class="hljs-keyword">return</span> ds.getConnection();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é‡Šæ”¾èµ„æº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(Statement stmt,Connection conn)</span></span>&#123;<br>       close(<span class="hljs-keyword">null</span>,stmt,conn);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(ResultSet rs , Statement stmt, Connection conn)</span></span>&#123;<br>        <span class="hljs-keyword">if</span>(rs != <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                rs.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(stmt != <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                stmt.close();<br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(conn != <span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                conn.close();<span class="hljs-comment">//å½’è¿˜è¿æ¥</span><br>            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–è¿æ¥æ± æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> DataSource <span class="hljs-title">getDataSource</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">return</span>  ds;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol></li></ol></li></ol><h2 id="8-Spring-JDBCï¼ˆDBUtilsä¹Ÿæ¯”è¾ƒå¸¸ç”¨ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼‰"><a href="#8-Spring-JDBCï¼ˆDBUtilsä¹Ÿæ¯”è¾ƒå¸¸ç”¨ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼‰" class="headerlink" title="8. Spring JDBCï¼ˆDBUtilsä¹Ÿæ¯”è¾ƒå¸¸ç”¨ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼‰"></a>8. Spring JDBCï¼ˆDBUtilsä¹Ÿæ¯”è¾ƒå¸¸ç”¨ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº†ï¼‰</h2><ul><li><p>Springæ¡†æ¶å¯¹JDBCçš„ç®€å•å°è£…ã€‚æä¾›äº†ä¸€ä¸ªJDBCTemplateå¯¹è±¡ç®€åŒ–JDBCçš„å¼€å‘</p></li><li><p>æ­¥éª¤ï¼š</p><ol><li><p>å¯¼å…¥jaråŒ…</p></li><li><p>åˆ›å»ºJdbcTemplateå¯¹è±¡ã€‚ä¾èµ–äºæ•°æ®æºDataSource</p><ul><li>JdbcTemplate template = new JdbcTemplate(ds);</li></ul></li><li><p>è°ƒç”¨JdbcTemplateçš„æ–¹æ³•æ¥å®ŒæˆCRUDçš„æ“ä½œ</p><ul><li><p>update():æ‰§è¡ŒDMLè¯­å¥ã€‚å¢ã€åˆ ã€æ”¹è¯­å¥</p></li><li><p>queryForMap():æŸ¥è¯¢ç»“æœå°†ç»“æœé›†å°è£…ä¸ºmapé›†åˆï¼Œå°†åˆ—åä½œä¸ºkeyï¼Œå°†å€¼ä½œä¸ºvalue å°†è¿™æ¡è®°å½•å°è£…ä¸ºä¸€ä¸ªmapé›†åˆ</p><p>æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•æŸ¥è¯¢çš„ç»“æœé›†é•¿åº¦åªèƒ½æ˜¯1</p></li><li><p>queryForList():æŸ¥è¯¢ç»“æœå°†ç»“æœé›†å°è£…ä¸ºlisté›†åˆ</p><p>æ³¨æ„ï¼šå°†æ¯ä¸€æ¡è®°å½•å°è£…ä¸ºä¸€ä¸ªMapé›†åˆï¼Œå†å°†Mapé›†åˆè£…è½½åˆ°Listé›†åˆä¸­</p></li><li><p>query():æŸ¥è¯¢ç»“æœï¼Œå°†ç»“æœå°è£…ä¸ºJavaBeanå¯¹è±¡</p></li><li><p>queryçš„å‚æ•°ï¼šRowMapper</p></li></ul></li><li><p>ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨BeanPropertyRowMapperå®ç°ç±»ã€‚å¯ä»¥å®Œæˆæ•°æ®åˆ°JavaBeançš„è‡ªåŠ¨å°è£…</p></li><li><p>new BeanPropertyRowMapper&lt;ç±»å‹&gt;(ç±»å‹.class)</p><ul><li><p>queryForObjectï¼šæŸ¥è¯¢ç»“æœï¼Œå°†ç»“æœå°è£…ä¸ºå¯¹è±¡</p><p>ä¸€èˆ¬ç”¨äºèšåˆå‡½æ•°çš„æŸ¥è¯¢</p></li></ul></li></ol></li></ul><ul><li><p>ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.jdbctemplate;<br><span class="hljs-keyword">import</span> cn.itcast.utils.JDBCUtils;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * JdbcTemplateå…¥é—¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcTemplateDemo1</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">//1.å¯¼å…¥jaråŒ…</span><br>        <span class="hljs-comment">//2.åˆ›å»ºJDBCTemplateå¯¹è±¡</span><br>        JdbcTemplate template = <span class="hljs-keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());<br>        <span class="hljs-comment">//3.è°ƒç”¨æ–¹æ³•</span><br>        String sql = <span class="hljs-string">&quot;update account set balance = 5000 where id = ?&quot;</span>;<br>        <span class="hljs-keyword">int</span> count = template.update(sql, <span class="hljs-number">3</span>);<br>        System.out.println(count);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> cn.itcast.jdbctemplate;<br><br><span class="hljs-keyword">import</span> cn.itcast.domain.Emp;<br><span class="hljs-keyword">import</span> cn.itcast.utils.JDBCUtils;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.RowMapper;<br><br><span class="hljs-keyword">import</span> java.sql.Date;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcTemplateDemo2</span> </span>&#123;<br><br>    <span class="hljs-comment">//Junitå•å…ƒæµ‹è¯•ï¼Œå¯ä»¥è®©æ–¹æ³•ç‹¬ç«‹æ‰§è¡Œ</span><br>    <span class="hljs-comment">//1. è·å–JDBCTemplateå¯¹è±¡</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate template = <span class="hljs-keyword">new</span> JdbcTemplate(JDBCUtils.getDataSource());<br>    <br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 1. ä¿®æ”¹1å·æ•°æ®çš„ salary ä¸º 10000</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;<br><br>        <span class="hljs-comment">//2. å®šä¹‰sql</span><br>        String sql = <span class="hljs-string">&quot;update emp set salary = 10000 where id = 1001&quot;</span>;<br>        <span class="hljs-comment">//3. æ‰§è¡Œsql</span><br>        <span class="hljs-keyword">int</span> count = template.update(sql);<br>        System.out.println(count);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 2. æ·»åŠ ä¸€æ¡è®°å½•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;insert into emp(id,ename,dept_id) values(?,?,?)&quot;</span>;<br>        <span class="hljs-keyword">int</span> count = template.update(sql, <span class="hljs-number">1015</span>, <span class="hljs-string">&quot;éƒ­é–&quot;</span>, <span class="hljs-number">10</span>);<br>        System.out.println(count);<br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 3.åˆ é™¤åˆšæ‰æ·»åŠ çš„è®°å½•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test3</span><span class="hljs-params">()</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;delete from emp where id = ?&quot;</span>;<br>        <span class="hljs-keyword">int</span> count = template.update(sql, <span class="hljs-number">1015</span>);<br>        System.out.println(count);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 4.æŸ¥è¯¢idä¸º1001çš„è®°å½•ï¼Œå°†å…¶å°è£…ä¸ºMapé›†åˆ</span><br><span class="hljs-comment">     * æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•æŸ¥è¯¢çš„ç»“æœé›†é•¿åº¦åªèƒ½æ˜¯1</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test4</span><span class="hljs-params">()</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;select * from emp where id = ? or id = ?&quot;</span>;<br>        Map&lt;String, Object&gt; map = template.queryForMap(sql, <span class="hljs-number">1001</span>,<span class="hljs-number">1002</span>);<br>        System.out.println(map);<br>        <span class="hljs-comment">//&#123;id=1001, ename=å­™æ‚Ÿç©º, job_id=4, mgr=1004, joindate=2000-12-17, salary=10000.00, bonus=null, dept_id=20&#125;</span><br><br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 5. æŸ¥è¯¢æ‰€æœ‰è®°å½•ï¼Œå°†å…¶å°è£…ä¸ºList</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test5</span><span class="hljs-params">()</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;select * from emp&quot;</span>;<br>        List&lt;Map&lt;String, Object&gt;&gt; list = template.queryForList(sql);<br><br>        <span class="hljs-keyword">for</span> (Map&lt;String, Object&gt; stringObjectMap : list) &#123;<br>            System.out.println(stringObjectMap);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 6. æŸ¥è¯¢æ‰€æœ‰è®°å½•ï¼Œå°†å…¶å°è£…ä¸ºEmpå¯¹è±¡çš„Listé›†åˆ</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test6</span><span class="hljs-params">()</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;select * from emp&quot;</span>;<br>        List&lt;Emp&gt; list = template.query(sql, <span class="hljs-keyword">new</span> RowMapper&lt;Emp&gt;() &#123;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Emp <span class="hljs-title">mapRow</span><span class="hljs-params">(ResultSet rs, <span class="hljs-keyword">int</span> i)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>                Emp emp = <span class="hljs-keyword">new</span> Emp();<br>                <span class="hljs-keyword">int</span> id = rs.getInt(<span class="hljs-string">&quot;id&quot;</span>);<br>                String ename = rs.getString(<span class="hljs-string">&quot;ename&quot;</span>);<br>                <span class="hljs-keyword">int</span> job_id = rs.getInt(<span class="hljs-string">&quot;job_id&quot;</span>);<br>                <span class="hljs-keyword">int</span> mgr = rs.getInt(<span class="hljs-string">&quot;mgr&quot;</span>);<br>                Date joindate = rs.getDate(<span class="hljs-string">&quot;joindate&quot;</span>);<br>                <span class="hljs-keyword">double</span> salary = rs.getDouble(<span class="hljs-string">&quot;salary&quot;</span>);<br>                <span class="hljs-keyword">double</span> bonus = rs.getDouble(<span class="hljs-string">&quot;bonus&quot;</span>);<br>                <span class="hljs-keyword">int</span> dept_id = rs.getInt(<span class="hljs-string">&quot;dept_id&quot;</span>);<br><br>                emp.setId(id);<br>                emp.setEname(ename);<br>                emp.setJob_id(job_id);<br>                emp.setMgr(mgr);<br>                emp.setJoindate(joindate);<br>                emp.setSalary(salary);<br>                emp.setBonus(bonus);<br>                emp.setDept_id(dept_id);<br><br>                <span class="hljs-keyword">return</span> emp;<br>            &#125;<br>        &#125;);<br><br>        <span class="hljs-keyword">for</span> (Emp emp : list) &#123;<br>            System.out.println(emp);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 6. æŸ¥è¯¢æ‰€æœ‰è®°å½•ï¼Œå°†å…¶å°è£…ä¸ºEmpå¯¹è±¡çš„Listé›†åˆ</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test6_2</span><span class="hljs-params">()</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;select * from emp&quot;</span>;<br>        List&lt;Emp&gt; list = template.query(sql, <span class="hljs-keyword">new</span> BeanPropertyRowMapper&lt;Emp&gt;(Emp.class));<br>        <span class="hljs-keyword">for</span> (Emp emp : list) &#123;<br>            System.out.println(emp);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 7. æŸ¥è¯¢æ€»è®°å½•æ•°</span><br><span class="hljs-comment">     */</span><br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test7</span><span class="hljs-params">()</span></span>&#123;<br>        String sql = <span class="hljs-string">&quot;select count(id) from emp&quot;</span>;<br>        Long total = template.queryForObject(sql, Long.class);<br>        System.out.println(total);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>è¡¨ä¸JavaBeançš„å…³ç³»</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/JDBC_8(2).png"></p></li></ul><h2 id="9-DAOå±‚"><a href="#9-DAOå±‚" class="headerlink" title="9.  DAOå±‚"></a>9.  DAOå±‚</h2><ul><li><p>DAOï¼šData Access Objectè®¿é—®æ•°æ®ä¿¡æ¯çš„ç±»å’Œæ¥å£ï¼ŒåŒ…æ‹¬äº†å¯¹æ•°æ®çš„CRUDï¼ˆCreateã€Retrivalã€Updateã€Deleteï¼‰ï¼Œè€Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡ç›¸å…³çš„ä¿¡æ¯</p></li><li><p>ä½œç”¨ï¼šä¸ºäº†å®ç°åŠŸèƒ½çš„æ¨¡å—åŒ–ï¼Œæ›´æœ‰åˆ©äºä»£ç çš„ç»´æŠ¤å’Œå‡çº§</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Java</category>
      
      <category>Database</category>
      
      <category>MySQL</category>
      
      <category>JDBC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>MySQL</tag>
      
      <tag>JDBC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HEXOæ¡†æ¶ ä¸ªäººåšå®¢åŸŸåæ›´æ¢</title>
    <link href="/2021/03/11/HEXO%E6%A1%86%E6%9E%B6%20%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%9F%9F%E5%90%8D%E6%9B%B4%E6%8D%A2/"/>
    <url>/2021/03/11/HEXO%E6%A1%86%E6%9E%B6%20%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E5%9F%9F%E5%90%8D%E6%9B%B4%E6%8D%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="HEXOæ¡†æ¶-ä¸ªäººåšå®¢åŸŸåæ›´æ¢"><a href="#HEXOæ¡†æ¶-ä¸ªäººåšå®¢åŸŸåæ›´æ¢" class="headerlink" title="HEXOæ¡†æ¶ ä¸ªäººåšå®¢åŸŸåæ›´æ¢"></a>HEXOæ¡†æ¶ ä¸ªäººåšå®¢åŸŸåæ›´æ¢</h1><p>åŸºäº<a href="http://lihengxu.cn/2020/08/21/HEXO%E6%A1%86%E6%9E%B6%20%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">HEXOæ¡†æ¶ ä¸ªäººåšå®¢æ­å»º</a>ï¼Œå®Œæˆåšå®¢é¡¹ç›®éƒ¨ç½²åï¼Œæˆ‘ä»¬å¯ä»¥ç»‘å®šè‡ªå·±çš„åŸŸå</p><h2 id="1-è´­ä¹°åŸŸå"><a href="#1-è´­ä¹°åŸŸå" class="headerlink" title="1. è´­ä¹°åŸŸå"></a>1. è´­ä¹°åŸŸå</h2><p>åœ¨<a href="https://wanwang.aliyun.com/">é˜¿é‡Œäº‘çš„ä¸‡ç½‘</a>è´­ä¹°äº†è‡ªå·±åŸŸåï¼šlihengxu.cn</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo2_1_%E9%98%BF%E9%87%8C%E4%BA%91%E5%9F%9F%E5%90%8D%E7%94%B3%E8%AF%B7.png"></p><p>è´­ä¹°åå¯ä»¥åœ¨<a href="https://dc.console.aliyun.com/">åŸŸåæ§åˆ¶å°</a>çœ‹åˆ°è‡ªå·±çš„åŸŸåä¿¡æ¯</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo2_2_%E9%98%BF%E9%87%8C%E4%BA%91%E5%9F%9F%E5%90%8D%E6%8E%A7%E5%88%B6%E5%8F%B0.png"></p><h2 id="2-è§£æåŸŸå"><a href="#2-è§£æåŸŸå" class="headerlink" title="2. è§£æåŸŸå"></a>2. è§£æåŸŸå</h2><ul><li><p>è§£æä¹‹å‰å…ˆping ä¸€ä¸‹åšå®¢ä»“åº“å¯¹åº”çš„GitHubäºŒçº§åŸŸåï¼š</p><p>lihengxu.github.ioçš„IPåœ°å€ï¼š185.199.110.153</p></li><li><p>ç„¶åç‚¹å‡»è§£æ</p></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo2_3_%E8%A7%A3%E6%9E%90%E5%9F%9F%E5%90%8D.png"></p><ul><li>æ·»åŠ ä¸¤ä¸ªè§£æè®°å½•</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo2_4_%E8%A7%A3%E6%9E%90%E6%B7%BB%E5%8A%A0%E8%AE%B0%E5%BD%951.png"></p><hr><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo2_5_%E8%A7%A3%E6%9E%90%E6%B7%BB%E5%8A%A0%E8%AE%B0%E5%BD%952.png"></p><ul><li>å®Œæˆæ·»åŠ åçš„æ•ˆæœ</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo2_6_%E8%A7%A3%E6%9E%90%E6%B7%BB%E5%8A%A0%E8%AE%B0%E5%BD%953.png"></p><h2 id="3-è®¾ç½®CNAME"><a href="#3-è®¾ç½®CNAME" class="headerlink" title="3. è®¾ç½®CNAME"></a>3. è®¾ç½®CNAME</h2><p>åœ¨é¡¹ç›®ä¸‹ï¼Œsource æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»º CNAME æ–‡ä»¶ï¼ˆæ²¡æœ‰åç¼€åçš„ï¼‰</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo2_7_CNAME%E6%96%87%E4%BB%B6.png"></p><p>ç„¶åå¡«å†™ä¸ŠåŸŸåã€‚æ¯”å¦‚ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo2_8_CNAME%E6%96%87%E4%BB%B6.png"></p><h2 id="4-æ›´æ–°å¹¶é‡æ–°éƒ¨ç½²"><a href="#4-æ›´æ–°å¹¶é‡æ–°éƒ¨ç½²" class="headerlink" title="4. æ›´æ–°å¹¶é‡æ–°éƒ¨ç½²"></a>4. æ›´æ–°å¹¶é‡æ–°éƒ¨ç½²</h2><p>ä¸€ä¸‹æŒ‡ä»¤çš„å…·ä½“è§£é‡Šè§è¿™ç¯‡åšå®¢ï¼š<a href="http://lihengxu.cn/2020/08/21/HEXO%E6%A1%86%E6%9E%B6%20%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">HEXOæ¡†æ¶ ä¸ªäººåšå®¢æ­å»º</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean # æ¸…ç†ç¼“å­˜<br>hexo g # è§£æç”Ÿæˆ<br>hexo s # è¿è¡ŒhexoæœåŠ¡é¢„è§ˆ<br>hexo d # éƒ¨ç½²åˆ°github<br></code></pre></td></tr></table></figure><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<br>[1]  <a href="https://my.oschina.net/leonadmin/blog/4315110">https://my.oschina.net/leonadmin/blog/4315110</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQLåŸºç¡€</title>
    <link href="/2021/03/08/MySQL%E5%9F%BA%E7%A1%80/"/>
    <url>/2021/03/08/MySQL%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h1 id="MySQLåŸºç¡€"><a href="#MySQLåŸºç¡€" class="headerlink" title="MySQLåŸºç¡€"></a>MySQLåŸºç¡€</h1><p><strong>åŸºäº<a href="https://www.bilibili.com/video/BV12b411K7Zu">å°šç¡…è°·MySQLè§†é¢‘</a>çš„å­¦ä¹ ç¬”è®°</strong></p><h2 id="1-åˆè¯†MySQL"><a href="#1-åˆè¯†MySQL" class="headerlink" title="1. åˆè¯†MySQL"></a>1. åˆè¯†MySQL</h2><h3 id="1-1-æ•°æ®åº“ç›¸å…³æ¦‚å¿µ"><a href="#1-1-æ•°æ®åº“ç›¸å…³æ¦‚å¿µ" class="headerlink" title="1.1 æ•°æ®åº“ç›¸å…³æ¦‚å¿µ"></a>1.1 æ•°æ®åº“ç›¸å…³æ¦‚å¿µ</h3><ul><li>æ•°æ®åº“çš„å¸¸è§æ¦‚å¿µ â˜…<br>1ã€DBï¼šæ•°æ®åº“ï¼Œå­˜å‚¨æ•°æ®çš„å®¹å™¨<br>2ã€DBMSï¼šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œåˆç§°ä¸ºæ•°æ®åº“è½¯ä»¶æˆ–æ•°æ®åº“äº§å“ï¼Œç”¨äºåˆ›å»ºæˆ–ç®¡ç†DB<br>3ã€SQLï¼šç»“æ„åŒ–æŸ¥è¯¢è¯­è¨€ï¼Œç”¨äºå’Œæ•°æ®åº“é€šä¿¡çš„è¯­è¨€ï¼Œä¸æ˜¯æŸä¸ªæ•°æ®åº“è½¯ä»¶ç‰¹æœ‰çš„ï¼Œè€Œæ˜¯å‡ ä¹æ‰€æœ‰çš„ä¸»æµæ•°æ®åº“è½¯ä»¶é€šç”¨çš„è¯­è¨€</li><li>æ•°æ®åº“å­˜å‚¨æ•°æ®çš„ç‰¹ç‚¹<br>1ã€æ•°æ®å­˜æ”¾åˆ°è¡¨ä¸­ï¼Œç„¶åè¡¨å†æ”¾åˆ°åº“ä¸­<br>2ã€ä¸€ä¸ªåº“ä¸­å¯ä»¥æœ‰å¤šå¼ è¡¨ï¼Œæ¯å¼ è¡¨å…·æœ‰å”¯ä¸€çš„è¡¨åç”¨æ¥æ ‡è¯†è‡ªå·±<br>3ã€è¡¨ä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ï¼Œ<strong>åˆ—</strong>åˆç§°ä¸ºâ€œ<strong>å­—æ®µ</strong>â€ï¼Œç›¸å½“äºjavaä¸­â€œ<strong>å±æ€§</strong>â€<br>4ã€è¡¨ä¸­çš„<strong>æ¯ä¸€è¡Œæ•°æ®</strong>ï¼Œç›¸å½“äºjavaä¸­â€œ<strong>å¯¹è±¡</strong>â€</li></ul><ul><li>å¸¸è§çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ<br>mysqlã€oracleã€db2ã€sqlserver</li></ul><h3 id="1-2-MySQLä»‹ç»"><a href="#1-2-MySQLä»‹ç»" class="headerlink" title="1.2 MySQLä»‹ç»"></a>1.2 MySQLä»‹ç»</h3><ul><li><p>MySQLçš„èƒŒæ™¯<br>å‰èº«å±äºç‘å…¸çš„ä¸€å®¶å…¬å¸ï¼ŒMySQL AB<br>08å¹´è¢«sunå…¬å¸æ”¶è´­<br>09å¹´sunè¢«oracleæ”¶è´­</p></li><li><p>MySQLçš„ä¼˜ç‚¹</p><ul><li>å¼€æºã€å…è´¹ã€æˆæœ¬ä½</li><li>æ€§èƒ½é«˜ã€ç§»æ¤æ€§ä¹Ÿå¥½</li><li>ä½“ç§¯å°ï¼Œä¾¿äºå®‰è£…</li></ul></li><li><p>MySQLæœåŠ¡çš„å¯åŠ¨å’Œåœæ­¢</p><ul><li>æ–¹å¼ä¸€ï¼šé€šè¿‡å‘½ä»¤è¡Œ<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">net</span> <span class="hljs-built_in">start</span> æœåŠ¡å<br><span class="hljs-built_in">net</span> stop æœåŠ¡å<br></code></pre></td></tr></table></figure></li><li>æ–¹å¼äºŒï¼šè®¡ç®—æœºâ€”â€”å³å‡»â€”â€”ç®¡ç†â€”â€”æœåŠ¡</li></ul></li></ul><ul><li><p>MySQLæœåŠ¡çš„ç™»å½•å’Œé€€å‡º</p><ul><li><p>ç™»å½•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">mysql ã€-h ä¸»æœºå -P ç«¯å£å·ã€‘ -u ç”¨æˆ·å -på¯†ç <br></code></pre></td></tr></table></figure></li><li><p>é€€å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">exit æˆ– ctrl+C<br></code></pre></td></tr></table></figure></li></ul></li></ul><ul><li><p>MySQLçš„å¸¸è§å‘½ä»¤ </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„æ•°æ®åº“<br>show databases;<br># 2.æ‰“å¼€æŒ‡å®šçš„åº“<br>use åº“å<br># 3.æŸ¥çœ‹å½“å‰åº“çš„æ‰€æœ‰è¡¨<br>show tables;<br># 4.æŸ¥çœ‹å…¶å®ƒåº“çš„æ‰€æœ‰è¡¨<br>show tables from åº“å;<br># 5.åˆ›å»ºè¡¨<br>create table è¡¨å(<br>åˆ—å åˆ—ç±»å‹,<br>åˆ—å åˆ—ç±»å‹ï¼Œ<br>...<br>);<br># 6.æŸ¥çœ‹è¡¨ç»“æ„<br>desc è¡¨å;<br># 7.æŸ¥çœ‹æœåŠ¡å™¨çš„ç‰ˆæœ¬<br># æ–¹å¼ä¸€ï¼šç™»å½•åˆ°mysqlæœåŠ¡ç«¯<br>select version();<br># æ–¹å¼äºŒï¼šæ²¡æœ‰ç™»å½•åˆ°mysqlæœåŠ¡ç«¯<br>mysql --version<br># æˆ–<br>mysql --V<br></code></pre></td></tr></table></figure></li><li><p>MySQLçš„è¯­æ³•è§„èŒƒ</p><ol><li><p>ä¸åŒºåˆ†å¤§å°å†™,ä½†å»ºè®®å…³é”®å­—å¤§å†™ï¼Œè¡¨åã€åˆ—åå°å†™</p></li><li><p>æ¯æ¡å‘½ä»¤æœ€å¥½ç”¨åˆ†å·ç»“å°¾</p></li><li><p>æ¯æ¡å‘½ä»¤æ ¹æ®éœ€è¦ï¼Œå¯ä»¥è¿›è¡Œç¼©è¿› æˆ–æ¢è¡Œ</p></li><li><p>æ³¨é‡Š</p><ul><li><p>å•è¡Œæ³¨é‡Šï¼š#æ³¨é‡Šæ–‡å­—</p></li><li><p>å•è¡Œæ³¨é‡Šï¼šâ€“ æ³¨é‡Šæ–‡å­—</p></li><li><p>å¤šè¡Œæ³¨é‡Šï¼š/* æ³¨é‡Šæ–‡å­—  */</p></li></ul></li></ol></li><li><p>SQLçš„è¯­è¨€åˆ†ç±»</p><ul><li>DQLï¼ˆData Query Languageï¼‰ï¼šæ•°æ®æŸ¥è¯¢è¯­è¨€<pre><code>    select </code></pre></li><li>DML(Data Manipulate Language):æ•°æ®æ“ä½œè¯­è¨€<pre><code>    insert ã€updateã€delete</code></pre></li><li>DDLï¼ˆData Define Langugeï¼‰ï¼šæ•°æ®å®šä¹‰è¯­è¨€<pre><code>    createã€dropã€alter</code></pre></li><li>TCLï¼ˆTransaction Control Languageï¼‰ï¼šäº‹åŠ¡æ§åˆ¶è¯­è¨€<pre><code>    commitã€rollback</code></pre></li></ul></li></ul><h2 id="2-DQLè¯­è¨€"><a href="#2-DQLè¯­è¨€" class="headerlink" title="2. DQLè¯­è¨€"></a>2. DQLè¯­è¨€</h2><h3 id="2-1-åŸºç¡€æŸ¥è¯¢"><a href="#2-1-åŸºç¡€æŸ¥è¯¢" class="headerlink" title="2.1 åŸºç¡€æŸ¥è¯¢"></a>2.1 åŸºç¡€æŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ã€æŸ¥è¯¢å•ä¸ªå­—æ®µ<br>select å­—æ®µå from è¡¨å;<br><br># 2ã€æŸ¥è¯¢å¤šä¸ªå­—æ®µ<br>select å­—æ®µåï¼Œå­—æ®µå from è¡¨å;<br><br># 3ã€æŸ¥è¯¢æ‰€æœ‰å­—æ®µ<br>select * from è¡¨å;<br><br># 4ã€æŸ¥è¯¢å¸¸é‡<br># æ³¨æ„ï¼šå­—ç¬¦å‹å’Œæ—¥æœŸå‹çš„å¸¸é‡å€¼å¿…é¡»ç”¨å•å¼•å·å¼•èµ·æ¥ï¼Œæ•°å€¼å‹ä¸éœ€è¦<br>select å¸¸é‡å€¼;<br><br># 5ã€æŸ¥è¯¢å‡½æ•°<br>select å‡½æ•°å(å®å‚åˆ—è¡¨);<br><br># 6ã€æŸ¥è¯¢è¡¨è¾¾å¼<br>select 100&#x2F;1234;<br><br># 7ã€èµ·åˆ«å<br># â‘  as<br># â‘¡ ç©ºæ ¼<br><br># 8ã€å»é‡<br>select distinct å­—æ®µå from è¡¨å;<br><br># 9ã€+<br># ä½œç”¨ï¼šåšåŠ æ³•è¿ç®—<br>select æ•°å€¼+æ•°å€¼;  # ç›´æ¥è¿ç®—<br>select å­—ç¬¦+æ•°å€¼;  # å…ˆè¯•å›¾å°†å­—ç¬¦è½¬æ¢æˆæ•°å€¼ï¼Œå¦‚æœè½¬æ¢æˆåŠŸï¼Œåˆ™ç»§ç»­è¿ç®—ï¼›å¦åˆ™è½¬æ¢æˆ0ï¼Œå†åšè¿ç®—<br>select null+å€¼;  # ç»“æœéƒ½ä¸ºnull<br><br># 10ã€ã€è¡¥å……ã€‘concatå‡½æ•°<br># åŠŸèƒ½ï¼šæ‹¼æ¥å­—ç¬¦<br>select concat(å­—ç¬¦1ï¼Œå­—ç¬¦2ï¼Œå­—ç¬¦3,...);<br><br># 11ã€ã€è¡¥å……ã€‘ifnullå‡½æ•°<br># åŠŸèƒ½ï¼šåˆ¤æ–­æŸå­—æ®µæˆ–è¡¨è¾¾å¼æ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ºnull è¿”å›æŒ‡å®šçš„å€¼ï¼Œå¦åˆ™è¿”å›åŸæœ¬çš„å€¼<br>select ifnull(commission_pct,0) from employees;<br><br># 12ã€ã€è¡¥å……ã€‘isnullå‡½æ•°<br># åŠŸèƒ½ï¼šåˆ¤æ–­æŸå­—æ®µæˆ–è¡¨è¾¾å¼æ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0<br></code></pre></td></tr></table></figure><h3 id="2-2-æ¡ä»¶æŸ¥è¯¢"><a href="#2-2-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="2.2 æ¡ä»¶æŸ¥è¯¢"></a>2.2 æ¡ä»¶æŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.æ¡ä»¶æŸ¥è¯¢çš„åŸºæœ¬ç»“æ„<br>select æŸ¥è¯¢åˆ—è¡¨ from è¡¨å where ç­›é€‰æ¡ä»¶<br><br># 2.ç®€å•æ¡ä»¶è¿ç®—ç¬¦<br>&gt; &lt; &#x3D; &lt;&gt; !&#x3D; &gt;&#x3D; &lt;&#x3D;  <br>&lt;&#x3D;&gt;å®‰å…¨ç­‰äº # å¯ä»¥åˆ¤æ–­nullå€¼<br><br># 3. é€»è¾‘è¿ç®—ç¬¦<br>&amp;&amp; and<br>|| or<br>!  not<br><br># 4ã€æ¨¡ç³ŠæŸ¥è¯¢<br>between and # å·¦å³è¾¹ç•Œä¸èƒ½é¢ å€’é¡ºåº<br>between 120 and 100 # ç­‰ä»·äº &gt;&#x3D; 120 &amp;&amp; &lt;&#x3D; 100 <br><br>in (&#39;&#39;, &#39;&#39;) # inåˆ—è¡¨å€¼ç±»å‹å¿…é¡»ç»Ÿä¸€,ä¸”ä¸æ”¯æŒé€šé…ç¬¦<br>is null &#x2F;is not null  # ç”¨äºåˆ¤æ–­nullå€¼, &#x3D; ä¸èƒ½åˆ¤æ–­null<br>like  # ä¸€èˆ¬æ­é…é€šé…ç¬¦ä½¿ç”¨ï¼Œå¯ä»¥åˆ¤æ–­å­—ç¬¦å‹æˆ–æ•°å€¼å‹ <br><br># 5.é€šé…ç¬¦ï¼š<br>%ï¼šä»»æ„å¤šä¸ªå­—ç¬¦<br>_ï¼šä»»æ„å•ä¸ªå­—ç¬¦<br>é€šé…ç¬¦è½¬ä¹‰ \ æˆ–è€… &#39;_$_&#39; ESCAPE &#39;$&#39;<br><br><br>æ™®é€šç±»å‹çš„æ•°å€¼  nullå€¼   å¯è¯»æ€§<br>is nullÃ—   âˆš      âˆš<br>&lt;&#x3D;&gt;    âˆš   âˆš      Ã—<br></code></pre></td></tr></table></figure><p><font color=#FF0000><strong>ç»å…¸é¢è¯•é¢˜</strong></font> ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mysql">select * from employees;<br>select * from employees where name like &#39;%%&#39; and id like &#39;%%&#39;;<br>ä¸¤ä¸ªæŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œç»“æœæ˜¯å¦ç›¸åŒï¼Ÿ<br>è§£ï¼šä¸ä¸€æ ·ï¼Œè‹¥nameæˆ–è€…idæœ‰nullå€¼åˆ™æŸ¥ä¸å‡ºæ¥<br></code></pre></td></tr></table></figure><h3 id="2-3-æ’åºæŸ¥è¯¢"><a href="#2-3-æ’åºæŸ¥è¯¢" class="headerlink" title="2.3 æ’åºæŸ¥è¯¢"></a>2.3 æ’åºæŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1. æ’åºæŸ¥è¯¢çš„åŸºæœ¬ç»“æ„<br>select æŸ¥è¯¢åˆ—è¡¨<br>from è¡¨<br>where ç­›é€‰æ¡ä»¶<br>order by æ’åºåˆ—è¡¨ [asc&#125;desc]<br><br># 2. ç‰¹ç‚¹<br>&#x2F;*<br>1ã€asc ï¼šå‡åºï¼Œå¦‚æœä¸å†™é»˜è®¤å‡åº<br>   descï¼šé™åº<br>2ã€æ’åºåˆ—è¡¨ æ”¯æŒ å•ä¸ªå­—æ®µã€å¤šä¸ªå­—æ®µã€å‡½æ•°ã€è¡¨è¾¾å¼ã€åˆ«å<br>3ã€order byçš„ä½ç½®ä¸€èˆ¬æ”¾åœ¨æŸ¥è¯¢è¯­å¥çš„æœ€åï¼ˆé™¤limitè¯­å¥ä¹‹å¤–ï¼‰<br>*&#x2F;<br></code></pre></td></tr></table></figure><h3 id="2-4-å¸¸è§å‡½æ•°"><a href="#2-4-å¸¸è§å‡½æ•°" class="headerlink" title="2.4 å¸¸è§å‡½æ•°"></a>2.4 å¸¸è§å‡½æ•°</h3><ul><li>åŠŸèƒ½ï¼šç±»ä¼¼äºjavaä¸­çš„æ–¹æ³•</li><li>å¥½å¤„ï¼šæé«˜é‡ç”¨æ€§å’Œéšè—å®ç°ç»†èŠ‚</li><li>è°ƒç”¨ï¼šselect å‡½æ•°å(å®å‚åˆ—è¡¨);</li></ul><p>å•è¡Œå‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ã€å­—ç¬¦å‡½æ•°<br># concat:è¿æ¥<br># substr:æˆªå–å­ä¸²ï¼Œç´¢å¼•ä»1å¼€å§‹<br># upper:å˜å¤§å†™<br># lowerï¼šå˜å°å†™<br># replaceï¼šæ›¿æ¢<br># lengthï¼šè·å–å­—èŠ‚é•¿åº¦<br># trim:å»å‰åç©ºæ ¼<br># lpadï¼šå·¦å¡«å……<br># rpadï¼šå³å¡«å……<br># instr:è·å–å­ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ç´¢å¼•<br><br>SELECT LENGTH(&#39;john&#39;);<br>SELECT CONCAT(last_name,&#39;_&#39;,first_name) å§“å FROM employees;<br>SELECT UPPER(&#39;john&#39;);<br>SELECT LOWER(&#39;joHn&#39;);<br>SELECT <br>CONCAT(UPPER(last_name),LOWER(first_name))  å§“å <br>FROM employees;<br>SELECT SUBSTR(&#39;æè«æ„çˆ±ä¸Šäº†é™†å±•å…ƒ&#39;,7)  out_put;<br>SELECT SUBSTR(&#39;æè«æ„çˆ±ä¸Šäº†é™†å±•å…ƒ&#39;,1,3) out_put;<br>SELECT CONCAT(UPPER(SUBSTR(last_name,1,1)),&#39;_&#39;,LOWER(SUBSTR(last_name,2)))  out_put<br>FROM employees;<br>SELECT INSTR(&#39;æ¨ä¸æ®·å…­ä¾ æ‚”çˆ±ä¸Šäº†æ®·å…­ä¾ &#39;,&#39;æ®·å…«ä¾ &#39;) AS out_put;<br>SELECT LENGTH(TRIM(&#39;    å¼ ç¿ å±±    &#39;)) AS out_put;<br>SELECT TRIM(&#39;aa&#39; FROM &#39;aaaaaaå¼ aaaaç¿ å±±aaaaa&#39;) AS out_put;<br>SELECT LPAD(&#39;æ®·ç´ ç´ &#39;,2,&#39;*&#39;) AS out_put;<br>SELECT RPAD(&#39;æ®·ç´ ç´ &#39;,12,&#39;ab&#39;) AS out_put;<br>SELECT REPLACE(&#39;å‘¨èŠ·è‹¥å‘¨èŠ·è‹¥å¼ æ— å¿Œçˆ±ä¸Šäº†å‘¨èŠ·è‹¥&#39;,&#39;å‘¨èŠ·è‹¥&#39;,&#39;èµµæ•&#39;) AS out_put;<br><br># 2ã€æ•°å­¦å‡½æ•°<br># ceil:å‘ä¸Šå–æ•´<br># roundï¼šå››èˆäº”å…¥<br># mod:å–æ¨¡<br># floorï¼šå‘ä¸‹å–æ•´<br># truncate:æˆªæ–­<br># rand:è·å–éšæœºæ•°ï¼Œè¿”å›0-1ä¹‹é—´çš„å°æ•°<br>SELECT ROUND(-1.55);<br>SELECT ROUND(1.567,2);<br>SELECT CEIL(-1.02);<br>SELECT FLOOR(-9.99);<br>SELECT TRUNCATE(1.69999,1);<br>#modå–ä½™<br>&#x2F;*<br>mod(a,b) ï¼š  a-a&#x2F;b*b<br>mod(-10,-3):-10- (-10)&#x2F;(-3)*ï¼ˆ-3ï¼‰&#x3D;-1<br>*&#x2F;<br>SELECT MOD(10,-3);<br>SELECT 10%3;<br><br># 3ã€æ—¥æœŸå‡½æ•°<br># nowï¼šè¿”å›å½“å‰æ—¥æœŸ+æ—¶é—´<br># year:è¿”å›å¹´<br># monthï¼šè¿”å›æœˆ<br># day:è¿”å›æ—¥<br># date_format:å°†æ—¥æœŸè½¬æ¢æˆå­—ç¬¦<br># curdate:è¿”å›å½“å‰æ—¥æœŸ<br># str_to_date:å°†å­—ç¬¦è½¬æ¢æˆæ—¥æœŸ<br># curtimeï¼šè¿”å›å½“å‰æ—¶é—´<br># hour:å°æ—¶<br># minute:åˆ†é’Ÿ<br># secondï¼šç§’<br># datediff:è¿”å›ä¸¤ä¸ªæ—¥æœŸç›¸å·®çš„å¤©æ•°<br># monthname:ä»¥è‹±æ–‡å½¢å¼è¿”å›æœˆ<br>SELECT NOW();<br>SELECT CURDATE();<br>SELECT CURTIME();<br>SELECT YEAR(NOW()) å¹´;<br>SELECT YEAR(&#39;1998-1-1&#39;) å¹´;<br>SELECT  YEAR(hiredate) å¹´ FROM employees;<br>SELECT MONTH(NOW()) æœˆ;<br>SELECT MONTHNAME(NOW()) æœˆ;<br>SELECT STR_TO_DATE(&#39;1998-3-2&#39;,&#39;%Y-%c-%d&#39;) AS out_put;<br>#æŸ¥è¯¢å…¥èŒæ—¥æœŸä¸º1992--4-3çš„å‘˜å·¥ä¿¡æ¯<br>SELECT * FROM employees WHERE hiredate &#x3D; &#39;1992-4-3&#39;;<br>SELECT * FROM employees WHERE hiredate &#x3D; STR_TO_DATE(&#39;4-3 1992&#39;,&#39;%c-%d %Y&#39;);<br>SELECT DATE_FORMAT(NOW(),&#39;%yå¹´%mæœˆ%dæ—¥&#39;) AS out_put;<br>#æŸ¥è¯¢æœ‰å¥–é‡‘çš„å‘˜å·¥åå’Œå…¥èŒæ—¥æœŸ(xxæœˆ&#x2F;xxæ—¥ xxå¹´)<br>SELECT last_name,DATE_FORMAT(hiredate,&#39;%mæœˆ&#x2F;%dæ—¥ %yå¹´&#39;) å…¥èŒæ—¥æœŸ<br>FROM employees<br>WHERE commission_pct IS NOT NULL;<br><br># 4ã€å…¶ä»–å‡½æ•°<br># version å½“å‰æ•°æ®åº“æœåŠ¡å™¨çš„ç‰ˆæœ¬<br># database å½“å‰æ‰“å¼€çš„æ•°æ®åº“<br># userå½“å‰ç”¨æˆ·<br># password(&#39;å­—ç¬¦&#39;)ï¼šè¿”å›è¯¥å­—ç¬¦çš„å¯†ç å½¢å¼<br># md5(&#39;å­—ç¬¦&#39;):è¿”å›è¯¥å­—ç¬¦çš„md5åŠ å¯†å½¢å¼<br>SELECT VERSION();<br>SELECT DATABASE();<br>SELECT USER();<br><br>#5ã€æµç¨‹æ§åˆ¶å‡½æ•°<br>&#x2F;*<br>â‘ if(æ¡ä»¶è¡¨è¾¾å¼ï¼Œè¡¨è¾¾å¼1ï¼Œè¡¨è¾¾å¼2)ï¼šå¦‚æœæ¡ä»¶è¡¨è¾¾å¼æˆç«‹ï¼Œè¿”å›è¡¨è¾¾å¼1ï¼Œå¦åˆ™è¿”å›è¡¨è¾¾å¼2<br>â‘¡caseæƒ…å†µ1<br>case å˜é‡æˆ–è¡¨è¾¾å¼æˆ–å­—æ®µ<br>when å¸¸é‡1 then å€¼1<br>when å¸¸é‡2 then å€¼2<br>...<br>else å€¼n<br>end<br><br>â‘¢caseæƒ…å†µ2<br>case <br>when æ¡ä»¶1 then å€¼1<br>when æ¡ä»¶2 then å€¼2<br>...<br>else å€¼n<br>end<br>*&#x2F;<br>SELECT IF(10&lt;5,&#39;å¤§&#39;,&#39;å°&#39;);<br><br>SELECT salary åŸå§‹å·¥èµ„,department_id,<br>CASE department_id<br>WHEN 30 THEN salary*1.1<br>WHEN 40 THEN salary*1.2<br>WHEN 50 THEN salary*1.3<br>ELSE salary<br>END AS æ–°å·¥èµ„<br>FROM employees;<br><br>SELECT salary,<br>CASE <br>WHEN salary&gt;20000 THEN &#39;A&#39;<br>WHEN salary&gt;15000 THEN &#39;B&#39;<br>WHEN salary&gt;10000 THEN &#39;C&#39;<br>ELSE &#39;D&#39;<br>END AS å·¥èµ„çº§åˆ«<br>FROM employees;<br></code></pre></td></tr></table></figure><p>åˆ†ç»„å‡½æ•°(ç»Ÿè®¡å‡½æ•°\èšåˆå‡½æ•°)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.åˆ†ç±»<br>max æœ€å¤§å€¼<br>min æœ€å°å€¼<br>sum å’Œ<br>avg å¹³å‡å€¼<br>count è®¡ç®—ä¸ªæ•°<br><br># 2.ç®€å• çš„ä½¿ç”¨<br>SELECT SUM(salary) FROM employees;<br>SELECT AVG(salary) FROM employees;<br>SELECT MIN(salary) FROM employees;<br>SELECT MAX(salary) FROM employees;<br>SELECT COUNT(salary) FROM employees;<br><br><br>SELECT SUM(salary) å’Œ,AVG(salary) å¹³å‡,MAX(salary) æœ€é«˜,MIN(salary) æœ€ä½,COUNT(salary) ä¸ªæ•°<br>FROM employees;<br><br>SELECT SUM(salary) å’Œ,ROUND(AVG(salary),2) å¹³å‡,MAX(salary) æœ€é«˜,MIN(salary) æœ€ä½,COUNT(salary) ä¸ªæ•°<br>FROM employees;<br><br># 3ã€å‚æ•°æ”¯æŒå“ªäº›ç±»å‹<br># sumå’Œavgä¸€èˆ¬ç”¨äºå¤„ç†æ•°å€¼å‹<br># maxã€minã€countå¯ä»¥å¤„ç†ä»»ä½•æ•°æ®ç±»å‹<br>SELECT SUM(last_name) ,AVG(last_name) FROM employees;<br>SELECT SUM(hiredate) ,AVG(hiredate) FROM employees;<br>SELECT MAX(last_name),MIN(last_name) FROM employees;<br>SELECT MAX(hiredate),MIN(hiredate) FROM employees;<br>SELECT COUNT(commission_pct) FROM employees;<br>SELECT COUNT(last_name) FROM employees;<br><br># 4ã€æ˜¯å¦å¿½ç•¥null(ä»¥ä¸Šåˆ†ç»„å‡½æ•°éƒ½å¿½ç•¥)<br>SELECT SUM(commission_pct) ,AVG(commission_pct),SUM(commission_pct)&#x2F;35,SUM(commission_pct)&#x2F;107 FROM employees;<br><br>SELECT MAX(commission_pct) ,MIN(commission_pct) FROM employees;<br><br>SELECT COUNT(commission_pct) FROM employees;<br>SELECT commission_pct FROM employees;<br><br># 5ã€å’Œdistinctæ­é…<br>SELECT SUM(DISTINCT salary),SUM(salary) FROM employees;<br>SELECT COUNT(DISTINCT salary),COUNT(salary) FROM employees;<br><br># 6ã€countå‡½æ•°çš„è¯¦ç»†ä»‹ç»<br>count(å­—æ®µ)ï¼šç»Ÿè®¡è¯¥å­—æ®µéç©ºå€¼çš„ä¸ªæ•°<br>count(*):ç»Ÿè®¡ç»“æœé›†çš„è¡Œæ•°<br>SELECT COUNT(salary) FROM employees;<br>SELECT COUNT(*) FROM employees;<br>SELECT COUNT(1) FROM employees;<br><br>æ•ˆç‡ï¼š<br>MYISAMå­˜å‚¨å¼•æ“ä¸‹ï¼ŒCOUNT(*)çš„æ•ˆç‡é«˜<br>INNODBå­˜å‚¨å¼•æ“ä¸‹ï¼ŒCOUNT(*)å’ŒCOUNT(1)çš„æ•ˆç‡å·®ä¸å¤šï¼Œæ¯”COUNT(å­—æ®µ)è¦é«˜ä¸€äº›<br><br>#6ã€å’Œåˆ†ç»„å‡½æ•°ä¸€åŒæŸ¥è¯¢çš„å­—æ®µæœ‰é™åˆ¶,è¦æ±‚æ˜¯group byåå‡ºç°çš„å­—æ®µ<br>SELECT AVG(salary),employee_id  FROM employees; # è¿™ä¸ªæŸ¥è¯¢æ²¡æœ‰æ„ä¹‰<br></code></pre></td></tr></table></figure><h3 id="2-5-åˆ†ç»„æŸ¥è¯¢"><a href="#2-5-åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="2.5 åˆ†ç»„æŸ¥è¯¢"></a>2.5 åˆ†ç»„æŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.åˆ†ç»„æŸ¥è¯¢çš„åŸºæœ¬ç»“æ„<br>select åˆ†ç»„å‡½æ•°ï¼Œåˆ†ç»„åçš„å­—æ®µ<br>from è¡¨<br>[where ç­›é€‰æ¡ä»¶]<br>group by åˆ†ç»„çš„å­—æ®µ<br>[having åˆ†ç»„åçš„ç­›é€‰]<br>[order by æ’åºåˆ—è¡¨]<br><br># 2.ç­›é€‰å¯¹æ¯”<br>ä½¿ç”¨å…³é”®å­—ç­›é€‰çš„è¡¨ä½ç½®<br>åˆ†ç»„å‰ç­›é€‰whereåŸå§‹è¡¨ group byçš„å‰é¢<br>åˆ†ç»„åç­›é€‰havingåˆ†ç»„åçš„ç»“æœ   group by çš„åé¢<br><br># 3. å¸¸è§é—®é¢˜<br>1ï¼šåˆ†ç»„å‡½æ•°åšç­›é€‰èƒ½ä¸èƒ½æ”¾åœ¨whereåé¢<br>ç­”ï¼šä¸èƒ½<br><br>2ï¼šwhereâ€”â€”group byâ€”â€”having<br>ç­”ï¼šä¸€èˆ¬æ¥è®²ï¼Œèƒ½ç”¨åˆ†ç»„å‰ç­›é€‰çš„ï¼Œå°½é‡ä½¿ç”¨åˆ†ç»„å‰ç­›é€‰ï¼Œæé«˜æ•ˆç‡<br><br>3ã€åˆ†ç»„å¯ä»¥æŒ‰å•ä¸ªå­—æ®µä¹Ÿå¯ä»¥æŒ‰å¤šä¸ªå­—æ®µ<br>4ã€å¯ä»¥æ­é…ç€æ’åºä½¿ç”¨<br><br># 4. ä¸€äº›ç¤ºä¾‹<br>#æ¡ˆä¾‹1ï¼šæŸ¥è¯¢æ¯ä¸ªå·¥ç§çš„å‘˜å·¥å¹³å‡å·¥èµ„<br>SELECT AVG(salary),job_id<br>FROM employees<br>GROUP BY job_id;<br>#æ¡ˆä¾‹2ï¼šæ¯ä¸ªå·¥ç§æœ‰å¥–é‡‘çš„å‘˜å·¥çš„æœ€é«˜å·¥èµ„&gt;12000çš„å·¥ç§ç¼–å·å’Œæœ€é«˜å·¥èµ„<br>SELECT job_id,MAX(salary)<br>FROM employees<br>WHERE commission_pct IS NOT NULL<br>GROUP BY job_id<br>HAVING MAX(salary)&gt;12000;<br>#æ¡ˆä¾‹3ï¼šæ¯ä¸ªå·¥ç§æœ‰å¥–é‡‘çš„å‘˜å·¥çš„æœ€é«˜å·¥èµ„&gt;6000çš„å·¥ç§ç¼–å·å’Œæœ€é«˜å·¥èµ„,æŒ‰æœ€é«˜å·¥èµ„å‡åº<br>SELECT job_id,MAX(salary) m<br>FROM employees<br>WHERE commission_pct IS NOT NULL<br>GROUP BY job_id<br>HAVING m&gt;6000<br>ORDER BY m ;<br>#æ¡ˆä¾‹4ï¼šæŸ¥è¯¢æ¯ä¸ªå·¥ç§æ¯ä¸ªéƒ¨é—¨çš„æœ€ä½å·¥èµ„,å¹¶æŒ‰æœ€ä½å·¥èµ„é™åº<br>SELECT MIN(salary),job_id,department_id<br>FROM employees<br>GROUP BY department_id,job_id<br>ORDER BY MIN(salary) DESC;<br></code></pre></td></tr></table></figure><h3 id="2-6-è¿æ¥æŸ¥è¯¢"><a href="#2-6-è¿æ¥æŸ¥è¯¢" class="headerlink" title="2.6 è¿æ¥æŸ¥è¯¢"></a>2.6 è¿æ¥æŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.è¿æ¥æŸ¥è¯¢çš„å«ä¹‰ï¼šåˆç§°å¤šè¡¨æŸ¥è¯¢ï¼Œå½“æŸ¥è¯¢çš„å­—æ®µæ¥è‡ªäºå¤šä¸ªè¡¨æ—¶ï¼Œå°±ä¼šç”¨åˆ°è¿æ¥æŸ¥è¯¢<br>    ç¬›å¡å°”ä¹˜ç§¯ç°è±¡ï¼šè¡¨1 æœ‰mè¡Œï¼Œè¡¨2æœ‰nè¡Œï¼Œç»“æœ&#x3D;m*nè¡Œ<br>    å‘ç”ŸåŸå› ï¼šæ²¡æœ‰æœ‰æ•ˆçš„è¿æ¥æ¡ä»¶<br>    å¦‚ä½•é¿å…ï¼šæ·»åŠ æœ‰æ•ˆçš„è¿æ¥æ¡ä»¶<br><br># 2.åˆ†ç±»ï¼š<br># æŒ‰å¹´ä»£åˆ†ç±»ï¼š<br>sql92æ ‡å‡†:ä»…ä»…æ”¯æŒå†…è¿æ¥<br>sql99æ ‡å‡†ã€æ¨èã€‘ï¼šæ”¯æŒå†…è¿æ¥+å¤–è¿æ¥ï¼ˆå·¦å¤–å’Œå³å¤–ï¼‰+äº¤å‰è¿æ¥<br><br># æŒ‰åŠŸèƒ½åˆ†ç±»ï¼š<br>å†…è¿æ¥ï¼š<br>ç­‰å€¼è¿æ¥<br>éç­‰å€¼è¿æ¥<br>è‡ªè¿æ¥<br>å¤–è¿æ¥ï¼š<br>å·¦å¤–è¿æ¥<br>å³å¤–è¿æ¥<br>å…¨å¤–è¿æ¥<br><br>äº¤å‰è¿æ¥<br><br># 3. SQL92è¯­æ³•<br># ç­‰å€¼è¿æ¥<br>select æŸ¥è¯¢åˆ—è¡¨<br>from è¡¨1 åˆ«å,è¡¨2 åˆ«å<br>where è¡¨1.key&#x3D;è¡¨2.key<br>ã€and ç­›é€‰æ¡ä»¶ã€‘<br>ã€group by åˆ†ç»„å­—æ®µã€‘<br>ã€having åˆ†ç»„åçš„ç­›é€‰ã€‘<br>ã€order by æ’åºå­—æ®µã€‘<br><br>â‘  ä¸€èˆ¬ä¸ºè¡¨èµ·åˆ«å<br>â‘¡ å¤šè¡¨çš„é¡ºåºå¯ä»¥è°ƒæ¢<br>â‘¢ nè¡¨è¿æ¥è‡³å°‘éœ€è¦n-1ä¸ªè¿æ¥æ¡ä»¶<br>â‘£ ç­‰å€¼è¿æ¥çš„ç»“æœæ˜¯å¤šè¡¨çš„äº¤é›†éƒ¨åˆ†<br><br><br># éç­‰å€¼è¿æ¥<br>select æŸ¥è¯¢åˆ—è¡¨<br>from è¡¨1 åˆ«å,è¡¨2 åˆ«å<br>where éç­‰å€¼çš„è¿æ¥æ¡ä»¶<br>ã€and ç­›é€‰æ¡ä»¶ã€‘<br>ã€group by åˆ†ç»„å­—æ®µã€‘<br>ã€having åˆ†ç»„åçš„ç­›é€‰ã€‘<br>ã€order by æ’åºå­—æ®µã€‘<br><br># è‡ªè¿æ¥<br>select æŸ¥è¯¢åˆ—è¡¨<br>from è¡¨ åˆ«å1,è¡¨ åˆ«å2<br>where ç­‰å€¼çš„è¿æ¥æ¡ä»¶<br>ã€and ç­›é€‰æ¡ä»¶ã€‘<br>ã€group by åˆ†ç»„å­—æ®µã€‘<br>ã€having åˆ†ç»„åçš„ç­›é€‰ã€‘<br>ã€order by æ’åºå­—æ®µã€‘<br><br><br># 4.SQL99è¯­æ³•<br>    # å†…è¿æ¥<br>    - è¯­æ³•ï¼š<br>    select æŸ¥è¯¢åˆ—è¡¨<br>    from è¡¨1 åˆ«å<br>    ã€innerã€‘ join è¡¨2 åˆ«å on è¿æ¥æ¡ä»¶<br>    where ç­›é€‰æ¡ä»¶<br>    group by åˆ†ç»„åˆ—è¡¨<br>    having åˆ†ç»„åçš„ç­›é€‰<br>    order by æ’åºåˆ—è¡¨<br>    limit å­å¥;<br>    - ç‰¹ç‚¹ï¼š<br>    â‘  è¡¨çš„é¡ºåºå¯ä»¥è°ƒæ¢<br>    â‘¡ å†…è¿æ¥çš„ç»“æœ&#x3D;å¤šè¡¨çš„äº¤é›†<br>    â‘¢ nè¡¨è¿æ¥è‡³å°‘éœ€è¦n-1ä¸ªè¿æ¥æ¡ä»¶<br>    - åˆ†ç±»ï¼š<br>    ç­‰å€¼è¿æ¥<br>    éç­‰å€¼è¿æ¥<br>    è‡ªè¿æ¥<br><br>    # å¤–è¿æ¥<br>    - è¯­æ³•ï¼š<br>    select æŸ¥è¯¢åˆ—è¡¨<br>    from è¡¨1 åˆ«å<br>    left|right|fullã€outerã€‘ join è¡¨2 åˆ«å on è¿æ¥æ¡ä»¶<br>    where ç­›é€‰æ¡ä»¶<br>    group by åˆ†ç»„åˆ—è¡¨<br>    having åˆ†ç»„åçš„ç­›é€‰<br>    order by æ’åºåˆ—è¡¨<br>    limit å­å¥;<br>    - ç‰¹ç‚¹ï¼š<br>    â‘  æŸ¥è¯¢çš„ç»“æœ&#x3D;ä¸»è¡¨ä¸­æ‰€æœ‰çš„è¡Œï¼Œå¦‚æœä»è¡¨å’Œå®ƒåŒ¹é…çš„å°†æ˜¾ç¤ºåŒ¹é…è¡Œï¼Œå¦‚æœä»è¡¨æ²¡æœ‰åŒ¹é…çš„åˆ™æ˜¾ç¤ºnull<br>    â‘¡ left join å·¦è¾¹çš„å°±æ˜¯ä¸»è¡¨<br>      right join å³è¾¹çš„å°±æ˜¯ä¸»è¡¨<br>      full join ä¸¤è¾¹éƒ½æ˜¯ä¸»è¡¨<br>    â‘¢ ä¸€èˆ¬ç”¨äºæŸ¥è¯¢é™¤äº†äº¤é›†éƒ¨åˆ†çš„å‰©ä½™çš„ä¸åŒ¹é…çš„è¡Œ<br><br>    # äº¤å‰è¿æ¥<br>    - è¯­æ³•ï¼š<br>    select æŸ¥è¯¢åˆ—è¡¨<br>    from è¡¨1 åˆ«å<br>    cross join è¡¨2 åˆ«å;<br>    - ç‰¹ç‚¹ï¼š<br>    ç±»ä¼¼äºç¬›å¡å°”ä¹˜ç§¯<br></code></pre></td></tr></table></figure><h3 id="2-7-å­æŸ¥è¯¢"><a href="#2-7-å­æŸ¥è¯¢" class="headerlink" title="2.7 å­æŸ¥è¯¢"></a>2.7 å­æŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1. å­æŸ¥è¯¢çš„å«ä¹‰<br>å‡ºç°åœ¨å…¶ä»–è¯­å¥ä¸­çš„selectè¯­å¥ï¼Œç§°ä¸ºå­æŸ¥è¯¢æˆ–å†…æŸ¥è¯¢<br>å¤–éƒ¨çš„æŸ¥è¯¢è¯­å¥ï¼Œç§°ä¸ºä¸»æŸ¥è¯¢æˆ–å¤–æŸ¥è¯¢<br><br># 2. åˆ†ç±»ï¼š<br>    # æŒ‰å­æŸ¥è¯¢å‡ºç°çš„ä½ç½®ï¼š<br>        selectåé¢ï¼š<br>            ä»…ä»…æ”¯æŒæ ‡é‡å­æŸ¥è¯¢<br><br>        fromåé¢ï¼š<br>            æ”¯æŒè¡¨å­æŸ¥è¯¢<br>        whereæˆ–havingåé¢ï¼šâ˜…<br>            æ ‡é‡å­æŸ¥è¯¢ï¼ˆå•è¡Œï¼‰ âˆš<br>            åˆ—å­æŸ¥è¯¢  ï¼ˆå¤šè¡Œï¼‰ âˆš<br>            è¡Œå­æŸ¥è¯¢<br><br>        existsåé¢ï¼ˆç›¸å…³å­æŸ¥è¯¢ï¼‰<br>            è¡¨å­æŸ¥è¯¢<br><br>    # æŒ‰ç»“æœé›†çš„è¡Œåˆ—æ•°ä¸åŒï¼š<br>        æ ‡é‡å­æŸ¥è¯¢ï¼ˆç»“æœé›†åªæœ‰ä¸€è¡Œä¸€åˆ—ï¼‰<br>        åˆ—å­æŸ¥è¯¢ï¼ˆç»“æœé›†åªæœ‰ä¸€åˆ—å¤šè¡Œï¼‰<br>        è¡Œå­æŸ¥è¯¢ï¼ˆç»“æœé›†æœ‰ä¸€è¡Œå¤šåˆ—ï¼‰<br>        è¡¨å­æŸ¥è¯¢ï¼ˆç»“æœé›†ä¸€èˆ¬ä¸ºå¤šè¡Œå¤šåˆ—ï¼‰<br><br># 3. ç¤ºä¾‹<br># 3.1 whereæˆ–havingåé¢<br>ç‰¹ç‚¹ï¼š<br>â‘  å­æŸ¥è¯¢æ”¾åœ¨å°æ‹¬å·å†…<br>â‘¡ å­æŸ¥è¯¢ä¸€èˆ¬æ”¾åœ¨æ¡ä»¶çš„å³ä¾§<br>â‘¢ æ ‡é‡å­æŸ¥è¯¢ï¼Œä¸€èˆ¬æ­é…ç€å•è¡Œæ“ä½œç¬¦ä½¿ç”¨<br>&gt; &lt; &gt;&#x3D; &lt;&#x3D; &#x3D; &lt;&gt;<br>åˆ—å­æŸ¥è¯¢ï¼Œä¸€èˆ¬æ­é…ç€å¤šè¡Œæ“ä½œç¬¦ä½¿ç”¨<br>inã€any&#x2F;someã€all<br><br>â‘£ å­æŸ¥è¯¢çš„æ‰§è¡Œä¼˜å…ˆäºä¸»æŸ¥è¯¢æ‰§è¡Œï¼Œä¸»æŸ¥è¯¢çš„æ¡ä»¶ç”¨åˆ°äº†å­æŸ¥è¯¢çš„ç»“æœ<br><br>    # æ ‡é‡å­æŸ¥è¯¢<br>    æ¡ˆä¾‹ï¼šæŸ¥è¯¢æœ€ä½å·¥èµ„çš„å‘˜å·¥å§“åå’Œå·¥èµ„<br>    â‘  æœ€ä½å·¥èµ„<br>    select min(salary) from employees<br>    â‘¡ æŸ¥è¯¢å‘˜å·¥çš„å§“åå’Œå·¥èµ„ï¼Œè¦æ±‚å·¥èµ„&#x3D;â‘ <br>    select last_name,salary<br>    from employees<br>    where salary&#x3D;(<br>        select min(salary) from employees<br>    );<br><br>    # åˆ—å­æŸ¥è¯¢ â˜…<br>    æ¡ˆä¾‹ï¼šæŸ¥è¯¢æ‰€æœ‰æ˜¯é¢†å¯¼çš„å‘˜å·¥å§“å<br>    â‘  æŸ¥è¯¢æ‰€æœ‰å‘˜å·¥çš„ manager_id<br>    select manager_id<br>    from employees<br>    â‘¡ æŸ¥è¯¢å§“åï¼Œemployee_idå±äºâ‘ åˆ—è¡¨çš„ä¸€ä¸ª<br>    select last_name<br>    from employees<br>    where employee_id in(<br>        select manager_id<br>        from employees<br>    );<br>    <br>    # è¡Œå­æŸ¥è¯¢ï¼ˆäº†è§£ï¼‰<br>æ¡ˆä¾‹ï¼šæŸ¥è¯¢å‘˜å·¥ç¼–å·æœ€å°å¹¶ä¸”å·¥èµ„æœ€é«˜çš„å‘˜å·¥ä¿¡æ¯<br>    SELECT * <br>    FROM employees<br>    WHERE (employee_id,salary)&#x3D;(<br>        SELECT MIN(employee_id),MAX(salary)<br>        FROM employees<br>    );<br>    â‘  æŸ¥è¯¢æœ€å°çš„å‘˜å·¥ç¼–å·<br>    SELECT MIN(employee_id)<br>    FROM employees<br>â‘¡ æŸ¥è¯¢æœ€é«˜å·¥èµ„<br>    SELECT MAX(salary)<br>    FROM employees<br>    â‘¢ æŸ¥è¯¢å‘˜å·¥ä¿¡æ¯<br>    SELECT *<br>    FROM employees<br>    WHERE employee_id&#x3D;(<br>        SELECT MIN(employee_id)<br>        FROM employees<br>    )AND salary&#x3D;(<br>        SELECT MAX(salary)<br>        FROM employees<br>    );<br>    <br># 3.2 selectåé¢<br>ä»…ä»…æ”¯æŒæ ‡é‡å­æŸ¥è¯¢<br>    #æ¡ˆä¾‹ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å‘˜å·¥ä¸ªæ•°<br>    SELECT d.*,(<br>        SELECT COUNT(*)<br>        FROM employees e<br>        WHERE e.department_id &#x3D; d.&#96;department_id&#96;<br>     ) ä¸ªæ•°<br>     FROM departments d;<br><br><br># 3.3 fromåé¢<br>å°†å­æŸ¥è¯¢ç»“æœå……å½“ä¸€å¼ è¡¨ï¼Œè¦æ±‚å¿…é¡»èµ·åˆ«å<br>    #æ¡ˆä¾‹ï¼šæŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„çš„å·¥èµ„ç­‰çº§<br>    â‘  æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„<br>    SELECT AVG(salary),department_id<br>    FROM employees<br>    GROUP BY department_id<br>    SELECT * FROM job_grades;<br><br>    â‘¡ è¿æ¥â‘ çš„ç»“æœé›†å’Œjob_gradesè¡¨ï¼Œç­›é€‰æ¡ä»¶å¹³å‡å·¥èµ„ between lowest_sal and highest_sal<br>    SELECT  ag_dep.*,g.&#96;grade_level&#96;<br>    FROM (<br>        SELECT AVG(salary) ag,department_id<br>        FROM employees<br>        GROUP BY department_id<br>    ) ag_dep<br>    INNER JOIN job_grades g<br>    ON ag_dep.ag BETWEEN lowest_sal AND highest_sal;<br><br><br># 3.4 existsåé¢ï¼ˆç›¸å…³å­æŸ¥è¯¢ï¼‰<br>è¯­æ³•ï¼š<br>exists(å®Œæ•´çš„æŸ¥è¯¢è¯­å¥)<br>ç»“æœï¼š<br>1æˆ–0<br><br>SELECT EXISTS(SELECT employee_id FROM employees WHERE salary&#x3D;300000);<br><br>    #æ¡ˆä¾‹ï¼šæŸ¥è¯¢æœ‰å‘˜å·¥çš„éƒ¨é—¨å<br>    #in<br>    SELECT department_name<br>    FROM departments d<br>    WHERE d.&#96;department_id&#96; IN(<br>        SELECT department_id<br>        FROM employees<br>    )<br>    #exists<br>    SELECT department_name<br>    FROM departments d<br>    WHERE EXISTS(<br>        SELECT *<br>        FROM employees e<br>        WHERE d.&#96;department_id&#96;&#x3D;e.&#96;department_id&#96;<br>    );<br></code></pre></td></tr></table></figure><h3 id="2-8-åˆ†é¡µæŸ¥è¯¢"><a href="#2-8-åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="2.8 åˆ†é¡µæŸ¥è¯¢"></a>2.8 åˆ†é¡µæŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1. åˆ†é¡µæŸ¥è¯¢<br>select æŸ¥è¯¢åˆ—è¡¨<br>from è¡¨<br>[join type join è¡¨2<br>on è¿æ¥æ¡ä»¶<br>where ç­›é€‰æ¡ä»¶<br>group by åˆ†ç»„å­—æ®µ<br>having åˆ†ç»„åçš„ç­›é€‰<br>order by æ’åºçš„å­—æ®µ]<br>limit [offsetï¼Œ] size;<br><br># 2. æ³¨æ„<br>offsetä»£è¡¨çš„æ˜¯èµ·å§‹çš„æ¡ç›®ç´¢å¼•ï¼Œé»˜è®¤ä»0å¼€å§‹<br>sizeä»£è¡¨çš„æ˜¯æ˜¾ç¤ºçš„æ¡ç›®æ•°<br><br># 3. å…¬å¼<br>å‡å¦‚è¦æ˜¾ç¤ºçš„é¡µæ•°ä¸ºpageï¼Œæ¯ä¸€é¡µæ¡ç›®æ•°ä¸ºsize<br>select æŸ¥è¯¢åˆ—è¡¨<br>from è¡¨<br>limit (page-1)*size,size;<br></code></pre></td></tr></table></figure><h3 id="2-9-è”åˆæŸ¥è¯¢"><a href="#2-9-è”åˆæŸ¥è¯¢" class="headerlink" title="2.9 è”åˆæŸ¥è¯¢"></a>2.9 è”åˆæŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1. è”åˆæŸ¥è¯¢: å°†å¤šæ¡æŸ¥è¯¢è¯­å¥çš„ç»“æœåˆå¹¶æˆä¸€ä¸ªç»“æœ<br>æŸ¥è¯¢è¯­å¥1<br>union<br>æŸ¥è¯¢è¯­å¥2<br>union<br>...<br><br># 2. åº”ç”¨åœºæ™¯ï¼š<br>è¦æŸ¥è¯¢çš„ç»“æœæ¥è‡ªäºå¤šä¸ªè¡¨ï¼Œä¸”å¤šä¸ªè¡¨æ²¡æœ‰ç›´æ¥çš„è¿æ¥å…³ç³»ï¼Œä½†æŸ¥è¯¢çš„ä¿¡æ¯ä¸€è‡´æ—¶<br><br># 3. ç‰¹ç‚¹ï¼šâ˜…<br>3.1 è¦æ±‚å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢åˆ—æ•°æ˜¯ä¸€è‡´çš„ï¼<br>3.2 è¦æ±‚å¤šæ¡æŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢çš„æ¯ä¸€åˆ—çš„ç±»å‹å’Œé¡ºåºæœ€å¥½ä¸€è‡´<br>3.3 unionå…³é”®å­—é»˜è®¤å»é‡ï¼Œå¦‚æœä½¿ç”¨union all å¯ä»¥åŒ…å«é‡å¤é¡¹<br><br># 4.æ¡ˆä¾‹ï¼šæŸ¥è¯¢éƒ¨é—¨ç¼–å·&gt;90æˆ–é‚®ç®±åŒ…å«açš„å‘˜å·¥ä¿¡æ¯<br>SELECT * FROM employees WHERE email LIKE &#39;%a%&#39; OR department_id&gt;90;;<br>SELECT * FROM employees  WHERE email LIKE &#39;%a%&#39;<br>UNION<br>SELECT * FROM employees  WHERE department_id&gt;90;<br></code></pre></td></tr></table></figure><h3 id="2-10-æŸ¥è¯¢è¯­å¥æ€»ç»“"><a href="#2-10-æŸ¥è¯¢è¯­å¥æ€»ç»“" class="headerlink" title="2.10 æŸ¥è¯¢è¯­å¥æ€»ç»“"></a>2.10 æŸ¥è¯¢è¯­å¥æ€»ç»“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># è¯­æ³•ä»¥åŠæ‰§è¡Œé¡ºåº<br>select æŸ¥è¯¢åˆ—è¡¨    â‘¦<br>from è¡¨1 åˆ«å       â‘ <br>è¿æ¥ç±»å‹ join è¡¨2   â‘¡<br>on è¿æ¥æ¡ä»¶         â‘¢<br>where ç­›é€‰          â‘£<br>group by åˆ†ç»„åˆ—è¡¨   â‘¤<br>having ç­›é€‰         â‘¥<br>order byæ’åºåˆ—è¡¨    â‘§<br>limit èµ·å§‹æ¡ç›®ç´¢å¼•ï¼Œæ¡ç›®æ•°;  â‘¨<br></code></pre></td></tr></table></figure><h2 id="3-DMLè¯­è¨€"><a href="#3-DMLè¯­è¨€" class="headerlink" title="3. DMLè¯­è¨€"></a>3. DMLè¯­è¨€</h2><blockquote><p>æ•°æ®æ“ä½œè¯­è¨€ï¼š</p><p>æ’å…¥ï¼šinsert</p><p>ä¿®æ”¹ï¼šupdate</p><p>åˆ é™¤ï¼šdelete</p></blockquote><h3 id="3-1-æ’å…¥è¯­å¥"><a href="#3-1-æ’å…¥è¯­å¥" class="headerlink" title="3.1 æ’å…¥è¯­å¥"></a>3.1 æ’å…¥è¯­å¥</h3><p>æ–¹å¼ä¸€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># è¯­æ³•<br>insert into è¡¨å(åˆ—å) values(å€¼1,...);<br><br># 1.æ’å…¥çš„å€¼çš„ç±»å‹è¦ä¸åˆ—çš„ç±»å‹ä¸€è‡´æˆ–å…¼å®¹<br>INSERT INTO beauty(id,NAME,sex,borndate,phone,photo,boyfriend_id)<br>VALUES(13,&#39;å”è‰ºæ˜•&#39;,&#39;å¥³&#39;,&#39;1990-4-23&#39;,&#39;1898888888&#39;,NULL,2);<br><br># 2.ä¸å¯ä»¥ä¸ºnullçš„åˆ—å¿…é¡»æ’å…¥å€¼ã€‚å¯ä»¥ä¸ºnullçš„åˆ—å¦‚ä½•æ’å…¥å€¼ï¼Ÿ<br># 2.1ï¼š<br>INSERT INTO beauty(id,NAME,sex,borndate,phone,photo,boyfriend_id)<br>VALUES(13,&#39;å”è‰ºæ˜•&#39;,&#39;å¥³&#39;,&#39;1990-4-23&#39;,&#39;1898888888&#39;,NULL,2);<br># 2.2ï¼š<br>INSERT INTO beauty(id,NAME,sex,phone)<br>VALUES(15,&#39;å¨œæ‰&#39;,&#39;å¥³&#39;,&#39;1388888888&#39;);<br><br># 3.åˆ—çš„é¡ºåºæ˜¯å¦å¯ä»¥è°ƒæ¢<br>INSERT INTO beauty(NAME,sex,id,phone)<br>VALUES(&#39;è’‹æ¬£&#39;,&#39;å¥³&#39;,16,&#39;110&#39;);<br><br># 4.åˆ—æ•°å’Œå€¼çš„ä¸ªæ•°å¿…é¡»ä¸€è‡´<br>INSERT INTO beauty(NAME,sex,id,phone)<br>VALUES(&#39;å…³æ™“å½¤&#39;,&#39;å¥³&#39;,17,&#39;110&#39;);<br><br># 5.å¯ä»¥çœç•¥åˆ—åï¼Œé»˜è®¤æ‰€æœ‰åˆ—ï¼Œè€Œä¸”åˆ—çš„é¡ºåºå’Œè¡¨ä¸­åˆ—çš„é¡ºåºä¸€è‡´<br>INSERT INTO beauty<br>VALUES(18,&#39;å¼ é£&#39;,&#39;ç”·&#39;,NULL,&#39;119&#39;,NULL,NULL);<br></code></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># è¯­æ³•ï¼š<br>insert into è¡¨å<br>set åˆ—å&#x3D;å€¼,åˆ—å&#x3D;å€¼,...<br><br># ç¤ºä¾‹<br>INSERT INTO beauty<br>SET id&#x3D;19, NAME&#x3D;&#39;åˆ˜æ¶›&#39;, phone&#x3D;&#39;999&#39;;<br></code></pre></td></tr></table></figure><p>å¯¹æ¯”ä¸¤ç§æ–¹å¼:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ã€æ–¹å¼ä¸€æ”¯æŒæ’å…¥å¤šè¡Œ,æ–¹å¼äºŒä¸æ”¯æŒ<br>INSERT INTO beauty<br>VALUES(23,&#39;å”è‰ºæ˜•1&#39;,&#39;å¥³&#39;,&#39;1990-4-23&#39;,&#39;1898888888&#39;,NULL,2)<br>,(24,&#39;å”è‰ºæ˜•2&#39;,&#39;å¥³&#39;,&#39;1990-4-23&#39;,&#39;1898888888&#39;,NULL,2)<br>,(25,&#39;å”è‰ºæ˜•3&#39;,&#39;å¥³&#39;,&#39;1990-4-23&#39;,&#39;1898888888&#39;,NULL,2);<br><br># 2ã€æ–¹å¼ä¸€æ”¯æŒå­æŸ¥è¯¢ï¼Œæ–¹å¼äºŒä¸æ”¯æŒ<br>INSERT INTO beauty(id,NAME,phone)<br>SELECT 26,&#39;å®‹èŒœ&#39;,&#39;11809866&#39;;<br><br>INSERT INTO beauty(id,NAME,phone)<br>SELECT id,boyname,&#39;1234567&#39;<br>FROM boys WHERE id&lt;3;<br></code></pre></td></tr></table></figure><h3 id="3-2-ä¿®æ”¹è¯­å¥"><a href="#3-2-ä¿®æ”¹è¯­å¥" class="headerlink" title="3.2 ä¿®æ”¹è¯­å¥"></a>3.2 ä¿®æ”¹è¯­å¥</h3><p>è¯­æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.ä¿®æ”¹å•è¡¨çš„è®°å½•â˜…<br>update è¡¨å<br>set åˆ—&#x3D;æ–°å€¼,åˆ—&#x3D;æ–°å€¼,...<br>where ç­›é€‰æ¡ä»¶;<br><br># 2.ä¿®æ”¹å¤šè¡¨çš„è®°å½•ã€è¡¥å……ã€‘<br># sql92è¯­æ³•ï¼š<br>update è¡¨1 åˆ«å,è¡¨2 åˆ«å<br>set åˆ—&#x3D;å€¼,...<br>where è¿æ¥æ¡ä»¶<br>and ç­›é€‰æ¡ä»¶;<br># sql99è¯­æ³•ï¼š<br>update è¡¨1 åˆ«å<br>inner|left|right join è¡¨2 åˆ«å<br>on è¿æ¥æ¡ä»¶<br>set åˆ—&#x3D;å€¼,...<br>where ç­›é€‰æ¡ä»¶;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#1.ä¿®æ”¹å•è¡¨çš„è®°å½•<br>#æ¡ˆä¾‹1ï¼šä¿®æ”¹beautyè¡¨ä¸­å§“å”çš„å¥³ç¥çš„ç”µè¯ä¸º13899888899<br>UPDATE beauty SET phone &#x3D; &#39;13899888899&#39;<br>WHERE NAME LIKE &#39;å”%&#39;;<br>#æ¡ˆä¾‹2ï¼šä¿®æ”¹boysè¡¨ä¸­idå¥½ä¸º2çš„åç§°ä¸ºå¼ é£ï¼Œé­…åŠ›å€¼ 10<br>UPDATE boys SET boyname&#x3D;&#39;å¼ é£&#39;,usercp&#x3D;10<br>WHERE id&#x3D;2;<br><br>#2.ä¿®æ”¹å¤šè¡¨çš„è®°å½•<br>#æ¡ˆä¾‹ 1ï¼šä¿®æ”¹å¼ æ— å¿Œçš„å¥³æœ‹å‹çš„æ‰‹æœºå·ä¸º114<br>UPDATE boys bo<br>INNER JOIN beauty b ON bo.&#96;id&#96;&#x3D;b.&#96;boyfriend_id&#96;<br>SET b.&#96;phone&#96;&#x3D;&#39;119&#39;,bo.&#96;userCP&#96;&#x3D;1000<br>WHERE bo.&#96;boyName&#96;&#x3D;&#39;å¼ æ— å¿Œ&#39;;<br>#æ¡ˆä¾‹2ï¼šä¿®æ”¹æ²¡æœ‰ç”·æœ‹å‹çš„å¥³ç¥çš„ç”·æœ‹å‹ç¼–å·éƒ½ä¸º2å·<br>UPDATE boys bo<br>RIGHT JOIN beauty b ON bo.&#96;id&#96;&#x3D;b.&#96;boyfriend_id&#96;<br>SET b.&#96;boyfriend_id&#96;&#x3D;2<br>WHERE bo.&#96;id&#96; IS NULL;<br>SELECT * FROM boys;<br></code></pre></td></tr></table></figure><h3 id="3-3-åˆ é™¤è¯­å¥"><a href="#3-3-åˆ é™¤è¯­å¥" class="headerlink" title="3.3 åˆ é™¤è¯­å¥"></a>3.3 åˆ é™¤è¯­å¥</h3><p> æ–¹å¼ä¸€ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ã€å•è¡¨çš„åˆ é™¤ã€â˜…ã€‘<br>delete from è¡¨å where ç­›é€‰æ¡ä»¶<br><br># 2ã€å¤šè¡¨çš„åˆ é™¤ã€è¡¥å……ã€‘<br># sql92è¯­æ³•ï¼š<br>delete è¡¨1çš„åˆ«å,è¡¨2çš„åˆ«å<br>from è¡¨1 åˆ«å,è¡¨2 åˆ«å<br>where è¿æ¥æ¡ä»¶<br>and ç­›é€‰æ¡ä»¶;<br># sql99è¯­æ³•ï¼š<br>delete è¡¨1çš„åˆ«å,è¡¨2çš„åˆ«å<br>from è¡¨1 åˆ«å<br>inner|left|right join è¡¨2 åˆ«å on è¿æ¥æ¡ä»¶<br>where ç­›é€‰æ¡ä»¶;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.å•è¡¨çš„åˆ é™¤<br># æ¡ˆä¾‹ï¼šåˆ é™¤æ‰‹æœºå·ä»¥9ç»“å°¾çš„å¥³ç¥ä¿¡æ¯<br>DELETE FROM beauty WHERE phone LIKE &#39;%9&#39;;<br><br># 2.å¤šè¡¨çš„åˆ é™¤<br># æ¡ˆä¾‹ï¼šåˆ é™¤å¼ æ— å¿Œçš„å¥³æœ‹å‹çš„ä¿¡æ¯<br>DELETE b<br>FROM beauty b<br>INNER JOIN boys bo ON b.&#96;boyfriend_id&#96; &#x3D; bo.&#96;id&#96;<br>WHERE bo.&#96;boyName&#96;&#x3D;&#39;å¼ æ— å¿Œ&#39;;<br># æ¡ˆä¾‹ï¼šåˆ é™¤é»„æ™“æ˜çš„ä¿¡æ¯ä»¥åŠä»–å¥³æœ‹å‹çš„ä¿¡æ¯<br>DELETE b,bo<br>FROM beauty b<br>INNER JOIN boys bo ON b.&#96;boyfriend_id&#96;&#x3D;bo.&#96;id&#96;<br>WHERE bo.&#96;boyName&#96;&#x3D;&#39;é»„æ™“æ˜&#39;;<br></code></pre></td></tr></table></figure><p>æ–¹å¼äºŒï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># è¯­æ³•ï¼š<br>truncate table è¡¨å;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ¡ˆä¾‹ï¼šå°†é­…åŠ›å€¼&gt;100çš„ç”·ç¥ä¿¡æ¯åˆ é™¤<br>TRUNCATE TABLE boys ;<br></code></pre></td></tr></table></figure><p><font color=#FF0000><strong>delete å¯¹æ¯” truncate</strong>  [é¢è¯•é¢˜]</font> </p><blockquote><ol><li><p>delete å¯ä»¥åŠ where æ¡ä»¶ï¼Œtruncateä¸èƒ½åŠ </p></li><li><p>truncateåˆ é™¤ï¼Œæ•ˆç‡é«˜ä¸€ä¸¢ä¸¢</p></li><li><p>å‡å¦‚è¦åˆ é™¤çš„è¡¨ä¸­æœ‰è‡ªå¢é•¿åˆ—ï¼Œå¦‚æœç”¨deleteåˆ é™¤åï¼Œå†æ’å…¥æ•°æ®ï¼Œè‡ªå¢é•¿åˆ—çš„å€¼ä»æ–­ç‚¹å¼€å§‹ï¼Œè€Œtruncateåˆ é™¤åï¼Œå†æ’å…¥æ•°æ®ï¼Œè‡ªå¢é•¿åˆ—çš„å€¼ä»1å¼€å§‹ã€‚</p></li><li><p>truncateåˆ é™¤æ²¡æœ‰è¿”å›å€¼ï¼Œdeleteåˆ é™¤æœ‰è¿”å›å€¼</p></li><li><p>truncateåˆ é™¤ä¸èƒ½å›æ»šï¼Œdeleteåˆ é™¤å¯ä»¥å›æ»š.</p></li></ol></blockquote><h2 id="4-DDLè¯­è¨€"><a href="#4-DDLè¯­è¨€" class="headerlink" title="4. DDLè¯­è¨€"></a>4. DDLè¯­è¨€</h2><p>æ•°æ®å®šä¹‰è¯­è¨€    â€“&gt;   åº“å’Œè¡¨çš„ç®¡ç†</p><blockquote><p>ä¸€ã€åº“çš„ç®¡ç†<br>åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤</p><p>äºŒã€è¡¨çš„ç®¡ç†<br>åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤</p></blockquote><p>åˆ›å»ºï¼š create<br>ä¿®æ”¹ï¼š alter<br>åˆ é™¤ï¼š drop</p><h3 id="4-1-åº“çš„ç®¡ç†"><a href="#4-1-åº“çš„ç®¡ç†" class="headerlink" title="4.1 åº“çš„ç®¡ç†"></a>4.1 åº“çš„ç®¡ç†</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#1ã€åº“çš„åˆ›å»º<br>create database  [if not exists]åº“å;<br>#æ¡ˆä¾‹ï¼šåˆ›å»ºåº“Books<br>CREATE DATABASE IF NOT EXISTS books ;<br><br>#2ã€åº“çš„ä¿®æ”¹<br>RENAME DATABASE books TO æ–°åº“å;<br>#æ›´æ”¹åº“çš„å­—ç¬¦é›†<br>ALTER DATABASE books CHARACTER SET gbk;<br><br>#3ã€åº“çš„åˆ é™¤<br>DROP DATABASE IF EXISTS books;<br></code></pre></td></tr></table></figure><h3 id="4-2-è¡¨çš„ç®¡ç†"><a href="#4-2-è¡¨çš„ç®¡ç†" class="headerlink" title="4.2 è¡¨çš„ç®¡ç†"></a>4.2 è¡¨çš„ç®¡ç†</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.è¡¨çš„åˆ›å»º â˜…<br># è¯­æ³•ï¼š<br>create table è¡¨å(<br>åˆ—å åˆ—çš„ç±»å‹ã€(é•¿åº¦) çº¦æŸã€‘,<br>åˆ—å åˆ—çš„ç±»å‹ã€(é•¿åº¦) çº¦æŸã€‘,<br>åˆ—å åˆ—çš„ç±»å‹ã€(é•¿åº¦) çº¦æŸã€‘,<br>...<br>åˆ—å åˆ—çš„ç±»å‹ã€(é•¿åº¦) çº¦æŸã€‘<br>)<br># æ¡ˆä¾‹ï¼šåˆ›å»ºè¡¨Book<br>CREATE TABLE book(<br>id INT,#ç¼–å·<br>bName VARCHAR(20),#å›¾ä¹¦å<br>price DOUBLE,#ä»·æ ¼<br>authorId  INT,#ä½œè€…ç¼–å·<br>publishDate DATETIME#å‡ºç‰ˆæ—¥æœŸ<br>);<br>DESC book;<br>#æ¡ˆä¾‹ï¼šåˆ›å»ºè¡¨author<br>CREATE TABLE IF NOT EXISTS author(<br>id INT,<br>au_name VARCHAR(20),<br>nation VARCHAR(10)<br>)<br>DESC author;<br><br><br># 2.è¡¨çš„ä¿®æ”¹<br># è¯­æ³•<br>alter table è¡¨å add|drop|modify|change column åˆ—å ã€åˆ—ç±»å‹ çº¦æŸã€‘;<br># â‘  ä¿®æ”¹åˆ—å<br>ALTER TABLE book CHANGE COLUMN publishdate pubDate DATETIME;<br># â‘¡ ä¿®æ”¹åˆ—çš„ç±»å‹æˆ–çº¦æŸ<br>ALTER TABLE book MODIFY COLUMN pubdate TIMESTAMP;<br># â‘¢ æ·»åŠ æ–°åˆ—<br>ALTER TABLE author ADD COLUMN annual DOUBLE; <br># â‘£ åˆ é™¤åˆ—<br>ALTER TABLE book_author DROP COLUMN  annual;<br># â‘¤ ä¿®æ”¹è¡¨å<br>ALTER TABLE author RENAME TO book_author;<br><br><br># 3.è¡¨çš„åˆ é™¤<br>DROP TABLE IF EXISTS book_author;<br>SHOW TABLES;<br># é€šç”¨çš„å†™æ³•ï¼š<br>DROP DATABASE IF EXISTS æ—§åº“å;<br>CREATE DATABASE æ–°åº“å;<br>DROP TABLE IF EXISTS æ—§è¡¨å;<br>CREATE TABLE  è¡¨å();<br><br><br># 4.è¡¨çš„å¤åˆ¶<br>INSERT INTO author VALUES<br>(1,&#39;æ‘ä¸Šæ˜¥æ ‘&#39;,&#39;æ—¥æœ¬&#39;),<br>(2,&#39;è«è¨€&#39;,&#39;ä¸­å›½&#39;),<br>(3,&#39;å†¯å”&#39;,&#39;ä¸­å›½&#39;),<br>(4,&#39;é‡‘åº¸&#39;,&#39;ä¸­å›½&#39;);<br><br>SELECT * FROM Author;<br>SELECT * FROM copy2;<br># 1.ä»…ä»…å¤åˆ¶è¡¨çš„ç»“æ„<br>CREATE TABLE copy LIKE author;<br># 2.å¤åˆ¶è¡¨çš„ç»“æ„+æ•°æ®<br>CREATE TABLE copy2 <br>SELECT * FROM author;<br><br># åªå¤åˆ¶éƒ¨åˆ†æ•°æ®<br>CREATE TABLE copy3<br>SELECT id,au_name<br>FROM author <br>WHERE nation&#x3D;&#39;ä¸­å›½&#39;;<br><br># ä»…ä»…å¤åˆ¶æŸäº›å­—æ®µ<br>CREATE TABLE copy4 <br>SELECT id,au_name<br>FROM author<br>WHERE 0;<br></code></pre></td></tr></table></figure><h3 id="4-3-æ•°æ®ç±»å‹"><a href="#4-3-æ•°æ®ç±»å‹" class="headerlink" title="4.3 æ•°æ®ç±»å‹"></a>4.3 æ•°æ®ç±»å‹</h3><blockquote><p>  å¸¸è§çš„æ•°æ®ç±»å‹</p><ul><li><p>æ•°å€¼å‹ï¼š</p></li><li><p>æ•´å‹</p></li><li><p>å°æ•°ï¼š</p><ul><li><p>å®šç‚¹æ•°</p></li><li><p>æµ®ç‚¹æ•°</p></li></ul></li><li><p>å­—ç¬¦å‹ï¼š</p></li><li><p>è¾ƒçŸ­çš„æ–‡æœ¬ï¼šcharã€varchar</p></li><li><p>è¾ƒé•¿çš„æ–‡æœ¬ï¼štextã€blobï¼ˆè¾ƒé•¿çš„äºŒè¿›åˆ¶æ•°æ®ï¼‰</p></li><li><p>æ—¥æœŸå‹</p></li></ul></blockquote><p><strong>æ•´å‹</strong></p><ul><li><p>åˆ†ç±»ï¼š<br>tinyintã€smallintã€mediumintã€int/integerã€bigint<br>1              2               3                     4                     8</p></li><li><p>ç‰¹ç‚¹ï¼š<br>â‘  å¦‚æœä¸è®¾ç½®æ— ç¬¦å·è¿˜æ˜¯æœ‰ç¬¦å·ï¼Œé»˜è®¤æ˜¯æœ‰ç¬¦å·ï¼Œå¦‚æœæƒ³è®¾ç½®æ— ç¬¦å·ï¼Œéœ€è¦æ·»åŠ unsignedå…³é”®å­—<br>â‘¡ å¦‚æœæ’å…¥çš„æ•°å€¼è¶…å‡ºäº†æ•´å‹çš„èŒƒå›´,ä¼šæŠ¥out of rangeå¼‚å¸¸ï¼Œå¹¶ä¸”æ’å…¥ä¸´ç•Œå€¼<br>â‘¢ å¦‚æœä¸è®¾ç½®é•¿åº¦ï¼Œä¼šæœ‰é»˜è®¤çš„é•¿åº¦<br>é•¿åº¦ä»£è¡¨äº†æ˜¾ç¤ºçš„æœ€å¤§å®½åº¦ï¼Œå¦‚æœä¸å¤Ÿä¼šç”¨0åœ¨å·¦è¾¹å¡«å……ï¼Œä½†å¿…é¡»æ­é…zerofillä½¿ç”¨ï¼</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># å¦‚ä½•è®¾ç½®æ— ç¬¦å·å’Œæœ‰ç¬¦å·<br>DROP TABLE IF EXISTS tab_int;<br>CREATE TABLE tab_int(<br>t1 INT(7) ZEROFILL,<br>t2 INT(7) ZEROFILL,<br>    t3 INT UNSIGNED<br><br>);<br>DESC tab_int;<br><br><br>INSERT INTO tab_int VALUES(-123456);<br>INSERT INTO tab_int VALUES(-123456,-123456);<br>INSERT INTO tab_int VALUES(2147483648,4294967296);<br>INSERT INTO tab_int VALUES(123,123);<br>SELECT * FROM tab_int;<br></code></pre></td></tr></table></figure><p><strong>å°æ•°</strong></p><ul><li><p>åˆ†ç±»ï¼š</p><ol><li>æµ®ç‚¹å‹<br>float(M,D)<br>double(M,D)</li><li>å®šç‚¹å‹<br>dec(Mï¼ŒD)<br>decimal(M,D)</li></ol></li><li><p>ç‰¹ç‚¹ï¼š</p><p>â‘ <br>Mï¼šæ•´æ•°éƒ¨ä½+å°æ•°éƒ¨ä½<br>Dï¼šå°æ•°éƒ¨ä½<br>å¦‚æœè¶…è¿‡èŒƒå›´ï¼Œåˆ™æ’å…¥ä¸´ç•Œå€¼</p><p>â‘¡<br>Må’ŒDéƒ½å¯ä»¥çœç•¥<br>å¦‚æœæ˜¯decimalï¼Œåˆ™Mé»˜è®¤ä¸º10ï¼ŒDé»˜è®¤ä¸º0<br>å¦‚æœæ˜¯floatå’Œdoubleï¼Œåˆ™ä¼šæ ¹æ®æ’å…¥çš„æ•°å€¼çš„ç²¾åº¦æ¥å†³å®šç²¾åº¦</p><p>â‘¢</p><p>å®šç‚¹å‹çš„ç²¾ç¡®åº¦è¾ƒé«˜ï¼Œå¦‚æœè¦æ±‚æ’å…¥æ•°å€¼çš„ç²¾åº¦è¾ƒé«˜å¦‚è´§å¸è¿ç®—ç­‰åˆ™è€ƒè™‘ä½¿ç”¨</p></li><li><p>åŸåˆ™ï¼š</p><p>æ‰€é€‰æ‹©çš„ç±»å‹è¶Šç®€å•è¶Šå¥½ï¼Œèƒ½ä¿å­˜æ•°å€¼çš„ç±»å‹è¶Šå°è¶Šå¥½</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æµ‹è¯•Må’ŒD<br>CREATE TABLE tab_float(<br>f1 FLOAT,<br>f2 DOUBLE,<br>f3 DECIMAL<br>);<br>SELECT * FROM tab_float;<br>DESC tab_float;<br><br>INSERT INTO tab_float VALUES(123.4523,123.4523,123.4523);<br>INSERT INTO tab_float VALUES(123.456,123.456,123.456);<br>INSERT INTO tab_float VALUES(123.4,123.4,123.4);<br>INSERT INTO tab_float VALUES(1523.4,1523.4,1523.4);<br></code></pre></td></tr></table></figure><p><strong>å­—ç¬¦å‹</strong></p><ul><li><p>è¾ƒçŸ­çš„æ–‡æœ¬ï¼š</p><p>char  varchar</p></li><li><p>å…¶ä»–ï¼š</p><p>binaryå’Œvarbinaryç”¨äºä¿å­˜è¾ƒçŸ­çš„äºŒè¿›åˆ¶<br>enumç”¨äºä¿å­˜æšä¸¾<br>setç”¨äºä¿å­˜é›†åˆ</p></li><li><p>è¾ƒé•¿çš„æ–‡æœ¬ï¼š<br>text<br>blob(è¾ƒå¤§çš„äºŒè¿›åˆ¶)</p></li><li><p>char/varchar å¯¹æ¯”</p></li></ul><table><thead><tr><th></th><th>å†™æ³•</th><th>Mçš„æ„æ€</th><th>ç‰¹ç‚¹</th><th>ç©ºé—´çš„è€—è´¹</th><th>æ•ˆç‡</th></tr></thead><tbody><tr><td>char</td><td>char(M)</td><td>æœ€å¤§çš„å­—ç¬¦æ•°ï¼Œå¯ä»¥çœç•¥ï¼Œé»˜è®¤ä¸º1</td><td>å›ºå®šé•¿åº¦çš„å­—ç¬¦</td><td>æ¯”è¾ƒè€—è´¹</td><td>é«˜</td></tr><tr><td>varchar</td><td>varchar(M)</td><td>æœ€å¤§çš„å­—ç¬¦æ•°ï¼Œä¸å¯ä»¥çœç•¥</td><td>å¯å˜é•¿åº¦çš„å­—ç¬¦</td><td>æ¯”è¾ƒèŠ‚çœ</td><td>ä½</td></tr></tbody></table><ul><li>enumå’Œsetä¸åŒºåˆ†å¤§å°å†™<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE tab_char(<br>c1 ENUM(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;)<br>);<br>INSERT INTO tab_char VALUES(&#39;a&#39;);<br>INSERT INTO tab_char VALUES(&#39;b&#39;);<br>INSERT INTO tab_char VALUES(&#39;c&#39;);<br>INSERT INTO tab_char VALUES(&#39;m&#39;);<br>INSERT INTO tab_char VALUES(&#39;A&#39;);<br>SELECT * FROM tab_char;<br><br>CREATE TABLE tab_set(<br>s1 SET(&#39;a&#39;,&#39;b&#39;,&#39;c&#39;,&#39;d&#39;)<br>);<br>INSERT INTO tab_set VALUES(&#39;a&#39;);<br>INSERT INTO tab_set VALUES(&#39;A,B&#39;);<br>INSERT INTO tab_set VALUES(&#39;a,c,d&#39;);<br></code></pre></td></tr></table></figure></li></ul><p><strong>æ—¥æœŸå‹</strong></p><ul><li>åˆ†ç±»ï¼š<br>dateåªä¿å­˜æ—¥æœŸ<br>time åªä¿å­˜æ—¶é—´<br>yearåªä¿å­˜å¹´</li></ul><p>datetimeä¿å­˜æ—¥æœŸ+æ—¶é—´<br>timestampä¿å­˜æ—¥æœŸ+æ—¶é—´</p><table><thead><tr><th></th><th>å†™æ³•</th><th>èŒƒå›´</th><th>æ—¶åŒºç­‰çš„å½±å“</th></tr></thead><tbody><tr><td>datetime</td><td>8</td><td>1000-9999</td><td>ä¸å—</td></tr><tr><td>timestamp</td><td>4</td><td>1970-2038</td><td>å—</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE tab_date(<br>t1 DATETIME,<br>t2 TIMESTAMP<br>);<br>INSERT INTO tab_date VALUES(NOW(),NOW());<br>SELECT * FROM tab_date;<br><br># æŸ¥çœ‹å½“å‰æ—¶åŒº<br>SHOW VARIABLES LIKE &#39;time_zone&#39;;<br># æ›´æ”¹æ—¶åŒº<br>SET time_zone&#x3D;&#39;+9:00&#39;;<br></code></pre></td></tr></table></figure><h3 id="4-4-å¸¸è§çº¦æŸ"><a href="#4-4-å¸¸è§çº¦æŸ" class="headerlink" title="4.4 å¸¸è§çº¦æŸ"></a>4.4 å¸¸è§çº¦æŸ</h3><ul><li><p>å«ä¹‰ï¼šä¸€ç§é™åˆ¶ï¼Œç”¨äºé™åˆ¶è¡¨ä¸­çš„æ•°æ®ï¼Œä¸ºäº†ä¿è¯è¡¨ä¸­çš„æ•°æ®çš„å‡†ç¡®å’Œå¯é æ€§</p></li><li><p>åˆ†ç±»ï¼šå…­å¤§çº¦æŸ</p><ul><li><p>NOT NULLï¼š<strong>éç©º</strong>ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µçš„å€¼ä¸èƒ½ä¸ºç©º</p><pre><code>æ¯”å¦‚å§“åã€å­¦å·ç­‰</code></pre></li><li><p>DEFAULTï¼š<strong>é»˜è®¤</strong>ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µæœ‰é»˜è®¤å€¼</p><pre><code>æ¯”å¦‚æ€§åˆ«</code></pre></li><li><p>PRIMARY KEYï¼š<strong>ä¸»é”®</strong>ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µçš„å€¼å…·æœ‰<strong>å”¯ä¸€æ€§</strong>ï¼Œå¹¶ä¸”<strong>éç©º</strong></p><pre><code>æ¯”å¦‚å­¦å·ã€å‘˜å·¥ç¼–å·ç­‰</code></pre></li><li><p>UNIQUEï¼š<strong>å”¯ä¸€</strong>ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µçš„å€¼å…·æœ‰<strong>å”¯ä¸€æ€§</strong>ï¼Œå¯ä»¥ä¸ºç©º</p><pre><code>æ¯”å¦‚åº§ä½å·</code></pre></li><li><p>CHECKï¼šæ£€æŸ¥çº¦æŸã€mysqlä¸­ä¸æ”¯æŒã€‘</p><pre><code>æ¯”å¦‚å¹´é¾„ã€æ€§åˆ«</code></pre></li><li><p>FOREIGN KEYï¼š<strong>å¤–é”®</strong>ï¼Œç”¨äºé™åˆ¶ä¸¤ä¸ªè¡¨çš„å…³ç³»ï¼Œç”¨äºä¿è¯è¯¥å­—æ®µçš„å€¼å¿…é¡»æ¥è‡ªäºä¸»è¡¨çš„å…³è”åˆ—çš„å€¼</p><p>â€‹    åœ¨<strong>ä»è¡¨æ·»åŠ å¤–é”®çº¦æŸ</strong>ï¼Œç”¨äº<strong>å¼•ç”¨ä¸»è¡¨</strong>ä¸­æŸåˆ—çš„å€¼<br>â€‹    æ¯”å¦‚å­¦ç”Ÿè¡¨çš„ä¸“ä¸šç¼–å·ï¼Œå‘˜å·¥è¡¨çš„éƒ¨é—¨ç¼–å·ï¼Œå‘˜å·¥è¡¨çš„å·¥ç§ç¼–å·<br>â€‹    </p></li></ul></li><li><p>æ·»åŠ çº¦æŸçš„æ—¶æœºï¼š</p><pre><code>1.åˆ›å»ºè¡¨æ—¶2.ä¿®æ”¹è¡¨æ—¶</code></pre></li><li><p>çº¦æŸçš„æ·»åŠ åˆ†ç±»ï¼š</p><ul><li>åˆ—çº§çº¦æŸï¼š<br>å…­å¤§çº¦æŸè¯­æ³•ä¸Šéƒ½æ”¯æŒï¼Œä½†å¤–é”®çº¦æŸæ²¡æœ‰æ•ˆæœ        </li><li>è¡¨çº§çº¦æŸï¼š<br>é™¤äº†éç©ºã€é»˜è®¤ï¼Œå…¶ä»–çš„éƒ½æ”¯æŒ<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE è¡¨å(<br>å­—æ®µå å­—æ®µç±»å‹ åˆ—çº§çº¦æŸ,<br>å­—æ®µå å­—æ®µç±»å‹,<br>è¡¨çº§çº¦æŸ<br>)<br></code></pre></td></tr></table></figure></li></ul></li></ul><p>â€‹    </p><ul><li><font color=#FF0000>ä¸»é”®å’Œå”¯ä¸€çš„å¯¹æ¯”ã€é¢è¯•é¢˜ã€‘</font> </li></ul><table><thead><tr><th></th><th>ä¿è¯å”¯ä¸€æ€§</th><th>æ˜¯å¦å…è®¸ä¸ºç©º</th><th>ä¸€ä¸ªè¡¨ä¸­å¯ä»¥æœ‰å¤šå°‘ä¸ª</th><th>æ˜¯å¦å…è®¸ç»„åˆ</th></tr></thead><tbody><tr><td>ä¸»é”®</td><td>âˆš</td><td>Ã—</td><td>è‡³å¤šæœ‰1ä¸ª</td><td>âˆšï¼Œä½†ä¸æ¨è</td></tr><tr><td>å”¯ä¸€</td><td>âˆš</td><td>âˆš</td><td>å¯ä»¥æœ‰å¤šä¸ª</td><td>âˆšï¼Œä½†ä¸æ¨è</td></tr></tbody></table><ul><li><p>å¤–é”®</p><ul><li><p>è¦æ±‚åœ¨ä»è¡¨è®¾ç½®å¤–é”®å…³ç³»</p></li><li><p>ä»è¡¨çš„å¤–é”®åˆ—çš„ç±»å‹å’Œä¸»è¡¨çš„å…³è”åˆ—çš„ç±»å‹è¦æ±‚ä¸€è‡´æˆ–å…¼å®¹ï¼Œåç§°æ— è¦æ±‚</p></li><li><p>ä¸»è¡¨çš„å…³è”åˆ—å¿…é¡»æ˜¯ä¸€ä¸ªkeyï¼ˆä¸€èˆ¬æ˜¯ä¸»é”®æˆ–å”¯ä¸€ï¼‰</p></li><li><p>æ’å…¥æ•°æ®æ—¶ï¼Œå…ˆæ’å…¥ä¸»è¡¨ï¼Œå†æ’å…¥ä»è¡¨ï¼›åˆ é™¤æ•°æ®æ—¶ï¼Œå…ˆåˆ é™¤ä»è¡¨ï¼Œå†åˆ é™¤ä¸»è¡¨</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥åˆ é™¤ä¸»è¡¨çš„è®°å½•<br># æ–¹å¼ä¸€ï¼šçº§è”åˆ é™¤<br>ALTER TABLE stuinfo ADD CONSTRAINT fk_stu_major FOREIGN KEY(majorid) REFERENCES major(id) ON DELETE CASCADE;<br># æ–¹å¼äºŒï¼šçº§è”ç½®ç©º<br>ALTER TABLE stuinfo ADD CONSTRAINT fk_stu_major FOREIGN KEY(majorid) REFERENCES major(id) ON DELETE SET NULL;<br></code></pre></td></tr></table></figure></li></ul></li><li><p>çº¦æŸçš„å¢åˆ æ”¹</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># ä¸€ã€åˆ›å»ºè¡¨æ—¶æ·»åŠ çº¦æŸ<br># 1.æ·»åŠ åˆ—çº§çº¦æŸ<br>&#x2F;*<br>è¯­æ³•ï¼š<br>ç›´æ¥åœ¨å­—æ®µåå’Œç±»å‹åé¢è¿½åŠ  çº¦æŸç±»å‹å³å¯ã€‚<br>åªæ”¯æŒï¼šé»˜è®¤ã€éç©ºã€ä¸»é”®ã€å”¯ä¸€<br>*&#x2F;<br>USE students;<br>DROP TABLE stuinfo;<br>CREATE TABLE stuinfo(<br>id INT PRIMARY KEY,#ä¸»é”®<br>stuName VARCHAR(20) NOT NULL UNIQUE,#éç©º<br>gender CHAR(1) CHECK(gender&#x3D;&#39;ç”·&#39; OR gender &#x3D;&#39;å¥³&#39;),#æ£€æŸ¥<br>seat INT UNIQUE,#å”¯ä¸€<br>age INT DEFAULT  18,#é»˜è®¤çº¦æŸ<br>majorId INT REFERENCES major(id)#å¤–é”®(è¿™é‡Œå¤–é”®æ— æ•ˆ)<br><br>);<br><br>CREATE TABLE major(<br>id INT PRIMARY KEY,<br>majorName VARCHAR(20)<br>);<br><br>#æŸ¥çœ‹stuinfoä¸­çš„æ‰€æœ‰ç´¢å¼•ï¼ŒåŒ…æ‹¬ä¸»é”®ã€å¤–é”®ã€å”¯ä¸€<br>SHOW INDEX FROM stuinfo;<br><br><br># 2.æ·»åŠ è¡¨çº§çº¦æŸ<br>&#x2F;*<br>è¯­æ³•ï¼šåœ¨å„ä¸ªå­—æ®µçš„æœ€ä¸‹é¢<br> ã€constraint çº¦æŸåã€‘ çº¦æŸç±»å‹(å­—æ®µå) <br>*&#x2F;<br>DROP TABLE IF EXISTS stuinfo;<br>CREATE TABLE stuinfo(<br>id INT,<br>stuname VARCHAR(20),<br>gender CHAR(1),<br>seat INT,<br>age INT,<br>majorid INT,<br><br>CONSTRAINT pk PRIMARY KEY(id),#ä¸»é”®<br>CONSTRAINT uq UNIQUE(seat),#å”¯ä¸€é”®<br>CONSTRAINT ck CHECK(gender &#x3D;&#39;ç”·&#39; OR gender  &#x3D; &#39;å¥³&#39;),#æ£€æŸ¥<br>CONSTRAINT fk_stuinfo_major FOREIGN KEY(majorid) REFERENCES major(id)#å¤–é”®<br><br>);<br><br>SHOW INDEX FROM stuinfo;<br><br><br># é€šç”¨çš„å†™æ³•ï¼šâ˜…<br>CREATE TABLE IF NOT EXISTS stuinfo(<br>id INT PRIMARY KEY,<br>stuname VARCHAR(20),<br>sex CHAR(1),<br>age INT DEFAULT 18,<br>seat INT UNIQUE,<br>majorid INT,<br>CONSTRAINT fk_stuinfo_major FOREIGN KEY(majorid) REFERENCES major(id)<br><br>);<br><br><br># äºŒã€ä¿®æ”¹è¡¨æ—¶æ·»åŠ çº¦æŸ<br>&#x2F;*<br>1. æ·»åŠ åˆ—çº§çº¦æŸ<br>alter table è¡¨å modify column å­—æ®µå å­—æ®µç±»å‹ æ–°çº¦æŸ;<br>2. æ·»åŠ è¡¨çº§çº¦æŸ<br>alter table è¡¨å add ã€constraint çº¦æŸåã€‘ çº¦æŸç±»å‹(å­—æ®µå) ã€å¤–é”®çš„å¼•ç”¨ã€‘;<br>*&#x2F;<br>DROP TABLE IF EXISTS stuinfo;<br>CREATE TABLE stuinfo(<br>id INT,<br>stuname VARCHAR(20),<br>gender CHAR(1),<br>seat INT,<br>age INT,<br>majorid INT<br>)<br>DESC stuinfo;<br><br># 1.æ·»åŠ éç©ºçº¦æŸ<br>ALTER TABLE stuinfo MODIFY COLUMN stuname VARCHAR(20)  NOT NULL;<br># 2.æ·»åŠ é»˜è®¤çº¦æŸ<br>ALTER TABLE stuinfo MODIFY COLUMN age INT DEFAULT 18;<br># 3.æ·»åŠ ä¸»é”®<br># â‘ åˆ—çº§çº¦æŸ<br>ALTER TABLE stuinfo MODIFY COLUMN id INT PRIMARY KEY;<br># â‘¡è¡¨çº§çº¦æŸ<br>ALTER TABLE stuinfo ADD PRIMARY KEY(id);<br># 4.æ·»åŠ å”¯ä¸€<br># â‘ åˆ—çº§çº¦æŸ<br>ALTER TABLE stuinfo MODIFY COLUMN seat INT UNIQUE;<br># â‘¡è¡¨çº§çº¦æŸ<br>ALTER TABLE stuinfo ADD UNIQUE(seat);<br># 5.æ·»åŠ å¤–é”®<br>ALTER TABLE stuinfo ADD CONSTRAINT fk_stuinfo_major FOREIGN KEY(majorid) REFERENCES major(id); <br><br><br># ä¸‰ã€ä¿®æ”¹è¡¨æ—¶åˆ é™¤çº¦æŸ<br># 1.åˆ é™¤éç©ºçº¦æŸ<br>ALTER TABLE stuinfo MODIFY COLUMN stuname VARCHAR(20) NULL;<br># 2.åˆ é™¤é»˜è®¤çº¦æŸ<br>ALTER TABLE stuinfo MODIFY COLUMN age INT ;<br># 3.åˆ é™¤ä¸»é”®<br>ALTER TABLE stuinfo DROP PRIMARY KEY;<br># 4.åˆ é™¤å”¯ä¸€<br>ALTER TABLE stuinfo DROP INDEX seat;<br># 5.åˆ é™¤å¤–é”®<br>ALTER TABLE stuinfo DROP FOREIGN KEY fk_stuinfo_major;<br><br>SHOW INDEX FROM stuinfo;<br></code></pre></td></tr></table></figure><ul><li><p>è‡ªå¢é•¿åˆ—(æ ‡è¯†åˆ—ï¼‰</p><ul><li><p>å«ä¹‰ï¼šå¯ä»¥ä¸ç”¨æ‰‹åŠ¨çš„æ’å…¥å€¼ï¼Œç³»ç»Ÿæä¾›é»˜è®¤çš„åºåˆ—å€¼</p></li><li><p>ç‰¹ç‚¹ï¼š</p><blockquote><p>1ã€æ ‡è¯†åˆ—å¿…é¡»å’Œä¸»é”®æ­é…å—ï¼Ÿä¸ä¸€å®šï¼Œä½†è¦æ±‚æ˜¯ä¸€ä¸ªkey<br>2ã€ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å‡ ä¸ªæ ‡è¯†åˆ—ï¼Ÿ<strong>è‡³å¤šä¸€ä¸ª</strong>ï¼<br>3ã€æ ‡è¯†åˆ—çš„ç±»å‹åªèƒ½æ˜¯æ•°å€¼å‹<br>4ã€æ ‡è¯†åˆ—å¯ä»¥é€šè¿‡ <code>SET auto_increment_increment=3;</code>è®¾ç½®æ­¥é•¿<br>å¯ä»¥é€šè¿‡ æ‰‹åŠ¨æ’å…¥å€¼ï¼Œè®¾ç½®èµ·å§‹å€¼</p></blockquote></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.åˆ›å»ºè¡¨æ—¶è®¾ç½®æ ‡è¯†åˆ—<br>DROP TABLE IF EXISTS tab_identity;<br>CREATE TABLE tab_identity(<br>id INT,<br>NAME FLOAT UNIQUE AUTO_INCREMENT,<br>seat INT <br>);<br>TRUNCATE TABLE tab_identity;<br><br>INSERT INTO tab_identity(id,NAME) VALUES(NULL,&#39;john&#39;);<br>INSERT INTO tab_identity(NAME) VALUES(&#39;lucy&#39;);<br>SELECT * FROM tab_identity;<br><br># æŸ¥çœ‹è‡ªå¢é•¿ç›¸å…³å˜é‡<br>SHOW VARIABLES LIKE &#39;%auto_increment%&#39;;<br># è®¾ç½®è‡ªå¢é•¿æ­¥é•¿(ä¸€èˆ¬è¦è¿›è¡Œä¿®æ”¹)<br>SET auto_increment_increment&#x3D;3;<br><br># 2.ä¿®æ”¹è¡¨æ—¶è®¾ç½®æ ‡è¯†åˆ—<br>ALTER TABLE tab_identity MODIFY COLUMN id INT PRIMARY KEY AUTO_INCREMENT;<br><br># 3.ä¿®æ”¹è¡¨æ—¶åˆ é™¤æ ‡è¯†åˆ—<br>ALTER TABLE tab_identity MODIFY COLUMN id INT;<br></code></pre></td></tr></table></figure><h3 id="4-5-è¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»"><a href="#4-5-è¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»" class="headerlink" title="4.5 è¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»"></a>4.5 è¡¨ä¸è¡¨ä¹‹é—´çš„å…³ç³»</h3><ul><li>ä¸€å¯¹ä¸€</li><li>ä¸€å¯¹å¤š</li><li>å¤šå¯¹å¤š</li></ul><h2 id="5-TCLè¯­è¨€"><a href="#5-TCLè¯­è¨€" class="headerlink" title="5. TCLè¯­è¨€"></a>5. TCLè¯­è¨€</h2><p>Transaction Control Language äº‹åŠ¡æ§åˆ¶è¯­è¨€</p><h3 id="5-1-äº‹åŠ¡çš„å«ä¹‰"><a href="#5-1-äº‹åŠ¡çš„å«ä¹‰" class="headerlink" title="5.1 äº‹åŠ¡çš„å«ä¹‰"></a>5.1 äº‹åŠ¡çš„å«ä¹‰</h3><blockquote><p><strong>äº‹åŠ¡</strong>ï¼š<br>ä¸€ä¸ªæˆ–ä¸€ç»„sqlè¯­å¥ç»„æˆä¸€ä¸ªæ‰§è¡Œå•å…ƒï¼Œè¿™ä¸ªæ‰§è¡Œå•å…ƒè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œã€‚</p></blockquote><h3 id="5-2-äº‹åŠ¡çš„ç‰¹ç‚¹"><a href="#5-2-äº‹åŠ¡çš„ç‰¹ç‚¹" class="headerlink" title="5.2 äº‹åŠ¡çš„ç‰¹ç‚¹"></a>5.2 äº‹åŠ¡çš„ç‰¹ç‚¹</h3><p><font color=#FF0000>äº‹åŠ¡çš„ç‰¹æ€§ï¼šACID  [é¢è¯•é¢˜]</font>  </p><ul><li>åŸå­æ€§ï¼šä¸€ä¸ªäº‹åŠ¡ä¸å¯å†åˆ†å‰²ï¼Œè¦ä¹ˆéƒ½æ‰§è¡Œè¦ä¹ˆéƒ½ä¸æ‰§è¡Œ.</li><li>ä¸€è‡´æ€§ï¼šä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¼šä½¿æ•°æ®ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€åˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªä¸€è‡´çŠ¶æ€.</li><li>éš”ç¦»æ€§ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸å—å…¶ä»–äº‹åŠ¡çš„å¹²æ‰°.</li><li>æŒä¹…æ€§ï¼šä¸€ä¸ªäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œåˆ™ä¼šæ°¸ä¹…çš„æ”¹å˜æ•°æ®åº“çš„æ•°æ®.</li></ul><blockquote><p>å­˜å‚¨å¼•æ“:</p><ol><li>æ¦‚å¿µ: åœ¨mysqlä¸­çš„æ•°æ®ç”¨å„ç§ä¸åŒçš„æŠ€æœ¯å­˜å‚¨åœ¨æ–‡ä»¶(æˆ–è€…å†…å­˜)ä¸­.</li><li>é€šè¿‡<code>show engines;</code>æ¥æŸ¥çœ‹mysqlæ”¯æŒçš„å­˜å‚¨å¼•æ“.</li><li>åœ¨mysqlä¸­ç”¨çš„æœ€å¤šçš„å­˜å‚¨å¼•æ“æœ‰: innodb, myisam, memoryç­‰. å…¶ä¸­innodbæ”¯æŒäº‹åŠ¡,è€Œmyisamå’Œmemoryä¸æ”¯æŒäº‹åŠ¡.</li></ol></blockquote><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/%E5%AE%9E%E4%B9%A0%E9%9D%A2%E8%AF%95_tx_2.png"></p><h3 id="5-3-äº‹åŠ¡çš„ä½¿ç”¨"><a href="#5-3-äº‹åŠ¡çš„ä½¿ç”¨" class="headerlink" title="5.3 äº‹åŠ¡çš„ä½¿ç”¨"></a>5.3 äº‹åŠ¡çš„ä½¿ç”¨</h3><ul><li><p>äº‹åŠ¡çš„åˆ›å»º</p><ul><li><p>éšå¼äº‹åŠ¡ï¼šäº‹åŠ¡æ²¡æœ‰æ˜æ˜¾çš„å¼€å¯å’Œç»“æŸçš„æ ‡è®°<br>æ¯”å¦‚insertã€updateã€deleteè¯­å¥</p><p>â€‹    delete from è¡¨ where id =1;</p></li><li><p>æ˜¾å¼äº‹åŠ¡ï¼šäº‹åŠ¡å…·æœ‰æ˜æ˜¾çš„å¼€å¯å’Œç»“æŸçš„æ ‡è®°<br>å‰æï¼šå¿…é¡»å…ˆè®¾ç½®è‡ªåŠ¨æäº¤åŠŸèƒ½ä¸ºç¦ç”¨<code>set autocommit=0;</code></p></li></ul></li></ul><ul><li><p>æ˜¾å¼äº‹åŠ¡çš„ä½¿ç”¨</p><p>â‘  å¼€å¯äº‹åŠ¡<br>set autocommit=0;<br>start transaction;#å¯ä»¥çœç•¥</p><p>â‘¡ ç¼–å†™ä¸€ç»„é€»è¾‘sqlè¯­å¥<br>æ³¨æ„ï¼šsqlè¯­å¥æ”¯æŒçš„æ˜¯insertã€updateã€delete</p><p>è®¾ç½®å›æ»šç‚¹ï¼š<br>savepoint å›æ»šç‚¹å;</p><p>â‘¢ ç»“æŸäº‹åŠ¡<br>æäº¤ï¼šcommit;<br>å›æ»šï¼šrollback;<br>å›æ»šåˆ°æŒ‡å®šçš„åœ°æ–¹ï¼šrollback to å›æ»šç‚¹å;</p></li><li><p>deleteå’Œtruncateåœ¨äº‹åŠ¡ä½¿ç”¨æ—¶çš„åŒºåˆ«ï¼š</p><ul><li>deleteæ”¯æŒå›æ»š</li><li>truncateä¸æ”¯æŒ</li></ul></li></ul><h3 id="5-4-å¹¶å‘äº‹åŠ¡"><a href="#5-4-å¹¶å‘äº‹åŠ¡" class="headerlink" title="5.4 å¹¶å‘äº‹åŠ¡"></a>5.4 å¹¶å‘äº‹åŠ¡</h3><ul><li><p>äº‹åŠ¡çš„å¹¶å‘é—®é¢˜æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼Ÿ</p><p>â€‹    å¤šä¸ªäº‹åŠ¡ åŒæ—¶ æ“ä½œ åŒä¸€ä¸ªæ•°æ®åº“çš„ç›¸åŒæ•°æ®æ—¶</p></li><li><p><font color=#FF0000>å¹¶å‘é—®é¢˜éƒ½æœ‰å“ªäº›ï¼Ÿ</font> </p><ul><li><strong>è„è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å…¶ä»–äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œè¯»åˆ°çš„æ˜¯å…¶ä»–äº‹åŠ¡â€œæ›´æ–°â€çš„æ•°æ®</li><li><strong>ä¸å¯é‡å¤è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡è¯»å–ï¼Œç»“æœä¸ä¸€æ ·</li><li><strong>å¹»è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–äº†å…¶ä»–äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ï¼Œåªæ˜¯è¯»åˆ°çš„æ˜¯å…¶ä»–äº‹åŠ¡â€œæ’å…¥â€çš„æ•°æ®</li><li><strong>æ›´æ–°ä¸¢å¤±</strong>ï¼šå½“ä¸¤ä¸ªæˆ–è€…å¤šä¸ªäº‹åŠ¡é€‰æ‹©åŒä¸€è¡Œï¼Œç„¶ååŸºäºæœ€åˆçš„é€‰å®šçš„å€¼æ›´æ–°è¯¥è¡Œæ—¶ï¼Œç”±äºæ¯ä¸€ä¸ªäº‹åŠ¡éƒ½ä¸çŸ¥é“å…¶ä»–äº‹åŠ¡çš„å­˜åœ¨ï¼Œå°±ä¼šå‘ç”Ÿæ›´æ–°é—®é¢˜ã€‚æœ€åçš„æ›´æ–°è¦†ç›–äº†å…¶ä»–äº‹åŠ¡æ‰€åšçš„æ›´æ–°ã€‚</li></ul></li><li><p>å¦‚ä½•è§£å†³å¹¶å‘é—®é¢˜</p><p>â€‹    é€šè¿‡è®¾ç½®éš”ç¦»çº§åˆ«æ¥è§£å†³å¹¶å‘é—®é¢˜</p></li><li><p><font color=#FF0000>äº‹åŠ¡çš„éš”ç¦»çº§åˆ«</font>  </p></li></ul><table><thead><tr><th></th><th>è¯»æ•°æ®ä¸€è‡´æ€§</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>read uncommitted: è¯»æœªæäº¤</td><td>æœ€ä½çº§åˆ«ï¼Œåªèƒ½ä¿è¯ä¸è¯»å–ç‰©ç†ä¸ŠæŸåçš„æ•°æ®</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr><tr><td>read committed: è¯»å·²æäº¤</td><td>è¯­å¥çº§</td><td>âˆš</td><td>Ã—</td><td>Ã—</td></tr><tr><td>repeatable read: å¯é‡å¤è¯»</td><td>äº‹åŠ¡çº§</td><td>âˆš</td><td>âˆš</td><td>Ã—</td></tr><tr><td>serializable: ä¸²è¡ŒåŒ– (æ¯æ¬¡è¯»éƒ½éœ€è·å¾—è¡¨çº§å…±äº«é”ï¼Œè¯»å†™ç›¸äº’éƒ½ä¼šé˜»å¡,æ€§èƒ½ä½ä¸‹)</td><td>æœ€é«˜çº§åˆ«ï¼Œäº‹åŠ¡çº§</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr></tbody></table><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># mysqlä¸­é»˜è®¤ ç¬¬ä¸‰ä¸ªéš”ç¦»çº§åˆ« <br>repeatable read<br># oracleä¸­é»˜è®¤ç¬¬äºŒä¸ªéš”ç¦»çº§åˆ« <br>read committed<br># æŸ¥çœ‹éš”ç¦»çº§åˆ«<br>select @@tx_isolation;<br>show variables like &#39;tx_isolation&#39;;<br># è®¾ç½®éš”ç¦»çº§åˆ«<br>set session|global transaction isolation level éš”ç¦»çº§åˆ«;<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#1.æ¼”ç¤ºäº‹åŠ¡çš„ä½¿ç”¨æ­¥éª¤<br># å¼€å¯äº‹åŠ¡<br>SET autocommit&#x3D;0;<br>START TRANSACTION;<br># ç¼–å†™ä¸€ç»„äº‹åŠ¡çš„è¯­å¥<br>UPDATE account SET balance &#x3D; 1000 WHERE username&#x3D;&#39;å¼ æ— å¿Œ&#39;;<br>UPDATE account SET balance &#x3D; 1000 WHERE username&#x3D;&#39;èµµæ•&#39;;<br># ç»“æŸäº‹åŠ¡<br>ROLLBACK; # commit;<br>SELECT * FROM account;<br><br>#2.æ¼”ç¤ºäº‹åŠ¡å¯¹äºdeleteå’Œtruncateçš„å¤„ç†çš„åŒºåˆ«<br>SET autocommit&#x3D;0;<br>START TRANSACTION;<br>DELETE FROM account;<br>ROLLBACK;<br><br>#3.æ¼”ç¤ºsavepoint çš„ä½¿ç”¨<br>SET autocommit&#x3D;0;<br>START TRANSACTION;<br>DELETE FROM account WHERE id&#x3D;25;<br>SAVEPOINT a;#è®¾ç½®ä¿å­˜ç‚¹<br>DELETE FROM account WHERE id&#x3D;28;<br>ROLLBACK TO a;#å›æ»šåˆ°ä¿å­˜ç‚¹<br>SELECT * FROM account;<br></code></pre></td></tr></table></figure><h2 id="6-å…¶ä»–"><a href="#6-å…¶ä»–" class="headerlink" title="6. å…¶ä»–"></a>6. å…¶ä»–</h2><h3 id="6-1-è§†å›¾"><a href="#6-1-è§†å›¾" class="headerlink" title="6.1 è§†å›¾"></a>6.1 è§†å›¾</h3><blockquote><p><strong>å«ä¹‰</strong>ï¼šè™šæ‹Ÿè¡¨ï¼Œå’Œæ™®é€šè¡¨ä¸€æ ·ä½¿ç”¨<br>mysql5.1ç‰ˆæœ¬å‡ºç°çš„æ–°ç‰¹æ€§ï¼Œæ˜¯é€šè¿‡è¡¨åŠ¨æ€ç”Ÿæˆçš„æ•°æ®, <strong>åªä¿å­˜äº†sqlé€»è¾‘</strong>, ä¸ä¿å­˜æŸ¥è¯¢ç»“æœ</p></blockquote><ul><li><p>åº”ç”¨åœºæ™¯:</p><ul><li>å¤šä¸ªåœ°æ–¹ç”¨åˆ°ç›¸åŒçš„æŸ¥è¯¢ç»“æœ</li><li>è¯¥æŸ¥è¯¢ç»“æœä½¿ç”¨çš„sqlè¯­å¥æ¯”è¾ƒå¤æ‚</li></ul></li><li><p>å¥½å¤„ï¼š</p><ul><li>é‡ç”¨sqlè¯­å¥</li><li>ç®€åŒ–å¤æ‚çš„sqlæ“ä½œï¼Œä¸å¿…çŸ¥é“å®ƒçš„æŸ¥è¯¢ç»†èŠ‚</li><li>ä¿æŠ¤æ•°æ®ï¼Œæé«˜å®‰å…¨æ€§ï¼ˆåªæä¾›å¯¹æ–¹éœ€è¦çš„ä¿¡æ¯ï¼‰</li></ul></li><li><p>åˆ›å»ºè§†å›¾</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># ç¤ºä¾‹ï¼šæŸ¥è¯¢å§“å¼ çš„å­¦ç”Ÿåå’Œä¸“ä¸šå<br># 1.åŸå§‹sqlè¯­å¥<br>SELECT stuname,majorname<br>FROM stuinfo s<br>INNER JOIN major m ON s.&#96;majorid&#96;&#x3D; m.&#96;id&#96;<br>WHERE s.&#96;stuname&#96; LIKE &#39;å¼ %&#39;;<br># 2.â‘ åˆ›å»ºè§†å›¾<br>CREATE VIEW v1<br>AS<br>SELECT stuname,majorname<br>FROM stuinfo s<br>INNER JOIN major m ON s.&#96;majorid&#96;&#x3D; m.&#96;id&#96;;<br># 2.â‘¡ä½¿ç”¨è§†å›¾ç®€åŒ–åŸå§‹sqlè¯­å¥<br>SELECT * FROM v1 WHERE stuname LIKE &#39;å¼ %&#39;;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹è§†å›¾</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#æ–¹å¼ä¸€ï¼š<br>&#x2F;*<br>create or replace view  è§†å›¾å<br>as<br>æŸ¥è¯¢è¯­å¥;<br>*&#x2F;<br>SELECT * FROM myv3 <br>CREATE OR REPLACE VIEW myv3<br>AS<br>SELECT AVG(salary),job_id<br>FROM employees<br>GROUP BY job_id;<br><br>#æ–¹å¼äºŒï¼š<br>&#x2F;*<br>è¯­æ³•ï¼š<br>alter view è§†å›¾å<br>as <br>æŸ¥è¯¢è¯­å¥;<br>*&#x2F;<br>ALTER VIEW myv3<br>AS<br>SELECT * FROM employees;<br></code></pre></td></tr></table></figure><ul><li>åˆ é™¤è§†å›¾</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># è¯­æ³•ï¼šdrop view è§†å›¾å,è§†å›¾å,...;<br>DROP VIEW emp_v1,emp_v2,myv3;<br></code></pre></td></tr></table></figure><ul><li>æŸ¥çœ‹è§†å›¾</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mysql">DESC myv3;<br>SHOW CREATE VIEW myv3;<br></code></pre></td></tr></table></figure><ul><li>æ›´æ–°è§†å›¾</li></ul><p>è§†å›¾å¯ä»¥å¢åˆ æ”¹ï¼Œç¤ºä¾‹å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE OR REPLACE VIEW myv1<br>AS<br>SELECT last_name,email<br>FROM employees;<br>SELECT * FROM myv1;<br>SELECT * FROM employees;<br>#1.æ’å…¥<br>INSERT INTO myv1 VALUES(&#39;å¼ é£&#39;,&#39;zf@qq.com&#39;);<br>#2.ä¿®æ”¹<br>UPDATE myv1 SET last_name &#x3D; &#39;å¼ æ— å¿Œ&#39; WHERE last_name&#x3D;&#39;å¼ é£&#39;;<br>#3.åˆ é™¤<br>DELETE FROM myv1 WHERE last_name &#x3D; &#39;å¼ æ— å¿Œ&#39;;<br></code></pre></td></tr></table></figure><p>å…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹çš„è§†å›¾ä¸å…è®¸æ›´æ–°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># â‘  åŒ…å«ä»¥ä¸‹å…³é”®å­—çš„sqlè¯­å¥ï¼šåˆ†ç»„å‡½æ•°ã€distinctã€group  byã€havingã€unionæˆ–è€…union all<br>CREATE OR REPLACE VIEW myv1<br>AS<br>SELECT MAX(salary) m,department_id<br>FROM employees<br>GROUP BY department_id;<br>SELECT * FROM myv1;<br>#æ›´æ–°<br>UPDATE myv1 SET m&#x3D;9000 WHERE department_id&#x3D;10;<br><br># â‘¡ å¸¸é‡è§†å›¾<br>CREATE OR REPLACE VIEW myv2<br>AS<br>SELECT &#39;john&#39; NAME;<br>SELECT * FROM myv2;<br>#æ›´æ–°<br>UPDATE myv2 SET NAME&#x3D;&#39;lucy&#39;;<br><br><br># â‘¢ Selectä¸­åŒ…å«å­æŸ¥è¯¢<br>CREATE OR REPLACE VIEW myv3<br>AS<br>SELECT department_id,(SELECT MAX(salary) FROM employees) æœ€é«˜å·¥èµ„<br>FROM departments;<br>#æ›´æ–°<br>SELECT * FROM myv3;<br>UPDATE myv3 SET æœ€é«˜å·¥èµ„&#x3D;100000;<br><br><br># â‘£ join<br>CREATE OR REPLACE VIEW myv4<br>AS<br>SELECT last_name,department_name<br>FROM employees e<br>JOIN departments d<br>ON e.department_id  &#x3D; d.department_id;<br>#æ›´æ–°<br>SELECT * FROM myv4;<br>UPDATE myv4 SET last_name  &#x3D; &#39;å¼ é£&#39; WHERE last_name&#x3D;&#39;Whalen&#39;;<br>INSERT INTO myv4 VALUES(&#39;é™ˆçœŸ&#39;,&#39;xxxx&#39;);<br><br># â‘¤ fromä¸€ä¸ªä¸èƒ½æ›´æ–°çš„è§†å›¾<br>CREATE OR REPLACE VIEW myv5<br>AS<br>SELECT * FROM myv3;<br>#æ›´æ–°<br>SELECT * FROM myv5;<br>UPDATE myv5 SET æœ€é«˜å·¥èµ„&#x3D;10000 WHERE department_id&#x3D;60;<br><br># â‘¥ whereå­å¥çš„å­æŸ¥è¯¢å¼•ç”¨äº†fromå­å¥ä¸­çš„è¡¨<br>CREATE OR REPLACE VIEW myv6<br>AS<br>SELECT last_name,email,salary<br>FROM employees<br>WHERE employee_id IN(<br>SELECT  manager_id<br>FROM employees<br>WHERE manager_id IS NOT NULL<br>);<br>#æ›´æ–°<br>SELECT * FROM myv6;<br>UPDATE myv6 SET salary&#x3D;10000 WHERE last_name &#x3D; &#39;k_ing&#39;;<br></code></pre></td></tr></table></figure><ul><li>è¡¨å’Œè§†å›¾çš„å¯¹æ¯”<table><thead><tr><th></th><th>åˆ›å»ºè¯­æ³•çš„å…³é”®å­—</th><th>æ˜¯å¦å®é™…å ç”¨ç‰©ç†ç©ºé—´</th><th>ä½¿ç”¨</th></tr></thead><tbody><tr><td>è§†å›¾</td><td>create view</td><td>åªæ˜¯ä¿å­˜äº†sqlé€»è¾‘</td><td>å¢åˆ æ”¹æŸ¥ï¼Œåªæ˜¯ä¸€èˆ¬ä¸èƒ½å¢åˆ æ”¹</td></tr><tr><td>è¡¨</td><td>create table</td><td>ä¿å­˜äº†æ•°æ®</td><td>å¢åˆ æ”¹æŸ¥</td></tr></tbody></table></li></ul><h3 id="6-2-å˜é‡"><a href="#6-2-å˜é‡" class="headerlink" title="6.2 å˜é‡"></a>6.2 å˜é‡</h3><ul><li>ç³»ç»Ÿå˜é‡ï¼š<ul><li>å…¨å±€å˜é‡ï¼š</li></ul>æœåŠ¡å™¨å±‚é¢ä¸Šçš„ï¼Œå¿…é¡»æ‹¥æœ‰superæƒé™æ‰èƒ½ä¸ºç³»ç»Ÿå˜é‡èµ‹å€¼ï¼Œä½œç”¨åŸŸä¸ºæ•´ä¸ªæœåŠ¡å™¨ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹äºæ‰€æœ‰è¿æ¥ï¼ˆä¼šè¯ï¼‰æœ‰æ•ˆ<ul><li><p>ä¼šè¯å˜é‡ï¼š</p><p>æœåŠ¡å™¨ä¸ºæ¯ä¸€ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯éƒ½æä¾›äº†ç³»ç»Ÿå˜é‡ï¼Œä½œç”¨åŸŸä¸ºå½“å‰çš„è¿æ¥ï¼ˆä¼šè¯ï¼‰</p></li></ul></li><li>è‡ªå®šä¹‰å˜é‡ï¼š<ul><li>ç”¨æˆ·å˜é‡</li><li>å±€éƒ¨å˜é‡</li></ul></li></ul><blockquote><ol><li>ç³»ç»Ÿå˜é‡</li></ol></blockquote><p><strong>è¯´æ˜</strong>ï¼šå˜é‡ç”±ç³»ç»Ÿå®šä¹‰ï¼Œä¸æ˜¯ç”¨æˆ·å®šä¹‰ï¼Œå±äºæœåŠ¡å™¨å±‚é¢<br><strong>æ³¨æ„</strong>ï¼šå…¨å±€å˜é‡éœ€è¦æ·»åŠ globalå…³é”®å­—ï¼Œä¼šè¯å˜é‡éœ€è¦æ·»åŠ sessionå…³é”®å­—ï¼Œå¦‚æœä¸å†™ï¼Œé»˜è®¤ä¼šè¯çº§åˆ«<br><strong>ä½¿ç”¨æ­¥éª¤</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ã€æŸ¥çœ‹æ‰€æœ‰ç³»ç»Ÿå˜é‡<br>show global|ã€sessionã€‘variables;<br># 2ã€æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ç³»ç»Ÿå˜é‡<br>show global|ã€sessionã€‘ variables like &#39;%char%&#39;;<br># 3ã€æŸ¥çœ‹æŒ‡å®šçš„ç³»ç»Ÿå˜é‡çš„å€¼<br>select @@global|ã€sessionã€‘ç³»ç»Ÿå˜é‡å;<br># 4ã€ä¸ºæŸä¸ªç³»ç»Ÿå˜é‡èµ‹å€¼<br># æ–¹å¼ä¸€ï¼š<br>set global|ã€sessionã€‘ç³»ç»Ÿå˜é‡å&#x3D;å€¼;<br># æ–¹å¼äºŒï¼š<br>set @@global|ã€sessionã€‘ç³»ç»Ÿå˜é‡å&#x3D;å€¼;<br></code></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ã€‹å…¨å±€å˜é‡<br>&#x2F;*<br>ä½œç”¨åŸŸï¼šé’ˆå¯¹äºæ‰€æœ‰ä¼šè¯ï¼ˆè¿æ¥ï¼‰æœ‰æ•ˆï¼Œä½†ä¸èƒ½è·¨é‡å¯<br>*&#x2F;<br># â‘  æŸ¥çœ‹æ‰€æœ‰å…¨å±€å˜é‡<br>SHOW GLOBAL VARIABLES;<br># â‘¡ æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ç³»ç»Ÿå˜é‡<br>SHOW GLOBAL VARIABLES LIKE &#39;%char%&#39;;<br># â‘¢ æŸ¥çœ‹æŒ‡å®šçš„ç³»ç»Ÿå˜é‡çš„å€¼<br>SELECT @@global.autocommit;<br># â‘£ ä¸ºæŸä¸ªç³»ç»Ÿå˜é‡èµ‹å€¼<br>SET @@global.autocommit&#x3D;0;<br>SET GLOBAL autocommit&#x3D;0;<br><br>#2ã€‹ä¼šè¯å˜é‡<br>&#x2F;*<br>ä½œç”¨åŸŸï¼šé’ˆå¯¹äºå½“å‰ä¼šè¯ï¼ˆè¿æ¥ï¼‰æœ‰æ•ˆ<br>*&#x2F;<br># â‘  æŸ¥çœ‹æ‰€æœ‰ä¼šè¯å˜é‡<br>SHOW SESSION VARIABLES;<br># â‘¡ æŸ¥çœ‹æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†ä¼šè¯å˜é‡<br>SHOW SESSION VARIABLES LIKE &#39;%char%&#39;;<br># â‘¢ æŸ¥çœ‹æŒ‡å®šçš„ä¼šè¯å˜é‡çš„å€¼<br>SELECT @@autocommit;<br>SELECT @@session.tx_isolation;<br># â‘£ ä¸ºæŸä¸ªä¼šè¯å˜é‡èµ‹å€¼<br>SET @@session.tx_isolation&#x3D;&#39;read-uncommitted&#39;;<br>SET SESSION tx_isolation&#x3D;&#39;read-committed&#39;;<br></code></pre></td></tr></table></figure><blockquote><ol start="2"><li>è‡ªå®šä¹‰å˜é‡</li></ol></blockquote><p><strong>è¯´æ˜</strong>ï¼šå˜é‡ç”±ç”¨æˆ·è‡ªå®šä¹‰ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿæä¾›çš„<br><strong>ä½¿ç”¨æ­¥éª¤</strong>ï¼š<br>1ã€å£°æ˜<br>2ã€èµ‹å€¼<br>3ã€ä½¿ç”¨ï¼ˆæŸ¥çœ‹ã€æ¯”è¾ƒã€è¿ç®—ç­‰ï¼‰</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1ã€‹ç”¨æˆ·å˜é‡<br>&#x2F;*<br>ä½œç”¨åŸŸï¼šé’ˆå¯¹äºå½“å‰ä¼šè¯ï¼ˆè¿æ¥ï¼‰æœ‰æ•ˆï¼Œä½œç”¨åŸŸåŒäºä¼šè¯å˜é‡<br>*&#x2F;<br># èµ‹å€¼æ“ä½œç¬¦ï¼š&#x3D;æˆ–:&#x3D;<br># â‘  å£°æ˜å¹¶åˆå§‹åŒ–<br>SET @å˜é‡å&#x3D;å€¼;<br>SET @å˜é‡å:&#x3D;å€¼;<br>SELECT @å˜é‡å:&#x3D;å€¼;<br># â‘¡ èµ‹å€¼ï¼ˆæ›´æ–°å˜é‡çš„å€¼ï¼‰<br>#æ–¹å¼ä¸€ï¼š<br>SET @å˜é‡å&#x3D;å€¼;<br>SET @å˜é‡å:&#x3D;å€¼;<br>SELECT @å˜é‡å:&#x3D;å€¼;<br>#æ–¹å¼äºŒï¼š<br>SELECT å­—æ®µ INTO @å˜é‡å<br>FROM è¡¨;<br># â‘¢ ä½¿ç”¨ï¼ˆæŸ¥çœ‹å˜é‡çš„å€¼ï¼‰<br>SELECT @å˜é‡å;<br><br><br># 2ã€‹å±€éƒ¨å˜é‡<br>&#x2F;*<br>ä½œç”¨åŸŸï¼šä»…ä»…åœ¨å®šä¹‰å®ƒçš„begin endå—ä¸­æœ‰æ•ˆ<br>åº”ç”¨åœ¨ begin endä¸­çš„ç¬¬ä¸€å¥è¯<br>*&#x2F;<br># â‘  å£°æ˜<br>DECLARE å˜é‡å ç±»å‹;<br>DECLARE å˜é‡å ç±»å‹ ã€DEFAULT å€¼ã€‘<br># â‘¡ èµ‹å€¼ï¼ˆæ›´æ–°å˜é‡çš„å€¼ï¼‰<br>#æ–¹å¼ä¸€ï¼š<br>SET å±€éƒ¨å˜é‡å&#x3D;å€¼;<br>SET å±€éƒ¨å˜é‡å:&#x3D;å€¼;<br>SELECT å±€éƒ¨å˜é‡å:&#x3D;å€¼;<br>#æ–¹å¼äºŒï¼š<br>SELECT å­—æ®µ INTO å…·å¤‡å˜é‡å<br>FROM è¡¨;<br># â‘¢ ä½¿ç”¨ï¼ˆæŸ¥çœ‹å˜é‡çš„å€¼ï¼‰<br>SELECT å±€éƒ¨å˜é‡å;<br><br><br># æ¡ˆä¾‹ï¼šå£°æ˜ä¸¤ä¸ªå˜é‡ï¼Œæ±‚å’Œå¹¶æ‰“å°<br># ç”¨æˆ·å˜é‡<br>SET @m&#x3D;1;<br>SET @n&#x3D;1;<br>SET @sum&#x3D;@m+@n;<br>SELECT @sum;<br># å±€éƒ¨å˜é‡<br>DECLARE m INT DEFAULT 1;<br>DECLARE n INT DEFAULT 1;<br>DECLARE SUM INT;<br>SET SUM&#x3D;m+n;<br>SELECT SUM;<br></code></pre></td></tr></table></figure><p><strong>ç”¨æˆ·å˜é‡å’Œå±€éƒ¨å˜é‡çš„å¯¹æ¯”</strong>ï¼š</p><table><thead><tr><th></th><th>ä½œç”¨åŸŸ</th><th>å®šä¹‰ä½ç½®</th><th>è¯­æ³•</th></tr></thead><tbody><tr><td>ç”¨æˆ·å˜é‡</td><td>å½“å‰ä¼šè¯</td><td>ä¼šè¯çš„ä»»ä½•åœ°æ–¹</td><td>åŠ @ç¬¦å·ï¼Œä¸ç”¨æŒ‡å®šç±»å‹</td></tr><tr><td>å±€éƒ¨å˜é‡</td><td>å®šä¹‰å®ƒçš„BEGIN ENDä¸­</td><td>BEGIN ENDçš„ç¬¬ä¸€å¥è¯</td><td>ä¸€èˆ¬ä¸ç”¨åŠ @,éœ€è¦æŒ‡å®šç±»å‹</td></tr></tbody></table><h3 id="6-3-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"><a href="#6-3-å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°" class="headerlink" title="6.3 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°"></a>6.3 å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</h3><ul><li>å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°ï¼šç±»ä¼¼äºjavaä¸­çš„æ–¹æ³•</li><li>å¥½å¤„ï¼š<br>1ã€æé«˜ä»£ç çš„é‡ç”¨æ€§<br>2ã€ç®€åŒ–æ“ä½œ</li></ul><blockquote><ol><li><strong>å­˜å‚¨è¿‡ç¨‹</strong></li></ol></blockquote><p><strong>å«ä¹‰</strong>ï¼šä¸€ç»„é¢„å…ˆç¼–è¯‘å¥½çš„SQLè¯­å¥çš„é›†åˆï¼Œç†è§£æˆæ‰¹å¤„ç†è¯­å¥<br>1ã€æé«˜ä»£ç çš„é‡ç”¨æ€§<br>2ã€ç®€åŒ–æ“ä½œ<br>3ã€å‡å°‘äº†ç¼–è¯‘æ¬¡æ•°å¹¶ä¸”å‡å°‘äº†å’Œæ•°æ®åº“æœåŠ¡å™¨çš„è¿æ¥æ¬¡æ•°ï¼Œæé«˜äº†æ•ˆç‡</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># ä¸€ã€åˆ›å»ºè¯­æ³•â˜…<br>CREATE PROCEDURE å­˜å‚¨è¿‡ç¨‹å(å‚æ•°åˆ—è¡¨)<br>BEGIN<br>å­˜å‚¨è¿‡ç¨‹ä½“ï¼ˆä¸€ç»„åˆæ³•çš„SQLè¯­å¥ï¼‰<br>END<br>&#x2F;*<br>1ã€å‚æ•°åˆ—è¡¨åŒ…å«ä¸‰éƒ¨åˆ†<br>å‚æ•°æ¨¡å¼  å‚æ•°å  å‚æ•°ç±»å‹<br>ä¸¾ä¾‹ï¼š<br>in stuname varchar(20)<br><br>å‚æ•°æ¨¡å¼ï¼š<br>inï¼šè¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å…¥ï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°éœ€è¦è°ƒç”¨æ–¹ä¼ å…¥å€¼,inå¯ä»¥çœç•¥<br>outï¼šè¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼<br>inoutï¼šè¯¥å‚æ•°æ—¢å¯ä»¥ä½œä¸ºè¾“å…¥åˆå¯ä»¥ä½œä¸ºè¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯¥å‚æ•°æ—¢éœ€è¦ä¼ å…¥å€¼ï¼Œåˆå¯ä»¥è¿”å›å€¼<br><br>2ã€å¦‚æœå­˜å‚¨è¿‡ç¨‹ä½“ä»…ä»…åªæœ‰ä¸€å¥è¯ï¼Œbegin endå¯ä»¥çœç•¥<br>å­˜å‚¨è¿‡ç¨‹ä½“ä¸­çš„æ¯æ¡sqlè¯­å¥çš„ç»“å°¾è¦æ±‚å¿…é¡»åŠ åˆ†å·ã€‚<br>å­˜å‚¨è¿‡ç¨‹çš„ç»“å°¾å¯ä»¥ä½¿ç”¨ delimiter é‡æ–°è®¾ç½®<br>è¯­æ³•ï¼š<br>delimiter ç»“æŸæ ‡è®°<br>æ¡ˆä¾‹ï¼š<br>delimiter $<br>*&#x2F;<br><br><br># äºŒã€è°ƒç”¨è¯­æ³•<br>CALL å­˜å‚¨è¿‡ç¨‹å(å®å‚åˆ—è¡¨);<br><br>#----------------------æ¡ˆä¾‹æ¼”ç¤º-------------------------<br># 1.ç©ºå‚åˆ—è¡¨<br>#æ¡ˆä¾‹ï¼šæ’å…¥åˆ°adminè¡¨ä¸­äº”æ¡è®°å½•<br>SELECT * FROM admin;<br>DELIMITER $<br>CREATE PROCEDURE myp1()<br>BEGIN<br>INSERT INTO admin(username,&#96;password&#96;) <br>VALUES(&#39;john1&#39;,&#39;0000&#39;),(&#39;lily&#39;,&#39;0000&#39;),(&#39;rose&#39;,&#39;0000&#39;),(&#39;jack&#39;,&#39;0000&#39;),(&#39;tom&#39;,&#39;0000&#39;);<br>END $<br>#è°ƒç”¨<br>CALL myp1()$<br><br># 2.åˆ›å»ºå¸¦inæ¨¡å¼å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹<br>#æ¡ˆä¾‹1ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹å®ç° æ ¹æ®å¥³ç¥åï¼ŒæŸ¥è¯¢å¯¹åº”çš„ç”·ç¥ä¿¡æ¯<br>CREATE PROCEDURE myp2(IN beautyName VARCHAR(20))<br>BEGIN<br>SELECT bo.*<br>FROM boys bo<br>RIGHT JOIN beauty b ON bo.id &#x3D; b.boyfriend_id<br>WHERE b.name&#x3D;beautyName;<br>END $<br>#è°ƒç”¨<br>CALL myp2(&#39;æŸ³å²©&#39;)$<br>#æ¡ˆä¾‹2 ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹å®ç°ï¼Œç”¨æˆ·æ˜¯å¦ç™»å½•æˆåŠŸ<br>CREATE PROCEDURE myp4(IN username VARCHAR(20),IN PASSWORD VARCHAR(20))<br>BEGIN<br>DECLARE result INT DEFAULT 0;#å£°æ˜å¹¶åˆå§‹åŒ–<br>SELECT COUNT(*) INTO result#èµ‹å€¼<br>FROM admin<br>WHERE admin.username &#x3D; username<br>AND admin.password &#x3D; PASSWORD;<br><br>SELECT IF(result&gt;0,&#39;æˆåŠŸ&#39;,&#39;å¤±è´¥&#39;);#ä½¿ç”¨<br>END $<br>#è°ƒç”¨<br>CALL myp3(&#39;å¼ é£&#39;,&#39;8888&#39;)$<br><br># 3.åˆ›å»ºout æ¨¡å¼å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹<br>#æ¡ˆä¾‹1ï¼šæ ¹æ®è¾“å…¥çš„å¥³ç¥åï¼Œè¿”å›å¯¹åº”çš„ç”·ç¥å<br>CREATE PROCEDURE myp6(IN beautyName VARCHAR(20),OUT boyName VARCHAR(20))<br>BEGIN<br>SELECT bo.boyname INTO boyname<br>FROM boys bo<br>RIGHT JOIN<br>beauty b ON b.boyfriend_id &#x3D; bo.id<br>WHERE b.name&#x3D;beautyName ;<br>END $<br>#è°ƒç”¨<br>CALL myp7(&#39;å°æ˜­&#39;, @name)$<br>SELECT @name$<br>#æ¡ˆä¾‹2ï¼šæ ¹æ®è¾“å…¥çš„å¥³ç¥åï¼Œè¿”å›å¯¹åº”çš„ç”·ç¥åå’Œé­…åŠ›å€¼<br>CREATE PROCEDURE myp7(IN beautyName VARCHAR(20),OUT boyName VARCHAR(20),OUT usercp INT) <br>BEGIN<br>SELECT boys.boyname ,boys.usercp INTO boyname,usercp<br>FROM boys <br>RIGHT JOIN<br>beauty b ON b.boyfriend_id &#x3D; boys.id<br>WHERE b.name&#x3D;beautyName ;<br>END $<br>#è°ƒç”¨<br>CALL myp7(&#39;å°æ˜­&#39;, @name, @cp)$<br>SELECT @name,@cp$<br><br># 4.åˆ›å»ºå¸¦inoutæ¨¡å¼å‚æ•°çš„å­˜å‚¨è¿‡ç¨‹<br>#æ¡ˆä¾‹1ï¼šä¼ å…¥aå’Œbä¸¤ä¸ªå€¼ï¼Œæœ€ç»ˆaå’Œbéƒ½ç¿»å€å¹¶è¿”å›<br>CREATE PROCEDURE myp8(INOUT a INT ,INOUT b INT)<br>BEGIN<br>SET a&#x3D;a*2;<br>SET b&#x3D;b*2;<br>END $<br>#è°ƒç”¨<br>SET @m&#x3D;10$<br>SET @n&#x3D;20$<br>CALL myp8(@m,@n)$<br>SELECT @m,@n$<br><br><br># ä¸‰ã€åˆ é™¤å­˜å‚¨è¿‡ç¨‹<br>#è¯­æ³•ï¼šdrop procedure å­˜å‚¨è¿‡ç¨‹å<br>DROP PROCEDURE p1;<br>DROP PROCEDURE p2,p3;#Ã—<br><br><br># å››ã€æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯<br>DESC myp2; # ä¸å¯ä»¥<br>SHOW CREATE PROCEDURE  myp2;<br></code></pre></td></tr></table></figure><blockquote><ol start="2"><li><strong>å‡½æ•°</strong></li></ol></blockquote><p><strong>å«ä¹‰</strong>ï¼šä¸€ç»„é¢„å…ˆç¼–è¯‘å¥½çš„SQLè¯­å¥çš„é›†åˆï¼Œç†è§£æˆæ‰¹å¤„ç†è¯­å¥<br>1ã€æé«˜ä»£ç çš„é‡ç”¨æ€§<br>2ã€ç®€åŒ–æ“ä½œ<br>3ã€å‡å°‘äº†ç¼–è¯‘æ¬¡æ•°å¹¶ä¸”å‡å°‘äº†å’Œæ•°æ®åº“æœåŠ¡å™¨çš„è¿æ¥æ¬¡æ•°ï¼Œæé«˜äº†æ•ˆç‡</p><p><strong>åŒºåˆ«</strong>ï¼š</p><p>å­˜å‚¨è¿‡ç¨‹ï¼šå¯ä»¥æœ‰0ä¸ªè¿”å›ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªè¿”å›ï¼Œé€‚åˆåšæ‰¹é‡æ’å…¥ã€æ‰¹é‡æ›´æ–°<br>å‡½æ•°ï¼šæœ‰ä¸”ä»…æœ‰1 ä¸ªè¿”å›ï¼Œé€‚åˆåšå¤„ç†æ•°æ®åè¿”å›ä¸€ä¸ªç»“æœ</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># ä¸€ã€åˆ›å»ºè¯­æ³•<br>CREATE FUNCTION å‡½æ•°å(å‚æ•°åˆ—è¡¨) RETURNS è¿”å›ç±»å‹<br>BEGIN<br>å‡½æ•°ä½“<br>END<br>&#x2F;*<br>æ³¨æ„ï¼š<br>1.å‚æ•°åˆ—è¡¨ åŒ…å«ä¸¤éƒ¨åˆ†ï¼š<br>å‚æ•°å å‚æ•°ç±»å‹<br>2.å‡½æ•°ä½“ï¼š<br>è‚¯å®šä¼šæœ‰returnè¯­å¥ï¼Œå¦‚æœæ²¡æœ‰ä¼šæŠ¥é”™<br>å¦‚æœreturnè¯­å¥æ²¡æœ‰æ”¾åœ¨å‡½æ•°ä½“çš„æœ€åä¹Ÿä¸æŠ¥é”™ï¼Œä½†ä¸å»ºè®®<br>return å€¼;<br>3.å‡½æ•°ä½“ä¸­ä»…æœ‰ä¸€å¥è¯ï¼Œåˆ™å¯ä»¥çœç•¥begin end<br>4.ä½¿ç”¨ delimiterè¯­å¥è®¾ç½®ç»“æŸæ ‡è®°<br>*&#x2F;<br><br><br>#äºŒã€è°ƒç”¨è¯­æ³•<br>SELECT å‡½æ•°å(å‚æ•°åˆ—è¡¨)<br><br>#-----------------æ¡ˆä¾‹æ¼”ç¤º-------------------<br># 1.æ— å‚æœ‰è¿”å›<br>#æ¡ˆä¾‹ï¼šè¿”å›å…¬å¸çš„å‘˜å·¥ä¸ªæ•°<br>CREATE FUNCTION myf1() RETURNS INT<br>BEGIN<br>DECLARE c INT DEFAULT 0;#å®šä¹‰å±€éƒ¨å˜é‡<br>SELECT COUNT(*) INTO c#èµ‹å€¼<br>FROM employees;<br>RETURN c;<br>END $<br>SELECT myf1()$<br><br># 2.æœ‰å‚æœ‰è¿”å›<br># æ¡ˆä¾‹1ï¼šæ ¹æ®å‘˜å·¥åï¼Œè¿”å›å®ƒçš„å·¥èµ„<br>CREATE FUNCTION myf2(empName VARCHAR(20)) RETURNS DOUBLE<br>BEGIN<br>SET @sal&#x3D;0;#å®šä¹‰ç”¨æˆ·å˜é‡ <br>SELECT salary INTO @sal   #èµ‹å€¼<br>FROM employees<br>WHERE last_name &#x3D; empName;<br>RETURN @sal;<br>END $<br>SELECT myf2(&#39;k_ing&#39;) $<br># æ¡ˆä¾‹2ï¼šæ ¹æ®éƒ¨é—¨åï¼Œè¿”å›è¯¥éƒ¨é—¨çš„å¹³å‡å·¥èµ„<br>CREATE FUNCTION myf3(deptName VARCHAR(20)) RETURNS DOUBLE<br>BEGIN<br>DECLARE sal DOUBLE ;<br>SELECT AVG(salary) INTO sal<br>FROM employees e<br>JOIN departments d ON e.department_id &#x3D; d.department_id<br>WHERE d.department_name&#x3D;deptName;<br>RETURN sal;<br>END $<br>SELECT myf3(&#39;IT&#39;)$<br><br><br>#ä¸‰ã€æŸ¥çœ‹å‡½æ•°<br>SHOW CREATE FUNCTION myf3;<br><br><br>#å››ã€åˆ é™¤å‡½æ•°<br>DROP FUNCTION myf3;<br><br># æ¡ˆä¾‹: åˆ›å»ºå‡½æ•°ï¼Œå®ç°ä¼ å…¥ä¸¤ä¸ªfloatï¼Œè¿”å›äºŒè€…ä¹‹å’Œ<br>CREATE FUNCTION test_fun1(num1 FLOAT,num2 FLOAT) RETURNS FLOAT<br>BEGIN<br>DECLARE SUM FLOAT DEFAULT 0;<br>SET SUM&#x3D;num1+num2;<br>RETURN SUM;<br>END $<br>SELECT test_fun1(1,2)$<br></code></pre></td></tr></table></figure><h3 id="6-4-æµç¨‹æ§åˆ¶ç»“æ„"><a href="#6-4-æµç¨‹æ§åˆ¶ç»“æ„" class="headerlink" title="6.4  æµç¨‹æ§åˆ¶ç»“æ„"></a>6.4  æµç¨‹æ§åˆ¶ç»“æ„</h3><p>é¡ºåºã€åˆ†æ”¯ã€å¾ªç¯</p><blockquote><ol><li>åˆ†æ”¯ç»“æ„</li></ol></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs mysql"># 1.ifå‡½æ•°<br>&#x2F;*<br>è¯­æ³•ï¼šif(æ¡ä»¶,å€¼1ï¼Œå€¼2)<br>åŠŸèƒ½ï¼šå®ç°åŒåˆ†æ”¯<br>åº”ç”¨åœ¨begin endä¸­æˆ–å¤–é¢<br>*&#x2F;<br><br># 2.caseç»“æ„<br>&#x2F;*<br>è¯­æ³•ï¼š<br>æƒ…å†µ1ï¼šç±»ä¼¼äºswitch<br>case å˜é‡æˆ–è¡¨è¾¾å¼<br>when å€¼1 then è¯­å¥1;<br>when å€¼2 then è¯­å¥2;<br>...<br>else è¯­å¥n;<br>end <br>æƒ…å†µ2ï¼š<br>case <br>when æ¡ä»¶1 then è¯­å¥1;<br>when æ¡ä»¶2 then è¯­å¥2;<br>...<br>else è¯­å¥n;<br>end <br>- åº”ç”¨åœ¨begin end ä¸­æˆ–å¤–é¢<br>å¦‚æœæ”¾åœ¨begin end å¤–é¢ï¼Œä½œä¸ºè¡¨è¾¾å¼ç»“åˆç€å…¶ä»–è¯­å¥ä½¿ç”¨<br>å¦‚æœæ”¾åœ¨begin end é‡Œé¢ï¼Œä¸€èˆ¬ä½œä¸ºç‹¬ç«‹çš„è¯­å¥ä½¿ç”¨<br>- elseè¯­å¥å¯ä»¥çœç•¥ï¼Œå¦‚æœelseçœç•¥äº†ï¼Œå…¨éƒ¨whenéƒ½ä¸æ»¡è¶³ï¼Œåˆ™è¿”å›null<br><br># 3.ifç»“æ„<br>è¯­æ³•ï¼š<br>if æ¡ä»¶1 then è¯­å¥1;<br>elseif æ¡ä»¶2 then è¯­å¥2;<br>....<br>else è¯­å¥n;<br>end if;<br>åŠŸèƒ½ï¼šç±»ä¼¼äºå¤šé‡if<br>åªèƒ½åº”ç”¨åœ¨begin end ä¸­<br></code></pre></td></tr></table></figure><blockquote><ol start="2"><li>å¾ªç¯ç»“æ„</li></ol></blockquote><p><strong>åˆ†ç±»</strong>ï¼š<br>whileã€loopã€repeat</p><p><strong>å¾ªç¯æ§åˆ¶</strong>ï¼š</p><p>iterate ã€æ ‡ç­¾ã€‘ ç±»ä¼¼äº continueï¼Œç»§ç»­ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡<br>leave ã€æ ‡ç­¾ã€‘ ç±»ä¼¼äº  breakï¼Œè·³å‡ºï¼Œç»“æŸå½“å‰æ‰€åœ¨çš„å¾ªç¯</p><p><strong>è¯­æ³•</strong>ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/MySQL%E5%9F%BA%E7%A1%80_1_%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6%E7%BB%93%E6%9E%84.png"></p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#1.æ²¡æœ‰æ·»åŠ å¾ªç¯æ§åˆ¶è¯­å¥<br>#æ¡ˆä¾‹ï¼šæ‰¹é‡æ’å…¥ï¼Œæ ¹æ®æ¬¡æ•°æ’å…¥åˆ°adminè¡¨ä¸­å¤šæ¡è®°å½•<br>DROP PROCEDURE pro_while1$<br>CREATE PROCEDURE pro_while1(IN insertCount INT)<br>BEGIN<br>DECLARE i INT DEFAULT 1;<br>WHILE i&lt;&#x3D;insertCount DO<br>INSERT INTO admin(username,&#96;password&#96;) VALUES(CONCAT(&#39;Rose&#39;,i),&#39;666&#39;);<br>SET i&#x3D;i+1;<br>END WHILE;<br>END $<br>CALL pro_while1(100)$<br><br>#2.æ·»åŠ leaveè¯­å¥<br>#æ¡ˆä¾‹ï¼šæ‰¹é‡æ’å…¥ï¼Œæ ¹æ®æ¬¡æ•°æ’å…¥åˆ°adminè¡¨ä¸­å¤šæ¡è®°å½•ï¼Œå¦‚æœæ¬¡æ•°&gt;20åˆ™åœæ­¢<br>TRUNCATE TABLE admin$<br>DROP PROCEDURE test_while1$<br>CREATE PROCEDURE test_while1(IN insertCount INT)<br>BEGIN<br>DECLARE i INT DEFAULT 1;<br>a:WHILE i&lt;&#x3D;insertCount DO<br>INSERT INTO admin(username,&#96;password&#96;)<br>VALUES(CONCAT(&#39;xiaohua&#39;,i),&#39;0000&#39;);<br>IF i&gt;&#x3D;20 THEN LEAVE a;<br>END IF;<br>SET i&#x3D;i+1;<br>END WHILE a;<br>END $<br>CALL test_while1(100)$<br><br>#3.æ·»åŠ iterateè¯­å¥<br>#æ¡ˆä¾‹ï¼šæ‰¹é‡æ’å…¥ï¼Œæ ¹æ®æ¬¡æ•°æ’å…¥åˆ°adminè¡¨ä¸­å¤šæ¡è®°å½•ï¼Œåªæ’å…¥å¶æ•°æ¬¡<br>TRUNCATE TABLE admin$<br>DROP PROCEDURE test_while1$<br>CREATE PROCEDURE test_while1(IN insertCount INT)<br>BEGIN<br>DECLARE i INT DEFAULT 0;<br>a:WHILE i&lt;&#x3D;insertCount DO<br>SET i&#x3D;i+1;<br>IF MOD(i,2)!&#x3D;0 THEN ITERATE a;<br>END IF;<br><br>INSERT INTO admin(username,&#96;password&#96;)<br>VALUES(CONCAT(&#39;xiaohua&#39;,i),&#39;0000&#39;);<br>END WHILE a;<br>END $<br>CALL test_while1(100)$<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
      <category>MySQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PicGoå›¾åºŠ</title>
    <link href="/2021/03/07/PicGo/"/>
    <url>/2021/03/07/PicGo/</url>
    
    <content type="html"><![CDATA[<h1 id="PicGoå›¾åºŠ"><a href="#PicGoå›¾åºŠ" class="headerlink" title="PicGoå›¾åºŠ"></a>PicGoå›¾åºŠ</h1><h2 id="1-ä¸‹è½½PicGo"><a href="#1-ä¸‹è½½PicGo" class="headerlink" title="1. ä¸‹è½½PicGo"></a>1. ä¸‹è½½PicGo</h2><p><a href="https://github.com/Molunerfinn/PicGo">https://github.com/Molunerfinn/PicGo</a></p><h2 id="2-å®‰è£…PicGo"><a href="#2-å®‰è£…PicGo" class="headerlink" title="2. å®‰è£…PicGo"></a>2. å®‰è£…PicGo</h2><p>ç›´æ¥è¿è¡Œ.exe</p><h2 id="3-æ–°å»ºä¸€ä¸ªgithubä»“åº“"><a href="#3-æ–°å»ºä¸€ä¸ªgithubä»“åº“" class="headerlink" title="3. æ–°å»ºä¸€ä¸ªgithubä»“åº“"></a>3. æ–°å»ºä¸€ä¸ªgithubä»“åº“</h2><p>mycdn</p><h2 id="4-ç”Ÿæˆtoken"><a href="#4-ç”Ÿæˆtoken" class="headerlink" title="4.ç”Ÿæˆtoken"></a>4.ç”Ÿæˆtoken</h2><p>[è¿›å…¥github] -&gt; [ç‚¹å‡»å¤´åƒ] -&gt; [settings] -&gt; [Developers settings] -&gt; [Personal access token]</p><blockquote><p> å¿…é¡»å‹¾é€‰repo</p></blockquote><p>ç”Ÿæˆåå¿…é¡»å¤åˆ¶tokenï¼Œåªæ˜¾ç¤ºä¸€æ¬¡</p><blockquote><p>0cb447c7cb66f97f8dd645d1b30f88b3bda94198</p></blockquote><h2 id="5-é…ç½®PicGo"><a href="#5-é…ç½®PicGo" class="headerlink" title="5. é…ç½®PicGo"></a>5. é…ç½®PicGo</h2><p>æ‰“å¼€PicGoå·¦æ ä¾æ¬¡é€‰æ‹©[å›¾åºŠè®¾ç½®] -&gt; [githubå›¾åºŠ]</p><p>æ ¼å¼ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">ä»“åº“åï¼š ä½ çš„ç”¨æˆ·å/ä»“åº“å<br>åˆ†æ”¯ï¼š main<br>Tokenï¼š <span class="hljs-number">0</span>cb447c7cb66f97f8dd645d1b30f88b3bda94198<br>å­˜å‚¨è·¯å¾„ï¼š img/  <span class="hljs-comment"># è¡¨ç¤ºä¸Šä¼ åˆ°ä½ çš„ä»“åº“çš„imgç›®å½•ä¸‹</span><br>è‡ªå®šä¹‰åŸŸåæ ¼å¼ï¼š https:<span class="hljs-regexp">//</span>cdn.jsdelivr.net<span class="hljs-regexp">/gh/</span>LihengXu/mycdn<br></code></pre></td></tr></table></figure><p>å› ä¸ºgithubçš„æœåŠ¡å™¨åœ¨å›½å¤–ï¼Œæ‰€ä»¥ç”¨æ¥å½“å›¾åºŠçš„æ—¶å€™ï¼Œå›½å†…çš„é€Ÿåº¦éå¸¸æ„Ÿäººï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>jsdelivr</code>æä¾›çš„CDNæœåŠ¡ï¼Œé€Ÿåº¦éå¸¸çš„å¿«ï¼ŒåŸºæœ¬ä¸å¤§çš„å›¾ç‰‡å¯ä»¥ç§’å¼€ã€‚</p><p>æ‰€ä»¥ä¸Šè¿°<strong>è‡ªå®šä¹‰åŸŸå</strong>å®é™…ä¸Šæ˜¯ä½¿ç”¨çš„<code>jsdelivr</code>çš„CDNæœåŠ¡ã€‚</p><h2 id="6-ä¸Šä¼ å›¾ç‰‡"><a href="#6-ä¸Šä¼ å›¾ç‰‡" class="headerlink" title="6. ä¸Šä¼ å›¾ç‰‡"></a>6. ä¸Šä¼ å›¾ç‰‡</h2><p>ç‚¹å‡»ä¸Šä¼ åŒºï¼Œé€‰æ‹©githubå›¾åºŠ</p><p>ç¤ºä¾‹</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/myfig.png"></p>]]></content>
    
    
    <categories>
      
      <category>PicGo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
      <tag>PicGo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HEXOæ¡†æ¶ ä¸ªäººåšå®¢æ­å»º</title>
    <link href="/2020/08/21/HEXO%E6%A1%86%E6%9E%B6%20%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
    <url>/2020/08/21/HEXO%E6%A1%86%E6%9E%B6%20%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="HEXOæ¡†æ¶-ä¸ªäººåšå®¢æ­å»º"><a href="#HEXOæ¡†æ¶-ä¸ªäººåšå®¢æ­å»º" class="headerlink" title="HEXOæ¡†æ¶ ä¸ªäººåšå®¢æ­å»º"></a>HEXOæ¡†æ¶ ä¸ªäººåšå®¢æ­å»º</h1><h2 id="ä¸€ã€-ç¯å¢ƒæ­å»º"><a href="#ä¸€ã€-ç¯å¢ƒæ­å»º" class="headerlink" title="ä¸€ã€ ç¯å¢ƒæ­å»º"></a>ä¸€ã€ ç¯å¢ƒæ­å»º</h2><h3 id="1-nodejså®‰è£…"><a href="#1-nodejså®‰è£…" class="headerlink" title="1. nodejså®‰è£…"></a>1. nodejså®‰è£…</h3><h4 id="1-1-ä¸‹è½½"><a href="#1-1-ä¸‹è½½" class="headerlink" title="1.1 ä¸‹è½½"></a>1.1 ä¸‹è½½</h4><p>ä¸‹è½½åœ°å€ï¼ˆé€‰æ‹©<strong>LTS</strong>ç¨³å®šç‰ˆï¼‰ï¼š<a href="https://nodejs.org/en/">https://nodejs.org/en/</a></p><blockquote><p>ä¸‹è½½ä¹‹åç›´æ¥é»˜è®¤å®‰è£…ï¼Œä¸€è·¯nextï¼ˆå»ºè®®ä¸è¦æ”¾åœ¨Cç›˜ï¼‰</p></blockquote><h4 id="1-2-æµ‹è¯•nodejs"><a href="#1-2-æµ‹è¯•nodejs" class="headerlink" title="1.2 æµ‹è¯•nodejs"></a>1.2 æµ‹è¯•nodejs</h4><p>æ‰“å¼€windowsçš„å‘½ä»¤è¡Œå·¥å…·è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">node -v<br></code></pre></td></tr></table></figure><p>æ˜¾ç¤ºç‰ˆæœ¬å·åˆ™å®‰è£…æˆåŠŸ</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_1_%E6%B5%8B%E8%AF%95nodejs%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F.png"></p><h4 id="1-3-æµ‹è¯•npm"><a href="#1-3-æµ‹è¯•npm" class="headerlink" title="1.3 æµ‹è¯•npm"></a>1.3 æµ‹è¯•npm</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash"> npmæ˜¯nodejså®‰è£…æ—¶é»˜è®¤å®‰è£…çš„</span><br><span class="hljs-meta">#</span><span class="bash"> ç›´æ¥åœ¨windowsçš„å‘½ä»¤è¡Œå·¥å…·è¾“å…¥</span><br>npm -v<br></code></pre></td></tr></table></figure><p>æ˜¾ç¤ºå¦‚ä¸‹åˆ™å®‰è£…æˆåŠŸ, npmç®¡ç†å·¥å…·ç”¨äºå®‰è£…Hexoæ¡†æ¶</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_2_%E6%B5%8B%E8%AF%95npm%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F.png"></p><h4 id="1-4-å®‰è£…nrmï¼ˆéœ€è¦ä¸€ç‚¹è€å¿ƒï¼‰"><a href="#1-4-å®‰è£…nrmï¼ˆéœ€è¦ä¸€ç‚¹è€å¿ƒï¼‰" class="headerlink" title="1.4 å®‰è£…nrmï¼ˆéœ€è¦ä¸€ç‚¹è€å¿ƒï¼‰"></a>1.4 å®‰è£…nrmï¼ˆéœ€è¦ä¸€ç‚¹è€å¿ƒï¼‰</h4><blockquote><p> nrmçš„å®‰è£…åŸå› ï¼šéœ€è¦åˆ‡æ¢ä¸‹è½½æºåˆ°å›½å†…é•œåƒæºï¼Œæå‡ä¸‹è½½é€Ÿåº¦</p></blockquote><ul><li>é»˜è®¤npmçš„å…¨å±€å®‰è£…è·¯å¾„åœ¨Cç›˜ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹åˆ°nodejsçš„å®‰è£…ç›®å½•ï¼Œæ–°å»ºä¸¤ä¸ªæ–‡ä»¶å¤¹: <code>node_global_modules</code> å’Œ <code>node_cache</code></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_3_%E4%BF%AE%E6%94%B9npm%E9%BB%98%E8%AE%A4%E5%85%A8%E5%B1%80%E8%B7%AF%E5%BE%84.png"></p><ul><li><p>åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤ä¿®æ”¹npmé…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm config set prefix &quot;D:\Java\nodejs\node_modules\npm\node_global_modules&quot;<br>npm config set cache &quot;D:\Java\nodejs\node_modules\npm\node_cache&quot;<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œåè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹npmé…ç½®ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm config ls<br></code></pre></td></tr></table></figure></li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_4_npm%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E6%88%90%E5%8A%9F.png"></p><ul><li>éªŒè¯é…ç½®æˆåŠŸåï¼Œéœ€è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œæ–°å»ºä¸€ä¸ªç³»ç»Ÿå˜é‡ï¼Œå˜é‡åï¼š<code>NODE_HOME</code>ï¼Œå˜é‡å€¼ï¼š<code>D:\dev\nodejs</code>ï¼Œæ•ˆæœå¦‚å›¾ï¼š</li></ul><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_5_%E6%B7%BB%E5%8A%A0%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8FNODE_HOME.png"></p><ul><li><p>åœ¨ç³»ç»Ÿç¯å¢ƒå˜é‡<code>Path</code>å˜é‡åä¸­ï¼Œæ–°å»ºå˜é‡å€¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">%</span><span class="bash">NODE_HOME%</span><br><span class="hljs-meta">%</span><span class="bash">NODE_HOME%\node_modules</span><br><span class="hljs-meta">%</span><span class="bash">NODE_HOME%\node_modules\npm\node_global_modules\</span><br></code></pre></td></tr></table></figure></li></ul><p>æ•ˆæœå¦‚å›¾ï¼ˆä¸‹å›¾ç¬¬äºŒä¸ªè·¯å¾„å†™é”™äº†ï¼‰ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_6_%E6%B7%BB%E5%8A%A0%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%88%B0path.png"></p><ul><li><p>ä¿å­˜åé‡æ–°æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼Œæ‰§è¡Œæ€§å…¨å±€å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install nrm -g<br></code></pre></td></tr></table></figure><p>å®‰è£…ç»“æŸåå¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_7_nrm%E5%AE%89%E8%A3%85%E7%BB%93%E6%9E%9C.png"></p></li><li><p>åœ¨å‘½ä»¤è¡Œè¾“å…¥æŒ‡ä»¤æŸ¥çœ‹ä¸‹è½½æºï¼Œå¯èƒ½ä¼šæŠ¥é”™å¦‚ä¸‹å›¾ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nrm ls<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_8_nrm%E6%8A%A5%E9%94%99.png"></p></li><li><p>æ‰¾åˆ°nrmç›®å½•(é”™è¯¯ç¬¬å››è¡Œ)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">at Object.&lt;anonymous&gt; (D:\Java\nodejs\node_modules\npm\node_global_modules\node_modules\nrm\cli.js:17:20)<br></code></pre></td></tr></table></figure></li><li><p>æ‰“å¼€cli.js ç¬¬17è¡Œä¿®æ”¹æˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//const NRMRC = path.join(process.env.HOME, &#x27;.nrmrc&#x27;); (åˆ é™¤)</span><br><span class="hljs-keyword">const</span> NRMRC = path.join(process.env[(process.platform == <span class="hljs-string">&#x27;win32&#x27;</span>) ? <span class="hljs-string">&#x27;USERPROFILE&#x27;</span> : <span class="hljs-string">&#x27;HOME&#x27;</span>], <span class="hljs-string">&#x27;.nrmrc&#x27;</span>);<br></code></pre></td></tr></table></figure></li><li><p>é‡æ–°è¾“å…¥<code>nrm ls</code>æŸ¥çœ‹ä¸‹è½½æº</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_9_%E6%9F%A5%E7%9C%8Bnrm%E4%B8%8B%E8%BD%BD%E6%BA%90.png"></p></li><li><p>ä¿®æ”¹ä¸‹è½½æºæŒ‡ä»¤ï¼Œæ¨èé€‰æ‹©taobao</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">nrm use taobao # é€‰æ‹©æ·˜å®<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-å®‰è£…Hexoæ¡†æ¶"><a href="#2-å®‰è£…Hexoæ¡†æ¶" class="headerlink" title="2. å®‰è£…Hexoæ¡†æ¶"></a>2. å®‰è£…Hexoæ¡†æ¶</h3><h4 id="2-1-å®‰è£…hexo-cliè„šæ‰‹æ¶"><a href="#2-1-å®‰è£…hexo-cliè„šæ‰‹æ¶" class="headerlink" title="2.1 å®‰è£…hexo-cliè„šæ‰‹æ¶"></a>2.1 å®‰è£…hexo-cliè„šæ‰‹æ¶</h4><p>æ‰“å¼€å‘½ä»¤è¡Œè¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm i -g hexo-cli<br></code></pre></td></tr></table></figure><p>å®‰è£…æˆåŠŸå¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_10_hexo-cli%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90.png"></p><h4 id="2-2-éªŒè¯hexo-cliå®‰è£…æˆåŠŸ"><a href="#2-2-éªŒè¯hexo-cliå®‰è£…æˆåŠŸ" class="headerlink" title="2.2 éªŒè¯hexo-cliå®‰è£…æˆåŠŸ"></a>2.2 éªŒè¯hexo-cliå®‰è£…æˆåŠŸ</h4><p>å‘½ä»¤è¡Œè¾“å…¥æµ‹è¯•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo -v<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_11_hexo-cli%E6%B5%8B%E8%AF%95%E5%AE%89%E8%A3%85.png"></p><h3 id="3-å®‰è£…Git"><a href="#3-å®‰è£…Git" class="headerlink" title="3. å®‰è£…Git"></a>3. å®‰è£…Git</h3><p>å…·ä½“å¯ä»¥å‚è€ƒæˆ‘çš„<a href="https://lihengxu.github.io/2020/08/21/gitstudy/">Gitæ€»ç»“</a></p><h2 id="äºŒã€ä½¿ç”¨Hexoæ­å»ºåšå®¢"><a href="#äºŒã€ä½¿ç”¨Hexoæ­å»ºåšå®¢" class="headerlink" title="äºŒã€ä½¿ç”¨Hexoæ­å»ºåšå®¢"></a>äºŒã€ä½¿ç”¨Hexoæ­å»ºåšå®¢</h2><h3 id="1-åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹"><a href="#1-åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹" class="headerlink" title="1. åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹"></a>1. åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹</h3><p>åœ¨æœ¬åœ°ç¡¬ç›˜åˆ›å»ºå¹¶è¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹ï¼ˆblogï¼‰ï¼Œå¹¶åœ¨è¯¥æ–‡ä»¶å¤¹ä¸‹æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·</p><h3 id="2-åˆå§‹åŒ–blogé¡¹ç›®"><a href="#2-åˆå§‹åŒ–blogé¡¹ç›®" class="headerlink" title="2. åˆå§‹åŒ–blogé¡¹ç›®"></a>2. åˆå§‹åŒ–blogé¡¹ç›®</h3><p>ä½¿ç”¨hexoå‘½ä»¤åˆå§‹åŒ–é¡¹ç›®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo init<br></code></pre></td></tr></table></figure><p>åˆå§‹åŒ–é¡¹ç›®æ–‡ä»¶å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_12_blog%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%87%E4%BB%B6.png"></p><h3 id="3-è¿è¡ŒhexoæœåŠ¡é¢„è§ˆåšå®¢"><a href="#3-è¿è¡ŒhexoæœåŠ¡é¢„è§ˆåšå®¢" class="headerlink" title="3. è¿è¡ŒhexoæœåŠ¡é¢„è§ˆåšå®¢"></a>3. è¿è¡ŒhexoæœåŠ¡é¢„è§ˆåšå®¢</h3><p>åœ¨å½“å‰è·¯å¾„ä¸‹è¾“å…¥å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo s<br></code></pre></td></tr></table></figure><p>å‘½ä»¤è¡Œå‡ºç°è®¿é—®è·¯å¾„ï¼Œç›´æ¥ç‚¹å‡»è®¿é—®å³å¯</p><p>é»˜è®¤æ ·å¼å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/hexo%E6%90%AD%E5%BB%BA_13_hexo%E5%8D%9A%E5%AE%A2%E9%A2%84%E8%A7%88.png"></p><h3 id="4-åˆ›å»ºæ–‡ç« "><a href="#4-åˆ›å»ºæ–‡ç« " class="headerlink" title="4. åˆ›å»ºæ–‡ç« "></a>4. åˆ›å»ºæ–‡ç« </h3><p>åœ¨å½“å‰è·¯å¾„ä¸‹è¾“å…¥å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo n &#x27;hexo test&#x27;<br></code></pre></td></tr></table></figure><p>å›è½¦åå‡ºç°ä»¥æ ‡é¢˜å‘½åçš„.mdæ–‡ä»¶è·¯å¾„ï¼Œæ‰“å¼€è¯¥æ–‡ä»¶ç¼–è¾‘æ–‡ç« å†…å®¹</p><h3 id="5-æ›´æ–°æ–‡ç« "><a href="#5-æ›´æ–°æ–‡ç« " class="headerlink" title="5. æ›´æ–°æ–‡ç« "></a>5. æ›´æ–°æ–‡ç« </h3><p>å‘½ä»¤è¡Œè¾“å…¥æŒ‡ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean # æ¸…ç†ç¼“å­˜<br>hexo g # è§£æç”Ÿæˆ<br>hexo s # è¿è¡ŒhexoæœåŠ¡é¢„è§ˆåšå®¢<br></code></pre></td></tr></table></figure><h2 id="ä¸‰ã€-åšå®¢éƒ¨ç½²åˆ°GitHub"><a href="#ä¸‰ã€-åšå®¢éƒ¨ç½²åˆ°GitHub" class="headerlink" title="ä¸‰ã€ åšå®¢éƒ¨ç½²åˆ°GitHub"></a>ä¸‰ã€ åšå®¢éƒ¨ç½²åˆ°GitHub</h2><h3 id="1-ç™»é™†GitHubåˆ›å»ºä»“åº“"><a href="#1-ç™»é™†GitHubåˆ›å»ºä»“åº“" class="headerlink" title="1. ç™»é™†GitHubåˆ›å»ºä»“åº“"></a>1. ç™»é™†GitHubåˆ›å»ºä»“åº“</h3><p>åˆ›å»ºä»“åº“å‘½ï¼šLihengXu.github.io (æ³¨æ„ç¬¬ä¸€ä¸ª.å‰é¢ä¸€å®šæ˜¯è´¦æˆ·å)</p><h3 id="2-åœ¨æœ¬åœ°ç›®å½•å®‰è£…gitéƒ¨ç½²æ’ä»¶"><a href="#2-åœ¨æœ¬åœ°ç›®å½•å®‰è£…gitéƒ¨ç½²æ’ä»¶" class="headerlink" title="2. åœ¨æœ¬åœ°ç›®å½•å®‰è£…gitéƒ¨ç½²æ’ä»¶"></a>2. åœ¨æœ¬åœ°ç›®å½•å®‰è£…gitéƒ¨ç½²æ’ä»¶</h3><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·è¾“å…¥å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install --save hexo-deployer-git # --save è¡¨ç¤ºåªåœ¨æœ¬ç›®å½•ä¸‹å®‰è£…<br></code></pre></td></tr></table></figure><h3 id="3-ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶"><a href="#3-ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶" class="headerlink" title="3. ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶"></a>3. ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶</h3><p>æ‰¾åˆ°<code>_config.yaml</code>æ–‡ä»¶</p><p>æ‰¾åˆ°æœ€ä¸‹é¢çš„<code>deployï¼štype</code> è¿›è¡Œç¼–è¾‘:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Deployment</span><br><span class="hljs-comment">## Docs: https://hexo.io/docs/one-command-deployment</span><br><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">&#x27;git&#x27;</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/LihengXu/LihengXu.github.io.git</span> <br>  <span class="hljs-comment"># repo : githubä¸Šåˆ›å»ºçš„ä»“åº“åœ°å€</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span><br></code></pre></td></tr></table></figure><blockquote><p>ä¸Šé¢çš„repoï¼šå»ºè®®ä½¿ç”¨sshå¹¶ç»‘å®šå…¬é’¥ï¼Œ è¯¦ç»†è§å¦‚ä½•<a href="https://lihengxu.github.io/2020/08/21/Git/#%E4%BD%BF%E7%94%A8%E7%A0%81%E4%BA%91gitee">GItï¼šä½¿ç”¨ç äº‘gitee</a>ï¼ˆgiteeå’Œgithubæ“ä½œæ²¡æœ‰åŒºåˆ«ï¼‰</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">repo:</span> <span class="hljs-string">git@github.com:LihengXu/LihengXu.github.io.git</span><br></code></pre></td></tr></table></figure><h3 id="4-éƒ¨ç½²åˆ°GitHub"><a href="#4-éƒ¨ç½²åˆ°GitHub" class="headerlink" title="4. éƒ¨ç½²åˆ°GitHub"></a>4. éƒ¨ç½²åˆ°GitHub</h3><p>é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œè¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo d<br></code></pre></td></tr></table></figure><p>æç¤ºä½ è¾“å…¥GitHubè´¦æˆ·å’Œå¯†ç åå°†ä»£ç æäº¤åˆ°GitHubä»“åº“</p><p>é€šè¿‡<a href="https://lihengxu.github.io/">GitHubé“¾æ¥</a>å¯è®¿é—®åšå®¢</p><h2 id="å››ã€-æ›´æ¢ä¸»é¢˜"><a href="#å››ã€-æ›´æ¢ä¸»é¢˜" class="headerlink" title="å››ã€ æ›´æ¢ä¸»é¢˜"></a>å››ã€ æ›´æ¢ä¸»é¢˜</h2><h3 id="1-ä¸‹è½½ä¸»é¢˜"><a href="#1-ä¸‹è½½ä¸»é¢˜" class="headerlink" title="1. ä¸‹è½½ä¸»é¢˜"></a>1. ä¸‹è½½ä¸»é¢˜</h3><p>å°†ä¸»é¢˜æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°é¡¹ç›®çš„<code>theme</code>æ–‡ä»¶å¤¹</p><p>åœ¨æœ¬åœ°é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€å‘½ä»¤è¡Œè¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/fluid-dev/hexo-theme-fluid.git themes/fluid<br></code></pre></td></tr></table></figure><h3 id="2-ä¿®æ”¹é…ç½®-config-yml"><a href="#2-ä¿®æ”¹é…ç½®-config-yml" class="headerlink" title="2. ä¿®æ”¹é…ç½® _config.yml"></a>2. ä¿®æ”¹é…ç½® _config.yml</h3><p>æ‰¾åˆ°<code>#Extensions</code>é¡¹çš„theme</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Extensions</span><br><span class="hljs-comment">## Plugins: https://hexo.io/plugins/</span><br><span class="hljs-comment">## Themes: https://hexo.io/themes/</span><br><span class="hljs-attr">theme:</span> <span class="hljs-string">fluid</span><br></code></pre></td></tr></table></figure><p><a href="https://hexo.fluid-dev.com/docs/start/">fluidä¸»é¢˜ä½¿ç”¨æŒ‡å—</a>ï¼Œå¯ä»¥è¿›ä¸€æ­¥è‡ªå®šä¹‰æ›´å¤šè®¾ç½®</p><h3 id="3-æ›´æ–°å¹¶é‡æ–°éƒ¨ç½²"><a href="#3-æ›´æ–°å¹¶é‡æ–°éƒ¨ç½²" class="headerlink" title="3. æ›´æ–°å¹¶é‡æ–°éƒ¨ç½²"></a>3. æ›´æ–°å¹¶é‡æ–°éƒ¨ç½²</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo clean # æ¸…ç†ç¼“å­˜<br>hexo g # è§£æç”Ÿæˆ<br>hexo s # è¿è¡ŒhexoæœåŠ¡é¢„è§ˆ<br>hexo d # éƒ¨ç½²åˆ°github<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitä½¿ç”¨</title>
    <link href="/2020/08/21/Git/"/>
    <url>/2020/08/21/Git/</url>
    
    <content type="html"><![CDATA[<h1 id="Gitåˆæ­¥ä½¿ç”¨"><a href="#Gitåˆæ­¥ä½¿ç”¨" class="headerlink" title="Gitåˆæ­¥ä½¿ç”¨"></a>Gitåˆæ­¥ä½¿ç”¨</h1><p><strong>å‰è¨€</strong>ï¼šç”¨äº†æ¯”è¾ƒé•¿æ—¶é—´çš„githubäº†ï¼Œä¸€ç›´éƒ½ä¸èƒ½æŠŠgitç†æ¸…æ¥šï¼Œäºæ˜¯å†³å®šæ•´ç†ä¸€ä¸‹gitçš„å­¦ä¹ ç¬”è®°ï¼Œä¾›è‡ªå·±æ¢³ç†å’Œå›é¡¾ã€‚</p><p><strong>è¯´æ˜</strong>ï¼šè¿™é‡Œæ€è·¯æ˜¯Bç«™upç‹‚ç¥çš„gitæ•™å­¦<a href="https://www.bilibili.com/video/BV1FE411P7B3?p=1">ç‹‚ç¥èŠGit</a>ï¼Œç»™å¤§å®¶å®‰åˆ©ä¸€ä¸‹è¿™ä¸ªupï¼Œä»–è®¸å¤šè§†é¢‘éƒ½å¾ˆä¸é”™ã€‚</p><hr><h2 id="ç‰ˆæœ¬æ§åˆ¶"><a href="#ç‰ˆæœ¬æ§åˆ¶" class="headerlink" title="ç‰ˆæœ¬æ§åˆ¶"></a>ç‰ˆæœ¬æ§åˆ¶</h2><blockquote><p><strong>ç‰ˆæœ¬æ§åˆ¶</strong>  ç‰ˆæœ¬è¿­ä»£çš„ç‰ˆæœ¬ç®¡ç†å™¨(Revision control)</p></blockquote><p>å°¤å…¶åœ¨å¤šäººå¼€å‘ä¸­ï¼Œä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å°¤ä¸ºé‡è¦</p><blockquote><p><strong>å¸¸è§çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·</strong></p></blockquote><p>ä¸»æµçš„ç‰ˆæœ¬æ§åˆ¶å™¨æœ‰ï¼š</p><ul><li><strong>Git</strong></li><li><strong>SVN</strong> (subversion)</li><li><strong>CVS</strong> (Concurrent Version System)</li><li><strong>VSS</strong> (Micorosoft Visual SourceSafe)</li><li><strong>TFS</strong> (Team Foudation Server)</li><li>Visual Studio Online</li></ul><p>ç°åœ¨å½±å“åŠ›æœ€å¤§ä¹Ÿæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„æ˜¯<strong>Git</strong>å’Œ<strong>SVN</strong></p><blockquote><p><strong>ç‰ˆæœ¬æ§åˆ¶åˆ†ç±»</strong></p></blockquote><ol><li><p><strong>æœ¬åœ°ç‰ˆæœ¬æ§åˆ¶</strong></p><p>è®°å½•æ–‡ä»¶æ¯æ¬¡æ›´æ–°ï¼Œå¯ä»¥å¯¹æ¯ä¸ªç‰ˆæœ¬åšä¸€ä¸ªå¿«ç…§ï¼Œæˆ–è€…æ˜¯è®°å½•è¡¥ä¸æ–‡ä»¶ï¼Œé€‚ç”¨äºä¸ªäººï¼Œå¦‚RCSã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_1_%E6%9C%AC%E5%9C%B0%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86.png"></p></li><li><p><strong>é›†ä¸­ç‰ˆæœ¬æ§åˆ¶</strong></p><p>æ‰€æœ‰ç‰ˆæœ¬æ•°æ®éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼ŒååŒå¼€å‘è€…ä»æœåŠ¡å™¨ä¸ŠåŒæ­¥æ›´æ–°æˆ–è€…ä¸Šä¼ è‡ªå·±çš„ä¿®æ”¹ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_2_%E9%9B%86%E4%B8%AD%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86.png"></p><p>æ‰€æœ‰çš„ç‰ˆæœ¬æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·æœ¬åœ°åªæœ‰è‡ªå·±çš„ä»¥å‰æ‰€åŒæ­¥çš„ç‰ˆæœ¬ï¼Œå¦‚æœä¸è”ç½‘ï¼Œç”¨æˆ·çœ‹ä¸åˆ°å†å²ç‰ˆæœ¬ï¼Œä¹Ÿåˆé¥­åˆ‡æ¢ç‰ˆæœ¬éªŒè¯é—®é¢˜ï¼Œæˆ–è€…ä¸åŒåˆ†æ”¯å·¥ä½œã€‚è€Œä¸”ï¼Œæ‰€æœ‰æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å•ä¸€æœåŠ¡å™¨ä¸Šï¼Œä¸€æ—¦æœåŠ¡å™¨æŸåå°±ä¼šä¸¢å¤±æ‰€æœ‰æ•°æ®ï¼Œéœ€è¦å®šæœŸå¤‡ä»½ã€‚ä»£è¡¨æœ‰ï¼š<strong>SVN CVS VSS</strong></p></li><li><p><strong>åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶</strong></p><p>æ‰€æœ‰ç‰ˆæœ¬æ˜Ÿä¿¡æ¯å…¨éƒ¨åŒæ­¥åˆ°æœ¬åœ°çš„æ¯ä¸€ä¸ªç”¨æˆ·ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æœ¬åœ°æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬å†å²ï¼Œå¯ä»¥ç¦»çº¿åœ¨æœ¬åœ°æäº¤ï¼Œåªéœ€è¦åœ¨è¿ç½‘æ—¶pushåˆ°ç›¸åº”çš„æœåŠ¡å™¨æˆ–è€…å…¶ä»–ç”¨æˆ·é‚£é‡Œã€‚ç”±äºæ¯ä¸€ä¸ªç”¨æˆ·ä¿å­˜çš„éƒ½æ˜¯æ‰€æœ‰çš„ç‰ˆæœ¬æ•°æ®ï¼Œåªè¦æœ‰ä¸€ä¸ªç”¨æˆ·è®¾å¤‡æ²¡æœ‰é—®é¢˜å°±å¯ä»¥æ¢å¤æ‰€æœ‰çš„æ•°æ®ï¼Œä½†è¿™å¢åŠ äº†æœ¬åœ°å­˜å‚¨ç©ºé—´çš„å ç”¨ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_3_%E5%88%86%E5%B8%83%E5%BC%8F%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86.png"></p></li></ol><blockquote><p><strong>Gitå’ŒSVNçš„åŒºåˆ«</strong></p></blockquote><p><strong>SVN</strong>æ˜¯é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œç‰ˆæœ¬åº“é›†ä¸­æ”¾åœ¨ä¸­å¤®æœåŠ¡å™¨çš„ï¼Œè€Œå·¥ä½œçš„æ—¶å€™ï¼Œç”¨è‡ªå·±ç”µè„‘é¦–å…ˆè¦ä»é‡è¦æœåŠ¡å™¨å¾—åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åå·¥ä½œï¼Œå®Œæˆå·¥ä½œåéœ€è¦æ¨é€åˆ°ä¸­å¤®æœåŠ¡å™¨ã€‚é›†ä¸­å®ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿå¿…é¡»è”ç½‘æ‰èƒ½å·¥ä½œï¼Œå¯¹ç½‘ç»œå¸¦å®½è¦æ±‚è¾ƒé«˜</p><p><strong>Git</strong>æ˜¯åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ²¡æœ‰ä¸­å¤®æœåŠ¡å™¨ï¼Œæ¯ä¸ªäººçš„ç”µè„‘å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç‰ˆæœ¬åº“ï¼Œå·¥ä½œçš„æ—¶å€™ä¸éœ€è¦è”ç½‘ï¼Œå› ä¸ºç‰ˆæœ¬éƒ½åœ¨è‡ªå·±ç”µè„‘ä¸Šã€‚ååŒæ–¹å¼ï¼šä½ åœ¨ç”µè„‘ä¸Šä¿®æ”¹äº†æ–‡ä»¶Aï¼Œå…¶ä»–äººä¹Ÿä¿®æ”¹äº†æ–‡ä»¶Aï¼Œä½ ä»¬ä¿©åªéœ€è¦æŠŠå„è‡ªçš„ä¿®æ”¹æ¨é€ç»™å¯¹æ–¹ï¼Œå°±å¯ä»¥äº’ç›¸çœ‹åˆ°å¯¹æ–¹çš„ä¿®æ”¹äº†ã€‚Gitå¯ä»¥ç›´æ¥çœ‹åˆ°ã€‚</p><p><strong>Gitæ˜¯ç›®å‰ä¸–ç•Œä¸Šæœ€å…ˆè¿›çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚</strong></p><h2 id="Gitçš„è¯ç”Ÿ"><a href="#Gitçš„è¯ç”Ÿ" class="headerlink" title="Gitçš„è¯ç”Ÿ"></a>Gitçš„è¯ç”Ÿ</h2><p><strong>GIt</strong>æ˜¯Linuxç¤¾åŒº (ç‰¹åˆ«æ˜¯Linuxçš„ç¼”é€ è€…<strong>Linus Torvalds</strong>) åŸºäºä½¿ç”¨<strong>BitKeeper</strong>æ—¶çš„ç»éªŒæ•™è®­ï¼Œå¼€å‘å‡ºçš„è‡ªå·±çš„ç‰ˆæœ¬ç³»ç»Ÿã€‚å¤§çº¦èŠ±äº†<strong>ä¸¤å‘¨å·¦å³</strong>ï¼Œä¹Ÿå°±æ˜¯åæ¥çš„<strong>Git</strong>ã€‚</p><p><strong>Git</strong>æ˜¯å…è´¹çš„ã€å¼€æºçš„ã€æœ€åˆGitæ˜¯ä¸ºè¾…åŠ©Linuxå†…æ ¸å¼€å‘çš„ï¼Œæ¥ä»£æ›¿BitKeeperã€‚</p><h2 id="Gitç¯å¢ƒé…ç½®"><a href="#Gitç¯å¢ƒé…ç½®" class="headerlink" title="Gitç¯å¢ƒé…ç½®"></a>Gitç¯å¢ƒé…ç½®</h2><blockquote><p><strong>Gitä¸‹è½½</strong></p></blockquote><p>æ‰“å¼€å®˜ç½‘<a href="https://git-scm.com/">gitå®˜ç½‘</a>ï¼Œä¸‹è½½gitå¯¹åº”æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬</p><p>ä¸‹è½½è¿‡æ…¢å°±æ˜¯ç”¨é•œåƒä¸‹è½½<a href="http://npm.taobao.org/mirrors/git-for-windows/">æ·˜å®é•œåƒ</a></p><blockquote><p><strong>Gitå¸è½½</strong></p></blockquote><p>ç›´æ¥åå®‰è£…å³å¯ã€æ¸…ç†ç¯å¢ƒå˜é‡</p><blockquote><p><strong>Gitå®‰è£…</strong></p></blockquote><p>æ— è„‘ä¸‹ä¸€æ­¥å®‰è£…å³å¯ã€‚</p><blockquote><p><strong>å¯åŠ¨Git</strong></p></blockquote><p>å®‰è£…æˆåŠŸåå¼€å§‹èœå•ä¼šæœ‰Gité¡¹ï¼Œèœå•ä¸‹æœ‰3ä¸ªç¨‹åºï¼šä»»æ„æ–‡ä»¶å¤¹ä¸‹å³é”®ä¹Ÿå¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç¨‹åº</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_4_git%E9%80%89%E9%A1%B9.png"></p><p><strong>Git Bash</strong>:  Unixä¸Linuxé£æ ¼çš„å‘½ä»¤è¡Œï¼Œä½¿ç”¨æœ€å¤šï¼Œæ¨èæœ€å¤š</p><p><strong>Git CMD</strong>:  Windowsé£æ ¼çš„å‘½ä»¤è¡Œ</p><p><strong>GIt GUI</strong>:  å›¾å½¢ç•Œé¢çš„GItï¼Œä¸å»ºè®®åˆå­¦è€…ä½¿ç”¨ï¼Œå°½é‡å…ˆç†Ÿæ‚‰å¸¸ç”¨çš„å‘½ä»¤</p><blockquote><p><strong>åŸºæœ¬çš„Linuxå‘½ä»¤</strong></p></blockquote><ol><li><p><strong>cd</strong> æ”¹å˜ç›®å½•</p></li><li><p><strong>cd ..</strong> å›é€€åˆ°ä¸Šä¸€ä¸ªç›®å½•ï¼Œç›´æ¥cdè¿›å…¥é»˜è®¤ç›®å½•</p></li><li><p><strong>pwd</strong> æ˜¾ç¤ºå½“å‰ç›®å½•è·¯å¾„</p></li><li><p><strong>ls(ll)</strong> éƒ½æ˜¯åˆ—å‡ºå½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼Œåªä¸è¿‡ll(ä¸¤ä¸ªll)åˆ—å‡ºçš„å†…å®¹æ›´åŠ è¯¦ç»†</p></li><li><p><strong>touch</strong> æ–°å»ºä¸€ä¸ªæ–‡ä»¶ å¦‚ touch index.js å°±ä¼šåœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªindex.jsæ–‡ä»¶ã€‚</p></li><li><p><strong>rm</strong> åˆ é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œrm index.js å°±ä¼šæŠŠindex.jsåˆ é™¤æ‰</p></li><li><p><strong>mkdir</strong> æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œå°±æ˜¯æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</p></li><li><p><strong>rm -r</strong> åˆ é™¤ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œrm -r src åˆ é™¤srcç›®å½•</p><p>åˆ‡å‹¿éšæ„åœ¨Linuxç³»ç»Ÿä¸­ä½¿ç”¨<strong>rm -rf /</strong> ï¼Œä¼šä»æ ¹ç›®å½•å…¨éƒ¨é€’å½’åˆ é™¤ï¼Œé‚£ä¹ˆä¼šåˆ é™¤ç”µè„‘ä¸­å…¨éƒ¨æ–‡ä»¶ã€‚</p></li><li><p><strong>mv</strong> ç§»åŠ¨æ–‡ä»¶ï¼Œmv index.html src index.html æ˜¯æˆ‘ä»¬è¦ç§»åŠ¨çš„æ–‡ä»¶ï¼Œsrcæ˜¯ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œè¿™ä¹ˆå†™å¿…é¡»åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚</p></li><li><p><strong>reset</strong> é‡æ–°åˆå§‹åŒ–ç»ˆç«¯/æ¸…å±</p></li><li><p><strong>clear</strong> æ¸…å±</p></li><li><p><strong>history</strong> æŸ¥çœ‹å‘½ä»¤å†å²</p></li><li><p><strong>help</strong> å¸®åŠ©</p></li><li><p><strong>exit</strong> é€€å‡º</p></li><li><p>**#**è¡¨ç¤ºæ³¨é‡Š</p></li></ol><blockquote><p><strong>Gité…ç½®</strong></p></blockquote><p>æŸ¥çœ‹é…ç½® <strong>git config -l</strong></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_5_git%E9%85%8D%E7%BD%AE.png"></p><p>æŸ¥çœ‹ä¸åŒçº§åˆ«çš„é…ç½®æ–‡ä»¶ (éƒ½ä¿å­˜åœ¨æœ¬åœ°) ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹ç³»ç»Ÿconfig</span><br>git config --system --list<br><br><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ç”¨æˆ·(global)é…ç½®</span><br>git config --global --list<br></code></pre></td></tr></table></figure><p><strong>Gitç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼š</strong></p><ol><li>Git\etc\gitconfig : Git å®‰è£…ç›®å½•ä¸‹çš„gitconfig â€“system ç³»ç»Ÿçº§</li><li>C:\UsersAdminstrator\ .gitconfig åªé€‚ç”¨äºå½“å‰ç™»å½•ç”¨æˆ·é…ç½® â€“global å…¨å±€</li></ol><p>è¿™é‡Œå¯ä»¥ç›´æ¥ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡å‘½ä»¤è®¾ç½®åä¼šå“åº”åˆ°è¿™é‡Œ</p><blockquote><p><strong>é…ç½®ç”¨æˆ·åä¸é‚®ç®± (ç”¨æˆ·æ ‡è¯†ï¼Œå¿…è¦)</strong></p></blockquote><p>å½“ä½ å®‰è£…gitåé¦–å…ˆè¦è®¾ç½®ä½ çš„ç”¨æˆ·åå’Œe-mailåœ°å€ã€‚è¿™éå¸¸é‡è¦ï¼Œæ¯æ¬¡gitæäº¤éƒ½ä¼šä½¿ç”¨è¯¥ä¿¡æ¯ã€‚å®ƒä¼šè¢«æ°¸è¿œåµŒå…¥åˆ°ä½ çš„æäº¤ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config --global user.name <span class="hljs-string">&quot;lihengxu&quot;</span> <span class="hljs-comment"># åç§°</span><br>git config --global user.email 15882320389@163.com <span class="hljs-comment"># é‚®ç®±</span><br></code></pre></td></tr></table></figure><p>åªéœ€è¦è®¾ç½®ä¸€æ¬¡ï¼Œåªè¦ä¼ é€’äº†â€“globalé€‰é¡¹ï¼ŒGitå°†æ€»ä¼šä½¿ç”¨è¯¥ä¿¡æ¯æ¥å¤„ç†ä½ åœ¨ç³»ç»Ÿä¸­çš„ä¸€åˆ‡å¤„ç†ã€‚å¦‚æœä½ å¸Œæœ›åœ¨ä¸€ä¸ªç‰¹å®šçš„é¡¹ç›®ä¸­ä½¿ç”¨ä¸åŒçš„åç§°æˆ–emailåœ°å€ï¼Œä½ å¯ä»¥åœ¨è¯¥é¡¹ç›®è¿è¡Œè¯¥å‘½ä»¤è€Œä¸è¦â€“globalé€‰é¡¹ã€‚æ€»ä¹‹â€“globalä¸ºå…¨å±€é…ç½®ï¼Œä¸åŠ ä¸ºæŸä¸€ä¸ªé¡¹ç›®çš„ç‰¹å®šé…ç½®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_6_git%E9%85%8D%E7%BD%AE--global.png"></p><h2 id="GitåŸºæœ¬ç†è®º-æ ¸å¿ƒ"><a href="#GitåŸºæœ¬ç†è®º-æ ¸å¿ƒ" class="headerlink" title="GitåŸºæœ¬ç†è®º (æ ¸å¿ƒ)"></a>GitåŸºæœ¬ç†è®º (æ ¸å¿ƒ)</h2><blockquote><p><strong>å·¥ä½œåŒºåŸŸ</strong></p></blockquote><p>Gitæœ¬åœ°æœ‰ä¸‰ä¸ªå·¥ä½œåŒºåŸŸï¼š</p><ol><li>å·¥ä½œç›®å½•(Working Direcitory)</li><li>æš‚å­˜åŒº(Stage/Index)</li><li>èµ„æºåŒº(Repository æˆ– GIt Directory)</li></ol><p>å¦‚æœåŠ ä¸Šè¿œç¨‹çš„</p><ol start="4"><li>Gitä»“åº“(Remote Directory)</li></ol><p>å°±å¯ä»¥åˆ†ä¸º4ä¸ªå·¥ä½œåŒºåŸŸï¼Œè½¬æ¢å…³ç³»å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_7_git%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%9F%9F.png"></p><ul><li><strong>Workspace</strong>: å·¥ä½œåŒºï¼Œå°±æ˜¯å¹³æ—¶ä½ å­˜æ”¾é¡¹ç›®ä»£ç çš„åœ°æ–¹</li><li><strong>Index/Stage</strong>ï¼š æš‚å­˜åŒºï¼Œç”¨äºå¹³æ—¶å­˜æ”¾ä½ çš„æ”¹åŠ¨ï¼Œäº‹å®ä¸Šå®ƒåªæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¿å­˜å³å°†æäº¤åˆ°æ–‡ä»¶åˆ—è¡¨ä¿¡æ¯ã€‚</li><li><strong>Repository</strong>ï¼šä»“åº“åŒº(æˆ–è€…æœ¬åœ°ä»“åº“)ï¼Œ å°±æ˜¯å®‰å…¨å­˜æ”¾æ•°æ®çš„ä½ç½®ï¼Œè¿™é‡Œé¢æœ‰ä½ æäº¤çš„æ‰€æœ‰ç‰ˆæœ¬æ•°æ®ã€‚å…¶ä¸­HEADæŒ‡å‘æœ€æ–°æ”¾å…¥ä»“åº“çš„ç‰ˆæœ¬ã€‚</li><li><strong>Remote</strong>ï¼šè¿œç¨‹ä»“åº“ï¼Œæ‰˜ç®¡ä»£ç çš„æœåŠ¡å™¨ï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºæ˜¯ä½ é¡¹ç›®ç»„ä¸­çš„ä¸€å°ç”µè„‘ç”¨äºè¿œç¨‹æ•°æ®äº¤æ¢ã€‚</li></ul><p>æœ¬åœ°ä¸‰ä¸ªåŒºåŸŸç¡®åˆ‡çš„è¯´åº”è¯¥æ˜¯gitä»“åº“ä¸­HEADæŒ‡å‘çš„ç‰ˆæœ¬ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_8_HEAD%E6%8C%87%E5%90%91%E7%9A%84%E7%89%88%E6%9C%AC.png"></p><ul><li><strong>Directory</strong>ï¼šä½¿ç”¨GItç®¡ç†çš„ç›®å½•ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªä»“åº“ï¼ŒåŒ…å«æˆ‘ä»¬çš„å·¥ä½œç©ºé—´å’ŒGitçš„ç®¡ç†ç©ºé—´ã€‚</li><li><strong>WorkSpace</strong>ï¼šéœ€è¦é€šè¿‡Gitè¿›è¡Œç‰ˆæœ¬æ§åˆ¶çš„ç›®å½•å’Œæ–‡ä»¶ï¼Œè¿™äº›ç›®å½•å’Œæ–‡ä»¶ç»„æˆäº†å·¥ä½œç©ºé—´</li><li><strong>.git</strong>ï¼šå­˜æ”¾ç®¡ç†ä¿¡æ¯çš„ç›®å½•ï¼Œåˆå§‹åŒ–ä»“åº“çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºã€‚</li><li><strong>Index/Stage</strong>ï¼šæš‚å­˜åŒºï¼Œæˆ–è€…å«å¾…æäº¤æ›´æ–°åŒºï¼Œåœ¨æäº¤è¿›å…¥repoä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„æ›´æ–°æ”¾åœ¨æš‚å­˜åŒºã€‚</li><li><strong>Local Repo</strong>ï¼šæœ¬åœ°ä»“åº“ï¼Œä¸€ä¸ªå­˜æ”¾åœ¨æœ¬åœ°çš„ç‰ˆæœ¬åº“ï¼›HEADä¼šåªæ˜¯å½“å‰çš„å¼€å‘åˆ†æ”¯(branch)ã€‚</li><li><strong>Stash</strong>ï¼šéšè—ï¼Œæ˜¯ä¸€ä¸ªå·¥ä½œçŠ¶æ€ä¿å­˜æ ˆï¼Œç”¨äºä¿å­˜/æ¢å¤WorkSpaceä¸­çš„ä¸´æ—¶çŠ¶æ€ã€‚</li></ul><blockquote><p><strong>å·¥ä½œæµç¨‹</strong></p></blockquote><p>gitçš„å·¥ä½œæµç¨‹ä¸€èˆ¬æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>åœ¨å·¥ä½œç›®å½•ä¸­æ·»åŠ ã€ä¿®æ”¹æ–‡ä»¶ï¼›</li><li>å°†éœ€è¦è¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºåŸŸï¼›</li><li>å°†æš‚å­˜åŒºåŸŸçš„æ–‡ä»¶æäº¤åˆ°gitä»“åº“ã€‚</li></ol><p>å› æ­¤ï¼Œgitç®¡ç†æ–‡ä»¶æœ‰ä¸‰ç§çŠ¶æ€ï¼šå·²ä¿®æ”¹(modified)ã€å·²æš‚å­˜(staged)ã€å·²æäº¤(committed)</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_9_git%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B.png"></p><h2 id="Gité¡¹ç›®æ­å»º"><a href="#Gité¡¹ç›®æ­å»º" class="headerlink" title="Gité¡¹ç›®æ­å»º"></a>Gité¡¹ç›®æ­å»º</h2><blockquote><p>åˆ›å»ºå·¥ç¨‹ç›®å½•ä¸å¸¸ç”¨æŒ‡ä»¤</p></blockquote><p>å·¥ä½œç›®å½•(WorkSpace)ä¸€èˆ¬å°±æ˜¯ä½ å¸Œæœ›Gitå¸®åŠ©ä½ ç®¡ç†çš„æ–‡ä»¶å¤¹ï¼Œå¯ä»¥æ˜¯ä½ çš„é¡¹ç›®çš„ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç©ºç›®å½•ï¼Œå»ºè®®ä¸è¦æœ‰ä¸­æ–‡ï¼Œæ—¥å¸¸ä½¿ç”¨ä¸€ä¸‹å›¾ä¸­6ä¸ªå‘½ä»¤ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_10_git%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%9F%9F%E7%9A%84%E5%85%B3%E7%B3%BB.png"></p><blockquote><p>æœ¬åœ°ä»“åº“æ­å»º</p></blockquote><p>åˆ›å»ºæœ¬åœ°ä»“åº“æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ˜¯åˆ›å»ºä¸€ä¸ªå…¨æ–°ä»“åº“ï¼Œå¦ä¸€ç§æ˜¯å…‹éš†è¿œç¨‹ä»“åº“ã€‚</p><ol><li><p>åˆ›å»ºå…¨æ–°ä»“åº“ï¼Œéœ€è¦ç”¨GITç®¡ç†çš„é¡¹ç›®çš„æ ¹ç›®å½•æ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å½“å‰ç›®å½•ä¸­æ–°å»ºä¸€ä¸ªGitä»£ç åº“</span><br>$ git init<br></code></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œåå¯ä»¥çœ‹åˆ°ï¼Œä»…ä»…åœ¨é¡¹ç›®ä¸­å¤šå‡ºäº†ä¸€ä¸ª.gitç›®å½•ï¼Œå…³äºç‰ˆæœ¬ç­‰çš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨è¿™ä¸ªç›®å½•é‡Œé¢ã€‚</p></li></ol><blockquote><p>å…‹éš†è¿œç¨‹ä»“åº“</p></blockquote><ol><li><p>å¦ä¸€ç§æ–¹å¼æ˜¯å…‹éš†è¿œç¨‹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯å°†è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ä»“åº“å®Œå…¨é•œåƒä¸€ä»½åˆ°æœ¬åœ°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å…‹éš†ä¸€ä¸ªé¡¹ç›®å’Œå®ƒæ•´ä¸ªå†å²ä»£ç (ç‰ˆæœ¬ä¿¡æ¯)</span><br>$ git <span class="hljs-built_in">clone</span> https://github.com/LihengXu/WPS_Apolloscape.git<br></code></pre></td></tr></table></figure></li><li><p>å»giteeæˆ–è€…githubä¸Šå…‹éš†ä¸€ä¸ªæµ‹è¯•</p></li></ol><h2 id="Gitæ–‡ä»¶æ“ä½œ"><a href="#Gitæ–‡ä»¶æ“ä½œ" class="headerlink" title="Gitæ–‡ä»¶æ“ä½œ"></a>Gitæ–‡ä»¶æ“ä½œ</h2><blockquote><p><strong>æ–‡ä»¶4ç§çŠ¶æ€</strong></p></blockquote><p>ç‰ˆæœ¬æ§åˆ¶å°±æ˜¯å¯¹æ–‡ä»¶çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œè¦å¯¹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œæäº¤ç­‰æ“ä½œï¼Œé¦–å…ˆè¦çŸ¥é“æ–‡ä»¶å½“å‰åœ¨ä»€ä¹ˆçŠ¶æ€ï¼Œä¸ç„¶å¯èƒ½ä¼šæäº¤äº†ç°åœ¨ä¸æƒ³æäº¤çš„æ–‡ä»¶ï¼Œæˆ–è€…è¦æäº¤çš„æ–‡ä»¶æ²¡æœ‰æäº¤ä¸Šã€‚</p><ul><li><strong>Untracked</strong>ï¼šæœªè·Ÿè¸ªï¼Œæ­¤æ–‡ä»¶åœ¨æ–‡ä»¶å¤¹ç§ï¼Œå¹¶æ²¡æœ‰åŠ å…¥åˆ°gitåº“ï¼Œä¸å‚ä¸ç‰ˆæœ¬æ§åˆ¶ï¼Œé€šè¿‡<code>git add</code> çŠ¶æ€å˜ä¸º <code>staged</code></li><li><strong>Unmodify</strong>ï¼šæ–‡ä»¶å·²ç»å…¥åº“ï¼Œæœªä¿®æ”¹ï¼Œå³ç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶å¿«ç…§å†…å®¹ä¸æ–‡ä»¶å¤¹ä¸­çš„å®Œå…¨ä¸€è‡´ã€‚è¿™ç§ç±»å‹çš„æ–‡ä»¶æœ‰ä¸¤ç§å»å¤„ï¼Œå¦‚æœå®ƒè¢«ä¿®æ”¹ï¼Œè€Œå˜ä¸º<code>Modified</code>ï¼Œå¦‚æœä½¿ç”¨<code>git rm</code>ç§»å‡ºç‰ˆæœ¬åº“ï¼Œåˆ™æˆä¸º<code>untracked</code>æ–‡ä»¶</li><li><strong>Modified</strong>ï¼šæ–‡ä»¶å·²ä¿®æ”¹ï¼Œä»…ä»…æ˜¯ä¿®æ”¹ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå…¶ä»–çš„æ“ä½œã€‚è¿™ä¸ªæ–‡ä»¶ä¹Ÿæœ‰ä¸¤ä¸ªå»å¤„ï¼Œé€šè¿‡<code>git add</code>å¯ä»¥è¿›å…¥æš‚å­˜<code>staged</code>çŠ¶æ€ï¼Œä½¿ç”¨<code>git checkout</code>åˆ™ä¸¢å¼ƒä¿®æ”¹ï¼Œè¿”å›åˆ°<code>Unmodify</code>çŠ¶æ€ï¼Œè¿™ä¸ª<code>git checkout</code> å³ä»åº“ä¸­å–å‡ºæ–‡ä»¶ï¼Œè¦†ç›–å½“å‰ä¿®æ”¹ã€‚</li><li><strong>Staged</strong>ï¼šæš‚å­˜çŠ¶æ€ã€‚æ‰§è¡Œ<code>git commit</code>åˆ™å°†ä¿®æ”¹åŒæ­¥åˆ°åº“ä¸­ï¼Œè¿™æ˜¯åº“ä¸­æ–‡ä»¶å’Œæœ¬åœ°æ–‡ä»¶å³è¾¹ä¸ºä¸€è‡´ï¼Œæ–‡ä»¶ä¸º<code>Unmodify</code>çŠ¶æ€ã€‚æ‰§è¡Œ<code>git reset HEAD filename</code>å–æ¶ˆæš‚å­˜ï¼Œæ–‡ä»¶çŠ¶æ€ä¸º<code>Modified</code>ã€‚</li></ul><blockquote><p><strong>æŸ¥çœ‹æ–‡ä»¶çŠ¶æ€</strong></p></blockquote><p>ä¸Šé¢è¯´æ–‡ä»¶æœ‰4ç§çŠ¶æ€ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶çŠ¶æ€</span><br>git status [filename]<br><br><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶çŠ¶æ€</span><br>git status<br><br><span class="hljs-comment"># æ·»åŠ æ‰€æœ‰æ–‡ä»¶åˆ°æš‚å­˜åŒº</span><br>git add .<br><br><span class="hljs-comment"># åˆ é™¤ä»“åº“ä¸­çš„&quot;README.en.md&quot;æ–‡ä»¶</span><br>git rm README.en.md<br><br><span class="hljs-comment"># æäº¤æš‚å­˜åŒºä¸­å†…å®¹åˆ°æœ¬åœ°ä»“åº“ï¼Œ-m æäº¤ä¿¡æ¯</span><br>git commit -m <span class="hljs-string">&quot;for test&quot;</span><br><br><span class="hljs-comment"># æäº¤è‡³è¿œç¨‹ä»“åº“</span><br>git push<br></code></pre></td></tr></table></figure><blockquote><p><strong>å¿½ç•¥æ–‡ä»¶</strong></p></blockquote><p>æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¸æƒ³æŠŠæŸäº›æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶ä¸­ï¼Œæ¯”å¦‚æ•°æ®åº“æ–‡ä»¶ï¼Œä¸´æ—¶æ–‡ä»¶ï¼Œè®¾è®¡æ–‡ä»¶ç­‰</p><p>åœ¨ä¸»ç›®å½•ä¸‹é¢å»ºç«‹ä¸€ä¸ªâ€.gitignoreâ€æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶æœ‰å¦‚ä¸‹è§„åˆ™ï¼š</p><ol><li>å¿½ç•¥æ–‡ä»¶ä¸­çš„ç©ºè¡Œæˆ–è€…ä»¥äº•å·(#)å¼€å§‹çš„è¡Œå°†ä¼šè¢«å¿½ç•¥ã€‚</li><li>å¯ä»¥ä½¿ç”¨Linuxé€šé…ç¬¦ã€‚ä¾‹å¦‚ï¼šæ˜Ÿå·(*)ä»£è¡¨ä»»æ„å¤šå­—ç¬¦ï¼Œé—®å·(?)ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œæ–¹æ‹¬å·([abc])ä»£è¡¨å¯é€‰å­—ç¬¦èŒƒå›´ï¼Œå¤§æ‹¬å·({string1,string2,â€¦})ä»£è¡¨å¯é€‰çš„å­—ç¬¦ä¸²ç­‰ã€‚</li><li>å¦‚æœåç§°çš„æœ€å‰é¢æœ‰ä¸€ä¸ªæ„Ÿå¹å·(!)ï¼Œè¡¨ç¤ºä¾‹å¤–è§„åˆ™ï¼Œå°†ä¸ä¼šå¿½ç•¥ã€‚</li><li>å¦‚æœåç§°çš„æœ€å‰é¢æ˜¯ä¸€ä¸ªè·¯å¾„åˆ†éš”ç¬¦(/)ï¼Œè¡¨ç¤ºè¦å¿½ç•¥çš„æ–‡ä»¶åœ¨æ­¤ç›®å½•ä¸‹ï¼Œè€Œå­ç›®å½•ä¸­çš„æ–‡ä»¶ä¸å¿½ç•¥ã€‚</li><li>å¦‚æœåç§°çš„æœ€åé¢æ˜¯ä¸€ä¸ªè·¯å¾„åˆ†éš”ç¬¦(/)ï¼Œè¡¨ç¤ºè¦å¿½ç•¥çš„æ˜¯æ­¤ç›®å½•ä¸‹è¯¥åç§°çš„å­ç›®å½•ï¼Œè€Œéæ–‡ä»¶(é»˜è®¤æ–‡ä»¶æˆ–ç›®å½•éƒ½å¿½ç•¥)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä¸ºæ³¨é‡Š</span><br>*.txt      <span class="hljs-comment"># å¿½ç•¥æ‰€æœ‰.txtç»“å°¾çš„æ–‡ä»¶ï¼Œè¿™æ ·çš„è¯ä¸Šä¼ å°±ä¸ä¼šè¢«é€‰ä¸­ã€‚</span><br>!lib.txt   <span class="hljs-comment"># ä½†lib.txté™¤å¤–</span><br>/temp      <span class="hljs-comment"># ä»…å¿½ç•¥æ ¹ç›®å½•ä¸‹çš„TODOæ–‡ä»¶ï¼Œä¸åŒ…æ‹¬å…¶ä»–ç›®å½•temp</span><br>build/     <span class="hljs-comment"># å¿½ç•¥build/ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span><br>doc/*.txt  <span class="hljs-comment"># ä¼šå¿½ç•¥doc/notes.txtä½†ä¸åŒ…æ‹¬doc/server/arch.txt</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é€šå¸¸å‰åç«¯é¡¹ç›®éƒ½éœ€è¦çš„.gitignoreçš„é…ç½®</span><br>*.class<br>*.<span class="hljs-built_in">log</span><br>*.lock<br><br><span class="hljs-comment"># Package Files #</span><br>*.jar<br>*.war<br>*.ear<br>target/<br><br><span class="hljs-comment"># idea</span><br>.idea/<br>*.iml<br><br>*velocity.log*<br><br><span class="hljs-comment">### STS ###</span><br>.apt_generated<br>.factorypath<br>.springBeans<br><br><span class="hljs-comment">### IntelliJ IDEA###</span><br>*.iml<br>*.ipr<br>*.iws<br>.idea<br>.classpath<br>.project<br>.settings/<br>bin/<br><br>*.<span class="hljs-built_in">log</span><br>tmp/<br><br><span class="hljs-comment">#rebel</span><br>*rebel.xml*<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ç äº‘gitee"><a href="#ä½¿ç”¨ç äº‘gitee" class="headerlink" title="ä½¿ç”¨ç äº‘gitee"></a>ä½¿ç”¨ç äº‘gitee</h2><blockquote><p>å›½å†…ä¸€èˆ¬ä½¿ç”¨giteeï¼Œè€Œé€šå¸¸å…¨çƒèŒƒå›´å†…å¤§å¤šéƒ½æ˜¯ç”¨githubï¼Œä¸¤è€…ä½¿ç”¨å‡ ä¹ä¸€è‡´ï¼Œæœ‰äº›å…¬å¸ä¼šè‡ªå·±æ­å»ºgitlabæœåŠ¡å™¨</p></blockquote><ol><li><p>æ³¨å†Œç™»å½•ç äº‘ï¼Œå®Œå–„ä¸ªäººä¿¡æ¯ï¼Œç‚¹å‡»è‡ªå·±å¤´åƒé€‰è®¾ç½®</p></li><li><p>è®¾ç½®æœ¬æœºç»‘å®šSSHå…¬é’¥ï¼Œå®ç°å…å¯†ç ç™»å½•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥C:\Users\Administrator\.sshç›®å½•</span><br><span class="hljs-comment"># ç”Ÿæˆå…¬é’¥ï¼Œ-t rsaæ˜¯é€‰æ‹©åŠ å¯†æ–¹å¼</span><br>ssh-keygen -t rsa<br></code></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_11_%E5%85%AC%E9%92%A5%E7%94%9F%E6%88%90%E7%BB%93%E6%9E%9C.png"></p></li><li><p>å°†å…¬é’¥ä¿¡æ¯public key (æ‰“å¼€ä¸Šé¢çš„<code>.pub</code>æ–‡ä»¶ï¼Œè¿™å°±æ˜¯å…¬é’¥)æ·»åŠ åˆ°ç äº‘è´¦æˆ·ä¸­å³å¯</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_12_%E6%B7%BB%E5%8A%A0%E5%85%AC%E9%92%A5%E5%A4%84.png"></p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_13_%E6%B7%BB%E5%8A%A0%E6%88%90%E5%8A%9F%E5%90%8E.png"></p></li><li><p>ä½¿ç”¨ç äº‘åˆ›å»ºè‡ªå·±çš„ä»“åº“</p><p>æ–°å»ºä»“åº“çš„ä½ç½®</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_14_%E6%96%B0%E5%BB%BA%E4%BB%93%E5%BA%931.png"></p><p>è‹¥å…¬å¼€çš„è¯æœ‰ä¸€ä¸ªè®¸å¯è¯é€‰é¡¹ï¼š</p><p>å¼€æºæ˜¯å¦å¯ä»¥éšæ„è½¬è½½ï¼Œå¼€æºä½†æ˜¯ä¸èƒ½å•†ç”¨ï¼Œç­‰ç­‰å„ç§é™åˆ¶åè®®ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_15_%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE2.png"></p></li><li><p>æœ€åå…‹éš†è‡³æœ¬åœ°å³å¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://gitee.com/lihengxu/gitstudy.git<br></code></pre></td></tr></table></figure></li></ol><h2 id="IDEAä¸­é›†æˆGit"><a href="#IDEAä¸­é›†æˆGit" class="headerlink" title="IDEAä¸­é›†æˆGit"></a>IDEAä¸­é›†æˆGit</h2><p> <strong>(å’ŒPycharmåŸºæœ¬ç›¸åŒ)</strong></p><ol><li>æ–°å»ºé¡¹ç›®ï¼Œç»‘å®šgit<ul><li>å°†è¿œç¨‹çš„gitæ–‡ä»¶ç›®å½•ç›´æ¥æ‹·è´åˆ°é¡¹ç›®ä¸­å³å¯ï¼Œæˆ–è€…ç›´æ¥åˆ›å»ºé¡¹ç›®åˆ°gitæ–‡ä»¶ç›®å½•ä¸‹</li></ul></li><li>ä¿®æ”¹æ–‡ä»¶ï¼Œä½¿ç”¨IDEAæ“ä½œgit<ul><li>æ·»åŠ åˆ°æš‚å­˜åŒºï¼šå‘½ä»¤è¡Œ <code>git add .</code> ï¼›æˆ–è€…æ‰‹åŠ¨é¼ æ ‡å³é”®ç‚¹æ–‡ä»¶ï¼Œé€‰GItç„¶åç‚¹Add</li><li>commitæäº¤ï¼šç•Œé¢å³ä¸Šè§’æœ‰ä¸€ä¸ªcommité€‰é¡¹ï¼Œç‚¹å‡»åé€‰æ‹©ï¼Œå¹¶è¾“å…¥ä¸€ä¸‹messageå³å¯</li><li>pushåˆ°è¿œç¨‹ä»“åº“ï¼šç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥<code>git push</code>å³å¯</li></ul></li><li>æäº¤æµ‹è¯•</li></ol><hr><p><strong>ä»¥ä¸Šå…¨éƒ¨éƒ½ä¸æ¶‰åŠåˆ†æ”¯ï¼Œå…¨æ˜¯å•äººæ“ä½œ</strong></p><hr><h2 id="Gitåˆ†æ”¯"><a href="#Gitåˆ†æ”¯" class="headerlink" title="Gitåˆ†æ”¯"></a>Gitåˆ†æ”¯</h2><p>åˆ†æ”¯ç±»ä¼¼å¹³è¡Œå®‡å®™çš„æ¦‚å¿µï¼Œé€‚ç”¨äºå¤šäººååŒå¼€å‘</p><p>å½“å­˜åœ¨å¤šä¸ªåˆ†æ”¯ï¼Œæˆ‘ä»¬è¿›è¡Œåˆ†æ”¯åˆå¹¶æ—¶ï¼Œå¯èƒ½ä¼šæœ‰å†²çªäº§ç”Ÿ</p><p><img src="https://cdn.jsdelivr.net/gh/LihengXu/mycdn/img/gitstudy_16_git%E5%88%86%E6%94%AF%E7%A4%BA%E6%84%8F%E5%9B%BE.png"></p><p>gitåˆ†æ”¯ä¸­å¸¸è§å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ—å‡ºæ‰€æœ‰æœ¬åœ°åˆ†æ”¯</span><br>git branch<br><br><span class="hljs-comment"># åˆ—å‡ºæ‰€å¶è¿œç¨‹åˆ†æ”¯</span><br>git branch -r<br><br><span class="hljs-comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œä½†ä¾ç„¶åœç•™åœ¨å½“å‰åˆ†æ”¯</span><br>git branch [branch -name]<br><br><span class="hljs-comment"># åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</span><br>git checkout [branch]<br><br><span class="hljs-comment"># æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯</span><br>git checkout -b [branch]<br><br><span class="hljs-comment"># é‡å‘½ååˆ†æ”¯</span><br>git branch -m [branch -oldname] [branch -newname]<br><br><span class="hljs-comment"># åˆå¹¶æŒ‡å®šåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯</span><br>$ git merge [branch]<br><br><span class="hljs-comment"># ä¸­æ­¢è¿™ä¸€æ¬¡æäº¤çš„åˆå¹¶(å½“é‡åˆ°å†²çªæ—¶)</span><br>$ git merge --abort<br><br><span class="hljs-comment"># å°†åˆ†æ”¯å˜åŸº(Rebase)åˆ°master</span><br><span class="hljs-comment"># å…ˆåˆ‡æ¢åˆ°åˆ†æ”¯ï¼Œå†å®Œæˆå˜åŸº</span><br>$ git checkout [branch]<br>$ git rebase master<br><br><span class="hljs-comment"># åˆ é™¤åˆ†æ”¯</span><br>$ git branch -d [branch -name]<br><br><span class="hljs-comment"># åˆ é™¤è¿œç¨‹åˆ†æ”¯</span><br>$ git push origin --delete [branch -name]<br>$ git branch -dr [remote/branch]<br></code></pre></td></tr></table></figure><blockquote><p>æƒ³è¦å½¢è±¡çš„å¿«é€Ÿç†è§£åˆ†æ”¯çš„æ¦‚å¿µï¼Œæ¨èä¸€æ¬¾å›¾å½¢åŒ–å®¢æˆ·ç«¯<a href="https://www.gitkraken.com/">GitKraken</a></p></blockquote><blockquote><p>å»ºè®®ä½¿ç”¨githubè´¦å·å…³è”ç™»å½•ï¼Œè¿™é‡Œæ¨è<a href="https://www.bilibili.com/video/BV1KD4y1S7FL">æ•™ç¨‹</a>ä»¥åŠå…³äºåˆ†æ”¯çš„è¿›é˜¶<a href="https://www.bilibili.com/video/bv1hA411v7qX/">æ•™ç¨‹</a></p></blockquote><p>æ³¨æ„ä¸»åˆ†æ”¯masteråº”è¯¥éå¸¸ç¨³å®šï¼Œåªæœ‰åˆ†æ”¯ä»£ç ç¨³å®šä¹‹åæ‰èƒ½åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>Gitå…¶å®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¾ˆå¤šå‘½ä»¤å…¶å®åªè¦å¤šç”¨å°±èƒ½ç†Ÿæ‚‰ï¼Œå°¤å…¶æ—¶åˆ†æ”¯çš„æ“ä½œï¼Œè¿™éƒ¨åˆ†ç”¨å›¾å½¢ç•Œé¢å¤šä½¿ç”¨å°±èƒ½ç†è§£å¾—æ›´æ·±åˆ»</li><li>giteeä¸‹é¢æœ‰ä¸€ä¸ªgitå¤§å…¨ï¼Œæ›´å¤šå¾—ä¸€äº›æ’ä»¶ï¼Œå‘½ä»¤éƒ½èƒ½åœ¨é‡Œé¢æŸ¥è¯¢ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Github</tag>
      
      <tag>Git</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
